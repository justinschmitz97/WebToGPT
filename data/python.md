# https://docs.python.org/3/

## What’s New In Python 3.0 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.0.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](2.7.html "What’s New in Python 2.7") \|
* [previous](3.1.html "What’s New In Python 3.1") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.0
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.0[¶](#what-s-new-in-python-3-0 "Link to this heading")

Author:
Guido van Rossum

This article explains the new features in Python 3\.0, compared to 2\.6\.
Python 3\.0, also known as “Python 3000” or “Py3K”, is the first ever
*intentionally backwards incompatible* Python release. Python 3\.0 was released on December 3, 2008\.
There are more changes than in a typical release, and more that are important for all
Python users. Nevertheless, after digesting the changes, you’ll find
that Python really hasn’t changed all that much – by and large, we’re
mostly fixing well\-known annoyances and warts, and removing a lot of
old cruft.

This article doesn’t attempt to provide a complete specification of
all new features, but instead tries to give a convenient overview.
For full details, you should refer to the documentation for Python
3\.0, and/or the many PEPs referenced in the text. If you want to
understand the complete implementation and design rationale for a
particular feature, PEPs usually have more details than the regular
documentation; but note that PEPs usually are not kept up\-to\-date once
a feature has been fully implemented.

Due to time constraints this document is not as complete as it should
have been. As always for a new release, the `Misc/NEWS` file in the
source distribution contains a wealth of detailed information about
every small thing that was changed.

## Common Stumbling Blocks[¶](#common-stumbling-blocks "Link to this heading")

This section lists those few changes that are most likely to trip you
up if you’re used to Python 2\.5\.

### Print Is A Function[¶](#print-is-a-function "Link to this heading")

The `print` statement has been replaced with a [`print()`](../library/functions.html#print "print")
function, with keyword arguments to replace most of the special syntax
of the old `print` statement ([**PEP 3105**](https://peps.python.org/pep-3105/)). Examples:

\`\`\`
Old: print "The answer is", 2\*2
New: print("The answer is", 2\*2\)

Old: print x, \# Trailing comma suppresses newline
New: print(x, end=" ") \# Appends a space instead of a newline

Old: print \# Prints a newline
New: print() \# You must call the function!

Old: print \>\>sys.stderr, "fatal error"
New: print("fatal error", file=sys.stderr)

Old: print (x, y) \# prints repr((x, y))
New: print((x, y)) \# Not the same as print(x, y)!

\`\`\`

You can also customize the separator between items, e.g.:

\`\`\`
print("There are \ possibilities!", sep="")

\`\`\`

which produces:

\`\`\`
There are \ possibilities!

\`\`\`

Note:

* The [`print()`](../library/functions.html#print "print") function doesn’t support the “softspace” feature of
the old `print` statement. For example, in Python 2\.x,
`print "A\n", "B"` would write `"A\nB\n"`; but in Python 3\.0,
`print("A\n", "B")` writes `"A\n B\n"`.
* Initially, you’ll be finding yourself typing the old `print x`
a lot in interactive mode. Time to retrain your fingers to type
`print(x)` instead!
* When using the `2to3` source\-to\-source conversion tool, all
`print` statements are automatically converted to
[`print()`](../library/functions.html#print "print") function calls, so this is mostly a non\-issue for
larger projects.

### Views And Iterators Instead Of Lists[¶](#views-and-iterators-instead-of-lists "Link to this heading")

Some well\-known APIs no longer return lists:

* [`dict`](../library/stdtypes.html#dict "dict") methods [`dict.keys()`](../library/stdtypes.html#dict.keys "dict.keys"), [`dict.items()`](../library/stdtypes.html#dict.items "dict.items") and
[`dict.values()`](../library/stdtypes.html#dict.values "dict.values") return “views” instead of lists. For example,
this no longer works: `k = d.keys(); k.sort()`. Use `k =
sorted(d)` instead (this works in Python 2\.5 too and is just
as efficient).
* Also, the `dict.iterkeys()`, `dict.iteritems()` and
`dict.itervalues()` methods are no longer supported.
* [`map()`](../library/functions.html#map "map") and [`filter()`](../library/functions.html#filter "filter") return iterators. If you really need
a list and the input sequences are all of equal length, a quick
fix is to wrap [`map()`](../library/functions.html#map "map") in [`list()`](../library/stdtypes.html#list "list"), e.g. `list(map(...))`,
but a better fix is
often to use a list comprehension (especially when the original code
uses [`lambda`](../reference/expressions.html#lambda)), or rewriting the code so it doesn’t need a
list at all. Particularly tricky is [`map()`](../library/functions.html#map "map") invoked for the
side effects of the function; the correct transformation is to use a
regular [`for`](../reference/compound_stmts.html#for) loop (since creating a list would just be
wasteful).

If the input sequences are not of equal length, [`map()`](../library/functions.html#map "map") will
stop at the termination of the shortest of the sequences. For full
compatibility with [`map()`](../library/functions.html#map "map") from Python 2\.x, also wrap the sequences in
[`itertools.zip_longest()`](../library/itertools.html#itertools.zip_longest "itertools.zip_longest"), e.g. `map(func, *sequences)` becomes
`list(map(func, itertools.zip_longest(*sequences)))`.
* [`range()`](../library/stdtypes.html#range "range") now behaves like `xrange()` used to behave, except
it works with values of arbitrary size. The latter no longer
exists.
* [`zip()`](../library/functions.html#zip "zip") now returns an iterator.

### Ordering Comparisons[¶](#ordering-comparisons "Link to this heading")

Python 3\.0 has simplified the rules for ordering comparisons:

* The ordering comparison operators (`=`, `>`)
raise a TypeError exception when the operands don’t have a
meaningful natural ordering. Thus, expressions like `1  None` or `len  b) - (a ` (use `!=` instead).
* Removed keyword: [`exec()`](../library/functions.html#exec "exec") is no longer a keyword; it remains as
a function. (Fortunately the function syntax was also accepted in
2\.x.) Also note that [`exec()`](../library/functions.html#exec "exec") no longer takes a stream argument;
instead of `exec(f)` you can use `exec(f.read())`.
* Integer literals no longer support a trailing `l` or `L`.
* String literals no longer support a leading `u` or `U`.
* The [`from`](../reference/simple_stmts.html#from) *module* [`import`](../reference/simple_stmts.html#import) `*` syntax is only
allowed at the module level, no longer inside functions.
* The only acceptable syntax for relative imports is `from .[module]
import name`. All [`import`](../reference/simple_stmts.html#import) forms not starting with `.` are
interpreted as absolute imports. ([**PEP 328**](https://peps.python.org/pep-0328/))
* Classic classes are gone.

## Changes Already Present In Python 2\.6[¶](#changes-already-present-in-python-2-6 "Link to this heading")

Since many users presumably make the jump straight from Python 2\.5 to
Python 3\.0, this section reminds the reader of new features that were
originally designed for Python 3\.0 but that were back\-ported to Python
2\.6\. The corresponding sections in [What’s New in Python 2\.6](2.6.html#whats-new-in-2-6) should be
consulted for longer descriptions.

* [PEP 343: The ‘with’ statement](2.6.html#pep-0343). The [`with`](../reference/compound_stmts.html#with) statement is now a standard
feature and no longer needs to be imported from the [`__future__`](../library/__future__.html#module-__future__ "__future__: Future statement definitions").
Also check out [Writing Context Managers](2.6.html#new-26-context-managers) and
[The contextlib module](2.6.html#new-module-contextlib).
* [PEP 366: Explicit Relative Imports From a Main Module](2.6.html#pep-0366). This enhances the usefulness of the [`-m`](../using/cmdline.html#cmdoption-m)
option when the referenced module lives in a package.
* [PEP 370: Per\-user site\-packages Directory](2.6.html#pep-0370).
* [PEP 371: The multiprocessing Package](2.6.html#pep-0371).
* [PEP 3101: Advanced String Formatting](2.6.html#pep-3101). Note: the 2\.6 description mentions the
[`format()`](../library/functions.html#format "format") method for both 8\-bit and Unicode strings. In 3\.0,
only the [`str`](../library/stdtypes.html#str "str") type (text strings with Unicode support)
supports this method; the [`bytes`](../library/stdtypes.html#bytes "bytes") type does not. The plan is
to eventually make this the only API for string formatting, and to
start deprecating the `%` operator in Python 3\.1\.
* [PEP 3105: print As a Function](2.6.html#pep-3105). This is now a standard feature and no longer needs
to be imported from [`__future__`](../library/__future__.html#module-__future__ "__future__: Future statement definitions"). More details were given above.
* [PEP 3110: Exception\-Handling Changes](2.6.html#pep-3110). The [`except`](../reference/compound_stmts.html#except) *exc* `as` *var*
syntax is now standard and `except` *exc*, *var* is no
longer supported. (Of course, the `as` *var* part is still
optional.)
* [PEP 3112: Byte Literals](2.6.html#pep-3112). The `b"..."` string literal notation (and its
variants like `b'...'`, `b"""..."""`, and `br"..."`) now
produces a literal of type [`bytes`](../library/stdtypes.html#bytes "bytes").
* [PEP 3116: New I/O Library](2.6.html#pep-3116). The [`io`](../library/io.html#module-io "io: Core tools for working with streams.") module is now the standard way of
doing file I/O. The built\-in [`open()`](../library/functions.html#open "open") function is now an
alias for [`io.open()`](../library/io.html#io.open "io.open") and has additional keyword arguments
*encoding*, *errors*, *newline* and *closefd*. Also note that an
invalid *mode* argument now raises [`ValueError`](../library/exceptions.html#ValueError "ValueError"), not
[`IOError`](../library/exceptions.html#IOError "IOError"). The binary file object underlying a text file
object can be accessed as `f.buffer` (but beware that the
text object maintains a buffer of itself in order to speed up
the encoding and decoding operations).
* [PEP 3118: Revised Buffer Protocol](2.6.html#pep-3118). The old builtin `buffer()` is now really gone;
the new builtin [`memoryview()`](../library/stdtypes.html#memoryview "memoryview") provides (mostly) similar
functionality.
* [PEP 3119: Abstract Base Classes](2.6.html#pep-3119). The [`abc`](../library/abc.html#module-abc "abc: Abstract base classes according to :pep:`3119`.") module and the ABCs defined in the
[`collections`](../library/collections.html#module-collections "collections: Container datatypes") module plays a somewhat more prominent role in
the language now, and built\-in collection types like [`dict`](../library/stdtypes.html#dict "dict")
and [`list`](../library/stdtypes.html#list "list") conform to the [`collections.MutableMapping`](../library/collections.abc.html#collections.abc.MutableMapping "collections.abc.MutableMapping")
and [`collections.MutableSequence`](../library/collections.abc.html#collections.abc.MutableSequence "collections.abc.MutableSequence") ABCs, respectively.
* [PEP 3127: Integer Literal Support and Syntax](2.6.html#pep-3127). As mentioned above, the new octal literal
notation is the only one supported, and binary literals have been
added.
* [PEP 3129: Class Decorators](2.6.html#pep-3129).
* [PEP 3141: A Type Hierarchy for Numbers](2.6.html#pep-3141). The [`numbers`](../library/numbers.html#module-numbers "numbers: Numeric abstract base classes (Complex, Real, Integral, etc.).") module is another new use of
ABCs, defining Python’s “numeric tower”. Also note the new
[`fractions`](../library/fractions.html#module-fractions "fractions: Rational numbers.") module which implements [`numbers.Rational`](../library/numbers.html#numbers.Rational "numbers.Rational").

## Library Changes[¶](#library-changes "Link to this heading")

Due to time constraints, this document does not exhaustively cover the
very extensive changes to the standard library. [**PEP 3108**](https://peps.python.org/pep-3108/) is the
reference for the major changes to the library. Here’s a capsule
review:

* Many old modules were removed. Some, like `gopherlib` (no
longer used) and `md5` (replaced by [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.")), were
already deprecated by [**PEP 4**](https://peps.python.org/pep-0004/). Others were removed as a result
of the removal of support for various platforms such as Irix, BeOS
and Mac OS 9 (see [**PEP 11**](https://peps.python.org/pep-0011/)). Some modules were also selected for
removal in Python 3\.0 due to lack of use or because a better
replacement exists. See [**PEP 3108**](https://peps.python.org/pep-3108/) for an exhaustive list.
* The `bsddb3` package was removed because its presence in the
core standard library has proved over time to be a particular burden
for the core developers due to testing instability and Berkeley DB’s
release schedule. However, the package is alive and well,
externally maintained at .
* Some modules were renamed because their old name disobeyed
[**PEP 8**](https://peps.python.org/pep-0008/), or for various other reasons. Here’s the list:

| Old Name | New Name |
| --- | --- |
| \_winreg | winreg |
| ConfigParser | configparser |
| copy\_reg | copyreg |
| Queue | queue |
| SocketServer | socketserver |
| markupbase | \_markupbase |
| repr | reprlib |
| test.test\_support | test.support |
* A common pattern in Python 2\.x is to have one version of a module
implemented in pure Python, with an optional accelerated version
implemented as a C extension; for example, [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") and
`cPickle`. This places the burden of importing the accelerated
version and falling back on the pure Python version on each user of
these modules. In Python 3\.0, the accelerated versions are
considered implementation details of the pure Python versions.
Users should always import the standard version, which attempts to
import the accelerated version and falls back to the pure Python
version. The [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") / `cPickle` pair received this
treatment. The [`profile`](../library/profile.html#module-profile "profile: Python source profiler.") module is on the list for 3\.1\. The
`StringIO` module has been turned into a class in the [`io`](../library/io.html#module-io "io: Core tools for working with streams.")
module.
* Some related modules have been grouped into packages, and usually
the submodule names have been simplified. The resulting new
packages are:

	+ [`dbm`](../library/dbm.html#module-dbm "dbm: Interfaces to various Unix \"database\" formats.") (`anydbm`, `dbhash`, `dbm`,
	`dumbdbm`, `gdbm`, `whichdb`).
	+ [`html`](../library/html.html#module-html "html: Helpers for manipulating HTML.") (`HTMLParser`, `htmlentitydefs`).
	+ [`http`](../library/http.html#module-http "http: HTTP status codes and messages") (`httplib`, `BaseHTTPServer`,
	`CGIHTTPServer`, `SimpleHTTPServer`, `Cookie`,
	`cookielib`).
	+ [`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") (all `Tkinter`\-related modules except
	[`turtle`](../library/turtle.html#module-turtle "turtle: An educational framework for simple graphics applications")). The target audience of [`turtle`](../library/turtle.html#module-turtle "turtle: An educational framework for simple graphics applications") doesn’t
	really care about [`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces"). Also note that as of Python
	2\.6, the functionality of [`turtle`](../library/turtle.html#module-turtle "turtle: An educational framework for simple graphics applications") has been greatly enhanced.
	+ [`urllib`](../library/urllib.html#module-urllib "urllib") (`urllib`, `urllib2`, `urlparse`,
	`robotparse`).
	+ [`xmlrpc`](../library/xmlrpc.html#module-xmlrpc "xmlrpc: Server and client modules implementing XML-RPC.") (`xmlrpclib`, `DocXMLRPCServer`,
	`SimpleXMLRPCServer`).

Some other changes to standard library modules, not covered by
[**PEP 3108**](https://peps.python.org/pep-3108/):

* Killed `sets`. Use the built\-in [`set()`](../library/stdtypes.html#set "set") class.
* Cleanup of the [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") module: removed `sys.exitfunc()`,
`sys.exc_clear()`, `sys.exc_type`, `sys.exc_value`,
`sys.exc_traceback`. (Note that [`sys.last_type`](../library/sys.html#sys.last_type "sys.last_type")
etc. remain.)
* Cleanup of the [`array.array`](../library/array.html#array.array "array.array") type: the `read()` and
`write()` methods are gone; use [`fromfile()`](../library/array.html#array.array.fromfile "array.array.fromfile") and
[`tofile()`](../library/array.html#array.array.tofile "array.array.tofile") instead. Also, the `'c'` typecode for array is
gone – use either `'b'` for bytes or `'u'` for Unicode
characters.
* Cleanup of the [`operator`](../library/operator.html#module-operator "operator: Functions corresponding to the standard operators.") module: removed
`sequenceIncludes()` and `isCallable()`.
* Cleanup of the `thread` module: `acquire_lock()` and
`release_lock()` are gone; use [`acquire()`](../library/threading.html#threading.Lock.acquire "threading.Lock.acquire") and
[`release()`](../library/threading.html#threading.Lock.release "threading.Lock.release") instead.
* Cleanup of the [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions.") module: removed the `jumpahead()` API.
* The `new` module is gone.
* The functions `os.tmpnam()`, `os.tempnam()` and
`os.tmpfile()` have been removed in favor of the [`tempfile`](../library/tempfile.html#module-tempfile "tempfile: Generate temporary files and directories.")
module.
* The [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module has been changed to work with bytes. The
main entry point is now [`tokenize.tokenize()`](../library/tokenize.html#tokenize.tokenize "tokenize.tokenize"), instead of
generate\_tokens.
* `string.letters` and its friends (`string.lowercase` and
`string.uppercase`) are gone. Use
[`string.ascii_letters`](../library/string.html#string.ascii_letters "string.ascii_letters") etc. instead. (The reason for the
removal is that `string.letters` and friends had
locale\-specific behavior, which is a bad idea for such
attractively named global “constants”.)
* Renamed module `__builtin__` to [`builtins`](../library/builtins.html#module-builtins "builtins: The module that provides the built-in namespace.") (removing the
underscores, adding an ‘s’). The `__builtins__` variable
found in most global namespaces is unchanged. To modify a builtin,
you should use [`builtins`](../library/builtins.html#module-builtins "builtins: The module that provides the built-in namespace."), not `__builtins__`!

## [**PEP 3101**](https://peps.python.org/pep-3101/): A New Approach To String Formatting[¶](#pep-3101-a-new-approach-to-string-formatting "Link to this heading")

* A new system for built\-in string formatting operations replaces the
`%` string formatting operator. (However, the `%` operator is
still supported; it will be deprecated in Python 3\.1 and removed
from the language at some later time.) Read [**PEP 3101**](https://peps.python.org/pep-3101/) for the full
scoop.

## Changes To Exceptions[¶](#changes-to-exceptions "Link to this heading")

The APIs for raising and catching exception have been cleaned up and
new powerful features added:

* [**PEP 352**](https://peps.python.org/pep-0352/): All exceptions must be derived (directly or indirectly)
from [`BaseException`](../library/exceptions.html#BaseException "BaseException"). This is the root of the exception
hierarchy. This is not new as a recommendation, but the
*requirement* to inherit from [`BaseException`](../library/exceptions.html#BaseException "BaseException") is new. (Python
2\.6 still allowed classic classes to be raised, and placed no
restriction on what you can catch.) As a consequence, string
exceptions are finally truly and utterly dead.
* Almost all exceptions should actually derive from [`Exception`](../library/exceptions.html#Exception "Exception");
[`BaseException`](../library/exceptions.html#BaseException "BaseException") should only be used as a base class for
exceptions that should only be handled at the top level, such as
[`SystemExit`](../library/exceptions.html#SystemExit "SystemExit") or [`KeyboardInterrupt`](../library/exceptions.html#KeyboardInterrupt "KeyboardInterrupt"). The recommended
idiom for handling all exceptions except for this latter category is
to use [`except`](../reference/compound_stmts.html#except) [`Exception`](../library/exceptions.html#Exception "Exception").
* `StandardError` was removed.
* Exceptions no longer behave as sequences. Use the [`args`](../library/exceptions.html#BaseException.args "BaseException.args")
attribute instead.
* [**PEP 3109**](https://peps.python.org/pep-3109/): Raising exceptions. You must now use `raise
Exception(args)` instead of `raise Exception, args`.
Additionally, you can no longer explicitly specify a traceback;
instead, if you *have* to do this, you can assign directly to the
[`__traceback__`](../library/exceptions.html#BaseException.__traceback__ "BaseException.__traceback__") attribute (see below).
* [**PEP 3110**](https://peps.python.org/pep-3110/): Catching exceptions. You must now use
`except SomeException as variable` instead
of `except SomeException, variable`. Moreover, the
*variable* is explicitly deleted when the [`except`](../reference/compound_stmts.html#except) block
is left.
* [**PEP 3134**](https://peps.python.org/pep-3134/): Exception chaining. There are two cases: implicit
chaining and explicit chaining. Implicit chaining happens when an
exception is raised in an [`except`](../reference/compound_stmts.html#except) or [`finally`](../reference/compound_stmts.html#finally)
handler block. This usually happens due to a bug in the handler
block; we call this a *secondary* exception. In this case, the
original exception (that was being handled) is saved as the
[`__context__`](../library/exceptions.html#BaseException.__context__ "BaseException.__context__") attribute of the secondary exception.
Explicit chaining is invoked with this syntax:

\`\`\`
raise SecondaryException() from primary\_exception

\`\`\`

(where *primary\_exception* is any expression that produces an
exception object, probably an exception that was previously caught).
In this case, the primary exception is stored on the
[`__cause__`](../library/exceptions.html#BaseException.__cause__ "BaseException.__cause__") attribute of the secondary exception. The
traceback printed when an unhandled exception occurs walks the chain
of `__cause__` and [`__context__`](../library/exceptions.html#BaseException.__context__ "BaseException.__context__") attributes and
prints a
separate traceback for each component of the chain, with the primary
exception at the top. (Java users may recognize this behavior.)
* [**PEP 3134**](https://peps.python.org/pep-3134/): Exception objects now store their traceback as the
[`__traceback__`](../library/exceptions.html#BaseException.__traceback__ "BaseException.__traceback__") attribute. This means that an exception
object now contains all the information pertaining to an exception,
and there are fewer reasons to use [`sys.exc_info()`](../library/sys.html#sys.exc_info "sys.exc_info") (though the
latter is not removed).
* A few exception messages are improved when Windows fails to load an
extension module. For example, `error code 193` is now `%1 is
not a valid Win32 application`. Strings now deal with non\-English
locales.

## Miscellaneous Other Changes[¶](#miscellaneous-other-changes "Link to this heading")

### Operators And Special Methods[¶](#operators-and-special-methods "Link to this heading")

* `!=` now returns the opposite of `==`, unless `==` returns
[`NotImplemented`](../library/constants.html#NotImplemented "NotImplemented").
* The concept of “unbound methods” has been removed from the language.
When referencing a method as a class attribute, you now get a plain
function object.
* `__getslice__()`, `__setslice__()` and `__delslice__()`
were killed. The syntax `a[i:j]` now translates to
`a.__getitem__(slice(i, j))` (or [`__setitem__()`](../reference/datamodel.html#object.__setitem__ "object.__setitem__") or
[`__delitem__()`](../reference/datamodel.html#object.__delitem__ "object.__delitem__"), when used as an assignment or deletion target,
respectively).
* [**PEP 3114**](https://peps.python.org/pep-3114/): the standard [`next()`](../library/functions.html#next "next") method has been renamed to
[`__next__()`](../library/stdtypes.html#iterator.__next__ "iterator.__next__").
* The `__oct__()` and `__hex__()` special methods are removed
– [`oct()`](../library/functions.html#oct "oct") and [`hex()`](../library/functions.html#hex "hex") use [`__index__()`](../reference/datamodel.html#object.__index__ "object.__index__") now to convert
the argument to an integer.
* Removed support for `__members__` and `__methods__`.
* The function attributes named `func_X` have been renamed to
use the `__X__` form, freeing up these names in the function
attribute namespace for user\-defined attributes. To wit,
`func_closure`, `func_code`, `func_defaults`,
`func_dict`, `func_doc`, `func_globals`,
`func_name` were renamed to [`__closure__`](../reference/datamodel.html#function.__closure__ "function.__closure__"),
[`__code__`](../reference/datamodel.html#function.__code__ "function.__code__"), [`__defaults__`](../reference/datamodel.html#function.__defaults__ "function.__defaults__"),
[`__dict__`](../reference/datamodel.html#function.__dict__ "function.__dict__"), [`__doc__`](../reference/datamodel.html#function.__doc__ "function.__doc__"),
[`__globals__`](../reference/datamodel.html#function.__globals__ "function.__globals__"), [`__name__`](../reference/datamodel.html#function.__name__ "function.__name__"),
respectively.
* `__nonzero__()` is now [`__bool__()`](../reference/datamodel.html#object.__bool__ "object.__bool__").

### Builtins[¶](#builtins "Link to this heading")

* [**PEP 3135**](https://peps.python.org/pep-3135/): New [`super()`](../library/functions.html#super "super"). You can now invoke [`super()`](../library/functions.html#super "super")
without arguments and (assuming this is in a regular instance method
defined inside a [`class`](../reference/compound_stmts.html#class) statement) the right class and
instance will automatically be chosen. With arguments, the behavior
of [`super()`](../library/functions.html#super "super") is unchanged.
* [**PEP 3111**](https://peps.python.org/pep-3111/): `raw_input()` was renamed to [`input()`](../library/functions.html#input "input"). That
is, the new [`input()`](../library/functions.html#input "input") function reads a line from
[`sys.stdin`](../library/sys.html#sys.stdin "sys.stdin") and returns it with the trailing newline stripped.
It raises [`EOFError`](../library/exceptions.html#EOFError "EOFError") if the input is terminated prematurely.
To get the old behavior of [`input()`](../library/functions.html#input "input"), use `eval(input())`.
* A new built\-in function [`next()`](../library/functions.html#next "next") was added to call the
[`__next__()`](../library/stdtypes.html#iterator.__next__ "iterator.__next__") method on an object.
* The [`round()`](../library/functions.html#round "round") function rounding strategy and return type have
changed. Exact halfway cases are now rounded to the nearest even
result instead of away from zero. (For example, `round(2.5)` now
returns `2` rather than `3`.) `round(x[, n])` now
delegates to `x.__round__([n])` instead of always returning a
float. It generally returns an integer when called with a single
argument and a value of the same type as `x` when called with two
arguments.
* Moved `intern()` to [`sys.intern()`](../library/sys.html#sys.intern "sys.intern").
* Removed: `apply()`. Instead of `apply(f, args)` use
`f(*args)`.
* Removed [`callable()`](../library/functions.html#callable "callable"). Instead of `callable(f)` you can use
`isinstance(f, collections.Callable)`. The `operator.isCallable()`
function is also gone.
* Removed `coerce()`. This function no longer serves a purpose
now that classic classes are gone.
* Removed `execfile()`. Instead of `execfile(fn)` use
`exec(open(fn).read())`.
* Removed the `file` type. Use [`open()`](../library/functions.html#open "open"). There are now several
different kinds of streams that open can return in the [`io`](../library/io.html#module-io "io: Core tools for working with streams.") module.
* Removed `reduce()`. Use [`functools.reduce()`](../library/functools.html#functools.reduce "functools.reduce") if you really
need it; however, 99 percent of the time an explicit [`for`](../reference/compound_stmts.html#for)
loop is more readable.
* Removed `reload()`. Use `imp.reload()`.
* Removed. `dict.has_key()` – use the [`in`](../reference/expressions.html#in) operator
instead.

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

Due to time constraints, here is a *very* incomplete list of changes
to the C API.

* Support for several platforms was dropped, including but not limited
to Mac OS 9, BeOS, RISCOS, Irix, and Tru64\.
* [**PEP 3118**](https://peps.python.org/pep-3118/): New Buffer API.
* [**PEP 3121**](https://peps.python.org/pep-3121/): Extension Module Initialization \& Finalization.
* [**PEP 3123**](https://peps.python.org/pep-3123/): Making [`PyObject_HEAD`](../c-api/structures.html#c.PyObject_HEAD "PyObject_HEAD") conform to standard C.
* No more C API support for restricted execution.
* `PyNumber_Coerce()`, `PyNumber_CoerceEx()`,
`PyMember_Get()`, and `PyMember_Set()` C APIs are removed.
* New C API [`PyImport_ImportModuleNoBlock()`](../c-api/import.html#c.PyImport_ImportModuleNoBlock "PyImport_ImportModuleNoBlock"), works like
[`PyImport_ImportModule()`](../c-api/import.html#c.PyImport_ImportModule "PyImport_ImportModule") but won’t block on the import lock
(returning an error instead).
* Renamed the boolean conversion C\-level slot and method:
`nb_nonzero` is now `nb_bool`.
* Removed `METH_OLDARGS` and `WITH_CYCLE_GC` from the C API.

## Performance[¶](#performance "Link to this heading")

The net result of the 3\.0 generalizations is that Python 3\.0 runs the
pystone benchmark around 10% slower than Python 2\.5\. Most likely the
biggest cause is the removal of special\-casing for small integers.
There’s room for improvement, but it will happen after 3\.0 is
released!

## Porting To Python 3\.0[¶](#porting-to-python-3-0 "Link to this heading")

For porting existing Python 2\.5 or 2\.6 source code to Python 3\.0, the
best strategy is the following:

0. (Prerequisite:) Start with excellent test coverage.
1. Port to Python 2\.6\. This should be no more work than the average
port from Python 2\.x to Python 2\.(x\+1\). Make sure all your tests
pass.
2. (Still using 2\.6:) Turn on the `-3` command line switch.
This enables warnings about features that will be removed (or
change) in 3\.0\. Run your test suite again, and fix code that you
get warnings about until there are no warnings left, and all your
tests still pass.
3. Run the `2to3` source\-to\-source translator over your source code
tree. Run the
result of the translation under Python 3\.0\. Manually fix up any
remaining issues, fixing problems until all tests pass again.

It is not recommended to try to write source code that runs unchanged
under both Python 2\.6 and 3\.0; you’d have to use a very contorted
coding style, e.g. avoiding `print` statements, metaclasses,
and much more. If you are maintaining a library that needs to support
both Python 2\.6 and Python 3\.0, the best approach is to modify step 3
above by editing the 2\.6 version of the source code and running the
`2to3` translator again, rather than editing the 3\.0 version of the
source code.

For porting C extensions to Python 3\.0, please see [Porting Extension Modules to Python 3](../howto/cporting.html#cporting-howto).

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.0](#)
	+ [Common Stumbling Blocks](#common-stumbling-blocks)
		- [Print Is A Function](#print-is-a-function)
		- [Views And Iterators Instead Of Lists](#views-and-iterators-instead-of-lists)
		- [Ordering Comparisons](#ordering-comparisons)
		- [Integers](#integers)
		- [Text Vs. Data Instead Of Unicode Vs. 8\-bit](#text-vs-data-instead-of-unicode-vs-8-bit)
	+ [Overview Of Syntax Changes](#overview-of-syntax-changes)
		- [New Syntax](#new-syntax)
		- [Changed Syntax](#changed-syntax)
		- [Removed Syntax](#removed-syntax)
	+ [Changes Already Present In Python 2\.6](#changes-already-present-in-python-2-6)
	+ [Library Changes](#library-changes)
	+ [**PEP 3101**: A New Approach To String Formatting](#pep-3101-a-new-approach-to-string-formatting)
	+ [Changes To Exceptions](#changes-to-exceptions)
	+ [Miscellaneous Other Changes](#miscellaneous-other-changes)
		- [Operators And Special Methods](#operators-and-special-methods)
		- [Builtins](#builtins)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Performance](#performance)
	+ [Porting To Python 3\.0](#porting-to-python-3-0)

#### Previous topic

[What’s New In Python 3\.1](3.1.html "previous chapter")

#### Next topic

[What’s New in Python 2\.7](2.7.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.0.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](2.7.html "What’s New in Python 2.7") \|
* [previous](3.1.html "What’s New In Python 3.1") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.0
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.1 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.1.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.0.html "What’s New In Python 3.0") \|
* [previous](3.2.html "What’s New In Python 3.2") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.1
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.1[¶](#what-s-new-in-python-3-1 "Link to this heading")

Author:
Raymond Hettinger

This article explains the new features in Python 3\.1, compared to 3\.0\.
Python 3\.1 was released on June 27, 2009\.

## PEP 372: Ordered Dictionaries[¶](#pep-372-ordered-dictionaries "Link to this heading")

Regular Python dictionaries iterate over key/value pairs in arbitrary order.
Over the years, a number of authors have written alternative implementations
that remember the order that the keys were originally inserted. Based on
the experiences from those implementations, a new
[`collections.OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict") class has been introduced.

The OrderedDict API is substantially the same as regular dictionaries
but will iterate over keys and values in a guaranteed order depending on
when a key was first inserted. If a new entry overwrites an existing entry,
the original insertion position is left unchanged. Deleting an entry and
reinserting it will move it to the end.

The standard library now supports use of ordered dictionaries in several
modules. The [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") module uses them by default. This lets
configuration files be read, modified, and then written back in their original
order. The *\_asdict()* method for [`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") now
returns an ordered dictionary with the values appearing in the same order as
the underlying tuple indices. The [`json`](../library/json.html#module-json "json: Encode and decode the JSON format.") module is being built\-out with
an *object\_pairs\_hook* to allow OrderedDicts to be built by the decoder.
Support was also added for third\-party tools like [PyYAML](https://pyyaml.org/).

See also

[**PEP 372**](https://peps.python.org/pep-0372/) \- Ordered DictionariesPEP written by Armin Ronacher and Raymond Hettinger. Implementation
written by Raymond Hettinger.

Since an ordered dictionary remembers its insertion order, it can be used
in conjunction with sorting to make a sorted dictionary:

\`\`\`
\>\>\> \# regular unsorted dictionary
\>\>\> d = {'banana': 3, 'apple':4, 'pear': 1, 'orange': 2}

\>\>\> \# dictionary sorted by key
\>\>\> OrderedDict(sorted(d.items(), key=lambda t: t\[0]))
OrderedDict(\[('apple', 4\), ('banana', 3\), ('orange', 2\), ('pear', 1\)])

\>\>\> \# dictionary sorted by value
\>\>\> OrderedDict(sorted(d.items(), key=lambda t: t\[1]))
OrderedDict(\[('pear', 1\), ('orange', 2\), ('banana', 3\), ('apple', 4\)])

\>\>\> \# dictionary sorted by length of the key string
\>\>\> OrderedDict(sorted(d.items(), key=lambda t: len(t\[0])))
OrderedDict(\[('pear', 1\), ('apple', 4\), ('orange', 2\), ('banana', 3\)])

\`\`\`

The new sorted dictionaries maintain their sort order when entries
are deleted. But when new keys are added, the keys are appended
to the end and the sort is not maintained.

## PEP 378: Format Specifier for Thousands Separator[¶](#pep-378-format-specifier-for-thousands-separator "Link to this heading")

The built\-in [`format()`](../library/functions.html#format "format") function and the [`str.format()`](../library/stdtypes.html#str.format "str.format") method use
a mini\-language that now includes a simple, non\-locale aware way to format
a number with a thousands separator. That provides a way to humanize a
program’s output, improving its professional appearance and readability:

\`\`\`
\>\>\> format(1234567, ',d')
'1,234,567'
\>\>\> format(1234567\.89, ',.2f')
'1,234,567\.89'
\>\>\> format(12345\.6 \+ 8901234\.12j, ',f')
'12,345\.600000\+8,901,234\.120000j'
\>\>\> format(Decimal('1234567\.89'), ',f')
'1,234,567\.89'

\`\`\`

The supported types are [`int`](../library/functions.html#int "int"), [`float`](../library/functions.html#float "float"), [`complex`](../library/functions.html#complex "complex")
and [`decimal.Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal").

Discussions are underway about how to specify alternative separators
like dots, spaces, apostrophes, or underscores. Locale\-aware applications
should use the existing *n* format specifier which already has some support
for thousands separators.

See also

[**PEP 378**](https://peps.python.org/pep-0378/) \- Format Specifier for Thousands SeparatorPEP written by Raymond Hettinger and implemented by Eric Smith and
Mark Dickinson.

## Other Language Changes[¶](#other-language-changes "Link to this heading")

Some smaller changes made to the core Python language are:

* Directories and zip archives containing a `__main__.py`
file can now be executed directly by passing their name to the
interpreter. The directory/zipfile is automatically inserted as the
first entry in sys.path. (Suggestion and initial patch by Andy Chu;
revised patch by Phillip J. Eby and Nick Coghlan; [bpo\-1739468](https://bugs.python.org/issue?@action=redirect&bpo=1739468).)
* The [`int()`](../library/functions.html#int "int") type gained a `bit_length` method that returns the
number of bits necessary to represent its argument in binary:

\`\`\`
\>\>\> n = 37
\>\>\> bin(37\)
'0b100101'
\>\>\> n.bit\_length()
6
\>\>\> n = 2\*\*123\-1
\>\>\> n.bit\_length()
123
\>\>\> (n\+1\).bit\_length()
124

\`\`\`

(Contributed by Fredrik Johansson, Victor Stinner, Raymond Hettinger,
and Mark Dickinson; [bpo\-3439](https://bugs.python.org/issue?@action=redirect&bpo=3439).)
* The fields in [`format()`](../library/functions.html#format "format") strings can now be automatically
numbered:

\`\`\`
\>\>\> 'Sir {} of {}'.format('Gallahad', 'Camelot')
'Sir Gallahad of Camelot'

\`\`\`

Formerly, the string would have required numbered fields such as:
`'Sir {0} of {1}'`.

(Contributed by Eric Smith; [bpo\-5237](https://bugs.python.org/issue?@action=redirect&bpo=5237).)
* The `string.maketrans()` function is deprecated and is replaced by new
static methods, [`bytes.maketrans()`](../library/stdtypes.html#bytes.maketrans "bytes.maketrans") and [`bytearray.maketrans()`](../library/stdtypes.html#bytearray.maketrans "bytearray.maketrans").
This change solves the confusion around which types were supported by the
[`string`](../library/string.html#module-string "string: Common string operations.") module. Now, [`str`](../library/stdtypes.html#str "str"), [`bytes`](../library/stdtypes.html#bytes "bytes"), and
[`bytearray`](../library/stdtypes.html#bytearray "bytearray") each have their own **maketrans** and **translate**
methods with intermediate translation tables of the appropriate type.

(Contributed by Georg Brandl; [bpo\-5675](https://bugs.python.org/issue?@action=redirect&bpo=5675).)
* The syntax of the [`with`](../reference/compound_stmts.html#with) statement now allows multiple context
managers in a single statement:

\`\`\`
\>\>\> with open('mylog.txt') as infile, open('a.out', 'w') as outfile:
... for line in infile:
... if '\' in line:
... outfile.write(line)

\`\`\`

With the new syntax, the `contextlib.nested()` function is no longer
needed and is now deprecated.

(Contributed by Georg Brandl and Mattias Brändström;
[appspot issue 53094](https://codereview.appspot.com/53094).)
* `round(x, n)` now returns an integer if *x* is an integer.
Previously it returned a float:

\`\`\`
\>\>\> round(1123, \-2\)
1100

\`\`\`

(Contributed by Mark Dickinson; [bpo\-4707](https://bugs.python.org/issue?@action=redirect&bpo=4707).)
* Python now uses David Gay’s algorithm for finding the shortest floating\-point
representation that doesn’t change its value. This should help
mitigate some of the confusion surrounding binary floating\-point
numbers.

The significance is easily seen with a number like `1.1` which does not
have an exact equivalent in binary floating point. Since there is no exact
equivalent, an expression like `float('1.1')` evaluates to the nearest
representable value which is `0x1.199999999999ap+0` in hex or
`1.100000000000000088817841970012523233890533447265625` in decimal. That
nearest value was and still is used in subsequent floating\-point
calculations.

What is new is how the number gets displayed. Formerly, Python used a
simple approach. The value of `repr(1.1)` was computed as `format(1.1,
'.17g')` which evaluated to `'1.1000000000000001'`. The advantage of
using 17 digits was that it relied on IEEE\-754 guarantees to assure that
`eval(repr(1.1))` would round\-trip exactly to its original value. The
disadvantage is that many people found the output to be confusing (mistaking
intrinsic limitations of binary floating\-point representation as being a
problem with Python itself).

The new algorithm for `repr(1.1)` is smarter and returns `'1.1'`.
Effectively, it searches all equivalent string representations (ones that
get stored with the same underlying float value) and returns the shortest
representation.

The new algorithm tends to emit cleaner representations when possible, but
it does not change the underlying values. So, it is still the case that
`1.1 + 2.2 != 3.3` even though the representations may suggest otherwise.

The new algorithm depends on certain features in the underlying floating\-point
implementation. If the required features are not found, the old
algorithm will continue to be used. Also, the text pickle protocols
assure cross\-platform portability by using the old algorithm.

(Contributed by Eric Smith and Mark Dickinson; [bpo\-1580](https://bugs.python.org/issue?@action=redirect&bpo=1580))

## New, Improved, and Deprecated Modules[¶](#new-improved-and-deprecated-modules "Link to this heading")

* Added a [`collections.Counter`](../library/collections.html#collections.Counter "collections.Counter") class to support convenient
counting of unique items in a sequence or iterable:

\`\`\`
\>\>\> Counter(\['red', 'blue', 'red', 'green', 'blue', 'blue'])
Counter({'blue': 3, 'red': 2, 'green': 1})

\`\`\`

(Contributed by Raymond Hettinger; [bpo\-1696199](https://bugs.python.org/issue?@action=redirect&bpo=1696199).)
* Added a new module, [`tkinter.ttk`](../library/tkinter.ttk.html#module-tkinter.ttk "tkinter.ttk: Tk themed widget set") for access to the Tk themed widget set.
The basic idea of ttk is to separate, to the extent possible, the code
implementing a widget’s behavior from the code implementing its appearance.

(Contributed by Guilherme Polo; [bpo\-2983](https://bugs.python.org/issue?@action=redirect&bpo=2983).)
* The [`gzip.GzipFile`](../library/gzip.html#gzip.GzipFile "gzip.GzipFile") and [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") classes now support
the context management protocol:

\`\`\`
\>\>\> \# Automatically close file after writing
\>\>\> with gzip.GzipFile(filename, "wb") as f:
... f.write(b"xxx")

\`\`\`

(Contributed by Antoine Pitrou.)
* The [`decimal`](../library/decimal.html#module-decimal "decimal: Implementation of the General Decimal Arithmetic  Specification.") module now supports methods for creating a
decimal object from a binary [`float`](../library/functions.html#float "float"). The conversion is
exact but can sometimes be surprising:

\`\`\`
\>\>\> Decimal.from\_float(1\.1\)
Decimal('1\.100000000000000088817841970012523233890533447265625')

\`\`\`

The long decimal result shows the actual binary fraction being
stored for *1\.1*. The fraction has many digits because *1\.1* cannot
be exactly represented in binary.

(Contributed by Raymond Hettinger and Mark Dickinson.)
* The [`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping.") module grew two new functions. The
[`itertools.combinations_with_replacement()`](../library/itertools.html#itertools.combinations_with_replacement "itertools.combinations_with_replacement") function is one of
four for generating combinatorics including permutations and Cartesian
products. The [`itertools.compress()`](../library/itertools.html#itertools.compress "itertools.compress") function mimics its namesake
from APL. Also, the existing [`itertools.count()`](../library/itertools.html#itertools.count "itertools.count") function now has
an optional *step* argument and can accept any type of counting
sequence including [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") and
[`decimal.Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal"):

\`\`\`
\>\>\> \[p\+q for p,q in combinations\_with\_replacement('LOVE', 2\)]
\['LL', 'LO', 'LV', 'LE', 'OO', 'OV', 'OE', 'VV', 'VE', 'EE']

\>\>\> list(compress(data=range(10\), selectors=\[0,0,1,1,0,1,0,1,0,0]))
\[2, 3, 5, 7]

\>\>\> c = count(start=Fraction(1,2\), step=Fraction(1,6\))
\>\>\> \[next(c), next(c), next(c), next(c)]
\[Fraction(1, 2\), Fraction(2, 3\), Fraction(5, 6\), Fraction(1, 1\)]

\`\`\`

(Contributed by Raymond Hettinger.)
* [`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") now supports a keyword argument
*rename* which lets invalid fieldnames be automatically converted to
positional names in the form \_0, \_1, etc. This is useful when
the field names are being created by an external source such as a
CSV header, SQL field list, or user input:

\`\`\`
\>\>\> query = input()
SELECT region, dept, count(\*) FROM main GROUPBY region, dept

\>\>\> cursor.execute(query)
\>\>\> query\_fields = \[desc\[0] for desc in cursor.description]
\>\>\> UserQuery = namedtuple('UserQuery', query\_fields, rename=True)
\>\>\> pprint.pprint(\[UserQuery(\*row) for row in cursor])
\[UserQuery(region='South', dept='Shipping', \_2=185\),
 UserQuery(region='North', dept='Accounting', \_2=37\),
 UserQuery(region='West', dept='Sales', \_2=419\)]

\`\`\`

(Contributed by Raymond Hettinger; [bpo\-1818](https://bugs.python.org/issue?@action=redirect&bpo=1818).)
* The [`re.sub()`](../library/re.html#re.sub "re.sub"), [`re.subn()`](../library/re.html#re.subn "re.subn") and [`re.split()`](../library/re.html#re.split "re.split") functions now
accept a flags parameter.

(Contributed by Gregory Smith.)
* The [`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications.") module now implements a simple [`logging.NullHandler`](../library/logging.handlers.html#logging.NullHandler "logging.NullHandler")
class for applications that are not using logging but are calling
library code that does. Setting\-up a null handler will suppress
spurious warnings such as “No handlers could be found for logger foo”:

\`\`\`
\>\>\> h = logging.NullHandler()
\>\>\> logging.getLogger("foo").addHandler(h)

\`\`\`

(Contributed by Vinay Sajip; [bpo\-4384](https://bugs.python.org/issue?@action=redirect&bpo=4384)).
* The [`runpy`](../library/runpy.html#module-runpy "runpy: Locate and run Python modules without importing them first.") module which supports the `-m` command line switch
now supports the execution of packages by looking for and executing
a `__main__` submodule when a package name is supplied.

(Contributed by Andi Vajda; [bpo\-4195](https://bugs.python.org/issue?@action=redirect&bpo=4195).)
* The [`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters.") module can now access and display source code loaded via
[`zipimport`](../library/zipimport.html#module-zipimport "zipimport: Support for importing Python modules from ZIP archives.") (or any other conformant [**PEP 302**](https://peps.python.org/pep-0302/) loader).

(Contributed by Alexander Belopolsky; [bpo\-4201](https://bugs.python.org/issue?@action=redirect&bpo=4201).)
* [`functools.partial`](../library/functools.html#functools.partial "functools.partial") objects can now be pickled.

> (Suggested by Antoine Pitrou and Jesse Noller. Implemented by
> Jack Diederich; [bpo\-5228](https://bugs.python.org/issue?@action=redirect&bpo=5228).)

* Add [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") help topics for symbols so that `help('@')`
works as expected in the interactive environment.

(Contributed by David Laban; [bpo\-4739](https://bugs.python.org/issue?@action=redirect&bpo=4739).)
* The [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") module now supports skipping individual tests or classes
of tests. And it supports marking a test as an expected failure, a test that
is known to be broken, but shouldn’t be counted as a failure on a
TestResult:

\`\`\`
class TestGizmo(unittest.TestCase):

 @unittest.skipUnless(sys.platform.startswith("win"), "requires Windows")
 def test\_gizmo\_on\_windows(self):
 ...

 @unittest.expectedFailure
 def test\_gimzo\_without\_required\_library(self):
 ...

\`\`\`

Also, tests for exceptions have been builtout to work with context managers
using the [`with`](../reference/compound_stmts.html#with) statement:

\`\`\`
def test\_division\_by\_zero(self):
 with self.assertRaises(ZeroDivisionError):
 x / 0

\`\`\`

In addition, several new assertion methods were added including
[`assertSetEqual()`](../library/unittest.html#unittest.TestCase.assertSetEqual "unittest.TestCase.assertSetEqual"),
[`assertDictEqual()`](../library/unittest.html#unittest.TestCase.assertDictEqual "unittest.TestCase.assertDictEqual"),
`assertDictContainsSubset()`,
[`assertListEqual()`](../library/unittest.html#unittest.TestCase.assertListEqual "unittest.TestCase.assertListEqual"),
[`assertTupleEqual()`](../library/unittest.html#unittest.TestCase.assertTupleEqual "unittest.TestCase.assertTupleEqual"),
[`assertSequenceEqual()`](../library/unittest.html#unittest.TestCase.assertSequenceEqual "unittest.TestCase.assertSequenceEqual"),
[`assertRaisesRegexp()`](../library/unittest.html#unittest.TestCase.assertRaisesRegex "unittest.TestCase.assertRaisesRegex"),
[`assertIsNone()`](../library/unittest.html#unittest.TestCase.assertIsNone "unittest.TestCase.assertIsNone"),
and [`assertIsNotNone()`](../library/unittest.html#unittest.TestCase.assertIsNotNone "unittest.TestCase.assertIsNotNone").

(Contributed by Benjamin Peterson and Antoine Pitrou.)
* The [`io`](../library/io.html#module-io "io: Core tools for working with streams.") module has three new constants for the [`seek()`](../library/io.html#io.IOBase.seek "io.IOBase.seek")
method: [`SEEK_SET`](../library/os.html#os.SEEK_SET "os.SEEK_SET"), [`SEEK_CUR`](../library/os.html#os.SEEK_CUR "os.SEEK_CUR"), and [`SEEK_END`](../library/os.html#os.SEEK_END "os.SEEK_END").
* The [`sys.version_info`](../library/sys.html#sys.version_info "sys.version_info") tuple is now a named tuple:

\`\`\`
\>\>\> sys.version\_info
sys.version\_info(major=3, minor=1, micro=0, releaselevel='alpha', serial=2\)

\`\`\`

(Contributed by Ross Light; [bpo\-4285](https://bugs.python.org/issue?@action=redirect&bpo=4285).)
* The `nntplib` and [`imaplib`](../library/imaplib.html#module-imaplib "imaplib: IMAP4 protocol client (requires sockets).") modules now support IPv6\.

(Contributed by Derek Morr; [bpo\-1655](https://bugs.python.org/issue?@action=redirect&bpo=1655) and [bpo\-1664](https://bugs.python.org/issue?@action=redirect&bpo=1664).)
* The [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") module has been adapted for better interoperability with
Python 2\.x when used with protocol 2 or lower. The reorganization of the
standard library changed the formal reference for many objects. For
example, `__builtin__.set` in Python 2 is called `builtins.set` in Python
3\. This change confounded efforts to share data between different versions of
Python. But now when protocol 2 or lower is selected, the pickler will
automatically use the old Python 2 names for both loading and dumping. This
remapping is turned\-on by default but can be disabled with the *fix\_imports*
option:

\`\`\`
\>\>\> s = {1, 2, 3}
\>\>\> pickle.dumps(s, protocol=0\)
b'c\_\_builtin\_\_\\nset\\np0\\n((lp1\\nL1L\\naL2L\\naL3L\\natp2\\nRp3\\n.'
\>\>\> pickle.dumps(s, protocol=0, fix\_imports=False)
b'cbuiltins\\nset\\np0\\n((lp1\\nL1L\\naL2L\\naL3L\\natp2\\nRp3\\n.'

\`\`\`

An unfortunate but unavoidable side\-effect of this change is that protocol 2
pickles produced by Python 3\.1 won’t be readable with Python 3\.0\. The latest
pickle protocol, protocol 3, should be used when migrating data between
Python 3\.x implementations, as it doesn’t attempt to remain compatible with
Python 2\.x.

(Contributed by Alexandre Vassalotti and Antoine Pitrou, [bpo\-6137](https://bugs.python.org/issue?@action=redirect&bpo=6137).)
* A new module, [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") was added. It provides a complete, portable,
pure Python reference implementation of the [`import`](../reference/simple_stmts.html#import) statement and its
counterpart, the [`__import__()`](../library/functions.html#import__ "__import__") function. It represents a substantial
step forward in documenting and defining the actions that take place during
imports.

(Contributed by Brett Cannon.)

## Optimizations[¶](#optimizations "Link to this heading")

Major performance enhancements have been added:

* The new I/O library (as defined in [**PEP 3116**](https://peps.python.org/pep-3116/)) was mostly written in
Python and quickly proved to be a problematic bottleneck in Python 3\.0\.
In Python 3\.1, the I/O library has been entirely rewritten in C and is
2 to 20 times faster depending on the task at hand. The pure Python
version is still available for experimentation purposes through
the `_pyio` module.

(Contributed by Amaury Forgeot d’Arc and Antoine Pitrou.)
* Added a heuristic so that tuples and dicts containing only untrackable objects
are not tracked by the garbage collector. This can reduce the size of
collections and therefore the garbage collection overhead on long\-running
programs, depending on their particular use of datatypes.

(Contributed by Antoine Pitrou, [bpo\-4688](https://bugs.python.org/issue?@action=redirect&bpo=4688).)
* Enabling a configure option named `--with-computed-gotos`
on compilers that support it (notably: gcc, SunPro, icc), the bytecode
evaluation loop is compiled with a new dispatch mechanism which gives
speedups of up to 20%, depending on the system, the compiler, and
the benchmark.

(Contributed by Antoine Pitrou along with a number of other participants,
[bpo\-4753](https://bugs.python.org/issue?@action=redirect&bpo=4753)).
* The decoding of UTF\-8, UTF\-16 and LATIN\-1 is now two to four times
faster.

(Contributed by Antoine Pitrou and Amaury Forgeot d’Arc, [bpo\-4868](https://bugs.python.org/issue?@action=redirect&bpo=4868).)
* The [`json`](../library/json.html#module-json "json: Encode and decode the JSON format.") module now has a C extension to substantially improve
its performance. In addition, the API was modified so that json works
only with [`str`](../library/stdtypes.html#str "str"), not with [`bytes`](../library/stdtypes.html#bytes "bytes"). That change makes the
module closely match the [JSON specification](https://json.org/)
which is defined in terms of Unicode.

(Contributed by Bob Ippolito and converted to Py3\.1 by Antoine Pitrou
and Benjamin Peterson; [bpo\-4136](https://bugs.python.org/issue?@action=redirect&bpo=4136).)
* Unpickling now interns the attribute names of pickled objects. This saves
memory and allows pickles to be smaller.

(Contributed by Jake McGuire and Antoine Pitrou; [bpo\-5084](https://bugs.python.org/issue?@action=redirect&bpo=5084).)

## IDLE[¶](#idle "Link to this heading")

* IDLE’s format menu now provides an option to strip trailing whitespace
from a source file.

(Contributed by Roger D. Serwy; [bpo\-5150](https://bugs.python.org/issue?@action=redirect&bpo=5150).)

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

Changes to Python’s build process and to the C API include:

* Integers are now stored internally either in base `2**15` or in base
`2**30`, the base being determined at build time. Previously, they
were always stored in base `2**15`. Using base `2**30` gives
significant performance improvements on 64\-bit machines, but
benchmark results on 32\-bit machines have been mixed. Therefore,
the default is to use base `2**30` on 64\-bit machines and base `2**15`
on 32\-bit machines; on Unix, there’s a new configure option
`--enable-big-digits` that can be used to override this default.

Apart from the performance improvements this change should be invisible to
end users, with one exception: for testing and debugging purposes there’s a
new [`sys.int_info`](../library/sys.html#sys.int_info "sys.int_info") that provides information about the
internal format, giving the number of bits per digit and the size in bytes
of the C type used to store each digit:

\`\`\`
\>\>\> import sys
\>\>\> sys.int\_info
sys.int\_info(bits\_per\_digit=30, sizeof\_digit=4\)

\`\`\`

(Contributed by Mark Dickinson; [bpo\-4258](https://bugs.python.org/issue?@action=redirect&bpo=4258).)
* The [`PyLong_AsUnsignedLongLong()`](../c-api/long.html#c.PyLong_AsUnsignedLongLong "PyLong_AsUnsignedLongLong") function now handles a negative
*pylong* by raising [`OverflowError`](../library/exceptions.html#OverflowError "OverflowError") instead of [`TypeError`](../library/exceptions.html#TypeError "TypeError").

(Contributed by Mark Dickinson and Lisandro Dalcrin; [bpo\-5175](https://bugs.python.org/issue?@action=redirect&bpo=5175).)
* Deprecated `PyNumber_Int()`. Use [`PyNumber_Long()`](../c-api/number.html#c.PyNumber_Long "PyNumber_Long") instead.

(Contributed by Mark Dickinson; [bpo\-4910](https://bugs.python.org/issue?@action=redirect&bpo=4910).)
* Added a new [`PyOS_string_to_double()`](../c-api/conversion.html#c.PyOS_string_to_double "PyOS_string_to_double") function to replace the
deprecated functions `PyOS_ascii_strtod()` and `PyOS_ascii_atof()`.

(Contributed by Mark Dickinson; [bpo\-5914](https://bugs.python.org/issue?@action=redirect&bpo=5914).)
* Added [`PyCapsule`](../c-api/capsule.html#c.PyCapsule "PyCapsule") as a replacement for the `PyCObject` API.
The principal difference is that the new type has a well defined interface
for passing typing safety information and a less complicated signature
for calling a destructor. The old type had a problematic API and is now
deprecated.

(Contributed by Larry Hastings; [bpo\-5630](https://bugs.python.org/issue?@action=redirect&bpo=5630).)

## Porting to Python 3\.1[¶](#porting-to-python-3-1 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code:

* The new floating\-point string representations can break existing doctests.
For example:

\`\`\`
def e():
 '''Compute the base of natural logarithms.

 \>\>\> e()
 2\.7182818284590451

 '''
 return sum(1/math.factorial(x) for x in reversed(range(30\)))

doctest.testmod()

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Failed example:
 e()
Expected:
 2\.7182818284590451
Got:
 2\.718281828459045
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

\`\`\`
* The automatic name remapping in the pickle module for protocol 2 or lower can
make Python 3\.1 pickles unreadable in Python 3\.0\. One solution is to use
protocol 3\. Another solution is to set the *fix\_imports* option to `False`.
See the discussion above for more details.

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.1](#)
	+ [PEP 372: Ordered Dictionaries](#pep-372-ordered-dictionaries)
	+ [PEP 378: Format Specifier for Thousands Separator](#pep-378-format-specifier-for-thousands-separator)
	+ [Other Language Changes](#other-language-changes)
	+ [New, Improved, and Deprecated Modules](#new-improved-and-deprecated-modules)
	+ [Optimizations](#optimizations)
	+ [IDLE](#idle)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Porting to Python 3\.1](#porting-to-python-3-1)

#### Previous topic

[What’s New In Python 3\.2](3.2.html "previous chapter")

#### Next topic

[What’s New In Python 3\.0](3.0.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.1.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.0.html "What’s New In Python 3.0") \|
* [previous](3.2.html "What’s New In Python 3.2") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.1
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.10 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.10.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.9.html "What’s New In Python 3.9") \|
* [previous](3.11.html "What’s New In Python 3.11") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.10
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.10[¶](#what-s-new-in-python-3-10 "Link to this heading")

Editor:
Pablo Galindo Salgado

This article explains the new features in Python 3\.10, compared to 3\.9\.
Python 3\.10 was released on October 4, 2021\.
For full details, see the [changelog](changelog.html#changelog).

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* [**PEP 634**](https://peps.python.org/pep-0634/), Structural Pattern Matching: Specification
* [**PEP 635**](https://peps.python.org/pep-0635/), Structural Pattern Matching: Motivation and Rationale
* [**PEP 636**](https://peps.python.org/pep-0636/), Structural Pattern Matching: Tutorial
* [bpo\-12782](https://bugs.python.org/issue?@action=redirect&bpo=12782), Parenthesized context managers are now officially allowed.

New features in the standard library:

* [**PEP 618**](https://peps.python.org/pep-0618/), Add Optional Length\-Checking To zip.

Interpreter improvements:

* [**PEP 626**](https://peps.python.org/pep-0626/), Precise line numbers for debugging and other tools.

New typing features:

* [**PEP 604**](https://peps.python.org/pep-0604/), Allow writing union types as X \| Y
* [**PEP 612**](https://peps.python.org/pep-0612/), Parameter Specification Variables
* [**PEP 613**](https://peps.python.org/pep-0613/), Explicit Type Aliases
* [**PEP 647**](https://peps.python.org/pep-0647/), User\-Defined Type Guards

Important deprecations, removals or restrictions:

* [**PEP 644**](https://peps.python.org/pep-0644/), Require OpenSSL 1\.1\.1 or newer
* [**PEP 632**](https://peps.python.org/pep-0632/), Deprecate distutils module.
* [**PEP 623**](https://peps.python.org/pep-0623/), Deprecate and prepare for the removal of the wstr member in PyUnicodeObject.
* [**PEP 624**](https://peps.python.org/pep-0624/), Remove Py\_UNICODE encoder APIs
* [**PEP 597**](https://peps.python.org/pep-0597/), Add optional EncodingWarning

## New Features[¶](#new-features "Link to this heading")

### Parenthesized context managers[¶](#parenthesized-context-managers "Link to this heading")

Using enclosing parentheses for continuation across multiple lines
in context managers is now supported. This allows formatting a long
collection of context managers in multiple lines in a similar way
as it was previously possible with import statements. For instance,
all these examples are now valid:

\`\`\`
with (CtxManager() as example):
 ...

with (
 CtxManager1(),
 CtxManager2()
):
 ...

with (CtxManager1() as example,
 CtxManager2()):
 ...

with (CtxManager1(),
 CtxManager2() as example):
 ...

with (
 CtxManager1() as example1,
 CtxManager2() as example2
):
 ...

\`\`\`

it is also possible to use a trailing comma at the end of the
enclosed group:

\`\`\`
with (
 CtxManager1() as example1,
 CtxManager2() as example2,
 CtxManager3() as example3,
):
 ...

\`\`\`

This new syntax uses the non LL(1\) capacities of the new parser.
Check [**PEP 617**](https://peps.python.org/pep-0617/) for more details.

(Contributed by Guido van Rossum, Pablo Galindo and Lysandros Nikolaou
in [bpo\-12782](https://bugs.python.org/issue?@action=redirect&bpo=12782) and [bpo\-40334](https://bugs.python.org/issue?@action=redirect&bpo=40334).)

### Better error messages[¶](#better-error-messages "Link to this heading")

#### SyntaxErrors[¶](#syntaxerrors "Link to this heading")

When parsing code that contains unclosed parentheses or brackets the interpreter
now includes the location of the unclosed bracket of parentheses instead of displaying
*SyntaxError: unexpected EOF while parsing* or pointing to some incorrect location.
For instance, consider the following code (notice the unclosed ‘{‘):

\`\`\`
expected = {9: 1, 18: 2, 19: 2, 27: 3, 28: 3, 29: 3, 36: 4, 37: 4,
 38: 4, 39: 4, 45: 5, 46: 5, 47: 5, 48: 5, 49: 5, 54: 6,
some\_other\_code = foo()

\`\`\`

Previous versions of the interpreter reported confusing places as the location of
the syntax error:

\`\`\`
File "example.py", line 3
 some\_other\_code = foo()
 ^
SyntaxError: invalid syntax

\`\`\`

but in Python 3\.10 a more informative error is emitted:

\`\`\`
File "example.py", line 1
 expected = {9: 1, 18: 2, 19: 2, 27: 3, 28: 3, 29: 3, 36: 4, 37: 4,
 ^
SyntaxError: '{' was never closed

\`\`\`

In a similar way, errors involving unclosed string literals (single and triple
quoted) now point to the start of the string instead of reporting EOF/EOL.

These improvements are inspired by previous work in the PyPy interpreter.

(Contributed by Pablo Galindo in [bpo\-42864](https://bugs.python.org/issue?@action=redirect&bpo=42864) and Batuhan Taskaya in
[bpo\-40176](https://bugs.python.org/issue?@action=redirect&bpo=40176).)

[`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") exceptions raised by the interpreter will now highlight the
full error range of the expression that constitutes the syntax error itself,
instead of just where the problem is detected. In this way, instead of displaying
(before Python 3\.10\):

\`\`\`
\>\>\> foo(x, z for z in range(10\), t, w)
 File "\", line 1
 foo(x, z for z in range(10\), t, w)
 ^
SyntaxError: Generator expression must be parenthesized

\`\`\`

now Python 3\.10 will display the exception as:

\`\`\`
\>\>\> foo(x, z for z in range(10\), t, w)
 File "\", line 1
 foo(x, z for z in range(10\), t, w)
 ^^^^^^^^^^^^^^^^^^^^
SyntaxError: Generator expression must be parenthesized

\`\`\`

This improvement was contributed by Pablo Galindo in [bpo\-43914](https://bugs.python.org/issue?@action=redirect&bpo=43914).

A considerable amount of new specialized messages for [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") exceptions
have been incorporated. Some of the most notable ones are as follows:

* Missing `:` before blocks:

\`\`\`
\>\>\> if rocket.position \> event\_horizon
 File "\", line 1
 if rocket.position \> event\_horizon
 ^
SyntaxError: expected ':'

\`\`\`

(Contributed by Pablo Galindo in [bpo\-42997](https://bugs.python.org/issue?@action=redirect&bpo=42997).)
* Unparenthesised tuples in comprehensions targets:

\`\`\`
\>\>\> {x,y for x,y in zip('abcd', '1234')}
 File "\", line 1
 {x,y for x,y in zip('abcd', '1234')}
 ^
SyntaxError: did you forget parentheses around the comprehension target?

\`\`\`

(Contributed by Pablo Galindo in [bpo\-43017](https://bugs.python.org/issue?@action=redirect&bpo=43017).)
* Missing commas in collection literals and between expressions:

\`\`\`
\>\>\> items = {
... x: 1,
... y: 2
... z: 3,
 File "\", line 3
 y: 2
 ^
SyntaxError: invalid syntax. Perhaps you forgot a comma?

\`\`\`

(Contributed by Pablo Galindo in [bpo\-43822](https://bugs.python.org/issue?@action=redirect&bpo=43822).)
* Multiple Exception types without parentheses:

\`\`\`
\>\>\> try:
... build\_dyson\_sphere()
... except NotEnoughScienceError, NotEnoughResourcesError:
 File "\", line 3
 except NotEnoughScienceError, NotEnoughResourcesError:
 ^
SyntaxError: multiple exception types must be parenthesized

\`\`\`

(Contributed by Pablo Galindo in [bpo\-43149](https://bugs.python.org/issue?@action=redirect&bpo=43149).)
* Missing `:` and values in dictionary literals:

\`\`\`
\>\>\> values = {
... x: 1,
... y: 2,
... z:
... }
 File "\", line 4
 z:
 ^
SyntaxError: expression expected after dictionary key and ':'

\>\>\> values = {x:1, y:2, z w:3}
 File "\", line 1
 values = {x:1, y:2, z w:3}
 ^
SyntaxError: ':' expected after dictionary key

\`\`\`

(Contributed by Pablo Galindo in [bpo\-43823](https://bugs.python.org/issue?@action=redirect&bpo=43823).)
* `try` blocks without `except` or `finally` blocks:

\`\`\`
\>\>\> try:
... x = 2
... something = 3
 File "\", line 3
 something = 3
 ^^^^^^^^^
SyntaxError: expected 'except' or 'finally' block

\`\`\`

(Contributed by Pablo Galindo in [bpo\-44305](https://bugs.python.org/issue?@action=redirect&bpo=44305).)
* Usage of `=` instead of `==` in comparisons:

\`\`\`
\>\>\> if rocket.position = event\_horizon:
 File "\", line 1
 if rocket.position = event\_horizon:
 ^
SyntaxError: cannot assign to attribute here. Maybe you meant '==' instead of '='?

\`\`\`

(Contributed by Pablo Galindo in [bpo\-43797](https://bugs.python.org/issue?@action=redirect&bpo=43797).)
* Usage of `*` in f\-strings:

\`\`\`
\>\>\> f"Black holes {\*all\_black\_holes} and revelations"
 File "\", line 1
 (\*all\_black\_holes)
 ^
SyntaxError: f\-string: cannot use starred expression here

\`\`\`

(Contributed by Pablo Galindo in [bpo\-41064](https://bugs.python.org/issue?@action=redirect&bpo=41064).)

#### IndentationErrors[¶](#indentationerrors "Link to this heading")

Many [`IndentationError`](../library/exceptions.html#IndentationError "IndentationError") exceptions now have more context regarding what kind of block
was expecting an indentation, including the location of the statement:

\`\`\`
\>\>\> def foo():
... if lel:
... x = 2
 File "\", line 3
 x = 2
 ^
IndentationError: expected an indented block after 'if' statement in line 2

\`\`\`

#### AttributeErrors[¶](#attributeerrors "Link to this heading")

When printing [`AttributeError`](../library/exceptions.html#AttributeError "AttributeError"), `PyErr_Display()` will offer
suggestions of similar attribute names in the object that the exception was
raised from:

\`\`\`
\>\>\> collections.namedtoplo
Traceback (most recent call last):
 File "\", line 1, in \
AttributeError: module 'collections' has no attribute 'namedtoplo'. Did you mean: namedtuple?

\`\`\`

(Contributed by Pablo Galindo in [bpo\-38530](https://bugs.python.org/issue?@action=redirect&bpo=38530).)

Warning

Notice this won’t work if `PyErr_Display()` is not called to display the error
which can happen if some other custom error display function is used. This is a common
scenario in some REPLs like IPython.

#### NameErrors[¶](#nameerrors "Link to this heading")

When printing [`NameError`](../library/exceptions.html#NameError "NameError") raised by the interpreter, `PyErr_Display()`
will offer suggestions of similar variable names in the function that the exception
was raised from:

\`\`\`
\>\>\> schwarzschild\_black\_hole = None
\>\>\> schwarschild\_black\_hole
Traceback (most recent call last):
 File "\", line 1, in \
NameError: name 'schwarschild\_black\_hole' is not defined. Did you mean: schwarzschild\_black\_hole?

\`\`\`

(Contributed by Pablo Galindo in [bpo\-38530](https://bugs.python.org/issue?@action=redirect&bpo=38530).)

Warning

Notice this won’t work if `PyErr_Display()` is not called to display the error,
which can happen if some other custom error display function is used. This is a common
scenario in some REPLs like IPython.

### PEP 626: Precise line numbers for debugging and other tools[¶](#pep-626-precise-line-numbers-for-debugging-and-other-tools "Link to this heading")

PEP 626 brings more precise and reliable line numbers for debugging, profiling and coverage tools.
Tracing events, with the correct line number, are generated for all lines of code executed and only for lines of code that are executed.

The [`f_lineno`](../reference/datamodel.html#frame.f_lineno "frame.f_lineno") attribute of frame objects will always contain the
expected line number.

The [`co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab") attribute of
[code objects](../reference/datamodel.html#code-objects) is deprecated and
will be removed in 3\.12\.
Code that needs to convert from offset to line number should use the new
[`co_lines()`](../reference/datamodel.html#codeobject.co_lines "codeobject.co_lines") method instead.

### PEP 634: Structural Pattern Matching[¶](#pep-634-structural-pattern-matching "Link to this heading")

Structural pattern matching has been added in the form of a *match statement*
and *case statements* of patterns with associated actions. Patterns
consist of sequences, mappings, primitive data types as well as class instances.
Pattern matching enables programs to extract information from complex data types,
branch on the structure of data, and apply specific actions based on different
forms of data.

#### Syntax and operations[¶](#syntax-and-operations "Link to this heading")

The generic syntax of pattern matching is:

\`\`\`
match subject:
 case \:
 \
 case \:
 \
 case \:
 \
 case \_:
 \

\`\`\`

A match statement takes an expression and compares its value to successive
patterns given as one or more case blocks. Specifically, pattern matching
operates by:

1. using data with type and shape (the `subject`)
2. evaluating the `subject` in the `match` statement
3. comparing the subject with each pattern in a `case` statement
from top to bottom until a match is confirmed.
4. executing the action associated with the pattern of the confirmed
match
5. If an exact match is not confirmed, the last case, a wildcard `_`,
if provided, will be used as the matching case. If an exact match is
not confirmed and a wildcard case does not exist, the entire match
block is a no\-op.

#### Declarative approach[¶](#declarative-approach "Link to this heading")

Readers may be aware of pattern matching through the simple example of matching
a subject (data object) to a literal (pattern) with the switch statement found
in C, Java or JavaScript (and many other languages). Often the switch statement
is used for comparison of an object/expression with case statements containing
literals.

More powerful examples of pattern matching can be found in languages such as
Scala and Elixir. With structural pattern matching, the approach is “declarative” and
explicitly states the conditions (the patterns) for data to match.

While an “imperative” series of instructions using nested “if” statements
could be used to accomplish something similar to structural pattern matching,
it is less clear than the “declarative” approach. Instead the “declarative”
approach states the conditions to meet for a match and is more readable through
its explicit patterns. While structural pattern matching can be used in its
simplest form comparing a variable to a literal in a case statement, its
true value for Python lies in its handling of the subject’s type and shape.

#### Simple pattern: match to a literal[¶](#simple-pattern-match-to-a-literal "Link to this heading")

Let’s look at this example as pattern matching in its simplest form: a value,
the subject, being matched to several literals, the patterns. In the example
below, `status` is the subject of the match statement. The patterns are
each of the case statements, where literals represent request status codes.
The associated action to the case is executed after a match:

\`\`\`
def http\_error(status):
 match status:
 case 400:
 return "Bad request"
 case 404:
 return "Not found"
 case 418:
 return "I'm a teapot"
 case \_:
 return "Something's wrong with the internet"

\`\`\`

If the above function is passed a `status` of 418, “I’m a teapot” is returned.
If the above function is passed a `status` of 500, the case statement with
`_` will match as a wildcard, and “Something’s wrong with the internet” is
returned.
Note the last block: the variable name, `_`, acts as a *wildcard* and insures
the subject will always match. The use of `_` is optional.

You can combine several literals in a single pattern using `|` (“or”):

\`\`\`
case 401 \| 403 \| 404:
 return "Not allowed"

\`\`\`

##### Behavior without the wildcard[¶](#behavior-without-the-wildcard "Link to this heading")

If we modify the above example by removing the last case block, the example
becomes:

\`\`\`
def http\_error(status):
 match status:
 case 400:
 return "Bad request"
 case 404:
 return "Not found"
 case 418:
 return "I'm a teapot"

\`\`\`

Without the use of `_` in a case statement, a match may not exist. If no
match exists, the behavior is a no\-op. For example, if `status` of 500 is
passed, a no\-op occurs.

#### Patterns with a literal and variable[¶](#patterns-with-a-literal-and-variable "Link to this heading")

Patterns can look like unpacking assignments, and a pattern may be used to bind
variables. In this example, a data point can be unpacked to its x\-coordinate
and y\-coordinate:

\`\`\`
\# point is an (x, y) tuple
match point:
 case (0, 0\):
 print("Origin")
 case (0, y):
 print(f"Y={y}")
 case (x, 0\):
 print(f"X={x}")
 case (x, y):
 print(f"X={x}, Y={y}")
 case \_:
 raise ValueError("Not a point")

\`\`\`

The first pattern has two literals, `(0, 0)`, and may be thought of as an
extension of the literal pattern shown above. The next two patterns combine a
literal and a variable, and the variable *binds* a value from the subject
(`point`). The fourth pattern captures two values, which makes it
conceptually similar to the unpacking assignment `(x, y) = point`.

#### Patterns and classes[¶](#patterns-and-classes "Link to this heading")

If you are using classes to structure your data, you can use as a pattern
the class name followed by an argument list resembling a constructor. This
pattern has the ability to capture class attributes into variables:

\`\`\`
class Point:
 x: int
 y: int

def location(point):
 match point:
 case Point(x=0, y=0\):
 print("Origin is the point's location.")
 case Point(x=0, y=y):
 print(f"Y={y} and the point is on the y\-axis.")
 case Point(x=x, y=0\):
 print(f"X={x} and the point is on the x\-axis.")
 case Point():
 print("The point is located somewhere else on the plane.")
 case \_:
 print("Not a point")

\`\`\`

##### Patterns with positional parameters[¶](#patterns-with-positional-parameters "Link to this heading")

You can use positional parameters with some builtin classes that provide an
ordering for their attributes (e.g. dataclasses). You can also define a specific
position for attributes in patterns by setting the `__match_args__` special
attribute in your classes. If it’s set to (“x”, “y”), the following patterns
are all equivalent (and all bind the `y` attribute to the `var` variable):

\`\`\`
Point(1, var)
Point(1, y=var)
Point(x=1, y=var)
Point(y=var, x=1\)

\`\`\`

#### Nested patterns[¶](#nested-patterns "Link to this heading")

Patterns can be arbitrarily nested. For example, if our data is a short
list of points, it could be matched like this:

\`\`\`
match points:
 case \[]:
 print("No points in the list.")
 case \[Point(0, 0\)]:
 print("The origin is the only point in the list.")
 case \[Point(x, y)]:
 print(f"A single point {x}, {y} is in the list.")
 case \[Point(0, y1\), Point(0, y2\)]:
 print(f"Two points on the Y axis at {y1}, {y2} are in the list.")
 case \_:
 print("Something else is found in the list.")

\`\`\`

#### Complex patterns and the wildcard[¶](#complex-patterns-and-the-wildcard "Link to this heading")

To this point, the examples have used `_` alone in the last case statement.
A wildcard can be used in more complex patterns, such as `('error', code, _)`.
For example:

\`\`\`
match test\_variable:
 case ('warning', code, 40\):
 print("A warning has been received.")
 case ('error', code, \_):
 print(f"An error {code} occurred.")

\`\`\`

In the above case, `test_variable` will match for (‘error’, code, 100\) and
(‘error’, code, 800\).

#### Guard[¶](#guard "Link to this heading")

We can add an `if` clause to a pattern, known as a “guard”. If the
guard is false, `match` goes on to try the next case block. Note
that value capture happens before the guard is evaluated:

\`\`\`
match point:
 case Point(x, y) if x == y:
 print(f"The point is located on the diagonal Y=X at {x}.")
 case Point(x, y):
 print(f"Point is not on the diagonal.")

\`\`\`

#### Other Key Features[¶](#other-key-features "Link to this heading")

Several other key features:

* Like unpacking assignments, tuple and list patterns have exactly the
same meaning and actually match arbitrary sequences. Technically,
the subject must be a sequence.
Therefore, an important exception is that patterns don’t match iterators.
Also, to prevent a common mistake, sequence patterns don’t match strings.
* Sequence patterns support wildcards: `[x, y, *rest]` and `(x, y,
*rest)` work similar to wildcards in unpacking assignments. The
name after `*` may also be `_`, so `(x, y, *_)` matches a sequence
of at least two items without binding the remaining items.
* Mapping patterns: `{"bandwidth": b, "latency": l}` captures the
`"bandwidth"` and `"latency"` values from a dict. Unlike sequence
patterns, extra keys are ignored. A wildcard `**rest` is also
supported. (But `**_` would be redundant, so is not allowed.)
* Subpatterns may be captured using the `as` keyword:

\`\`\`
case (Point(x1, y1\), Point(x2, y2\) as p2\): ...

\`\`\`

This binds x1, y1, x2, y2 like you would expect without the `as` clause,
and p2 to the entire second item of the subject.
* Most literals are compared by equality. However, the singletons `True`,
`False` and `None` are compared by identity.
* Named constants may be used in patterns. These named constants must be
dotted names to prevent the constant from being interpreted as a capture
variable:

\`\`\`
from enum import Enum
class Color(Enum):
 RED = 0
 GREEN = 1
 BLUE = 2

color = Color.GREEN
match color:
 case Color.RED:
 print("I see red!")
 case Color.GREEN:
 print("Grass is green")
 case Color.BLUE:
 print("I'm feeling the blues :(")

\`\`\`

For the full specification see [**PEP 634**](https://peps.python.org/pep-0634/). Motivation and rationale
are in [**PEP 635**](https://peps.python.org/pep-0635/), and a longer tutorial is in [**PEP 636**](https://peps.python.org/pep-0636/).

### Optional `EncodingWarning` and `encoding="locale"` option[¶](#optional-encodingwarning-and-encoding-locale-option "Link to this heading")

The default encoding of [`TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") and [`open()`](../library/functions.html#open "open") is
platform and locale dependent. Since UTF\-8 is used on most Unix
platforms, omitting `encoding` option when opening UTF\-8 files
(e.g. JSON, YAML, TOML, Markdown) is a very common bug. For example:

\`\`\`
\# BUG: "rb" mode or encoding="utf\-8" should be used.
with open("data.json") as f:
 data = json.load(f)

\`\`\`

To find this type of bug, an optional `EncodingWarning` is added.
It is emitted when [`sys.flags.warn_default_encoding`](../library/sys.html#sys.flags "sys.flags")
is true and locale\-specific default encoding is used.

`-X warn_default_encoding` option and [`PYTHONWARNDEFAULTENCODING`](../using/cmdline.html#envvar-PYTHONWARNDEFAULTENCODING)
are added to enable the warning.

See [Text Encoding](../library/io.html#io-text-encoding) for more information.

## New Features Related to Type Hints[¶](#new-features-related-to-type-hints "Link to this heading")

This section covers major changes affecting [**PEP 484**](https://peps.python.org/pep-0484/) type hints and
the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module.

### PEP 604: New Type Union Operator[¶](#pep-604-new-type-union-operator "Link to this heading")

A new type union operator was introduced which enables the syntax `X | Y`.
This provides a cleaner way of expressing ‘either type X or type Y’ instead of
using [`typing.Union`](../library/typing.html#typing.Union "typing.Union"), especially in type hints.

In previous versions of Python, to apply a type hint for functions accepting
arguments of multiple types, [`typing.Union`](../library/typing.html#typing.Union "typing.Union") was used:

\`\`\`
def square(number: Union\[int, float]) \-\> Union\[int, float]:
 return number \*\* 2

\`\`\`

Type hints can now be written in a more succinct manner:

\`\`\`
def square(number: int \| float) \-\> int \| float:
 return number \*\* 2

\`\`\`

This new syntax is also accepted as the second argument to [`isinstance()`](../library/functions.html#isinstance "isinstance")
and [`issubclass()`](../library/functions.html#issubclass "issubclass"):

\`\`\`
\>\>\> isinstance(1, int \| str)
True

\`\`\`

See [Union Type](../library/stdtypes.html#types-union) and [**PEP 604**](https://peps.python.org/pep-0604/) for more details.

(Contributed by Maggie Moss and Philippe Prados in [bpo\-41428](https://bugs.python.org/issue?@action=redirect&bpo=41428),
with additions by Yurii Karabas and Serhiy Storchaka in [bpo\-44490](https://bugs.python.org/issue?@action=redirect&bpo=44490).)

### PEP 612: Parameter Specification Variables[¶](#pep-612-parameter-specification-variables "Link to this heading")

Two new options to improve the information provided to static type checkers for
[**PEP 484**](https://peps.python.org/pep-0484/)‘s `Callable` have been added to the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module.

The first is the parameter specification variable. They are used to forward the
parameter types of one callable to another callable – a pattern commonly
found in higher order functions and decorators. Examples of usage can be found
in [`typing.ParamSpec`](../library/typing.html#typing.ParamSpec "typing.ParamSpec"). Previously, there was no easy way to type annotate
dependency of parameter types in such a precise manner.

The second option is the new `Concatenate` operator. It’s used in conjunction
with parameter specification variables to type annotate a higher order callable
which adds or removes parameters of another callable. Examples of usage can
be found in [`typing.Concatenate`](../library/typing.html#typing.Concatenate "typing.Concatenate").

See [`typing.Callable`](../library/typing.html#typing.Callable "typing.Callable"), [`typing.ParamSpec`](../library/typing.html#typing.ParamSpec "typing.ParamSpec"),
[`typing.Concatenate`](../library/typing.html#typing.Concatenate "typing.Concatenate"), [`typing.ParamSpecArgs`](../library/typing.html#typing.ParamSpecArgs "typing.ParamSpecArgs"),
[`typing.ParamSpecKwargs`](../library/typing.html#typing.ParamSpecKwargs "typing.ParamSpecKwargs"), and [**PEP 612**](https://peps.python.org/pep-0612/) for more details.

(Contributed by Ken Jin in [bpo\-41559](https://bugs.python.org/issue?@action=redirect&bpo=41559), with minor enhancements by Jelle
Zijlstra in [bpo\-43783](https://bugs.python.org/issue?@action=redirect&bpo=43783). PEP written by Mark Mendoza.)

### PEP 613: TypeAlias[¶](#pep-613-typealias "Link to this heading")

[**PEP 484**](https://peps.python.org/pep-0484/) introduced the concept of type aliases, only requiring them to be
top\-level unannotated assignments. This simplicity sometimes made it difficult
for type checkers to distinguish between type aliases and ordinary assignments,
especially when forward references or invalid types were involved. Compare:

\`\`\`
StrCache = 'Cache\[str]' \# a type alias
LOG\_PREFIX = 'LOG\[DEBUG]' \# a module constant

\`\`\`

Now the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module has a special value [`TypeAlias`](../library/typing.html#typing.TypeAlias "typing.TypeAlias")
which lets you declare type aliases more explicitly:

\`\`\`
StrCache: TypeAlias = 'Cache\[str]' \# a type alias
LOG\_PREFIX = 'LOG\[DEBUG]' \# a module constant

\`\`\`

See [**PEP 613**](https://peps.python.org/pep-0613/) for more details.

(Contributed by Mikhail Golubev in [bpo\-41923](https://bugs.python.org/issue?@action=redirect&bpo=41923).)

### PEP 647: User\-Defined Type Guards[¶](#pep-647-user-defined-type-guards "Link to this heading")

[`TypeGuard`](../library/typing.html#typing.TypeGuard "typing.TypeGuard") has been added to the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module to annotate
type guard functions and improve information provided to static type checkers
during type narrowing. For more information, please see
[`TypeGuard`](../library/typing.html#typing.TypeGuard "typing.TypeGuard")‘s documentation, and [**PEP 647**](https://peps.python.org/pep-0647/).

(Contributed by Ken Jin and Guido van Rossum in [bpo\-43766](https://bugs.python.org/issue?@action=redirect&bpo=43766).
PEP written by Eric Traut.)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* The [`int`](../library/functions.html#int "int") type has a new method [`int.bit_count()`](../library/stdtypes.html#int.bit_count "int.bit_count"), returning the
number of ones in the binary expansion of a given integer, also known
as the population count. (Contributed by Niklas Fiekas in [bpo\-29882](https://bugs.python.org/issue?@action=redirect&bpo=29882).)
* The views returned by [`dict.keys()`](../library/stdtypes.html#dict.keys "dict.keys"), [`dict.values()`](../library/stdtypes.html#dict.values "dict.values") and
[`dict.items()`](../library/stdtypes.html#dict.items "dict.items") now all have a `mapping` attribute that gives a
[`types.MappingProxyType`](../library/types.html#types.MappingProxyType "types.MappingProxyType") object wrapping the original
dictionary. (Contributed by Dennis Sweeney in [bpo\-40890](https://bugs.python.org/issue?@action=redirect&bpo=40890).)
* [**PEP 618**](https://peps.python.org/pep-0618/): The [`zip()`](../library/functions.html#zip "zip") function now has an optional `strict` flag, used
to require that all the iterables have an equal length.
* Builtin and extension functions that take integer arguments no longer accept
[`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal")s, [`Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction")s and other
objects that can be converted to integers only with a loss (e.g. that have
the [`__int__()`](../reference/datamodel.html#object.__int__ "object.__int__") method but do not have the
[`__index__()`](../reference/datamodel.html#object.__index__ "object.__index__") method).
(Contributed by Serhiy Storchaka in [bpo\-37999](https://bugs.python.org/issue?@action=redirect&bpo=37999).)
* If [`object.__ipow__()`](../reference/datamodel.html#object.__ipow__ "object.__ipow__") returns [`NotImplemented`](../library/constants.html#NotImplemented "NotImplemented"), the operator will
correctly fall back to [`object.__pow__()`](../reference/datamodel.html#object.__pow__ "object.__pow__") and [`object.__rpow__()`](../reference/datamodel.html#object.__rpow__ "object.__rpow__") as expected.
(Contributed by Alex Shkop in [bpo\-38302](https://bugs.python.org/issue?@action=redirect&bpo=38302).)
* Assignment expressions can now be used unparenthesized within set literals
and set comprehensions, as well as in sequence indexes (but not slices).
* Functions have a new `__builtins__` attribute which is used to look for
builtin symbols when a function is executed, instead of looking into
`__globals__['__builtins__']`. The attribute is initialized from
`__globals__["__builtins__"]` if it exists, else from the current builtins.
(Contributed by Mark Shannon in [bpo\-42990](https://bugs.python.org/issue?@action=redirect&bpo=42990).)
* Two new builtin functions – [`aiter()`](../library/functions.html#aiter "aiter") and [`anext()`](../library/functions.html#anext "anext") have been added
to provide asynchronous counterparts to [`iter()`](../library/functions.html#iter "iter") and [`next()`](../library/functions.html#next "next"),
respectively.
(Contributed by Joshua Bronson, Daniel Pope, and Justin Wang in [bpo\-31861](https://bugs.python.org/issue?@action=redirect&bpo=31861).)
* Static methods ([`@staticmethod`](../library/functions.html#staticmethod "staticmethod")) and class methods
([`@classmethod`](../library/functions.html#classmethod "classmethod")) now inherit the method attributes
(`__module__`, `__name__`, `__qualname__`, `__doc__`,
`__annotations__`) and have a new `__wrapped__` attribute.
Moreover, static methods are now callable as regular functions.
(Contributed by Victor Stinner in [bpo\-43682](https://bugs.python.org/issue?@action=redirect&bpo=43682).)
* Annotations for complex targets (everything beside `simple name` targets
defined by [**PEP 526**](https://peps.python.org/pep-0526/)) no longer cause any runtime effects with `from __future__ import annotations`.
(Contributed by Batuhan Taskaya in [bpo\-42737](https://bugs.python.org/issue?@action=redirect&bpo=42737).)
* Class and module objects now lazy\-create empty annotations dicts on demand.
The annotations dicts are stored in the object’s `__dict__` for
backwards compatibility. This improves the best practices for working
with `__annotations__`; for more information, please see
[Annotations Best Practices](../howto/annotations.html#annotations-howto).
(Contributed by Larry Hastings in [bpo\-43901](https://bugs.python.org/issue?@action=redirect&bpo=43901).)
* Annotations consist of `yield`, `yield from`, `await` or named expressions
are now forbidden under `from __future__ import annotations` due to their side
effects.
(Contributed by Batuhan Taskaya in [bpo\-42725](https://bugs.python.org/issue?@action=redirect&bpo=42725).)
* Usage of unbound variables, `super()` and other expressions that might
alter the processing of symbol table as annotations are now rendered
effectless under `from __future__ import annotations`.
(Contributed by Batuhan Taskaya in [bpo\-42725](https://bugs.python.org/issue?@action=redirect&bpo=42725).)
* Hashes of NaN values of both [`float`](../library/functions.html#float "float") type and
[`decimal.Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal") type now depend on object identity. Formerly, they
always hashed to `0` even though NaN values are not equal to one another.
This caused potentially quadratic runtime behavior due to excessive hash
collisions when creating dictionaries and sets containing multiple NaNs.
(Contributed by Raymond Hettinger in [bpo\-43475](https://bugs.python.org/issue?@action=redirect&bpo=43475).)
* A [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") (instead of a [`NameError`](../library/exceptions.html#NameError "NameError")) will be raised when deleting
the [`__debug__`](../library/constants.html#debug__ "__debug__") constant. (Contributed by Donghee Na in [bpo\-45000](https://bugs.python.org/issue?@action=redirect&bpo=45000).)
* [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") exceptions now have `end_lineno` and
`end_offset` attributes. They will be `None` if not determined.
(Contributed by Pablo Galindo in [bpo\-43914](https://bugs.python.org/issue?@action=redirect&bpo=43914).)

## New Modules[¶](#new-modules "Link to this heading")

* None.

## Improved Modules[¶](#improved-modules "Link to this heading")

### asyncio[¶](#asyncio "Link to this heading")

Add missing `connect_accepted_socket()`
method.
(Contributed by Alex Grönholm in [bpo\-41332](https://bugs.python.org/issue?@action=redirect&bpo=41332).)

### argparse[¶](#argparse "Link to this heading")

Misleading phrase “optional arguments” was replaced with “options” in argparse help. Some tests might require adaptation if they rely on exact output match.
(Contributed by Raymond Hettinger in [bpo\-9694](https://bugs.python.org/issue?@action=redirect&bpo=9694).)

### array[¶](#array "Link to this heading")

The [`index()`](../library/array.html#array.array.index "array.array.index") method of [`array.array`](../library/array.html#array.array "array.array") now has
optional *start* and *stop* parameters.
(Contributed by Anders Lorentsen and Zackery Spytz in [bpo\-31956](https://bugs.python.org/issue?@action=redirect&bpo=31956).)

### asynchat, asyncore, smtpd[¶](#asynchat-asyncore-smtpd "Link to this heading")

These modules have been marked as deprecated in their module documentation
since Python 3\.6\. An import\-time [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") has now been
added to all three of these modules.

### base64[¶](#base64 "Link to this heading")

Add [`base64.b32hexencode()`](../library/base64.html#base64.b32hexencode "base64.b32hexencode") and [`base64.b32hexdecode()`](../library/base64.html#base64.b32hexdecode "base64.b32hexdecode") to support the
Base32 Encoding with Extended Hex Alphabet.

### bdb[¶](#bdb "Link to this heading")

Add `clearBreakpoints()` to reset all set breakpoints.
(Contributed by Irit Katriel in [bpo\-24160](https://bugs.python.org/issue?@action=redirect&bpo=24160).)

### bisect[¶](#bisect "Link to this heading")

Added the possibility of providing a *key* function to the APIs in the [`bisect`](../library/bisect.html#module-bisect "bisect: Array bisection algorithms for binary searching.")
module. (Contributed by Raymond Hettinger in [bpo\-4356](https://bugs.python.org/issue?@action=redirect&bpo=4356).)

### codecs[¶](#codecs "Link to this heading")

Add a [`codecs.unregister()`](../library/codecs.html#codecs.unregister "codecs.unregister") function to unregister a codec search function.
(Contributed by Hai Shi in [bpo\-41842](https://bugs.python.org/issue?@action=redirect&bpo=41842).)

### collections.abc[¶](#collections-abc "Link to this heading")

The `__args__` of the [parameterized generic](../library/stdtypes.html#types-genericalias) for
[`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") are now consistent with [`typing.Callable`](../library/typing.html#typing.Callable "typing.Callable").
[`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") generic now flattens type parameters, similar
to what [`typing.Callable`](../library/typing.html#typing.Callable "typing.Callable") currently does. This means that
`collections.abc.Callable[[int, str], str]` will have `__args__` of
`(int, str, str)`; previously this was `([int, str], str)`. To allow this
change, [`types.GenericAlias`](../library/types.html#types.GenericAlias "types.GenericAlias") can now be subclassed, and a subclass will
be returned when subscripting the [`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") type. Note
that a [`TypeError`](../library/exceptions.html#TypeError "TypeError") may be raised for invalid forms of parameterizing
[`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") which may have passed silently in Python 3\.9\.
(Contributed by Ken Jin in [bpo\-42195](https://bugs.python.org/issue?@action=redirect&bpo=42195).)

### contextlib[¶](#contextlib "Link to this heading")

Add a [`contextlib.aclosing()`](../library/contextlib.html#contextlib.aclosing "contextlib.aclosing") context manager to safely close async generators
and objects representing asynchronously released resources.
(Contributed by Joongi Kim and John Belmonte in [bpo\-41229](https://bugs.python.org/issue?@action=redirect&bpo=41229).)

Add asynchronous context manager support to [`contextlib.nullcontext()`](../library/contextlib.html#contextlib.nullcontext "contextlib.nullcontext").
(Contributed by Tom Gringauz in [bpo\-41543](https://bugs.python.org/issue?@action=redirect&bpo=41543).)

Add [`AsyncContextDecorator`](../library/contextlib.html#contextlib.AsyncContextDecorator "contextlib.AsyncContextDecorator"), for supporting usage of async
context managers as decorators.

### curses[¶](#curses "Link to this heading")

The extended color functions added in ncurses 6\.1 will be used transparently
by [`curses.color_content()`](../library/curses.html#curses.color_content "curses.color_content"), [`curses.init_color()`](../library/curses.html#curses.init_color "curses.init_color"),
[`curses.init_pair()`](../library/curses.html#curses.init_pair "curses.init_pair"), and [`curses.pair_content()`](../library/curses.html#curses.pair_content "curses.pair_content"). A new function,
[`curses.has_extended_color_support()`](../library/curses.html#curses.has_extended_color_support "curses.has_extended_color_support"), indicates whether extended color
support is provided by the underlying ncurses library.
(Contributed by Jeffrey Kintscher and Hans Petter Jansson in [bpo\-36982](https://bugs.python.org/issue?@action=redirect&bpo=36982).)

The `BUTTON5_*` constants are now exposed in the [`curses`](../library/curses.html#module-curses "curses: An interface to the curses library, providing portable terminal handling. (Unix)") module if
they are provided by the underlying curses library.
(Contributed by Zackery Spytz in [bpo\-39273](https://bugs.python.org/issue?@action=redirect&bpo=39273).)

### dataclasses[¶](#dataclasses "Link to this heading")

#### \_\_slots\_\_[¶](#slots "Link to this heading")

Added `slots` parameter in [`dataclasses.dataclass()`](../library/dataclasses.html#dataclasses.dataclass "dataclasses.dataclass") decorator.
(Contributed by Yurii Karabas in [bpo\-42269](https://bugs.python.org/issue?@action=redirect&bpo=42269))

#### Keyword\-only fields[¶](#keyword-only-fields "Link to this heading")

dataclasses now supports fields that are keyword\-only in the
generated \_\_init\_\_ method. There are a number of ways of specifying
keyword\-only fields.

You can say that every field is keyword\-only:

\`\`\`
from dataclasses import dataclass

@dataclass(kw\_only=True)
class Birthday:
 name: str
 birthday: datetime.date

\`\`\`

Both `name` and `birthday` are keyword\-only parameters to the
generated \_\_init\_\_ method.

You can specify keyword\-only on a per\-field basis:

\`\`\`
from dataclasses import dataclass, field

@dataclass
class Birthday:
 name: str
 birthday: datetime.date = field(kw\_only=True)

\`\`\`

Here only `birthday` is keyword\-only. If you set `kw_only` on
individual fields, be aware that there are rules about re\-ordering
fields due to keyword\-only fields needing to follow non\-keyword\-only
fields. See the full dataclasses documentation for details.

You can also specify that all fields following a KW\_ONLY marker are
keyword\-only. This will probably be the most common usage:

\`\`\`
from dataclasses import dataclass, KW\_ONLY

@dataclass
class Point:
 x: float
 y: float
 \_: KW\_ONLY
 z: float = 0\.0
 t: float = 0\.0

\`\`\`

Here, `z` and `t` are keyword\-only parameters, while `x` and
`y` are not.
(Contributed by Eric V. Smith in [bpo\-43532](https://bugs.python.org/issue?@action=redirect&bpo=43532).)

### distutils[¶](#distutils "Link to this heading")

The entire `distutils` package is deprecated, to be removed in Python
3\.12\. Its functionality for specifying package builds has already been
completely replaced by third\-party packages `setuptools` and
`packaging`, and most other commonly used APIs are available elsewhere
in the standard library (such as [`platform`](../library/platform.html#module-platform "platform: Retrieves as much platform identifying data as possible."), [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying."),
[`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") or [`sysconfig`](../library/sysconfig.html#module-sysconfig "sysconfig: Python's configuration information")). There are no plans to migrate
any other functionality from `distutils`, and applications that are
using other functions should plan to make private copies of the code.
Refer to [**PEP 632**](https://peps.python.org/pep-0632/) for discussion.

The `bdist_wininst` command deprecated in Python 3\.8 has been removed.
The `bdist_wheel` command is now recommended to distribute binary packages
on Windows.
(Contributed by Victor Stinner in [bpo\-42802](https://bugs.python.org/issue?@action=redirect&bpo=42802).)

### doctest[¶](#doctest "Link to this heading")

When a module does not define `__loader__`, fall back to `__spec__.loader`.
(Contributed by Brett Cannon in [bpo\-42133](https://bugs.python.org/issue?@action=redirect&bpo=42133).)

### encodings[¶](#encodings "Link to this heading")

`encodings.normalize_encoding()` now ignores non\-ASCII characters.
(Contributed by Hai Shi in [bpo\-39337](https://bugs.python.org/issue?@action=redirect&bpo=39337).)

### enum[¶](#enum "Link to this heading")

[`Enum`](../library/enum.html#enum.Enum "enum.Enum") [`__repr__()`](../reference/datamodel.html#object.__repr__ "object.__repr__") now returns `enum_name.member_name` and
[`__str__()`](../reference/datamodel.html#object.__str__ "object.__str__") now returns `member_name`. Stdlib enums available as
module constants have a [`repr()`](../library/functions.html#repr "repr") of `module_name.member_name`.
(Contributed by Ethan Furman in [bpo\-40066](https://bugs.python.org/issue?@action=redirect&bpo=40066).)

Add [`enum.StrEnum`](../library/enum.html#enum.StrEnum "enum.StrEnum") for enums where all members are strings.
(Contributed by Ethan Furman in [bpo\-41816](https://bugs.python.org/issue?@action=redirect&bpo=41816).)

### fileinput[¶](#fileinput "Link to this heading")

Add *encoding* and *errors* parameters in [`fileinput.input()`](../library/fileinput.html#fileinput.input "fileinput.input") and
[`fileinput.FileInput`](../library/fileinput.html#fileinput.FileInput "fileinput.FileInput").
(Contributed by Inada Naoki in [bpo\-43712](https://bugs.python.org/issue?@action=redirect&bpo=43712).)

[`fileinput.hook_compressed()`](../library/fileinput.html#fileinput.hook_compressed "fileinput.hook_compressed") now returns [`TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") object
when *mode* is “r” and file is compressed, like uncompressed files.
(Contributed by Inada Naoki in [bpo\-5758](https://bugs.python.org/issue?@action=redirect&bpo=5758).)

### faulthandler[¶](#faulthandler "Link to this heading")

The [`faulthandler`](../library/faulthandler.html#module-faulthandler "faulthandler: Dump the Python traceback.") module now detects if a fatal error occurs during a
garbage collector collection.
(Contributed by Victor Stinner in [bpo\-44466](https://bugs.python.org/issue?@action=redirect&bpo=44466).)

### gc[¶](#gc "Link to this heading")

Add audit hooks for [`gc.get_objects()`](../library/gc.html#gc.get_objects "gc.get_objects"), [`gc.get_referrers()`](../library/gc.html#gc.get_referrers "gc.get_referrers") and
[`gc.get_referents()`](../library/gc.html#gc.get_referents "gc.get_referents"). (Contributed by Pablo Galindo in [bpo\-43439](https://bugs.python.org/issue?@action=redirect&bpo=43439).)

### glob[¶](#glob "Link to this heading")

Add the *root\_dir* and *dir\_fd* parameters in [`glob()`](../library/glob.html#glob.glob "glob.glob") and
[`iglob()`](../library/glob.html#glob.iglob "glob.iglob") which allow to specify the root directory for searching.
(Contributed by Serhiy Storchaka in [bpo\-38144](https://bugs.python.org/issue?@action=redirect&bpo=38144).)

### hashlib[¶](#hashlib "Link to this heading")

The hashlib module requires OpenSSL 1\.1\.1 or newer.
(Contributed by Christian Heimes in [**PEP 644**](https://peps.python.org/pep-0644/) and [bpo\-43669](https://bugs.python.org/issue?@action=redirect&bpo=43669).)

The hashlib module has preliminary support for OpenSSL 3\.0\.0\.
(Contributed by Christian Heimes in [bpo\-38820](https://bugs.python.org/issue?@action=redirect&bpo=38820) and other issues.)

The pure\-Python fallback of [`pbkdf2_hmac()`](../library/hashlib.html#hashlib.pbkdf2_hmac "hashlib.pbkdf2_hmac") is deprecated. In
the future PBKDF2\-HMAC will only be available when Python has been built with
OpenSSL support.
(Contributed by Christian Heimes in [bpo\-43880](https://bugs.python.org/issue?@action=redirect&bpo=43880).)

### hmac[¶](#hmac "Link to this heading")

The hmac module now uses OpenSSL’s HMAC implementation internally.
(Contributed by Christian Heimes in [bpo\-40645](https://bugs.python.org/issue?@action=redirect&bpo=40645).)

### IDLE and idlelib[¶](#idle-and-idlelib "Link to this heading")

Make IDLE invoke [`sys.excepthook()`](../library/sys.html#sys.excepthook "sys.excepthook") (when started without ‘\-n’).
User hooks were previously ignored. (Contributed by Ken Hilton in
[bpo\-43008](https://bugs.python.org/issue?@action=redirect&bpo=43008).)

Rearrange the settings dialog. Split the General tab into Windows
and Shell/Ed tabs. Move help sources, which extend the Help menu, to the
Extensions tab. Make space for new options and shorten the dialog. The
latter makes the dialog better fit small screens. (Contributed by Terry Jan
Reedy in [bpo\-40468](https://bugs.python.org/issue?@action=redirect&bpo=40468).) Move the indent space setting from the Font tab to
the new Windows tab. (Contributed by Mark Roseman and Terry Jan Reedy in
[bpo\-33962](https://bugs.python.org/issue?@action=redirect&bpo=33962).)

The changes above were backported to a 3\.9 maintenance release.

Add a Shell sidebar. Move the primary prompt (‘\>\>\>’) to the sidebar.
Add secondary prompts (’…’) to the sidebar. Left click and optional
drag selects one or more lines of text, as with the editor
line number sidebar. Right click after selecting text lines displays
a context menu with ‘copy with prompts’. This zips together prompts
from the sidebar with lines from the selected text. This option also
appears on the context menu for the text. (Contributed by Tal Einat
in [bpo\-37903](https://bugs.python.org/issue?@action=redirect&bpo=37903).)

Use spaces instead of tabs to indent interactive code. This makes
interactive code entries ‘look right’. Making this feasible was a
major motivation for adding the shell sidebar. (Contributed by
Terry Jan Reedy in [bpo\-37892](https://bugs.python.org/issue?@action=redirect&bpo=37892).)

Highlight the new [soft keywords](../reference/lexical_analysis.html#soft-keywords) [`match`](../reference/compound_stmts.html#match),
[`case`](../reference/compound_stmts.html#match), and [`_`](../reference/compound_stmts.html#wildcard-patterns) in
pattern\-matching statements. However, this highlighting is not perfect
and will be incorrect in some rare cases, including some `_`\-s in
`case` patterns. (Contributed by Tal Einat in [bpo\-44010](https://bugs.python.org/issue?@action=redirect&bpo=44010).)

New in 3\.10 maintenance releases.

Apply syntax highlighting to `.pyi` files. (Contributed by Alex
Waygood and Terry Jan Reedy in [bpo\-45447](https://bugs.python.org/issue?@action=redirect&bpo=45447).)

Include prompts when saving Shell with inputs and outputs.
(Contributed by Terry Jan Reedy in [gh\-95191](https://github.com/python/cpython/issues/95191).)

### importlib.metadata[¶](#importlib-metadata "Link to this heading")

Feature parity with `importlib_metadata` 4\.6
([history](https://importlib-metadata.readthedocs.io/en/latest/history.html)).

[importlib.metadata entry points](../library/importlib.metadata.html#entry-points)
now provide a nicer experience
for selecting entry points by group and name through a new
[importlib.metadata.EntryPoints](../library/importlib.metadata.html#entry-points) class. See the Compatibility
Note in the docs for more info on the deprecation and usage.

Added [importlib.metadata.packages\_distributions()](../library/importlib.metadata.html#package-distributions)
for resolving top\-level Python modules and packages to their
[importlib.metadata.Distribution](../library/importlib.metadata.html#distributions).

### inspect[¶](#inspect "Link to this heading")

When a module does not define `__loader__`, fall back to `__spec__.loader`.
(Contributed by Brett Cannon in [bpo\-42133](https://bugs.python.org/issue?@action=redirect&bpo=42133).)

Add [`inspect.get_annotations()`](../library/inspect.html#inspect.get_annotations "inspect.get_annotations"), which safely computes the annotations
defined on an object. It works around the quirks of accessing the annotations
on various types of objects, and makes very few assumptions about the object
it examines. [`inspect.get_annotations()`](../library/inspect.html#inspect.get_annotations "inspect.get_annotations") can also correctly un\-stringize
stringized annotations. [`inspect.get_annotations()`](../library/inspect.html#inspect.get_annotations "inspect.get_annotations") is now considered
best practice for accessing the annotations dict defined on any Python object;
for more information on best practices for working with annotations, please see
[Annotations Best Practices](../howto/annotations.html#annotations-howto).
Relatedly, [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature"),
[`inspect.Signature.from_callable()`](../library/inspect.html#inspect.Signature.from_callable "inspect.Signature.from_callable"), and `inspect.Signature.from_function()`
now call [`inspect.get_annotations()`](../library/inspect.html#inspect.get_annotations "inspect.get_annotations") to retrieve annotations. This means
[`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") and [`inspect.Signature.from_callable()`](../library/inspect.html#inspect.Signature.from_callable "inspect.Signature.from_callable") can
also now un\-stringize stringized annotations.
(Contributed by Larry Hastings in [bpo\-43817](https://bugs.python.org/issue?@action=redirect&bpo=43817).)

### itertools[¶](#itertools "Link to this heading")

Add [`itertools.pairwise()`](../library/itertools.html#itertools.pairwise "itertools.pairwise").
(Contributed by Raymond Hettinger in [bpo\-38200](https://bugs.python.org/issue?@action=redirect&bpo=38200).)

### linecache[¶](#linecache "Link to this heading")

When a module does not define `__loader__`, fall back to `__spec__.loader`.
(Contributed by Brett Cannon in [bpo\-42133](https://bugs.python.org/issue?@action=redirect&bpo=42133).)

### os[¶](#os "Link to this heading")

Add [`os.cpu_count()`](../library/os.html#os.cpu_count "os.cpu_count") support for VxWorks RTOS.
(Contributed by Peixing Xin in [bpo\-41440](https://bugs.python.org/issue?@action=redirect&bpo=41440).)

Add a new function [`os.eventfd()`](../library/os.html#os.eventfd "os.eventfd") and related helpers to wrap the
`eventfd2` syscall on Linux.
(Contributed by Christian Heimes in [bpo\-41001](https://bugs.python.org/issue?@action=redirect&bpo=41001).)

Add [`os.splice()`](../library/os.html#os.splice "os.splice") that allows to move data between two file
descriptors without copying between kernel address space and user
address space, where one of the file descriptors must refer to a
pipe. (Contributed by Pablo Galindo in [bpo\-41625](https://bugs.python.org/issue?@action=redirect&bpo=41625).)

Add [`O_EVTONLY`](../library/os.html#os.O_EVTONLY "os.O_EVTONLY"), [`O_FSYNC`](../library/os.html#os.O_FSYNC "os.O_FSYNC"), [`O_SYMLINK`](../library/os.html#os.O_SYMLINK "os.O_SYMLINK")
and [`O_NOFOLLOW_ANY`](../library/os.html#os.O_NOFOLLOW_ANY "os.O_NOFOLLOW_ANY") for macOS.
(Contributed by Donghee Na in [bpo\-43106](https://bugs.python.org/issue?@action=redirect&bpo=43106).)

### os.path[¶](#os-path "Link to this heading")

[`os.path.realpath()`](../library/os.path.html#os.path.realpath "os.path.realpath") now accepts a *strict* keyword\-only argument. When set
to `True`, [`OSError`](../library/exceptions.html#OSError "OSError") is raised if a path doesn’t exist or a symlink loop
is encountered.
(Contributed by Barney Gale in [bpo\-43757](https://bugs.python.org/issue?@action=redirect&bpo=43757).)

### pathlib[¶](#pathlib "Link to this heading")

Add slice support to [`PurePath.parents`](../library/pathlib.html#pathlib.PurePath.parents "pathlib.PurePath.parents").
(Contributed by Joshua Cannon in [bpo\-35498](https://bugs.python.org/issue?@action=redirect&bpo=35498).)

Add negative indexing support to [`PurePath.parents`](../library/pathlib.html#pathlib.PurePath.parents "pathlib.PurePath.parents").
(Contributed by Yaroslav Pankovych in [bpo\-21041](https://bugs.python.org/issue?@action=redirect&bpo=21041).)

Add [`Path.hardlink_to`](../library/pathlib.html#pathlib.Path.hardlink_to "pathlib.Path.hardlink_to") method that
supersedes `link_to()`. The new method has the same argument
order as [`symlink_to()`](../library/pathlib.html#pathlib.Path.symlink_to "pathlib.Path.symlink_to").
(Contributed by Barney Gale in [bpo\-39950](https://bugs.python.org/issue?@action=redirect&bpo=39950).)

[`pathlib.Path.stat()`](../library/pathlib.html#pathlib.Path.stat "pathlib.Path.stat") and [`chmod()`](../library/pathlib.html#pathlib.Path.chmod "pathlib.Path.chmod") now accept a
*follow\_symlinks* keyword\-only argument for consistency with corresponding
functions in the [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module.
(Contributed by Barney Gale in [bpo\-39906](https://bugs.python.org/issue?@action=redirect&bpo=39906).)

### platform[¶](#platform "Link to this heading")

Add [`platform.freedesktop_os_release()`](../library/platform.html#platform.freedesktop_os_release "platform.freedesktop_os_release") to retrieve operation system
identification from [freedesktop.org os\-release](https://www.freedesktop.org/software/systemd/man/os-release.html) standard file.
(Contributed by Christian Heimes in [bpo\-28468](https://bugs.python.org/issue?@action=redirect&bpo=28468).)

### pprint[¶](#pprint "Link to this heading")

[`pprint.pprint()`](../library/pprint.html#pprint.pprint "pprint.pprint") now accepts a new `underscore_numbers` keyword argument.
(Contributed by sblondon in [bpo\-42914](https://bugs.python.org/issue?@action=redirect&bpo=42914).)

[`pprint`](../library/pprint.html#module-pprint "pprint: Data pretty printer.") can now pretty\-print [`dataclasses.dataclass`](../library/dataclasses.html#dataclasses.dataclass "dataclasses.dataclass") instances.
(Contributed by Lewis Gaul in [bpo\-43080](https://bugs.python.org/issue?@action=redirect&bpo=43080).)

### py\_compile[¶](#py-compile "Link to this heading")

Add `--quiet` option to command\-line interface of [`py_compile`](../library/py_compile.html#module-py_compile "py_compile: Generate byte-code files from Python source files.").
(Contributed by Gregory Schevchenko in [bpo\-38731](https://bugs.python.org/issue?@action=redirect&bpo=38731).)

### pyclbr[¶](#pyclbr "Link to this heading")

Add an `end_lineno` attribute to the `Function` and `Class`
objects in the tree returned by [`pyclbr.readmodule()`](../library/pyclbr.html#pyclbr.readmodule "pyclbr.readmodule") and
[`pyclbr.readmodule_ex()`](../library/pyclbr.html#pyclbr.readmodule_ex "pyclbr.readmodule_ex"). It matches the existing (start) `lineno`.
(Contributed by Aviral Srivastava in [bpo\-38307](https://bugs.python.org/issue?@action=redirect&bpo=38307).)

### shelve[¶](#shelve "Link to this heading")

The [`shelve`](../library/shelve.html#module-shelve "shelve: Python object persistence.") module now uses [`pickle.DEFAULT_PROTOCOL`](../library/pickle.html#pickle.DEFAULT_PROTOCOL "pickle.DEFAULT_PROTOCOL") by default
instead of [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") protocol `3` when creating shelves.
(Contributed by Zackery Spytz in [bpo\-34204](https://bugs.python.org/issue?@action=redirect&bpo=34204).)

### statistics[¶](#statistics "Link to this heading")

Add [`covariance()`](../library/statistics.html#statistics.covariance "statistics.covariance"), Pearson’s
[`correlation()`](../library/statistics.html#statistics.correlation "statistics.correlation"), and simple
[`linear_regression()`](../library/statistics.html#statistics.linear_regression "statistics.linear_regression") functions.
(Contributed by Tymoteusz Wołodźko in [bpo\-38490](https://bugs.python.org/issue?@action=redirect&bpo=38490).)

### site[¶](#site "Link to this heading")

When a module does not define `__loader__`, fall back to `__spec__.loader`.
(Contributed by Brett Cannon in [bpo\-42133](https://bugs.python.org/issue?@action=redirect&bpo=42133).)

### socket[¶](#socket "Link to this heading")

The exception [`socket.timeout`](../library/socket.html#socket.timeout "socket.timeout") is now an alias of [`TimeoutError`](../library/exceptions.html#TimeoutError "TimeoutError").
(Contributed by Christian Heimes in [bpo\-42413](https://bugs.python.org/issue?@action=redirect&bpo=42413).)

Add option to create MPTCP sockets with `IPPROTO_MPTCP`
(Contributed by Rui Cunha in [bpo\-43571](https://bugs.python.org/issue?@action=redirect&bpo=43571).)

Add `IP_RECVTOS` option to receive the type of service (ToS) or DSCP/ECN fields
(Contributed by Georg Sauthoff in [bpo\-44077](https://bugs.python.org/issue?@action=redirect&bpo=44077).)

### ssl[¶](#ssl "Link to this heading")

The ssl module requires OpenSSL 1\.1\.1 or newer.
(Contributed by Christian Heimes in [**PEP 644**](https://peps.python.org/pep-0644/) and [bpo\-43669](https://bugs.python.org/issue?@action=redirect&bpo=43669).)

The ssl module has preliminary support for OpenSSL 3\.0\.0 and new option
[`OP_IGNORE_UNEXPECTED_EOF`](../library/ssl.html#ssl.OP_IGNORE_UNEXPECTED_EOF "ssl.OP_IGNORE_UNEXPECTED_EOF").
(Contributed by Christian Heimes in [bpo\-38820](https://bugs.python.org/issue?@action=redirect&bpo=38820), [bpo\-43794](https://bugs.python.org/issue?@action=redirect&bpo=43794),
[bpo\-43788](https://bugs.python.org/issue?@action=redirect&bpo=43788), [bpo\-43791](https://bugs.python.org/issue?@action=redirect&bpo=43791), [bpo\-43799](https://bugs.python.org/issue?@action=redirect&bpo=43799), [bpo\-43920](https://bugs.python.org/issue?@action=redirect&bpo=43920),
[bpo\-43789](https://bugs.python.org/issue?@action=redirect&bpo=43789), and [bpo\-43811](https://bugs.python.org/issue?@action=redirect&bpo=43811).)

Deprecated function and use of deprecated constants now result in
a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). [`ssl.SSLContext.options`](../library/ssl.html#ssl.SSLContext.options "ssl.SSLContext.options") has
[`OP_NO_SSLv2`](../library/ssl.html#ssl.OP_NO_SSLv2 "ssl.OP_NO_SSLv2") and [`OP_NO_SSLv3`](../library/ssl.html#ssl.OP_NO_SSLv3 "ssl.OP_NO_SSLv3") set by default and
therefore cannot warn about setting the flag again. The
[deprecation section](#whatsnew310-deprecated) has a list of deprecated
features.
(Contributed by Christian Heimes in [bpo\-43880](https://bugs.python.org/issue?@action=redirect&bpo=43880).)

The ssl module now has more secure default settings. Ciphers without forward
secrecy or SHA\-1 MAC are disabled by default. Security level 2 prohibits
weak RSA, DH, and ECC keys with less than 112 bits of security.
[`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") defaults to minimum protocol version TLS 1\.2\.
Settings are based on Hynek Schlawack’s research.
(Contributed by Christian Heimes in [bpo\-43998](https://bugs.python.org/issue?@action=redirect&bpo=43998).)

The deprecated protocols SSL 3\.0, TLS 1\.0, and TLS 1\.1 are no longer
officially supported. Python does not block them actively. However
OpenSSL build options, distro configurations, vendor patches, and cipher
suites may prevent a successful handshake.

Add a *timeout* parameter to the [`ssl.get_server_certificate()`](../library/ssl.html#ssl.get_server_certificate "ssl.get_server_certificate") function.
(Contributed by Zackery Spytz in [bpo\-31870](https://bugs.python.org/issue?@action=redirect&bpo=31870).)

The ssl module uses heap\-types and multi\-phase initialization.
(Contributed by Christian Heimes in [bpo\-42333](https://bugs.python.org/issue?@action=redirect&bpo=42333).)

A new verify flag [`VERIFY_X509_PARTIAL_CHAIN`](../library/ssl.html#ssl.VERIFY_X509_PARTIAL_CHAIN "ssl.VERIFY_X509_PARTIAL_CHAIN") has been added.
(Contributed by l0x in [bpo\-40849](https://bugs.python.org/issue?@action=redirect&bpo=40849).)

### sqlite3[¶](#sqlite3 "Link to this heading")

Add audit events for `connect/handle()`,
[`enable_load_extension()`](../library/sqlite3.html#sqlite3.Connection.enable_load_extension "sqlite3.Connection.enable_load_extension"), and
[`load_extension()`](../library/sqlite3.html#sqlite3.Connection.load_extension "sqlite3.Connection.load_extension").
(Contributed by Erlend E. Aasland in [bpo\-43762](https://bugs.python.org/issue?@action=redirect&bpo=43762).)

### sys[¶](#sys "Link to this heading")

Add [`sys.orig_argv`](../library/sys.html#sys.orig_argv "sys.orig_argv") attribute: the list of the original command line
arguments passed to the Python executable.
(Contributed by Victor Stinner in [bpo\-23427](https://bugs.python.org/issue?@action=redirect&bpo=23427).)

Add [`sys.stdlib_module_names`](../library/sys.html#sys.stdlib_module_names "sys.stdlib_module_names"), containing the list of the standard library
module names.
(Contributed by Victor Stinner in [bpo\-42955](https://bugs.python.org/issue?@action=redirect&bpo=42955).)

### \_thread[¶](#thread "Link to this heading")

[`_thread.interrupt_main()`](../library/_thread.html#thread.interrupt_main "_thread.interrupt_main") now takes an optional signal number to
simulate (the default is still [`signal.SIGINT`](../library/signal.html#signal.SIGINT "signal.SIGINT")).
(Contributed by Antoine Pitrou in [bpo\-43356](https://bugs.python.org/issue?@action=redirect&bpo=43356).)

### threading[¶](#threading "Link to this heading")

Add [`threading.gettrace()`](../library/threading.html#threading.gettrace "threading.gettrace") and [`threading.getprofile()`](../library/threading.html#threading.getprofile "threading.getprofile") to
retrieve the functions set by [`threading.settrace()`](../library/threading.html#threading.settrace "threading.settrace") and
[`threading.setprofile()`](../library/threading.html#threading.setprofile "threading.setprofile") respectively.
(Contributed by Mario Corchero in [bpo\-42251](https://bugs.python.org/issue?@action=redirect&bpo=42251).)

Add [`threading.__excepthook__`](../library/threading.html#threading.__excepthook__ "threading.__excepthook__") to allow retrieving the original value
of [`threading.excepthook()`](../library/threading.html#threading.excepthook "threading.excepthook") in case it is set to a broken or a different
value.
(Contributed by Mario Corchero in [bpo\-42308](https://bugs.python.org/issue?@action=redirect&bpo=42308).)

### traceback[¶](#traceback "Link to this heading")

The [`format_exception()`](../library/traceback.html#traceback.format_exception "traceback.format_exception"),
[`format_exception_only()`](../library/traceback.html#traceback.format_exception_only "traceback.format_exception_only"), and
[`print_exception()`](../library/traceback.html#traceback.print_exception "traceback.print_exception") functions can now take an exception object
as a positional\-only argument.
(Contributed by Zackery Spytz and Matthias Bussonnier in [bpo\-26389](https://bugs.python.org/issue?@action=redirect&bpo=26389).)

### types[¶](#types "Link to this heading")

Reintroduce the [`types.EllipsisType`](../library/types.html#types.EllipsisType "types.EllipsisType"), [`types.NoneType`](../library/types.html#types.NoneType "types.NoneType")
and [`types.NotImplementedType`](../library/types.html#types.NotImplementedType "types.NotImplementedType") classes, providing a new set
of types readily interpretable by type checkers.
(Contributed by Bas van Beek in [bpo\-41810](https://bugs.python.org/issue?@action=redirect&bpo=41810).)

### typing[¶](#typing "Link to this heading")

For major changes, see [New Features Related to Type Hints](#new-feat-related-type-hints).

The behavior of [`typing.Literal`](../library/typing.html#typing.Literal "typing.Literal") was changed to conform with [**PEP 586**](https://peps.python.org/pep-0586/)
and to match the behavior of static type checkers specified in the PEP.

1. `Literal` now de\-duplicates parameters.
2. Equality comparisons between `Literal` objects are now order independent.
3. `Literal` comparisons now respect types. For example,
`Literal[0] == Literal[False]` previously evaluated to `True`. It is
now `False`. To support this change, the internally used type cache now
supports differentiating types.
4. `Literal` objects will now raise a [`TypeError`](../library/exceptions.html#TypeError "TypeError") exception during
equality comparisons if any of their parameters are not [hashable](../glossary.html#term-hashable).
Note that declaring `Literal` with unhashable parameters will not throw
an error:

\`\`\`
\>\>\> from typing import Literal
\>\>\> Literal\[{0}]
\>\>\> Literal\[{0}] == Literal\[{False}]
Traceback (most recent call last):
 File "\", line 1, in \
TypeError: unhashable type: 'set'

\`\`\`

(Contributed by Yurii Karabas in [bpo\-42345](https://bugs.python.org/issue?@action=redirect&bpo=42345).)

Add new function [`typing.is_typeddict()`](../library/typing.html#typing.is_typeddict "typing.is_typeddict") to introspect if an annotation
is a [`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict").
(Contributed by Patrick Reader in [bpo\-41792](https://bugs.python.org/issue?@action=redirect&bpo=41792).)

Subclasses of `typing.Protocol` which only have data variables declared
will now raise a `TypeError` when checked with `isinstance` unless they
are decorated with [`runtime_checkable()`](../library/typing.html#typing.runtime_checkable "typing.runtime_checkable"). Previously, these checks
passed silently. Users should decorate their
subclasses with the `runtime_checkable()` decorator
if they want runtime protocols.
(Contributed by Yurii Karabas in [bpo\-38908](https://bugs.python.org/issue?@action=redirect&bpo=38908).)

Importing from the `typing.io` and `typing.re` submodules will now emit
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). These submodules have been deprecated since
Python 3\.8 and will be removed in a future version of Python. Anything
belonging to those submodules should be imported directly from
[`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") instead.
(Contributed by Sebastian Rittau in [bpo\-38291](https://bugs.python.org/issue?@action=redirect&bpo=38291).)

### unittest[¶](#unittest "Link to this heading")

Add new method [`assertNoLogs()`](../library/unittest.html#unittest.TestCase.assertNoLogs "unittest.TestCase.assertNoLogs") to complement the
existing [`assertLogs()`](../library/unittest.html#unittest.TestCase.assertLogs "unittest.TestCase.assertLogs"). (Contributed by Kit Yan Choi
in [bpo\-39385](https://bugs.python.org/issue?@action=redirect&bpo=39385).)

### urllib.parse[¶](#urllib-parse "Link to this heading")

Python versions earlier than Python 3\.10 allowed using both `;` and `&` as
query parameter separators in [`urllib.parse.parse_qs()`](../library/urllib.parse.html#urllib.parse.parse_qs "urllib.parse.parse_qs") and
[`urllib.parse.parse_qsl()`](../library/urllib.parse.html#urllib.parse.parse_qsl "urllib.parse.parse_qsl"). Due to security concerns, and to conform with
newer W3C recommendations, this has been changed to allow only a single
separator key, with `&` as the default. This change also affects
`cgi.parse()` and `cgi.parse_multipart()` as they use the affected
functions internally. For more details, please see their respective
documentation.
(Contributed by Adam Goldschmidt, Senthil Kumaran and Ken Jin in [bpo\-42967](https://bugs.python.org/issue?@action=redirect&bpo=42967).)

The presence of newline or tab characters in parts of a URL allows for some
forms of attacks. Following the WHATWG specification that updates [**RFC 3986**](https://datatracker.ietf.org/doc/html/rfc3986.html),
ASCII newline `\n`, `\r` and tab `\t` characters are stripped from the
URL by the parser in [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") preventing such attacks. The removal
characters are controlled by a new module level variable
`urllib.parse._UNSAFE_URL_BYTES_TO_REMOVE`. (See [gh\-88048](https://github.com/python/cpython/issues/88048))

### xml[¶](#xml "Link to this heading")

Add a [`LexicalHandler`](../library/xml.sax.handler.html#xml.sax.handler.LexicalHandler "xml.sax.handler.LexicalHandler") class to the
[`xml.sax.handler`](../library/xml.sax.handler.html#module-xml.sax.handler "xml.sax.handler: Base classes for SAX event handlers.") module.
(Contributed by Jonathan Gossage and Zackery Spytz in [bpo\-35018](https://bugs.python.org/issue?@action=redirect&bpo=35018).)

### zipimport[¶](#zipimport "Link to this heading")

Add methods related to [**PEP 451**](https://peps.python.org/pep-0451/): [`find_spec()`](../library/zipimport.html#zipimport.zipimporter.find_spec "zipimport.zipimporter.find_spec"),
[`zipimport.zipimporter.create_module()`](../library/zipimport.html#zipimport.zipimporter.create_module "zipimport.zipimporter.create_module"), and
[`zipimport.zipimporter.exec_module()`](../library/zipimport.html#zipimport.zipimporter.exec_module "zipimport.zipimporter.exec_module").
(Contributed by Brett Cannon in [bpo\-42131](https://bugs.python.org/issue?@action=redirect&bpo=42131).)

Add [`invalidate_caches()`](../library/zipimport.html#zipimport.zipimporter.invalidate_caches "zipimport.zipimporter.invalidate_caches") method.
(Contributed by Desmond Cheong in [bpo\-14678](https://bugs.python.org/issue?@action=redirect&bpo=14678).)

## Optimizations[¶](#optimizations "Link to this heading")

* Constructors [`str()`](../library/stdtypes.html#str "str"), [`bytes()`](../library/stdtypes.html#bytes "bytes") and [`bytearray()`](../library/stdtypes.html#bytearray "bytearray") are now faster
(around 30–40% for small objects).
(Contributed by Serhiy Storchaka in [bpo\-41334](https://bugs.python.org/issue?@action=redirect&bpo=41334).)
* The [`runpy`](../library/runpy.html#module-runpy "runpy: Locate and run Python modules without importing them first.") module now imports fewer modules.
The `python3 -m module-name` command startup time is 1\.4x faster in
average. On Linux, `python3 -I -m module-name` imports 69 modules on Python
3\.9, whereas it only imports 51 modules (\-18\) on Python 3\.10\.
(Contributed by Victor Stinner in [bpo\-41006](https://bugs.python.org/issue?@action=redirect&bpo=41006) and [bpo\-41718](https://bugs.python.org/issue?@action=redirect&bpo=41718).)
* The `LOAD_ATTR` instruction now uses new “per opcode cache” mechanism. It
is about 36% faster now for regular attributes and 44% faster for slots.
(Contributed by Pablo Galindo and Yury Selivanov in [bpo\-42093](https://bugs.python.org/issue?@action=redirect&bpo=42093) and Guido
van Rossum in [bpo\-42927](https://bugs.python.org/issue?@action=redirect&bpo=42927), based on ideas implemented originally in PyPy
and MicroPython.)
* When building Python with [`--enable-optimizations`](../using/configure.html#cmdoption-enable-optimizations) now
`-fno-semantic-interposition` is added to both the compile and link line.
This speeds builds of the Python interpreter created with [`--enable-shared`](../using/configure.html#cmdoption-enable-shared)
with `gcc` by up to 30%. See [this article](https://developers.redhat.com/blog/2020/06/25/red-hat-enterprise-linux-8-2-brings-faster-python-3-8-run-speeds/)
for more details. (Contributed by Victor Stinner and Pablo Galindo in
[bpo\-38980](https://bugs.python.org/issue?@action=redirect&bpo=38980).)
* Use a new output buffer management code for [`bz2`](../library/bz2.html#module-bz2 "bz2: Interfaces for bzip2 compression and decompression.") / [`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library.") /
[`zlib`](../library/zlib.html#module-zlib "zlib: Low-level interface to compression and decompression routines compatible with gzip.") modules, and add `.readall()` function to
`_compression.DecompressReader` class. bz2 decompression is now 1\.09x \~ 1\.17x
faster, lzma decompression 1\.20x \~ 1\.32x faster, `GzipFile.read(-1)` 1\.11x
\~ 1\.18x faster. (Contributed by Ma Lin, reviewed by Gregory P. Smith, in [bpo\-41486](https://bugs.python.org/issue?@action=redirect&bpo=41486))
* When using stringized annotations, annotations dicts for functions are no longer
created when the function is created. Instead, they are stored as a tuple of
strings, and the function object lazily converts this into the annotations dict
on demand. This optimization cuts the CPU time needed to define an annotated
function by half.
(Contributed by Yurii Karabas and Inada Naoki in [bpo\-42202](https://bugs.python.org/issue?@action=redirect&bpo=42202).)
* Substring search functions such as `str1 in str2` and `str2.find(str1)`
now sometimes use Crochemore \& Perrin’s “Two\-Way” string searching
algorithm to avoid quadratic behavior on long strings. (Contributed
by Dennis Sweeney in [bpo\-41972](https://bugs.python.org/issue?@action=redirect&bpo=41972))
* Add micro\-optimizations to `_PyType_Lookup()` to improve type attribute cache lookup
performance in the common case of cache hits. This makes the interpreter 1\.04 times faster
on average. (Contributed by Dino Viehland in [bpo\-43452](https://bugs.python.org/issue?@action=redirect&bpo=43452).)
* The following built\-in functions now support the faster [**PEP 590**](https://peps.python.org/pep-0590/) vectorcall calling convention:
[`map()`](../library/functions.html#map "map"), [`filter()`](../library/functions.html#filter "filter"), [`reversed()`](../library/functions.html#reversed "reversed"), [`bool()`](../library/functions.html#bool "bool") and [`float()`](../library/functions.html#float "float").
(Contributed by Donghee Na and Jeroen Demeyer in [bpo\-43575](https://bugs.python.org/issue?@action=redirect&bpo=43575), [bpo\-43287](https://bugs.python.org/issue?@action=redirect&bpo=43287), [bpo\-41922](https://bugs.python.org/issue?@action=redirect&bpo=41922), [bpo\-41873](https://bugs.python.org/issue?@action=redirect&bpo=41873) and [bpo\-41870](https://bugs.python.org/issue?@action=redirect&bpo=41870).)
* [`BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") performance is improved by removing internal `RLock`.
This makes `BZ2File` thread unsafe in the face of multiple simultaneous
readers or writers, just like its equivalent classes in [`gzip`](../library/gzip.html#module-gzip "gzip: Interfaces for gzip compression and decompression using file objects.") and
[`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library.") have always been. (Contributed by Inada Naoki in [bpo\-43785](https://bugs.python.org/issue?@action=redirect&bpo=43785).)

## Deprecated[¶](#deprecated "Link to this heading")

* Currently Python accepts numeric literals immediately followed by keywords,
for example `0in x`, `1or x`, `0if 1else 2`. It allows confusing
and ambiguous expressions like `[0x1for x in y]` (which can be
interpreted as `[0x1 for x in y]` or `[0x1f or x in y]`). Starting in
this release, a deprecation warning is raised if the numeric literal is
immediately followed by one of keywords [`and`](../reference/expressions.html#and), [`else`](../reference/compound_stmts.html#else),
[`for`](../reference/compound_stmts.html#for), [`if`](../reference/compound_stmts.html#if), [`in`](../reference/expressions.html#in), [`is`](../reference/expressions.html#is) and [`or`](../reference/expressions.html#or).
In future releases it will be changed to syntax warning, and finally to
syntax error.
(Contributed by Serhiy Storchaka in [bpo\-43833](https://bugs.python.org/issue?@action=redirect&bpo=43833).)
* Starting in this release, there will be a concerted effort to begin
cleaning up old import semantics that were kept for Python 2\.7
compatibility. Specifically,
`find_loader()`/`find_module()`
(superseded by [`find_spec()`](../library/importlib.html#importlib.abc.MetaPathFinder.find_spec "importlib.abc.MetaPathFinder.find_spec")),
[`load_module()`](../library/importlib.html#importlib.abc.Loader.load_module "importlib.abc.Loader.load_module")
(superseded by [`exec_module()`](../library/importlib.html#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module")),
`module_repr()` (which the import system
takes care of for you), the `__package__` attribute
(superseded by `__spec__.parent`), the `__loader__` attribute
(superseded by `__spec__.loader`), and the `__cached__` attribute
(superseded by `__spec__.cached`) will slowly be removed (as well
as other classes and methods in [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.")).
[`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning") and/or [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") will be raised
as appropriate to help identify code which needs updating during
this transition.
* The entire `distutils` namespace is deprecated, to be removed in
Python 3\.12\. Refer to the [module changes](#distutils-deprecated)
section for more information.
* Non\-integer arguments to [`random.randrange()`](../library/random.html#random.randrange "random.randrange") are deprecated.
The [`ValueError`](../library/exceptions.html#ValueError "ValueError") is deprecated in favor of a [`TypeError`](../library/exceptions.html#TypeError "TypeError").
(Contributed by Serhiy Storchaka and Raymond Hettinger in [bpo\-37319](https://bugs.python.org/issue?@action=redirect&bpo=37319).)
* The various `load_module()` methods of [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") have been
documented as deprecated since Python 3\.6, but will now also trigger
a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). Use
[`exec_module()`](../library/importlib.html#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") instead.
(Contributed by Brett Cannon in [bpo\-26131](https://bugs.python.org/issue?@action=redirect&bpo=26131).)
* `zimport.zipimporter.load_module()` has been deprecated in
preference for [`exec_module()`](../library/zipimport.html#zipimport.zipimporter.exec_module "zipimport.zipimporter.exec_module").
(Contributed by Brett Cannon in [bpo\-26131](https://bugs.python.org/issue?@action=redirect&bpo=26131).)
* The use of [`load_module()`](../library/importlib.html#importlib.abc.Loader.load_module "importlib.abc.Loader.load_module") by the import
system now triggers an [`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning") as
[`exec_module()`](../library/importlib.html#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") is preferred.
(Contributed by Brett Cannon in [bpo\-26131](https://bugs.python.org/issue?@action=redirect&bpo=26131).)
* The use of `importlib.abc.MetaPathFinder.find_module()` and
`importlib.abc.PathEntryFinder.find_module()` by the import system now
trigger an [`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning") as
[`importlib.abc.MetaPathFinder.find_spec()`](../library/importlib.html#importlib.abc.MetaPathFinder.find_spec "importlib.abc.MetaPathFinder.find_spec") and
[`importlib.abc.PathEntryFinder.find_spec()`](../library/importlib.html#importlib.abc.PathEntryFinder.find_spec "importlib.abc.PathEntryFinder.find_spec")
are preferred, respectively. You can use
[`importlib.util.spec_from_loader()`](../library/importlib.html#importlib.util.spec_from_loader "importlib.util.spec_from_loader") to help in porting.
(Contributed by Brett Cannon in [bpo\-42134](https://bugs.python.org/issue?@action=redirect&bpo=42134).)
* The use of `importlib.abc.PathEntryFinder.find_loader()` by the import
system now triggers an [`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning") as
[`importlib.abc.PathEntryFinder.find_spec()`](../library/importlib.html#importlib.abc.PathEntryFinder.find_spec "importlib.abc.PathEntryFinder.find_spec") is preferred. You can use
[`importlib.util.spec_from_loader()`](../library/importlib.html#importlib.util.spec_from_loader "importlib.util.spec_from_loader") to help in porting.
(Contributed by Brett Cannon in [bpo\-43672](https://bugs.python.org/issue?@action=redirect&bpo=43672).)
* The various implementations of
`importlib.abc.MetaPathFinder.find_module()` (
`importlib.machinery.BuiltinImporter.find_module()`,
`importlib.machinery.FrozenImporter.find_module()`,
`importlib.machinery.WindowsRegistryFinder.find_module()`,
`importlib.machinery.PathFinder.find_module()`,
`importlib.abc.MetaPathFinder.find_module()` ),
`importlib.abc.PathEntryFinder.find_module()` (
`importlib.machinery.FileFinder.find_module()` ), and
`importlib.abc.PathEntryFinder.find_loader()` (
`importlib.machinery.FileFinder.find_loader()` )
now raise [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") and are slated for removal in
Python 3\.12 (previously they were documented as deprecated in Python 3\.4\).
(Contributed by Brett Cannon in [bpo\-42135](https://bugs.python.org/issue?@action=redirect&bpo=42135).)
* `importlib.abc.Finder` is deprecated (including its sole method,
`find_module()`). Both
[`importlib.abc.MetaPathFinder`](../library/importlib.html#importlib.abc.MetaPathFinder "importlib.abc.MetaPathFinder") and [`importlib.abc.PathEntryFinder`](../library/importlib.html#importlib.abc.PathEntryFinder "importlib.abc.PathEntryFinder")
no longer inherit from the class. Users should inherit from one of these two
classes as appropriate instead.
(Contributed by Brett Cannon in [bpo\-42135](https://bugs.python.org/issue?@action=redirect&bpo=42135).)
* The deprecations of `imp`, `importlib.find_loader()`,
`importlib.util.set_package_wrapper()`,
`importlib.util.set_loader_wrapper()`,
`importlib.util.module_for_loader()`,
`pkgutil.ImpImporter`, and
`pkgutil.ImpLoader` have all been updated to list Python 3\.12 as the
slated version of removal (they began raising [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") in
previous versions of Python).
(Contributed by Brett Cannon in [bpo\-43720](https://bugs.python.org/issue?@action=redirect&bpo=43720).)
* The import system now uses the `__spec__` attribute on modules before
falling back on `module_repr()` for a module’s
`__repr__()` method. Removal of the use of `module_repr()` is scheduled
for Python 3\.12\.
(Contributed by Brett Cannon in [bpo\-42137](https://bugs.python.org/issue?@action=redirect&bpo=42137).)
* `importlib.abc.Loader.module_repr()`,
`importlib.machinery.FrozenLoader.module_repr()`, and
`importlib.machinery.BuiltinLoader.module_repr()` are deprecated and
slated for removal in Python 3\.12\.
(Contributed by Brett Cannon in [bpo\-42136](https://bugs.python.org/issue?@action=redirect&bpo=42136).)
* `sqlite3.OptimizedUnicode` has been undocumented and obsolete since Python
3\.3, when it was made an alias to [`str`](../library/stdtypes.html#str "str"). It is now deprecated,
scheduled for removal in Python 3\.12\.
(Contributed by Erlend E. Aasland in [bpo\-42264](https://bugs.python.org/issue?@action=redirect&bpo=42264).)
* The undocumented built\-in function `sqlite3.enable_shared_cache` is now
deprecated, scheduled for removal in Python 3\.12\. Its use is strongly
discouraged by the SQLite3 documentation. See [the SQLite3 docs](https://sqlite.org/c3ref/enable_shared_cache.html) for more details.
If a shared cache must be used, open the database in URI mode using the
`cache=shared` query parameter.
(Contributed by Erlend E. Aasland in [bpo\-24464](https://bugs.python.org/issue?@action=redirect&bpo=24464).)
* The following `threading` methods are now deprecated:

	+ `threading.currentThread` =\> [`threading.current_thread()`](../library/threading.html#threading.current_thread "threading.current_thread")
	+ `threading.activeCount` =\> [`threading.active_count()`](../library/threading.html#threading.active_count "threading.active_count")
	+ `threading.Condition.notifyAll` =\>
	[`threading.Condition.notify_all()`](../library/threading.html#threading.Condition.notify_all "threading.Condition.notify_all")
	+ `threading.Event.isSet` =\> [`threading.Event.is_set()`](../library/threading.html#threading.Event.is_set "threading.Event.is_set")
	+ `threading.Thread.setName` =\> [`threading.Thread.name`](../library/threading.html#threading.Thread.name "threading.Thread.name")
	+ `threading.thread.getName` =\> [`threading.Thread.name`](../library/threading.html#threading.Thread.name "threading.Thread.name")
	+ `threading.Thread.isDaemon` =\> [`threading.Thread.daemon`](../library/threading.html#threading.Thread.daemon "threading.Thread.daemon")
	+ `threading.Thread.setDaemon` =\> [`threading.Thread.daemon`](../library/threading.html#threading.Thread.daemon "threading.Thread.daemon")(Contributed by Jelle Zijlstra in [gh\-87889](https://github.com/python/cpython/issues/87889).)
* `pathlib.Path.link_to()` is deprecated and slated for removal in
Python 3\.12\. Use [`pathlib.Path.hardlink_to()`](../library/pathlib.html#pathlib.Path.hardlink_to "pathlib.Path.hardlink_to") instead.
(Contributed by Barney Gale in [bpo\-39950](https://bugs.python.org/issue?@action=redirect&bpo=39950).)
* `cgi.log()` is deprecated and slated for removal in Python 3\.12\.
(Contributed by Inada Naoki in [bpo\-41139](https://bugs.python.org/issue?@action=redirect&bpo=41139).)
* The following [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") features have been deprecated since Python 3\.6,
Python 3\.7, or OpenSSL 1\.1\.0 and will be removed in 3\.11:

	+ `OP_NO_SSLv2`, `OP_NO_SSLv3`, `OP_NO_TLSv1`,
	`OP_NO_TLSv1_1`, `OP_NO_TLSv1_2`, and
	`OP_NO_TLSv1_3` are replaced by
	[`minimum_version`](../library/ssl.html#ssl.SSLContext.minimum_version "ssl.SSLContext.minimum_version") and
	[`maximum_version`](../library/ssl.html#ssl.SSLContext.maximum_version "ssl.SSLContext.maximum_version").
	+ `PROTOCOL_SSLv2`, `PROTOCOL_SSLv3`,
	`PROTOCOL_SSLv23`, `PROTOCOL_TLSv1`,
	`PROTOCOL_TLSv1_1`, `PROTOCOL_TLSv1_2`, and
	`PROTOCOL_TLS` are deprecated in favor of
	[`PROTOCOL_TLS_CLIENT`](../library/ssl.html#ssl.PROTOCOL_TLS_CLIENT "ssl.PROTOCOL_TLS_CLIENT") and [`PROTOCOL_TLS_SERVER`](../library/ssl.html#ssl.PROTOCOL_TLS_SERVER "ssl.PROTOCOL_TLS_SERVER")
	+ `wrap_socket()` is replaced by [`ssl.SSLContext.wrap_socket()`](../library/ssl.html#ssl.SSLContext.wrap_socket "ssl.SSLContext.wrap_socket")
	+ `match_hostname()`
	+ `RAND_pseudo_bytes()`, `RAND_egd()`
	+ NPN features like [`ssl.SSLSocket.selected_npn_protocol()`](../library/ssl.html#ssl.SSLSocket.selected_npn_protocol "ssl.SSLSocket.selected_npn_protocol") and
	[`ssl.SSLContext.set_npn_protocols()`](../library/ssl.html#ssl.SSLContext.set_npn_protocols "ssl.SSLContext.set_npn_protocols") are replaced by ALPN.
* The threading debug (`PYTHONTHREADDEBUG` environment variable) is
deprecated in Python 3\.10 and will be removed in Python 3\.12\. This feature
requires a [debug build of Python](../using/configure.html#debug-build).
(Contributed by Victor Stinner in [bpo\-44584](https://bugs.python.org/issue?@action=redirect&bpo=44584).)
* Importing from the `typing.io` and `typing.re` submodules will now emit
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). These submodules will be removed in a future version
of Python. Anything belonging to these submodules should be imported directly
from [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") instead.
(Contributed by Sebastian Rittau in [bpo\-38291](https://bugs.python.org/issue?@action=redirect&bpo=38291).)

## Removed[¶](#removed "Link to this heading")

* Removed special methods `__int__`, `__float__`, `__floordiv__`,
`__mod__`, `__divmod__`, `__rfloordiv__`, `__rmod__` and
`__rdivmod__` of the [`complex`](../library/functions.html#complex "complex") class. They always raised
a [`TypeError`](../library/exceptions.html#TypeError "TypeError").
(Contributed by Serhiy Storchaka in [bpo\-41974](https://bugs.python.org/issue?@action=redirect&bpo=41974).)
* The `ParserBase.error()` method from the private and undocumented `_markupbase`
module has been removed. [`html.parser.HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") is the only subclass of
`ParserBase` and its `error()` implementation was already removed in
Python 3\.5\.
(Contributed by Berker Peksag in [bpo\-31844](https://bugs.python.org/issue?@action=redirect&bpo=31844).)
* Removed the `unicodedata.ucnhash_CAPI` attribute which was an internal
PyCapsule object. The related private `_PyUnicode_Name_CAPI` structure was
moved to the internal C API.
(Contributed by Victor Stinner in [bpo\-42157](https://bugs.python.org/issue?@action=redirect&bpo=42157).)
* Removed the `parser` module, which was deprecated in 3\.9 due to the
switch to the new PEG parser, as well as all the C source and header files
that were only being used by the old parser, including `node.h`, `parser.h`,
`graminit.h` and `grammar.h`.
* Removed the Public C API functions `PyParser_SimpleParseStringFlags`,
`PyParser_SimpleParseStringFlagsFilename`,
`PyParser_SimpleParseFileFlags` and `PyNode_Compile`
that were deprecated in 3\.9 due to the switch to the new PEG parser.
* Removed the `formatter` module, which was deprecated in Python 3\.4\.
It is somewhat obsolete, little used, and not tested. It was originally
scheduled to be removed in Python 3\.6, but such removals were delayed until
after Python 2\.7 EOL. Existing users should copy whatever classes they use
into their code.
(Contributed by Donghee Na and Terry J. Reedy in [bpo\-42299](https://bugs.python.org/issue?@action=redirect&bpo=42299).)
* Removed the `PyModule_GetWarningsModule()` function that was useless
now due to the `_warnings` module was converted to a builtin module in 2\.6\.
(Contributed by Hai Shi in [bpo\-42599](https://bugs.python.org/issue?@action=redirect&bpo=42599).)
* Remove deprecated aliases to [Collections Abstract Base Classes](../library/collections.abc.html#collections-abstract-base-classes) from
the [`collections`](../library/collections.html#module-collections "collections: Container datatypes") module.
(Contributed by Victor Stinner in [bpo\-37324](https://bugs.python.org/issue?@action=redirect&bpo=37324).)
* The `loop` parameter has been removed from most of [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.")‘s
[high\-level API](../library/asyncio-api-index.html) following deprecation
in Python 3\.8\. The motivation behind this change is multifold:

	1. This simplifies the high\-level API.
	2. The functions in the high\-level API have been implicitly getting the
	current thread’s running event loop since Python 3\.7\. There isn’t a need to
	pass the event loop to the API in most normal use cases.
	3. Event loop passing is error\-prone especially when dealing with loops
	running in different threads.Note that the low\-level API will still accept `loop`.
See [Changes in the Python API](#changes-python-api) for examples of how to replace existing code.

(Contributed by Yurii Karabas, Andrew Svetlov, Yury Selivanov and Kyle Stanley
in [bpo\-42392](https://bugs.python.org/issue?@action=redirect&bpo=42392).)

## Porting to Python 3\.10[¶](#porting-to-python-3-10 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in the Python syntax[¶](#changes-in-the-python-syntax "Link to this heading")

* Deprecation warning is now emitted when compiling previously valid syntax
if the numeric literal is immediately followed by a keyword (like in `0in x`).
In future releases it will be changed to syntax warning, and finally to a
syntax error. To get rid of the warning and make the code compatible with
future releases just add a space between the numeric literal and the
following keyword.
(Contributed by Serhiy Storchaka in [bpo\-43833](https://bugs.python.org/issue?@action=redirect&bpo=43833).)

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* The *etype* parameters of the [`format_exception()`](../library/traceback.html#traceback.format_exception "traceback.format_exception"),
[`format_exception_only()`](../library/traceback.html#traceback.format_exception_only "traceback.format_exception_only"), and
[`print_exception()`](../library/traceback.html#traceback.print_exception "traceback.print_exception") functions in the [`traceback`](../library/traceback.html#module-traceback "traceback: Print or retrieve a stack traceback.") module
have been renamed to *exc*.
(Contributed by Zackery Spytz and Matthias Bussonnier in [bpo\-26389](https://bugs.python.org/issue?@action=redirect&bpo=26389).)
* [`atexit`](../library/atexit.html#module-atexit "atexit: Register and execute cleanup functions."): At Python exit, if a callback registered with
[`atexit.register()`](../library/atexit.html#atexit.register "atexit.register") fails, its exception is now logged. Previously, only
some exceptions were logged, and the last exception was always silently
ignored.
(Contributed by Victor Stinner in [bpo\-42639](https://bugs.python.org/issue?@action=redirect&bpo=42639).)
* [`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") generic now flattens type parameters, similar
to what [`typing.Callable`](../library/typing.html#typing.Callable "typing.Callable") currently does. This means that
`collections.abc.Callable[[int, str], str]` will have `__args__` of
`(int, str, str)`; previously this was `([int, str], str)`. Code which
accesses the arguments via [`typing.get_args()`](../library/typing.html#typing.get_args "typing.get_args") or `__args__` need to account
for this change. Furthermore, [`TypeError`](../library/exceptions.html#TypeError "TypeError") may be raised for invalid forms
of parameterizing [`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") which may have passed
silently in Python 3\.9\.
(Contributed by Ken Jin in [bpo\-42195](https://bugs.python.org/issue?@action=redirect&bpo=42195).)
* [`socket.htons()`](../library/socket.html#socket.htons "socket.htons") and [`socket.ntohs()`](../library/socket.html#socket.ntohs "socket.ntohs") now raise [`OverflowError`](../library/exceptions.html#OverflowError "OverflowError")
instead of [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") if the given parameter will not fit in
a 16\-bit unsigned integer.
(Contributed by Erlend E. Aasland in [bpo\-42393](https://bugs.python.org/issue?@action=redirect&bpo=42393).)
* The `loop` parameter has been removed from most of [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.")‘s
[high\-level API](../library/asyncio-api-index.html) following deprecation
in Python 3\.8\.

A coroutine that currently looks like this:

\`\`\`
async def foo(loop):
 await asyncio.sleep(1, loop=loop)

\`\`\`

Should be replaced with this:

\`\`\`
async def foo():
 await asyncio.sleep(1\)

\`\`\`

If `foo()` was specifically designed *not* to run in the current thread’s
running event loop (e.g. running in another thread’s event loop), consider
using [`asyncio.run_coroutine_threadsafe()`](../library/asyncio-task.html#asyncio.run_coroutine_threadsafe "asyncio.run_coroutine_threadsafe") instead.

(Contributed by Yurii Karabas, Andrew Svetlov, Yury Selivanov and Kyle Stanley
in [bpo\-42392](https://bugs.python.org/issue?@action=redirect&bpo=42392).)
* The [`types.FunctionType`](../library/types.html#types.FunctionType "types.FunctionType") constructor now inherits the current builtins
if the *globals* dictionary has no `"__builtins__"` key, rather than using
`{"None": None}` as builtins: same behavior as [`eval()`](../library/functions.html#eval "eval") and
[`exec()`](../library/functions.html#exec "exec") functions. Defining a function with `def function(...): ...`
in Python is not affected, globals cannot be overridden with this syntax: it
also inherits the current builtins.
(Contributed by Victor Stinner in [bpo\-42990](https://bugs.python.org/issue?@action=redirect&bpo=42990).)

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

* The C API functions `PyParser_SimpleParseStringFlags`,
`PyParser_SimpleParseStringFlagsFilename`,
`PyParser_SimpleParseFileFlags`, `PyNode_Compile` and the type
used by these functions, `struct _node`, were removed due to the switch
to the new PEG parser.

Source should be now be compiled directly to a code object using, for
example, [`Py_CompileString()`](../c-api/veryhigh.html#c.Py_CompileString "Py_CompileString"). The resulting code object can then be
evaluated using, for example, [`PyEval_EvalCode()`](../c-api/veryhigh.html#c.PyEval_EvalCode "PyEval_EvalCode").

Specifically:

	+ A call to `PyParser_SimpleParseStringFlags` followed by
	`PyNode_Compile` can be replaced by calling [`Py_CompileString()`](../c-api/veryhigh.html#c.Py_CompileString "Py_CompileString").
	+ There is no direct replacement for `PyParser_SimpleParseFileFlags`.
	To compile code from a `FILE *` argument, you will need to read
	the file in C and pass the resulting buffer to [`Py_CompileString()`](../c-api/veryhigh.html#c.Py_CompileString "Py_CompileString").
	+ To compile a file given a `char *` filename, explicitly open the file, read
	it and compile the result. One way to do this is using the [`io`](../library/io.html#module-io "io: Core tools for working with streams.")
	module with [`PyImport_ImportModule()`](../c-api/import.html#c.PyImport_ImportModule "PyImport_ImportModule"), [`PyObject_CallMethod()`](../c-api/call.html#c.PyObject_CallMethod "PyObject_CallMethod"),
	[`PyBytes_AsString()`](../c-api/bytes.html#c.PyBytes_AsString "PyBytes_AsString") and [`Py_CompileString()`](../c-api/veryhigh.html#c.Py_CompileString "Py_CompileString"),
	as sketched below. (Declarations and error handling are omitted.)

	\`\`\`
	io\_module = Import\_ImportModule("io");
	fileobject = PyObject\_CallMethod(io\_module, "open", "ss", filename, "rb");
	source\_bytes\_object = PyObject\_CallMethod(fileobject, "read", "");
	result = PyObject\_CallMethod(fileobject, "close", "");
	source\_buf = PyBytes\_AsString(source\_bytes\_object);
	code = Py\_CompileString(source\_buf, filename, Py\_file\_input);

	\`\`\`
	+ For `FrameObject` objects, the [`f_lasti`](../reference/datamodel.html#frame.f_lasti "frame.f_lasti") member now represents a wordcode
	offset instead of a simple offset into the bytecode string. This means that this
	number needs to be multiplied by 2 to be used with APIs that expect a byte offset
	instead (like [`PyCode_Addr2Line()`](../c-api/code.html#c.PyCode_Addr2Line "PyCode_Addr2Line") for example). Notice as well that the
	`f_lasti` member of `FrameObject` objects is not considered stable: please
	use [`PyFrame_GetLineNumber()`](../c-api/frame.html#c.PyFrame_GetLineNumber "PyFrame_GetLineNumber") instead.

## CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

* The `MAKE_FUNCTION` instruction now accepts either a dict or a tuple of
strings as the function’s annotations.
(Contributed by Yurii Karabas and Inada Naoki in [bpo\-42202](https://bugs.python.org/issue?@action=redirect&bpo=42202).)

## Build Changes[¶](#build-changes "Link to this heading")

* [**PEP 644**](https://peps.python.org/pep-0644/): Python now requires OpenSSL 1\.1\.1 or newer. OpenSSL 1\.0\.2 is no
longer supported.
(Contributed by Christian Heimes in [bpo\-43669](https://bugs.python.org/issue?@action=redirect&bpo=43669).)
* The C99 functions `snprintf()` and `vsnprintf()` are now required
to build Python.
(Contributed by Victor Stinner in [bpo\-36020](https://bugs.python.org/issue?@action=redirect&bpo=36020).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") requires SQLite 3\.7\.15 or higher. (Contributed by Sergey Fedoseev
and Erlend E. Aasland in [bpo\-40744](https://bugs.python.org/issue?@action=redirect&bpo=40744) and [bpo\-40810](https://bugs.python.org/issue?@action=redirect&bpo=40810).)
* The [`atexit`](../library/atexit.html#module-atexit "atexit: Register and execute cleanup functions.") module must now always be built as a built\-in module.
(Contributed by Victor Stinner in [bpo\-42639](https://bugs.python.org/issue?@action=redirect&bpo=42639).)
* Add [`--disable-test-modules`](../using/configure.html#cmdoption-disable-test-modules) option to the `configure` script:
don’t build nor install test modules.
(Contributed by Xavier de Gaye, Thomas Petazzoni and Peixing Xin in [bpo\-27640](https://bugs.python.org/issue?@action=redirect&bpo=27640).)
* Add [`--with-wheel-pkg-dir=PATH option`](../using/configure.html#cmdoption-with-wheel-pkg-dir)
to the `./configure` script. If
specified, the [`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment.") module looks for `setuptools` and `pip`
wheel packages in this directory: if both are present, these wheel packages
are used instead of ensurepip bundled wheel packages.

Some Linux distribution packaging policies recommend against bundling
dependencies. For example, Fedora installs wheel packages in the
`/usr/share/python-wheels/` directory and don’t install the
`ensurepip._bundled` package.

(Contributed by Victor Stinner in [bpo\-42856](https://bugs.python.org/issue?@action=redirect&bpo=42856).)
* Add a new [`configure --without-static-libpython option`](../using/configure.html#cmdoption-without-static-libpython) to not build the `libpythonMAJOR.MINOR.a`
static library and not install the `python.o` object file.

(Contributed by Victor Stinner in [bpo\-43103](https://bugs.python.org/issue?@action=redirect&bpo=43103).)
* The `configure` script now uses the `pkg-config` utility, if available,
to detect the location of Tcl/Tk headers and libraries. As before, those
locations can be explicitly specified with the `--with-tcltk-includes`
and `--with-tcltk-libs` configuration options.
(Contributed by Manolis Stamatogiannakis in [bpo\-42603](https://bugs.python.org/issue?@action=redirect&bpo=42603).)
* Add [`--with-openssl-rpath`](../using/configure.html#cmdoption-with-openssl-rpath) option to `configure` script. The option
simplifies building Python with a custom OpenSSL installation, e.g.
`./configure --with-openssl=/path/to/openssl --with-openssl-rpath=auto`.
(Contributed by Christian Heimes in [bpo\-43466](https://bugs.python.org/issue?@action=redirect&bpo=43466).)

## C API Changes[¶](#c-api-changes "Link to this heading")

### PEP 652: Maintaining the Stable ABI[¶](#pep-652-maintaining-the-stable-abi "Link to this heading")

The Stable ABI (Application Binary Interface) for extension modules or
embedding Python is now explicitly defined.
[C API Stability](../c-api/stable.html#stable) describes C API and ABI stability guarantees along with best
practices for using the Stable ABI.

(Contributed by Petr Viktorin in [**PEP 652**](https://peps.python.org/pep-0652/) and [bpo\-43795](https://bugs.python.org/issue?@action=redirect&bpo=43795).)

### New Features[¶](#id1 "Link to this heading")

* The result of [`PyNumber_Index()`](../c-api/number.html#c.PyNumber_Index "PyNumber_Index") now always has exact type [`int`](../library/functions.html#int "int").
Previously, the result could have been an instance of a subclass of `int`.
(Contributed by Serhiy Storchaka in [bpo\-40792](https://bugs.python.org/issue?@action=redirect&bpo=40792).)
* Add a new [`orig_argv`](../c-api/init_config.html#c.PyConfig.orig_argv "PyConfig.orig_argv") member to the [`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig")
structure: the list of the original command line arguments passed to the
Python executable.
(Contributed by Victor Stinner in [bpo\-23427](https://bugs.python.org/issue?@action=redirect&bpo=23427).)
* The [`PyDateTime_DATE_GET_TZINFO()`](../c-api/datetime.html#c.PyDateTime_DATE_GET_TZINFO "PyDateTime_DATE_GET_TZINFO") and
[`PyDateTime_TIME_GET_TZINFO()`](../c-api/datetime.html#c.PyDateTime_TIME_GET_TZINFO "PyDateTime_TIME_GET_TZINFO") macros have been added for accessing
the `tzinfo` attributes of [`datetime.datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") and
[`datetime.time`](../library/datetime.html#datetime.time "datetime.time") objects.
(Contributed by Zackery Spytz in [bpo\-30155](https://bugs.python.org/issue?@action=redirect&bpo=30155).)
* Add a [`PyCodec_Unregister()`](../c-api/codec.html#c.PyCodec_Unregister "PyCodec_Unregister") function to unregister a codec
search function.
(Contributed by Hai Shi in [bpo\-41842](https://bugs.python.org/issue?@action=redirect&bpo=41842).)
* The [`PyIter_Send()`](../c-api/iter.html#c.PyIter_Send "PyIter_Send") function was added to allow
sending value into iterator without raising `StopIteration` exception.
(Contributed by Vladimir Matveev in [bpo\-41756](https://bugs.python.org/issue?@action=redirect&bpo=41756).)
* Add [`PyUnicode_AsUTF8AndSize()`](../c-api/unicode.html#c.PyUnicode_AsUTF8AndSize "PyUnicode_AsUTF8AndSize") to the limited C API.
(Contributed by Alex Gaynor in [bpo\-41784](https://bugs.python.org/issue?@action=redirect&bpo=41784).)
* Add [`PyModule_AddObjectRef()`](../c-api/module.html#c.PyModule_AddObjectRef "PyModule_AddObjectRef") function: similar to
[`PyModule_AddObject()`](../c-api/module.html#c.PyModule_AddObject "PyModule_AddObject") but don’t steal a reference to the value on
success.
(Contributed by Victor Stinner in [bpo\-1635741](https://bugs.python.org/issue?@action=redirect&bpo=1635741).)
* Add [`Py_NewRef()`](../c-api/refcounting.html#c.Py_NewRef "Py_NewRef") and [`Py_XNewRef()`](../c-api/refcounting.html#c.Py_XNewRef "Py_XNewRef") functions to increment the
reference count of an object and return the object.
(Contributed by Victor Stinner in [bpo\-42262](https://bugs.python.org/issue?@action=redirect&bpo=42262).)
* The [`PyType_FromSpecWithBases()`](../c-api/type.html#c.PyType_FromSpecWithBases "PyType_FromSpecWithBases") and [`PyType_FromModuleAndSpec()`](../c-api/type.html#c.PyType_FromModuleAndSpec "PyType_FromModuleAndSpec")
functions now accept a single class as the *bases* argument.
(Contributed by Serhiy Storchaka in [bpo\-42423](https://bugs.python.org/issue?@action=redirect&bpo=42423).)
* The [`PyType_FromModuleAndSpec()`](../c-api/type.html#c.PyType_FromModuleAndSpec "PyType_FromModuleAndSpec") function now accepts NULL `tp_doc`
slot.
(Contributed by Hai Shi in [bpo\-41832](https://bugs.python.org/issue?@action=redirect&bpo=41832).)
* The [`PyType_GetSlot()`](../c-api/type.html#c.PyType_GetSlot "PyType_GetSlot") function can accept
[static types](../c-api/typeobj.html#static-types).
(Contributed by Hai Shi and Petr Viktorin in [bpo\-41073](https://bugs.python.org/issue?@action=redirect&bpo=41073).)
* Add a new [`PySet_CheckExact()`](../c-api/set.html#c.PySet_CheckExact "PySet_CheckExact") function to the C\-API to check if an
object is an instance of [`set`](../library/stdtypes.html#set "set") but not an instance of a subtype.
(Contributed by Pablo Galindo in [bpo\-43277](https://bugs.python.org/issue?@action=redirect&bpo=43277).)
* Add [`PyErr_SetInterruptEx()`](../c-api/exceptions.html#c.PyErr_SetInterruptEx "PyErr_SetInterruptEx") which allows passing a signal number
to simulate.
(Contributed by Antoine Pitrou in [bpo\-43356](https://bugs.python.org/issue?@action=redirect&bpo=43356).)
* The limited C API is now supported if [Python is built in debug mode](../using/configure.html#debug-build) (if the `Py_DEBUG` macro is defined). In the limited C API,
the [`Py_INCREF()`](../c-api/refcounting.html#c.Py_INCREF "Py_INCREF") and [`Py_DECREF()`](../c-api/refcounting.html#c.Py_DECREF "Py_DECREF") functions are now implemented
as opaque function
calls, rather than accessing directly the [`PyObject.ob_refcnt`](../c-api/typeobj.html#c.PyObject.ob_refcnt "PyObject.ob_refcnt")
member, if Python is built in debug mode and the `Py_LIMITED_API` macro
targets Python 3\.10 or newer. It became possible to support the limited C API
in debug mode because the [`PyObject`](../c-api/structures.html#c.PyObject "PyObject") structure is the same in release
and debug mode since Python 3\.8 (see [bpo\-36465](https://bugs.python.org/issue?@action=redirect&bpo=36465)).

The limited C API is still not supported in the [`--with-trace-refs`](../using/configure.html#cmdoption-with-trace-refs)
special build (`Py_TRACE_REFS` macro).
(Contributed by Victor Stinner in [bpo\-43688](https://bugs.python.org/issue?@action=redirect&bpo=43688).)
* Add the [`Py_Is(x, y)`](../c-api/structures.html#c.Py_Is "Py_Is") function to test if the *x* object is
the *y* object, the same as `x is y` in Python. Add also the
[`Py_IsNone()`](../c-api/structures.html#c.Py_IsNone "Py_IsNone"), [`Py_IsTrue()`](../c-api/structures.html#c.Py_IsTrue "Py_IsTrue"), [`Py_IsFalse()`](../c-api/structures.html#c.Py_IsFalse "Py_IsFalse") functions to
test if an object is, respectively, the `None` singleton, the `True`
singleton or the `False` singleton.
(Contributed by Victor Stinner in [bpo\-43753](https://bugs.python.org/issue?@action=redirect&bpo=43753).)
* Add new functions to control the garbage collector from C code:
[`PyGC_Enable()`](../c-api/gcsupport.html#c.PyGC_Enable "PyGC_Enable"),
[`PyGC_Disable()`](../c-api/gcsupport.html#c.PyGC_Disable "PyGC_Disable"),
[`PyGC_IsEnabled()`](../c-api/gcsupport.html#c.PyGC_IsEnabled "PyGC_IsEnabled").
These functions allow to activate, deactivate and query the state of the garbage collector from C code without
having to import the [`gc`](../library/gc.html#module-gc "gc: Interface to the cycle-detecting garbage collector.") module.
* Add a new [`Py_TPFLAGS_DISALLOW_INSTANTIATION`](../c-api/typeobj.html#c.Py_TPFLAGS_DISALLOW_INSTANTIATION "Py_TPFLAGS_DISALLOW_INSTANTIATION") type flag to disallow
creating type instances.
(Contributed by Victor Stinner in [bpo\-43916](https://bugs.python.org/issue?@action=redirect&bpo=43916).)
* Add a new [`Py_TPFLAGS_IMMUTABLETYPE`](../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE "Py_TPFLAGS_IMMUTABLETYPE") type flag for creating immutable
type objects: type attributes cannot be set nor deleted.
(Contributed by Victor Stinner and Erlend E. Aasland in [bpo\-43908](https://bugs.python.org/issue?@action=redirect&bpo=43908).)

### Porting to Python 3\.10[¶](#id2 "Link to this heading")

* The `PY_SSIZE_T_CLEAN` macro must now be defined to use
[`PyArg_ParseTuple()`](../c-api/arg.html#c.PyArg_ParseTuple "PyArg_ParseTuple") and [`Py_BuildValue()`](../c-api/arg.html#c.Py_BuildValue "Py_BuildValue") formats which use
`#`: `es#`, `et#`, `s#`, `u#`, `y#`, `z#`, `U#` and `Z#`.
See [Parsing arguments and building values](../c-api/arg.html#arg-parsing) and [**PEP 353**](https://peps.python.org/pep-0353/).
(Contributed by Victor Stinner in [bpo\-40943](https://bugs.python.org/issue?@action=redirect&bpo=40943).)
* Since [`Py_REFCNT()`](../c-api/refcounting.html#c.Py_REFCNT "Py_REFCNT") is changed to the inline static function,
`Py_REFCNT(obj) = new_refcnt` must be replaced with `Py_SET_REFCNT(obj, new_refcnt)`:
see [`Py_SET_REFCNT()`](../c-api/refcounting.html#c.Py_SET_REFCNT "Py_SET_REFCNT") (available since Python 3\.9\). For backward
compatibility, this macro can be used:

\`\`\`
\#if PY\_VERSION\_HEX \` header. Use the Python [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") module instead.
(Contributed by Victor Stinner in [bpo\-43244](https://bugs.python.org/issue?@action=redirect&bpo=43244).)
* Remove the compiler and parser functions using `struct _mod` type, because
the public AST C API was removed:

	+ `PyAST_Compile()`
	+ `PyAST_CompileEx()`
	+ `PyAST_CompileObject()`
	+ `PyFuture_FromAST()`
	+ `PyFuture_FromASTObject()`
	+ `PyParser_ASTFromFile()`
	+ `PyParser_ASTFromFileObject()`
	+ `PyParser_ASTFromFilename()`
	+ `PyParser_ASTFromString()`
	+ `PyParser_ASTFromStringObject()`These functions were undocumented and excluded from the limited C API.
(Contributed by Victor Stinner in [bpo\-43244](https://bugs.python.org/issue?@action=redirect&bpo=43244).)
* Remove the `pyarena.h` header file with functions:

	+ `PyArena_New()`
	+ `PyArena_Free()`
	+ `PyArena_Malloc()`
	+ `PyArena_AddPyObject()`These functions were undocumented, excluded from the limited C API, and were
only used internally by the compiler.
(Contributed by Victor Stinner in [bpo\-43244](https://bugs.python.org/issue?@action=redirect&bpo=43244).)
* The `PyThreadState.use_tracing` member has been removed to optimize Python.
(Contributed by Mark Shannon in [bpo\-43760](https://bugs.python.org/issue?@action=redirect&bpo=43760).)

## Notable security feature in 3\.10\.7[¶](#notable-security-feature-in-3-10-7 "Link to this heading")

Converting between [`int`](../library/functions.html#int "int") and [`str`](../library/stdtypes.html#str "str") in bases other than 2
(binary), 4, 8 (octal), 16 (hexadecimal), or 32 such as base 10 (decimal)
now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the number of digits in string form is
above a limit to avoid potential denial of service attacks due to the
algorithmic complexity. This is a mitigation for [**CVE 2020\-10735**](https://www.cve.org/CVERecord?id=CVE-2020-10735).
This limit can be configured or disabled by environment variable, command
line flag, or [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") APIs. See the [integer string conversion
length limitation](../library/stdtypes.html#int-max-str-digits) documentation. The default limit
is 4300 digits in string form.

## Notable security feature in 3\.10\.8[¶](#notable-security-feature-in-3-10-8 "Link to this heading")

The deprecated `mailcap` module now refuses to inject unsafe text
(filenames, MIME types, parameters) into shell commands. Instead of using such
text, it will warn and act as if a match was not found (or for test commands,
as if the test failed).
(Contributed by Petr Viktorin in [gh\-98966](https://github.com/python/cpython/issues/98966).)

## Notable changes in 3\.10\.12[¶](#notable-changes-in-3-10-12 "Link to this heading")

### tarfile[¶](#tarfile "Link to this heading")

* The extraction methods in [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), and [`shutil.unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"),
have a new a *filter* argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See [Extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
In Python 3\.12, use without the *filter* argument will show a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
In Python 3\.14, the default will switch to `'data'`.
(Contributed by Petr Viktorin in [**PEP 706**](https://peps.python.org/pep-0706/).)

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.10](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [Parenthesized context managers](#parenthesized-context-managers)
		- [Better error messages](#better-error-messages)
			* [SyntaxErrors](#syntaxerrors)
			* [IndentationErrors](#indentationerrors)
			* [AttributeErrors](#attributeerrors)
			* [NameErrors](#nameerrors)
		- [PEP 626: Precise line numbers for debugging and other tools](#pep-626-precise-line-numbers-for-debugging-and-other-tools)
		- [PEP 634: Structural Pattern Matching](#pep-634-structural-pattern-matching)
			* [Syntax and operations](#syntax-and-operations)
			* [Declarative approach](#declarative-approach)
			* [Simple pattern: match to a literal](#simple-pattern-match-to-a-literal)
				+ [Behavior without the wildcard](#behavior-without-the-wildcard)
			* [Patterns with a literal and variable](#patterns-with-a-literal-and-variable)
			* [Patterns and classes](#patterns-and-classes)
				+ [Patterns with positional parameters](#patterns-with-positional-parameters)
			* [Nested patterns](#nested-patterns)
			* [Complex patterns and the wildcard](#complex-patterns-and-the-wildcard)
			* [Guard](#guard)
			* [Other Key Features](#other-key-features)
		- [Optional `EncodingWarning` and `encoding="locale"` option](#optional-encodingwarning-and-encoding-locale-option)
	+ [New Features Related to Type Hints](#new-features-related-to-type-hints)
		- [PEP 604: New Type Union Operator](#pep-604-new-type-union-operator)
		- [PEP 612: Parameter Specification Variables](#pep-612-parameter-specification-variables)
		- [PEP 613: TypeAlias](#pep-613-typealias)
		- [PEP 647: User\-Defined Type Guards](#pep-647-user-defined-type-guards)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
	+ [Improved Modules](#improved-modules)
		- [asyncio](#asyncio)
		- [argparse](#argparse)
		- [array](#array)
		- [asynchat, asyncore, smtpd](#asynchat-asyncore-smtpd)
		- [base64](#base64)
		- [bdb](#bdb)
		- [bisect](#bisect)
		- [codecs](#codecs)
		- [collections.abc](#collections-abc)
		- [contextlib](#contextlib)
		- [curses](#curses)
		- [dataclasses](#dataclasses)
			* [\_\_slots\_\_](#slots)
			* [Keyword\-only fields](#keyword-only-fields)
		- [distutils](#distutils)
		- [doctest](#doctest)
		- [encodings](#encodings)
		- [enum](#enum)
		- [fileinput](#fileinput)
		- [faulthandler](#faulthandler)
		- [gc](#gc)
		- [glob](#glob)
		- [hashlib](#hashlib)
		- [hmac](#hmac)
		- [IDLE and idlelib](#idle-and-idlelib)
		- [importlib.metadata](#importlib-metadata)
		- [inspect](#inspect)
		- [itertools](#itertools)
		- [linecache](#linecache)
		- [os](#os)
		- [os.path](#os-path)
		- [pathlib](#pathlib)
		- [platform](#platform)
		- [pprint](#pprint)
		- [py\_compile](#py-compile)
		- [pyclbr](#pyclbr)
		- [shelve](#shelve)
		- [statistics](#statistics)
		- [site](#site)
		- [socket](#socket)
		- [ssl](#ssl)
		- [sqlite3](#sqlite3)
		- [sys](#sys)
		- [\_thread](#thread)
		- [threading](#threading)
		- [traceback](#traceback)
		- [types](#types)
		- [typing](#typing)
		- [unittest](#unittest)
		- [urllib.parse](#urllib-parse)
		- [xml](#xml)
		- [zipimport](#zipimport)
	+ [Optimizations](#optimizations)
	+ [Deprecated](#deprecated)
	+ [Removed](#removed)
	+ [Porting to Python 3\.10](#porting-to-python-3-10)
		- [Changes in the Python syntax](#changes-in-the-python-syntax)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
	+ [CPython bytecode changes](#cpython-bytecode-changes)
	+ [Build Changes](#build-changes)
	+ [C API Changes](#c-api-changes)
		- [PEP 652: Maintaining the Stable ABI](#pep-652-maintaining-the-stable-abi)
		- [New Features](#id1)
		- [Porting to Python 3\.10](#id2)
		- [Deprecated](#id3)
		- [Removed](#id4)
	+ [Notable security feature in 3\.10\.7](#notable-security-feature-in-3-10-7)
	+ [Notable security feature in 3\.10\.8](#notable-security-feature-in-3-10-8)
	+ [Notable changes in 3\.10\.12](#notable-changes-in-3-10-12)
		- [tarfile](#tarfile)

#### Previous topic

[What’s New In Python 3\.11](3.11.html "previous chapter")

#### Next topic

[What’s New In Python 3\.9](3.9.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.10.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.9.html "What’s New In Python 3.9") \|
* [previous](3.11.html "What’s New In Python 3.11") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.10
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.11 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.11.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.10.html "What’s New In Python 3.10") \|
* [previous](3.12.html "What’s New In Python 3.12") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.11
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.11[¶](#what-s-new-in-python-3-11 "Link to this heading")

Editor:
Pablo Galindo Salgado

This article explains the new features in Python 3\.11, compared to 3\.10\.
Python 3\.11 was released on October 24, 2022\.
For full details, see the [changelog](changelog.html#changelog).

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

* Python 3\.11 is between 10\-60% faster than Python 3\.10\.
On average, we measured a 1\.25x speedup on the standard benchmark suite.
See [Faster CPython](#whatsnew311-faster-cpython) for details.

New syntax features:

* [PEP 654: Exception Groups and except\*](#whatsnew311-pep654)

New built\-in features:

* [PEP 678: Exceptions can be enriched with notes](#whatsnew311-pep678)

New standard library modules:

* [**PEP 680**](https://peps.python.org/pep-0680/): [`tomllib`](../library/tomllib.html#module-tomllib "tomllib: Parse TOML files.") —
Support for parsing [TOML](https://toml.io/) in the Standard Library

Interpreter improvements:

* [PEP 657: Fine\-grained error locations in tracebacks](#whatsnew311-pep657)
* New [`-P`](../using/cmdline.html#cmdoption-P) command line option and [`PYTHONSAFEPATH`](../using/cmdline.html#envvar-PYTHONSAFEPATH) environment
variable to [disable automatically prepending potentially unsafe paths](#whatsnew311-pythonsafepath) to [`sys.path`](../library/sys.html#sys.path "sys.path")

New typing features:

* [PEP 646: Variadic generics](#whatsnew311-pep646)
* [PEP 655: Marking individual TypedDict items as required or not\-required](#whatsnew311-pep655)
* [PEP 673: Self type](#whatsnew311-pep673)
* [PEP 675: Arbitrary literal string type](#whatsnew311-pep675)
* [PEP 681: Data class transforms](#whatsnew311-pep681)

Important deprecations, removals and restrictions:

* [**PEP 594**](https://peps.python.org/pep-0594/):
[Many legacy standard library modules have been deprecated](#whatsnew311-pep594) and will be removed in Python 3\.13
* [**PEP 624**](https://peps.python.org/pep-0624/):
[Py\_UNICODE encoder APIs have been removed](#whatsnew311-pep624)
* [**PEP 670**](https://peps.python.org/pep-0670/):
[Macros converted to static inline functions](#whatsnew311-pep670)

## New Features[¶](#new-features "Link to this heading")

### PEP 657: Fine\-grained error locations in tracebacks[¶](#pep-657-fine-grained-error-locations-in-tracebacks "Link to this heading")

When printing tracebacks, the interpreter will now point to the exact expression
that caused the error, instead of just the line. For example:

\`\`\`
Traceback (most recent call last):
 File "distance.py", line 11, in \
 print(manhattan\_distance(p1, p2\))
 ^^^^^^^^^^^^^^^^^^^^^^^^^^
 File "distance.py", line 6, in manhattan\_distance
 return abs(point\_1\.x \- point\_2\.x) \+ abs(point\_1\.y \- point\_2\.y)
 ^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'x'

\`\`\`

Previous versions of the interpreter would point to just the line, making it
ambiguous which object was `None`. These enhanced errors can also be helpful
when dealing with deeply nested [`dict`](../library/stdtypes.html#dict "dict") objects and multiple function calls:

\`\`\`
Traceback (most recent call last):
 File "query.py", line 37, in \
 magic\_arithmetic('foo')
 File "query.py", line 18, in magic\_arithmetic
 return add\_counts(x) / 25
 ^^^^^^^^^^^^^
 File "query.py", line 24, in add\_counts
 return 25 \+ query\_user(user1\) \+ query\_user(user2\)
 ^^^^^^^^^^^^^^^^^
 File "query.py", line 32, in query\_user
 return 1 \+ query\_count(db, response\['a']\['b']\['c']\['user'], retry=True)
 \~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~^^^^^
TypeError: 'NoneType' object is not subscriptable

\`\`\`

As well as complex arithmetic expressions:

\`\`\`
Traceback (most recent call last):
 File "calculation.py", line 54, in \
 result = (x / y / z) \* (a / b / c)
 \~\~\~\~\~\~^\~\~
ZeroDivisionError: division by zero

\`\`\`

Additionally, the information used by the enhanced traceback feature
is made available via a general API, that can be used to correlate
[bytecode](../glossary.html#term-bytecode) [instructions](../library/dis.html#bytecodes) with source code location.
This information can be retrieved using:

* The [`codeobject.co_positions()`](../reference/datamodel.html#codeobject.co_positions "codeobject.co_positions") method in Python.
* The [`PyCode_Addr2Location()`](../c-api/code.html#c.PyCode_Addr2Location "PyCode_Addr2Location") function in the C API.

See [**PEP 657**](https://peps.python.org/pep-0657/) for more details. (Contributed by Pablo Galindo, Batuhan Taskaya
and Ammar Askar in [bpo\-43950](https://bugs.python.org/issue?@action=redirect&bpo=43950).)

Note

This feature requires storing column positions in [Code Objects](../c-api/code.html#codeobjects),
which may result in a small increase in interpreter memory usage
and disk usage for compiled Python files.
To avoid storing the extra information
and deactivate printing the extra traceback information,
use the [`-X no_debug_ranges`](../using/cmdline.html#cmdoption-X) command line option
or the [`PYTHONNODEBUGRANGES`](../using/cmdline.html#envvar-PYTHONNODEBUGRANGES) environment variable.

### PEP 654: Exception Groups and `except*`[¶](#pep-654-exception-groups-and-except "Link to this heading")

[**PEP 654**](https://peps.python.org/pep-0654/) introduces language features that enable a program
to raise and handle multiple unrelated exceptions simultaneously.
The builtin types [`ExceptionGroup`](../library/exceptions.html#ExceptionGroup "ExceptionGroup") and [`BaseExceptionGroup`](../library/exceptions.html#BaseExceptionGroup "BaseExceptionGroup")
make it possible to group exceptions and raise them together,
and the new [`except*`](../reference/compound_stmts.html#except-star) syntax generalizes
[`except`](../reference/compound_stmts.html#except) to match subgroups of exception groups.

See [**PEP 654**](https://peps.python.org/pep-0654/) for more details.

(Contributed by Irit Katriel in [bpo\-45292](https://bugs.python.org/issue?@action=redirect&bpo=45292). PEP written by
Irit Katriel, Yury Selivanov and Guido van Rossum.)

### PEP 678: Exceptions can be enriched with notes[¶](#pep-678-exceptions-can-be-enriched-with-notes "Link to this heading")

The [`add_note()`](../library/exceptions.html#BaseException.add_note "BaseException.add_note") method is added to [`BaseException`](../library/exceptions.html#BaseException "BaseException").
It can be used to enrich exceptions with context information
that is not available at the time when the exception is raised.
The added notes appear in the default traceback.

See [**PEP 678**](https://peps.python.org/pep-0678/) for more details.

(Contributed by Irit Katriel in [bpo\-45607](https://bugs.python.org/issue?@action=redirect&bpo=45607).
PEP written by Zac Hatfield\-Dodds.)

### Windows `py.exe` launcher improvements[¶](#windows-py-exe-launcher-improvements "Link to this heading")

The copy of the [Python Launcher for Windows](../using/windows.html#launcher) included with Python 3\.11 has been significantly
updated. It now supports company/tag syntax as defined in [**PEP 514**](https://peps.python.org/pep-0514/) using the
`-V:/` argument instead of the limited `-.`.
This allows launching distributions other than `PythonCore`,
the one hosted on [python.org](https://www.python.org).

When using `-V:` selectors, either company or tag can be omitted, but all
installs will be searched. For example, `-V:OtherPython/` will select the
“best” tag registered for `OtherPython`, while `-V:3.11` or `-V:/3.11`
will select the “best” distribution with tag `3.11`.

When using the legacy `-`, `-.`,
`--` or `-.-` arguments,
all existing behaviour should be preserved from past versions,
and only releases from `PythonCore` will be selected.
However, the `-64` suffix now implies “not 32\-bit” (not necessarily x86\-64\),
as there are multiple supported 64\-bit platforms.
32\-bit runtimes are detected by checking the runtime’s tag for a `-32` suffix.
All releases of Python since 3\.5 have included this in their 32\-bit builds.

## New Features Related to Type Hints[¶](#new-features-related-to-type-hints "Link to this heading")

This section covers major changes affecting [**PEP 484**](https://peps.python.org/pep-0484/) type hints and
the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module.

### PEP 646: Variadic generics[¶](#pep-646-variadic-generics "Link to this heading")

[**PEP 484**](https://peps.python.org/pep-0484/) previously introduced [`TypeVar`](../library/typing.html#typing.TypeVar "typing.TypeVar"), enabling creation
of generics parameterised with a single type. [**PEP 646**](https://peps.python.org/pep-0646/) adds
[`TypeVarTuple`](../library/typing.html#typing.TypeVarTuple "typing.TypeVarTuple"), enabling parameterisation
with an *arbitrary* number of types. In other words,
a [`TypeVarTuple`](../library/typing.html#typing.TypeVarTuple "typing.TypeVarTuple") is a *variadic* type variable,
enabling *variadic* generics.

This enables a wide variety of use cases.
In particular, it allows the type of array\-like structures
in numerical computing libraries such as NumPy and TensorFlow to be
parameterised with the array *shape*. Static type checkers will now
be able to catch shape\-related bugs in code that uses these libraries.

See [**PEP 646**](https://peps.python.org/pep-0646/) for more details.

(Contributed by Matthew Rahtz in [bpo\-43224](https://bugs.python.org/issue?@action=redirect&bpo=43224), with contributions by
Serhiy Storchaka and Jelle Zijlstra. PEP written by Mark Mendoza, Matthew
Rahtz, Pradeep Kumar Srinivasan, and Vincent Siles.)

### PEP 655: Marking individual `TypedDict` items as required or not\-required[¶](#pep-655-marking-individual-typeddict-items-as-required-or-not-required "Link to this heading")

[`Required`](../library/typing.html#typing.Required "typing.Required") and [`NotRequired`](../library/typing.html#typing.NotRequired "typing.NotRequired") provide a
straightforward way to mark whether individual items in a
[`TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") must be present. Previously, this was only possible
using inheritance.

All fields are still required by default,
unless the *total* parameter is set to `False`,
in which case all fields are still not\-required by default.
For example, the following specifies a `TypedDict`
with one required and one not\-required key:

\`\`\`
class Movie(TypedDict):
 title: str
 year: NotRequired\[int]

m1: Movie = {"title": "Black Panther", "year": 2018} \# OK
m2: Movie = {"title": "Star Wars"} \# OK (year is not required)
m3: Movie = {"year": 2022} \# ERROR (missing required field title)

\`\`\`

The following definition is equivalent:

\`\`\`
class Movie(TypedDict, total=False):
 title: Required\[str]
 year: int

\`\`\`

See [**PEP 655**](https://peps.python.org/pep-0655/) for more details.

(Contributed by David Foster and Jelle Zijlstra in [bpo\-47087](https://bugs.python.org/issue?@action=redirect&bpo=47087). PEP
written by David Foster.)

### PEP 673: `Self` type[¶](#pep-673-self-type "Link to this heading")

The new [`Self`](../library/typing.html#typing.Self "typing.Self") annotation provides a simple and intuitive
way to annotate methods that return an instance of their class. This
behaves the same as the [`TypeVar`](../library/typing.html#typing.TypeVar "typing.TypeVar")\-based approach
[**specified in PEP 484**](https://peps.python.org/pep-0484/#annotating-instance-and-class-methods),
but is more concise and easier to follow.

Common use cases include alternative constructors provided as
[`classmethod`](../library/functions.html#classmethod "classmethod")s,
and [`__enter__()`](../reference/datamodel.html#object.__enter__ "object.__enter__") methods that return `self`:

\`\`\`
class MyLock:
 def \_\_enter\_\_(self) \-\> Self:
 self.lock()
 return self

 ...

class MyInt:
 @classmethod
 def fromhex(cls, s: str) \-\> Self:
 return cls(int(s, 16\))

 ...

\`\`\`

[`Self`](../library/typing.html#typing.Self "typing.Self") can also be used to annotate method parameters
or attributes of the same type as their enclosing class.

See [**PEP 673**](https://peps.python.org/pep-0673/) for more details.

(Contributed by James Hilton\-Balfe in [bpo\-46534](https://bugs.python.org/issue?@action=redirect&bpo=46534). PEP written by
Pradeep Kumar Srinivasan and James Hilton\-Balfe.)

### PEP 675: Arbitrary literal string type[¶](#pep-675-arbitrary-literal-string-type "Link to this heading")

The new [`LiteralString`](../library/typing.html#typing.LiteralString "typing.LiteralString") annotation may be used to indicate
that a function parameter can be of any literal string type. This allows
a function to accept arbitrary literal string types, as well as strings
created from other literal strings. Type checkers can then
enforce that sensitive functions, such as those that execute SQL
statements or shell commands, are called only with static arguments,
providing protection against injection attacks.

For example, a SQL query function could be annotated as follows:

\`\`\`
def run\_query(sql: LiteralString) \-\> ...
 ...

def caller(
 arbitrary\_string: str,
 query\_string: LiteralString,
 table\_name: LiteralString,
) \-\> None:
 run\_query("SELECT \* FROM students") \# ok
 run\_query(query\_string) \# ok
 run\_query("SELECT \* FROM " \+ table\_name) \# ok
 run\_query(arbitrary\_string) \# type checker error
 run\_query( \# type checker error
 f"SELECT \* FROM students WHERE name = {arbitrary\_string}"
 )

\`\`\`

See [**PEP 675**](https://peps.python.org/pep-0675/) for more details.

(Contributed by Jelle Zijlstra in [bpo\-47088](https://bugs.python.org/issue?@action=redirect&bpo=47088). PEP written by Pradeep
Kumar Srinivasan and Graham Bleaney.)

### PEP 681: Data class transforms[¶](#pep-681-data-class-transforms "Link to this heading")

[`dataclass_transform`](../library/typing.html#typing.dataclass_transform "typing.dataclass_transform") may be used to
decorate a class, metaclass, or a function that is itself a decorator.
The presence of `@dataclass_transform()` tells a static type checker that the
decorated object performs runtime “magic” that transforms a class,
giving it [`dataclass`](../library/dataclasses.html#dataclasses.dataclass "dataclasses.dataclass")\-like behaviors.

For example:

\`\`\`
\# The create\_model decorator is defined by a library.
@typing.dataclass\_transform()
def create\_model(cls: Type\[T]) \-\> Type\[T]:
 cls.\_\_init\_\_ = ...
 cls.\_\_eq\_\_ = ...
 cls.\_\_ne\_\_ = ...
 return cls

\# The create\_model decorator can now be used to create new model classes:
@create\_model
class CustomerModel:
 id: int
 name: str

c = CustomerModel(id=327, name="Eric Idle")

\`\`\`

See [**PEP 681**](https://peps.python.org/pep-0681/) for more details.

(Contributed by Jelle Zijlstra in [gh\-91860](https://github.com/python/cpython/issues/91860). PEP written by
Erik De Bonte and Eric Traut.)

### PEP 563 may not be the future[¶](#pep-563-may-not-be-the-future "Link to this heading")

[**PEP 563**](https://peps.python.org/pep-0563/) Postponed Evaluation of Annotations
(the `from __future__ import annotations` [future statement](../reference/simple_stmts.html#future))
that was originally planned for release in Python 3\.10
has been put on hold indefinitely.
See [this message from the Steering Council](https://mail.python.org/archives/list/python-dev@python.org/message/VIZEBX5EYMSYIJNDBF6DMUMZOCWHARSO/)
for more information.

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* Starred unpacking expressions can now be used in [`for`](../reference/compound_stmts.html#for) statements.
(See [bpo\-46725](https://bugs.python.org/issue?@action=redirect&bpo=46725) for more details.)
* Asynchronous [comprehensions](../reference/expressions.html#comprehensions) are now allowed
inside comprehensions in [asynchronous functions](../reference/compound_stmts.html#async-def).
Outer comprehensions implicitly become asynchronous in this case.
(Contributed by Serhiy Storchaka in [bpo\-33346](https://bugs.python.org/issue?@action=redirect&bpo=33346).)
* A [`TypeError`](../library/exceptions.html#TypeError "TypeError") is now raised instead of an [`AttributeError`](../library/exceptions.html#AttributeError "AttributeError") in
[`with`](../reference/compound_stmts.html#with) statements and [`contextlib.ExitStack.enter_context()`](../library/contextlib.html#contextlib.ExitStack.enter_context "contextlib.ExitStack.enter_context")
for objects that do not support the [context manager](../glossary.html#term-context-manager) protocol,
and in [`async with`](../reference/compound_stmts.html#async-with) statements and
[`contextlib.AsyncExitStack.enter_async_context()`](../library/contextlib.html#contextlib.AsyncExitStack.enter_async_context "contextlib.AsyncExitStack.enter_async_context")
for objects not supporting the [asynchronous context manager](../glossary.html#term-asynchronous-context-manager) protocol.
(Contributed by Serhiy Storchaka in [bpo\-12022](https://bugs.python.org/issue?@action=redirect&bpo=12022) and [bpo\-44471](https://bugs.python.org/issue?@action=redirect&bpo=44471).)
* Added [`object.__getstate__()`](../library/pickle.html#object.__getstate__ "object.__getstate__"), which provides the default
implementation of the `__getstate__()` method. [`copy`](../library/copy.html#module-copy "copy: Shallow and deep copy operations.")ing
and [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.")ing instances of subclasses of builtin types
[`bytearray`](../library/stdtypes.html#bytearray "bytearray"), [`set`](../library/stdtypes.html#set "set"), [`frozenset`](../library/stdtypes.html#frozenset "frozenset"),
[`collections.OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict"), [`collections.deque`](../library/collections.html#collections.deque "collections.deque"),
[`weakref.WeakSet`](../library/weakref.html#weakref.WeakSet "weakref.WeakSet"), and [`datetime.tzinfo`](../library/datetime.html#datetime.tzinfo "datetime.tzinfo") now copies and
pickles instance attributes implemented as [slots](../glossary.html#term-__slots__).
This change has an unintended side effect: It trips up a small minority
of existing Python projects not expecting [`object.__getstate__()`](../library/pickle.html#object.__getstate__ "object.__getstate__") to
exist. See the later comments on [gh\-70766](https://github.com/python/cpython/issues/70766) for discussions of what
workarounds such code may need.
(Contributed by Serhiy Storchaka in [bpo\-26579](https://bugs.python.org/issue?@action=redirect&bpo=26579).)

* Added a [`-P`](../using/cmdline.html#cmdoption-P) command line option
and a [`PYTHONSAFEPATH`](../using/cmdline.html#envvar-PYTHONSAFEPATH) environment variable,
which disable the automatic prepending to [`sys.path`](../library/sys.html#sys.path "sys.path")
of the script’s directory when running a script,
or the current directory when using [`-c`](../using/cmdline.html#cmdoption-c) and [`-m`](../using/cmdline.html#cmdoption-m).
This ensures only stdlib and installed modules
are picked up by [`import`](../reference/simple_stmts.html#import),
and avoids unintentionally or maliciously shadowing modules
with those in a local (and typically user\-writable) directory.
(Contributed by Victor Stinner in [gh\-57684](https://github.com/python/cpython/issues/57684).)
* A `"z"` option was added to the [Format Specification Mini\-Language](../library/string.html#formatspec) that
coerces negative to positive zero after rounding to the format precision.
See [**PEP 682**](https://peps.python.org/pep-0682/) for more details.
(Contributed by John Belmonte in [gh\-90153](https://github.com/python/cpython/issues/90153).)
* Bytes are no longer accepted on [`sys.path`](../library/sys.html#sys.path "sys.path"). Support broke sometime
between Python 3\.2 and 3\.6, with no one noticing until after Python 3\.10\.0
was released. In addition, bringing back support would be problematic due to
interactions between [`-b`](../using/cmdline.html#cmdoption-b) and [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") when
there is a mixture of [`str`](../library/stdtypes.html#str "str") and [`bytes`](../library/stdtypes.html#bytes "bytes") keys.
(Contributed by Thomas Grainger in [gh\-91181](https://github.com/python/cpython/issues/91181).)

## Other CPython Implementation Changes[¶](#other-cpython-implementation-changes "Link to this heading")

* The special methods [`__complex__()`](../reference/datamodel.html#object.__complex__ "object.__complex__") for [`complex`](../library/functions.html#complex "complex")
and [`__bytes__()`](../reference/datamodel.html#object.__bytes__ "object.__bytes__") for [`bytes`](../library/stdtypes.html#bytes "bytes") are implemented to support
the [`typing.SupportsComplex`](../library/typing.html#typing.SupportsComplex "typing.SupportsComplex") and [`typing.SupportsBytes`](../library/typing.html#typing.SupportsBytes "typing.SupportsBytes") protocols.
(Contributed by Mark Dickinson and Donghee Na in [bpo\-24234](https://bugs.python.org/issue?@action=redirect&bpo=24234).)
* `siphash13` is added as a new internal hashing algorithm.
It has similar security properties as `siphash24`,
but it is slightly faster for long inputs.
[`str`](../library/stdtypes.html#str "str"), [`bytes`](../library/stdtypes.html#bytes "bytes"), and some other types
now use it as the default algorithm for [`hash()`](../library/functions.html#hash "hash").
[**PEP 552**](https://peps.python.org/pep-0552/) [hash\-based .pyc files](../reference/import.html#pyc-invalidation)
now use `siphash13` too.
(Contributed by Inada Naoki in [bpo\-29410](https://bugs.python.org/issue?@action=redirect&bpo=29410).)
* When an active exception is re\-raised by a [`raise`](../reference/simple_stmts.html#raise) statement with no parameters,
the traceback attached to this exception is now always `sys.exc_info()[1].__traceback__`.
This means that changes made to the traceback in the current [`except`](../reference/compound_stmts.html#except) clause are
reflected in the re\-raised exception.
(Contributed by Irit Katriel in [bpo\-45711](https://bugs.python.org/issue?@action=redirect&bpo=45711).)
* The interpreter state’s representation of handled exceptions
(aka `exc_info` or `_PyErr_StackItem`)
now only has the `exc_value` field; `exc_type` and `exc_traceback`
have been removed, as they can be derived from `exc_value`.
(Contributed by Irit Katriel in [bpo\-45711](https://bugs.python.org/issue?@action=redirect&bpo=45711).)
* A new [command line option](../using/windows.html#install-quiet-option), `AppendPath`,
has been added for the Windows installer.
It behaves similarly to `PrependPath`,
but appends the install and scripts directories instead of prepending them.
(Contributed by Bastian Neuburger in [bpo\-44934](https://bugs.python.org/issue?@action=redirect&bpo=44934).)
* The [`PyConfig.module_search_paths_set`](../c-api/init_config.html#c.PyConfig.module_search_paths_set "PyConfig.module_search_paths_set") field must now be set to `1` for
initialization to use [`PyConfig.module_search_paths`](../c-api/init_config.html#c.PyConfig.module_search_paths "PyConfig.module_search_paths") to initialize
[`sys.path`](../library/sys.html#sys.path "sys.path"). Otherwise, initialization will recalculate the path and replace
any values added to `module_search_paths`.
* The output of the [`--help`](../using/cmdline.html#cmdoption-help) option now fits in 50 lines/80 columns.
Information about [Python environment variables](../using/cmdline.html#using-on-envvars)
and [`-X`](../using/cmdline.html#cmdoption-X) options is now available using the respective
[`--help-env`](../using/cmdline.html#cmdoption-help-env) and [`--help-xoptions`](../using/cmdline.html#cmdoption-help-xoptions) flags,
and with the new [`--help-all`](../using/cmdline.html#cmdoption-help-all).
(Contributed by Éric Araujo in [bpo\-46142](https://bugs.python.org/issue?@action=redirect&bpo=46142).)
* Converting between [`int`](../library/functions.html#int "int") and [`str`](../library/stdtypes.html#str "str") in bases other than 2
(binary), 4, 8 (octal), 16 (hexadecimal), or 32 such as base 10 (decimal)
now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the number of digits in string form is
above a limit to avoid potential denial of service attacks due to the
algorithmic complexity. This is a mitigation for [**CVE 2020\-10735**](https://www.cve.org/CVERecord?id=CVE-2020-10735).
This limit can be configured or disabled by environment variable, command
line flag, or [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") APIs. See the [integer string conversion
length limitation](../library/stdtypes.html#int-max-str-digits) documentation. The default limit
is 4300 digits in string form.

## New Modules[¶](#new-modules "Link to this heading")

* [`tomllib`](../library/tomllib.html#module-tomllib "tomllib: Parse TOML files."): For parsing [TOML](https://toml.io/).
See [**PEP 680**](https://peps.python.org/pep-0680/) for more details.
(Contributed by Taneli Hukkinen in [bpo\-40059](https://bugs.python.org/issue?@action=redirect&bpo=40059).)
* [`wsgiref.types`](../library/wsgiref.html#module-wsgiref.types "wsgiref.types: WSGI types for static type checking"):
[**WSGI**](https://peps.python.org/pep-3333/)\-specific types for static type checking.
(Contributed by Sebastian Rittau in [bpo\-42012](https://bugs.python.org/issue?@action=redirect&bpo=42012).)

## Improved Modules[¶](#improved-modules "Link to this heading")

### asyncio[¶](#asyncio "Link to this heading")

* Added the [`TaskGroup`](../library/asyncio-task.html#asyncio.TaskGroup "asyncio.TaskGroup") class,
an [asynchronous context manager](../reference/datamodel.html#async-context-managers)
holding a group of tasks that will wait for all of them upon exit.
For new code this is recommended over using
[`create_task()`](../library/asyncio-task.html#asyncio.create_task "asyncio.create_task") and [`gather()`](../library/asyncio-task.html#asyncio.gather "asyncio.gather") directly.
(Contributed by Yury Selivanov and others in [gh\-90908](https://github.com/python/cpython/issues/90908).)
* Added [`timeout()`](../library/asyncio-task.html#asyncio.timeout "asyncio.timeout"), an asynchronous context manager for
setting a timeout on asynchronous operations. For new code this is
recommended over using [`wait_for()`](../library/asyncio-task.html#asyncio.wait_for "asyncio.wait_for") directly.
(Contributed by Andrew Svetlov in [gh\-90927](https://github.com/python/cpython/issues/90927).)
* Added the [`Runner`](../library/asyncio-runner.html#asyncio.Runner "asyncio.Runner") class, which exposes the machinery
used by [`run()`](../library/asyncio-runner.html#asyncio.run "asyncio.run").
(Contributed by Andrew Svetlov in [gh\-91218](https://github.com/python/cpython/issues/91218).)
* Added the [`Barrier`](../library/asyncio-sync.html#asyncio.Barrier "asyncio.Barrier") class to the synchronization
primitives in the asyncio library, and the related
[`BrokenBarrierError`](../library/asyncio-sync.html#asyncio.BrokenBarrierError "asyncio.BrokenBarrierError") exception.
(Contributed by Yves Duprat and Andrew Svetlov in [gh\-87518](https://github.com/python/cpython/issues/87518).)
* Added keyword argument *all\_errors* to [`asyncio.loop.create_connection()`](../library/asyncio-eventloop.html#asyncio.loop.create_connection "asyncio.loop.create_connection")
so that multiple connection errors can be raised as an [`ExceptionGroup`](../library/exceptions.html#ExceptionGroup "ExceptionGroup").
* Added the [`asyncio.StreamWriter.start_tls()`](../library/asyncio-stream.html#asyncio.StreamWriter.start_tls "asyncio.StreamWriter.start_tls") method for
upgrading existing stream\-based connections to TLS.
(Contributed by Ian Good in [bpo\-34975](https://bugs.python.org/issue?@action=redirect&bpo=34975).)
* Added raw datagram socket functions to the event loop:
[`sock_sendto()`](../library/asyncio-eventloop.html#asyncio.loop.sock_sendto "asyncio.loop.sock_sendto"),
[`sock_recvfrom()`](../library/asyncio-eventloop.html#asyncio.loop.sock_recvfrom "asyncio.loop.sock_recvfrom") and
[`sock_recvfrom_into()`](../library/asyncio-eventloop.html#asyncio.loop.sock_recvfrom_into "asyncio.loop.sock_recvfrom_into").
These have implementations in [`SelectorEventLoop`](../library/asyncio-eventloop.html#asyncio.SelectorEventLoop "asyncio.SelectorEventLoop") and
[`ProactorEventLoop`](../library/asyncio-eventloop.html#asyncio.ProactorEventLoop "asyncio.ProactorEventLoop").
(Contributed by Alex Grönholm in [bpo\-46805](https://bugs.python.org/issue?@action=redirect&bpo=46805).)
* Added [`cancelling()`](../library/asyncio-task.html#asyncio.Task.cancelling "asyncio.Task.cancelling") and
[`uncancel()`](../library/asyncio-task.html#asyncio.Task.uncancel "asyncio.Task.uncancel") methods to [`Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task").
These are primarily intended for internal use,
notably by [`TaskGroup`](../library/asyncio-task.html#asyncio.TaskGroup "asyncio.TaskGroup").

### contextlib[¶](#contextlib "Link to this heading")

* Added non parallel\-safe [`chdir()`](../library/contextlib.html#contextlib.chdir "contextlib.chdir") context manager to change
the current working directory and then restore it on exit. Simple wrapper
around [`chdir()`](../library/os.html#os.chdir "os.chdir"). (Contributed by Filipe Laíns in [bpo\-25625](https://bugs.python.org/issue?@action=redirect&bpo=25625))

### dataclasses[¶](#dataclasses "Link to this heading")

* Change field default mutability check, allowing only defaults which are
[hashable](../glossary.html#term-hashable) instead of any object which is not an instance of
[`dict`](../library/stdtypes.html#dict "dict"), [`list`](../library/stdtypes.html#list "list") or [`set`](../library/stdtypes.html#set "set"). (Contributed by Eric V. Smith in
[bpo\-44674](https://bugs.python.org/issue?@action=redirect&bpo=44674).)

### datetime[¶](#datetime "Link to this heading")

* Add [`datetime.UTC`](../library/datetime.html#datetime.UTC "datetime.UTC"), a convenience alias for
[`datetime.timezone.utc`](../library/datetime.html#datetime.timezone.utc "datetime.timezone.utc"). (Contributed by Kabir Kwatra in [gh\-91973](https://github.com/python/cpython/issues/91973).)
* [`datetime.date.fromisoformat()`](../library/datetime.html#datetime.date.fromisoformat "datetime.date.fromisoformat"), [`datetime.time.fromisoformat()`](../library/datetime.html#datetime.time.fromisoformat "datetime.time.fromisoformat") and
[`datetime.datetime.fromisoformat()`](../library/datetime.html#datetime.datetime.fromisoformat "datetime.datetime.fromisoformat") can now be used to parse most ISO 8601
formats (barring only those that support fractional hours and minutes).
(Contributed by Paul Ganssle in [gh\-80010](https://github.com/python/cpython/issues/80010).)

### enum[¶](#enum "Link to this heading")

* Renamed `EnumMeta` to [`EnumType`](../library/enum.html#enum.EnumType "enum.EnumType")
(`EnumMeta` kept as an alias).
* Added [`StrEnum`](../library/enum.html#enum.StrEnum "enum.StrEnum"),
with members that can be used as (and must be) strings.
* Added [`ReprEnum`](../library/enum.html#enum.ReprEnum "enum.ReprEnum"),
which only modifies the [`__repr__()`](../reference/datamodel.html#object.__repr__ "object.__repr__") of members
while returning their literal values (rather than names)
for [`__str__()`](../reference/datamodel.html#object.__str__ "object.__str__") and [`__format__()`](../reference/datamodel.html#object.__format__ "object.__format__")
(used by [`str()`](../library/stdtypes.html#str "str"), [`format()`](../library/functions.html#format "format") and [f\-string](../glossary.html#term-f-string)s).
* Changed [`Enum.__format__()`](../library/enum.html#enum.Enum.__format__ "enum.Enum.__format__") (the default for
[`format()`](../library/functions.html#format "format"), [`str.format()`](../library/stdtypes.html#str.format "str.format") and [f\-string](../glossary.html#term-f-string)s) to always produce
the same result as [`Enum.__str__()`](../library/enum.html#enum.Enum.__str__ "enum.Enum.__str__"): for enums inheriting from
[`ReprEnum`](../library/enum.html#enum.ReprEnum "enum.ReprEnum") it will be the member’s value; for all other enums
it will be the enum and member name (e.g. `Color.RED`).
* Added a new *boundary* class parameter to [`Flag`](../library/enum.html#enum.Flag "enum.Flag") enums
and the [`FlagBoundary`](../library/enum.html#enum.FlagBoundary "enum.FlagBoundary") enum with its options,
to control how to handle out\-of\-range flag values.
* Added the [`verify()`](../library/enum.html#enum.verify "enum.verify") enum decorator
and the [`EnumCheck`](../library/enum.html#enum.EnumCheck "enum.EnumCheck") enum with its options,
to check enum classes against several specific constraints.
* Added the [`member()`](../library/enum.html#enum.member "enum.member") and [`nonmember()`](../library/enum.html#enum.nonmember "enum.nonmember") decorators,
to ensure the decorated object is/is not converted to an enum member.
* Added the [`property()`](../library/enum.html#enum.property "enum.property") decorator,
which works like [`property()`](../library/functions.html#property "property") except for enums.
Use this instead of [`types.DynamicClassAttribute()`](../library/types.html#types.DynamicClassAttribute "types.DynamicClassAttribute").
* Added the [`global_enum()`](../library/enum.html#enum.global_enum "enum.global_enum") enum decorator,
which adjusts [`__repr__()`](../reference/datamodel.html#object.__repr__ "object.__repr__") and [`__str__()`](../reference/datamodel.html#object.__str__ "object.__str__")
to show values as members of their module rather than the enum class.
For example, `'re.ASCII'` for the [`ASCII`](../library/re.html#re.ASCII "re.ASCII") member
of [`re.RegexFlag`](../library/re.html#re.RegexFlag "re.RegexFlag") rather than `'RegexFlag.ASCII'`.
* Enhanced [`Flag`](../library/enum.html#enum.Flag "enum.Flag") to support
[`len()`](../library/functions.html#len "len"), iteration and [`in`](../reference/expressions.html#in)/[`not in`](../reference/expressions.html#not-in) on its members.
For example, the following now works:
`len(AFlag(3)) == 2 and list(AFlag(3)) == (AFlag.ONE, AFlag.TWO)`
* Changed [`Enum`](../library/enum.html#enum.Enum "enum.Enum") and [`Flag`](../library/enum.html#enum.Flag "enum.Flag")
so that members are now defined
before [`__init_subclass__()`](../reference/datamodel.html#object.__init_subclass__ "object.__init_subclass__") is called;
[`dir()`](../library/functions.html#dir "dir") now includes methods, etc., from mixed\-in data types.
* Changed [`Flag`](../library/enum.html#enum.Flag "enum.Flag")
to only consider primary values (power of two) canonical
while composite values (`3`, `6`, `10`, etc.) are considered aliases;
inverted flags are coerced to their positive equivalent.

### fcntl[¶](#fcntl "Link to this heading")

* On FreeBSD, the `F_DUP2FD` and `F_DUP2FD_CLOEXEC` flags respectively
are supported, the former equals to `dup2` usage while the latter set
the `FD_CLOEXEC` flag in addition.

### fractions[¶](#fractions "Link to this heading")

* Support [**PEP 515**](https://peps.python.org/pep-0515/)\-style initialization of [`Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") from
string. (Contributed by Sergey B Kirpichev in [bpo\-44258](https://bugs.python.org/issue?@action=redirect&bpo=44258).)
* [`Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") now implements an `__int__` method, so
that an `isinstance(some_fraction, typing.SupportsInt)` check passes.
(Contributed by Mark Dickinson in [bpo\-44547](https://bugs.python.org/issue?@action=redirect&bpo=44547).)

### functools[¶](#functools "Link to this heading")

* [`functools.singledispatch()`](../library/functools.html#functools.singledispatch "functools.singledispatch") now supports [`types.UnionType`](../library/types.html#types.UnionType "types.UnionType")
and [`typing.Union`](../library/typing.html#typing.Union "typing.Union") as annotations to the dispatch argument.:

\`\`\`
\>\>\> from functools import singledispatch
\>\>\> @singledispatch
... def fun(arg, verbose=False):
... if verbose:
... print("Let me just say,", end=" ")
... print(arg)
...
\>\>\> @fun.register
... def \_(arg: int \| float, verbose=False):
... if verbose:
... print("Strength in numbers, eh?", end=" ")
... print(arg)
...
\>\>\> from typing import Union
\>\>\> @fun.register
... def \_(arg: Union\[list, set], verbose=False):
... if verbose:
... print("Enumerate this:")
... for i, elem in enumerate(arg):
... print(i, elem)
...

\`\`\`

(Contributed by Yurii Karabas in [bpo\-46014](https://bugs.python.org/issue?@action=redirect&bpo=46014).)

### gzip[¶](#gzip "Link to this heading")

* The [`gzip.compress()`](../library/gzip.html#gzip.compress "gzip.compress") function is now faster when used with the
**mtime=0** argument as it delegates the compression entirely to a single
[`zlib.compress()`](../library/zlib.html#zlib.compress "zlib.compress") operation. There is one side effect of this change: The
gzip file header contains an “OS” byte in its header. That was traditionally
always set to a value of 255 representing “unknown” by the [`gzip`](../library/gzip.html#module-gzip "gzip: Interfaces for gzip compression and decompression using file objects.")
module. Now, when using [`compress()`](../library/gzip.html#gzip.compress "gzip.compress") with **mtime=0**, it may be
set to a different value by the underlying zlib C library Python was linked
against.
(See [gh\-112346](https://github.com/python/cpython/issues/112346) for details on the side effect.)

### hashlib[¶](#hashlib "Link to this heading")

* [`hashlib.blake2b()`](../library/hashlib.html#hashlib.blake2b "hashlib.blake2b") and [`hashlib.blake2s()`](../library/hashlib.html#hashlib.blake2s "hashlib.blake2s") now prefer [libb2](https://www.blake2.net/)
over Python’s vendored copy.
(Contributed by Christian Heimes in [bpo\-47095](https://bugs.python.org/issue?@action=redirect&bpo=47095).)
* The internal `_sha3` module with SHA3 and SHAKE algorithms now uses
*tiny\_sha3* instead of the *Keccak Code Package* to reduce code and binary
size. The [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") module prefers optimized SHA3 and SHAKE
implementations from OpenSSL. The change affects only installations without
OpenSSL support.
(Contributed by Christian Heimes in [bpo\-47098](https://bugs.python.org/issue?@action=redirect&bpo=47098).)
* Add [`hashlib.file_digest()`](../library/hashlib.html#hashlib.file_digest "hashlib.file_digest"), a helper function for efficient hashing
of files or file\-like objects.
(Contributed by Christian Heimes in [gh\-89313](https://github.com/python/cpython/issues/89313).)

### IDLE and idlelib[¶](#whatsnew311-idle "Link to this heading")

* Apply syntax highlighting to `.pyi` files. (Contributed by Alex
Waygood and Terry Jan Reedy in [bpo\-45447](https://bugs.python.org/issue?@action=redirect&bpo=45447).)
* Include prompts when saving Shell with inputs and outputs.
(Contributed by Terry Jan Reedy in [gh\-95191](https://github.com/python/cpython/issues/95191).)

### inspect[¶](#inspect "Link to this heading")

* Add [`getmembers_static()`](../library/inspect.html#inspect.getmembers_static "inspect.getmembers_static") to return all members without
triggering dynamic lookup via the descriptor protocol. (Contributed by
Weipeng Hong in [bpo\-30533](https://bugs.python.org/issue?@action=redirect&bpo=30533).)
* Add [`ismethodwrapper()`](../library/inspect.html#inspect.ismethodwrapper "inspect.ismethodwrapper")
for checking if the type of an object is a [`MethodWrapperType`](../library/types.html#types.MethodWrapperType "types.MethodWrapperType").
(Contributed by Hakan Çelik in [bpo\-29418](https://bugs.python.org/issue?@action=redirect&bpo=29418).)
* Change the frame\-related functions in the [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") module to return new
[`FrameInfo`](../library/inspect.html#inspect.FrameInfo "inspect.FrameInfo") and [`Traceback`](../library/inspect.html#inspect.Traceback "inspect.Traceback") class instances
(backwards compatible with the previous [named tuple](../glossary.html#term-named-tuple)\-like interfaces)
that includes the extended [**PEP 657**](https://peps.python.org/pep-0657/) position information (end
line number, column and end column). The affected functions are:

	+ [`inspect.getframeinfo()`](../library/inspect.html#inspect.getframeinfo "inspect.getframeinfo")
	+ [`inspect.getouterframes()`](../library/inspect.html#inspect.getouterframes "inspect.getouterframes")
	+ [`inspect.getinnerframes()`](../library/inspect.html#inspect.getinnerframes "inspect.getinnerframes"),
	+ [`inspect.stack()`](../library/inspect.html#inspect.stack "inspect.stack")
	+ [`inspect.trace()`](../library/inspect.html#inspect.trace "inspect.trace")(Contributed by Pablo Galindo in [gh\-88116](https://github.com/python/cpython/issues/88116).)

### locale[¶](#locale "Link to this heading")

* Add [`locale.getencoding()`](../library/locale.html#locale.getencoding "locale.getencoding") to get the current locale encoding. It is similar to
`locale.getpreferredencoding(False)` but ignores the
[Python UTF\-8 Mode](../library/os.html#utf8-mode).

### logging[¶](#logging "Link to this heading")

* Added [`getLevelNamesMapping()`](../library/logging.html#logging.getLevelNamesMapping "logging.getLevelNamesMapping")
to return a mapping from logging level names (e.g. `'CRITICAL'`)
to the values of their corresponding [Logging Levels](../library/logging.html#levels) (e.g. `50`, by default).
(Contributed by Andrei Kulakovin in [gh\-88024](https://github.com/python/cpython/issues/88024).)
* Added a [`createSocket()`](../library/logging.handlers.html#logging.handlers.SysLogHandler.createSocket "logging.handlers.SysLogHandler.createSocket") method
to [`SysLogHandler`](../library/logging.handlers.html#logging.handlers.SysLogHandler "logging.handlers.SysLogHandler"), to match
[`SocketHandler.createSocket()`](../library/logging.handlers.html#logging.handlers.SocketHandler.createSocket "logging.handlers.SocketHandler.createSocket").
It is called automatically during handler initialization
and when emitting an event, if there is no active socket.
(Contributed by Kirill Pinchuk in [gh\-88457](https://github.com/python/cpython/issues/88457).)

### math[¶](#math "Link to this heading")

* Add [`math.exp2()`](../library/math.html#math.exp2 "math.exp2"): return 2 raised to the power of x.
(Contributed by Gideon Mitchell in [bpo\-45917](https://bugs.python.org/issue?@action=redirect&bpo=45917).)
* Add [`math.cbrt()`](../library/math.html#math.cbrt "math.cbrt"): return the cube root of x.
(Contributed by Ajith Ramachandran in [bpo\-44357](https://bugs.python.org/issue?@action=redirect&bpo=44357).)
* The behaviour of two [`math.pow()`](../library/math.html#math.pow "math.pow") corner cases was changed, for
consistency with the IEEE 754 specification. The operations
`math.pow(0.0, -math.inf)` and `math.pow(-0.0, -math.inf)` now return
`inf`. Previously they raised [`ValueError`](../library/exceptions.html#ValueError "ValueError"). (Contributed by Mark
Dickinson in [bpo\-44339](https://bugs.python.org/issue?@action=redirect&bpo=44339).)
* The [`math.nan`](../library/math.html#math.nan "math.nan") value is now always available.
(Contributed by Victor Stinner in [bpo\-46917](https://bugs.python.org/issue?@action=redirect&bpo=46917).)

### operator[¶](#operator "Link to this heading")

* A new function `operator.call` has been added, such that
`operator.call(obj, *args, **kwargs) == obj(*args, **kwargs)`.
(Contributed by Antony Lee in [bpo\-44019](https://bugs.python.org/issue?@action=redirect&bpo=44019).)

### os[¶](#os "Link to this heading")

* On Windows, [`os.urandom()`](../library/os.html#os.urandom "os.urandom") now uses `BCryptGenRandom()`,
instead of `CryptGenRandom()` which is deprecated.
(Contributed by Donghee Na in [bpo\-44611](https://bugs.python.org/issue?@action=redirect&bpo=44611).)

### pathlib[¶](#pathlib "Link to this heading")

* [`glob()`](../library/pathlib.html#pathlib.Path.glob "pathlib.Path.glob") and [`rglob()`](../library/pathlib.html#pathlib.Path.rglob "pathlib.Path.rglob") return only
directories if *pattern* ends with a pathname components separator:
[`sep`](../library/os.html#os.sep "os.sep") or [`altsep`](../library/os.html#os.altsep "os.altsep").
(Contributed by Eisuke Kawasima in [bpo\-22276](https://bugs.python.org/issue?@action=redirect&bpo=22276) and [bpo\-33392](https://bugs.python.org/issue?@action=redirect&bpo=33392).)

### re[¶](#re "Link to this heading")

* Atomic grouping (`(?>...)`) and possessive quantifiers (`*+`, `++`,
`?+`, `{m,n}+`) are now supported in regular expressions.
(Contributed by Jeffrey C. Jacobs and Serhiy Storchaka in [bpo\-433030](https://bugs.python.org/issue?@action=redirect&bpo=433030).)

### shutil[¶](#shutil "Link to this heading")

* Add optional parameter *dir\_fd* in [`shutil.rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree").
(Contributed by Serhiy Storchaka in [bpo\-46245](https://bugs.python.org/issue?@action=redirect&bpo=46245).)

### socket[¶](#socket "Link to this heading")

* Add CAN Socket support for NetBSD.
(Contributed by Thomas Klausner in [bpo\-30512](https://bugs.python.org/issue?@action=redirect&bpo=30512).)
* [`create_connection()`](../library/socket.html#socket.create_connection "socket.create_connection") has an option to raise, in case of
failure to connect, an [`ExceptionGroup`](../library/exceptions.html#ExceptionGroup "ExceptionGroup") containing all errors
instead of only raising the last error.
(Contributed by Irit Katriel in [bpo\-29980](https://bugs.python.org/issue?@action=redirect&bpo=29980).)

### sqlite3[¶](#sqlite3 "Link to this heading")

* You can now disable the authorizer by passing [`None`](../library/constants.html#None "None") to
[`set_authorizer()`](../library/sqlite3.html#sqlite3.Connection.set_authorizer "sqlite3.Connection.set_authorizer").
(Contributed by Erlend E. Aasland in [bpo\-44491](https://bugs.python.org/issue?@action=redirect&bpo=44491).)
* Collation name [`create_collation()`](../library/sqlite3.html#sqlite3.Connection.create_collation "sqlite3.Connection.create_collation") can now
contain any Unicode character. Collation names with invalid characters
now raise [`UnicodeEncodeError`](../library/exceptions.html#UnicodeEncodeError "UnicodeEncodeError") instead of [`sqlite3.ProgrammingError`](../library/sqlite3.html#sqlite3.ProgrammingError "sqlite3.ProgrammingError").
(Contributed by Erlend E. Aasland in [bpo\-44688](https://bugs.python.org/issue?@action=redirect&bpo=44688).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") exceptions now include the SQLite extended error code as
[`sqlite_errorcode`](../library/sqlite3.html#sqlite3.Error.sqlite_errorcode "sqlite3.Error.sqlite_errorcode") and the SQLite error name as
[`sqlite_errorname`](../library/sqlite3.html#sqlite3.Error.sqlite_errorname "sqlite3.Error.sqlite_errorname").
(Contributed by Aviv Palivoda, Daniel Shahaf, and Erlend E. Aasland in
[bpo\-16379](https://bugs.python.org/issue?@action=redirect&bpo=16379) and [bpo\-24139](https://bugs.python.org/issue?@action=redirect&bpo=24139).)
* Add [`setlimit()`](../library/sqlite3.html#sqlite3.Connection.setlimit "sqlite3.Connection.setlimit") and
[`getlimit()`](../library/sqlite3.html#sqlite3.Connection.getlimit "sqlite3.Connection.getlimit") to [`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") for
setting and getting SQLite limits by connection basis.
(Contributed by Erlend E. Aasland in [bpo\-45243](https://bugs.python.org/issue?@action=redirect&bpo=45243).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") now sets [`sqlite3.threadsafety`](../library/sqlite3.html#sqlite3.threadsafety "sqlite3.threadsafety") based on the default
threading mode the underlying SQLite library has been compiled with.
(Contributed by Erlend E. Aasland in [bpo\-45613](https://bugs.python.org/issue?@action=redirect&bpo=45613).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") C callbacks now use unraisable exceptions if callback
tracebacks are enabled. Users can now register an
[`unraisable hook handler`](../library/sys.html#sys.unraisablehook "sys.unraisablehook") to improve their debug
experience.
(Contributed by Erlend E. Aasland in [bpo\-45828](https://bugs.python.org/issue?@action=redirect&bpo=45828).)
* Fetch across rollback no longer raises [`InterfaceError`](../library/sqlite3.html#sqlite3.InterfaceError "sqlite3.InterfaceError").
Instead we leave it to the SQLite library to handle these cases.
(Contributed by Erlend E. Aasland in [bpo\-44092](https://bugs.python.org/issue?@action=redirect&bpo=44092).)
* Add [`serialize()`](../library/sqlite3.html#sqlite3.Connection.serialize "sqlite3.Connection.serialize") and
[`deserialize()`](../library/sqlite3.html#sqlite3.Connection.deserialize "sqlite3.Connection.deserialize") to [`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") for
serializing and deserializing databases.
(Contributed by Erlend E. Aasland in [bpo\-41930](https://bugs.python.org/issue?@action=redirect&bpo=41930).)
* Add [`create_window_function()`](../library/sqlite3.html#sqlite3.Connection.create_window_function "sqlite3.Connection.create_window_function") to
[`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") for creating aggregate window functions.
(Contributed by Erlend E. Aasland in [bpo\-34916](https://bugs.python.org/issue?@action=redirect&bpo=34916).)
* Add [`blobopen()`](../library/sqlite3.html#sqlite3.Connection.blobopen "sqlite3.Connection.blobopen") to [`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection").
[`sqlite3.Blob`](../library/sqlite3.html#sqlite3.Blob "sqlite3.Blob") allows incremental I/O operations on blobs.
(Contributed by Aviv Palivoda and Erlend E. Aasland in [bpo\-24905](https://bugs.python.org/issue?@action=redirect&bpo=24905).)

### string[¶](#string "Link to this heading")

* Add [`get_identifiers()`](../library/string.html#string.Template.get_identifiers "string.Template.get_identifiers")
and [`is_valid()`](../library/string.html#string.Template.is_valid "string.Template.is_valid") to [`string.Template`](../library/string.html#string.Template "string.Template"),
which respectively return all valid placeholders,
and whether any invalid placeholders are present.
(Contributed by Ben Kehoe in [gh\-90465](https://github.com/python/cpython/issues/90465).)

### sys[¶](#sys "Link to this heading")

* [`sys.exc_info()`](../library/sys.html#sys.exc_info "sys.exc_info") now derives the `type` and `traceback` fields
from the `value` (the exception instance), so when an exception is
modified while it is being handled, the changes are reflected in
the results of subsequent calls to `exc_info()`.
(Contributed by Irit Katriel in [bpo\-45711](https://bugs.python.org/issue?@action=redirect&bpo=45711).)
* Add [`sys.exception()`](../library/sys.html#sys.exception "sys.exception") which returns the active exception instance
(equivalent to `sys.exc_info()[1]`).
(Contributed by Irit Katriel in [bpo\-46328](https://bugs.python.org/issue?@action=redirect&bpo=46328).)
* Add the [`sys.flags.safe_path`](../library/sys.html#sys.flags "sys.flags") flag.
(Contributed by Victor Stinner in [gh\-57684](https://github.com/python/cpython/issues/57684).)

### sysconfig[¶](#sysconfig "Link to this heading")

* Three new [installation schemes](../library/sysconfig.html#installation-paths)
(*posix\_venv*, *nt\_venv* and *venv*) were added and are used when Python
creates new virtual environments or when it is running from a virtual
environment.
The first two schemes (*posix\_venv* and *nt\_venv*) are OS\-specific
for non\-Windows and Windows, the *venv* is essentially an alias to one of
them according to the OS Python runs on.
This is useful for downstream distributors who modify
[`sysconfig.get_preferred_scheme()`](../library/sysconfig.html#sysconfig.get_preferred_scheme "sysconfig.get_preferred_scheme").
Third party code that creates new virtual environments should use the new
*venv* installation scheme to determine the paths, as does [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.").
(Contributed by Miro Hrončok in [bpo\-45413](https://bugs.python.org/issue?@action=redirect&bpo=45413).)

### tempfile[¶](#tempfile "Link to this heading")

* [`SpooledTemporaryFile`](../library/tempfile.html#tempfile.SpooledTemporaryFile "tempfile.SpooledTemporaryFile") objects now fully implement the methods
of [`io.BufferedIOBase`](../library/io.html#io.BufferedIOBase "io.BufferedIOBase") or [`io.TextIOBase`](../library/io.html#io.TextIOBase "io.TextIOBase")
(depending on file mode).
This lets them work correctly with APIs that expect file\-like objects,
such as compression modules.
(Contributed by Carey Metcalfe in [gh\-70363](https://github.com/python/cpython/issues/70363).)

### threading[¶](#threading "Link to this heading")

* On Unix, if the `sem_clockwait()` function is available in the C library
(glibc 2\.30 and newer), the [`threading.Lock.acquire()`](../library/threading.html#threading.Lock.acquire "threading.Lock.acquire") method now uses
the monotonic clock ([`time.CLOCK_MONOTONIC`](../library/time.html#time.CLOCK_MONOTONIC "time.CLOCK_MONOTONIC")) for the timeout, rather
than using the system clock ([`time.CLOCK_REALTIME`](../library/time.html#time.CLOCK_REALTIME "time.CLOCK_REALTIME")), to not be affected
by system clock changes.
(Contributed by Victor Stinner in [bpo\-41710](https://bugs.python.org/issue?@action=redirect&bpo=41710).)

### time[¶](#time "Link to this heading")

* On Unix, [`time.sleep()`](../library/time.html#time.sleep "time.sleep") now uses the `clock_nanosleep()` or
`nanosleep()` function, if available, which has a resolution of 1 nanosecond
(10\-9 seconds), rather than using `select()` which has a resolution
of 1 microsecond (10\-6 seconds).
(Contributed by Benjamin Szőke and Victor Stinner in [bpo\-21302](https://bugs.python.org/issue?@action=redirect&bpo=21302).)
* On Windows 8\.1 and newer, [`time.sleep()`](../library/time.html#time.sleep "time.sleep") now uses a waitable timer based
on [high\-resolution timers](https://docs.microsoft.com/en-us/windows-hardware/drivers/kernel/high-resolution-timers)
which has a resolution of 100 nanoseconds (10\-7 seconds). Previously,
it had a resolution of 1 millisecond (10\-3 seconds).
(Contributed by Benjamin Szőke, Donghee Na, Eryk Sun and Victor Stinner in [bpo\-21302](https://bugs.python.org/issue?@action=redirect&bpo=21302) and [bpo\-45429](https://bugs.python.org/issue?@action=redirect&bpo=45429).)

### tkinter[¶](#tkinter "Link to this heading")

* Added method `info_patchlevel()` which returns the exact version of
the Tcl library as a named tuple similar to [`sys.version_info`](../library/sys.html#sys.version_info "sys.version_info").
(Contributed by Serhiy Storchaka in [gh\-91827](https://github.com/python/cpython/issues/91827).)

### traceback[¶](#traceback "Link to this heading")

* Add [`traceback.StackSummary.format_frame_summary()`](../library/traceback.html#traceback.StackSummary.format_frame_summary "traceback.StackSummary.format_frame_summary") to allow users
to override which frames appear in the traceback, and how they are
formatted.
(Contributed by Ammar Askar in [bpo\-44569](https://bugs.python.org/issue?@action=redirect&bpo=44569).)
* Add [`traceback.TracebackException.print()`](../library/traceback.html#traceback.TracebackException.print "traceback.TracebackException.print"), which prints the
formatted [`TracebackException`](../library/traceback.html#traceback.TracebackException "traceback.TracebackException") instance to a file.
(Contributed by Irit Katriel in [bpo\-33809](https://bugs.python.org/issue?@action=redirect&bpo=33809).)

### typing[¶](#typing "Link to this heading")

For major changes, see [New Features Related to Type Hints](#new-feat-related-type-hints-311).

* Add [`typing.assert_never()`](../library/typing.html#typing.assert_never "typing.assert_never") and [`typing.Never`](../library/typing.html#typing.Never "typing.Never").
[`typing.assert_never()`](../library/typing.html#typing.assert_never "typing.assert_never") is useful for asking a type checker to confirm
that a line of code is not reachable. At runtime, it raises an
[`AssertionError`](../library/exceptions.html#AssertionError "AssertionError").
(Contributed by Jelle Zijlstra in [gh\-90633](https://github.com/python/cpython/issues/90633).)
* Add [`typing.reveal_type()`](../library/typing.html#typing.reveal_type "typing.reveal_type"). This is useful for asking a type checker
what type it has inferred for a given expression. At runtime it prints
the type of the received value.
(Contributed by Jelle Zijlstra in [gh\-90572](https://github.com/python/cpython/issues/90572).)
* Add [`typing.assert_type()`](../library/typing.html#typing.assert_type "typing.assert_type"). This is useful for asking a type checker
to confirm that the type it has inferred for a given expression matches
the given type. At runtime it simply returns the received value.
(Contributed by Jelle Zijlstra in [gh\-90638](https://github.com/python/cpython/issues/90638).)
* [`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") types can now be generic. (Contributed by
Samodya Abeysiriwardane in [gh\-89026](https://github.com/python/cpython/issues/89026).)
* [`NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") types can now be generic.
(Contributed by Serhiy Storchaka in [bpo\-43923](https://bugs.python.org/issue?@action=redirect&bpo=43923).)
* Allow subclassing of [`typing.Any`](../library/typing.html#typing.Any "typing.Any"). This is useful for avoiding
type checker errors related to highly dynamic class, such as mocks.
(Contributed by Shantanu Jain in [gh\-91154](https://github.com/python/cpython/issues/91154).)
* The [`typing.final()`](../library/typing.html#typing.final "typing.final") decorator now sets the `__final__` attributed on
the decorated object.
(Contributed by Jelle Zijlstra in [gh\-90500](https://github.com/python/cpython/issues/90500).)
* The [`typing.get_overloads()`](../library/typing.html#typing.get_overloads "typing.get_overloads") function can be used for introspecting
the overloads of a function. [`typing.clear_overloads()`](../library/typing.html#typing.clear_overloads "typing.clear_overloads") can be used
to clear all registered overloads of a function.
(Contributed by Jelle Zijlstra in [gh\-89263](https://github.com/python/cpython/issues/89263).)
* The [`__init__()`](../reference/datamodel.html#object.__init__ "object.__init__") method of [`Protocol`](../library/typing.html#typing.Protocol "typing.Protocol") subclasses
is now preserved. (Contributed by Adrian Garcia Badarasco in [gh\-88970](https://github.com/python/cpython/issues/88970).)
* The representation of empty tuple types (`Tuple[()]`) is simplified.
This affects introspection, e.g. `get_args(Tuple[()])` now evaluates
to `()` instead of `((),)`.
(Contributed by Serhiy Storchaka in [gh\-91137](https://github.com/python/cpython/issues/91137).)
* Loosen runtime requirements for type annotations by removing the callable
check in the private `typing._type_check` function. (Contributed by
Gregory Beauregard in [gh\-90802](https://github.com/python/cpython/issues/90802).)
* [`typing.get_type_hints()`](../library/typing.html#typing.get_type_hints "typing.get_type_hints") now supports evaluating strings as forward
references in [PEP 585 generic aliases](../library/stdtypes.html#types-genericalias).
(Contributed by Niklas Rosenstein in [gh\-85542](https://github.com/python/cpython/issues/85542).)
* [`typing.get_type_hints()`](../library/typing.html#typing.get_type_hints "typing.get_type_hints") no longer adds [`Optional`](../library/typing.html#typing.Optional "typing.Optional")
to parameters with `None` as a default. (Contributed by Nikita Sobolev
in [gh\-90353](https://github.com/python/cpython/issues/90353).)
* [`typing.get_type_hints()`](../library/typing.html#typing.get_type_hints "typing.get_type_hints") now supports evaluating bare stringified
[`ClassVar`](../library/typing.html#typing.ClassVar "typing.ClassVar") annotations. (Contributed by Gregory Beauregard
in [gh\-90711](https://github.com/python/cpython/issues/90711).)
* [`typing.no_type_check()`](../library/typing.html#typing.no_type_check "typing.no_type_check") no longer modifies external classes and functions.
It also now correctly marks classmethods as not to be type checked. (Contributed
by Nikita Sobolev in [gh\-90729](https://github.com/python/cpython/issues/90729).)

### unicodedata[¶](#unicodedata "Link to this heading")

* The Unicode database has been updated to version 14\.0\.0\.
(Contributed by Benjamin Peterson in [bpo\-45190](https://bugs.python.org/issue?@action=redirect&bpo=45190)).

### unittest[¶](#unittest "Link to this heading")

* Added methods [`enterContext()`](../library/unittest.html#unittest.TestCase.enterContext "unittest.TestCase.enterContext") and
[`enterClassContext()`](../library/unittest.html#unittest.TestCase.enterClassContext "unittest.TestCase.enterClassContext") of class
[`TestCase`](../library/unittest.html#unittest.TestCase "unittest.TestCase"), method
[`enterAsyncContext()`](../library/unittest.html#unittest.IsolatedAsyncioTestCase.enterAsyncContext "unittest.IsolatedAsyncioTestCase.enterAsyncContext") of
class [`IsolatedAsyncioTestCase`](../library/unittest.html#unittest.IsolatedAsyncioTestCase "unittest.IsolatedAsyncioTestCase") and function
[`unittest.enterModuleContext()`](../library/unittest.html#unittest.enterModuleContext "unittest.enterModuleContext").
(Contributed by Serhiy Storchaka in [bpo\-45046](https://bugs.python.org/issue?@action=redirect&bpo=45046).)

### venv[¶](#venv "Link to this heading")

* When new Python virtual environments are created, the *venv*
[sysconfig installation scheme](../library/sysconfig.html#installation-paths) is used
to determine the paths inside the environment.
When Python runs in a virtual environment, the same installation scheme
is the default.
That means that downstream distributors can change the default sysconfig install
scheme without changing behavior of virtual environments.
Third party code that also creates new virtual environments should do the same.
(Contributed by Miro Hrončok in [bpo\-45413](https://bugs.python.org/issue?@action=redirect&bpo=45413).)

### warnings[¶](#warnings "Link to this heading")

* [`warnings.catch_warnings()`](../library/warnings.html#warnings.catch_warnings "warnings.catch_warnings") now accepts arguments for [`warnings.simplefilter()`](../library/warnings.html#warnings.simplefilter "warnings.simplefilter"),
providing a more concise way to locally ignore warnings or convert them to errors.
(Contributed by Zac Hatfield\-Dodds in [bpo\-47074](https://bugs.python.org/issue?@action=redirect&bpo=47074).)

### zipfile[¶](#zipfile "Link to this heading")

* Added support for specifying member name encoding for reading metadata
in a [`ZipFile`](../library/zipfile.html#zipfile.ZipFile "zipfile.ZipFile")’s directory and file headers.
(Contributed by Stephen J. Turnbull and Serhiy Storchaka in [bpo\-28080](https://bugs.python.org/issue?@action=redirect&bpo=28080).)
* Added [`ZipFile.mkdir()`](../library/zipfile.html#zipfile.ZipFile.mkdir "zipfile.ZipFile.mkdir")
for creating new directories inside ZIP archives.
(Contributed by Sam Ezeh in [gh\-49083](https://github.com/python/cpython/issues/49083).)
* Added [`stem`](../library/zipfile.html#zipfile.Path.stem "zipfile.Path.stem"), [`suffix`](../library/zipfile.html#zipfile.Path.suffix "zipfile.Path.suffix")
and [`suffixes`](../library/zipfile.html#zipfile.Path.suffixes "zipfile.Path.suffixes") to [`zipfile.Path`](../library/zipfile.html#zipfile.Path "zipfile.Path").
(Contributed by Miguel Brito in [gh\-88261](https://github.com/python/cpython/issues/88261).)

## Optimizations[¶](#optimizations "Link to this heading")

This section covers specific optimizations independent of the
[Faster CPython](#whatsnew311-faster-cpython) project, which is covered in its own section.

* The compiler now optimizes simple
[printf\-style % formatting](../library/stdtypes.html#old-string-formatting) on string literals
containing only the format codes `%s`, `%r` and `%a` and makes it as
fast as a corresponding [f\-string](../glossary.html#term-f-string) expression.
(Contributed by Serhiy Storchaka in [bpo\-28307](https://bugs.python.org/issue?@action=redirect&bpo=28307).)
* Integer division (`//`) is better tuned for optimization by compilers.
It is now around 20% faster on x86\-64 when dividing an [`int`](../library/functions.html#int "int")
by a value smaller than `2**30`.
(Contributed by Gregory P. Smith and Tim Peters in [gh\-90564](https://github.com/python/cpython/issues/90564).)
* [`sum()`](../library/functions.html#sum "sum") is now nearly 30% faster for integers smaller than `2**30`.
(Contributed by Stefan Behnel in [gh\-68264](https://github.com/python/cpython/issues/68264).)
* Resizing lists is streamlined for the common case,
speeding up `list.append()` by ≈15%
and simple [list comprehension](../glossary.html#term-list-comprehension)s by up to 20\-30%
(Contributed by Dennis Sweeney in [gh\-91165](https://github.com/python/cpython/issues/91165).)
* Dictionaries don’t store hash values when all keys are Unicode objects,
decreasing [`dict`](../library/stdtypes.html#dict "dict") size.
For example, `sys.getsizeof(dict.fromkeys("abcdefg"))`
is reduced from 352 bytes to 272 bytes (23% smaller) on 64\-bit platforms.
(Contributed by Inada Naoki in [bpo\-46845](https://bugs.python.org/issue?@action=redirect&bpo=46845).)
* Using [`asyncio.DatagramProtocol`](../library/asyncio-protocol.html#asyncio.DatagramProtocol "asyncio.DatagramProtocol") is now orders of magnitude faster
when transferring large files over UDP,
with speeds over 100 times higher for a ≈60 MiB file.
(Contributed by msoxzw in [gh\-91487](https://github.com/python/cpython/issues/91487).)
* [`math`](../library/math.html#module-math "math: Mathematical functions (sin() etc.).") functions [`comb()`](../library/math.html#math.comb "math.comb") and [`perm()`](../library/math.html#math.perm "math.perm") are now
≈10 times faster for large arguments (with a larger speedup for larger *k*).
(Contributed by Serhiy Storchaka in [bpo\-37295](https://bugs.python.org/issue?@action=redirect&bpo=37295).)
* The [`statistics`](../library/statistics.html#module-statistics "statistics: Mathematical statistics functions") functions [`mean()`](../library/statistics.html#statistics.mean "statistics.mean"),
[`variance()`](../library/statistics.html#statistics.variance "statistics.variance") and [`stdev()`](../library/statistics.html#statistics.stdev "statistics.stdev") now consume
iterators in one pass rather than converting them to a [`list`](../library/stdtypes.html#list "list") first.
This is twice as fast and can save substantial memory.
(Contributed by Raymond Hettinger in [gh\-90415](https://github.com/python/cpython/issues/90415).)
* [`unicodedata.normalize()`](../library/unicodedata.html#unicodedata.normalize "unicodedata.normalize")
now normalizes pure\-ASCII strings in constant time.
(Contributed by Donghee Na in [bpo\-44987](https://bugs.python.org/issue?@action=redirect&bpo=44987).)

## Faster CPython[¶](#faster-cpython "Link to this heading")

CPython 3\.11 is an average of
[25% faster](https://github.com/faster-cpython/ideas#published-results)
than CPython 3\.10 as measured with the
[pyperformance](https://github.com/python/pyperformance) benchmark suite,
when compiled with GCC on Ubuntu Linux.
Depending on your workload, the overall speedup could be 10\-60%.

This project focuses on two major areas in Python:
[Faster Startup](#whatsnew311-faster-startup) and [Faster Runtime](#whatsnew311-faster-runtime).
Optimizations not covered by this project are listed separately under
[Optimizations](#whatsnew311-optimizations).

### Faster Startup[¶](#faster-startup "Link to this heading")

#### Frozen imports / Static code objects[¶](#frozen-imports-static-code-objects "Link to this heading")

Python caches [bytecode](../glossary.html#term-bytecode) in the [\_\_pycache\_\_](../tutorial/modules.html#tut-pycache)
directory to speed up module loading.

Previously in 3\.10, Python module execution looked like this:

\`\`\`
Read \_\_pycache\_\_ \-\> Unmarshal \-\> Heap allocated code object \-\> Evaluate

\`\`\`

In Python 3\.11, the core modules essential for Python startup are “frozen”.
This means that their [Code Objects](../c-api/code.html#codeobjects) (and bytecode)
are statically allocated by the interpreter.
This reduces the steps in module execution process to:

\`\`\`
Statically allocated code object \-\> Evaluate

\`\`\`

Interpreter startup is now 10\-15% faster in Python 3\.11\. This has a big
impact for short\-running programs using Python.

(Contributed by Eric Snow, Guido van Rossum and Kumar Aditya in many issues.)

### Faster Runtime[¶](#faster-runtime "Link to this heading")

#### Cheaper, lazy Python frames[¶](#cheaper-lazy-python-frames "Link to this heading")

Python frames, holding execution information,
are created whenever Python calls a Python function.
The following are new frame optimizations:

* Streamlined the frame creation process.
* Avoided memory allocation by generously re\-using frame space on the C stack.
* Streamlined the internal frame struct to contain only essential information.
Frames previously held extra debugging and memory management information.

Old\-style [frame objects](../reference/datamodel.html#frame-objects)
are now created only when requested by debuggers
or by Python introspection functions such as [`sys._getframe()`](../library/sys.html#sys._getframe "sys._getframe") and
[`inspect.currentframe()`](../library/inspect.html#inspect.currentframe "inspect.currentframe"). For most user code, no frame objects are
created at all. As a result, nearly all Python functions calls have sped
up significantly. We measured a 3\-7% speedup in pyperformance.

(Contributed by Mark Shannon in [bpo\-44590](https://bugs.python.org/issue?@action=redirect&bpo=44590).)

#### Inlined Python function calls[¶](#inlined-python-function-calls "Link to this heading")

During a Python function call, Python will call an evaluating C function to
interpret that function’s code. This effectively limits pure Python recursion to
what’s safe for the C stack.

In 3\.11, when CPython detects Python code calling another Python function,
it sets up a new frame, and “jumps” to the new code inside the new frame. This
avoids calling the C interpreting function altogether.

Most Python function calls now consume no C stack space, speeding them up.
In simple recursive functions like fibonacci or
factorial, we observed a 1\.7x speedup. This also means recursive functions
can recurse significantly deeper
(if the user increases the recursion limit with [`sys.setrecursionlimit()`](../library/sys.html#sys.setrecursionlimit "sys.setrecursionlimit")).
We measured a 1\-3% improvement in pyperformance.

(Contributed by Pablo Galindo and Mark Shannon in [bpo\-45256](https://bugs.python.org/issue?@action=redirect&bpo=45256).)

#### PEP 659: Specializing Adaptive Interpreter[¶](#pep-659-specializing-adaptive-interpreter "Link to this heading")

[**PEP 659**](https://peps.python.org/pep-0659/) is one of the key parts of the Faster CPython project. The general
idea is that while Python is a dynamic language, most code has regions where
objects and types rarely change. This concept is known as *type stability*.

At runtime, Python will try to look for common patterns and type stability
in the executing code. Python will then replace the current operation with a
more specialized one. This specialized operation uses fast paths available only
to those use cases/types, which generally outperform their generic
counterparts. This also brings in another concept called *inline caching*, where
Python caches the results of expensive operations directly in the
[bytecode](../glossary.html#term-bytecode).

The specializer will also combine certain common instruction pairs into one
superinstruction, reducing the overhead during execution.

Python will only specialize
when it sees code that is “hot” (executed multiple times). This prevents Python
from wasting time on run\-once code. Python can also de\-specialize when code is
too dynamic or when the use changes. Specialization is attempted periodically,
and specialization attempts are not too expensive,
allowing specialization to adapt to new circumstances.

(PEP written by Mark Shannon, with ideas inspired by Stefan Brunthaler.
See [**PEP 659**](https://peps.python.org/pep-0659/) for more information. Implementation by Mark Shannon and Brandt
Bucher, with additional help from Irit Katriel and Dennis Sweeney.)

| Operation | Form | Specialization | Operation speedup (up to) | Contributor(s) |
| --- | --- | --- | --- | --- |
| Binary operations | `x + x` `x - x` `x * x` | Binary add, multiply and subtract for common types such as [`int`](../library/functions.html#int "int"), [`float`](../library/functions.html#float "float") and [`str`](../library/stdtypes.html#str "str") take custom fast paths for their underlying types. | 10% | Mark Shannon, Donghee Na, Brandt Bucher, Dennis Sweeney |
| Subscript | `a[i]` | Subscripting container types such as [`list`](../library/stdtypes.html#list "list"), [`tuple`](../library/stdtypes.html#tuple "tuple") and [`dict`](../library/stdtypes.html#dict "dict") directly index the underlying data structures. Subscripting custom [`__getitem__()`](../reference/datamodel.html#object.__getitem__ "object.__getitem__") is also inlined similar to [Inlined Python function calls](#inline-calls). | 10\-25% | Irit Katriel, Mark Shannon |
| Store subscript | `a[i] = z` | Similar to subscripting specialization above. | 10\-25% | Dennis Sweeney |
| Calls | `f(arg)` `C(arg)` | Calls to common builtin (C) functions and types such as [`len()`](../library/functions.html#len "len") and [`str`](../library/stdtypes.html#str "str") directly call their underlying C version. This avoids going through the internal calling convention. | 20% | Mark Shannon, Ken Jin |
| Load global variable | `print` `len` | The object’s index in the globals/builtins namespace is cached. Loading globals and builtins require zero namespace lookups. | [\[1]](#load-global) | Mark Shannon |
| Load attribute | `o.attr` | Similar to loading global variables. The attribute’s index inside the class/object’s namespace is cached. In most cases, attribute loading will require zero namespace lookups. | [\[2]](#load-attr) | Mark Shannon |
| Load methods for call | `o.meth()` | The actual address of the method is cached. Method loading now has no namespace lookups – even for classes with long inheritance chains. | 10\-20% | Ken Jin, Mark Shannon |
| Store attribute | `o.attr = z` | Similar to load attribute optimization. | 2% in pyperformance | Mark Shannon |
| Unpack Sequence | `*seq` | Specialized for common containers such as [`list`](../library/stdtypes.html#list "list") and [`tuple`](../library/stdtypes.html#tuple "tuple"). Avoids internal calling convention. | 8% | Brandt Bucher |

### Misc[¶](#misc "Link to this heading")

* Objects now require less memory due to lazily created object namespaces.
Their namespace dictionaries now also share keys more freely.
(Contributed Mark Shannon in [bpo\-45340](https://bugs.python.org/issue?@action=redirect&bpo=45340) and [bpo\-40116](https://bugs.python.org/issue?@action=redirect&bpo=40116).)
* “Zero\-cost” exceptions are implemented, eliminating the cost
of [`try`](../reference/compound_stmts.html#try) statements when no exception is raised.
(Contributed by Mark Shannon in [bpo\-40222](https://bugs.python.org/issue?@action=redirect&bpo=40222).)
* A more concise representation of exceptions in the interpreter reduced the
time required for catching an exception by about 10%.
(Contributed by Irit Katriel in [bpo\-45711](https://bugs.python.org/issue?@action=redirect&bpo=45711).)
* [`re`](../library/re.html#module-re "re: Regular expression operations.")’s regular expression matching engine has been partially refactored,
and now uses computed gotos (or “threaded code”) on supported platforms. As a
result, Python 3\.11 executes the [pyperformance regular expression benchmarks](https://pyperformance.readthedocs.io/benchmarks.html#regex-dna) up to 10%
faster than Python 3\.10\.
(Contributed by Brandt Bucher in [gh\-91404](https://github.com/python/cpython/issues/91404).)

### FAQ[¶](#faq "Link to this heading")

#### How should I write my code to utilize these speedups?[¶](#how-should-i-write-my-code-to-utilize-these-speedups "Link to this heading")

Write Pythonic code that follows common best practices;
you don’t have to change your code.
The Faster CPython project optimizes for common code patterns we observe.

#### Will CPython 3\.11 use more memory?[¶](#will-cpython-3-11-use-more-memory "Link to this heading")

Maybe not; we don’t expect memory use to exceed 20% higher than 3\.10\.
This is offset by memory optimizations for frame objects and object
dictionaries as mentioned above.

#### I don’t see any speedups in my workload. Why?[¶](#i-don-t-see-any-speedups-in-my-workload-why "Link to this heading")

Certain code won’t have noticeable benefits. If your code spends most of
its time on I/O operations, or already does most of its
computation in a C extension library like NumPy, there won’t be significant
speedups. This project currently benefits pure\-Python workloads the most.

Furthermore, the pyperformance figures are a geometric mean. Even within the
pyperformance benchmarks, certain benchmarks have slowed down slightly, while
others have sped up by nearly 2x!

#### Is there a JIT compiler?[¶](#is-there-a-jit-compiler "Link to this heading")

No. We’re still exploring other optimizations.

### About[¶](#about "Link to this heading")

Faster CPython explores optimizations for [CPython](../glossary.html#term-CPython). The main team is
funded by Microsoft to work on this full\-time. Pablo Galindo Salgado is also
funded by Bloomberg LP to work on the project part\-time. Finally, many
contributors are volunteers from the community.

## CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

The bytecode now contains inline cache entries,
which take the form of the newly\-added [`CACHE`](../library/dis.html#opcode-CACHE) instructions.
Many opcodes expect to be followed by an exact number of caches,
and instruct the interpreter to skip over them at runtime.
Populated caches can look like arbitrary instructions,
so great care should be taken when reading or modifying
raw, adaptive bytecode containing quickened data.

### New opcodes[¶](#new-opcodes "Link to this heading")

* `ASYNC_GEN_WRAP`, [`RETURN_GENERATOR`](../library/dis.html#opcode-RETURN_GENERATOR) and [`SEND`](../library/dis.html#opcode-SEND),
used in generators and co\-routines.
* [`COPY_FREE_VARS`](../library/dis.html#opcode-COPY_FREE_VARS),
which avoids needing special caller\-side code for closures.
* [`JUMP_BACKWARD_NO_INTERRUPT`](../library/dis.html#opcode-JUMP_BACKWARD_NO_INTERRUPT),
for use in certain loops where handling interrupts is undesirable.
* [`MAKE_CELL`](../library/dis.html#opcode-MAKE_CELL), to create [Cell Objects](../c-api/cell.html#cell-objects).
* [`CHECK_EG_MATCH`](../library/dis.html#opcode-CHECK_EG_MATCH) and `PREP_RERAISE_STAR`,
to handle the [new exception groups and except\*](#whatsnew311-pep654)
added in [**PEP 654**](https://peps.python.org/pep-0654/).
* [`PUSH_EXC_INFO`](../library/dis.html#opcode-PUSH_EXC_INFO), for use in exception handlers.
* [`RESUME`](../library/dis.html#opcode-RESUME), a no\-op,
for internal tracing, debugging and optimization checks.

### Replaced opcodes[¶](#replaced-opcodes "Link to this heading")

| Replaced Opcode(s) | New Opcode(s) | Notes |
| --- | --- | --- |
| `BINARY_*` `INPLACE_*` | [`BINARY_OP`](../library/dis.html#opcode-BINARY_OP) | Replaced all numeric binary/in\-place opcodes with a single opcode |
| `CALL_FUNCTION` `CALL_FUNCTION_KW` `CALL_METHOD` | [`CALL`](../library/dis.html#opcode-CALL) `KW_NAMES` `PRECALL` [`PUSH_NULL`](../library/dis.html#opcode-PUSH_NULL) | Decouples argument shifting for methods from handling of keyword arguments; allows better specialization of calls |
| `DUP_TOP` `DUP_TOP_TWO` `ROT_TWO` `ROT_THREE` `ROT_FOUR` `ROT_N` | [`COPY`](../library/dis.html#opcode-COPY) [`SWAP`](../library/dis.html#opcode-SWAP) | Stack manipulation instructions |
| `JUMP_IF_NOT_EXC_MATCH` | [`CHECK_EXC_MATCH`](../library/dis.html#opcode-CHECK_EXC_MATCH) | Now performs check but doesn’t jump |
| `JUMP_ABSOLUTE` `POP_JUMP_IF_FALSE` `POP_JUMP_IF_TRUE` | [`JUMP_BACKWARD`](../library/dis.html#opcode-JUMP_BACKWARD) `POP_JUMP_BACKWARD_IF_*` `POP_JUMP_FORWARD_IF_*` | See [\[3]](#bytecode-jump); `TRUE`, `FALSE`, `NONE` and `NOT_NONE` variants for each direction |
| `SETUP_WITH` `SETUP_ASYNC_WITH` | [`BEFORE_WITH`](../library/dis.html#opcode-BEFORE_WITH) | [`with`](../reference/compound_stmts.html#with) block setup |

### Changed/removed opcodes[¶](#changed-removed-opcodes "Link to this heading")

* Changed [`MATCH_CLASS`](../library/dis.html#opcode-MATCH_CLASS) and [`MATCH_KEYS`](../library/dis.html#opcode-MATCH_KEYS)
to no longer push an additional boolean value to indicate success/failure.
Instead, `None` is pushed on failure
in place of the tuple of extracted values.
* Changed opcodes that work with exceptions to reflect them
now being represented as one item on the stack instead of three
(see [gh\-89874](https://github.com/python/cpython/issues/89874)).
* Removed `COPY_DICT_WITHOUT_KEYS`, `GEN_START`,
`POP_BLOCK`, `SETUP_FINALLY` and `YIELD_FROM`.

## Deprecated[¶](#deprecated "Link to this heading")

This section lists Python APIs that have been deprecated in Python 3\.11\.

Deprecated C APIs are [listed separately](#whatsnew311-c-api-deprecated).

### Language/Builtins[¶](#language-builtins "Link to this heading")

* Chaining [`classmethod`](../library/functions.html#classmethod "classmethod") descriptors (introduced in [bpo\-19072](https://bugs.python.org/issue?@action=redirect&bpo=19072))
is now deprecated. It can no longer be used to wrap other descriptors
such as [`property`](../library/functions.html#property "property"). The core design of this feature was flawed
and caused a number of downstream problems. To “pass\-through” a
[`classmethod`](../library/functions.html#classmethod "classmethod"), consider using the `__wrapped__` attribute
that was added in Python 3\.10\.
(Contributed by Raymond Hettinger in [gh\-89519](https://github.com/python/cpython/issues/89519).)
* Octal escapes in string and bytes literals with values larger than `0o377`
(255 in decimal) now produce a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
In a future Python version, they will raise a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning") and
eventually a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError").
(Contributed by Serhiy Storchaka in [gh\-81548](https://github.com/python/cpython/issues/81548).)
* The delegation of [`int()`](../library/functions.html#int "int") to [`__trunc__()`](../reference/datamodel.html#object.__trunc__ "object.__trunc__") is now deprecated.
Calling `int(a)` when `type(a)` implements `__trunc__()` but not
[`__int__()`](../reference/datamodel.html#object.__int__ "object.__int__") or [`__index__()`](../reference/datamodel.html#object.__index__ "object.__index__") now raises
a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
(Contributed by Zackery Spytz in [bpo\-44977](https://bugs.python.org/issue?@action=redirect&bpo=44977).)

### Modules[¶](#modules "Link to this heading")

* [**PEP 594**](https://peps.python.org/pep-0594/) led to the deprecations of the following modules
slated for removal in Python 3\.13:

| `aifc` | `chunk` | `msilib` | `pipes` | `telnetlib` |
| --- | --- | --- | --- | --- |
| `audioop` | `crypt` | `nis` | `sndhdr` | `uu` |
| `cgi` | `imghdr` | `nntplib` | `spwd` | `xdrlib` |
| `cgitb` | `mailcap` | `ossaudiodev` | `sunau` |  |

(Contributed by Brett Cannon in [bpo\-47061](https://bugs.python.org/issue?@action=redirect&bpo=47061) and Victor Stinner in
[gh\-68966](https://github.com/python/cpython/issues/68966).)
* The `asynchat`, `asyncore` and `smtpd` modules have been
deprecated since at least Python 3\.6\. Their documentation and deprecation
warnings have now been updated to note they will be removed in Python 3\.12\.
(Contributed by Hugo van Kemenade in [bpo\-47022](https://bugs.python.org/issue?@action=redirect&bpo=47022).)
* The `lib2to3` package and `2to3` tool
are now deprecated and may not be able to parse Python 3\.10 or newer.
See [**PEP 617**](https://peps.python.org/pep-0617/), introducing the new PEG parser, for details.
(Contributed by Victor Stinner in [bpo\-40360](https://bugs.python.org/issue?@action=redirect&bpo=40360).)
* Undocumented modules `sre_compile`, `sre_constants`
and `sre_parse` are now deprecated.
(Contributed by Serhiy Storchaka in [bpo\-47152](https://bugs.python.org/issue?@action=redirect&bpo=47152).)

### Standard Library[¶](#standard-library "Link to this heading")

* The following have been deprecated in [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") since Python 3\.2\.
Their deprecation warnings have now been updated to note they will be removed
in Python 3\.12:

	+ the `configparser.SafeConfigParser` class
	+ the `configparser.ParsingError.filename` property
	+ the `configparser.RawConfigParser.readfp()` method(Contributed by Hugo van Kemenade in [bpo\-45173](https://bugs.python.org/issue?@action=redirect&bpo=45173).)
* `configparser.LegacyInterpolation` has been deprecated in the docstring
since Python 3\.2, and is not listed in the [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") documentation.
It now emits a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") and will be removed
in Python 3\.13\. Use [`configparser.BasicInterpolation`](../library/configparser.html#configparser.BasicInterpolation "configparser.BasicInterpolation") or
[`configparser.ExtendedInterpolation`](../library/configparser.html#configparser.ExtendedInterpolation "configparser.ExtendedInterpolation") instead.
(Contributed by Hugo van Kemenade in [bpo\-46607](https://bugs.python.org/issue?@action=redirect&bpo=46607).)
* The older set of [`importlib.resources`](../library/importlib.resources.html#module-importlib.resources "importlib.resources: Package resource reading, opening, and access") functions were deprecated
in favor of the replacements added in Python 3\.9
and will be removed in a future Python version,
due to not supporting resources located within package subdirectories:

	+ `importlib.resources.contents()`
	+ `importlib.resources.is_resource()`
	+ `importlib.resources.open_binary()`
	+ `importlib.resources.open_text()`
	+ `importlib.resources.read_binary()`
	+ `importlib.resources.read_text()`
	+ `importlib.resources.path()`
* The [`locale.getdefaultlocale()`](../library/locale.html#locale.getdefaultlocale "locale.getdefaultlocale") function is deprecated and will be
removed in Python 3\.15\. Use [`locale.setlocale()`](../library/locale.html#locale.setlocale "locale.setlocale"),
[`locale.getpreferredencoding(False)`](../library/locale.html#locale.getpreferredencoding "locale.getpreferredencoding") and
[`locale.getlocale()`](../library/locale.html#locale.getlocale "locale.getlocale") functions instead.
(Contributed by Victor Stinner in [gh\-90817](https://github.com/python/cpython/issues/90817).)
* The `locale.resetlocale()` function is deprecated and will be
removed in Python 3\.13\. Use `locale.setlocale(locale.LC_ALL, "")` instead.
(Contributed by Victor Stinner in [gh\-90817](https://github.com/python/cpython/issues/90817).)
* Stricter rules will now be applied for numerical group references
and group names in [regular expressions](../library/re.html#re-syntax).
Only sequences of ASCII digits will now be accepted as a numerical reference,
and the group name in [`bytes`](../library/stdtypes.html#bytes "bytes") patterns and replacement strings
can only contain ASCII letters, digits and underscores.
For now, a deprecation warning is raised for syntax violating these rules.
(Contributed by Serhiy Storchaka in [gh\-91760](https://github.com/python/cpython/issues/91760).)
* In the [`re`](../library/re.html#module-re "re: Regular expression operations.") module, the `re.template()` function
and the corresponding `re.TEMPLATE` and `re.T` flags
are deprecated, as they were undocumented and lacked an obvious purpose.
They will be removed in Python 3\.13\.
(Contributed by Serhiy Storchaka and Miro Hrončok in [gh\-92728](https://github.com/python/cpython/issues/92728).)
* `turtle.settiltangle()` has been deprecated since Python 3\.1;
it now emits a deprecation warning and will be removed in Python 3\.13\. Use
[`turtle.tiltangle()`](../library/turtle.html#turtle.tiltangle "turtle.tiltangle") instead (it was earlier incorrectly marked
as deprecated, and its docstring is now corrected).
(Contributed by Hugo van Kemenade in [bpo\-45837](https://bugs.python.org/issue?@action=redirect&bpo=45837).)
* [`typing.Text`](../library/typing.html#typing.Text "typing.Text"), which exists solely to provide compatibility support
between Python 2 and Python 3 code, is now deprecated. Its removal is
currently unplanned, but users are encouraged to use [`str`](../library/stdtypes.html#str "str") instead
wherever possible.
(Contributed by Alex Waygood in [gh\-92332](https://github.com/python/cpython/issues/92332).)
* The keyword argument syntax for constructing [`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") types
is now deprecated. Support will be removed in Python 3\.13\. (Contributed by
Jingchen Ye in [gh\-90224](https://github.com/python/cpython/issues/90224).)
* `webbrowser.MacOSX` is deprecated and will be removed in Python 3\.13\.
It is untested, undocumented, and not used by [`webbrowser`](../library/webbrowser.html#module-webbrowser "webbrowser: Easy-to-use controller for web browsers.") itself.
(Contributed by Donghee Na in [bpo\-42255](https://bugs.python.org/issue?@action=redirect&bpo=42255).)
* The behavior of returning a value from a [`TestCase`](../library/unittest.html#unittest.TestCase "unittest.TestCase") and
[`IsolatedAsyncioTestCase`](../library/unittest.html#unittest.IsolatedAsyncioTestCase "unittest.IsolatedAsyncioTestCase") test methods (other than the
default `None` value) is now deprecated.
* Deprecated the following not\-formally\-documented [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") functions,
scheduled for removal in Python 3\.13:

	+ `unittest.findTestCases()`
	+ `unittest.makeSuite()`
	+ `unittest.getTestCaseNames()`Use [`TestLoader`](../library/unittest.html#unittest.TestLoader "unittest.TestLoader") methods instead:

	+ [`unittest.TestLoader.loadTestsFromModule()`](../library/unittest.html#unittest.TestLoader.loadTestsFromModule "unittest.TestLoader.loadTestsFromModule")
	+ [`unittest.TestLoader.loadTestsFromTestCase()`](../library/unittest.html#unittest.TestLoader.loadTestsFromTestCase "unittest.TestLoader.loadTestsFromTestCase")
	+ [`unittest.TestLoader.getTestCaseNames()`](../library/unittest.html#unittest.TestLoader.getTestCaseNames "unittest.TestLoader.getTestCaseNames")(Contributed by Erlend E. Aasland in [bpo\-5846](https://bugs.python.org/issue?@action=redirect&bpo=5846).)
* `unittest.TestProgram.usageExit()` is marked deprecated, to be removed
in 3\.13\.
(Contributed by Carlos Damázio in [gh\-67048](https://github.com/python/cpython/issues/67048).)

## Pending Removal in Python 3\.12[¶](#pending-removal-in-python-3-12 "Link to this heading")

The following Python APIs have been deprecated in earlier Python releases,
and will be removed in Python 3\.12\.

C APIs pending removal are
[listed separately](#whatsnew311-c-api-pending-removal).

* The `asynchat` module
* The `asyncore` module
* The [entire distutils package](3.10.html#distutils-deprecated)
* The `imp` module
* The [`typing.io`](../library/typing.html#typing.IO "typing.IO") namespace
* The [`typing.re`](../library/typing.html#typing.Pattern "typing.Pattern") namespace
* `cgi.log()`
* `importlib.find_loader()`
* `importlib.abc.Loader.module_repr()`
* `importlib.abc.MetaPathFinder.find_module()`
* `importlib.abc.PathEntryFinder.find_loader()`
* `importlib.abc.PathEntryFinder.find_module()`
* `importlib.machinery.BuiltinImporter.find_module()`
* `importlib.machinery.BuiltinLoader.module_repr()`
* `importlib.machinery.FileFinder.find_loader()`
* `importlib.machinery.FileFinder.find_module()`
* `importlib.machinery.FrozenImporter.find_module()`
* `importlib.machinery.FrozenLoader.module_repr()`
* `importlib.machinery.PathFinder.find_module()`
* `importlib.machinery.WindowsRegistryFinder.find_module()`
* `importlib.util.module_for_loader()`
* `importlib.util.set_loader_wrapper()`
* `importlib.util.set_package_wrapper()`
* `pkgutil.ImpImporter`
* `pkgutil.ImpLoader`
* `pathlib.Path.link_to()`
* `sqlite3.enable_shared_cache()`
* `sqlite3.OptimizedUnicode()`
* `PYTHONTHREADDEBUG` environment variable
* The following deprecated aliases in [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python."):

> | Deprecated alias | Method Name | Deprecated in |
> | --- | --- | --- |
> | `failUnless` | [`assertTrue()`](../library/unittest.html#unittest.TestCase.assertTrue "unittest.TestCase.assertTrue") | 3\.1 |
> | `failIf` | [`assertFalse()`](../library/unittest.html#unittest.TestCase.assertFalse "unittest.TestCase.assertFalse") | 3\.1 |
> | `failUnlessEqual` | [`assertEqual()`](../library/unittest.html#unittest.TestCase.assertEqual "unittest.TestCase.assertEqual") | 3\.1 |
> | `failIfEqual` | [`assertNotEqual()`](../library/unittest.html#unittest.TestCase.assertNotEqual "unittest.TestCase.assertNotEqual") | 3\.1 |
> | `failUnlessAlmostEqual` | [`assertAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertAlmostEqual "unittest.TestCase.assertAlmostEqual") | 3\.1 |
> | `failIfAlmostEqual` | [`assertNotAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertNotAlmostEqual "unittest.TestCase.assertNotAlmostEqual") | 3\.1 |
> | `failUnlessRaises` | [`assertRaises()`](../library/unittest.html#unittest.TestCase.assertRaises "unittest.TestCase.assertRaises") | 3\.1 |
> | `assert_` | [`assertTrue()`](../library/unittest.html#unittest.TestCase.assertTrue "unittest.TestCase.assertTrue") | 3\.2 |
> | `assertEquals` | [`assertEqual()`](../library/unittest.html#unittest.TestCase.assertEqual "unittest.TestCase.assertEqual") | 3\.2 |
> | `assertNotEquals` | [`assertNotEqual()`](../library/unittest.html#unittest.TestCase.assertNotEqual "unittest.TestCase.assertNotEqual") | 3\.2 |
> | `assertAlmostEquals` | [`assertAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertAlmostEqual "unittest.TestCase.assertAlmostEqual") | 3\.2 |
> | `assertNotAlmostEquals` | [`assertNotAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertNotAlmostEqual "unittest.TestCase.assertNotAlmostEqual") | 3\.2 |
> | `assertRegexpMatches` | [`assertRegex()`](../library/unittest.html#unittest.TestCase.assertRegex "unittest.TestCase.assertRegex") | 3\.2 |
> | `assertRaisesRegexp` | [`assertRaisesRegex()`](../library/unittest.html#unittest.TestCase.assertRaisesRegex "unittest.TestCase.assertRaisesRegex") | 3\.2 |
> | `assertNotRegexpMatches` | [`assertNotRegex()`](../library/unittest.html#unittest.TestCase.assertNotRegex "unittest.TestCase.assertNotRegex") | 3\.5 |

## Removed[¶](#removed "Link to this heading")

This section lists Python APIs that have been removed in Python 3\.11\.

Removed C APIs are [listed separately](#whatsnew311-c-api-removed).

* Removed the `@asyncio.coroutine()` [decorator](../glossary.html#term-decorator)
enabling legacy generator\-based coroutines to be compatible with
[`async`](../reference/compound_stmts.html#async) / [`await`](../reference/expressions.html#await) code.
The function has been deprecated since Python 3\.8 and the removal was
initially scheduled for Python 3\.10\. Use [`async def`](../reference/compound_stmts.html#async-def) instead.
(Contributed by Illia Volochii in [bpo\-43216](https://bugs.python.org/issue?@action=redirect&bpo=43216).)
* Removed `asyncio.coroutines.CoroWrapper` used for wrapping legacy
generator\-based coroutine objects in the debug mode.
(Contributed by Illia Volochii in [bpo\-43216](https://bugs.python.org/issue?@action=redirect&bpo=43216).)
* Due to significant security concerns, the *reuse\_address* parameter of
[`asyncio.loop.create_datagram_endpoint()`](../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint"), disabled in Python 3\.9, is
now entirely removed. This is because of the behavior of the socket option
`SO_REUSEADDR` in UDP.
(Contributed by Hugo van Kemenade in [bpo\-45129](https://bugs.python.org/issue?@action=redirect&bpo=45129).)
* Removed the `binhex` module, deprecated in Python 3\.9\.
Also removed the related, similarly\-deprecated [`binascii`](../library/binascii.html#module-binascii "binascii: Tools for converting between binary and various ASCII-encoded binary representations.") functions:

	+ `binascii.a2b_hqx()`
	+ `binascii.b2a_hqx()`
	+ `binascii.rlecode_hqx()`
	+ `binascii.rldecode_hqx()`The [`binascii.crc_hqx()`](../library/binascii.html#binascii.crc_hqx "binascii.crc_hqx") function remains available.

(Contributed by Victor Stinner in [bpo\-45085](https://bugs.python.org/issue?@action=redirect&bpo=45085).)
* Removed the `distutils` `bdist_msi` command deprecated in Python 3\.9\.
Use `bdist_wheel` (wheel packages) instead.
(Contributed by Hugo van Kemenade in [bpo\-45124](https://bugs.python.org/issue?@action=redirect&bpo=45124).)
* Removed the [`__getitem__()`](../reference/datamodel.html#object.__getitem__ "object.__getitem__") methods of
[`xml.dom.pulldom.DOMEventStream`](../library/xml.dom.pulldom.html#xml.dom.pulldom.DOMEventStream "xml.dom.pulldom.DOMEventStream"), [`wsgiref.util.FileWrapper`](../library/wsgiref.html#wsgiref.util.FileWrapper "wsgiref.util.FileWrapper")
and [`fileinput.FileInput`](../library/fileinput.html#fileinput.FileInput "fileinput.FileInput"), deprecated since Python 3\.9\.
(Contributed by Hugo van Kemenade in [bpo\-45132](https://bugs.python.org/issue?@action=redirect&bpo=45132).)
* Removed the deprecated [`gettext`](../library/gettext.html#module-gettext "gettext: Multilingual internationalization services.") functions
`lgettext()`, `ldgettext()`,
`lngettext()` and `ldngettext()`.
Also removed the `bind_textdomain_codeset()` function,
the `NullTranslations.output_charset()` and
`NullTranslations.set_output_charset()` methods,
and the *codeset* parameter of `translation()` and `install()`,
since they are only used for the `l*gettext()` functions.
(Contributed by Donghee Na and Serhiy Storchaka in [bpo\-44235](https://bugs.python.org/issue?@action=redirect&bpo=44235).)
* Removed from the [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") module:

	+ The `getargspec()` function, deprecated since Python 3\.0;
	use [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") or [`inspect.getfullargspec()`](../library/inspect.html#inspect.getfullargspec "inspect.getfullargspec") instead.
	+ The `formatargspec()` function, deprecated since Python 3\.5;
	use the [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") function
	or the [`inspect.Signature`](../library/inspect.html#inspect.Signature "inspect.Signature") object directly.
	+ The undocumented `Signature.from_builtin()`
	and `Signature.from_function()` methods, deprecated since Python 3\.5;
	use the [`Signature.from_callable()`](../library/inspect.html#inspect.Signature.from_callable "inspect.Signature.from_callable")
	method instead.(Contributed by Hugo van Kemenade in [bpo\-45320](https://bugs.python.org/issue?@action=redirect&bpo=45320).)
* Removed the [`__class_getitem__()`](../reference/datamodel.html#object.__class_getitem__ "object.__class_getitem__") method
from [`pathlib.PurePath`](../library/pathlib.html#pathlib.PurePath "pathlib.PurePath"),
because it was not used and added by mistake in previous versions.
(Contributed by Nikita Sobolev in [bpo\-46483](https://bugs.python.org/issue?@action=redirect&bpo=46483).)
* Removed the `MailmanProxy` class in the `smtpd` module,
as it is unusable without the external `mailman` package.
(Contributed by Donghee Na in [bpo\-35800](https://bugs.python.org/issue?@action=redirect&bpo=35800).)
* Removed the deprecated `split()` method of `_tkinter.TkappType`.
(Contributed by Erlend E. Aasland in [bpo\-38371](https://bugs.python.org/issue?@action=redirect&bpo=38371).)
* Removed namespace package support from [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") discovery.
It was introduced in Python 3\.4 but has been broken since Python 3\.7\.
(Contributed by Inada Naoki in [bpo\-23882](https://bugs.python.org/issue?@action=redirect&bpo=23882).)
* Removed the undocumented private `float.__set_format__()` method,
previously known as `float.__setformat__()` in Python 3\.7\.
Its docstring said: “You probably don’t want to use this function.
It exists mainly to be used in Python’s test suite.”
(Contributed by Victor Stinner in [bpo\-46852](https://bugs.python.org/issue?@action=redirect&bpo=46852).)
* The `--experimental-isolated-subinterpreters` configure flag
(and corresponding `EXPERIMENTAL_ISOLATED_SUBINTERPRETERS` macro)
have been removed.
* [Pynche](https://pypi.org/project/Pynche/)
— The Pythonically Natural Color and Hue Editor — has been moved out
of `Tools/scripts` and is [being developed independently](https://gitlab.com/warsaw/pynche/-/tree/main) from the Python source tree.

## Porting to Python 3\.11[¶](#porting-to-python-3-11 "Link to this heading")

This section lists previously described changes and other bugfixes
in the Python API that may require changes to your Python code.

Porting notes for the C API are
[listed separately](#whatsnew311-c-api-porting).

* [`open()`](../library/functions.html#open "open"), [`io.open()`](../library/io.html#io.open "io.open"), [`codecs.open()`](../library/codecs.html#codecs.open "codecs.open") and
[`fileinput.FileInput`](../library/fileinput.html#fileinput.FileInput "fileinput.FileInput") no longer accept `'U'` (“universal newline”)
in the file mode. In Python 3, “universal newline” mode is used by default
whenever a file is opened in text mode,
and the `'U'` flag has been deprecated since Python 3\.3\.
The [newline parameter](../library/functions.html#open-newline-parameter)
to these functions controls how universal newlines work.
(Contributed by Victor Stinner in [bpo\-37330](https://bugs.python.org/issue?@action=redirect&bpo=37330).)
* [`ast.AST`](../library/ast.html#ast.AST "ast.AST") node positions are now validated when provided to
[`compile()`](../library/functions.html#compile "compile") and other related functions. If invalid positions are detected,
a [`ValueError`](../library/exceptions.html#ValueError "ValueError") will be raised. (Contributed by Pablo Galindo in [gh\-93351](https://github.com/python/cpython/issues/93351))
* Prohibited passing non\-[`concurrent.futures.ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor")
executors to [`asyncio.loop.set_default_executor()`](../library/asyncio-eventloop.html#asyncio.loop.set_default_executor "asyncio.loop.set_default_executor")
following a deprecation in Python 3\.8\.
(Contributed by Illia Volochii in [bpo\-43234](https://bugs.python.org/issue?@action=redirect&bpo=43234).)
* [`calendar`](../library/calendar.html#module-calendar "calendar: Functions for working with calendars, including some emulation of the Unix cal program."): The [`calendar.LocaleTextCalendar`](../library/calendar.html#calendar.LocaleTextCalendar "calendar.LocaleTextCalendar") and
[`calendar.LocaleHTMLCalendar`](../library/calendar.html#calendar.LocaleHTMLCalendar "calendar.LocaleHTMLCalendar") classes now use
[`locale.getlocale()`](../library/locale.html#locale.getlocale "locale.getlocale"), instead of using [`locale.getdefaultlocale()`](../library/locale.html#locale.getdefaultlocale "locale.getdefaultlocale"),
if no locale is specified.
(Contributed by Victor Stinner in [bpo\-46659](https://bugs.python.org/issue?@action=redirect&bpo=46659).)
* The [`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters.") module now reads the `.pdbrc` configuration file with
the `'UTF-8'` encoding.
(Contributed by Srinivas Reddy Thatiparthy (శ్రీనివాస్ రెడ్డి తాటిపర్తి) in [bpo\-41137](https://bugs.python.org/issue?@action=redirect&bpo=41137).)
* The *population* parameter of [`random.sample()`](../library/random.html#random.sample "random.sample") must be a sequence,
and automatic conversion of [`set`](../library/stdtypes.html#set "set")s to [`list`](../library/stdtypes.html#list "list")s
is no longer supported. Also, if the sample size
is larger than the population size, a [`ValueError`](../library/exceptions.html#ValueError "ValueError") is raised.
(Contributed by Raymond Hettinger in [bpo\-40465](https://bugs.python.org/issue?@action=redirect&bpo=40465).)
* The *random* optional parameter of [`random.shuffle()`](../library/random.html#random.shuffle "random.shuffle") was removed.
It was previously an arbitrary random function to use for the shuffle;
now, [`random.random()`](../library/random.html#random.random "random.random") (its previous default) will always be used.
* In [`re`](../library/re.html#module-re "re: Regular expression operations.") [Regular Expression Syntax](../library/re.html#re-syntax), global inline flags (e.g. `(?i)`)
can now only be used at the start of regular expressions.
Using them elsewhere has been deprecated since Python 3\.6\.
(Contributed by Serhiy Storchaka in [bpo\-47066](https://bugs.python.org/issue?@action=redirect&bpo=47066).)
* In the [`re`](../library/re.html#module-re "re: Regular expression operations.") module, several long\-standing bugs where fixed that,
in rare cases, could cause capture groups to get the wrong result.
Therefore, this could change the captured output in these cases.
(Contributed by Ma Lin in [bpo\-35859](https://bugs.python.org/issue?@action=redirect&bpo=35859).)

## Build Changes[¶](#build-changes "Link to this heading")

* CPython now has [**PEP 11**](https://peps.python.org/pep-0011/) [**Tier 3 support**](https://peps.python.org/pep-0011/#tier-3) for
cross compiling to the [WebAssembly](https://webassembly.org/) platforms
[Emscripten](https://emscripten.org/)
(`wasm32-unknown-emscripten`, i.e. Python in the browser)
and [WebAssembly System Interface (WASI)](https://wasi.dev/)
(`wasm32-unknown-wasi`).
The effort is inspired by previous work like [Pyodide](https://pyodide.org/).
These platforms provide a limited subset of POSIX APIs; Python standard
libraries features and modules related to networking, processes, threading,
signals, mmap, and users/groups are not available or don’t work.
(Emscripten contributed by Christian Heimes and Ethan Smith in [gh\-84461](https://github.com/python/cpython/issues/84461)
and WASI contributed by Christian Heimes in [gh\-90473](https://github.com/python/cpython/issues/90473);
platforms promoted in [gh\-95085](https://github.com/python/cpython/issues/95085))
* Building CPython now requires:

	+ A [C11](https://en.cppreference.com/w/c/11) compiler and standard library.
	[Optional C11 features](https://en.wikipedia.org/wiki/C11_(C_standard_revision)#Optional_features)
	are not required.
	(Contributed by Victor Stinner in [bpo\-46656](https://bugs.python.org/issue?@action=redirect&bpo=46656),
	[bpo\-45440](https://bugs.python.org/issue?@action=redirect&bpo=45440) and [bpo\-46640](https://bugs.python.org/issue?@action=redirect&bpo=46640).)
	+ Support for [IEEE 754](https://en.wikipedia.org/wiki/IEEE_754)
	floating\-point numbers.
	(Contributed by Victor Stinner in [bpo\-46917](https://bugs.python.org/issue?@action=redirect&bpo=46917).)
* The `Py_NO_NAN` macro has been removed.
Since CPython now requires IEEE 754 floats, NaN values are always available.
(Contributed by Victor Stinner in [bpo\-46656](https://bugs.python.org/issue?@action=redirect&bpo=46656).)
* The [`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") package now requires [Tcl/Tk](https://www.tcl.tk)
version 8\.5\.12 or newer.
(Contributed by Serhiy Storchaka in [bpo\-46996](https://bugs.python.org/issue?@action=redirect&bpo=46996).)
* Build dependencies, compiler flags, and linker flags for most stdlib
extension modules are now detected by **configure**. libffi, libnsl,
libsqlite3, zlib, bzip2, liblzma, libcrypt, Tcl/Tk, and uuid flags
are detected by [pkg\-config](https://www.freedesktop.org/wiki/Software/pkg-config/) (when available).
[`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") now requires a pkg\-config command
to detect development settings for [Tcl/Tk](https://www.tcl.tk) headers and libraries.
(Contributed by Christian Heimes and Erlend Egeberg Aasland in
[bpo\-45847](https://bugs.python.org/issue?@action=redirect&bpo=45847), [bpo\-45747](https://bugs.python.org/issue?@action=redirect&bpo=45747), and [bpo\-45763](https://bugs.python.org/issue?@action=redirect&bpo=45763).)
* libpython is no longer linked against libcrypt.
(Contributed by Mike Gilbert in [bpo\-45433](https://bugs.python.org/issue?@action=redirect&bpo=45433).)
* CPython can now be built with the
[ThinLTO](https://clang.llvm.org/docs/ThinLTO.html) option
via passing `thin` to [`--with-lto`](../using/configure.html#cmdoption-with-lto), i.e. `--with-lto=thin`.
(Contributed by Donghee Na and Brett Holman in [bpo\-44340](https://bugs.python.org/issue?@action=redirect&bpo=44340).)
* Freelists for object structs can now be disabled. A new **configure**
option [`--without-freelists`](../using/configure.html#cmdoption-without-freelists) can be used to disable all freelists
except empty tuple singleton.
(Contributed by Christian Heimes in [bpo\-45522](https://bugs.python.org/issue?@action=redirect&bpo=45522).)
* `Modules/Setup` and `Modules/makesetup` have been improved and tied up.
Extension modules can now be built through `makesetup`. All except some
test modules can be linked statically into a main binary or library.
(Contributed by Brett Cannon and Christian Heimes in [bpo\-45548](https://bugs.python.org/issue?@action=redirect&bpo=45548),
[bpo\-45570](https://bugs.python.org/issue?@action=redirect&bpo=45570), [bpo\-45571](https://bugs.python.org/issue?@action=redirect&bpo=45571), and [bpo\-43974](https://bugs.python.org/issue?@action=redirect&bpo=43974).)

Note

Use the environment variables `TCLTK_CFLAGS` and
`TCLTK_LIBS` to manually specify the location of Tcl/Tk headers
and libraries. The **configure** options
`--with-tcltk-includes` and `--with-tcltk-libs`
have been removed.

On RHEL 7 and CentOS 7 the development packages do not provide `tcl.pc`
and `tk.pc`; use `TCLTK_LIBS="-ltk8.5 -ltkstub8.5 -ltcl8.5"`.
The directory `Misc/rhel7` contains `.pc` files and instructions
on how to build Python with RHEL 7’s and CentOS 7’s Tcl/Tk and OpenSSL.
* CPython will now use 30\-bit digits by default for the Python [`int`](../library/functions.html#int "int")
implementation. Previously, the default was to use 30\-bit digits on platforms
with `SIZEOF_VOID_P >= 8`, and 15\-bit digits otherwise. It’s still possible
to explicitly request use of 15\-bit digits via either the
[`--enable-big-digits`](../using/configure.html#cmdoption-enable-big-digits) option to the configure script
or (for Windows) the `PYLONG_BITS_IN_DIGIT` variable in `PC/pyconfig.h`,
but this option may be removed at some point in the future.
(Contributed by Mark Dickinson in [bpo\-45569](https://bugs.python.org/issue?@action=redirect&bpo=45569).)

## C API Changes[¶](#c-api-changes "Link to this heading")

### New Features[¶](#whatsnew311-c-api-new-features "Link to this heading")

* Add a new [`PyType_GetName()`](../c-api/type.html#c.PyType_GetName "PyType_GetName") function to get type’s short name.
(Contributed by Hai Shi in [bpo\-42035](https://bugs.python.org/issue?@action=redirect&bpo=42035).)
* Add a new [`PyType_GetQualName()`](../c-api/type.html#c.PyType_GetQualName "PyType_GetQualName") function to get type’s qualified name.
(Contributed by Hai Shi in [bpo\-42035](https://bugs.python.org/issue?@action=redirect&bpo=42035).)
* Add new [`PyThreadState_EnterTracing()`](../c-api/init.html#c.PyThreadState_EnterTracing "PyThreadState_EnterTracing") and
[`PyThreadState_LeaveTracing()`](../c-api/init.html#c.PyThreadState_LeaveTracing "PyThreadState_LeaveTracing") functions to the limited C API to
suspend and resume tracing and profiling.
(Contributed by Victor Stinner in [bpo\-43760](https://bugs.python.org/issue?@action=redirect&bpo=43760).)
* Added the [`Py_Version`](../c-api/apiabiversion.html#c.Py_Version "Py_Version") constant which bears the same value as
[`PY_VERSION_HEX`](../c-api/apiabiversion.html#c.PY_VERSION_HEX "PY_VERSION_HEX").
(Contributed by Gabriele N. Tornetta in [bpo\-43931](https://bugs.python.org/issue?@action=redirect&bpo=43931).)
* [`Py_buffer`](../c-api/buffer.html#c.Py_buffer "Py_buffer") and APIs are now part of the limited API and the stable
ABI:

	+ [`PyObject_CheckBuffer()`](../c-api/buffer.html#c.PyObject_CheckBuffer "PyObject_CheckBuffer")
	+ [`PyObject_GetBuffer()`](../c-api/buffer.html#c.PyObject_GetBuffer "PyObject_GetBuffer")
	+ [`PyBuffer_GetPointer()`](../c-api/buffer.html#c.PyBuffer_GetPointer "PyBuffer_GetPointer")
	+ [`PyBuffer_SizeFromFormat()`](../c-api/buffer.html#c.PyBuffer_SizeFromFormat "PyBuffer_SizeFromFormat")
	+ [`PyBuffer_ToContiguous()`](../c-api/buffer.html#c.PyBuffer_ToContiguous "PyBuffer_ToContiguous")
	+ [`PyBuffer_FromContiguous()`](../c-api/buffer.html#c.PyBuffer_FromContiguous "PyBuffer_FromContiguous")
	+ [`PyObject_CopyData()`](../c-api/buffer.html#c.PyObject_CopyData "PyObject_CopyData")
	+ [`PyBuffer_IsContiguous()`](../c-api/buffer.html#c.PyBuffer_IsContiguous "PyBuffer_IsContiguous")
	+ [`PyBuffer_FillContiguousStrides()`](../c-api/buffer.html#c.PyBuffer_FillContiguousStrides "PyBuffer_FillContiguousStrides")
	+ [`PyBuffer_FillInfo()`](../c-api/buffer.html#c.PyBuffer_FillInfo "PyBuffer_FillInfo")
	+ [`PyBuffer_Release()`](../c-api/buffer.html#c.PyBuffer_Release "PyBuffer_Release")
	+ [`PyMemoryView_FromBuffer()`](../c-api/memoryview.html#c.PyMemoryView_FromBuffer "PyMemoryView_FromBuffer")
	+ [`bf_getbuffer`](../c-api/typeobj.html#c.PyBufferProcs.bf_getbuffer "PyBufferProcs.bf_getbuffer") and
	[`bf_releasebuffer`](../c-api/typeobj.html#c.PyBufferProcs.bf_releasebuffer "PyBufferProcs.bf_releasebuffer") type slots(Contributed by Christian Heimes in [bpo\-45459](https://bugs.python.org/issue?@action=redirect&bpo=45459).)
* Added the [`PyType_GetModuleByDef()`](../c-api/type.html#c.PyType_GetModuleByDef "PyType_GetModuleByDef") function, used to get the module
in which a method was defined, in cases where this information is not
available directly (via [`PyCMethod`](../c-api/structures.html#c.PyCMethod "PyCMethod")).
(Contributed by Petr Viktorin in [bpo\-46613](https://bugs.python.org/issue?@action=redirect&bpo=46613).)
* Add new functions to pack and unpack C double (serialize and deserialize):
[`PyFloat_Pack2()`](../c-api/float.html#c.PyFloat_Pack2 "PyFloat_Pack2"), [`PyFloat_Pack4()`](../c-api/float.html#c.PyFloat_Pack4 "PyFloat_Pack4"), [`PyFloat_Pack8()`](../c-api/float.html#c.PyFloat_Pack8 "PyFloat_Pack8"),
[`PyFloat_Unpack2()`](../c-api/float.html#c.PyFloat_Unpack2 "PyFloat_Unpack2"), [`PyFloat_Unpack4()`](../c-api/float.html#c.PyFloat_Unpack4 "PyFloat_Unpack4") and
[`PyFloat_Unpack8()`](../c-api/float.html#c.PyFloat_Unpack8 "PyFloat_Unpack8").
(Contributed by Victor Stinner in [bpo\-46906](https://bugs.python.org/issue?@action=redirect&bpo=46906).)
* Add new functions to get frame object attributes:
[`PyFrame_GetBuiltins()`](../c-api/frame.html#c.PyFrame_GetBuiltins "PyFrame_GetBuiltins"), [`PyFrame_GetGenerator()`](../c-api/frame.html#c.PyFrame_GetGenerator "PyFrame_GetGenerator"),
[`PyFrame_GetGlobals()`](../c-api/frame.html#c.PyFrame_GetGlobals "PyFrame_GetGlobals"), [`PyFrame_GetLasti()`](../c-api/frame.html#c.PyFrame_GetLasti "PyFrame_GetLasti").
* Added two new functions to get and set the active exception instance:
[`PyErr_GetHandledException()`](../c-api/exceptions.html#c.PyErr_GetHandledException "PyErr_GetHandledException") and [`PyErr_SetHandledException()`](../c-api/exceptions.html#c.PyErr_SetHandledException "PyErr_SetHandledException").
These are alternatives to [`PyErr_SetExcInfo()`](../c-api/exceptions.html#c.PyErr_SetExcInfo "PyErr_SetExcInfo") and
[`PyErr_GetExcInfo()`](../c-api/exceptions.html#c.PyErr_GetExcInfo "PyErr_GetExcInfo") which work with the legacy 3\-tuple
representation of exceptions.
(Contributed by Irit Katriel in [bpo\-46343](https://bugs.python.org/issue?@action=redirect&bpo=46343).)
* Added the [`PyConfig.safe_path`](../c-api/init_config.html#c.PyConfig.safe_path "PyConfig.safe_path") member.
(Contributed by Victor Stinner in [gh\-57684](https://github.com/python/cpython/issues/57684).)

### Porting to Python 3\.11[¶](#whatsnew311-c-api-porting "Link to this heading")

* Some macros have been converted to static inline functions to avoid
[macro pitfalls](https://gcc.gnu.org/onlinedocs/cpp/Macro-Pitfalls.html).
The change should be mostly transparent to users,
as the replacement functions will cast their arguments to the expected types
to avoid compiler warnings due to static type checks.
However, when the limited C API is set to \>=3\.11,
these casts are not done,
and callers will need to cast arguments to their expected types.
See [**PEP 670**](https://peps.python.org/pep-0670/) for more details.
(Contributed by Victor Stinner and Erlend E. Aasland in [gh\-89653](https://github.com/python/cpython/issues/89653).)
* [`PyErr_SetExcInfo()`](../c-api/exceptions.html#c.PyErr_SetExcInfo "PyErr_SetExcInfo") no longer uses the `type` and `traceback`
arguments, the interpreter now derives those values from the exception
instance (the `value` argument). The function still steals references
of all three arguments.
(Contributed by Irit Katriel in [bpo\-45711](https://bugs.python.org/issue?@action=redirect&bpo=45711).)
* [`PyErr_GetExcInfo()`](../c-api/exceptions.html#c.PyErr_GetExcInfo "PyErr_GetExcInfo") now derives the `type` and `traceback`
fields of the result from the exception instance (the `value` field).
(Contributed by Irit Katriel in [bpo\-45711](https://bugs.python.org/issue?@action=redirect&bpo=45711).)
* [`_frozen`](../c-api/import.html#c._frozen "_frozen") has a new `is_package` field to indicate whether
or not the frozen module is a package. Previously, a negative value
in the `size` field was the indicator. Now only non\-negative values
be used for `size`.
(Contributed by Kumar Aditya in [bpo\-46608](https://bugs.python.org/issue?@action=redirect&bpo=46608).)
* [`_PyFrameEvalFunction()`](../c-api/init.html#c._PyFrameEvalFunction "_PyFrameEvalFunction") now takes `_PyInterpreterFrame*`
as its second parameter, instead of `PyFrameObject*`.
See [**PEP 523**](https://peps.python.org/pep-0523/) for more details of how to use this function pointer type.
* `PyCode_New()` and `PyCode_NewWithPosOnlyArgs()` now take
an additional `exception_table` argument.
Using these functions should be avoided, if at all possible.
To get a custom code object: create a code object using the compiler,
then get a modified version with the `replace` method.
* [`PyCodeObject`](../c-api/code.html#c.PyCodeObject "PyCodeObject") no longer has the `co_code`, `co_varnames`,
`co_cellvars` and `co_freevars` fields. Instead, use
[`PyCode_GetCode()`](../c-api/code.html#c.PyCode_GetCode "PyCode_GetCode"), [`PyCode_GetVarnames()`](../c-api/code.html#c.PyCode_GetVarnames "PyCode_GetVarnames"),
[`PyCode_GetCellvars()`](../c-api/code.html#c.PyCode_GetCellvars "PyCode_GetCellvars") and [`PyCode_GetFreevars()`](../c-api/code.html#c.PyCode_GetFreevars "PyCode_GetFreevars") respectively
to access them via the C API.
(Contributed by Brandt Bucher in [bpo\-46841](https://bugs.python.org/issue?@action=redirect&bpo=46841) and Ken Jin in [gh\-92154](https://github.com/python/cpython/issues/92154)
and [gh\-94936](https://github.com/python/cpython/issues/94936).)
* The old trashcan macros (`Py_TRASHCAN_SAFE_BEGIN`/`Py_TRASHCAN_SAFE_END`)
are now deprecated. They should be replaced by the new macros
`Py_TRASHCAN_BEGIN` and `Py_TRASHCAN_END`.

A tp\_dealloc function that has the old macros, such as:

\`\`\`
static void
mytype\_dealloc(mytype \*p)
{
 PyObject\_GC\_UnTrack(p);
 Py\_TRASHCAN\_SAFE\_BEGIN(p);
 ...
 Py\_TRASHCAN\_SAFE\_END
}

\`\`\`

should migrate to the new macros as follows:

\`\`\`
static void
mytype\_dealloc(mytype \*p)
{
 PyObject\_GC\_UnTrack(p);
 Py\_TRASHCAN\_BEGIN(p, mytype\_dealloc)
 ...
 Py\_TRASHCAN\_END
}

\`\`\`

Note that `Py_TRASHCAN_BEGIN` has a second argument which
should be the deallocation function it is in.

To support older Python versions in the same codebase, you
can define the following macros and use them throughout
the code (credit: these were copied from the `mypy` codebase):

\`\`\`
\#if PY\_VERSION\_HEX \>= 0x03080000
\# define CPy\_TRASHCAN\_BEGIN(op, dealloc) Py\_TRASHCAN\_BEGIN(op, dealloc)
\# define CPy\_TRASHCAN\_END(op) Py\_TRASHCAN\_END
\#else
\# define CPy\_TRASHCAN\_BEGIN(op, dealloc) Py\_TRASHCAN\_SAFE\_BEGIN(op)
\# define CPy\_TRASHCAN\_END(op) Py\_TRASHCAN\_SAFE\_END(op)
\#endif

\`\`\`
* The [`PyType_Ready()`](../c-api/type.html#c.PyType_Ready "PyType_Ready") function now raises an error if a type is defined
with the [`Py_TPFLAGS_HAVE_GC`](../c-api/typeobj.html#c.Py_TPFLAGS_HAVE_GC "Py_TPFLAGS_HAVE_GC") flag set but has no traverse function
([`PyTypeObject.tp_traverse`](../c-api/typeobj.html#c.PyTypeObject.tp_traverse "PyTypeObject.tp_traverse")).
(Contributed by Victor Stinner in [bpo\-44263](https://bugs.python.org/issue?@action=redirect&bpo=44263).)
* Heap types with the [`Py_TPFLAGS_IMMUTABLETYPE`](../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE "Py_TPFLAGS_IMMUTABLETYPE") flag can now inherit
the [**PEP 590**](https://peps.python.org/pep-0590/) vectorcall protocol. Previously, this was only possible for
[static types](../c-api/typeobj.html#static-types).
(Contributed by Erlend E. Aasland in [bpo\-43908](https://bugs.python.org/issue?@action=redirect&bpo=43908))
* Since [`Py_TYPE()`](../c-api/structures.html#c.Py_TYPE "Py_TYPE") is changed to a inline static function,
`Py_TYPE(obj) = new_type` must be replaced with
`Py_SET_TYPE(obj, new_type)`: see the [`Py_SET_TYPE()`](../c-api/structures.html#c.Py_SET_TYPE "Py_SET_TYPE") function
(available since Python 3\.9\). For backward compatibility, this macro can be
used:

\`\`\`
\#if PY\_VERSION\_HEX \ob\_type = type; }
\#define Py\_SET\_TYPE(ob, type) \_Py\_SET\_TYPE((PyObject\*)(ob), type)
\#endif

\`\`\`

(Contributed by Victor Stinner in [bpo\-39573](https://bugs.python.org/issue?@action=redirect&bpo=39573).)
* Since [`Py_SIZE()`](../c-api/structures.html#c.Py_SIZE "Py_SIZE") is changed to a inline static function,
`Py_SIZE(obj) = new_size` must be replaced with
`Py_SET_SIZE(obj, new_size)`: see the [`Py_SET_SIZE()`](../c-api/structures.html#c.Py_SET_SIZE "Py_SET_SIZE") function
(available since Python 3\.9\). For backward compatibility, this macro can be
used:

\`\`\`
\#if PY\_VERSION\_HEX \ob\_size = size; }
\#define Py\_SET\_SIZE(ob, size) \_Py\_SET\_SIZE((PyVarObject\*)(ob), size)
\#endif

\`\`\`

(Contributed by Victor Stinner in [bpo\-39573](https://bugs.python.org/issue?@action=redirect&bpo=39573).)
* `` no longer includes the header files ``,
``, `` and `` when the `Py_LIMITED_API`
macro is set to `0x030b0000` (Python 3\.11\) or higher. C extensions should
explicitly include the header files after `#include `.
(Contributed by Victor Stinner in [bpo\-45434](https://bugs.python.org/issue?@action=redirect&bpo=45434).)
* The non\-limited API files `cellobject.h`, `classobject.h`, `code.h`, `context.h`,
`funcobject.h`, `genobject.h` and `longintrepr.h` have been moved to
the `Include/cpython` directory. Moreover, the `eval.h` header file was
removed. These files must not be included directly, as they are already
included in `Python.h`: [Include Files](../c-api/intro.html#api-includes). If they have
been included directly, consider including `Python.h` instead.
(Contributed by Victor Stinner in [bpo\-35134](https://bugs.python.org/issue?@action=redirect&bpo=35134).)
* The `PyUnicode_CHECK_INTERNED()` macro has been excluded from the
limited C API. It was never usable there, because it used internal structures
which are not available in the limited C API.
(Contributed by Victor Stinner in [bpo\-46007](https://bugs.python.org/issue?@action=redirect&bpo=46007).)
* The following frame functions and type are now directly available with
`#include `, it’s no longer needed to add
`#include `:

	+ [`PyFrame_Check()`](../c-api/frame.html#c.PyFrame_Check "PyFrame_Check")
	+ [`PyFrame_GetBack()`](../c-api/frame.html#c.PyFrame_GetBack "PyFrame_GetBack")
	+ [`PyFrame_GetBuiltins()`](../c-api/frame.html#c.PyFrame_GetBuiltins "PyFrame_GetBuiltins")
	+ [`PyFrame_GetGenerator()`](../c-api/frame.html#c.PyFrame_GetGenerator "PyFrame_GetGenerator")
	+ [`PyFrame_GetGlobals()`](../c-api/frame.html#c.PyFrame_GetGlobals "PyFrame_GetGlobals")
	+ [`PyFrame_GetLasti()`](../c-api/frame.html#c.PyFrame_GetLasti "PyFrame_GetLasti")
	+ [`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals")
	+ [`PyFrame_Type`](../c-api/frame.html#c.PyFrame_Type "PyFrame_Type")(Contributed by Victor Stinner in [gh\-93937](https://github.com/python/cpython/issues/93937).)

* The [`PyFrameObject`](../c-api/frame.html#c.PyFrameObject "PyFrameObject") structure members have been removed from the
public C API.

While the documentation notes that the [`PyFrameObject`](../c-api/frame.html#c.PyFrameObject "PyFrameObject") fields are
subject to change at any time, they have been stable for a long time and were
used in several popular extensions.

In Python 3\.11, the frame struct was reorganized to allow performance
optimizations. Some fields were removed entirely, as they were details of the
old implementation.

[`PyFrameObject`](../c-api/frame.html#c.PyFrameObject "PyFrameObject") fields:

	+ `f_back`: use [`PyFrame_GetBack()`](../c-api/frame.html#c.PyFrame_GetBack "PyFrame_GetBack").
	+ `f_blockstack`: removed.
	+ `f_builtins`: use [`PyFrame_GetBuiltins()`](../c-api/frame.html#c.PyFrame_GetBuiltins "PyFrame_GetBuiltins").
	+ `f_code`: use [`PyFrame_GetCode()`](../c-api/frame.html#c.PyFrame_GetCode "PyFrame_GetCode").
	+ `f_gen`: use [`PyFrame_GetGenerator()`](../c-api/frame.html#c.PyFrame_GetGenerator "PyFrame_GetGenerator").
	+ `f_globals`: use [`PyFrame_GetGlobals()`](../c-api/frame.html#c.PyFrame_GetGlobals "PyFrame_GetGlobals").
	+ `f_iblock`: removed.
	+ `f_lasti`: use [`PyFrame_GetLasti()`](../c-api/frame.html#c.PyFrame_GetLasti "PyFrame_GetLasti").
	Code using `f_lasti` with `PyCode_Addr2Line()` should use
	[`PyFrame_GetLineNumber()`](../c-api/frame.html#c.PyFrame_GetLineNumber "PyFrame_GetLineNumber") instead; it may be faster.
	+ `f_lineno`: use [`PyFrame_GetLineNumber()`](../c-api/frame.html#c.PyFrame_GetLineNumber "PyFrame_GetLineNumber")
	+ `f_locals`: use [`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals").
	+ `f_stackdepth`: removed.
	+ `f_state`: no public API (renamed to `f_frame.f_state`).
	+ `f_trace`: no public API.
	+ `f_trace_lines`: use `PyObject_GetAttrString((PyObject*)frame, "f_trace_lines")`.
	+ `f_trace_opcodes`: use `PyObject_GetAttrString((PyObject*)frame, "f_trace_opcodes")`.
	+ `f_localsplus`: no public API (renamed to `f_frame.localsplus`).
	+ `f_valuestack`: removed.The Python frame object is now created lazily. A side effect is that the
[`f_back`](../reference/datamodel.html#frame.f_back "frame.f_back") member must not be accessed directly,
since its value is now also
computed lazily. The [`PyFrame_GetBack()`](../c-api/frame.html#c.PyFrame_GetBack "PyFrame_GetBack") function must be called
instead.

Debuggers that accessed the [`f_locals`](../reference/datamodel.html#frame.f_locals "frame.f_locals") directly *must* call
[`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals") instead. They no longer need to call
`PyFrame_FastToLocalsWithError()` or `PyFrame_LocalsToFast()`,
in fact they should not call those functions. The necessary updating of the
frame is now managed by the virtual machine.

Code defining `PyFrame_GetCode()` on Python 3\.8 and older:

\`\`\`
\#if PY\_VERSION\_HEX \f\_code);
 return frame\-\>f\_code;
}
\#endif

\`\`\`

Code defining `PyFrame_GetBack()` on Python 3\.8 and older:

\`\`\`
\#if PY\_VERSION\_HEX \f\_back);
 return frame\-\>f\_back;
}
\#endif

\`\`\`

Or use the [pythoncapi\_compat project](https://github.com/python/pythoncapi-compat) to get these two
functions on older Python versions.
* Changes of the [`PyThreadState`](../c-api/init.html#c.PyThreadState "PyThreadState") structure members:

	+ `frame`: removed, use [`PyThreadState_GetFrame()`](../c-api/init.html#c.PyThreadState_GetFrame "PyThreadState_GetFrame") (function added
	to Python 3\.9 by [bpo\-40429](https://bugs.python.org/issue?@action=redirect&bpo=40429)).
	Warning: the function returns a [strong reference](../glossary.html#term-strong-reference), need to call
	[`Py_XDECREF()`](../c-api/refcounting.html#c.Py_XDECREF "Py_XDECREF").
	+ `tracing`: changed, use [`PyThreadState_EnterTracing()`](../c-api/init.html#c.PyThreadState_EnterTracing "PyThreadState_EnterTracing")
	and [`PyThreadState_LeaveTracing()`](../c-api/init.html#c.PyThreadState_LeaveTracing "PyThreadState_LeaveTracing")
	(functions added to Python 3\.11 by [bpo\-43760](https://bugs.python.org/issue?@action=redirect&bpo=43760)).
	+ `recursion_depth`: removed,
	use `(tstate->recursion_limit - tstate->recursion_remaining)` instead.
	+ `stackcheck_counter`: removed.Code defining `PyThreadState_GetFrame()` on Python 3\.8 and older:

\`\`\`
\#if PY\_VERSION\_HEX \frame);
 return tstate\-\>frame;
}
\#endif

\`\`\`

Code defining `PyThreadState_EnterTracing()` and
`PyThreadState_LeaveTracing()` on Python 3\.10 and older:

\`\`\`
\#if PY\_VERSION\_HEX \tracing\+\+;
\#if PY\_VERSION\_HEX \>= 0x030A00A1
 tstate\-\>cframe\-\>use\_tracing = 0;
\#else
 tstate\-\>use\_tracing = 0;
\#endif
}

static inline void PyThreadState\_LeaveTracing(PyThreadState \*tstate)
{
 int use\_tracing = (tstate\-\>c\_tracefunc != NULL \|\| tstate\-\>c\_profilefunc != NULL);
 tstate\-\>tracing\-\-;
\#if PY\_VERSION\_HEX \>= 0x030A00A1
 tstate\-\>cframe\-\>use\_tracing = use\_tracing;
\#else
 tstate\-\>use\_tracing = use\_tracing;
\#endif
}
\#endif

\`\`\`

Or use [the pythoncapi\-compat project](https://github.com/python/pythoncapi-compat) to get these functions
on old Python functions.
* Distributors are encouraged to build Python with the optimized Blake2
library [libb2](https://www.blake2.net/).
* The [`PyConfig.module_search_paths_set`](../c-api/init_config.html#c.PyConfig.module_search_paths_set "PyConfig.module_search_paths_set") field must now be set to 1 for
initialization to use [`PyConfig.module_search_paths`](../c-api/init_config.html#c.PyConfig.module_search_paths "PyConfig.module_search_paths") to initialize
[`sys.path`](../library/sys.html#sys.path "sys.path"). Otherwise, initialization will recalculate the path and replace
any values added to `module_search_paths`.
* [`PyConfig_Read()`](../c-api/init_config.html#c.PyConfig_Read "PyConfig_Read") no longer calculates the initial search path, and will not
fill any values into [`PyConfig.module_search_paths`](../c-api/init_config.html#c.PyConfig.module_search_paths "PyConfig.module_search_paths"). To calculate default
paths and then modify them, finish initialization and use [`PySys_GetObject()`](../c-api/sys.html#c.PySys_GetObject "PySys_GetObject")
to retrieve [`sys.path`](../library/sys.html#sys.path "sys.path") as a Python list object and modify it directly.

### Deprecated[¶](#whatsnew311-c-api-deprecated "Link to this heading")

* Deprecate the following functions to configure the Python initialization:

	+ `PySys_AddWarnOptionUnicode()`
	+ `PySys_AddWarnOption()`
	+ `PySys_AddXOption()`
	+ `PySys_HasWarnOptions()`
	+ `PySys_SetArgvEx()`
	+ `PySys_SetArgv()`
	+ `PySys_SetPath()`
	+ `Py_SetPath()`
	+ `Py_SetProgramName()`
	+ `Py_SetPythonHome()`
	+ `Py_SetStandardStreamEncoding()`
	+ `_Py_SetProgramFullPath()`Use the new [`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig") API of the [Python Initialization Configuration](../c-api/init_config.html#init-config) instead ([**PEP 587**](https://peps.python.org/pep-0587/)).
(Contributed by Victor Stinner in [gh\-88279](https://github.com/python/cpython/issues/88279).)
* Deprecate the `ob_shash` member of the [`PyBytesObject`](../c-api/bytes.html#c.PyBytesObject "PyBytesObject"). Use [`PyObject_Hash()`](../c-api/object.html#c.PyObject_Hash "PyObject_Hash") instead.
(Contributed by Inada Naoki in [bpo\-46864](https://bugs.python.org/issue?@action=redirect&bpo=46864).)

### Pending Removal in Python 3\.12[¶](#whatsnew311-c-api-pending-removal "Link to this heading")

The following C APIs have been deprecated in earlier Python releases,
and will be removed in Python 3\.12\.

* `PyUnicode_AS_DATA()`
* `PyUnicode_AS_UNICODE()`
* `PyUnicode_AsUnicodeAndSize()`
* `PyUnicode_AsUnicode()`
* `PyUnicode_FromUnicode()`
* `PyUnicode_GET_DATA_SIZE()`
* `PyUnicode_GET_SIZE()`
* `PyUnicode_GetSize()`
* `PyUnicode_IS_COMPACT()`
* `PyUnicode_IS_READY()`
* [`PyUnicode_READY()`](../c-api/unicode.html#c.PyUnicode_READY "PyUnicode_READY")
* `PyUnicode_WSTR_LENGTH()`
* `_PyUnicode_AsUnicode()`
* `PyUnicode_WCHAR_KIND`
* [`PyUnicodeObject`](../c-api/unicode.html#c.PyUnicodeObject "PyUnicodeObject")
* `PyUnicode_InternImmortal()`

### Removed[¶](#whatsnew311-c-api-removed "Link to this heading")

* `PyFrame_BlockSetup()` and `PyFrame_BlockPop()` have been
removed.
(Contributed by Mark Shannon in [bpo\-40222](https://bugs.python.org/issue?@action=redirect&bpo=40222).)
* Remove the following math macros using the `errno` variable:

	+ `Py_ADJUST_ERANGE1()`
	+ `Py_ADJUST_ERANGE2()`
	+ `Py_OVERFLOWED()`
	+ `Py_SET_ERANGE_IF_OVERFLOW()`
	+ `Py_SET_ERRNO_ON_MATH_ERROR()`(Contributed by Victor Stinner in [bpo\-45412](https://bugs.python.org/issue?@action=redirect&bpo=45412).)
* Remove `Py_UNICODE_COPY()` and `Py_UNICODE_FILL()` macros, deprecated
since Python 3\.3\. Use `PyUnicode_CopyCharacters()` or `memcpy()`
(`wchar_t*` string), and `PyUnicode_Fill()` functions instead.
(Contributed by Victor Stinner in [bpo\-41123](https://bugs.python.org/issue?@action=redirect&bpo=41123).)
* Remove the `pystrhex.h` header file. It only contains private functions.
C extensions should only include the main `` header file.
(Contributed by Victor Stinner in [bpo\-45434](https://bugs.python.org/issue?@action=redirect&bpo=45434).)
* Remove the `Py_FORCE_DOUBLE()` macro. It was used by the
`Py_IS_INFINITY()` macro.
(Contributed by Victor Stinner in [bpo\-45440](https://bugs.python.org/issue?@action=redirect&bpo=45440).)
* The following items are no longer available when [`Py_LIMITED_API`](../c-api/stable.html#c.Py_LIMITED_API "Py_LIMITED_API")
is defined:

	+ [`PyMarshal_WriteLongToFile()`](../c-api/marshal.html#c.PyMarshal_WriteLongToFile "PyMarshal_WriteLongToFile")
	+ [`PyMarshal_WriteObjectToFile()`](../c-api/marshal.html#c.PyMarshal_WriteObjectToFile "PyMarshal_WriteObjectToFile")
	+ [`PyMarshal_ReadObjectFromString()`](../c-api/marshal.html#c.PyMarshal_ReadObjectFromString "PyMarshal_ReadObjectFromString")
	+ [`PyMarshal_WriteObjectToString()`](../c-api/marshal.html#c.PyMarshal_WriteObjectToString "PyMarshal_WriteObjectToString")
	+ the `Py_MARSHAL_VERSION` macroThese are not part of the [limited API](../c-api/stable.html#limited-api-list).

(Contributed by Victor Stinner in [bpo\-45474](https://bugs.python.org/issue?@action=redirect&bpo=45474).)
* Exclude [`PyWeakref_GET_OBJECT()`](../c-api/weakref.html#c.PyWeakref_GET_OBJECT "PyWeakref_GET_OBJECT") from the limited C API. It never
worked since the `PyWeakReference` structure is opaque in the
limited C API.
(Contributed by Victor Stinner in [bpo\-35134](https://bugs.python.org/issue?@action=redirect&bpo=35134).)
* Remove the `PyHeapType_GET_MEMBERS()` macro. It was exposed in the
public C API by mistake, it must only be used by Python internally.
Use the `PyTypeObject.tp_members` member instead.
(Contributed by Victor Stinner in [bpo\-40170](https://bugs.python.org/issue?@action=redirect&bpo=40170).)
* Remove the `HAVE_PY_SET_53BIT_PRECISION` macro (moved to the internal C
API).
(Contributed by Victor Stinner in [bpo\-45412](https://bugs.python.org/issue?@action=redirect&bpo=45412).)

* Remove the [`Py_UNICODE`](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE") encoder APIs,
as they have been deprecated since Python 3\.3,
are little used
and are inefficient relative to the recommended alternatives.

The removed functions are:

	+ `PyUnicode_Encode()`
	+ `PyUnicode_EncodeASCII()`
	+ `PyUnicode_EncodeLatin1()`
	+ `PyUnicode_EncodeUTF7()`
	+ `PyUnicode_EncodeUTF8()`
	+ `PyUnicode_EncodeUTF16()`
	+ `PyUnicode_EncodeUTF32()`
	+ `PyUnicode_EncodeUnicodeEscape()`
	+ `PyUnicode_EncodeRawUnicodeEscape()`
	+ `PyUnicode_EncodeCharmap()`
	+ `PyUnicode_TranslateCharmap()`
	+ `PyUnicode_EncodeDecimal()`
	+ `PyUnicode_TransformDecimalToASCII()`See [**PEP 624**](https://peps.python.org/pep-0624/) for details and
[**migration guidance**](https://peps.python.org/pep-0624/#alternative-apis).
(Contributed by Inada Naoki in [bpo\-44029](https://bugs.python.org/issue?@action=redirect&bpo=44029).)

## Notable changes in 3\.11\.4[¶](#notable-changes-in-3-11-4 "Link to this heading")

### tarfile[¶](#tarfile "Link to this heading")

* The extraction methods in [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), and [`shutil.unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"),
have a new a *filter* argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See [Extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
In Python 3\.12, use without the *filter* argument will show a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
In Python 3\.14, the default will switch to `'data'`.
(Contributed by Petr Viktorin in [**PEP 706**](https://peps.python.org/pep-0706/).)

## Notable changes in 3\.11\.5[¶](#notable-changes-in-3-11-5 "Link to this heading")

### OpenSSL[¶](#openssl "Link to this heading")

* Windows builds and macOS installers from python.org now use OpenSSL 3\.0\.

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.11](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [PEP 657: Fine\-grained error locations in tracebacks](#pep-657-fine-grained-error-locations-in-tracebacks)
		- [PEP 654: Exception Groups and `except*`](#pep-654-exception-groups-and-except)
		- [PEP 678: Exceptions can be enriched with notes](#pep-678-exceptions-can-be-enriched-with-notes)
		- [Windows `py.exe` launcher improvements](#windows-py-exe-launcher-improvements)
	+ [New Features Related to Type Hints](#new-features-related-to-type-hints)
		- [PEP 646: Variadic generics](#pep-646-variadic-generics)
		- [PEP 655: Marking individual `TypedDict` items as required or not\-required](#pep-655-marking-individual-typeddict-items-as-required-or-not-required)
		- [PEP 673: `Self` type](#pep-673-self-type)
		- [PEP 675: Arbitrary literal string type](#pep-675-arbitrary-literal-string-type)
		- [PEP 681: Data class transforms](#pep-681-data-class-transforms)
		- [PEP 563 may not be the future](#pep-563-may-not-be-the-future)
	+ [Other Language Changes](#other-language-changes)
	+ [Other CPython Implementation Changes](#other-cpython-implementation-changes)
	+ [New Modules](#new-modules)
	+ [Improved Modules](#improved-modules)
		- [asyncio](#asyncio)
		- [contextlib](#contextlib)
		- [dataclasses](#dataclasses)
		- [datetime](#datetime)
		- [enum](#enum)
		- [fcntl](#fcntl)
		- [fractions](#fractions)
		- [functools](#functools)
		- [gzip](#gzip)
		- [hashlib](#hashlib)
		- [IDLE and idlelib](#whatsnew311-idle)
		- [inspect](#inspect)
		- [locale](#locale)
		- [logging](#logging)
		- [math](#math)
		- [operator](#operator)
		- [os](#os)
		- [pathlib](#pathlib)
		- [re](#re)
		- [shutil](#shutil)
		- [socket](#socket)
		- [sqlite3](#sqlite3)
		- [string](#string)
		- [sys](#sys)
		- [sysconfig](#sysconfig)
		- [tempfile](#tempfile)
		- [threading](#threading)
		- [time](#time)
		- [tkinter](#tkinter)
		- [traceback](#traceback)
		- [typing](#typing)
		- [unicodedata](#unicodedata)
		- [unittest](#unittest)
		- [venv](#venv)
		- [warnings](#warnings)
		- [zipfile](#zipfile)
	+ [Optimizations](#optimizations)
	+ [Faster CPython](#faster-cpython)
		- [Faster Startup](#faster-startup)
			* [Frozen imports / Static code objects](#frozen-imports-static-code-objects)
		- [Faster Runtime](#faster-runtime)
			* [Cheaper, lazy Python frames](#cheaper-lazy-python-frames)
			* [Inlined Python function calls](#inlined-python-function-calls)
			* [PEP 659: Specializing Adaptive Interpreter](#pep-659-specializing-adaptive-interpreter)
		- [Misc](#misc)
		- [FAQ](#faq)
			* [How should I write my code to utilize these speedups?](#how-should-i-write-my-code-to-utilize-these-speedups)
			* [Will CPython 3\.11 use more memory?](#will-cpython-3-11-use-more-memory)
			* [I don’t see any speedups in my workload. Why?](#i-don-t-see-any-speedups-in-my-workload-why)
			* [Is there a JIT compiler?](#is-there-a-jit-compiler)
		- [About](#about)
	+ [CPython bytecode changes](#cpython-bytecode-changes)
		- [New opcodes](#new-opcodes)
		- [Replaced opcodes](#replaced-opcodes)
		- [Changed/removed opcodes](#changed-removed-opcodes)
	+ [Deprecated](#deprecated)
		- [Language/Builtins](#language-builtins)
		- [Modules](#modules)
		- [Standard Library](#standard-library)
	+ [Pending Removal in Python 3\.12](#pending-removal-in-python-3-12)
	+ [Removed](#removed)
	+ [Porting to Python 3\.11](#porting-to-python-3-11)
	+ [Build Changes](#build-changes)
	+ [C API Changes](#c-api-changes)
		- [New Features](#whatsnew311-c-api-new-features)
		- [Porting to Python 3\.11](#whatsnew311-c-api-porting)
		- [Deprecated](#whatsnew311-c-api-deprecated)
		- [Pending Removal in Python 3\.12](#whatsnew311-c-api-pending-removal)
		- [Removed](#whatsnew311-c-api-removed)
	+ [Notable changes in 3\.11\.4](#notable-changes-in-3-11-4)
		- [tarfile](#tarfile)
	+ [Notable changes in 3\.11\.5](#notable-changes-in-3-11-5)
		- [OpenSSL](#openssl)

#### Previous topic

[What’s New In Python 3\.12](3.12.html "previous chapter")

#### Next topic

[What’s New In Python 3\.10](3.10.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.11.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.10.html "What’s New In Python 3.10") \|
* [previous](3.12.html "What’s New In Python 3.12") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.11
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.12 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.12.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.11.html "What’s New In Python 3.11") \|
* [previous](3.13.html "What’s New In Python 3.13") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.12
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.12[¶](#what-s-new-in-python-3-12 "Link to this heading")

Editor:
Adam Turner

This article explains the new features in Python 3\.12, compared to 3\.11\.
Python 3\.12 was released on October 2, 2023\.
For full details, see the [changelog](changelog.html#changelog).

See also

[**PEP 693**](https://peps.python.org/pep-0693/) – Python 3\.12 Release Schedule

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

Python 3\.12 is a stable release of the Python programming language,
with a mix of changes to the language and the standard library.
The library changes focus on cleaning up deprecated APIs, usability, and correctness.
Of note, the `distutils` package has been removed from the standard library.
Filesystem support in [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") and [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths") has seen a number of improvements,
and several modules have better performance.

The language changes focus on usability,
as [f\-strings](../glossary.html#term-f-string) have had many limitations removed
and ‘Did you mean …’ suggestions continue to improve.
The new [type parameter syntax](#whatsnew312-pep695)
and [`type`](../reference/simple_stmts.html#type) statement improve ergonomics for using [generic types](../glossary.html#term-generic-type) and [type aliases](../glossary.html#term-type-alias) with static type checkers.

This article doesn’t attempt to provide a complete specification of all new features,
but instead gives a convenient overview.
For full details, you should refer to the documentation,
such as the [Library Reference](../library/index.html#library-index)
and [Language Reference](../reference/index.html#reference-index).
If you want to understand the complete implementation and design rationale for a change,
refer to the PEP for a particular new feature;
but note that PEPs usually are not kept up\-to\-date
once a feature has been fully implemented.

---

New syntax features:

* [PEP 695](#whatsnew312-pep695), type parameter syntax and the [`type`](../reference/simple_stmts.html#type) statement

New grammar features:

* [PEP 701](#whatsnew312-pep701), [f\-strings](../glossary.html#term-f-string) in the grammar

Interpreter improvements:

* [PEP 684](#whatsnew312-pep684), a unique per\-interpreter [GIL](../glossary.html#term-global-interpreter-lock)
* [PEP 669](#whatsnew312-pep669), low impact monitoring
* [Improved ‘Did you mean …’ suggestions](#improved-error-messages)
for [`NameError`](../library/exceptions.html#NameError "NameError"), [`ImportError`](../library/exceptions.html#ImportError "ImportError"), and [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") exceptions

Python data model improvements:

* [PEP 688](#whatsnew312-pep688), using the [buffer protocol](../c-api/buffer.html#bufferobjects) from Python

Significant improvements in the standard library:

* The [`pathlib.Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") class now supports subclassing
* The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module received several improvements for Windows support
* A [command\-line interface](../library/sqlite3.html#sqlite3-cli) has been added to the
[`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") module
* [`isinstance()`](../library/functions.html#isinstance "isinstance") checks against [`runtime-checkable protocols`](../library/typing.html#typing.runtime_checkable "typing.runtime_checkable") enjoy a speed up of between two and 20 times
* The [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") package has had a number of performance improvements,
with some benchmarks showing a 75% speed up.
* A [command\-line interface](../library/uuid.html#uuid-cli) has been added to the
[`uuid`](../library/uuid.html#module-uuid "uuid: UUID objects (universally unique identifiers) according to RFC 4122") module
* Due to the changes in [PEP 701](#whatsnew312-pep701),
producing tokens via the [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module is up to 64% faster.

Security improvements:

* Replace the builtin [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") implementations of
SHA1, SHA3, SHA2\-384, SHA2\-512, and MD5 with formally verified code from the
[HACL\*](https://github.com/hacl-star/hacl-star/) project.
These builtin implementations remain as fallbacks that are only used when
OpenSSL does not provide them.

C API improvements:

* [PEP 697](#whatsnew312-pep697), unstable C API tier
* [PEP 683](#whatsnew312-pep683), immortal objects

CPython implementation improvements:

* [PEP 709](#whatsnew312-pep709), comprehension inlining
* [CPython support](../howto/perf_profiling.html#perf-profiling) for the Linux `perf` profiler
* Implement stack overflow protection on supported platforms

New typing features:

* [PEP 692](#whatsnew312-pep692), using [`TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") to
annotate [\*\*kwargs](../glossary.html#term-argument)
* [PEP 698](#whatsnew312-pep698), [`typing.override()`](../library/typing.html#typing.override "typing.override") decorator

Important deprecations, removals or restrictions:

* [**PEP 623**](https://peps.python.org/pep-0623/): Remove `wstr` from Unicode objects in Python’s C API,
reducing the size of every [`str`](../library/stdtypes.html#str "str") object by at least 8 bytes.
* [**PEP 632**](https://peps.python.org/pep-0632/): Remove the `distutils` package.
See [**the migration guide**](https://peps.python.org/pep-0632/#migration-advice)
for advice replacing the APIs it provided.
The third\-party [Setuptools](https://setuptools.pypa.io/en/latest/deprecated/distutils-legacy.html)
package continues to provide `distutils`,
if you still require it in Python 3\.12 and beyond.
* [gh\-95299](https://github.com/python/cpython/issues/95299): Do not pre\-install `setuptools` in virtual environments
created with [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.").
This means that `distutils`, `setuptools`, `pkg_resources`,
and `easy_install` will no longer available by default; to access these
run `pip install setuptools` in the [activated](../library/venv.html#venv-explanation)
virtual environment.
* The `asynchat`, `asyncore`, and `imp` modules have been
removed, along with several [`unittest.TestCase`](../library/unittest.html#unittest.TestCase "unittest.TestCase")
[method aliases](#unittest-testcase-removed-aliases).

## New Features[¶](#new-features "Link to this heading")

### PEP 695: Type Parameter Syntax[¶](#pep-695-type-parameter-syntax "Link to this heading")

Generic classes and functions under [**PEP 484**](https://peps.python.org/pep-0484/) were declared using a verbose syntax
that left the scope of type parameters unclear and required explicit declarations of
variance.

[**PEP 695**](https://peps.python.org/pep-0695/) introduces a new, more compact and explicit way to create
[generic classes](../reference/compound_stmts.html#generic-classes) and [functions](../reference/compound_stmts.html#generic-functions):

\`\`\`
def max\[T](args: Iterable\[T]) \-\> T:
 ...

class list\[T]:
 def \_\_getitem\_\_(self, index: int, /) \-\> T:
 ...

 def append(self, element: T) \-\> None:
 ...

\`\`\`

In addition, the PEP introduces a new way to declare [type aliases](../library/typing.html#type-aliases)
using the [`type`](../reference/simple_stmts.html#type) statement, which creates an instance of
[`TypeAliasType`](../library/typing.html#typing.TypeAliasType "typing.TypeAliasType"):

\`\`\`
type Point = tuple\[float, float]

\`\`\`

Type aliases can also be [generic](../reference/compound_stmts.html#generic-type-aliases):

\`\`\`
type Point\[T] = tuple\[T, T]

\`\`\`

The new syntax allows declaring [`TypeVarTuple`](../library/typing.html#typing.TypeVarTuple "typing.TypeVarTuple")
and [`ParamSpec`](../library/typing.html#typing.ParamSpec "typing.ParamSpec") parameters, as well as [`TypeVar`](../library/typing.html#typing.TypeVar "typing.TypeVar")
parameters with bounds or constraints:

\`\`\`
type IntFunc\[\*\*P] = Callable\[P, int] \# ParamSpec
type LabeledTuple\[\*Ts] = tuple\[str, \*Ts] \# TypeVarTuple
type HashableSequence\[T: Hashable] = Sequence\[T] \# TypeVar with bound
type IntOrStrSequence\[T: (int, str)] = Sequence\[T] \# TypeVar with constraints

\`\`\`

The value of type aliases and the bound and constraints of type variables
created through this syntax are evaluated only on demand (see
[lazy evaluation](../reference/executionmodel.html#lazy-evaluation)). This means type aliases are able to
refer to other types defined later in the file.

Type parameters declared through a type parameter list are visible within the
scope of the declaration and any nested scopes, but not in the outer scope. For
example, they can be used in the type annotations for the methods of a generic
class or in the class body. However, they cannot be used in the module scope after
the class is defined. See [Type parameter lists](../reference/compound_stmts.html#type-params) for a detailed description of the
runtime semantics of type parameters.

In order to support these scoping semantics, a new kind of scope is introduced,
the [annotation scope](../reference/executionmodel.html#annotation-scopes). Annotation scopes behave for the
most part like function scopes, but interact differently with enclosing class scopes.
In Python 3\.13, [annotations](../glossary.html#term-annotation) will also be evaluated in
annotation scopes.

See [**PEP 695**](https://peps.python.org/pep-0695/) for more details.

(PEP written by Eric Traut. Implementation by Jelle Zijlstra, Eric Traut,
and others in [gh\-103764](https://github.com/python/cpython/issues/103764).)

### PEP 701: Syntactic formalization of f\-strings[¶](#pep-701-syntactic-formalization-of-f-strings "Link to this heading")

[**PEP 701**](https://peps.python.org/pep-0701/) lifts some restrictions on the usage of [f\-strings](../glossary.html#term-f-string).
Expression components inside f\-strings can now be any valid Python expression,
including strings reusing the same quote as the containing f\-string,
multi\-line expressions, comments, backslashes, and unicode escape sequences.
Let’s cover these in detail:

* Quote reuse: in Python 3\.11, reusing the same quotes as the enclosing f\-string
raises a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError"), forcing the user to either use other available
quotes (like using double quotes or triple quotes if the f\-string uses single
quotes). In Python 3\.12, you can now do things like this:

\`\`\`
\>\>\> songs = \['Take me back to Eden', 'Alkaline', 'Ascensionism']
\>\>\> f"This is the playlist: {", ".join(songs)}"
'This is the playlist: Take me back to Eden, Alkaline, Ascensionism'

\`\`\`

Note that before this change there was no explicit limit in how f\-strings can
be nested, but the fact that string quotes cannot be reused inside the
expression component of f\-strings made it impossible to nest f\-strings
arbitrarily. In fact, this is the most nested f\-string that could be written:

\`\`\`
\>\>\> f"""{f'''{f'{f"{1\+1}"}'}'''}"""
'2'

\`\`\`

As now f\-strings can contain any valid Python expression inside expression
components, it is now possible to nest f\-strings arbitrarily:

\`\`\`
\>\>\> f"{f"{f"{f"{f"{f"{1\+1}"}"}"}"}"}"
'2'

\`\`\`
* Multi\-line expressions and comments: In Python 3\.11, f\-string expressions
must be defined in a single line, even if the expression within the f\-string
could normally span multiple lines
(like literal lists being defined over multiple lines),
making them harder to read. In Python 3\.12 you can now define f\-strings
spanning multiple lines, and add inline comments:

\`\`\`
\>\>\> f"This is the playlist: {", ".join(\[
... 'Take me back to Eden', \# My, my, those eyes like fire
... 'Alkaline', \# Not acid nor alkaline
... 'Ascensionism' \# Take to the broken skies at last
... ])}"
'This is the playlist: Take me back to Eden, Alkaline, Ascensionism'

\`\`\`
* Backslashes and unicode characters: before Python 3\.12 f\-string expressions
couldn’t contain any `\` character. This also affected unicode [escape
sequences](../reference/lexical_analysis.html#escape-sequences) (such as `\N{snowman}`) as these contain
the `\N` part that previously could not be part of expression components of
f\-strings. Now, you can define expressions like this:

\`\`\`
\>\>\> print(f"This is the playlist: {"\\n".join(songs)}")
This is the playlist: Take me back to Eden
Alkaline
Ascensionism
\>\>\> print(f"This is the playlist: {"\\N{BLACK HEART SUIT}".join(songs)}")
This is the playlist: Take me back to Eden♥Alkaline♥Ascensionism

\`\`\`

See [**PEP 701**](https://peps.python.org/pep-0701/) for more details.

As a positive side\-effect of how this feature has been implemented (by parsing f\-strings
with [**the PEG parser**](https://peps.python.org/pep-0617/)), now error messages for f\-strings are more precise
and include the exact location of the error. For example, in Python 3\.11, the following
f\-string raises a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError"):

\`\`\`
\>\>\> my\_string = f"{x z y}" \+ f"{1 \+ 1}"
 File "\", line 1
 (x z y)
 ^^^
SyntaxError: f\-string: invalid syntax. Perhaps you forgot a comma?

\`\`\`

but the error message doesn’t include the exact location of the error within the line and
also has the expression artificially surrounded by parentheses. In Python 3\.12, as f\-strings
are parsed with the PEG parser, error messages can be more precise and show the entire line:

\`\`\`
\>\>\> my\_string = f"{x z y}" \+ f"{1 \+ 1}"
 File "\", line 1
 my\_string = f"{x z y}" \+ f"{1 \+ 1}"
 ^^^
SyntaxError: invalid syntax. Perhaps you forgot a comma?

\`\`\`

(Contributed by Pablo Galindo, Batuhan Taskaya, Lysandros Nikolaou, Cristián
Maureira\-Fredes and Marta Gómez in [gh\-102856](https://github.com/python/cpython/issues/102856). PEP written by Pablo Galindo,
Batuhan Taskaya, Lysandros Nikolaou and Marta Gómez).

### PEP 684: A Per\-Interpreter GIL[¶](#pep-684-a-per-interpreter-gil "Link to this heading")

[**PEP 684**](https://peps.python.org/pep-0684/) introduces a per\-interpreter [GIL](../glossary.html#term-global-interpreter-lock),
so that sub\-interpreters may now be created with a unique GIL per interpreter.
This allows Python programs to take full advantage of multiple CPU
cores. This is currently only available through the C\-API,
though a Python API is [**anticipated for 3\.13**](https://peps.python.org/pep-0554/).

Use the new [`Py_NewInterpreterFromConfig()`](../c-api/init.html#c.Py_NewInterpreterFromConfig "Py_NewInterpreterFromConfig") function to
create an interpreter with its own GIL:

\`\`\`
PyInterpreterConfig config = {
 .check\_multi\_interp\_extensions = 1,
 .gil = PyInterpreterConfig\_OWN\_GIL,
};
PyThreadState \*tstate = NULL;
PyStatus status = Py\_NewInterpreterFromConfig(\&tstate, \&config);
if (PyStatus\_Exception(status)) {
 return \-1;
}
/\* The new interpreter is now active in the current thread. \*/

\`\`\`

For further examples how to use the C\-API for sub\-interpreters with a
per\-interpreter GIL, see `Modules/_xxsubinterpretersmodule.c`.

(Contributed by Eric Snow in [gh\-104210](https://github.com/python/cpython/issues/104210), etc.)

### PEP 669: Low impact monitoring for CPython[¶](#pep-669-low-impact-monitoring-for-cpython "Link to this heading")

[**PEP 669**](https://peps.python.org/pep-0669/) defines a new [`API`](../library/sys.monitoring.html#module-sys.monitoring "sys.monitoring: Access and control event monitoring") for profilers,
debuggers, and other tools to monitor events in CPython.
It covers a wide range of events, including calls,
returns, lines, exceptions, jumps, and more.
This means that you only pay for what you use, providing support
for near\-zero overhead debuggers and coverage tools.
See [`sys.monitoring`](../library/sys.monitoring.html#module-sys.monitoring "sys.monitoring: Access and control event monitoring") for details.

(Contributed by Mark Shannon in [gh\-103082](https://github.com/python/cpython/issues/103082).)

### PEP 688: Making the buffer protocol accessible in Python[¶](#pep-688-making-the-buffer-protocol-accessible-in-python "Link to this heading")

[**PEP 688**](https://peps.python.org/pep-0688/) introduces a way to use the [buffer protocol](../c-api/buffer.html#bufferobjects)
from Python code. Classes that implement the [`__buffer__()`](../reference/datamodel.html#object.__buffer__ "object.__buffer__") method
are now usable as buffer types.

The new [`collections.abc.Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer") ABC provides a standard
way to represent buffer objects, for example in type annotations.
The new [`inspect.BufferFlags`](../library/inspect.html#inspect.BufferFlags "inspect.BufferFlags") enum represents the flags that
can be used to customize buffer creation.
(Contributed by Jelle Zijlstra in [gh\-102500](https://github.com/python/cpython/issues/102500).)

### PEP 709: Comprehension inlining[¶](#pep-709-comprehension-inlining "Link to this heading")

Dictionary, list, and set comprehensions are now inlined, rather than creating a
new single\-use function object for each execution of the comprehension. This
speeds up execution of a comprehension by up to two times.
See [**PEP 709**](https://peps.python.org/pep-0709/) for further details.

Comprehension iteration variables remain isolated and don’t overwrite a
variable of the same name in the outer scope, nor are they visible after the
comprehension. Inlining does result in a few visible behavior changes:

* There is no longer a separate frame for the comprehension in tracebacks,
and tracing/profiling no longer shows the comprehension as a function call.
* The [`symtable`](../library/symtable.html#module-symtable "symtable: Interface to the compiler's internal symbol tables.") module will no longer produce child symbol tables for each
comprehension; instead, the comprehension’s locals will be included in the
parent function’s symbol table.
* Calling [`locals()`](../library/functions.html#locals "locals") inside a comprehension now includes variables
from outside the comprehension, and no longer includes the synthetic `.0`
variable for the comprehension “argument”.
* A comprehension iterating directly over `locals()` (e.g. `[k for k in
locals()]`) may see “RuntimeError: dictionary changed size during iteration”
when run under tracing (e.g. code coverage measurement). This is the same
behavior already seen in e.g. `for k in locals():`. To avoid the error, first
create a list of keys to iterate over: `keys = list(locals()); [k for k in
keys]`.

(Contributed by Carl Meyer and Vladimir Matveev in [**PEP 709**](https://peps.python.org/pep-0709/).)

### Improved Error Messages[¶](#improved-error-messages "Link to this heading")

* Modules from the standard library are now potentially suggested as part of
the error messages displayed by the interpreter when a [`NameError`](../library/exceptions.html#NameError "NameError") is
raised to the top level. (Contributed by Pablo Galindo in [gh\-98254](https://github.com/python/cpython/issues/98254).)

\`\`\`
\>\>\> sys.version\_info
Traceback (most recent call last):
 File "\", line 1, in \
NameError: name 'sys' is not defined. Did you forget to import 'sys'?

\`\`\`
* Improve the error suggestion for [`NameError`](../library/exceptions.html#NameError "NameError") exceptions for instances.
Now if a [`NameError`](../library/exceptions.html#NameError "NameError") is raised in a method and the instance has an
attribute that’s exactly equal to the name in the exception, the suggestion
will include `self.` instead of the closest match in the method
scope. (Contributed by Pablo Galindo in [gh\-99139](https://github.com/python/cpython/issues/99139).)

\`\`\`
\>\>\> class A:
... def \_\_init\_\_(self):
... self.blech = 1
...
... def foo(self):
... somethin = blech
...
\>\>\> A().foo()
Traceback (most recent call last):
 File "\", line 1
 somethin = blech
 ^^^^^
NameError: name 'blech' is not defined. Did you mean: 'self.blech'?

\`\`\`
* Improve the [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") error message when the user types `import x
from y` instead of `from y import x`. (Contributed by Pablo Galindo in [gh\-98931](https://github.com/python/cpython/issues/98931).)

\`\`\`
\>\>\> import a.y.z from b.y.z
Traceback (most recent call last):
 File "\", line 1
 import a.y.z from b.y.z
 ^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: Did you mean to use 'from ... import ...' instead?

\`\`\`
* [`ImportError`](../library/exceptions.html#ImportError "ImportError") exceptions raised from failed `from  import
` statements now include suggestions for the value of `` based on the
available names in ``. (Contributed by Pablo Galindo in [gh\-91058](https://github.com/python/cpython/issues/91058).)

\`\`\`
\>\>\> from collections import chainmap
Traceback (most recent call last):
 File "\", line 1, in \
ImportError: cannot import name 'chainmap' from 'collections'. Did you mean: 'ChainMap'?

\`\`\`

## New Features Related to Type Hints[¶](#new-features-related-to-type-hints "Link to this heading")

This section covers major changes affecting [**type hints**](https://peps.python.org/pep-0484/) and
the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module.

### PEP 692: Using `TypedDict` for more precise `**kwargs` typing[¶](#pep-692-using-typeddict-for-more-precise-kwargs-typing "Link to this heading")

Typing `**kwargs` in a function signature as introduced by [**PEP 484**](https://peps.python.org/pep-0484/) allowed
for valid annotations only in cases where all of the `**kwargs` were of the
same type.

[**PEP 692**](https://peps.python.org/pep-0692/) specifies a more precise way of typing `**kwargs` by relying on
typed dictionaries:

\`\`\`
from typing import TypedDict, Unpack

class Movie(TypedDict):
 name: str
 year: int

def foo(\*\*kwargs: Unpack\[Movie]): ...

\`\`\`

See [**PEP 692**](https://peps.python.org/pep-0692/) for more details.

(Contributed by Franek Magiera in [gh\-103629](https://github.com/python/cpython/issues/103629).)

### PEP 698: Override Decorator for Static Typing[¶](#pep-698-override-decorator-for-static-typing "Link to this heading")

A new decorator [`typing.override()`](../library/typing.html#typing.override "typing.override") has been added to the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).")
module. It indicates to type checkers that the method is intended to override
a method in a superclass. This allows type checkers to catch mistakes where
a method that is intended to override something in a base class
does not in fact do so.

Example:

\`\`\`
from typing import override

class Base:
 def get\_color(self) \-\> str:
 return "blue"

class GoodChild(Base):
 @override \# ok: overrides Base.get\_color
 def get\_color(self) \-\> str:
 return "yellow"

class BadChild(Base):
 @override \# type checker error: does not override Base.get\_color
 def get\_colour(self) \-\> str:
 return "red"

\`\`\`

See [**PEP 698**](https://peps.python.org/pep-0698/) for more details.

(Contributed by Steven Troxler in [gh\-101561](https://github.com/python/cpython/issues/101561).)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* The parser now raises [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") when parsing source code containing
null bytes. (Contributed by Pablo Galindo in [gh\-96670](https://github.com/python/cpython/issues/96670).)
* A backslash\-character pair that is not a valid escape sequence now generates
a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning"), instead of [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
For example, `re.compile("\d+\.\d+")` now emits a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning")
(`"\d"` is an invalid escape sequence, use raw strings for regular
expression: `re.compile(r"\d+\.\d+")`).
In a future Python version, [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") will eventually be raised,
instead of [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning").
(Contributed by Victor Stinner in [gh\-98401](https://github.com/python/cpython/issues/98401).)
* Octal escapes with value larger than `0o377` (ex: `"\477"`), deprecated
in Python 3\.11, now produce a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning"), instead of
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
In a future Python version they will be eventually a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError").
(Contributed by Victor Stinner in [gh\-98401](https://github.com/python/cpython/issues/98401).)
* Variables used in the target part of comprehensions that are not stored to
can now be used in assignment expressions (`:=`).
For example, in `[(b := 1) for a, b.prop in some_iter]`, the assignment to
`b` is now allowed. Note that assigning to variables stored to in the target
part of comprehensions (like `a`) is still disallowed, as per [**PEP 572**](https://peps.python.org/pep-0572/).
(Contributed by Nikita Sobolev in [gh\-100581](https://github.com/python/cpython/issues/100581).)
* Exceptions raised in a class or type’s `__set_name__` method are no longer
wrapped by a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError"). Context information is added to the
exception as a [**PEP 678**](https://peps.python.org/pep-0678/) note. (Contributed by Irit Katriel in [gh\-77757](https://github.com/python/cpython/issues/77757).)
* When a `try-except*` construct handles the entire [`ExceptionGroup`](../library/exceptions.html#ExceptionGroup "ExceptionGroup")
and raises one other exception, that exception is no longer wrapped in an
[`ExceptionGroup`](../library/exceptions.html#ExceptionGroup "ExceptionGroup"). Also changed in version 3\.11\.4\. (Contributed by Irit
Katriel in [gh\-103590](https://github.com/python/cpython/issues/103590).)
* The Garbage Collector now runs only on the eval breaker mechanism of the
Python bytecode evaluation loop instead of object allocations. The GC can
also run when [`PyErr_CheckSignals()`](../c-api/exceptions.html#c.PyErr_CheckSignals "PyErr_CheckSignals") is called so C extensions that
need to run for a long time without executing any Python code also have a
chance to execute the GC periodically. (Contributed by Pablo Galindo in
[gh\-97922](https://github.com/python/cpython/issues/97922).)
* All builtin and extension callables expecting boolean parameters now accept
arguments of any type instead of just [`bool`](../library/functions.html#bool "bool") and [`int`](../library/functions.html#int "int").
(Contributed by Serhiy Storchaka in [gh\-60203](https://github.com/python/cpython/issues/60203).)
* [`memoryview`](../library/stdtypes.html#memoryview "memoryview") now supports the half\-float type (the “e” format code).
(Contributed by Donghee Na and Antoine Pitrou in [gh\-90751](https://github.com/python/cpython/issues/90751).)
* [`slice`](../library/functions.html#slice "slice") objects are now hashable, allowing them to be used as dict keys and
set items. (Contributed by Will Bradshaw, Furkan Onder, and Raymond Hettinger in [gh\-101264](https://github.com/python/cpython/issues/101264).)
* [`sum()`](../library/functions.html#sum "sum") now uses Neumaier summation to improve accuracy and commutativity
when summing floats or mixed ints and floats.
(Contributed by Raymond Hettinger in [gh\-100425](https://github.com/python/cpython/issues/100425).)
* [`ast.parse()`](../library/ast.html#ast.parse "ast.parse") now raises [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") instead of [`ValueError`](../library/exceptions.html#ValueError "ValueError")
when parsing source code containing null bytes. (Contributed by Pablo Galindo
in [gh\-96670](https://github.com/python/cpython/issues/96670).)
* The extraction methods in [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), and [`shutil.unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"),
have a new a *filter* argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See [tarfile extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
In Python 3\.14, the default will switch to `'data'`.
(Contributed by Petr Viktorin in [**PEP 706**](https://peps.python.org/pep-0706/).)
* [`types.MappingProxyType`](../library/types.html#types.MappingProxyType "types.MappingProxyType") instances are now hashable if the underlying
mapping is hashable.
(Contributed by Serhiy Storchaka in [gh\-87995](https://github.com/python/cpython/issues/87995).)
* Add [support for the perf profiler](../howto/perf_profiling.html#perf-profiling) through the new
environment variable [`PYTHONPERFSUPPORT`](../using/cmdline.html#envvar-PYTHONPERFSUPPORT)
and command\-line option [`-X perf`](../using/cmdline.html#cmdoption-X),
as well as the new [`sys.activate_stack_trampoline()`](../library/sys.html#sys.activate_stack_trampoline "sys.activate_stack_trampoline"),
[`sys.deactivate_stack_trampoline()`](../library/sys.html#sys.deactivate_stack_trampoline "sys.deactivate_stack_trampoline"),
and [`sys.is_stack_trampoline_active()`](../library/sys.html#sys.is_stack_trampoline_active "sys.is_stack_trampoline_active") functions.
(Design by Pablo Galindo. Contributed by Pablo Galindo and Christian Heimes
with contributions from Gregory P. Smith \[Google] and Mark Shannon
in [gh\-96123](https://github.com/python/cpython/issues/96123).)

## New Modules[¶](#new-modules "Link to this heading")

* None.

## Improved Modules[¶](#improved-modules "Link to this heading")

### array[¶](#array "Link to this heading")

* The [`array.array`](../library/array.html#array.array "array.array") class now supports subscripting, making it a
[generic type](../glossary.html#term-generic-type). (Contributed by Jelle Zijlstra in [gh\-98658](https://github.com/python/cpython/issues/98658).)

### asyncio[¶](#asyncio "Link to this heading")

* The performance of writing to sockets in [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") has been
significantly improved. `asyncio` now avoids unnecessary copying when
writing to sockets and uses [`sendmsg()`](../library/socket.html#socket.socket.sendmsg "socket.socket.sendmsg") if the platform
supports it. (Contributed by Kumar Aditya in [gh\-91166](https://github.com/python/cpython/issues/91166).)
* Add [`asyncio.eager_task_factory()`](../library/asyncio-task.html#asyncio.eager_task_factory "asyncio.eager_task_factory") and [`asyncio.create_eager_task_factory()`](../library/asyncio-task.html#asyncio.create_eager_task_factory "asyncio.create_eager_task_factory")
functions to allow opting an event loop in to eager task execution,
making some use\-cases 2x to 5x faster.
(Contributed by Jacob Bower \& Itamar Oren in [gh\-102853](https://github.com/python/cpython/issues/102853), [gh\-104140](https://github.com/python/cpython/issues/104140), and [gh\-104138](https://github.com/python/cpython/issues/104138))
* On Linux, [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") uses [`asyncio.PidfdChildWatcher`](../library/asyncio-policy.html#asyncio.PidfdChildWatcher "asyncio.PidfdChildWatcher") by default
if [`os.pidfd_open()`](../library/os.html#os.pidfd_open "os.pidfd_open") is available and functional instead of
[`asyncio.ThreadedChildWatcher`](../library/asyncio-policy.html#asyncio.ThreadedChildWatcher "asyncio.ThreadedChildWatcher").
(Contributed by Kumar Aditya in [gh\-98024](https://github.com/python/cpython/issues/98024).)
* The event loop now uses the best available child watcher for each platform
([`asyncio.PidfdChildWatcher`](../library/asyncio-policy.html#asyncio.PidfdChildWatcher "asyncio.PidfdChildWatcher") if supported and
[`asyncio.ThreadedChildWatcher`](../library/asyncio-policy.html#asyncio.ThreadedChildWatcher "asyncio.ThreadedChildWatcher") otherwise), so manually
configuring a child watcher is not recommended.
(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
* Add *loop\_factory* parameter to [`asyncio.run()`](../library/asyncio-runner.html#asyncio.run "asyncio.run") to allow specifying
a custom event loop factory.
(Contributed by Kumar Aditya in [gh\-99388](https://github.com/python/cpython/issues/99388).)
* Add C implementation of [`asyncio.current_task()`](../library/asyncio-task.html#asyncio.current_task "asyncio.current_task") for 4x\-6x speedup.
(Contributed by Itamar Oren and Pranav Thulasiram Bhat in [gh\-100344](https://github.com/python/cpython/issues/100344).)
* [`asyncio.iscoroutine()`](../library/asyncio-task.html#asyncio.iscoroutine "asyncio.iscoroutine") now returns `False` for generators as
[`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") does not support legacy generator\-based coroutines.
(Contributed by Kumar Aditya in [gh\-102748](https://github.com/python/cpython/issues/102748).)
* [`asyncio.wait()`](../library/asyncio-task.html#asyncio.wait "asyncio.wait") and [`asyncio.as_completed()`](../library/asyncio-task.html#asyncio.as_completed "asyncio.as_completed") now accepts generators
yielding tasks.
(Contributed by Kumar Aditya in [gh\-78530](https://github.com/python/cpython/issues/78530).)

### calendar[¶](#calendar "Link to this heading")

* Add enums [`calendar.Month`](../library/calendar.html#calendar.Month "calendar.Month") and [`calendar.Day`](../library/calendar.html#calendar.Day "calendar.Day")
defining months of the year and days of the week.
(Contributed by Prince Roshan in [gh\-103636](https://github.com/python/cpython/issues/103636).)

### csv[¶](#csv "Link to this heading")

* Add [`csv.QUOTE_NOTNULL`](../library/csv.html#csv.QUOTE_NOTNULL "csv.QUOTE_NOTNULL") and [`csv.QUOTE_STRINGS`](../library/csv.html#csv.QUOTE_STRINGS "csv.QUOTE_STRINGS") flags to
provide finer grained control of `None` and empty strings by
[`reader`](../library/csv.html#csv.reader "csv.reader") and [`writer`](../library/csv.html#csv.writer "csv.writer") objects.

### dis[¶](#dis "Link to this heading")

* Pseudo instruction opcodes (which are used by the compiler but
do not appear in executable bytecode) are now exposed in the
[`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module.
[`HAVE_ARGUMENT`](../library/dis.html#opcode-HAVE_ARGUMENT) is still relevant to real opcodes,
but it is not useful for pseudo instructions. Use the new
[`dis.hasarg`](../library/dis.html#dis.hasarg "dis.hasarg") collection instead.
(Contributed by Irit Katriel in [gh\-94216](https://github.com/python/cpython/issues/94216).)
* Add the [`dis.hasexc`](../library/dis.html#dis.hasexc "dis.hasexc") collection to signify instructions that set
an exception handler. (Contributed by Irit Katriel in [gh\-94216](https://github.com/python/cpython/issues/94216).)

### fractions[¶](#fractions "Link to this heading")

* Objects of type [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") now support float\-style
formatting. (Contributed by Mark Dickinson in [gh\-100161](https://github.com/python/cpython/issues/100161).)

### importlib.resources[¶](#importlib-resources "Link to this heading")

* [`importlib.resources.as_file()`](../library/importlib.resources.html#importlib.resources.as_file "importlib.resources.as_file") now supports resource directories.
(Contributed by Jason R. Coombs in [gh\-97930](https://github.com/python/cpython/issues/97930).)
* Rename first parameter of [`importlib.resources.files()`](../library/importlib.resources.html#importlib.resources.files "importlib.resources.files") to *anchor*.
(Contributed by Jason R. Coombs in [gh\-100598](https://github.com/python/cpython/issues/100598).)

### inspect[¶](#inspect "Link to this heading")

* Add [`inspect.markcoroutinefunction()`](../library/inspect.html#inspect.markcoroutinefunction "inspect.markcoroutinefunction") to mark sync functions that return
a [coroutine](../glossary.html#term-coroutine) for use with [`inspect.iscoroutinefunction()`](../library/inspect.html#inspect.iscoroutinefunction "inspect.iscoroutinefunction").
(Contributed by Carlton Gibson in [gh\-99247](https://github.com/python/cpython/issues/99247).)
* Add [`inspect.getasyncgenstate()`](../library/inspect.html#inspect.getasyncgenstate "inspect.getasyncgenstate") and [`inspect.getasyncgenlocals()`](../library/inspect.html#inspect.getasyncgenlocals "inspect.getasyncgenlocals")
for determining the current state of asynchronous generators.
(Contributed by Thomas Krennwallner in [gh\-79940](https://github.com/python/cpython/issues/79940).)
* The performance of [`inspect.getattr_static()`](../library/inspect.html#inspect.getattr_static "inspect.getattr_static") has been considerably
improved. Most calls to the function should be at least 2x faster than they
were in Python 3\.11\. (Contributed by Alex Waygood in [gh\-103193](https://github.com/python/cpython/issues/103193).)

### itertools[¶](#itertools "Link to this heading")

* Add [`itertools.batched()`](../library/itertools.html#itertools.batched "itertools.batched") for collecting into even\-sized
tuples where the last batch may be shorter than the rest.
(Contributed by Raymond Hettinger in [gh\-98363](https://github.com/python/cpython/issues/98363).)

### math[¶](#math "Link to this heading")

* Add [`math.sumprod()`](../library/math.html#math.sumprod "math.sumprod") for computing a sum of products.
(Contributed by Raymond Hettinger in [gh\-100485](https://github.com/python/cpython/issues/100485).)
* Extend [`math.nextafter()`](../library/math.html#math.nextafter "math.nextafter") to include a *steps* argument
for moving up or down multiple steps at a time. (Contributed by
Matthias Goergens, Mark Dickinson, and Raymond Hettinger in [gh\-94906](https://github.com/python/cpython/issues/94906).)

### os[¶](#os "Link to this heading")

* Add [`os.PIDFD_NONBLOCK`](../library/os.html#os.PIDFD_NONBLOCK "os.PIDFD_NONBLOCK") to open a file descriptor
for a process with [`os.pidfd_open()`](../library/os.html#os.pidfd_open "os.pidfd_open") in non\-blocking mode.
(Contributed by Kumar Aditya in [gh\-93312](https://github.com/python/cpython/issues/93312).)
* [`os.DirEntry`](../library/os.html#os.DirEntry "os.DirEntry") now includes an [`os.DirEntry.is_junction()`](../library/os.html#os.DirEntry.is_junction "os.DirEntry.is_junction")
method to check if the entry is a junction.
(Contributed by Charles Machalow in [gh\-99547](https://github.com/python/cpython/issues/99547).)
* Add [`os.listdrives()`](../library/os.html#os.listdrives "os.listdrives"), [`os.listvolumes()`](../library/os.html#os.listvolumes "os.listvolumes") and [`os.listmounts()`](../library/os.html#os.listmounts "os.listmounts")
functions on Windows for enumerating drives, volumes and mount points.
(Contributed by Steve Dower in [gh\-102519](https://github.com/python/cpython/issues/102519).)
* [`os.stat()`](../library/os.html#os.stat "os.stat") and [`os.lstat()`](../library/os.html#os.lstat "os.lstat") are now more accurate on Windows.
The `st_birthtime` field will now be filled with the creation time
of the file, and `st_ctime` is deprecated but still contains the
creation time (but in the future will return the last metadata change,
for consistency with other platforms). `st_dev` may be up to 64 bits
and `st_ino` up to 128 bits depending on your file system, and
`st_rdev` is always set to zero rather than incorrect values.
Both functions may be significantly faster on newer releases of
Windows. (Contributed by Steve Dower in [gh\-99726](https://github.com/python/cpython/issues/99726).)

### os.path[¶](#os-path "Link to this heading")

* Add [`os.path.isjunction()`](../library/os.path.html#os.path.isjunction "os.path.isjunction") to check if a given path is a junction.
(Contributed by Charles Machalow in [gh\-99547](https://github.com/python/cpython/issues/99547).)
* Add [`os.path.splitroot()`](../library/os.path.html#os.path.splitroot "os.path.splitroot") to split a path into a triad
`(drive, root, tail)`. (Contributed by Barney Gale in [gh\-101000](https://github.com/python/cpython/issues/101000).)

### pathlib[¶](#pathlib "Link to this heading")

* Add support for subclassing [`pathlib.PurePath`](../library/pathlib.html#pathlib.PurePath "pathlib.PurePath") and
[`pathlib.Path`](../library/pathlib.html#pathlib.Path "pathlib.Path"), plus their Posix\- and Windows\-specific variants.
Subclasses may override the [`pathlib.PurePath.with_segments()`](../library/pathlib.html#pathlib.PurePath.with_segments "pathlib.PurePath.with_segments") method
to pass information between path instances.
* Add [`pathlib.Path.walk()`](../library/pathlib.html#pathlib.Path.walk "pathlib.Path.walk") for walking the directory trees and generating
all file or directory names within them, similar to [`os.walk()`](../library/os.html#os.walk "os.walk").
(Contributed by Stanislav Zmiev in [gh\-90385](https://github.com/python/cpython/issues/90385).)
* Add *walk\_up* optional parameter to [`pathlib.PurePath.relative_to()`](../library/pathlib.html#pathlib.PurePath.relative_to "pathlib.PurePath.relative_to")
to allow the insertion of `..` entries in the result; this behavior is
more consistent with [`os.path.relpath()`](../library/os.path.html#os.path.relpath "os.path.relpath").
(Contributed by Domenico Ragusa in [gh\-84538](https://github.com/python/cpython/issues/84538).)
* Add [`pathlib.Path.is_junction()`](../library/pathlib.html#pathlib.Path.is_junction "pathlib.Path.is_junction") as a proxy to [`os.path.isjunction()`](../library/os.path.html#os.path.isjunction "os.path.isjunction").
(Contributed by Charles Machalow in [gh\-99547](https://github.com/python/cpython/issues/99547).)
* Add *case\_sensitive* optional parameter to [`pathlib.Path.glob()`](../library/pathlib.html#pathlib.Path.glob "pathlib.Path.glob"),
[`pathlib.Path.rglob()`](../library/pathlib.html#pathlib.Path.rglob "pathlib.Path.rglob") and [`pathlib.PurePath.match()`](../library/pathlib.html#pathlib.PurePath.match "pathlib.PurePath.match") for matching
the path’s case sensitivity, allowing for more precise control over the matching process.

### pdb[¶](#pdb "Link to this heading")

* Add convenience variables to hold values temporarily for debug session
and provide quick access to values like the current frame or the return
value.
(Contributed by Tian Gao in [gh\-103693](https://github.com/python/cpython/issues/103693).)

### random[¶](#random "Link to this heading")

* Add [`random.binomialvariate()`](../library/random.html#random.binomialvariate "random.binomialvariate").
(Contributed by Raymond Hettinger in [gh\-81620](https://github.com/python/cpython/issues/81620).)
* Add a default of `lambd=1.0` to [`random.expovariate()`](../library/random.html#random.expovariate "random.expovariate").
(Contributed by Raymond Hettinger in [gh\-100234](https://github.com/python/cpython/issues/100234).)

### shutil[¶](#shutil "Link to this heading")

* [`shutil.make_archive()`](../library/shutil.html#shutil.make_archive "shutil.make_archive") now passes the *root\_dir* argument to custom
archivers which support it.
In this case it no longer temporarily changes the current working directory
of the process to *root\_dir* to perform archiving.
(Contributed by Serhiy Storchaka in [gh\-74696](https://github.com/python/cpython/issues/74696).)
* [`shutil.rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree") now accepts a new argument *onexc* which is an
error handler like *onerror* but which expects an exception instance
rather than a *(typ, val, tb)* triplet. *onerror* is deprecated.
(Contributed by Irit Katriel in [gh\-102828](https://github.com/python/cpython/issues/102828).)
* [`shutil.which()`](../library/shutil.html#shutil.which "shutil.which") now consults the *PATHEXT* environment variable to
find matches within *PATH* on Windows even when the given *cmd* includes
a directory component.
(Contributed by Charles Machalow in [gh\-103179](https://github.com/python/cpython/issues/103179).)

[`shutil.which()`](../library/shutil.html#shutil.which "shutil.which") will call `NeedCurrentDirectoryForExePathW` when
querying for executables on Windows to determine if the current working
directory should be prepended to the search path.
(Contributed by Charles Machalow in [gh\-103179](https://github.com/python/cpython/issues/103179).)

[`shutil.which()`](../library/shutil.html#shutil.which "shutil.which") will return a path matching the *cmd* with a component
from `PATHEXT` prior to a direct match elsewhere in the search path on
Windows.
(Contributed by Charles Machalow in [gh\-103179](https://github.com/python/cpython/issues/103179).)

### sqlite3[¶](#sqlite3 "Link to this heading")

* Add a [command\-line interface](../library/sqlite3.html#sqlite3-cli).
(Contributed by Erlend E. Aasland in [gh\-77617](https://github.com/python/cpython/issues/77617).)
* Add the [`sqlite3.Connection.autocommit`](../library/sqlite3.html#sqlite3.Connection.autocommit "sqlite3.Connection.autocommit") attribute
to [`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection")
and the *autocommit* parameter to [`sqlite3.connect()`](../library/sqlite3.html#sqlite3.connect "sqlite3.connect")
to control [**PEP 249**](https://peps.python.org/pep-0249/)\-compliant
[transaction handling](../library/sqlite3.html#sqlite3-transaction-control-autocommit).
(Contributed by Erlend E. Aasland in [gh\-83638](https://github.com/python/cpython/issues/83638).)
* Add *entrypoint* keyword\-only parameter to
[`sqlite3.Connection.load_extension()`](../library/sqlite3.html#sqlite3.Connection.load_extension "sqlite3.Connection.load_extension"),
for overriding the SQLite extension entry point.
(Contributed by Erlend E. Aasland in [gh\-103015](https://github.com/python/cpython/issues/103015).)
* Add [`sqlite3.Connection.getconfig()`](../library/sqlite3.html#sqlite3.Connection.getconfig "sqlite3.Connection.getconfig") and
[`sqlite3.Connection.setconfig()`](../library/sqlite3.html#sqlite3.Connection.setconfig "sqlite3.Connection.setconfig") to [`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection")
to make configuration changes to a database connection.
(Contributed by Erlend E. Aasland in [gh\-103489](https://github.com/python/cpython/issues/103489).)

### statistics[¶](#statistics "Link to this heading")

* Extend [`statistics.correlation()`](../library/statistics.html#statistics.correlation "statistics.correlation") to include as a `ranked` method
for computing the Spearman correlation of ranked data.
(Contributed by Raymond Hettinger in [gh\-95861](https://github.com/python/cpython/issues/95861).)

### sys[¶](#sys "Link to this heading")

* Add the [`sys.monitoring`](../library/sys.monitoring.html#module-sys.monitoring "sys.monitoring: Access and control event monitoring") namespace to expose the new [PEP 669](#whatsnew312-pep669) monitoring API.
(Contributed by Mark Shannon in [gh\-103082](https://github.com/python/cpython/issues/103082).)
* Add [`sys.activate_stack_trampoline()`](../library/sys.html#sys.activate_stack_trampoline "sys.activate_stack_trampoline") and
[`sys.deactivate_stack_trampoline()`](../library/sys.html#sys.deactivate_stack_trampoline "sys.deactivate_stack_trampoline") for activating and deactivating
stack profiler trampolines,
and [`sys.is_stack_trampoline_active()`](../library/sys.html#sys.is_stack_trampoline_active "sys.is_stack_trampoline_active") for querying if stack profiler
trampolines are active.
(Contributed by Pablo Galindo and Christian Heimes
with contributions from Gregory P. Smith \[Google] and Mark Shannon
in [gh\-96123](https://github.com/python/cpython/issues/96123).)
* Add [`sys.last_exc`](../library/sys.html#sys.last_exc "sys.last_exc") which holds the last unhandled exception that
was raised (for post\-mortem debugging use cases). Deprecate the
three fields that have the same information in its legacy form:
[`sys.last_type`](../library/sys.html#sys.last_type "sys.last_type"), [`sys.last_value`](../library/sys.html#sys.last_value "sys.last_value") and [`sys.last_traceback`](../library/sys.html#sys.last_traceback "sys.last_traceback").
(Contributed by Irit Katriel in [gh\-102778](https://github.com/python/cpython/issues/102778).)
* [`sys._current_exceptions()`](../library/sys.html#sys._current_exceptions "sys._current_exceptions") now returns a mapping from thread\-id to an
exception instance, rather than to a `(typ, exc, tb)` tuple.
(Contributed by Irit Katriel in [gh\-103176](https://github.com/python/cpython/issues/103176).)
* [`sys.setrecursionlimit()`](../library/sys.html#sys.setrecursionlimit "sys.setrecursionlimit") and [`sys.getrecursionlimit()`](../library/sys.html#sys.getrecursionlimit "sys.getrecursionlimit").
The recursion limit now applies only to Python code. Builtin functions do
not use the recursion limit, but are protected by a different mechanism
that prevents recursion from causing a virtual machine crash.

### tempfile[¶](#tempfile "Link to this heading")

* The [`tempfile.NamedTemporaryFile`](../library/tempfile.html#tempfile.NamedTemporaryFile "tempfile.NamedTemporaryFile") function has a new optional parameter
*delete\_on\_close* (Contributed by Evgeny Zorin in [gh\-58451](https://github.com/python/cpython/issues/58451).)
* [`tempfile.mkdtemp()`](../library/tempfile.html#tempfile.mkdtemp "tempfile.mkdtemp") now always returns an absolute path, even if the
argument provided to the *dir* parameter is a relative path.

### threading[¶](#threading "Link to this heading")

* Add [`threading.settrace_all_threads()`](../library/threading.html#threading.settrace_all_threads "threading.settrace_all_threads") and
[`threading.setprofile_all_threads()`](../library/threading.html#threading.setprofile_all_threads "threading.setprofile_all_threads") that allow to set tracing and
profiling functions in all running threads in addition to the calling one.
(Contributed by Pablo Galindo in [gh\-93503](https://github.com/python/cpython/issues/93503).)

### tkinter[¶](#tkinter "Link to this heading")

* `tkinter.Canvas.coords()` now flattens its arguments.
It now accepts not only coordinates as separate arguments
(`x1, y1, x2, y2, ...`) and a sequence of coordinates
(`[x1, y1, x2, y2, ...]`), but also coordinates grouped in pairs
(`(x1, y1), (x2, y2), ...` and `[(x1, y1), (x2, y2), ...]`),
like `create_*()` methods.
(Contributed by Serhiy Storchaka in [gh\-94473](https://github.com/python/cpython/issues/94473).)

### tokenize[¶](#tokenize "Link to this heading")

* The [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module includes the changes introduced in [**PEP 701**](https://peps.python.org/pep-0701/).
(Contributed by Marta Gómez Macías and Pablo Galindo in [gh\-102856](https://github.com/python/cpython/issues/102856).)
See [Porting to Python 3\.12](#whatsnew312-porting-to-python312) for more information on the
changes to the [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module.

### types[¶](#types "Link to this heading")

* Add [`types.get_original_bases()`](../library/types.html#types.get_original_bases "types.get_original_bases") to allow for further introspection of
[User\-defined generic types](../library/typing.html#user-defined-generics) when subclassed. (Contributed by
James Hilton\-Balfe and Alex Waygood in [gh\-101827](https://github.com/python/cpython/issues/101827).)

### typing[¶](#typing "Link to this heading")

* [`isinstance()`](../library/functions.html#isinstance "isinstance") checks against
[`runtime-checkable protocols`](../library/typing.html#typing.runtime_checkable "typing.runtime_checkable") now use
[`inspect.getattr_static()`](../library/inspect.html#inspect.getattr_static "inspect.getattr_static") rather than [`hasattr()`](../library/functions.html#hasattr "hasattr") to lookup whether
attributes exist. This means that descriptors and [`__getattr__()`](../reference/datamodel.html#object.__getattr__ "object.__getattr__")
methods are no longer unexpectedly evaluated during `isinstance()` checks
against runtime\-checkable protocols. However, it may also mean that some
objects which used to be considered instances of a runtime\-checkable protocol
may no longer be considered instances of that protocol on Python 3\.12\+, and
vice versa. Most users are unlikely to be affected by this change.
(Contributed by Alex Waygood in [gh\-102433](https://github.com/python/cpython/issues/102433).)
* The members of a runtime\-checkable protocol are now considered “frozen” at
runtime as soon as the class has been created. Monkey\-patching attributes
onto a runtime\-checkable protocol will still work, but will have no impact on
[`isinstance()`](../library/functions.html#isinstance "isinstance") checks comparing objects to the protocol. For example:

\`\`\`
\>\>\> from typing import Protocol, runtime\_checkable
\>\>\> @runtime\_checkable
... class HasX(Protocol):
... x = 1
...
\>\>\> class Foo: ...
...
\>\>\> f = Foo()
\>\>\> isinstance(f, HasX)
False
\>\>\> f.x = 1
\>\>\> isinstance(f, HasX)
True
\>\>\> HasX.y = 2
\>\>\> isinstance(f, HasX) \# unchanged, even though HasX now also has a "y" attribute
True

\`\`\`

This change was made in order to speed up `isinstance()` checks against
runtime\-checkable protocols.
* The performance profile of [`isinstance()`](../library/functions.html#isinstance "isinstance") checks against
[`runtime-checkable protocols`](../library/typing.html#typing.runtime_checkable "typing.runtime_checkable") has changed
significantly. Most `isinstance()` checks against protocols with only a few
members should be at least 2x faster than in 3\.11, and some may be 20x
faster or more. However, `isinstance()` checks against protocols with many
members may be slower than in Python 3\.11\. (Contributed by Alex
Waygood in [gh\-74690](https://github.com/python/cpython/issues/74690) and [gh\-103193](https://github.com/python/cpython/issues/103193).)
* All [`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") and [`typing.NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") classes now have the
`__orig_bases__` attribute. (Contributed by Adrian Garcia Badaracco in
[gh\-103699](https://github.com/python/cpython/issues/103699).)
* Add `frozen_default` parameter to [`typing.dataclass_transform()`](../library/typing.html#typing.dataclass_transform "typing.dataclass_transform").
(Contributed by Erik De Bonte in [gh\-99957](https://github.com/python/cpython/issues/99957).)

### unicodedata[¶](#unicodedata "Link to this heading")

* The Unicode database has been updated to version 15\.0\.0\. (Contributed by
Benjamin Peterson in [gh\-96734](https://github.com/python/cpython/issues/96734)).

### unittest[¶](#unittest "Link to this heading")

Add a `--durations` command line option, showing the N slowest test cases:

\`\`\`
python3 \-m unittest \-\-durations=3 lib.tests.test\_threading
.....
Slowest test durations
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
1\.210s test\_timeout (Lib.test.test\_threading.BarrierTests)
1\.003s test\_default\_timeout (Lib.test.test\_threading.BarrierTests)
0\.518s test\_timeout (Lib.test.test\_threading.EventTests)

(0\.000 durations hidden. Use \-v to show these durations.)
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
Ran 158 tests in 9\.869s

OK (skipped=3\)

\`\`\`

(Contributed by Giampaolo Rodola in [gh\-48330](https://github.com/python/cpython/issues/48330))

### uuid[¶](#uuid "Link to this heading")

* Add a [command\-line interface](../library/uuid.html#uuid-cli).
(Contributed by Adam Chhina in [gh\-88597](https://github.com/python/cpython/issues/88597).)

## Optimizations[¶](#optimizations "Link to this heading")

* Remove `wstr` and `wstr_length` members from Unicode objects.
It reduces object size by 8 or 16 bytes on 64bit platform. ([**PEP 623**](https://peps.python.org/pep-0623/))
(Contributed by Inada Naoki in [gh\-92536](https://github.com/python/cpython/issues/92536).)
* Add experimental support for using the BOLT binary optimizer in the build
process, which improves performance by 1\-5%.
(Contributed by Kevin Modzelewski in [gh\-90536](https://github.com/python/cpython/issues/90536) and tuned by Donghee Na in [gh\-101525](https://github.com/python/cpython/issues/101525))
* Speed up the regular expression substitution (functions [`re.sub()`](../library/re.html#re.sub "re.sub") and
[`re.subn()`](../library/re.html#re.subn "re.subn") and corresponding `re.Pattern` methods) for
replacement strings containing group references by 2–3 times.
(Contributed by Serhiy Storchaka in [gh\-91524](https://github.com/python/cpython/issues/91524).)
* Speed up [`asyncio.Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task") creation by deferring expensive string formatting.
(Contributed by Itamar Oren in [gh\-103793](https://github.com/python/cpython/issues/103793).)
* The [`tokenize.tokenize()`](../library/tokenize.html#tokenize.tokenize "tokenize.tokenize") and [`tokenize.generate_tokens()`](../library/tokenize.html#tokenize.generate_tokens "tokenize.generate_tokens") functions are
up to 64% faster as a side effect of the changes required to cover [**PEP 701**](https://peps.python.org/pep-0701/) in
the [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module. (Contributed by Marta Gómez Macías and Pablo Galindo
in [gh\-102856](https://github.com/python/cpython/issues/102856).)
* Speed up [`super()`](../library/functions.html#super "super") method calls and attribute loads via the
new [`LOAD_SUPER_ATTR`](../library/dis.html#opcode-LOAD_SUPER_ATTR) instruction. (Contributed by Carl Meyer and
Vladimir Matveev in [gh\-103497](https://github.com/python/cpython/issues/103497).)

## CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

* Remove the `LOAD_METHOD` instruction. It has been merged into
[`LOAD_ATTR`](../library/dis.html#opcode-LOAD_ATTR). [`LOAD_ATTR`](../library/dis.html#opcode-LOAD_ATTR) will now behave like the old
`LOAD_METHOD` instruction if the low bit of its oparg is set.
(Contributed by Ken Jin in [gh\-93429](https://github.com/python/cpython/issues/93429).)
* Remove the `JUMP_IF_FALSE_OR_POP` and `JUMP_IF_TRUE_OR_POP`
instructions. (Contributed by Irit Katriel in [gh\-102859](https://github.com/python/cpython/issues/102859).)
* Remove the `PRECALL` instruction. (Contributed by Mark Shannon in
[gh\-92925](https://github.com/python/cpython/issues/92925).)
* Add the [`BINARY_SLICE`](../library/dis.html#opcode-BINARY_SLICE) and [`STORE_SLICE`](../library/dis.html#opcode-STORE_SLICE) instructions.
(Contributed by Mark Shannon in [gh\-94163](https://github.com/python/cpython/issues/94163).)
* Add the [`CALL_INTRINSIC_1`](../library/dis.html#opcode-CALL_INTRINSIC_1) instructions.
(Contributed by Mark Shannon in [gh\-99005](https://github.com/python/cpython/issues/99005).)
* Add the [`CALL_INTRINSIC_2`](../library/dis.html#opcode-CALL_INTRINSIC_2) instruction.
(Contributed by Irit Katriel in [gh\-101799](https://github.com/python/cpython/issues/101799).)
* Add the [`CLEANUP_THROW`](../library/dis.html#opcode-CLEANUP_THROW) instruction.
(Contributed by Brandt Bucher in [gh\-90997](https://github.com/python/cpython/issues/90997).)
* Add the `END_SEND` instruction.
(Contributed by Mark Shannon in [gh\-103082](https://github.com/python/cpython/issues/103082).)
* Add the [`LOAD_FAST_AND_CLEAR`](../library/dis.html#opcode-LOAD_FAST_AND_CLEAR) instruction as part of the
implementation of [**PEP 709**](https://peps.python.org/pep-0709/). (Contributed by Carl Meyer in [gh\-101441](https://github.com/python/cpython/issues/101441).)
* Add the [`LOAD_FAST_CHECK`](../library/dis.html#opcode-LOAD_FAST_CHECK) instruction.
(Contributed by Dennis Sweeney in [gh\-93143](https://github.com/python/cpython/issues/93143).)
* Add the [`LOAD_FROM_DICT_OR_DEREF`](../library/dis.html#opcode-LOAD_FROM_DICT_OR_DEREF), [`LOAD_FROM_DICT_OR_GLOBALS`](../library/dis.html#opcode-LOAD_FROM_DICT_OR_GLOBALS),
and [`LOAD_LOCALS`](../library/dis.html#opcode-LOAD_LOCALS) opcodes as part of the implementation of [**PEP 695**](https://peps.python.org/pep-0695/).
Remove the `LOAD_CLASSDEREF` opcode, which can be replaced with
[`LOAD_LOCALS`](../library/dis.html#opcode-LOAD_LOCALS) plus [`LOAD_FROM_DICT_OR_DEREF`](../library/dis.html#opcode-LOAD_FROM_DICT_OR_DEREF). (Contributed
by Jelle Zijlstra in [gh\-103764](https://github.com/python/cpython/issues/103764).)
* Add the [`LOAD_SUPER_ATTR`](../library/dis.html#opcode-LOAD_SUPER_ATTR) instruction. (Contributed by Carl Meyer and
Vladimir Matveev in [gh\-103497](https://github.com/python/cpython/issues/103497).)
* Add the [`RETURN_CONST`](../library/dis.html#opcode-RETURN_CONST) instruction. (Contributed by Wenyang Wang in [gh\-101632](https://github.com/python/cpython/issues/101632).)

## Demos and Tools[¶](#demos-and-tools "Link to this heading")

* Remove the `Tools/demo/` directory which contained old demo scripts. A copy
can be found in the [old\-demos project](https://github.com/gvanrossum/old-demos).
(Contributed by Victor Stinner in [gh\-97681](https://github.com/python/cpython/issues/97681).)
* Remove outdated example scripts of the `Tools/scripts/` directory.
A copy can be found in the [old\-demos project](https://github.com/gvanrossum/old-demos).
(Contributed by Victor Stinner in [gh\-97669](https://github.com/python/cpython/issues/97669).)

## Deprecated[¶](#deprecated "Link to this heading")

* [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."): The *type*, *choices*, and *metavar* parameters
of `argparse.BooleanOptionalAction` are deprecated
and will be removed in 3\.14\.
(Contributed by Nikita Sobolev in [gh\-92248](https://github.com/python/cpython/issues/92248).)
* [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation."): The following [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") features have been deprecated in documentation since
Python 3\.8, now cause a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") to be emitted at runtime
when they are accessed or used, and will be removed in Python 3\.14:

	+ `ast.Num`
	+ `ast.Str`
	+ `ast.Bytes`
	+ `ast.NameConstant`
	+ `ast.Ellipsis`Use [`ast.Constant`](../library/ast.html#ast.Constant "ast.Constant") instead.
(Contributed by Serhiy Storchaka in [gh\-90953](https://github.com/python/cpython/issues/90953).)
* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."):

	+ The child watcher classes [`asyncio.MultiLoopChildWatcher`](../library/asyncio-policy.html#asyncio.MultiLoopChildWatcher "asyncio.MultiLoopChildWatcher"),
	[`asyncio.FastChildWatcher`](../library/asyncio-policy.html#asyncio.FastChildWatcher "asyncio.FastChildWatcher"), [`asyncio.AbstractChildWatcher`](../library/asyncio-policy.html#asyncio.AbstractChildWatcher "asyncio.AbstractChildWatcher")
	and [`asyncio.SafeChildWatcher`](../library/asyncio-policy.html#asyncio.SafeChildWatcher "asyncio.SafeChildWatcher") are deprecated and
	will be removed in Python 3\.14\.
	(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
	+ [`asyncio.set_child_watcher()`](../library/asyncio-policy.html#asyncio.set_child_watcher "asyncio.set_child_watcher"), [`asyncio.get_child_watcher()`](../library/asyncio-policy.html#asyncio.get_child_watcher "asyncio.get_child_watcher"),
	[`asyncio.AbstractEventLoopPolicy.set_child_watcher()`](../library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.set_child_watcher "asyncio.AbstractEventLoopPolicy.set_child_watcher") and
	[`asyncio.AbstractEventLoopPolicy.get_child_watcher()`](../library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.get_child_watcher "asyncio.AbstractEventLoopPolicy.get_child_watcher") are deprecated
	and will be removed in Python 3\.14\.
	(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
	+ The [`get_event_loop()`](../library/asyncio-eventloop.html#asyncio.get_event_loop "asyncio.get_event_loop") method of the
	default event loop policy now emits a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") if there
	is no current event loop set and it decides to create one.
	(Contributed by Serhiy Storchaka and Guido van Rossum in [gh\-100160](https://github.com/python/cpython/issues/100160).)
* [`calendar`](../library/calendar.html#module-calendar "calendar: Functions for working with calendars, including some emulation of the Unix cal program."): `calendar.January` and `calendar.February` constants are deprecated and
replaced by [`calendar.JANUARY`](../library/calendar.html#calendar.JANUARY "calendar.JANUARY") and [`calendar.FEBRUARY`](../library/calendar.html#calendar.FEBRUARY "calendar.FEBRUARY").
(Contributed by Prince Roshan in [gh\-103636](https://github.com/python/cpython/issues/103636).)
* [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers"): Deprecated [`collections.abc.ByteString`](../library/collections.abc.html#collections.abc.ByteString "collections.abc.ByteString").
Prefer `Sequence` or [`collections.abc.Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer").
For use in typing, prefer a union, like `bytes | bytearray`, or [`collections.abc.Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer").
(Contributed by Shantanu Jain in [gh\-91896](https://github.com/python/cpython/issues/91896).)
* [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types."): [`datetime.datetime`](../library/datetime.html#datetime.datetime "datetime.datetime")’s [`utcnow()`](../library/datetime.html#datetime.datetime.utcnow "datetime.datetime.utcnow") and
[`utcfromtimestamp()`](../library/datetime.html#datetime.datetime.utcfromtimestamp "datetime.datetime.utcfromtimestamp") are deprecated and will be
removed in a future version. Instead, use timezone\-aware objects to represent
datetimes in UTC: respectively, call [`now()`](../library/datetime.html#datetime.datetime.now "datetime.datetime.now") and
[`fromtimestamp()`](../library/datetime.html#datetime.datetime.fromtimestamp "datetime.datetime.fromtimestamp") with the *tz* parameter set to
[`datetime.UTC`](../library/datetime.html#datetime.UTC "datetime.UTC").
(Contributed by Paul Ganssle in [gh\-103857](https://github.com/python/cpython/issues/103857).)
* [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages."): Deprecate the *isdst* parameter in [`email.utils.localtime()`](../library/email.utils.html#email.utils.localtime "email.utils.localtime").
(Contributed by Alan Williams in [gh\-72346](https://github.com/python/cpython/issues/72346).)
* [`importlib.abc`](../library/importlib.html#module-importlib.abc "importlib.abc: Abstract base classes related to import"): Deprecated the following classes, scheduled for removal in
Python 3\.14:

	+ `importlib.abc.ResourceReader`
	+ `importlib.abc.Traversable`
	+ `importlib.abc.TraversableResources`Use [`importlib.resources.abc`](../library/importlib.resources.abc.html#module-importlib.resources.abc "importlib.resources.abc: Abstract base classes for resources") classes instead:

	+ [`importlib.resources.abc.Traversable`](../library/importlib.resources.abc.html#importlib.resources.abc.Traversable "importlib.resources.abc.Traversable")
	+ [`importlib.resources.abc.TraversableResources`](../library/importlib.resources.abc.html#importlib.resources.abc.TraversableResources "importlib.resources.abc.TraversableResources")(Contributed by Jason R. Coombs and Hugo van Kemenade in [gh\-93963](https://github.com/python/cpython/issues/93963).)
* [`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping."): Deprecate the support for copy, deepcopy, and pickle operations,
which is undocumented, inefficient, historically buggy, and inconsistent.
This will be removed in 3\.14 for a significant reduction in code
volume and maintenance burden.
(Contributed by Raymond Hettinger in [gh\-101588](https://github.com/python/cpython/issues/101588).)
* [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism."): In Python 3\.14, the default [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.")
start method will change to a safer one on Linux, BSDs,
and other non\-macOS POSIX platforms where `'fork'` is currently
the default ([gh\-84559](https://github.com/python/cpython/issues/84559)). Adding a runtime warning about this was deemed too
disruptive as the majority of code is not expected to care. Use the
[`get_context()`](../library/multiprocessing.html#multiprocessing.get_context "multiprocessing.get_context") or
[`set_start_method()`](../library/multiprocessing.html#multiprocessing.set_start_method "multiprocessing.set_start_method") APIs to explicitly specify when
your code *requires* `'fork'`. See [contexts and start methods](../library/multiprocessing.html#multiprocessing-start-methods).
* [`pkgutil`](../library/pkgutil.html#module-pkgutil "pkgutil: Utilities for the import system."): [`pkgutil.find_loader()`](../library/pkgutil.html#pkgutil.find_loader "pkgutil.find_loader") and [`pkgutil.get_loader()`](../library/pkgutil.html#pkgutil.get_loader "pkgutil.get_loader")
are deprecated and will be removed in Python 3\.14;
use [`importlib.util.find_spec()`](../library/importlib.html#importlib.util.find_spec "importlib.util.find_spec") instead.
(Contributed by Nikita Sobolev in [gh\-97850](https://github.com/python/cpython/issues/97850).)
* [`pty`](../library/pty.html#module-pty "pty: Pseudo-Terminal Handling for Unix. (Unix)"): The module has two undocumented `master_open()` and `slave_open()`
functions that have been deprecated since Python 2 but only gained a
proper [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") in 3\.12\. Remove them in 3\.14\.
(Contributed by Soumendra Ganguly and Gregory P. Smith in [gh\-85984](https://github.com/python/cpython/issues/85984).)
* [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces."):

	+ The `st_ctime` fields return by [`os.stat()`](../library/os.html#os.stat "os.stat") and [`os.lstat()`](../library/os.html#os.lstat "os.lstat") on
	Windows are deprecated. In a future release, they will contain the last
	metadata change time, consistent with other platforms. For now, they still
	contain the creation time, which is also available in the new `st_birthtime`
	field. (Contributed by Steve Dower in [gh\-99726](https://github.com/python/cpython/issues/99726).)
	+ On POSIX platforms, [`os.fork()`](../library/os.html#os.fork "os.fork") can now raise a
	[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") when it can detect being called from a
	multithreaded process. There has always been a fundamental incompatibility
	with the POSIX platform when doing so. Even if such code *appeared* to work.
	We added the warning to raise awareness as issues encountered by code doing
	this are becoming more frequent. See the [`os.fork()`](../library/os.html#os.fork "os.fork") documentation for
	more details along with [this discussion on fork being incompatible with threads](https://discuss.python.org/t/concerns-regarding-deprecation-of-fork-with-alive-threads/33555) for *why* we’re now surfacing this
	longstanding platform compatibility problem to developers.When this warning appears due to usage of [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") or
[`concurrent.futures`](../library/concurrent.futures.html#module-concurrent.futures "concurrent.futures: Execute computations concurrently using threads or processes.") the fix is to use a different
[`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") start method such as `"spawn"` or `"forkserver"`.
* [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying."): The *onerror* argument of [`shutil.rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree") is deprecated;
use *onexc* instead. (Contributed by Irit Katriel in [gh\-102828](https://github.com/python/cpython/issues/102828).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x."):

	+ [default adapters and converters](../library/sqlite3.html#sqlite3-default-converters) are now deprecated.
	Instead, use the [Adapter and converter recipes](../library/sqlite3.html#sqlite3-adapter-converter-recipes)
	and tailor them to your needs.
	(Contributed by Erlend E. Aasland in [gh\-90016](https://github.com/python/cpython/issues/90016).)
	+ In [`execute()`](../library/sqlite3.html#sqlite3.Cursor.execute "sqlite3.Cursor.execute"), [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") is now emitted
	when [named placeholders](../library/sqlite3.html#sqlite3-placeholders) are used together with
	parameters supplied as a [sequence](../glossary.html#term-sequence) instead of as a [`dict`](../library/stdtypes.html#dict "dict").
	Starting from Python 3\.14, using named placeholders with parameters supplied
	as a sequence will raise a [`ProgrammingError`](../library/sqlite3.html#sqlite3.ProgrammingError "sqlite3.ProgrammingError").
	(Contributed by Erlend E. Aasland in [gh\-101698](https://github.com/python/cpython/issues/101698).)
* [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions."): The [`sys.last_type`](../library/sys.html#sys.last_type "sys.last_type"), [`sys.last_value`](../library/sys.html#sys.last_value "sys.last_value") and [`sys.last_traceback`](../library/sys.html#sys.last_traceback "sys.last_traceback")
fields are deprecated. Use [`sys.last_exc`](../library/sys.html#sys.last_exc "sys.last_exc") instead.
(Contributed by Irit Katriel in [gh\-102778](https://github.com/python/cpython/issues/102778).)
* [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."): Extracting tar archives without specifying *filter* is deprecated until
Python 3\.14, when `'data'` filter will become the default.
See [Extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."):

	+ [`typing.Hashable`](../library/typing.html#typing.Hashable "typing.Hashable") and [`typing.Sized`](../library/typing.html#typing.Sized "typing.Sized"), aliases for
	[`collections.abc.Hashable`](../library/collections.abc.html#collections.abc.Hashable "collections.abc.Hashable") and [`collections.abc.Sized`](../library/collections.abc.html#collections.abc.Sized "collections.abc.Sized") respectively, are
	deprecated. ([gh\-94309](https://github.com/python/cpython/issues/94309).)
	+ [`typing.ByteString`](../library/typing.html#typing.ByteString "typing.ByteString"), deprecated since Python 3\.9, now causes a
	[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") to be emitted when it is used.
	(Contributed by Alex Waygood in [gh\-91896](https://github.com/python/cpython/issues/91896).)
* [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API."): The module now emits [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning")
when testing the truth value of an [`xml.etree.ElementTree.Element`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element "xml.etree.ElementTree.Element").
Before, the Python implementation emitted [`FutureWarning`](../library/exceptions.html#FutureWarning "FutureWarning"), and the C
implementation emitted nothing.
(Contributed by Jacob Walls in [gh\-83122](https://github.com/python/cpython/issues/83122).)
* The 3\-arg signatures (type, value, traceback) of [`coroutine throw()`](../reference/datamodel.html#coroutine.throw "coroutine.throw"), [`generator throw()`](../reference/expressions.html#generator.throw "generator.throw") and
[`async generator throw()`](../reference/expressions.html#agen.athrow "agen.athrow") are deprecated and
may be removed in a future version of Python. Use the single\-arg versions
of these functions instead. (Contributed by Ofey Chan in [gh\-89874](https://github.com/python/cpython/issues/89874).)
* [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") is now raised when [`__package__`](../reference/datamodel.html#module.__package__ "module.__package__") on a
module differs from
[`__spec__.parent`](../library/importlib.html#importlib.machinery.ModuleSpec.parent "importlib.machinery.ModuleSpec.parent") (previously
it was [`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning")).
(Contributed by Brett Cannon in [gh\-65961](https://github.com/python/cpython/issues/65961).)
* Setting [`__package__`](../reference/datamodel.html#module.__package__ "module.__package__") or [`__cached__`](../reference/datamodel.html#module.__cached__ "module.__cached__") on a
module is deprecated, and will cease to be set or taken into consideration by
the import system in Python 3\.14\. (Contributed by Brett Cannon in [gh\-65961](https://github.com/python/cpython/issues/65961).)
* The bitwise inversion operator (`~`) on bool is deprecated. It will throw an
error in Python 3\.16\. Use `not` for logical negation of bools instead.
In the rare case that you really need the bitwise inversion of the underlying
`int`, convert to int explicitly: `~int(x)`. (Contributed by Tim Hoffmann
in [gh\-103487](https://github.com/python/cpython/issues/103487).)
* Accessing [`co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab") on code objects was deprecated in
Python 3\.10 via [**PEP 626**](https://peps.python.org/pep-0626/),
but it only got a proper [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") in 3\.12\.
May be removed in 3\.15\.
(Contributed by Nikita Sobolev in [gh\-101866](https://github.com/python/cpython/issues/101866).)

### Pending Removal in Python 3\.13[¶](#pending-removal-in-python-3-13 "Link to this heading")

Modules (see [**PEP 594**](https://peps.python.org/pep-0594/)):

* `aifc`
* `audioop`
* `cgi`
* `cgitb`
* `chunk`
* `crypt`
* `imghdr`
* `mailcap`
* `msilib`
* `nis`
* `nntplib`
* `ossaudiodev`
* `pipes`
* `sndhdr`
* `spwd`
* `sunau`
* `telnetlib`
* `uu`
* `xdrlib`

Other modules:

* `lib2to3`, and the **2to3** program ([gh\-84540](https://github.com/python/cpython/issues/84540))

APIs:

* `configparser.LegacyInterpolation` ([gh\-90765](https://github.com/python/cpython/issues/90765))
* `locale.resetlocale()` ([gh\-90817](https://github.com/python/cpython/issues/90817))
* `turtle.RawTurtle.settiltangle()` ([gh\-50096](https://github.com/python/cpython/issues/50096))
* `unittest.findTestCases()` ([gh\-50096](https://github.com/python/cpython/issues/50096))
* `unittest.getTestCaseNames()` ([gh\-50096](https://github.com/python/cpython/issues/50096))
* `unittest.makeSuite()` ([gh\-50096](https://github.com/python/cpython/issues/50096))
* `unittest.TestProgram.usageExit()` ([gh\-67048](https://github.com/python/cpython/issues/67048))
* `webbrowser.MacOSX` ([gh\-86421](https://github.com/python/cpython/issues/86421))
* [`classmethod`](../library/functions.html#classmethod "classmethod") descriptor chaining ([gh\-89519](https://github.com/python/cpython/issues/89519))
* [`importlib.resources`](../library/importlib.resources.html#module-importlib.resources "importlib.resources: Package resource reading, opening, and access") deprecated methods:

	+ `contents()`
	+ `is_resource()`
	+ `open_binary()`
	+ `open_text()`
	+ `path()`
	+ `read_binary()`
	+ `read_text()`Use [`importlib.resources.files()`](../library/importlib.resources.html#importlib.resources.files "importlib.resources.files") instead. Refer to [importlib\-resources: Migrating from Legacy](https://importlib-resources.readthedocs.io/en/latest/using.html#migrating-from-legacy) ([gh\-106531](https://github.com/python/cpython/issues/106531))

### Pending Removal in Python 3\.14[¶](#pending-removal-in-python-3-14 "Link to this heading")

* [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."): The *type*, *choices*, and *metavar* parameters
of `argparse.BooleanOptionalAction` are deprecated
and will be removed in 3\.14\.
(Contributed by Nikita Sobolev in [gh\-92248](https://github.com/python/cpython/issues/92248).)
* [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation."): The following features have been deprecated in documentation
since Python 3\.8, now cause a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") to be emitted at
runtime when they are accessed or used, and will be removed in Python 3\.14:

	+ `ast.Num`
	+ `ast.Str`
	+ `ast.Bytes`
	+ `ast.NameConstant`
	+ `ast.Ellipsis`Use [`ast.Constant`](../library/ast.html#ast.Constant "ast.Constant") instead.
(Contributed by Serhiy Storchaka in [gh\-90953](https://github.com/python/cpython/issues/90953).)
* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."):

	+ The child watcher classes [`MultiLoopChildWatcher`](../library/asyncio-policy.html#asyncio.MultiLoopChildWatcher "asyncio.MultiLoopChildWatcher"),
	[`FastChildWatcher`](../library/asyncio-policy.html#asyncio.FastChildWatcher "asyncio.FastChildWatcher"), [`AbstractChildWatcher`](../library/asyncio-policy.html#asyncio.AbstractChildWatcher "asyncio.AbstractChildWatcher")
	and [`SafeChildWatcher`](../library/asyncio-policy.html#asyncio.SafeChildWatcher "asyncio.SafeChildWatcher") are deprecated and
	will be removed in Python 3\.14\.
	(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
	+ [`asyncio.set_child_watcher()`](../library/asyncio-policy.html#asyncio.set_child_watcher "asyncio.set_child_watcher"), [`asyncio.get_child_watcher()`](../library/asyncio-policy.html#asyncio.get_child_watcher "asyncio.get_child_watcher"),
	[`asyncio.AbstractEventLoopPolicy.set_child_watcher()`](../library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.set_child_watcher "asyncio.AbstractEventLoopPolicy.set_child_watcher") and
	[`asyncio.AbstractEventLoopPolicy.get_child_watcher()`](../library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.get_child_watcher "asyncio.AbstractEventLoopPolicy.get_child_watcher") are deprecated
	and will be removed in Python 3\.14\.
	(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
	+ The [`get_event_loop()`](../library/asyncio-eventloop.html#asyncio.get_event_loop "asyncio.get_event_loop") method of the
	default event loop policy now emits a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") if there
	is no current event loop set and it decides to create one.
	(Contributed by Serhiy Storchaka and Guido van Rossum in [gh\-100160](https://github.com/python/cpython/issues/100160).)
* [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers"): Deprecated [`ByteString`](../library/collections.abc.html#collections.abc.ByteString "collections.abc.ByteString").
Prefer `Sequence` or [`Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer").
For use in typing, prefer a union, like `bytes | bytearray`,
or [`collections.abc.Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer").
(Contributed by Shantanu Jain in [gh\-91896](https://github.com/python/cpython/issues/91896).)
* [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages."): Deprecated the *isdst* parameter in [`email.utils.localtime()`](../library/email.utils.html#email.utils.localtime "email.utils.localtime").
(Contributed by Alan Williams in [gh\-72346](https://github.com/python/cpython/issues/72346).)
* [`importlib.abc`](../library/importlib.html#module-importlib.abc "importlib.abc: Abstract base classes related to import") deprecated classes:

	+ `importlib.abc.ResourceReader`
	+ `importlib.abc.Traversable`
	+ `importlib.abc.TraversableResources`Use [`importlib.resources.abc`](../library/importlib.resources.abc.html#module-importlib.resources.abc "importlib.resources.abc: Abstract base classes for resources") classes instead:

	+ [`importlib.resources.abc.Traversable`](../library/importlib.resources.abc.html#importlib.resources.abc.Traversable "importlib.resources.abc.Traversable")
	+ [`importlib.resources.abc.TraversableResources`](../library/importlib.resources.abc.html#importlib.resources.abc.TraversableResources "importlib.resources.abc.TraversableResources")(Contributed by Jason R. Coombs and Hugo van Kemenade in [gh\-93963](https://github.com/python/cpython/issues/93963).)
* [`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping.") had undocumented, inefficient, historically buggy,
and inconsistent support for copy, deepcopy, and pickle operations.
This will be removed in 3\.14 for a significant reduction in code
volume and maintenance burden.
(Contributed by Raymond Hettinger in [gh\-101588](https://github.com/python/cpython/issues/101588).)
* [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism."): The default start method will change to a safer one on
Linux, BSDs, and other non\-macOS POSIX platforms where `'fork'` is currently
the default ([gh\-84559](https://github.com/python/cpython/issues/84559)). Adding a runtime warning about this was deemed too
disruptive as the majority of code is not expected to care. Use the
[`get_context()`](../library/multiprocessing.html#multiprocessing.get_context "multiprocessing.get_context") or
[`set_start_method()`](../library/multiprocessing.html#multiprocessing.set_start_method "multiprocessing.set_start_method") APIs to explicitly specify when
your code *requires* `'fork'`. See [Contexts and start methods](../library/multiprocessing.html#multiprocessing-start-methods).
* [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths"): [`is_relative_to()`](../library/pathlib.html#pathlib.PurePath.is_relative_to "pathlib.PurePath.is_relative_to") and
[`relative_to()`](../library/pathlib.html#pathlib.PurePath.relative_to "pathlib.PurePath.relative_to"): passing additional arguments is
deprecated.
* [`pkgutil`](../library/pkgutil.html#module-pkgutil "pkgutil: Utilities for the import system."): [`find_loader()`](../library/pkgutil.html#pkgutil.find_loader "pkgutil.find_loader") and [`get_loader()`](../library/pkgutil.html#pkgutil.get_loader "pkgutil.get_loader")
now raise [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning");
use [`importlib.util.find_spec()`](../library/importlib.html#importlib.util.find_spec "importlib.util.find_spec") instead.
(Contributed by Nikita Sobolev in [gh\-97850](https://github.com/python/cpython/issues/97850).)
* [`pty`](../library/pty.html#module-pty "pty: Pseudo-Terminal Handling for Unix. (Unix)"):

	+ `master_open()`: use [`pty.openpty()`](../library/pty.html#pty.openpty "pty.openpty").
	+ `slave_open()`: use [`pty.openpty()`](../library/pty.html#pty.openpty "pty.openpty").
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x."):

	+ [`version`](../library/sqlite3.html#sqlite3.version "sqlite3.version") and [`version_info`](../library/sqlite3.html#sqlite3.version_info "sqlite3.version_info").
	+ [`execute()`](../library/sqlite3.html#sqlite3.Cursor.execute "sqlite3.Cursor.execute") and [`executemany()`](../library/sqlite3.html#sqlite3.Cursor.executemany "sqlite3.Cursor.executemany")
	if [named placeholders](../library/sqlite3.html#sqlite3-placeholders) are used and
	*parameters* is a sequence instead of a [`dict`](../library/stdtypes.html#dict "dict").
* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."): [`ByteString`](../library/typing.html#typing.ByteString "typing.ByteString"), deprecated since Python 3\.9,
now causes a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") to be emitted when it is used.
* [`urllib`](../library/urllib.html#module-urllib "urllib"):
`urllib.parse.Quoter` is deprecated: it was not intended to be a
public API.
(Contributed by Gregory P. Smith in [gh\-88168](https://github.com/python/cpython/issues/88168).)

### Pending Removal in Python 3\.15[¶](#pending-removal-in-python-3-15 "Link to this heading")

* The import system:

	+ Setting [`__cached__`](../reference/datamodel.html#module.__cached__ "module.__cached__") on a module while
	failing to set [`__spec__.cached`](../library/importlib.html#importlib.machinery.ModuleSpec.cached "importlib.machinery.ModuleSpec.cached")
	is deprecated. In Python 3\.15, `__cached__` will cease to be set or
	take into consideration by the import system or standard library. ([gh\-97879](https://github.com/python/cpython/issues/97879))
	+ Setting [`__package__`](../reference/datamodel.html#module.__package__ "module.__package__") on a module while
	failing to set [`__spec__.parent`](../library/importlib.html#importlib.machinery.ModuleSpec.parent "importlib.machinery.ModuleSpec.parent")
	is deprecated. In Python 3\.15, `__package__` will cease to be set or
	take into consideration by the import system or standard library. ([gh\-97879](https://github.com/python/cpython/issues/97879))
* [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python."):

	+ The undocumented `ctypes.SetPointerType()` function
	has been deprecated since Python 3\.13\.
* [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers."):

	+ The obsolete and rarely used [`CGIHTTPRequestHandler`](../library/http.server.html#http.server.CGIHTTPRequestHandler "http.server.CGIHTTPRequestHandler")
	has been deprecated since Python 3\.13\.
	No direct replacement exists.
	*Anything* is better than CGI to interface
	a web server with a request handler.
	+ The `--cgi` flag to the **python \-m http.server**
	command\-line interface has been deprecated since Python 3\.13\.
* [`locale`](../library/locale.html#module-locale "locale: Internationalization services."):

	+ The [`getdefaultlocale()`](../library/locale.html#locale.getdefaultlocale "locale.getdefaultlocale") function
	has been deprecated since Python 3\.11\.
	Its removal was originally planned for Python 3\.13 ([gh\-90817](https://github.com/python/cpython/issues/90817)),
	but has been postponed to Python 3\.15\.
	Use [`getlocale()`](../library/locale.html#locale.getlocale "locale.getlocale"), [`setlocale()`](../library/locale.html#locale.setlocale "locale.setlocale"),
	and [`getencoding()`](../library/locale.html#locale.getencoding "locale.getencoding") instead.
	(Contributed by Hugo van Kemenade in [gh\-111187](https://github.com/python/cpython/issues/111187).)
* [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths"):

	+ [`PurePath.is_reserved()`](../library/pathlib.html#pathlib.PurePath.is_reserved "pathlib.PurePath.is_reserved")
	has been deprecated since Python 3\.13\.
	Use [`os.path.isreserved()`](../library/os.path.html#os.path.isreserved "os.path.isreserved") to detect reserved paths on Windows.
* [`platform`](../library/platform.html#module-platform "platform: Retrieves as much platform identifying data as possible."):

	+ [`java_ver()`](../library/platform.html#platform.java_ver "platform.java_ver") has been deprecated since Python 3\.13\.
	This function is only useful for Jython support, has a confusing API,
	and is largely untested.
* [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism."):

	+ [`RLock()`](../library/threading.html#threading.RLock "threading.RLock") will take no arguments in Python 3\.15\.
	Passing any arguments has been deprecated since Python 3\.14,
	as the Python version does not permit any arguments,
	but the C version allows any number of positional or keyword arguments,
	ignoring every argument.
* [`types`](../library/types.html#module-types "types: Names for built-in types."):

	+ [`types.CodeType`](../library/types.html#types.CodeType "types.CodeType"): Accessing [`co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab") was
	deprecated in [**PEP 626**](https://peps.python.org/pep-0626/)
	since 3\.10 and was planned to be removed in 3\.12,
	but it only got a proper [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") in 3\.12\.
	May be removed in 3\.15\.
	(Contributed by Nikita Sobolev in [gh\-101866](https://github.com/python/cpython/issues/101866).)
* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."):

	+ The undocumented keyword argument syntax for creating
	[`NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") classes
	(e.g. `Point = NamedTuple("Point", x=int, y=int)`)
	has been deprecated since Python 3\.13\.
	Use the class\-based syntax or the functional syntax instead.
	+ The [`typing.no_type_check_decorator()`](../library/typing.html#typing.no_type_check_decorator "typing.no_type_check_decorator") decorator function
	has been deprecated since Python 3\.13\.
	After eight years in the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module,
	it has yet to be supported by any major type checker.
* [`wave`](../library/wave.html#module-wave "wave: Provide an interface to the WAV sound format."):

	+ The [`getmark()`](../library/wave.html#wave.Wave_read.getmark "wave.Wave_read.getmark"), `setmark()`,
	and [`getmarkers()`](../library/wave.html#wave.Wave_read.getmarkers "wave.Wave_read.getmarkers") methods of
	the [`Wave_read`](../library/wave.html#wave.Wave_read "wave.Wave_read") and [`Wave_write`](../library/wave.html#wave.Wave_write "wave.Wave_write") classes
	have been deprecated since Python 3\.13\.

### Pending removal in Python 3\.16[¶](#pending-removal-in-python-3-16 "Link to this heading")

* The import system:

	+ Setting [`__loader__`](../reference/datamodel.html#module.__loader__ "module.__loader__") on a module while
	failing to set [`__spec__.loader`](../library/importlib.html#importlib.machinery.ModuleSpec.loader "importlib.machinery.ModuleSpec.loader")
	is deprecated. In Python 3\.16, `__loader__` will cease to be set or
	taken into consideration by the import system or the standard library.
* [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values."):

	+ The `'u'` format code (`wchar_t`)
	has been deprecated in documentation since Python 3\.3
	and at runtime since Python 3\.13\.
	Use the `'w'` format code ([`Py_UCS4`](../c-api/unicode.html#c.Py_UCS4 "Py_UCS4"))
	for Unicode characters instead.
* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."):

	+ `asyncio.iscoroutinefunction()` is deprecated
	and will be removed in Python 3\.16,
	use [`inspect.iscoroutinefunction()`](../library/inspect.html#inspect.iscoroutinefunction "inspect.iscoroutinefunction") instead.
	(Contributed by Jiahao Li and Kumar Aditya in [gh\-122875](https://github.com/python/cpython/issues/122875).)
* [`builtins`](../library/builtins.html#module-builtins "builtins: The module that provides the built-in namespace."):

	+ Bitwise inversion on boolean types, `~True` or `~False`
	has been deprecated since Python 3\.12,
	as it produces surprising and unintuitive results (`-2` and `-1`).
	Use `not x` instead for the logical negation of a Boolean.
	In the rare case that you need the bitwise inversion of
	the underlying integer, convert to `int` explicitly (`~int(x)`).
* [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying."):

	+ The `ExecError` exception
	has been deprecated since Python 3\.14\.
	It has not been used by any function in `shutil` since Python 3\.4,
	and is now an alias of [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError").
* [`symtable`](../library/symtable.html#module-symtable "symtable: Interface to the compiler's internal symbol tables."):

	+ The [`Class.get_methods`](../library/symtable.html#symtable.Class.get_methods "symtable.Class.get_methods") method
	has been deprecated since Python 3\.14\.
* [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions."):

	+ The [`_enablelegacywindowsfsencoding()`](../library/sys.html#sys._enablelegacywindowsfsencoding "sys._enablelegacywindowsfsencoding") function
	has been deprecated since Python 3\.13\.
	Use the [`PYTHONLEGACYWINDOWSFSENCODING`](../using/cmdline.html#envvar-PYTHONLEGACYWINDOWSFSENCODING) environment variable instead.
* [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."):

	+ The undocumented and unused `TarFile.tarfile` attribute
	has been deprecated since Python 3\.13\.

### Pending Removal in Future Versions[¶](#pending-removal-in-future-versions "Link to this heading")

The following APIs will be removed in the future,
although there is currently no date scheduled for their removal.

* [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."): Nesting argument groups and nesting mutually exclusive
groups are deprecated.
* [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values.")’s `'u'` format code ([gh\-57281](https://github.com/python/cpython/issues/57281))
* [`builtins`](../library/builtins.html#module-builtins "builtins: The module that provides the built-in namespace."):

	+ `bool(NotImplemented)`.
	+ Generators: `throw(type, exc, tb)` and `athrow(type, exc, tb)`
	signature is deprecated: use `throw(exc)` and `athrow(exc)` instead,
	the single argument signature.
	+ Currently Python accepts numeric literals immediately followed by keywords,
	for example `0in x`, `1or x`, `0if 1else 2`. It allows confusing and
	ambiguous expressions like `[0x1for x in y]` (which can be interpreted as
	`[0x1 for x in y]` or `[0x1f or x in y]`). A syntax warning is raised
	if the numeric literal is immediately followed by one of keywords
	[`and`](../reference/expressions.html#and), [`else`](../reference/compound_stmts.html#else), [`for`](../reference/compound_stmts.html#for), [`if`](../reference/compound_stmts.html#if),
	[`in`](../reference/expressions.html#in), [`is`](../reference/expressions.html#is) and [`or`](../reference/expressions.html#or). In a future release it
	will be changed to a syntax error. ([gh\-87999](https://github.com/python/cpython/issues/87999))
	+ Support for `__index__()` and `__int__()` method returning non\-int type:
	these methods will be required to return an instance of a strict subclass of
	[`int`](../library/functions.html#int "int").
	+ Support for `__float__()` method returning a strict subclass of
	[`float`](../library/functions.html#float "float"): these methods will be required to return an instance of
	[`float`](../library/functions.html#float "float").
	+ Support for `__complex__()` method returning a strict subclass of
	[`complex`](../library/functions.html#complex "complex"): these methods will be required to return an instance of
	[`complex`](../library/functions.html#complex "complex").
	+ Delegation of `int()` to `__trunc__()` method.
	+ Passing a complex number as the *real* or *imag* argument in the
	[`complex()`](../library/functions.html#complex "complex") constructor is now deprecated; it should only be passed
	as a single positional argument.
	(Contributed by Serhiy Storchaka in [gh\-109218](https://github.com/python/cpython/issues/109218).)
* [`calendar`](../library/calendar.html#module-calendar "calendar: Functions for working with calendars, including some emulation of the Unix cal program."): `calendar.January` and `calendar.February` constants are
deprecated and replaced by [`calendar.JANUARY`](../library/calendar.html#calendar.JANUARY "calendar.JANUARY") and
[`calendar.FEBRUARY`](../library/calendar.html#calendar.FEBRUARY "calendar.FEBRUARY").
(Contributed by Prince Roshan in [gh\-103636](https://github.com/python/cpython/issues/103636).)
* [`codeobject.co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab"): use the [`codeobject.co_lines()`](../reference/datamodel.html#codeobject.co_lines "codeobject.co_lines") method
instead.
* [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types."):

	+ [`utcnow()`](../library/datetime.html#datetime.datetime.utcnow "datetime.datetime.utcnow"):
	use `datetime.datetime.now(tz=datetime.UTC)`.
	+ [`utcfromtimestamp()`](../library/datetime.html#datetime.datetime.utcfromtimestamp "datetime.datetime.utcfromtimestamp"):
	use `datetime.datetime.fromtimestamp(timestamp, tz=datetime.UTC)`.
* [`gettext`](../library/gettext.html#module-gettext "gettext: Multilingual internationalization services."): Plural value must be an integer.
* [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery."):

	+ `load_module()` method: use `exec_module()` instead.
	+ [`cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source") *debug\_override* parameter is
	deprecated: use the *optimization* parameter instead.
* [`importlib.metadata`](../library/importlib.metadata.html#module-importlib.metadata "importlib.metadata: Accessing package metadata"):

	+ `EntryPoints` tuple interface.
	+ Implicit `None` on return values.
* [`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications."): the `warn()` method has been deprecated
since Python 3\.3, use [`warning()`](../library/logging.html#logging.warning "logging.warning") instead.
* [`mailbox`](../library/mailbox.html#module-mailbox "mailbox: Manipulate mailboxes in various formats"): Use of StringIO input and text mode is deprecated, use
BytesIO and binary mode instead.
* [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces."): Calling [`os.register_at_fork()`](../library/os.html#os.register_at_fork "os.register_at_fork") in multi\-threaded process.
* `pydoc.ErrorDuringImport`: A tuple value for *exc\_info* parameter is
deprecated, use an exception instance.
* [`re`](../library/re.html#module-re "re: Regular expression operations."): More strict rules are now applied for numerical group references
and group names in regular expressions. Only sequence of ASCII digits is now
accepted as a numerical reference. The group name in bytes patterns and
replacement strings can now only contain ASCII letters and digits and
underscore.
(Contributed by Serhiy Storchaka in [gh\-91760](https://github.com/python/cpython/issues/91760).)
* `sre_compile`, `sre_constants` and `sre_parse` modules.
* [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying."): [`rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree")’s *onerror* parameter is deprecated in
Python 3\.12; use the *onexc* parameter instead.
* [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") options and protocols:

	+ [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") without protocol argument is deprecated.
	+ [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext"): [`set_npn_protocols()`](../library/ssl.html#ssl.SSLContext.set_npn_protocols "ssl.SSLContext.set_npn_protocols") and
	`selected_npn_protocol()` are deprecated: use ALPN
	instead.
	+ `ssl.OP_NO_SSL*` options
	+ `ssl.OP_NO_TLS*` options
	+ `ssl.PROTOCOL_SSLv3`
	+ `ssl.PROTOCOL_TLS`
	+ `ssl.PROTOCOL_TLSv1`
	+ `ssl.PROTOCOL_TLSv1_1`
	+ `ssl.PROTOCOL_TLSv1_2`
	+ `ssl.TLSVersion.SSLv3`
	+ `ssl.TLSVersion.TLSv1`
	+ `ssl.TLSVersion.TLSv1_1`
* [`sysconfig.is_python_build()`](../library/sysconfig.html#sysconfig.is_python_build "sysconfig.is_python_build") *check\_home* parameter is deprecated and
ignored.
* [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") methods:

	+ `threading.Condition.notifyAll()`: use [`notify_all()`](../library/threading.html#threading.Condition.notify_all "threading.Condition.notify_all").
	+ `threading.Event.isSet()`: use [`is_set()`](../library/threading.html#threading.Event.is_set "threading.Event.is_set").
	+ `threading.Thread.isDaemon()`, [`threading.Thread.setDaemon()`](../library/threading.html#threading.Thread.setDaemon "threading.Thread.setDaemon"):
	use [`threading.Thread.daemon`](../library/threading.html#threading.Thread.daemon "threading.Thread.daemon") attribute.
	+ `threading.Thread.getName()`, [`threading.Thread.setName()`](../library/threading.html#threading.Thread.setName "threading.Thread.setName"):
	use [`threading.Thread.name`](../library/threading.html#threading.Thread.name "threading.Thread.name") attribute.
	+ `threading.currentThread()`: use [`threading.current_thread()`](../library/threading.html#threading.current_thread "threading.current_thread").
	+ `threading.activeCount()`: use [`threading.active_count()`](../library/threading.html#threading.active_count "threading.active_count").
* [`typing.Text`](../library/typing.html#typing.Text "typing.Text") ([gh\-92332](https://github.com/python/cpython/issues/92332)).
* [`unittest.IsolatedAsyncioTestCase`](../library/unittest.html#unittest.IsolatedAsyncioTestCase "unittest.IsolatedAsyncioTestCase"): it is deprecated to return a value
that is not `None` from a test case.
* [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") deprecated functions: [`urlparse()`](../library/urllib.parse.html#urllib.parse.urlparse "urllib.parse.urlparse") instead

	+ `splitattr()`
	+ `splithost()`
	+ `splitnport()`
	+ `splitpasswd()`
	+ `splitport()`
	+ `splitquery()`
	+ `splittag()`
	+ `splittype()`
	+ `splituser()`
	+ `splitvalue()`
	+ `to_bytes()`
* [`urllib.request`](../library/urllib.request.html#module-urllib.request "urllib.request: Extensible library for opening URLs."): [`URLopener`](../library/urllib.request.html#urllib.request.URLopener "urllib.request.URLopener") and
[`FancyURLopener`](../library/urllib.request.html#urllib.request.FancyURLopener "urllib.request.FancyURLopener") style of invoking requests is
deprecated. Use newer [`urlopen()`](../library/urllib.request.html#urllib.request.urlopen "urllib.request.urlopen") functions and methods.
* [`wsgiref`](../library/wsgiref.html#module-wsgiref "wsgiref: WSGI Utilities and Reference Implementation."): `SimpleHandler.stdout.write()` should not do partial
writes.
* [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API."): Testing the truth value of an
[`Element`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element "xml.etree.ElementTree.Element") is deprecated. In a future release it
will always return `True`. Prefer explicit `len(elem)` or
`elem is not None` tests instead.
* [`zipimport.zipimporter.load_module()`](../library/zipimport.html#zipimport.zipimporter.load_module "zipimport.zipimporter.load_module") is deprecated:
use [`exec_module()`](../library/zipimport.html#zipimport.zipimporter.exec_module "zipimport.zipimporter.exec_module") instead.

## Removed[¶](#removed "Link to this heading")

### asynchat and asyncore[¶](#asynchat-and-asyncore "Link to this heading")

* These two modules have been removed
according to the schedule in [**PEP 594**](https://peps.python.org/pep-0594/),
having been deprecated in Python 3\.6\.
Use [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") instead.
(Contributed by Nikita Sobolev in [gh\-96580](https://github.com/python/cpython/issues/96580).)

### configparser[¶](#configparser "Link to this heading")

* Several names deprecated in the [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") way back in 3\.2 have
been removed per [gh\-89336](https://github.com/python/cpython/issues/89336):

	+ [`configparser.ParsingError`](../library/configparser.html#configparser.ParsingError "configparser.ParsingError") no longer has a `filename` attribute
	or argument. Use the `source` attribute and argument instead.
	+ [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") no longer has a `SafeConfigParser` class. Use the
	shorter [`ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser") name instead.
	+ [`configparser.ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser") no longer has a `readfp` method.
	Use [`read_file()`](../library/configparser.html#configparser.ConfigParser.read_file "configparser.ConfigParser.read_file") instead.

### distutils[¶](#distutils "Link to this heading")

* Remove the `distutils` package. It was deprecated in Python 3\.10 by
[**PEP 632**](https://peps.python.org/pep-0632/) “Deprecate distutils module”. For projects still using
`distutils` and cannot be updated to something else, the `setuptools`
project can be installed: it still provides `distutils`.
(Contributed by Victor Stinner in [gh\-92584](https://github.com/python/cpython/issues/92584).)

### ensurepip[¶](#ensurepip "Link to this heading")

* Remove the bundled setuptools wheel from [`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment."),
and stop installing setuptools in environments created by [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.").

`pip (>= 22.1)` does not require setuptools to be installed in the
environment. `setuptools`\-based (and `distutils`\-based) packages
can still be used with `pip install`, since pip will provide
`setuptools` in the build environment it uses for building a
package.

`easy_install`, `pkg_resources`, `setuptools` and `distutils`
are no longer provided by default in environments created with
`venv` or bootstrapped with `ensurepip`, since they are part of
the `setuptools` package. For projects relying on these at runtime,
the `setuptools` project should be declared as a dependency and
installed separately (typically, using pip).

(Contributed by Pradyun Gedam in [gh\-95299](https://github.com/python/cpython/issues/95299).)

### enum[¶](#enum "Link to this heading")

* Remove [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class.")’s `EnumMeta.__getattr__`, which is no longer needed for
enum attribute access.
(Contributed by Ethan Furman in [gh\-95083](https://github.com/python/cpython/issues/95083).)

### ftplib[¶](#ftplib "Link to this heading")

* Remove [`ftplib`](../library/ftplib.html#module-ftplib "ftplib: FTP protocol client (requires sockets).")’s `FTP_TLS.ssl_version` class attribute: use the
*context* parameter instead.
(Contributed by Victor Stinner in [gh\-94172](https://github.com/python/cpython/issues/94172).)

### gzip[¶](#gzip "Link to this heading")

* Remove the `filename` attribute of [`gzip`](../library/gzip.html#module-gzip "gzip: Interfaces for gzip compression and decompression using file objects.")’s [`gzip.GzipFile`](../library/gzip.html#gzip.GzipFile "gzip.GzipFile"),
deprecated since Python 2\.6, use the [`name`](../library/gzip.html#gzip.GzipFile.name "gzip.GzipFile.name") attribute
instead. In write mode, the `filename` attribute added `'.gz'` file
extension if it was not present.
(Contributed by Victor Stinner in [gh\-94196](https://github.com/python/cpython/issues/94196).)

### hashlib[¶](#hashlib "Link to this heading")

* Remove the pure Python implementation of [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.")’s
[`hashlib.pbkdf2_hmac()`](../library/hashlib.html#hashlib.pbkdf2_hmac "hashlib.pbkdf2_hmac"), deprecated in Python 3\.10\. Python 3\.10 and
newer requires OpenSSL 1\.1\.1 ([**PEP 644**](https://peps.python.org/pep-0644/)): this OpenSSL version provides
a C implementation of [`pbkdf2_hmac()`](../library/hashlib.html#hashlib.pbkdf2_hmac "hashlib.pbkdf2_hmac") which is faster.
(Contributed by Victor Stinner in [gh\-94199](https://github.com/python/cpython/issues/94199).)

### importlib[¶](#importlib "Link to this heading")

* Many previously deprecated cleanups in [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") have now been
completed:

	+ References to, and support for `module_repr()` has been removed.
	(Contributed by Barry Warsaw in [gh\-97850](https://github.com/python/cpython/issues/97850).)
	+ `importlib.util.set_package`, `importlib.util.set_loader` and
	`importlib.util.module_for_loader` have all been removed. (Contributed by
	Brett Cannon and Nikita Sobolev in [gh\-65961](https://github.com/python/cpython/issues/65961) and [gh\-97850](https://github.com/python/cpython/issues/97850).)
	+ Support for `find_loader()` and `find_module()` APIs have been
	removed. (Contributed by Barry Warsaw in [gh\-98040](https://github.com/python/cpython/issues/98040).)
	+ `importlib.abc.Finder`, `pkgutil.ImpImporter`, and `pkgutil.ImpLoader`
	have been removed. (Contributed by Barry Warsaw in [gh\-98040](https://github.com/python/cpython/issues/98040).)

### imp[¶](#imp "Link to this heading")

* The `imp` module has been removed. (Contributed by Barry Warsaw in
[gh\-98040](https://github.com/python/cpython/issues/98040).)

To migrate, consult the following correspondence table:

> | imp | importlib |
> | --- | --- |
> | `imp.NullImporter` | Insert `None` into `sys.path_importer_cache` |
> | `imp.cache_from_source()` | [`importlib.util.cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source") |
> | `imp.find_module()` | [`importlib.util.find_spec()`](../library/importlib.html#importlib.util.find_spec "importlib.util.find_spec") |
> | `imp.get_magic()` | [`importlib.util.MAGIC_NUMBER`](../library/importlib.html#importlib.util.MAGIC_NUMBER "importlib.util.MAGIC_NUMBER") |
> | `imp.get_suffixes()` | [`importlib.machinery.SOURCE_SUFFIXES`](../library/importlib.html#importlib.machinery.SOURCE_SUFFIXES "importlib.machinery.SOURCE_SUFFIXES"), [`importlib.machinery.EXTENSION_SUFFIXES`](../library/importlib.html#importlib.machinery.EXTENSION_SUFFIXES "importlib.machinery.EXTENSION_SUFFIXES"), and [`importlib.machinery.BYTECODE_SUFFIXES`](../library/importlib.html#importlib.machinery.BYTECODE_SUFFIXES "importlib.machinery.BYTECODE_SUFFIXES") |
> | `imp.get_tag()` | [`sys.implementation.cache_tag`](../library/sys.html#sys.implementation "sys.implementation") |
> | `imp.load_module()` | [`importlib.import_module()`](../library/importlib.html#importlib.import_module "importlib.import_module") |
> | `imp.new_module(name)` | `types.ModuleType(name)` |
> | `imp.reload()` | [`importlib.reload()`](../library/importlib.html#importlib.reload "importlib.reload") |
> | `imp.source_from_cache()` | [`importlib.util.source_from_cache()`](../library/importlib.html#importlib.util.source_from_cache "importlib.util.source_from_cache") |
> | `imp.load_source()` | *See below* |

Replace `imp.load_source()` with:

\`\`\`
import importlib.util
import importlib.machinery

def load\_source(modname, filename):
 loader = importlib.machinery.SourceFileLoader(modname, filename)
 spec = importlib.util.spec\_from\_file\_location(modname, filename, loader=loader)
 module = importlib.util.module\_from\_spec(spec)
 \# The module is always executed and not cached in sys.modules.
 \# Uncomment the following line to cache the module.
 \# sys.modules\[module.\_\_name\_\_] = module
 loader.exec\_module(module)
 return module

\`\`\`
* Remove `imp` functions and attributes with no replacements:

	+ Undocumented functions:

		- `imp.init_builtin()`
		- `imp.load_compiled()`
		- `imp.load_dynamic()`
		- `imp.load_package()`
	+ `imp.lock_held()`, `imp.acquire_lock()`, `imp.release_lock()`:
	the locking scheme has changed in Python 3\.3 to per\-module locks.
	+ `imp.find_module()` constants: `SEARCH_ERROR`, `PY_SOURCE`,
	`PY_COMPILED`, `C_EXTENSION`, `PY_RESOURCE`, `PKG_DIRECTORY`,
	`C_BUILTIN`, `PY_FROZEN`, `PY_CODERESOURCE`, `IMP_HOOK`.

### io[¶](#io "Link to this heading")

* Remove [`io`](../library/io.html#module-io "io: Core tools for working with streams.")’s `io.OpenWrapper` and `_pyio.OpenWrapper`, deprecated in Python
3\.10: just use [`open()`](../library/functions.html#open "open") instead. The [`open()`](../library/functions.html#open "open") ([`io.open()`](../library/io.html#io.open "io.open"))
function is a built\-in function. Since Python 3\.10, `_pyio.open()` is
also a static method.
(Contributed by Victor Stinner in [gh\-94169](https://github.com/python/cpython/issues/94169).)

### locale[¶](#locale "Link to this heading")

* Remove [`locale`](../library/locale.html#module-locale "locale: Internationalization services.")’s `locale.format()` function, deprecated in Python 3\.7:
use [`locale.format_string()`](../library/locale.html#locale.format_string "locale.format_string") instead.
(Contributed by Victor Stinner in [gh\-94226](https://github.com/python/cpython/issues/94226).)

### smtpd[¶](#smtpd "Link to this heading")

* The `smtpd` module has been removed according to the schedule in [**PEP 594**](https://peps.python.org/pep-0594/),
having been deprecated in Python 3\.4\.7 and 3\.5\.4\.
Use the [aiosmtpd](https://pypi.org/project/aiosmtpd/) PyPI module or any other
[`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.")\-based server instead.
(Contributed by Oleg Iarygin in [gh\-93243](https://github.com/python/cpython/issues/93243).)

### sqlite3[¶](#id2 "Link to this heading")

* The following undocumented [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") features, deprecated in Python
3\.10, are now removed:

	+ `sqlite3.enable_shared_cache()`
	+ `sqlite3.OptimizedUnicode`If a shared cache must be used, open the database in URI mode using the
`cache=shared` query parameter.

The `sqlite3.OptimizedUnicode` text factory has been an alias for
[`str`](../library/stdtypes.html#str "str") since Python 3\.3\. Code that previously set the text factory to
`OptimizedUnicode` can either use `str` explicitly, or rely on the
default value which is also `str`.

(Contributed by Erlend E. Aasland in [gh\-92548](https://github.com/python/cpython/issues/92548).)

### ssl[¶](#ssl "Link to this heading")

* Remove [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects")’s `ssl.RAND_pseudo_bytes()` function, deprecated in Python 3\.6:
use [`os.urandom()`](../library/os.html#os.urandom "os.urandom") or [`ssl.RAND_bytes()`](../library/ssl.html#ssl.RAND_bytes "ssl.RAND_bytes") instead.
(Contributed by Victor Stinner in [gh\-94199](https://github.com/python/cpython/issues/94199).)
* Remove the `ssl.match_hostname()` function.
It was deprecated in Python 3\.7\. OpenSSL performs
hostname matching since Python 3\.7, Python no longer uses the
`ssl.match_hostname()` function.
(Contributed by Victor Stinner in [gh\-94199](https://github.com/python/cpython/issues/94199).)
* Remove the `ssl.wrap_socket()` function, deprecated in Python 3\.7:
instead, create a [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") object and call its
[`ssl.SSLContext.wrap_socket`](../library/ssl.html#ssl.SSLContext.wrap_socket "ssl.SSLContext.wrap_socket") method. Any package that still uses
`ssl.wrap_socket()` is broken and insecure. The function neither sends a
SNI TLS extension nor validates the server hostname. Code is subject to [**CWE 295**](https://cwe.mitre.org/data/definitions/295.html)
(Improper Certificate Validation).
(Contributed by Victor Stinner in [gh\-94199](https://github.com/python/cpython/issues/94199).)

### unittest[¶](#id3 "Link to this heading")

* Remove many long\-deprecated [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") features:

	+ A number of [`TestCase`](../library/unittest.html#unittest.TestCase "unittest.TestCase") method aliases:

	| Deprecated alias | Method Name | Deprecated in |
	| --- | --- | --- |
	| `failUnless` | [`assertTrue()`](../library/unittest.html#unittest.TestCase.assertTrue "unittest.TestCase.assertTrue") | 3\.1 |
	| `failIf` | [`assertFalse()`](../library/unittest.html#unittest.TestCase.assertFalse "unittest.TestCase.assertFalse") | 3\.1 |
	| `failUnlessEqual` | [`assertEqual()`](../library/unittest.html#unittest.TestCase.assertEqual "unittest.TestCase.assertEqual") | 3\.1 |
	| `failIfEqual` | [`assertNotEqual()`](../library/unittest.html#unittest.TestCase.assertNotEqual "unittest.TestCase.assertNotEqual") | 3\.1 |
	| `failUnlessAlmostEqual` | [`assertAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertAlmostEqual "unittest.TestCase.assertAlmostEqual") | 3\.1 |
	| `failIfAlmostEqual` | [`assertNotAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertNotAlmostEqual "unittest.TestCase.assertNotAlmostEqual") | 3\.1 |
	| `failUnlessRaises` | [`assertRaises()`](../library/unittest.html#unittest.TestCase.assertRaises "unittest.TestCase.assertRaises") | 3\.1 |
	| `assert_` | [`assertTrue()`](../library/unittest.html#unittest.TestCase.assertTrue "unittest.TestCase.assertTrue") | 3\.2 |
	| `assertEquals` | [`assertEqual()`](../library/unittest.html#unittest.TestCase.assertEqual "unittest.TestCase.assertEqual") | 3\.2 |
	| `assertNotEquals` | [`assertNotEqual()`](../library/unittest.html#unittest.TestCase.assertNotEqual "unittest.TestCase.assertNotEqual") | 3\.2 |
	| `assertAlmostEquals` | [`assertAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertAlmostEqual "unittest.TestCase.assertAlmostEqual") | 3\.2 |
	| `assertNotAlmostEquals` | [`assertNotAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertNotAlmostEqual "unittest.TestCase.assertNotAlmostEqual") | 3\.2 |
	| `assertRegexpMatches` | [`assertRegex()`](../library/unittest.html#unittest.TestCase.assertRegex "unittest.TestCase.assertRegex") | 3\.2 |
	| `assertRaisesRegexp` | [`assertRaisesRegex()`](../library/unittest.html#unittest.TestCase.assertRaisesRegex "unittest.TestCase.assertRaisesRegex") | 3\.2 |
	| `assertNotRegexpMatches` | [`assertNotRegex()`](../library/unittest.html#unittest.TestCase.assertNotRegex "unittest.TestCase.assertNotRegex") | 3\.5 |

	You can use  to automatically modernise
	your unit tests.
	+ Undocumented and broken [`TestCase`](../library/unittest.html#unittest.TestCase "unittest.TestCase") method
	`assertDictContainsSubset` (deprecated in Python 3\.2\).
	+ Undocumented [`TestLoader.loadTestsFromModule`](../library/unittest.html#unittest.TestLoader.loadTestsFromModule "unittest.TestLoader.loadTestsFromModule") parameter *use\_load\_tests*
	(deprecated and ignored since Python 3\.5\).
	+ An alias of the [`TextTestResult`](../library/unittest.html#unittest.TextTestResult "unittest.TextTestResult") class:
	`_TextTestResult` (deprecated in Python 3\.2\).(Contributed by Serhiy Storchaka in [gh\-89325](https://github.com/python/cpython/issues/89325).)

### webbrowser[¶](#webbrowser "Link to this heading")

* Remove support for obsolete browsers from [`webbrowser`](../library/webbrowser.html#module-webbrowser "webbrowser: Easy-to-use controller for web browsers.").
The removed browsers include: Grail, Mosaic, Netscape, Galeon, Skipstone,
Iceape, Firebird, and Firefox versions 35 and below ([gh\-102871](https://github.com/python/cpython/issues/102871)).

### xml.etree.ElementTree[¶](#xml-etree-elementtree "Link to this heading")

* Remove the `ElementTree.Element.copy()` method of the
pure Python implementation, deprecated in Python 3\.10, use the
[`copy.copy()`](../library/copy.html#copy.copy "copy.copy") function instead. The C implementation of [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.")
has no `copy()` method, only a `__copy__()` method.
(Contributed by Victor Stinner in [gh\-94383](https://github.com/python/cpython/issues/94383).)

### zipimport[¶](#zipimport "Link to this heading")

* Remove [`zipimport`](../library/zipimport.html#module-zipimport "zipimport: Support for importing Python modules from ZIP archives.")’s `find_loader()` and `find_module()` methods,
deprecated in Python 3\.10: use the `find_spec()` method instead. See
[**PEP 451**](https://peps.python.org/pep-0451/) for the rationale.
(Contributed by Victor Stinner in [gh\-94379](https://github.com/python/cpython/issues/94379).)

### Others[¶](#others "Link to this heading")

* Remove the `suspicious` rule from the documentation `Makefile` and
`Doc/tools/rstlint.py`, both in favor of [sphinx\-lint](https://github.com/sphinx-contrib/sphinx-lint).
(Contributed by Julien Palard in [gh\-98179](https://github.com/python/cpython/issues/98179).)
* Remove the *keyfile* and *certfile* parameters from the
[`ftplib`](../library/ftplib.html#module-ftplib "ftplib: FTP protocol client (requires sockets)."), [`imaplib`](../library/imaplib.html#module-imaplib "imaplib: IMAP4 protocol client (requires sockets)."), [`poplib`](../library/poplib.html#module-poplib "poplib: POP3 protocol client (requires sockets).") and [`smtplib`](../library/smtplib.html#module-smtplib "smtplib: SMTP protocol client (requires sockets).") modules,
and the *key\_file*, *cert\_file* and *check\_hostname* parameters from the
[`http.client`](../library/http.client.html#module-http.client "http.client: HTTP and HTTPS protocol client (requires sockets).") module,
all deprecated since Python 3\.6\. Use the *context* parameter
(*ssl\_context* in [`imaplib`](../library/imaplib.html#module-imaplib "imaplib: IMAP4 protocol client (requires sockets).")) instead.
(Contributed by Victor Stinner in [gh\-94172](https://github.com/python/cpython/issues/94172).)
* Remove `Jython` compatibility hacks from several stdlib modules and tests.
(Contributed by Nikita Sobolev in [gh\-99482](https://github.com/python/cpython/issues/99482).)
* Remove `_use_broken_old_ctypes_structure_semantics_` flag
from [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python.") module.
(Contributed by Nikita Sobolev in [gh\-99285](https://github.com/python/cpython/issues/99285).)

## Porting to Python 3\.12[¶](#porting-to-python-3-12 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* More strict rules are now applied for numerical group references and
group names in regular expressions.
Only sequence of ASCII digits is now accepted as a numerical reference.
The group name in bytes patterns and replacement strings can now only
contain ASCII letters and digits and underscore.
(Contributed by Serhiy Storchaka in [gh\-91760](https://github.com/python/cpython/issues/91760).)
* Remove `randrange()` functionality deprecated since Python 3\.10\. Formerly,
`randrange(10.0)` losslessly converted to `randrange(10)`. Now, it raises a
[`TypeError`](../library/exceptions.html#TypeError "TypeError"). Also, the exception raised for non\-integer values such as
`randrange(10.5)` or `randrange('10')` has been changed from [`ValueError`](../library/exceptions.html#ValueError "ValueError") to
[`TypeError`](../library/exceptions.html#TypeError "TypeError"). This also prevents bugs where `randrange(1e25)` would silently
select from a larger range than `randrange(10**25)`.
(Originally suggested by Serhiy Storchaka [gh\-86388](https://github.com/python/cpython/issues/86388).)
* [`argparse.ArgumentParser`](../library/argparse.html#argparse.ArgumentParser "argparse.ArgumentParser") changed encoding and error handler
for reading arguments from file (e.g. `fromfile_prefix_chars` option)
from default text encoding (e.g. [`locale.getpreferredencoding(False)`](../library/locale.html#locale.getpreferredencoding "locale.getpreferredencoding"))
to [filesystem encoding and error handler](../glossary.html#term-filesystem-encoding-and-error-handler).
Argument files should be encoded in UTF\-8 instead of ANSI Codepage on Windows.
* Remove the `asyncore`\-based `smtpd` module deprecated in Python 3\.4\.7
and 3\.5\.4\. A recommended replacement is the
[`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.")\-based [aiosmtpd](https://pypi.org/project/aiosmtpd/) PyPI module.
* [`shlex.split()`](../library/shlex.html#shlex.split "shlex.split"): Passing `None` for *s* argument now raises an
exception, rather than reading [`sys.stdin`](../library/sys.html#sys.stdin "sys.stdin"). The feature was deprecated
in Python 3\.9\.
(Contributed by Victor Stinner in [gh\-94352](https://github.com/python/cpython/issues/94352).)
* The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module no longer accepts bytes\-like paths, like
[`bytearray`](../library/stdtypes.html#bytearray "bytearray") and [`memoryview`](../library/stdtypes.html#memoryview "memoryview") types: only the exact
[`bytes`](../library/stdtypes.html#bytes "bytes") type is accepted for bytes strings.
(Contributed by Victor Stinner in [gh\-98393](https://github.com/python/cpython/issues/98393).)
* [`syslog.openlog()`](../library/syslog.html#syslog.openlog "syslog.openlog") and [`syslog.closelog()`](../library/syslog.html#syslog.closelog "syslog.closelog") now fail if used in subinterpreters.
[`syslog.syslog()`](../library/syslog.html#syslog.syslog "syslog.syslog") may still be used in subinterpreters,
but now only if [`syslog.openlog()`](../library/syslog.html#syslog.openlog "syslog.openlog") has already been called in the main interpreter.
These new restrictions do not apply to the main interpreter,
so only a very small set of users might be affected.
This change helps with interpreter isolation. Furthermore, [`syslog`](../library/syslog.html#module-syslog "syslog: An interface to the Unix syslog library routines. (Unix)") is a wrapper
around process\-global resources, which are best managed from the main interpreter.
(Contributed by Donghee Na in [gh\-99127](https://github.com/python/cpython/issues/99127).)
* The undocumented locking behavior of [`cached_property()`](../library/functools.html#functools.cached_property "functools.cached_property")
is removed, because it locked across all instances of the class, leading to high
lock contention. This means that a cached property getter function could now run
more than once for a single instance, if two threads race. For most simple
cached properties (e.g. those that are idempotent and simply calculate a value
based on other attributes of the instance) this will be fine. If
synchronization is needed, implement locking within the cached property getter
function or around multi\-threaded access points.
* [`sys._current_exceptions()`](../library/sys.html#sys._current_exceptions "sys._current_exceptions") now returns a mapping from thread\-id to an
exception instance, rather than to a `(typ, exc, tb)` tuple.
(Contributed by Irit Katriel in [gh\-103176](https://github.com/python/cpython/issues/103176).)
* When extracting tar files using [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") or
[`shutil.unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"), pass the *filter* argument to limit features
that may be surprising or dangerous.
See [Extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
* The output of the [`tokenize.tokenize()`](../library/tokenize.html#tokenize.tokenize "tokenize.tokenize") and [`tokenize.generate_tokens()`](../library/tokenize.html#tokenize.generate_tokens "tokenize.generate_tokens")
functions is now changed due to the changes introduced in [**PEP 701**](https://peps.python.org/pep-0701/). This
means that `STRING` tokens are not emitted any more for f\-strings and the
tokens described in [**PEP 701**](https://peps.python.org/pep-0701/) are now produced instead: `FSTRING_START`,
`FSTRING_MIDDLE` and `FSTRING_END` are now emitted for f\-string “string”
parts in addition to the appropriate tokens for the tokenization in the
expression components. For example for the f\-string `f"start {1+1} end"`
the old version of the tokenizer emitted:

\`\`\`
1,0\-1,18: STRING 'f"start {1\+1} end"'

\`\`\`

while the new version emits:

\`\`\`
1,0\-1,2: FSTRING\_START 'f"'
1,2\-1,8: FSTRING\_MIDDLE 'start '
1,8\-1,9: OP '{'
1,9\-1,10: NUMBER '1'
1,10\-1,11: OP '\+'
1,11\-1,12: NUMBER '1'
1,12\-1,13: OP '}'
1,13\-1,17: FSTRING\_MIDDLE ' end'
1,17\-1,18: FSTRING\_END '"'

\`\`\`

Additionally, there may be some minor behavioral changes as a consequence of the
changes required to support [**PEP 701**](https://peps.python.org/pep-0701/). Some of these changes include:

	+ The `type` attribute of the tokens emitted when tokenizing some invalid Python
	characters such as `!` has changed from `ERRORTOKEN` to `OP`.
	+ Incomplete single\-line strings now also raise [`tokenize.TokenError`](../library/tokenize.html#tokenize.TokenError "tokenize.TokenError") as incomplete
	multiline strings do.
	+ Some incomplete or invalid Python code now raises [`tokenize.TokenError`](../library/tokenize.html#tokenize.TokenError "tokenize.TokenError") instead of
	returning arbitrary `ERRORTOKEN` tokens when tokenizing it.
	+ Mixing tabs and spaces as indentation in the same file is not supported anymore and will
	raise a [`TabError`](../library/exceptions.html#TabError "TabError").
* The [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") module now expects the `_thread` module to have
an `_is_main_interpreter` attribute. It is a function with no
arguments that returns `True` if the current interpreter is the
main interpreter.

Any library or application that provides a custom `_thread` module
should provide `_is_main_interpreter()`.
(See [gh\-112826](https://github.com/python/cpython/issues/112826).)

## Build Changes[¶](#build-changes "Link to this heading")

* Python no longer uses `setup.py` to build shared C extension modules.
Build parameters like headers and libraries are detected in `configure`
script. Extensions are built by `Makefile`. Most extensions use
`pkg-config` and fall back to manual detection.
(Contributed by Christian Heimes in [gh\-93939](https://github.com/python/cpython/issues/93939).)
* `va_start()` with two parameters, like `va_start(args, format),`
is now required to build Python.
`va_start()` is no longer called with a single parameter.
(Contributed by Kumar Aditya in [gh\-93207](https://github.com/python/cpython/issues/93207).)
* CPython now uses the ThinLTO option as the default link time optimization policy
if the Clang compiler accepts the flag.
(Contributed by Donghee Na in [gh\-89536](https://github.com/python/cpython/issues/89536).)
* Add `COMPILEALL_OPTS` variable in `Makefile` to override [`compileall`](../library/compileall.html#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.")
options (default: `-j0`) in `make install`. Also merged the 3
`compileall` commands into a single command to build .pyc files for all
optimization levels (0, 1, 2\) at once.
(Contributed by Victor Stinner in [gh\-99289](https://github.com/python/cpython/issues/99289).)
* Add platform triplets for 64\-bit LoongArch:

	+ loongarch64\-linux\-gnusf
	+ loongarch64\-linux\-gnuf32
	+ loongarch64\-linux\-gnu(Contributed by Zhang Na in [gh\-90656](https://github.com/python/cpython/issues/90656).)
* `PYTHON_FOR_REGEN` now require Python 3\.10 or newer.
* Autoconf 2\.71 and aclocal 1\.16\.4 is now required to regenerate
`!configure`.
(Contributed by Christian Heimes in [gh\-89886](https://github.com/python/cpython/issues/89886).)
* Windows builds and macOS installers from python.org now use OpenSSL 3\.0\.

## C API Changes[¶](#c-api-changes "Link to this heading")

### New Features[¶](#id4 "Link to this heading")

* [**PEP 697**](https://peps.python.org/pep-0697/): Introduce the [Unstable C API tier](../c-api/stable.html#unstable-c-api),
intended for low\-level tools like debuggers and JIT compilers.
This API may change in each minor release of CPython without deprecation
warnings.
Its contents are marked by the `PyUnstable_` prefix in names.

Code object constructors:

	+ `PyUnstable_Code_New()` (renamed from `PyCode_New`)
	+ `PyUnstable_Code_NewWithPosOnlyArgs()` (renamed from `PyCode_NewWithPosOnlyArgs`)Extra storage for code objects ([**PEP 523**](https://peps.python.org/pep-0523/)):

	+ `PyUnstable_Eval_RequestCodeExtraIndex()` (renamed from `_PyEval_RequestCodeExtraIndex`)
	+ `PyUnstable_Code_GetExtra()` (renamed from `_PyCode_GetExtra`)
	+ `PyUnstable_Code_SetExtra()` (renamed from `_PyCode_SetExtra`)The original names will continue to be available until the respective
API changes.

(Contributed by Petr Viktorin in [gh\-101101](https://github.com/python/cpython/issues/101101).)
* [**PEP 697**](https://peps.python.org/pep-0697/): Add an API for extending types whose instance memory layout is
opaque:

	+ [`PyType_Spec.basicsize`](../c-api/type.html#c.PyType_Spec.basicsize "PyType_Spec.basicsize") can be zero or negative to specify
	inheriting or extending the base class size.
	+ [`PyObject_GetTypeData()`](../c-api/object.html#c.PyObject_GetTypeData "PyObject_GetTypeData") and [`PyType_GetTypeDataSize()`](../c-api/object.html#c.PyType_GetTypeDataSize "PyType_GetTypeDataSize")
	added to allow access to subclass\-specific instance data.
	+ [`Py_TPFLAGS_ITEMS_AT_END`](../c-api/typeobj.html#c.Py_TPFLAGS_ITEMS_AT_END "Py_TPFLAGS_ITEMS_AT_END") and [`PyObject_GetItemData()`](../c-api/object.html#c.PyObject_GetItemData "PyObject_GetItemData")
	added to allow safely extending certain variable\-sized types, including
	[`PyType_Type`](../c-api/type.html#c.PyType_Type "PyType_Type").
	+ [`Py_RELATIVE_OFFSET`](../c-api/structures.html#c.Py_RELATIVE_OFFSET "Py_RELATIVE_OFFSET") added to allow defining
	[`members`](../c-api/structures.html#c.PyMemberDef "PyMemberDef") in terms of a subclass\-specific struct.(Contributed by Petr Viktorin in [gh\-103509](https://github.com/python/cpython/issues/103509).)
* Add the new [limited C API](../c-api/stable.html#limited-c-api) function [`PyType_FromMetaclass()`](../c-api/type.html#c.PyType_FromMetaclass "PyType_FromMetaclass"),
which generalizes the existing [`PyType_FromModuleAndSpec()`](../c-api/type.html#c.PyType_FromModuleAndSpec "PyType_FromModuleAndSpec") using
an additional metaclass argument.
(Contributed by Wenzel Jakob in [gh\-93012](https://github.com/python/cpython/issues/93012).)
* API for creating objects that can be called using
[the vectorcall protocol](../c-api/call.html#vectorcall) was added to the
[Limited API](../c-api/stable.html#stable):

	+ [`Py_TPFLAGS_HAVE_VECTORCALL`](../c-api/typeobj.html#c.Py_TPFLAGS_HAVE_VECTORCALL "Py_TPFLAGS_HAVE_VECTORCALL")
	+ [`PyVectorcall_NARGS()`](../c-api/call.html#c.PyVectorcall_NARGS "PyVectorcall_NARGS")
	+ [`PyVectorcall_Call()`](../c-api/call.html#c.PyVectorcall_Call "PyVectorcall_Call")
	+ [`vectorcallfunc`](../c-api/call.html#c.vectorcallfunc "vectorcallfunc")The [`Py_TPFLAGS_HAVE_VECTORCALL`](../c-api/typeobj.html#c.Py_TPFLAGS_HAVE_VECTORCALL "Py_TPFLAGS_HAVE_VECTORCALL") flag is now removed from a class
when the class’s [`__call__()`](../reference/datamodel.html#object.__call__ "object.__call__") method is reassigned.
This makes vectorcall safe to use with mutable types (i.e. heap types
without the immutable flag, [`Py_TPFLAGS_IMMUTABLETYPE`](../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE "Py_TPFLAGS_IMMUTABLETYPE")).
Mutable types that do not override [`tp_call`](../c-api/typeobj.html#c.PyTypeObject.tp_call "PyTypeObject.tp_call") now
inherit the `Py_TPFLAGS_HAVE_VECTORCALL` flag.
(Contributed by Petr Viktorin in [gh\-93274](https://github.com/python/cpython/issues/93274).)

The [`Py_TPFLAGS_MANAGED_DICT`](../c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT "Py_TPFLAGS_MANAGED_DICT") and [`Py_TPFLAGS_MANAGED_WEAKREF`](../c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_WEAKREF "Py_TPFLAGS_MANAGED_WEAKREF")
flags have been added. This allows extensions classes to support object
[`__dict__`](../reference/datamodel.html#object.__dict__ "object.__dict__") and weakrefs with less bookkeeping,
using less memory and with faster access.
* API for performing calls using
[the vectorcall protocol](../c-api/call.html#vectorcall) was added to the
[Limited API](../c-api/stable.html#stable):

	+ [`PyObject_Vectorcall()`](../c-api/call.html#c.PyObject_Vectorcall "PyObject_Vectorcall")
	+ [`PyObject_VectorcallMethod()`](../c-api/call.html#c.PyObject_VectorcallMethod "PyObject_VectorcallMethod")
	+ [`PY_VECTORCALL_ARGUMENTS_OFFSET`](../c-api/call.html#c.PY_VECTORCALL_ARGUMENTS_OFFSET "PY_VECTORCALL_ARGUMENTS_OFFSET")This means that both the incoming and outgoing ends of the vector call
protocol are now available in the [Limited API](../c-api/stable.html#stable). (Contributed
by Wenzel Jakob in [gh\-98586](https://github.com/python/cpython/issues/98586).)
* Add two new public functions,
[`PyEval_SetProfileAllThreads()`](../c-api/init.html#c.PyEval_SetProfileAllThreads "PyEval_SetProfileAllThreads") and
[`PyEval_SetTraceAllThreads()`](../c-api/init.html#c.PyEval_SetTraceAllThreads "PyEval_SetTraceAllThreads"), that allow to set tracing and profiling
functions in all running threads in addition to the calling one. (Contributed
by Pablo Galindo in [gh\-93503](https://github.com/python/cpython/issues/93503).)
* Add new function [`PyFunction_SetVectorcall()`](../c-api/function.html#c.PyFunction_SetVectorcall "PyFunction_SetVectorcall") to the C API
which sets the vectorcall field of a given [`PyFunctionObject`](../c-api/function.html#c.PyFunctionObject "PyFunctionObject").
(Contributed by Andrew Frost in [gh\-92257](https://github.com/python/cpython/issues/92257).)
* The C API now permits registering callbacks via [`PyDict_AddWatcher()`](../c-api/dict.html#c.PyDict_AddWatcher "PyDict_AddWatcher"),
[`PyDict_Watch()`](../c-api/dict.html#c.PyDict_Watch "PyDict_Watch") and related APIs to be called whenever a dictionary
is modified. This is intended for use by optimizing interpreters, JIT
compilers, or debuggers.
(Contributed by Carl Meyer in [gh\-91052](https://github.com/python/cpython/issues/91052).)
* Add [`PyType_AddWatcher()`](../c-api/type.html#c.PyType_AddWatcher "PyType_AddWatcher") and [`PyType_Watch()`](../c-api/type.html#c.PyType_Watch "PyType_Watch") API to register
callbacks to receive notification on changes to a type.
(Contributed by Carl Meyer in [gh\-91051](https://github.com/python/cpython/issues/91051).)
* Add [`PyCode_AddWatcher()`](../c-api/code.html#c.PyCode_AddWatcher "PyCode_AddWatcher") and [`PyCode_ClearWatcher()`](../c-api/code.html#c.PyCode_ClearWatcher "PyCode_ClearWatcher")
APIs to register callbacks to receive notification on creation and
destruction of code objects.
(Contributed by Itamar Oren in [gh\-91054](https://github.com/python/cpython/issues/91054).)
* Add [`PyFrame_GetVar()`](../c-api/frame.html#c.PyFrame_GetVar "PyFrame_GetVar") and [`PyFrame_GetVarString()`](../c-api/frame.html#c.PyFrame_GetVarString "PyFrame_GetVarString") functions to
get a frame variable by its name.
(Contributed by Victor Stinner in [gh\-91248](https://github.com/python/cpython/issues/91248).)
* Add [`PyErr_GetRaisedException()`](../c-api/exceptions.html#c.PyErr_GetRaisedException "PyErr_GetRaisedException") and [`PyErr_SetRaisedException()`](../c-api/exceptions.html#c.PyErr_SetRaisedException "PyErr_SetRaisedException")
for saving and restoring the current exception.
These functions return and accept a single exception object,
rather than the triple arguments of the now\-deprecated
[`PyErr_Fetch()`](../c-api/exceptions.html#c.PyErr_Fetch "PyErr_Fetch") and [`PyErr_Restore()`](../c-api/exceptions.html#c.PyErr_Restore "PyErr_Restore").
This is less error prone and a bit more efficient.
(Contributed by Mark Shannon in [gh\-101578](https://github.com/python/cpython/issues/101578).)
* Add `_PyErr_ChainExceptions1`, which takes an exception instance,
to replace the legacy\-API `_PyErr_ChainExceptions`, which is now
deprecated. (Contributed by Mark Shannon in [gh\-101578](https://github.com/python/cpython/issues/101578).)
* Add [`PyException_GetArgs()`](../c-api/exceptions.html#c.PyException_GetArgs "PyException_GetArgs") and [`PyException_SetArgs()`](../c-api/exceptions.html#c.PyException_SetArgs "PyException_SetArgs")
as convenience functions for retrieving and modifying
the [`args`](../library/exceptions.html#BaseException.args "BaseException.args") passed to the exception’s constructor.
(Contributed by Mark Shannon in [gh\-101578](https://github.com/python/cpython/issues/101578).)
* Add [`PyErr_DisplayException()`](../c-api/exceptions.html#c.PyErr_DisplayException "PyErr_DisplayException"), which takes an exception instance,
to replace the legacy\-api `PyErr_Display()`. (Contributed by
Irit Katriel in [gh\-102755](https://github.com/python/cpython/issues/102755)).

* [**PEP 683**](https://peps.python.org/pep-0683/): Introduce *Immortal Objects*, which allows objects
to bypass reference counts, and related changes to the C\-API:

	+ `_Py_IMMORTAL_REFCNT`: The reference count that defines an objectas immortal.
	+ `_Py_IsImmortal` Checks if an object has the immortal reference count.
	+ `PyObject_HEAD_INIT` This will now initialize reference count to`_Py_IMMORTAL_REFCNT` when used with `Py_BUILD_CORE`.
	+ `SSTATE_INTERNED_IMMORTAL` An identifier for interned unicode objectsthat are immortal.
	+ `SSTATE_INTERNED_IMMORTAL_STATIC` An identifier for interned unicodeobjects that are immortal and static
	+ `sys.getunicodeinternedsize` This returns the total number of unicodeobjects that have been interned. This is now needed for `refleak.py` to
	correctly track reference counts and allocated blocks(Contributed by Eddie Elizondo in [gh\-84436](https://github.com/python/cpython/issues/84436).)
* [**PEP 684**](https://peps.python.org/pep-0684/): Add the new [`Py_NewInterpreterFromConfig()`](../c-api/init.html#c.Py_NewInterpreterFromConfig "Py_NewInterpreterFromConfig")
function and [`PyInterpreterConfig`](../c-api/init.html#c.PyInterpreterConfig "PyInterpreterConfig"), which may be used
to create sub\-interpreters with their own GILs.
(See [PEP 684: A Per\-Interpreter GIL](#whatsnew312-pep684) for more info.)
(Contributed by Eric Snow in [gh\-104110](https://github.com/python/cpython/issues/104110).)
* In the limited C API version 3\.12, [`Py_INCREF()`](../c-api/refcounting.html#c.Py_INCREF "Py_INCREF") and
[`Py_DECREF()`](../c-api/refcounting.html#c.Py_DECREF "Py_DECREF") functions are now implemented as opaque function calls to
hide implementation details.
(Contributed by Victor Stinner in [gh\-105387](https://github.com/python/cpython/issues/105387).)

### Porting to Python 3\.12[¶](#id5 "Link to this heading")

* Legacy Unicode APIs based on `Py_UNICODE*` representation has been removed.
Please migrate to APIs based on UTF\-8 or `wchar_t*`.
* Argument parsing functions like [`PyArg_ParseTuple()`](../c-api/arg.html#c.PyArg_ParseTuple "PyArg_ParseTuple") doesn’t support
`Py_UNICODE*` based format (e.g. `u`, `Z`) anymore. Please migrate
to other formats for Unicode like `s`, `z`, `es`, and `U`.
* `tp_weaklist` for all static builtin types is always `NULL`.
This is an internal\-only field on `PyTypeObject`
but we’re pointing out the change in case someone happens to be
accessing the field directly anyway. To avoid breakage, consider
using the existing public C\-API instead, or, if necessary, the
(internal\-only) `_PyObject_GET_WEAKREFS_LISTPTR()` macro.
* This internal\-only [`PyTypeObject.tp_subclasses`](../c-api/typeobj.html#c.PyTypeObject.tp_subclasses "PyTypeObject.tp_subclasses") may now not be
a valid object pointer. Its type was changed to void\* to
reflect this. We mention this in case someone happens to be accessing the
internal\-only field directly.

To get a list of subclasses, call the Python method
[`__subclasses__()`](../reference/datamodel.html#type.__subclasses__ "type.__subclasses__") (using [`PyObject_CallMethod()`](../c-api/call.html#c.PyObject_CallMethod "PyObject_CallMethod"),
for example).
* Add support of more formatting options (left aligning, octals, uppercase
hexadecimals, `intmax_t`, `ptrdiff_t`, `wchar_t` C
strings, variable width and precision) in [`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat") and
[`PyUnicode_FromFormatV()`](../c-api/unicode.html#c.PyUnicode_FromFormatV "PyUnicode_FromFormatV").
(Contributed by Serhiy Storchaka in [gh\-98836](https://github.com/python/cpython/issues/98836).)
* An unrecognized format character in [`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat") and
[`PyUnicode_FromFormatV()`](../c-api/unicode.html#c.PyUnicode_FromFormatV "PyUnicode_FromFormatV") now sets a [`SystemError`](../library/exceptions.html#SystemError "SystemError").
In previous versions it caused all the rest of the format string to be
copied as\-is to the result string, and any extra arguments discarded.
(Contributed by Serhiy Storchaka in [gh\-95781](https://github.com/python/cpython/issues/95781).)
* Fix wrong sign placement in [`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat") and
[`PyUnicode_FromFormatV()`](../c-api/unicode.html#c.PyUnicode_FromFormatV "PyUnicode_FromFormatV").
(Contributed by Philip Georgi in [gh\-95504](https://github.com/python/cpython/issues/95504).)
* Extension classes wanting to add a [`__dict__`](../reference/datamodel.html#object.__dict__ "object.__dict__") or weak reference slot
should use [`Py_TPFLAGS_MANAGED_DICT`](../c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT "Py_TPFLAGS_MANAGED_DICT") and
[`Py_TPFLAGS_MANAGED_WEAKREF`](../c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_WEAKREF "Py_TPFLAGS_MANAGED_WEAKREF") instead of `tp_dictoffset` and
`tp_weaklistoffset`, respectively.
The use of `tp_dictoffset` and `tp_weaklistoffset` is still
supported, but does not fully support multiple inheritance
([gh\-95589](https://github.com/python/cpython/issues/95589)), and performance may be worse.
Classes declaring [`Py_TPFLAGS_MANAGED_DICT`](../c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT "Py_TPFLAGS_MANAGED_DICT") must call
`_PyObject_VisitManagedDict()` and `_PyObject_ClearManagedDict()`
to traverse and clear their instance’s dictionaries.
To clear weakrefs, call [`PyObject_ClearWeakRefs()`](../c-api/weakref.html#c.PyObject_ClearWeakRefs "PyObject_ClearWeakRefs"), as before.
* The [`PyUnicode_FSDecoder()`](../c-api/unicode.html#c.PyUnicode_FSDecoder "PyUnicode_FSDecoder") function no longer accepts bytes\-like
paths, like [`bytearray`](../library/stdtypes.html#bytearray "bytearray") and [`memoryview`](../library/stdtypes.html#memoryview "memoryview") types: only the exact
[`bytes`](../library/stdtypes.html#bytes "bytes") type is accepted for bytes strings.
(Contributed by Victor Stinner in [gh\-98393](https://github.com/python/cpython/issues/98393).)
* The [`Py_CLEAR`](../c-api/refcounting.html#c.Py_CLEAR "Py_CLEAR"), [`Py_SETREF`](../c-api/refcounting.html#c.Py_SETREF "Py_SETREF") and [`Py_XSETREF`](../c-api/refcounting.html#c.Py_XSETREF "Py_XSETREF")
macros now only evaluate their arguments once. If an argument has side
effects, these side effects are no longer duplicated.
(Contributed by Victor Stinner in [gh\-98724](https://github.com/python/cpython/issues/98724).)
* The interpreter’s error indicator is now always normalized. This means
that [`PyErr_SetObject()`](../c-api/exceptions.html#c.PyErr_SetObject "PyErr_SetObject"), [`PyErr_SetString()`](../c-api/exceptions.html#c.PyErr_SetString "PyErr_SetString") and the other
functions that set the error indicator now normalize the exception
before storing it. (Contributed by Mark Shannon in [gh\-101578](https://github.com/python/cpython/issues/101578).)
* `_Py_RefTotal` is no longer authoritative and only kept around
for ABI compatibility. Note that it is an internal global and only
available on debug builds. If you happen to be using it then you’ll
need to start using `_Py_GetGlobalRefTotal()`.
* The following functions now select an appropriate metaclass for the newly
created type:

	+ [`PyType_FromSpec()`](../c-api/type.html#c.PyType_FromSpec "PyType_FromSpec")
	+ [`PyType_FromSpecWithBases()`](../c-api/type.html#c.PyType_FromSpecWithBases "PyType_FromSpecWithBases")
	+ [`PyType_FromModuleAndSpec()`](../c-api/type.html#c.PyType_FromModuleAndSpec "PyType_FromModuleAndSpec")Creating classes whose metaclass overrides [`tp_new`](../c-api/typeobj.html#c.PyTypeObject.tp_new "PyTypeObject.tp_new")
is deprecated, and in Python 3\.14\+ it will be disallowed.
Note that these functions ignore `tp_new` of the metaclass, possibly
allowing incomplete initialization.

Note that [`PyType_FromMetaclass()`](../c-api/type.html#c.PyType_FromMetaclass "PyType_FromMetaclass") (added in Python 3\.12\)
already disallows creating classes whose metaclass overrides `tp_new`
([`__new__()`](../reference/datamodel.html#object.__new__ "object.__new__") in Python).

Since `tp_new` overrides almost everything `PyType_From*` functions do,
the two are incompatible with each other.
The existing behavior – ignoring the metaclass for several steps
of type creation – is unsafe in general, since (meta)classes assume that
`tp_new` was called.
There is no simple general workaround. One of the following may work for you:

	+ If you control the metaclass, avoid using `tp_new` in it:

		- If initialization can be skipped, it can be done in
		[`tp_init`](../c-api/typeobj.html#c.PyTypeObject.tp_init "PyTypeObject.tp_init") instead.
		- If the metaclass doesn’t need to be instantiated from Python,
		set its `tp_new` to `NULL` using
		the [`Py_TPFLAGS_DISALLOW_INSTANTIATION`](../c-api/typeobj.html#c.Py_TPFLAGS_DISALLOW_INSTANTIATION "Py_TPFLAGS_DISALLOW_INSTANTIATION") flag.
		This makes it acceptable for `PyType_From*` functions.
	+ Avoid `PyType_From*` functions: if you don’t need C\-specific features
	(slots or setting the instance size), create types by [calling](../c-api/call.html#call)
	the metaclass.
	+ If you *know* the `tp_new` can be skipped safely, filter the deprecation
	warning out using [`warnings.catch_warnings()`](../library/warnings.html#warnings.catch_warnings "warnings.catch_warnings") from Python.
* [`PyOS_InputHook`](../c-api/veryhigh.html#c.PyOS_InputHook "PyOS_InputHook") and [`PyOS_ReadlineFunctionPointer`](../c-api/veryhigh.html#c.PyOS_ReadlineFunctionPointer "PyOS_ReadlineFunctionPointer") are no
longer called in [subinterpreters](../c-api/init.html#sub-interpreter-support). This is
because clients generally rely on process\-wide global state (since these
callbacks have no way of recovering extension module state).

This also avoids situations where extensions may find themselves running in a
subinterpreter that they don’t support (or haven’t yet been loaded in). See
[gh\-104668](https://github.com/python/cpython/issues/104668) for more info.
* [`PyLongObject`](../c-api/long.html#c.PyLongObject "PyLongObject") has had its internals changed for better performance.
Although the internals of [`PyLongObject`](../c-api/long.html#c.PyLongObject "PyLongObject") are private, they are used
by some extension modules.
The internal fields should no longer be accessed directly, instead the API
functions beginning `PyLong_...` should be used instead.
Two new *unstable* API functions are provided for efficient access to the
value of [`PyLongObject`](../c-api/long.html#c.PyLongObject "PyLongObject")s which fit into a single machine word:

	+ [`PyUnstable_Long_IsCompact()`](../c-api/long.html#c.PyUnstable_Long_IsCompact "PyUnstable_Long_IsCompact")
	+ [`PyUnstable_Long_CompactValue()`](../c-api/long.html#c.PyUnstable_Long_CompactValue "PyUnstable_Long_CompactValue")
* Custom allocators, set via [`PyMem_SetAllocator()`](../c-api/memory.html#c.PyMem_SetAllocator "PyMem_SetAllocator"), are now
required to be thread\-safe, regardless of memory domain. Allocators
that don’t have their own state, including “hooks”, are not affected.
If your custom allocator is not already thread\-safe and you need
guidance then please create a new GitHub issue
and CC `@ericsnowcurrently`.

### Deprecated[¶](#id6 "Link to this heading")

* In accordance with [**PEP 699**](https://peps.python.org/pep-0699/), the `ma_version_tag` field in [`PyDictObject`](../c-api/dict.html#c.PyDictObject "PyDictObject")
is deprecated for extension modules. Accessing this field will generate a compiler
warning at compile time. This field will be removed in Python 3\.14\.
(Contributed by Ramvikrams and Kumar Aditya in [gh\-101193](https://github.com/python/cpython/issues/101193). PEP by Ken Jin.)
* Deprecate global configuration variable:

	+ [`Py_DebugFlag`](../c-api/init.html#c.Py_DebugFlag "Py_DebugFlag"): use [`PyConfig.parser_debug`](../c-api/init_config.html#c.PyConfig.parser_debug "PyConfig.parser_debug")
	+ [`Py_VerboseFlag`](../c-api/init.html#c.Py_VerboseFlag "Py_VerboseFlag"): use [`PyConfig.verbose`](../c-api/init_config.html#c.PyConfig.verbose "PyConfig.verbose")
	+ [`Py_QuietFlag`](../c-api/init.html#c.Py_QuietFlag "Py_QuietFlag"): use [`PyConfig.quiet`](../c-api/init_config.html#c.PyConfig.quiet "PyConfig.quiet")
	+ [`Py_InteractiveFlag`](../c-api/init.html#c.Py_InteractiveFlag "Py_InteractiveFlag"): use [`PyConfig.interactive`](../c-api/init_config.html#c.PyConfig.interactive "PyConfig.interactive")
	+ [`Py_InspectFlag`](../c-api/init.html#c.Py_InspectFlag "Py_InspectFlag"): use [`PyConfig.inspect`](../c-api/init_config.html#c.PyConfig.inspect "PyConfig.inspect")
	+ [`Py_OptimizeFlag`](../c-api/init.html#c.Py_OptimizeFlag "Py_OptimizeFlag"): use [`PyConfig.optimization_level`](../c-api/init_config.html#c.PyConfig.optimization_level "PyConfig.optimization_level")
	+ [`Py_NoSiteFlag`](../c-api/init.html#c.Py_NoSiteFlag "Py_NoSiteFlag"): use [`PyConfig.site_import`](../c-api/init_config.html#c.PyConfig.site_import "PyConfig.site_import")
	+ [`Py_BytesWarningFlag`](../c-api/init.html#c.Py_BytesWarningFlag "Py_BytesWarningFlag"): use [`PyConfig.bytes_warning`](../c-api/init_config.html#c.PyConfig.bytes_warning "PyConfig.bytes_warning")
	+ [`Py_FrozenFlag`](../c-api/init.html#c.Py_FrozenFlag "Py_FrozenFlag"): use [`PyConfig.pathconfig_warnings`](../c-api/init_config.html#c.PyConfig.pathconfig_warnings "PyConfig.pathconfig_warnings")
	+ [`Py_IgnoreEnvironmentFlag`](../c-api/init.html#c.Py_IgnoreEnvironmentFlag "Py_IgnoreEnvironmentFlag"): use [`PyConfig.use_environment`](../c-api/init_config.html#c.PyConfig.use_environment "PyConfig.use_environment")
	+ [`Py_DontWriteBytecodeFlag`](../c-api/init.html#c.Py_DontWriteBytecodeFlag "Py_DontWriteBytecodeFlag"): use [`PyConfig.write_bytecode`](../c-api/init_config.html#c.PyConfig.write_bytecode "PyConfig.write_bytecode")
	+ [`Py_NoUserSiteDirectory`](../c-api/init.html#c.Py_NoUserSiteDirectory "Py_NoUserSiteDirectory"): use [`PyConfig.user_site_directory`](../c-api/init_config.html#c.PyConfig.user_site_directory "PyConfig.user_site_directory")
	+ [`Py_UnbufferedStdioFlag`](../c-api/init.html#c.Py_UnbufferedStdioFlag "Py_UnbufferedStdioFlag"): use [`PyConfig.buffered_stdio`](../c-api/init_config.html#c.PyConfig.buffered_stdio "PyConfig.buffered_stdio")
	+ [`Py_HashRandomizationFlag`](../c-api/init.html#c.Py_HashRandomizationFlag "Py_HashRandomizationFlag"): use [`PyConfig.use_hash_seed`](../c-api/init_config.html#c.PyConfig.use_hash_seed "PyConfig.use_hash_seed")
	and [`PyConfig.hash_seed`](../c-api/init_config.html#c.PyConfig.hash_seed "PyConfig.hash_seed")
	+ [`Py_IsolatedFlag`](../c-api/init.html#c.Py_IsolatedFlag "Py_IsolatedFlag"): use [`PyConfig.isolated`](../c-api/init_config.html#c.PyConfig.isolated "PyConfig.isolated")
	+ [`Py_LegacyWindowsFSEncodingFlag`](../c-api/init.html#c.Py_LegacyWindowsFSEncodingFlag "Py_LegacyWindowsFSEncodingFlag"): use [`PyPreConfig.legacy_windows_fs_encoding`](../c-api/init_config.html#c.PyPreConfig.legacy_windows_fs_encoding "PyPreConfig.legacy_windows_fs_encoding")
	+ [`Py_LegacyWindowsStdioFlag`](../c-api/init.html#c.Py_LegacyWindowsStdioFlag "Py_LegacyWindowsStdioFlag"): use [`PyConfig.legacy_windows_stdio`](../c-api/init_config.html#c.PyConfig.legacy_windows_stdio "PyConfig.legacy_windows_stdio")
	+ `Py_FileSystemDefaultEncoding`: use [`PyConfig.filesystem_encoding`](../c-api/init_config.html#c.PyConfig.filesystem_encoding "PyConfig.filesystem_encoding")
	+ `Py_HasFileSystemDefaultEncoding`: use [`PyConfig.filesystem_encoding`](../c-api/init_config.html#c.PyConfig.filesystem_encoding "PyConfig.filesystem_encoding")
	+ `Py_FileSystemDefaultEncodeErrors`: use [`PyConfig.filesystem_errors`](../c-api/init_config.html#c.PyConfig.filesystem_errors "PyConfig.filesystem_errors")
	+ `Py_UTF8Mode`: use [`PyPreConfig.utf8_mode`](../c-api/init_config.html#c.PyPreConfig.utf8_mode "PyPreConfig.utf8_mode") (see [`Py_PreInitialize()`](../c-api/init_config.html#c.Py_PreInitialize "Py_PreInitialize"))The [`Py_InitializeFromConfig()`](../c-api/init.html#c.Py_InitializeFromConfig "Py_InitializeFromConfig") API should be used with
[`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig") instead.
(Contributed by Victor Stinner in [gh\-77782](https://github.com/python/cpython/issues/77782).)
* Creating [`immutable types`](../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE "Py_TPFLAGS_IMMUTABLETYPE") with mutable
bases is deprecated and will be disabled in Python 3\.14\. ([gh\-95388](https://github.com/python/cpython/issues/95388))
* The `structmember.h` header is deprecated, though it continues to be
available and there are no plans to remove it.

Its contents are now available just by including `Python.h`,
with a `Py` prefix added if it was missing:

	+ [`PyMemberDef`](../c-api/structures.html#c.PyMemberDef "PyMemberDef"), [`PyMember_GetOne()`](../c-api/structures.html#c.PyMember_GetOne "PyMember_GetOne") and
	[`PyMember_SetOne()`](../c-api/structures.html#c.PyMember_SetOne "PyMember_SetOne")
	+ Type macros like [`Py_T_INT`](../c-api/structures.html#c.Py_T_INT "Py_T_INT"), [`Py_T_DOUBLE`](../c-api/structures.html#c.Py_T_DOUBLE "Py_T_DOUBLE"), etc.
	(previously `T_INT`, `T_DOUBLE`, etc.)
	+ The flags [`Py_READONLY`](../c-api/structures.html#c.Py_READONLY "Py_READONLY") (previously `READONLY`) and
	[`Py_AUDIT_READ`](../c-api/structures.html#c.Py_AUDIT_READ "Py_AUDIT_READ") (previously all uppercase)Several items are not exposed from `Python.h`:

	+ [`T_OBJECT`](../c-api/structures.html#c.T_OBJECT "T_OBJECT") (use [`Py_T_OBJECT_EX`](../c-api/structures.html#c.Py_T_OBJECT_EX "Py_T_OBJECT_EX"))
	+ [`T_NONE`](../c-api/structures.html#c.T_NONE "T_NONE") (previously undocumented, and pretty quirky)
	+ The macro `WRITE_RESTRICTED` which does nothing.
	+ The macros `RESTRICTED` and `READ_RESTRICTED`, equivalents of
	[`Py_AUDIT_READ`](../c-api/structures.html#c.Py_AUDIT_READ "Py_AUDIT_READ").
	+ In some configurations, `` is not included from `Python.h`.
	It should be included manually when using `offsetof()`.The deprecated header continues to provide its original
contents under the original names.
Your old code can stay unchanged, unless the extra include and non\-namespaced
macros bother you greatly.

(Contributed in [gh\-47146](https://github.com/python/cpython/issues/47146) by Petr Viktorin, based on
earlier work by Alexander Belopolsky and Matthias Braun.)
* [`PyErr_Fetch()`](../c-api/exceptions.html#c.PyErr_Fetch "PyErr_Fetch") and [`PyErr_Restore()`](../c-api/exceptions.html#c.PyErr_Restore "PyErr_Restore") are deprecated.
Use [`PyErr_GetRaisedException()`](../c-api/exceptions.html#c.PyErr_GetRaisedException "PyErr_GetRaisedException") and
[`PyErr_SetRaisedException()`](../c-api/exceptions.html#c.PyErr_SetRaisedException "PyErr_SetRaisedException") instead.
(Contributed by Mark Shannon in [gh\-101578](https://github.com/python/cpython/issues/101578).)
* `PyErr_Display()` is deprecated. Use [`PyErr_DisplayException()`](../c-api/exceptions.html#c.PyErr_DisplayException "PyErr_DisplayException")
instead. (Contributed by Irit Katriel in [gh\-102755](https://github.com/python/cpython/issues/102755)).
* `_PyErr_ChainExceptions` is deprecated. Use `_PyErr_ChainExceptions1`
instead. (Contributed by Irit Katriel in [gh\-102192](https://github.com/python/cpython/issues/102192).)
* Using [`PyType_FromSpec()`](../c-api/type.html#c.PyType_FromSpec "PyType_FromSpec"), [`PyType_FromSpecWithBases()`](../c-api/type.html#c.PyType_FromSpecWithBases "PyType_FromSpecWithBases")
or [`PyType_FromModuleAndSpec()`](../c-api/type.html#c.PyType_FromModuleAndSpec "PyType_FromModuleAndSpec") to create a class whose metaclass
overrides [`tp_new`](../c-api/typeobj.html#c.PyTypeObject.tp_new "PyTypeObject.tp_new") is deprecated.
Call the metaclass instead.

#### Pending Removal in Python 3\.14[¶](#id7 "Link to this heading")

* The `ma_version_tag` field in [`PyDictObject`](../c-api/dict.html#c.PyDictObject "PyDictObject") for extension modules
([**PEP 699**](https://peps.python.org/pep-0699/); [gh\-101193](https://github.com/python/cpython/issues/101193)).
* Creating [`immutable types`](../c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE "Py_TPFLAGS_IMMUTABLETYPE") with mutable
bases ([gh\-95388](https://github.com/python/cpython/issues/95388)).
* Functions to configure Python’s initialization, deprecated in Python 3\.11:

	+ `PySys_SetArgvEx()`:
	Set [`PyConfig.argv`](../c-api/init_config.html#c.PyConfig.argv "PyConfig.argv") instead.
	+ `PySys_SetArgv()`:
	Set [`PyConfig.argv`](../c-api/init_config.html#c.PyConfig.argv "PyConfig.argv") instead.
	+ `Py_SetProgramName()`:
	Set [`PyConfig.program_name`](../c-api/init_config.html#c.PyConfig.program_name "PyConfig.program_name") instead.
	+ `Py_SetPythonHome()`:
	Set [`PyConfig.home`](../c-api/init_config.html#c.PyConfig.home "PyConfig.home") instead.The [`Py_InitializeFromConfig()`](../c-api/init.html#c.Py_InitializeFromConfig "Py_InitializeFromConfig") API should be used with
[`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig") instead.
* Global configuration variables:

	+ [`Py_DebugFlag`](../c-api/init.html#c.Py_DebugFlag "Py_DebugFlag"):
	Use [`PyConfig.parser_debug`](../c-api/init_config.html#c.PyConfig.parser_debug "PyConfig.parser_debug") instead.
	+ [`Py_VerboseFlag`](../c-api/init.html#c.Py_VerboseFlag "Py_VerboseFlag"):
	Use [`PyConfig.verbose`](../c-api/init_config.html#c.PyConfig.verbose "PyConfig.verbose") instead.
	+ [`Py_QuietFlag`](../c-api/init.html#c.Py_QuietFlag "Py_QuietFlag"):
	Use [`PyConfig.quiet`](../c-api/init_config.html#c.PyConfig.quiet "PyConfig.quiet") instead.
	+ [`Py_InteractiveFlag`](../c-api/init.html#c.Py_InteractiveFlag "Py_InteractiveFlag"):
	Use [`PyConfig.interactive`](../c-api/init_config.html#c.PyConfig.interactive "PyConfig.interactive") instead.
	+ [`Py_InspectFlag`](../c-api/init.html#c.Py_InspectFlag "Py_InspectFlag"):
	Use [`PyConfig.inspect`](../c-api/init_config.html#c.PyConfig.inspect "PyConfig.inspect") instead.
	+ [`Py_OptimizeFlag`](../c-api/init.html#c.Py_OptimizeFlag "Py_OptimizeFlag"):
	Use [`PyConfig.optimization_level`](../c-api/init_config.html#c.PyConfig.optimization_level "PyConfig.optimization_level") instead.
	+ [`Py_NoSiteFlag`](../c-api/init.html#c.Py_NoSiteFlag "Py_NoSiteFlag"):
	Use [`PyConfig.site_import`](../c-api/init_config.html#c.PyConfig.site_import "PyConfig.site_import") instead.
	+ [`Py_BytesWarningFlag`](../c-api/init.html#c.Py_BytesWarningFlag "Py_BytesWarningFlag"):
	Use [`PyConfig.bytes_warning`](../c-api/init_config.html#c.PyConfig.bytes_warning "PyConfig.bytes_warning") instead.
	+ [`Py_FrozenFlag`](../c-api/init.html#c.Py_FrozenFlag "Py_FrozenFlag"):
	Use [`PyConfig.pathconfig_warnings`](../c-api/init_config.html#c.PyConfig.pathconfig_warnings "PyConfig.pathconfig_warnings") instead.
	+ [`Py_IgnoreEnvironmentFlag`](../c-api/init.html#c.Py_IgnoreEnvironmentFlag "Py_IgnoreEnvironmentFlag"):
	Use [`PyConfig.use_environment`](../c-api/init_config.html#c.PyConfig.use_environment "PyConfig.use_environment") instead.
	+ [`Py_DontWriteBytecodeFlag`](../c-api/init.html#c.Py_DontWriteBytecodeFlag "Py_DontWriteBytecodeFlag"):
	Use [`PyConfig.write_bytecode`](../c-api/init_config.html#c.PyConfig.write_bytecode "PyConfig.write_bytecode") instead.
	+ [`Py_NoUserSiteDirectory`](../c-api/init.html#c.Py_NoUserSiteDirectory "Py_NoUserSiteDirectory"):
	Use [`PyConfig.user_site_directory`](../c-api/init_config.html#c.PyConfig.user_site_directory "PyConfig.user_site_directory") instead.
	+ [`Py_UnbufferedStdioFlag`](../c-api/init.html#c.Py_UnbufferedStdioFlag "Py_UnbufferedStdioFlag"):
	Use [`PyConfig.buffered_stdio`](../c-api/init_config.html#c.PyConfig.buffered_stdio "PyConfig.buffered_stdio") instead.
	+ [`Py_HashRandomizationFlag`](../c-api/init.html#c.Py_HashRandomizationFlag "Py_HashRandomizationFlag"):
	Use [`PyConfig.use_hash_seed`](../c-api/init_config.html#c.PyConfig.use_hash_seed "PyConfig.use_hash_seed")
	and [`PyConfig.hash_seed`](../c-api/init_config.html#c.PyConfig.hash_seed "PyConfig.hash_seed") instead.
	+ [`Py_IsolatedFlag`](../c-api/init.html#c.Py_IsolatedFlag "Py_IsolatedFlag"):
	Use [`PyConfig.isolated`](../c-api/init_config.html#c.PyConfig.isolated "PyConfig.isolated") instead.
	+ [`Py_LegacyWindowsFSEncodingFlag`](../c-api/init.html#c.Py_LegacyWindowsFSEncodingFlag "Py_LegacyWindowsFSEncodingFlag"):
	Use [`PyPreConfig.legacy_windows_fs_encoding`](../c-api/init_config.html#c.PyPreConfig.legacy_windows_fs_encoding "PyPreConfig.legacy_windows_fs_encoding") instead.
	+ [`Py_LegacyWindowsStdioFlag`](../c-api/init.html#c.Py_LegacyWindowsStdioFlag "Py_LegacyWindowsStdioFlag"):
	Use [`PyConfig.legacy_windows_stdio`](../c-api/init_config.html#c.PyConfig.legacy_windows_stdio "PyConfig.legacy_windows_stdio") instead.
	+ `Py_FileSystemDefaultEncoding`:
	Use [`PyConfig.filesystem_encoding`](../c-api/init_config.html#c.PyConfig.filesystem_encoding "PyConfig.filesystem_encoding") instead.
	+ `Py_HasFileSystemDefaultEncoding`:
	Use [`PyConfig.filesystem_encoding`](../c-api/init_config.html#c.PyConfig.filesystem_encoding "PyConfig.filesystem_encoding") instead.
	+ `Py_FileSystemDefaultEncodeErrors`:
	Use [`PyConfig.filesystem_errors`](../c-api/init_config.html#c.PyConfig.filesystem_errors "PyConfig.filesystem_errors") instead.
	+ `Py_UTF8Mode`:
	Use [`PyPreConfig.utf8_mode`](../c-api/init_config.html#c.PyPreConfig.utf8_mode "PyPreConfig.utf8_mode") instead.
	(see [`Py_PreInitialize()`](../c-api/init_config.html#c.Py_PreInitialize "Py_PreInitialize"))The [`Py_InitializeFromConfig()`](../c-api/init.html#c.Py_InitializeFromConfig "Py_InitializeFromConfig") API should be used with
[`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig") instead.

#### Pending Removal in Python 3\.15[¶](#id8 "Link to this heading")

* The bundled copy of `libmpdecimal`.
* The [`PyImport_ImportModuleNoBlock()`](../c-api/import.html#c.PyImport_ImportModuleNoBlock "PyImport_ImportModuleNoBlock"):
Use [`PyImport_ImportModule()`](../c-api/import.html#c.PyImport_ImportModule "PyImport_ImportModule") instead.
* [`PyWeakref_GetObject()`](../c-api/weakref.html#c.PyWeakref_GetObject "PyWeakref_GetObject") and [`PyWeakref_GET_OBJECT()`](../c-api/weakref.html#c.PyWeakref_GET_OBJECT "PyWeakref_GET_OBJECT"):
Use [`PyWeakref_GetRef()`](../c-api/weakref.html#c.PyWeakref_GetRef "PyWeakref_GetRef") instead.
* [`Py_UNICODE`](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE") type and the `Py_UNICODE_WIDE` macro:
Use `wchar_t` instead.
* Python initialization functions:

	+ [`PySys_ResetWarnOptions()`](../c-api/sys.html#c.PySys_ResetWarnOptions "PySys_ResetWarnOptions"):
	Clear [`sys.warnoptions`](../library/sys.html#sys.warnoptions "sys.warnoptions") and `warnings.filters` instead.
	+ [`Py_GetExecPrefix()`](../c-api/init.html#c.Py_GetExecPrefix "Py_GetExecPrefix"):
	Get [`sys.base_exec_prefix`](../library/sys.html#sys.base_exec_prefix "sys.base_exec_prefix") and [`sys.exec_prefix`](../library/sys.html#sys.exec_prefix "sys.exec_prefix") instead.
	+ [`Py_GetPath()`](../c-api/init.html#c.Py_GetPath "Py_GetPath"):
	Get [`sys.path`](../library/sys.html#sys.path "sys.path") instead.
	+ [`Py_GetPrefix()`](../c-api/init.html#c.Py_GetPrefix "Py_GetPrefix"):
	Get [`sys.base_prefix`](../library/sys.html#sys.base_prefix "sys.base_prefix") and [`sys.prefix`](../library/sys.html#sys.prefix "sys.prefix") instead.
	+ [`Py_GetProgramFullPath()`](../c-api/init.html#c.Py_GetProgramFullPath "Py_GetProgramFullPath"):
	Get [`sys.executable`](../library/sys.html#sys.executable "sys.executable") instead.
	+ [`Py_GetProgramName()`](../c-api/init.html#c.Py_GetProgramName "Py_GetProgramName"):
	Get [`sys.executable`](../library/sys.html#sys.executable "sys.executable") instead.
	+ [`Py_GetPythonHome()`](../c-api/init.html#c.Py_GetPythonHome "Py_GetPythonHome"):
	Get [`PyConfig.home`](../c-api/init_config.html#c.PyConfig.home "PyConfig.home")
	or the [`PYTHONHOME`](../using/cmdline.html#envvar-PYTHONHOME) environment variable instead.

#### Pending Removal in Future Versions[¶](#id9 "Link to this heading")

The following APIs are deprecated and will be removed,
although there is currently no date scheduled for their removal.

* [`Py_TPFLAGS_HAVE_FINALIZE`](../c-api/typeobj.html#c.Py_TPFLAGS_HAVE_FINALIZE "Py_TPFLAGS_HAVE_FINALIZE"):
Unneeded since Python 3\.8\.
* [`PyErr_Fetch()`](../c-api/exceptions.html#c.PyErr_Fetch "PyErr_Fetch"):
Use [`PyErr_GetRaisedException()`](../c-api/exceptions.html#c.PyErr_GetRaisedException "PyErr_GetRaisedException") instead.
* [`PyErr_NormalizeException()`](../c-api/exceptions.html#c.PyErr_NormalizeException "PyErr_NormalizeException"):
Use [`PyErr_GetRaisedException()`](../c-api/exceptions.html#c.PyErr_GetRaisedException "PyErr_GetRaisedException") instead.
* [`PyErr_Restore()`](../c-api/exceptions.html#c.PyErr_Restore "PyErr_Restore"):
Use [`PyErr_SetRaisedException()`](../c-api/exceptions.html#c.PyErr_SetRaisedException "PyErr_SetRaisedException") instead.
* [`PyModule_GetFilename()`](../c-api/module.html#c.PyModule_GetFilename "PyModule_GetFilename"):
Use [`PyModule_GetFilenameObject()`](../c-api/module.html#c.PyModule_GetFilenameObject "PyModule_GetFilenameObject") instead.
* [`PyOS_AfterFork()`](../c-api/sys.html#c.PyOS_AfterFork "PyOS_AfterFork"):
Use [`PyOS_AfterFork_Child()`](../c-api/sys.html#c.PyOS_AfterFork_Child "PyOS_AfterFork_Child") instead.
* [`PySlice_GetIndicesEx()`](../c-api/slice.html#c.PySlice_GetIndicesEx "PySlice_GetIndicesEx"):
Use [`PySlice_Unpack()`](../c-api/slice.html#c.PySlice_Unpack "PySlice_Unpack") and [`PySlice_AdjustIndices()`](../c-api/slice.html#c.PySlice_AdjustIndices "PySlice_AdjustIndices") instead.
* `PyUnicode_AsDecodedObject()`:
Use [`PyCodec_Decode()`](../c-api/codec.html#c.PyCodec_Decode "PyCodec_Decode") instead.
* `PyUnicode_AsDecodedUnicode()`:
Use [`PyCodec_Decode()`](../c-api/codec.html#c.PyCodec_Decode "PyCodec_Decode") instead.
* `PyUnicode_AsEncodedObject()`:
Use [`PyCodec_Encode()`](../c-api/codec.html#c.PyCodec_Encode "PyCodec_Encode") instead.
* `PyUnicode_AsEncodedUnicode()`:
Use [`PyCodec_Encode()`](../c-api/codec.html#c.PyCodec_Encode "PyCodec_Encode") instead.
* [`PyUnicode_READY()`](../c-api/unicode.html#c.PyUnicode_READY "PyUnicode_READY"):
Unneeded since Python 3\.12
* `PyErr_Display()`:
Use [`PyErr_DisplayException()`](../c-api/exceptions.html#c.PyErr_DisplayException "PyErr_DisplayException") instead.
* `_PyErr_ChainExceptions()`:
Use `_PyErr_ChainExceptions1()` instead.
* `PyBytesObject.ob_shash` member:
call [`PyObject_Hash()`](../c-api/object.html#c.PyObject_Hash "PyObject_Hash") instead.
* `PyDictObject.ma_version_tag` member.
* Thread Local Storage (TLS) API:

	+ [`PyThread_create_key()`](../c-api/init.html#c.PyThread_create_key "PyThread_create_key"):
	Use [`PyThread_tss_alloc()`](../c-api/init.html#c.PyThread_tss_alloc "PyThread_tss_alloc") instead.
	+ [`PyThread_delete_key()`](../c-api/init.html#c.PyThread_delete_key "PyThread_delete_key"):
	Use [`PyThread_tss_free()`](../c-api/init.html#c.PyThread_tss_free "PyThread_tss_free") instead.
	+ [`PyThread_set_key_value()`](../c-api/init.html#c.PyThread_set_key_value "PyThread_set_key_value"):
	Use [`PyThread_tss_set()`](../c-api/init.html#c.PyThread_tss_set "PyThread_tss_set") instead.
	+ [`PyThread_get_key_value()`](../c-api/init.html#c.PyThread_get_key_value "PyThread_get_key_value"):
	Use [`PyThread_tss_get()`](../c-api/init.html#c.PyThread_tss_get "PyThread_tss_get") instead.
	+ [`PyThread_delete_key_value()`](../c-api/init.html#c.PyThread_delete_key_value "PyThread_delete_key_value"):
	Use [`PyThread_tss_delete()`](../c-api/init.html#c.PyThread_tss_delete "PyThread_tss_delete") instead.
	+ [`PyThread_ReInitTLS()`](../c-api/init.html#c.PyThread_ReInitTLS "PyThread_ReInitTLS"):
	Unneeded since Python 3\.7\.

### Removed[¶](#id10 "Link to this heading")

* Remove the `token.h` header file. There was never any public tokenizer C
API. The `token.h` header file was only designed to be used by Python
internals.
(Contributed by Victor Stinner in [gh\-92651](https://github.com/python/cpython/issues/92651).)
* Legacy Unicode APIs have been removed. See [**PEP 623**](https://peps.python.org/pep-0623/) for detail.

	+ `PyUnicode_WCHAR_KIND`
	+ `PyUnicode_AS_UNICODE()`
	+ `PyUnicode_AsUnicode()`
	+ `PyUnicode_AsUnicodeAndSize()`
	+ `PyUnicode_AS_DATA()`
	+ `PyUnicode_FromUnicode()`
	+ `PyUnicode_GET_SIZE()`
	+ `PyUnicode_GetSize()`
	+ `PyUnicode_GET_DATA_SIZE()`
* Remove the `PyUnicode_InternImmortal()` function macro.
(Contributed by Victor Stinner in [gh\-85858](https://github.com/python/cpython/issues/85858).)

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.12](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [PEP 695: Type Parameter Syntax](#pep-695-type-parameter-syntax)
		- [PEP 701: Syntactic formalization of f\-strings](#pep-701-syntactic-formalization-of-f-strings)
		- [PEP 684: A Per\-Interpreter GIL](#pep-684-a-per-interpreter-gil)
		- [PEP 669: Low impact monitoring for CPython](#pep-669-low-impact-monitoring-for-cpython)
		- [PEP 688: Making the buffer protocol accessible in Python](#pep-688-making-the-buffer-protocol-accessible-in-python)
		- [PEP 709: Comprehension inlining](#pep-709-comprehension-inlining)
		- [Improved Error Messages](#improved-error-messages)
	+ [New Features Related to Type Hints](#new-features-related-to-type-hints)
		- [PEP 692: Using `TypedDict` for more precise `**kwargs` typing](#pep-692-using-typeddict-for-more-precise-kwargs-typing)
		- [PEP 698: Override Decorator for Static Typing](#pep-698-override-decorator-for-static-typing)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
	+ [Improved Modules](#improved-modules)
		- [array](#array)
		- [asyncio](#asyncio)
		- [calendar](#calendar)
		- [csv](#csv)
		- [dis](#dis)
		- [fractions](#fractions)
		- [importlib.resources](#importlib-resources)
		- [inspect](#inspect)
		- [itertools](#itertools)
		- [math](#math)
		- [os](#os)
		- [os.path](#os-path)
		- [pathlib](#pathlib)
		- [pdb](#pdb)
		- [random](#random)
		- [shutil](#shutil)
		- [sqlite3](#sqlite3)
		- [statistics](#statistics)
		- [sys](#sys)
		- [tempfile](#tempfile)
		- [threading](#threading)
		- [tkinter](#tkinter)
		- [tokenize](#tokenize)
		- [types](#types)
		- [typing](#typing)
		- [unicodedata](#unicodedata)
		- [unittest](#unittest)
		- [uuid](#uuid)
	+ [Optimizations](#optimizations)
	+ [CPython bytecode changes](#cpython-bytecode-changes)
	+ [Demos and Tools](#demos-and-tools)
	+ [Deprecated](#deprecated)
		- [Pending Removal in Python 3\.13](#pending-removal-in-python-3-13)
		- [Pending Removal in Python 3\.14](#pending-removal-in-python-3-14)
		- [Pending Removal in Python 3\.15](#pending-removal-in-python-3-15)
		- [Pending removal in Python 3\.16](#pending-removal-in-python-3-16)
		- [Pending Removal in Future Versions](#pending-removal-in-future-versions)
	+ [Removed](#removed)
		- [asynchat and asyncore](#asynchat-and-asyncore)
		- [configparser](#configparser)
		- [distutils](#distutils)
		- [ensurepip](#ensurepip)
		- [enum](#enum)
		- [ftplib](#ftplib)
		- [gzip](#gzip)
		- [hashlib](#hashlib)
		- [importlib](#importlib)
		- [imp](#imp)
		- [io](#io)
		- [locale](#locale)
		- [smtpd](#smtpd)
		- [sqlite3](#id2)
		- [ssl](#ssl)
		- [unittest](#id3)
		- [webbrowser](#webbrowser)
		- [xml.etree.ElementTree](#xml-etree-elementtree)
		- [zipimport](#zipimport)
		- [Others](#others)
	+ [Porting to Python 3\.12](#porting-to-python-3-12)
		- [Changes in the Python API](#changes-in-the-python-api)
	+ [Build Changes](#build-changes)
	+ [C API Changes](#c-api-changes)
		- [New Features](#id4)
		- [Porting to Python 3\.12](#id5)
		- [Deprecated](#id6)
			* [Pending Removal in Python 3\.14](#id7)
			* [Pending Removal in Python 3\.15](#id8)
			* [Pending Removal in Future Versions](#id9)
		- [Removed](#id10)

#### Previous topic

[What’s New In Python 3\.13](3.13.html "previous chapter")

#### Next topic

[What’s New In Python 3\.11](3.11.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.12.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.11.html "What’s New In Python 3.11") \|
* [previous](3.13.html "What’s New In Python 3.13") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.12
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.13 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.13.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.12.html "What’s New In Python 3.12") \|
* [previous](index.html "What’s New in Python") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.13
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.13[¶](#what-s-new-in-python-3-13 "Link to this heading")

Editors:
Adam Turner and Thomas Wouters

This article explains the new features in Python 3\.13, compared to 3\.12\.
Python 3\.13 was released on October 7, 2024\.
For full details, see the [changelog](changelog.html#changelog).

See also

[**PEP 719**](https://peps.python.org/pep-0719/) – Python 3\.13 Release Schedule

## Summary – Release Highlights[¶](#summary-release-highlights "Link to this heading")

Python 3\.13 is the latest stable release of the Python programming
language, with a mix of changes to the language, the implementation
and the standard library.
The biggest changes include a new [interactive interpreter](#whatsnew313-better-interactive-interpreter),
experimental support for running in a [free\-threaded mode](#whatsnew313-free-threaded-cpython) ([**PEP 703**](https://peps.python.org/pep-0703/)),
and a [Just\-In\-Time compiler](#whatsnew313-jit-compiler) ([**PEP 744**](https://peps.python.org/pep-0744/)).

Error messages continue to improve, with tracebacks now highlighted in color
by default. The [`locals()`](../library/functions.html#locals "locals") builtin now has [defined semantics](#whatsnew313-locals-semantics) for changing the returned mapping,
and type parameters now support default values.

The library changes contain removal of deprecated APIs and modules,
as well as the usual improvements in user\-friendliness and correctness.
Several legacy standard library modules have now [been removed](#whatsnew313-pep594) following their deprecation in Python 3\.11 ([**PEP 594**](https://peps.python.org/pep-0594/)).

This article doesn’t attempt to provide a complete specification
of all new features, but instead gives a convenient overview.
For full details refer to the documentation,
such as the [Library Reference](../library/index.html#library-index)
and [Language Reference](../reference/index.html#reference-index).
To understand the complete implementation and design rationale for a change,
refer to the PEP for a particular new feature;
but note that PEPs usually are not kept up\-to\-date
once a feature has been fully implemented.
See [Porting to Python 3\.13](#porting-to-python-3-13) for guidance on upgrading from
earlier versions of Python.

---

Interpreter improvements:

* A greatly improved [interactive interpreter](#whatsnew313-better-interactive-interpreter) and
[improved error messages](#whatsnew313-improved-error-messages).
* [**PEP 667**](https://peps.python.org/pep-0667/): The [`locals()`](../library/functions.html#locals "locals") builtin now has
[defined semantics](#whatsnew313-locals-semantics) when mutating the
returned mapping. Python debuggers and similar tools may now more reliably
update local variables in optimized scopes even during concurrent code
execution.
* [**PEP 703**](https://peps.python.org/pep-0703/): CPython 3\.13 has experimental support for running with the
[global interpreter lock](../glossary.html#term-global-interpreter-lock) disabled. See [Free\-threaded CPython](#whatsnew313-free-threaded-cpython) for more details.
* [**PEP 744**](https://peps.python.org/pep-0744/): A basic [JIT compiler](#whatsnew313-jit-compiler) was added.
It is currently disabled by default (though we may turn it on later).
Performance improvements are modest – we expect to improve this
over the next few releases.
* Color support in the new [interactive interpreter](#whatsnew313-better-interactive-interpreter),
as well as in [tracebacks](#whatsnew313-improved-error-messages)
and [doctest](#whatsnew313-doctest) output.
This can be disabled through the [`PYTHON_COLORS`](../using/cmdline.html#envvar-PYTHON_COLORS) and [`NO_COLOR`](https://no-color.org/)
environment variables.

Python data model improvements:

* [`__static_attributes__`](../reference/datamodel.html#type.__static_attributes__ "type.__static_attributes__") stores the names of attributes accessed
through `self.X` in any function in a class body.
* [`__firstlineno__`](../reference/datamodel.html#type.__firstlineno__ "type.__firstlineno__") records the first line number of a class
definition.

Significant improvements in the standard library:

* Add a new [`PythonFinalizationError`](../library/exceptions.html#PythonFinalizationError "PythonFinalizationError") exception, raised when an operation
is blocked during [finalization](../glossary.html#term-interpreter-shutdown).
* The [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") module now supports deprecating command\-line options,
positional arguments, and subcommands.
* The new functions [`base64.z85encode()`](../library/base64.html#base64.z85encode "base64.z85encode") and [`base64.z85decode()`](../library/base64.html#base64.z85decode "base64.z85decode")
support encoding and decoding [Z85 data](https://rfc.zeromq.org/spec/32/).
* The [`copy`](../library/copy.html#module-copy "copy: Shallow and deep copy operations.") module now has a [`copy.replace()`](../library/copy.html#copy.replace "copy.replace") function,
with support for many builtin types and any class defining
the [`__replace__()`](../library/copy.html#object.__replace__ "object.__replace__") method.
* The new [`dbm.sqlite3`](../library/dbm.html#module-dbm.sqlite3 "dbm.sqlite3: SQLite backend for dbm (All)") module is now the default [`dbm`](../library/dbm.html#module-dbm "dbm: Interfaces to various Unix \"database\" formats.") backend.
* The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module has a [suite of new functions](../library/os.html#os-timerfd)
for working with Linux’s timer notification file descriptors.
* The [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions.") module now has a [command\-line interface](../library/random.html#random-cli).

Security improvements:

* [`ssl.create_default_context()`](../library/ssl.html#ssl.create_default_context "ssl.create_default_context") sets [`ssl.VERIFY_X509_PARTIAL_CHAIN`](../library/ssl.html#ssl.VERIFY_X509_PARTIAL_CHAIN "ssl.VERIFY_X509_PARTIAL_CHAIN")
and [`ssl.VERIFY_X509_STRICT`](../library/ssl.html#ssl.VERIFY_X509_STRICT "ssl.VERIFY_X509_STRICT") as default flags.

C API improvements:

* The [`Py_mod_gil`](../c-api/module.html#c.Py_mod_gil "Py_mod_gil") slot is now used to indicate that
an extension module supports running with the [GIL](../glossary.html#term-GIL) disabled.
* The [PyTime C API](../c-api/time.html) has been added,
providing access to system clocks.
* [`PyMutex`](../c-api/init.html#c.PyMutex "PyMutex") is a new lightweight mutex that occupies a single byte.
* There is a new [suite of functions](../c-api/monitoring.html#c-api-monitoring)
for generating [**PEP 669**](https://peps.python.org/pep-0669/) monitoring events in the C API.

New typing features:

* [**PEP 696**](https://peps.python.org/pep-0696/): Type parameters ([`typing.TypeVar`](../library/typing.html#typing.TypeVar "typing.TypeVar"), [`typing.ParamSpec`](../library/typing.html#typing.ParamSpec "typing.ParamSpec"),
and [`typing.TypeVarTuple`](../library/typing.html#typing.TypeVarTuple "typing.TypeVarTuple")) now support defaults.
* [**PEP 702**](https://peps.python.org/pep-0702/): The new [`warnings.deprecated()`](../library/warnings.html#warnings.deprecated "warnings.deprecated") decorator adds support
for marking deprecations in the type system and at runtime.
* [**PEP 705**](https://peps.python.org/pep-0705/): [`typing.ReadOnly`](../library/typing.html#typing.ReadOnly "typing.ReadOnly") can be used to mark an item of a
[`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") as read\-only for type checkers.
* [**PEP 742**](https://peps.python.org/pep-0742/): [`typing.TypeIs`](../library/typing.html#typing.TypeIs "typing.TypeIs") provides more intuitive
type narrowing behavior, as an alternative to [`typing.TypeGuard`](../library/typing.html#typing.TypeGuard "typing.TypeGuard").

Platform support:

* [**PEP 730**](https://peps.python.org/pep-0730/): Apple’s iOS is now an [officially supported platform](#whatsnew313-platform-support), at [**tier 3**](https://peps.python.org/pep-0011/#tier-3).
* [**PEP 738**](https://peps.python.org/pep-0738/): Android is now an [officially supported platform](#whatsnew313-platform-support), at [**tier 3**](https://peps.python.org/pep-0011/#tier-3).
* `wasm32-wasi` is now supported as a [**tier 2**](https://peps.python.org/pep-0011/#tier-2) platform.
* `wasm32-emscripten` is no longer an officially supported platform.

Important removals:

* [PEP 594](#whatsnew313-pep594): The remaining 19 “dead batteries”
(legacy stdlib modules) have been removed from the standard library:
`aifc`, `audioop`, `cgi`, `cgitb`, `chunk`,
`crypt`, `imghdr`, `mailcap`, `msilib`, `nis`,
`nntplib`, `ossaudiodev`, `pipes`, `sndhdr`,
`spwd`, `sunau`, `telnetlib`, `uu` and `xdrlib`.
* Remove the **2to3** tool and `lib2to3` module
(deprecated in Python 3\.11\).
* Remove the `tkinter.tix` module (deprecated in Python 3\.6\).
* Remove the `locale.resetlocale()` function.
* Remove the `typing.io` and `typing.re` namespaces.
* Remove chained [`classmethod`](../library/functions.html#classmethod "classmethod") descriptors.

Release schedule changes:

[**PEP 602**](https://peps.python.org/pep-0602/) (“Annual Release Cycle for Python”) has been updated
to extend the full support (‘bugfix’) period for new releases to two years.
This updated policy means that:

* Python 3\.9–3\.12 have one and a half years of full support,
followed by three and a half years of security fixes.
* Python 3\.13 and later have two years of full support,
followed by three years of security fixes.

## New Features[¶](#new-features "Link to this heading")

### A better interactive interpreter[¶](#a-better-interactive-interpreter "Link to this heading")

Python now uses a new [interactive](../glossary.html#term-interactive) shell by default, based on code
from the [PyPy project](https://pypy.org/).
When the user starts the [REPL](../glossary.html#term-REPL) from an interactive terminal,
the following new features are now supported:

* Multiline editing with history preservation.
* Direct support for REPL\-specific commands like `help`, `exit`,
and `quit`, without the need to call them as functions.
* Prompts and tracebacks with [color enabled by default](../using/cmdline.html#using-on-controlling-color).
* Interactive help browsing using `F1` with a separate command
history.
* History browsing using `F2` that skips output as well as the
[\>\>\>](../glossary.html#term-0) and […](../glossary.html#term-...) prompts.
* “Paste mode” with `F3` that makes pasting larger blocks of code
easier (press `F3` again to return to the regular prompt).

To disable the new interactive shell,
set the [`PYTHON_BASIC_REPL`](../using/cmdline.html#envvar-PYTHON_BASIC_REPL) environment variable.
For more on interactive mode, see [Interactive Mode](../tutorial/appendix.html#tut-interac).

(Contributed by Pablo Galindo Salgado, Łukasz Langa, and
Lysandros Nikolaou in [gh\-111201](https://github.com/python/cpython/issues/111201) based on code from the PyPy project.
Windows support contributed by Dino Viehland and Anthony Shaw.)

### Improved error messages[¶](#improved-error-messages "Link to this heading")

* The interpreter now uses color by default when displaying tracebacks in the
terminal. This feature [can be controlled](../using/cmdline.html#using-on-controlling-color)
via the new [`PYTHON_COLORS`](../using/cmdline.html#envvar-PYTHON_COLORS) environment variable as well as
the canonical [`NO_COLOR`](https://no-color.org/) and [`FORCE_COLOR`](https://force-color.org/) environment variables.
(Contributed by Pablo Galindo Salgado in [gh\-112730](https://github.com/python/cpython/issues/112730).)

* A common mistake is to write a script with the same name as a
standard library module. When this results in errors, we now
display a more helpful error message:

\`\`\`
$ python random.py
Traceback (most recent call last):
 File "/home/me/random.py", line 1, in \
 import random
 File "/home/me/random.py", line 3, in \
 print(random.randint(5\))
 ^^^^^^^^^^^^^^
AttributeError: module 'random' has no attribute 'randint' (consider renaming '/home/me/random.py' since it has the same name as the standard library module named 'random' and prevents importing that standard library module)

\`\`\`

Similarly, if a script has the same name as a third\-party
module that it attempts to import and this results in errors,
we also display a more helpful error message:

\`\`\`
$ python numpy.py
Traceback (most recent call last):
 File "/home/me/numpy.py", line 1, in \
 import numpy as np
 File "/home/me/numpy.py", line 3, in \
 np.array(\[1, 2, 3])
 ^^^^^^^^
AttributeError: module 'numpy' has no attribute 'array' (consider renaming '/home/me/numpy.py' if it has the same name as a library you intended to import)

\`\`\`

(Contributed by Shantanu Jain in [gh\-95754](https://github.com/python/cpython/issues/95754).)
* The error message now tries to suggest the correct keyword argument
when an incorrect keyword argument is passed to a function.

\`\`\`
\>\>\> "Better error messages!".split(max\_split=1\)
Traceback (most recent call last):
 File "\", line 1, in \
 "Better error messages!".split(max\_split=1\)
 \~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~\~^^^^^^^^^^^^^
TypeError: split() got an unexpected keyword argument 'max\_split'. Did you mean 'maxsplit'?

\`\`\`

(Contributed by Pablo Galindo Salgado and Shantanu Jain in [gh\-107944](https://github.com/python/cpython/issues/107944).)

### Free\-threaded CPython[¶](#free-threaded-cpython "Link to this heading")

CPython now has experimental support for running in a free\-threaded mode,
with the [global interpreter lock](../glossary.html#term-global-interpreter-lock) (GIL) disabled.
This is an experimental feature and therefore is not enabled by default.
The free\-threaded mode requires a different executable,
usually called `python3.13t` or `python3.13t.exe`.
Pre\-built binaries marked as *free\-threaded* can be installed as part of
the official [Windows](../using/windows.html#install-freethreaded-windows)
and [macOS](../using/mac.html#install-freethreaded-macos) installers,
or CPython can be built from source with the [`--disable-gil`](../using/configure.html#cmdoption-disable-gil) option.

Free\-threaded execution allows for full utilization of the available
processing power by running threads in parallel on available CPU cores.
While not all software will benefit from this automatically, programs
designed with threading in mind will run faster on multi\-core hardware.
**The free\-threaded mode is experimental** and work is ongoing to improve it:
expect some bugs and a substantial single\-threaded performance hit.
Free\-threaded builds of CPython support optionally running with the GIL
enabled at runtime using the environment variable [`PYTHON_GIL`](../using/cmdline.html#envvar-PYTHON_GIL) or
the command\-line option [`-X gil=1`](../using/cmdline.html#cmdoption-X).

To check if the current interpreter supports free\-threading, [`python -VV`](../using/cmdline.html#cmdoption-V)
and [`sys.version`](../library/sys.html#sys.version "sys.version") contain “experimental free\-threading build”.
The new `sys._is_gil_enabled()` function can be used to check whether
the GIL is actually disabled in the running process.

C\-API extension modules need to be built specifically for the free\-threaded
build. Extensions that support running with the [GIL](../glossary.html#term-GIL) disabled should
use the [`Py_mod_gil`](../c-api/module.html#c.Py_mod_gil "Py_mod_gil") slot. Extensions using single\-phase init should
use [`PyUnstable_Module_SetGIL()`](../c-api/module.html#c.PyUnstable_Module_SetGIL "PyUnstable_Module_SetGIL") to indicate whether they support
running with the GIL disabled. Importing C extensions that don’t use these
mechanisms will cause the GIL to be enabled, unless the GIL was explicitly
disabled with the [`PYTHON_GIL`](../using/cmdline.html#envvar-PYTHON_GIL) environment variable or the
[`-X gil=0`](../using/cmdline.html#cmdoption-X) option.
pip 24\.1 or newer is required to install packages with C extensions in the
free\-threaded build.

This work was made possible thanks to many individuals and
organizations, including the large community of contributors to Python
and third\-party projects to test and enable free\-threading support.
Notable contributors include:
Sam Gross, Ken Jin, Donghee Na, Itamar Oren, Matt Page, Brett Simmers,
Dino Viehland, Carl Meyer, Nathan Goldbaum, Ralf Gommers,
Lysandros Nikolaou, and many others.
Many of these contributors are employed by Meta, which has
provided significant engineering resources to support this project.

See also

[**PEP 703**](https://peps.python.org/pep-0703/) “Making the Global Interpreter Lock Optional in CPython”
contains rationale and information surrounding this work.

[Porting Extension Modules to Support Free\-Threading](https://py-free-threading.github.io/porting/): A community\-maintained
porting guide for extension authors.

### An experimental just\-in\-time (JIT) compiler[¶](#an-experimental-just-in-time-jit-compiler "Link to this heading")

When CPython is configured and built using
the `--enable-experimental-jit` option,
a just\-in\-time (JIT) compiler is added which may speed up some Python programs.
On Windows, use `PCbuild/build.bat --experimental-jit` to enable the JIT
or `--experimental-jit-interpreter` to enable the Tier 2 interpreter.
Build requirements and further supporting information [are contained at](https://github.com/python/cpython/blob/main/Tools/jit/README.md)
`Tools/jit/README.md`.

The `--enable-experimental-jit` option takes these (optional) values,
defaulting to `yes` if `--enable-experimental-jit` is present
without the optional value.

* `no`: Disable the entire Tier 2 and JIT pipeline.
* `yes`: Enable the JIT.
To disable the JIT at runtime, pass the environment variable `PYTHON_JIT=0`.
* `yes-off`: Build the JIT but disable it by default.
To enable the JIT at runtime, pass the environment variable `PYTHON_JIT=1`.
* `interpreter`: Enable the Tier 2 interpreter but disable the JIT.
The interpreter can be disabled by running with `PYTHON_JIT=0`.

The internal architecture is roughly as follows:

* We start with specialized *Tier 1 bytecode*.
See [What’s new in 3\.11](3.11.html#whatsnew311-pep659) for details.
* When the Tier 1 bytecode gets hot enough, it gets translated
to a new purely internal intermediate representation (IR),
called the *Tier 2 IR*, and sometimes referred to as micro\-ops (“uops”).
* The Tier 2 IR uses the same stack\-based virtual machine as Tier 1,
but the instruction format is better suited to translation to machine code.
* We have several optimization passes for Tier 2 IR, which are applied
before it is interpreted or translated to machine code.
* There is a Tier 2 interpreter, but it is mostly intended for debugging
the earlier stages of the optimization pipeline.
The Tier 2 interpreter can be enabled by configuring Python
with `--enable-experimental-jit=interpreter`.
* When the JIT is enabled, the optimized
Tier 2 IR is translated to machine code, which is then executed.
* The machine code translation process uses a technique called
*copy\-and\-patch*. It has no runtime dependencies, but there is a new
build\-time dependency on LLVM.

See also

[**PEP 744**](https://peps.python.org/pep-0744/)

(JIT by Brandt Bucher, inspired by a paper by Haoran Xu and Fredrik Kjolstad.
Tier 2 IR by Mark Shannon and Guido van Rossum.
Tier 2 optimizer by Ken Jin.)

### Defined mutation semantics for [`locals()`](../library/functions.html#locals "locals")[¶](#defined-mutation-semantics-for-locals "Link to this heading")

Historically, the expected result of mutating the return value of
[`locals()`](../library/functions.html#locals "locals") has been left to individual Python implementations to define.
Starting from Python 3\.13, [**PEP 667**](https://peps.python.org/pep-0667/) standardises
the historical behavior of CPython for most code execution scopes,
but changes [optimized scopes](../glossary.html#term-optimized-scope)
(functions, generators, coroutines, comprehensions, and generator expressions)
to explicitly return independent snapshots of the currently assigned local
variables, including locally referenced nonlocal variables captured in closures.

This change to the semantics of [`locals()`](../library/functions.html#locals "locals") in optimized scopes also
affects the default behavior of code execution functions that implicitly
target `locals()` if no explicit namespace is provided
(such as [`exec()`](../library/functions.html#exec "exec") and [`eval()`](../library/functions.html#eval "eval")).
In previous versions, whether or not changes could be accessed by calling
`locals()` after calling the code execution function was
implementation\-dependent. In CPython specifically, such code would typically
appear to work as desired, but could sometimes fail in optimized scopes based
on other code (including debuggers and code execution tracing tools)
potentially resetting the shared snapshot in that scope.
Now, the code will always run against an independent snapshot of
the local variables in optimized scopes, and hence the changes will never
be visible in subsequent calls to `locals()`.
To access the changes made in these cases, an explicit namespace reference
must now be passed to the relevant function.
Alternatively, it may make sense to update affected code to use a higher level
code execution API that returns the resulting code execution namespace
(e.g. [`runpy.run_path()`](../library/runpy.html#runpy.run_path "runpy.run_path") when executing Python files from disk).

To ensure debuggers and similar tools can reliably update local variables in
scopes affected by this change, [`FrameType.f_locals`](../reference/datamodel.html#frame.f_locals "frame.f_locals") now
returns a write\-through proxy to the frame’s local and locally referenced
nonlocal variables in these scopes, rather than returning an inconsistently
updated shared `dict` instance with undefined runtime semantics.

See [**PEP 667**](https://peps.python.org/pep-0667/) for more details, including related C API changes
and deprecations. Porting notes are also provided below for the affected
[Python APIs](#pep667-porting-notes-py) and [C APIs](#pep667-porting-notes-c).

(PEP and implementation contributed by Mark Shannon and Tian Gao in
[gh\-74929](https://github.com/python/cpython/issues/74929). Documentation updates provided by Guido van Rossum and
Alyssa Coghlan.)

### Support for mobile platforms[¶](#support-for-mobile-platforms "Link to this heading")

[**PEP 730**](https://peps.python.org/pep-0730/): iOS is now a [**PEP 11**](https://peps.python.org/pep-0011/) supported platform, with the
`arm64-apple-ios` and `arm64-apple-ios-simulator` targets at tier 3
(iPhone and iPad devices released after 2013 and the Xcode iOS simulator
running on Apple silicon hardware, respectively).
`x86_64-apple-ios-simulator`
(the Xcode iOS simulator running on older `x86_64` hardware)
is not a tier 3 supported platform, but will have best\-effort support.
(PEP written and implementation contributed by Russell Keith\-Magee in
[gh\-114099](https://github.com/python/cpython/issues/114099).)

[**PEP 738**](https://peps.python.org/pep-0738/): Android is now a [**PEP 11**](https://peps.python.org/pep-0011/) supported platform, with the
`aarch64-linux-android` and `x86_64-linux-android` targets at tier 3\.
The 32\-bit targets `arm-linux-androideabi` and `i686-linux-android`
are not tier 3 supported platforms, but will have best\-effort support.
(PEP written and implementation contributed by Malcolm Smith in
[gh\-116622](https://github.com/python/cpython/issues/116622).)

See also

[**PEP 730**](https://peps.python.org/pep-0730/), [**PEP 738**](https://peps.python.org/pep-0738/)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* The compiler now strips common leading whitespace
from every line in a docstring.
This reduces the size of the [bytecode cache](../glossary.html#term-bytecode)
(such as `.pyc` files), with reductions in file size of around 5%,
for example in `sqlalchemy.orm.session` from SQLAlchemy 2\.0\.
This change affects tools that use docstrings, such as [`doctest`](../library/doctest.html#module-doctest "doctest: Test pieces of code within docstrings.").

\`\`\`
\>\>\> def spam():
... """
... This is a docstring with
... leading whitespace.
...
... It even has multiple paragraphs!
... """
...
\>\>\> spam.\_\_doc\_\_
'\\nThis is a docstring with\\n leading whitespace.\\n\\nIt even has multiple paragraphs!\\n'

\`\`\`

(Contributed by Inada Naoki in [gh\-81283](https://github.com/python/cpython/issues/81283).)
* [Annotation scopes](../reference/executionmodel.html#annotation-scopes) within class scopes
can now contain lambdas and comprehensions.
Comprehensions that are located within class scopes
are not inlined into their parent scope.

\`\`\`
class C\[T]:
 type Alias = lambda: T

\`\`\`

(Contributed by Jelle Zijlstra in [gh\-109118](https://github.com/python/cpython/issues/109118) and [gh\-118160](https://github.com/python/cpython/issues/118160).)
* [Future statements](../reference/simple_stmts.html#future) are no longer triggered by
relative imports of the [`__future__`](../library/__future__.html#module-__future__ "__future__: Future statement definitions") module,
meaning that statements of the form `from .__future__ import ...`
are now simply standard relative imports, with no special features activated.
(Contributed by Jeremiah Gabriel Pascual in [gh\-118216](https://github.com/python/cpython/issues/118216).)
* [`global`](../reference/simple_stmts.html#global) declarations are now permitted in [`except`](../reference/compound_stmts.html#except) blocks
when that global is used in the [`else`](../reference/compound_stmts.html#else) block.
Previously this raised an erroneous [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError").
(Contributed by Irit Katriel in [gh\-111123](https://github.com/python/cpython/issues/111123).)
* Add [`PYTHON_FROZEN_MODULES`](../using/cmdline.html#envvar-PYTHON_FROZEN_MODULES), a new environment variable that
determines whether frozen modules are ignored by the import machinery,
equivalent to the [`-X frozen_modules`](../using/cmdline.html#cmdoption-X) command\-line option.
(Contributed by Yilei Yang in [gh\-111374](https://github.com/python/cpython/issues/111374).)
* Add [support for the perf profiler](../howto/perf_profiling.html#perf-profiling) working
without [frame pointers](https://en.wikipedia.org/wiki/Call_stack) through
the new environment variable [`PYTHON_PERF_JIT_SUPPORT`](../using/cmdline.html#envvar-PYTHON_PERF_JIT_SUPPORT)
and command\-line option [`-X perf_jit`](../using/cmdline.html#cmdoption-X).
(Contributed by Pablo Galindo in [gh\-118518](https://github.com/python/cpython/issues/118518).)
* The location of a `.python_history` file can be changed via the
new [`PYTHON_HISTORY`](../using/cmdline.html#envvar-PYTHON_HISTORY) environment variable.
(Contributed by Levi Sabah, Zackery Spytz and Hugo van Kemenade
in [gh\-73965](https://github.com/python/cpython/issues/73965).)
* Classes have a new [`__static_attributes__`](../reference/datamodel.html#type.__static_attributes__ "type.__static_attributes__") attribute.
This is populated by the compiler with a tuple of the class’s attribute names
which are assigned through `self.` from any function in its body.
(Contributed by Irit Katriel in [gh\-115775](https://github.com/python/cpython/issues/115775).)
* The compiler now creates a `__firstlineno__` attribute on classes
with the line number of the first line of the class definition.
(Contributed by Serhiy Storchaka in [gh\-118465](https://github.com/python/cpython/issues/118465).)
* The [`exec()`](../library/functions.html#exec "exec") and [`eval()`](../library/functions.html#eval "eval") builtins now accept
the *globals* and *locals* arguments as keywords.
(Contributed by Raphael Gaschignard in [gh\-105879](https://github.com/python/cpython/issues/105879))
* The [`compile()`](../library/functions.html#compile "compile") builtin now accepts a new flag,
`ast.PyCF_OPTIMIZED_AST`, which is similar to `ast.PyCF_ONLY_AST`
except that the returned AST is optimized according to
the value of the *optimize* argument.
(Contributed by Irit Katriel in [gh\-108113](https://github.com/python/cpython/issues/108113)).
* Add a [`__name__`](../library/functions.html#property.__name__ "property.__name__") attribute on [`property`](../library/functions.html#property "property") objects.
(Contributed by Eugene Toder in [gh\-101860](https://github.com/python/cpython/issues/101860).)
* Add [`PythonFinalizationError`](../library/exceptions.html#PythonFinalizationError "PythonFinalizationError"), a new exception derived from
[`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") and used to signal when operations are blocked
during [finalization](../glossary.html#term-interpreter-shutdown).
The following callables now raise `PythonFinalizationError`,
instead of [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError"):

	+ [`_thread.start_new_thread()`](../library/_thread.html#thread.start_new_thread "_thread.start_new_thread")
	+ [`os.fork()`](../library/os.html#os.fork "os.fork")
	+ [`os.forkpty()`](../library/os.html#os.forkpty "os.forkpty")
	+ [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen")(Contributed by Victor Stinner in [gh\-114570](https://github.com/python/cpython/issues/114570).)
* Allow the *count* argument of [`str.replace()`](../library/stdtypes.html#str.replace "str.replace") to be a keyword.
(Contributed by Hugo van Kemenade in [gh\-106487](https://github.com/python/cpython/issues/106487).)
* Many functions now emit a warning if a boolean value is passed as
a file descriptor argument.
This can help catch some errors earlier.
(Contributed by Serhiy Storchaka in [gh\-82626](https://github.com/python/cpython/issues/82626).)
* Added `name` and `mode` attributes
for compressed and archived file\-like objects in
the [`bz2`](../library/bz2.html#module-bz2 "bz2: Interfaces for bzip2 compression and decompression."), [`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library."), [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), and [`zipfile`](../library/zipfile.html#module-zipfile "zipfile: Read and write ZIP-format archive files.") modules.
(Contributed by Serhiy Storchaka in [gh\-115961](https://github.com/python/cpython/issues/115961).)

## New Modules[¶](#new-modules "Link to this heading")

* [`dbm.sqlite3`](../library/dbm.html#module-dbm.sqlite3 "dbm.sqlite3: SQLite backend for dbm (All)"): An SQLite backend for [`dbm`](../library/dbm.html#module-dbm "dbm: Interfaces to various Unix \"database\" formats.").
(Contributed by Raymond Hettinger and Erlend E. Aasland in [gh\-100414](https://github.com/python/cpython/issues/100414).)

## Improved Modules[¶](#improved-modules "Link to this heading")

### argparse[¶](#argparse "Link to this heading")

* Add the *deprecated* parameter to the
[`add_argument()`](../library/argparse.html#argparse.ArgumentParser.add_argument "argparse.ArgumentParser.add_argument")
and `add_parser()` methods, to enable deprecating
command\-line options, positional arguments, and subcommands.
(Contributed by Serhiy Storchaka in [gh\-83648](https://github.com/python/cpython/issues/83648).)

### array[¶](#array "Link to this heading")

* Add the `'w'` type code (`Py_UCS4`) for Unicode characters.
It should be used instead of the deprecated `'u'` type code.
(Contributed by Inada Naoki in [gh\-80480](https://github.com/python/cpython/issues/80480).)
* Register [`array.array`](../library/array.html#array.array "array.array") as a [`MutableSequence`](../library/collections.abc.html#collections.abc.MutableSequence "collections.abc.MutableSequence")
by implementing the [`clear()`](../library/array.html#array.array.clear "array.array.clear") method.
(Contributed by Mike Zimin in [gh\-114894](https://github.com/python/cpython/issues/114894).)

### ast[¶](#ast "Link to this heading")

* The constructors of node types in the [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") module are now
stricter in the arguments they accept,
with more intuitive behavior when arguments are omitted.

If an optional field on an AST node is not included as an argument when
constructing an instance, the field will now be set to `None`. Similarly,
if a list field is omitted, that field will now be set to an empty list,
and if an `expr_context` field is omitted, it defaults to
[`Load()`](../library/ast.html#ast.Load "ast.Load").
(Previously, in all cases, the attribute would be missing on the newly
constructed AST node instance.)

In all other cases, where a required argument is omitted,
the node constructor will emit a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
This will raise an exception in Python 3\.15\.
Similarly, passing a keyword argument to the constructor
that does not map to a field on the AST node is now deprecated,
and will raise an exception in Python 3\.15\.

These changes do not apply to user\-defined subclasses of [`ast.AST`](../library/ast.html#ast.AST "ast.AST")
unless the class opts in to the new behavior
by defining the [`AST._field_types`](../library/ast.html#ast.AST._field_types "ast.AST._field_types") mapping.

(Contributed by Jelle Zijlstra in [gh\-105858](https://github.com/python/cpython/issues/105858), [gh\-117486](https://github.com/python/cpython/issues/117486), and [gh\-118851](https://github.com/python/cpython/issues/118851).)
* [`ast.parse()`](../library/ast.html#ast.parse "ast.parse") now accepts an optional argument *optimize*
which is passed on to [`compile()`](../library/functions.html#compile "compile").
This makes it possible to obtain an optimized AST.
(Contributed by Irit Katriel in [gh\-108113](https://github.com/python/cpython/issues/108113).)

### asyncio[¶](#asyncio "Link to this heading")

* [`asyncio.as_completed()`](../library/asyncio-task.html#asyncio.as_completed "asyncio.as_completed") now returns an object that is both an
[asynchronous iterator](../glossary.html#term-asynchronous-iterator) and a plain [iterator](../glossary.html#term-iterator)
of [awaitables](../glossary.html#term-awaitable).
The awaitables yielded by asynchronous iteration include original task
or future objects that were passed in,
making it easier to associate results with the tasks being completed.
(Contributed by Justin Arthur in [gh\-77714](https://github.com/python/cpython/issues/77714).)
* [`asyncio.loop.create_unix_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_unix_server "asyncio.loop.create_unix_server") will now automatically remove
the Unix socket when the server is closed.
(Contributed by Pierre Ossman in [gh\-111246](https://github.com/python/cpython/issues/111246).)
* [`DatagramTransport.sendto()`](../library/asyncio-protocol.html#asyncio.DatagramTransport.sendto "asyncio.DatagramTransport.sendto") will now send zero\-length
datagrams if called with an empty bytes object.
The transport flow control also now accounts for the datagram header
when calculating the buffer size.
(Contributed by Jamie Phan in [gh\-115199](https://github.com/python/cpython/issues/115199).)
* Add [`Queue.shutdown`](../library/asyncio-queue.html#asyncio.Queue.shutdown "asyncio.Queue.shutdown")
and [`QueueShutDown`](../library/asyncio-queue.html#asyncio.QueueShutDown "asyncio.QueueShutDown") to manage queue termination.
(Contributed by Laurie Opperman and Yves Duprat in [gh\-104228](https://github.com/python/cpython/issues/104228).)
* Add the [`Server.close_clients()`](../library/asyncio-eventloop.html#asyncio.Server.close_clients "asyncio.Server.close_clients") and [`Server.abort_clients()`](../library/asyncio-eventloop.html#asyncio.Server.abort_clients "asyncio.Server.abort_clients")
methods, which more forcefully close an asyncio server.
(Contributed by Pierre Ossman in [gh\-113538](https://github.com/python/cpython/issues/113538).)
* Accept a tuple of separators in [`StreamReader.readuntil()`](../library/asyncio-stream.html#asyncio.StreamReader.readuntil "asyncio.StreamReader.readuntil"),
stopping when any one of them is encountered.
(Contributed by Bruce Merry in [gh\-81322](https://github.com/python/cpython/issues/81322).)
* Improve the behavior of [`TaskGroup`](../library/asyncio-task.html#asyncio.TaskGroup "asyncio.TaskGroup") when
an external cancellation collides with an internal cancellation.
For example, when two task groups are nested
and both experience an exception in a child task simultaneously,
it was possible that the outer task group would hang,
because its internal cancellation was swallowed by the inner task group.

In the case where a task group is cancelled externally
and also must raise an [`ExceptionGroup`](../library/exceptions.html#ExceptionGroup "ExceptionGroup"),
it will now call the parent task’s [`cancel()`](../library/asyncio-task.html#asyncio.Task.cancel "asyncio.Task.cancel") method.
This ensures that a [`CancelledError`](../library/asyncio-exceptions.html#asyncio.CancelledError "asyncio.CancelledError") will be raised
at the next [`await`](../reference/expressions.html#await), so the cancellation is not lost.

An added benefit of these changes is that task groups now preserve
the cancellation count ([`cancelling()`](../library/asyncio-task.html#asyncio.Task.cancelling "asyncio.Task.cancelling")).

In order to handle some corner cases, [`uncancel()`](../library/asyncio-task.html#asyncio.Task.uncancel "asyncio.Task.uncancel") may now
reset the undocumented `_must_cancel` flag
when the cancellation count reaches zero.

(Inspired by an issue reported by Arthur Tacca in [gh\-116720](https://github.com/python/cpython/issues/116720).)
* When [`TaskGroup.create_task()`](../library/asyncio-task.html#asyncio.TaskGroup.create_task "asyncio.TaskGroup.create_task") is called on an inactive
[`TaskGroup`](../library/asyncio-task.html#asyncio.TaskGroup "asyncio.TaskGroup"), the given coroutine will be closed (which
prevents a [`RuntimeWarning`](../library/exceptions.html#RuntimeWarning "RuntimeWarning") about the given coroutine being
never awaited).
(Contributed by Arthur Tacca and Jason Zhang in [gh\-115957](https://github.com/python/cpython/issues/115957).)

### base64[¶](#base64 "Link to this heading")

* Add [`z85encode()`](../library/base64.html#base64.z85encode "base64.z85encode") and [`z85decode()`](../library/base64.html#base64.z85decode "base64.z85decode") functions
for encoding [`bytes`](../library/stdtypes.html#bytes "bytes") as [Z85 data](https://rfc.zeromq.org/spec/32/)
and decoding Z85\-encoded data to `bytes`.
(Contributed by Matan Perelman in [gh\-75299](https://github.com/python/cpython/issues/75299).)

### compileall[¶](#compileall "Link to this heading")

* The default number of worker threads and processes is now selected using
[`os.process_cpu_count()`](../library/os.html#os.process_cpu_count "os.process_cpu_count") instead of [`os.cpu_count()`](../library/os.html#os.cpu_count "os.cpu_count").
(Contributed by Victor Stinner in [gh\-109649](https://github.com/python/cpython/issues/109649).)

### concurrent.futures[¶](#concurrent-futures "Link to this heading")

* The default number of worker threads and processes is now selected using
[`os.process_cpu_count()`](../library/os.html#os.process_cpu_count "os.process_cpu_count") instead of [`os.cpu_count()`](../library/os.html#os.cpu_count "os.cpu_count").
(Contributed by Victor Stinner in [gh\-109649](https://github.com/python/cpython/issues/109649).)

### configparser[¶](#configparser "Link to this heading")

* [`ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser") now has support for unnamed sections,
which allows for top\-level key\-value pairs.
This can be enabled with the new *allow\_unnamed\_section* parameter.
(Contributed by Pedro Sousa Lacerda in [gh\-66449](https://github.com/python/cpython/issues/66449).)

### copy[¶](#copy "Link to this heading")

* The new [`replace()`](../library/copy.html#copy.replace "copy.replace") function and the [`replace protocol`](../library/copy.html#object.__replace__ "object.__replace__") make creating modified copies of objects much simpler.
This is especially useful when working with immutable objects.
The following types support the [`replace()`](../library/copy.html#copy.replace "copy.replace") function
and implement the replace protocol:

	+ [`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple")
	+ [`dataclasses.dataclass`](../library/dataclasses.html#dataclasses.dataclass "dataclasses.dataclass")
	+ [`datetime.datetime`](../library/datetime.html#datetime.datetime "datetime.datetime"), [`datetime.date`](../library/datetime.html#datetime.date "datetime.date"), [`datetime.time`](../library/datetime.html#datetime.time "datetime.time")
	+ [`inspect.Signature`](../library/inspect.html#inspect.Signature "inspect.Signature"), [`inspect.Parameter`](../library/inspect.html#inspect.Parameter "inspect.Parameter")
	+ [`types.SimpleNamespace`](../library/types.html#types.SimpleNamespace "types.SimpleNamespace")
	+ [code objects](../reference/datamodel.html#code-objects)Any user\-defined class can also support [`copy.replace()`](../library/copy.html#copy.replace "copy.replace") by defining
the [`__replace__()`](../library/copy.html#object.__replace__ "object.__replace__") method.
(Contributed by Serhiy Storchaka in [gh\-108751](https://github.com/python/cpython/issues/108751).)

### ctypes[¶](#ctypes "Link to this heading")

* As a consequence of necessary internal refactoring, initialization of
internal metaclasses now happens in `__init__` rather
than in `__new__`. This affects projects that subclass these internal
metaclasses to provide custom initialization.
Generally:

	+ Custom logic that was done in `__new__` after calling `super().__new__`
	should be moved to `__init__`.
	+ To create a class, call the metaclass, not only the metaclass’s
	`__new__` method.See [gh\-124520](https://github.com/python/cpython/issues/124520) for discussion and links to changes in some affected
projects.
* [`ctypes.Structure`](../library/ctypes.html#ctypes.Structure "ctypes.Structure") objects have a new [`_align_`](../library/ctypes.html#ctypes.Structure._align_ "ctypes.Structure._align_")
attribute which allows the alignment of the structure being packed to/from
memory to be specified explicitly.
(Contributed by Matt Sanderson in [gh\-112433](https://github.com/python/cpython/issues/112433))

### dbm[¶](#dbm "Link to this heading")

* Add [`dbm.sqlite3`](../library/dbm.html#module-dbm.sqlite3 "dbm.sqlite3: SQLite backend for dbm (All)"), a new module which implements an SQLite backend,
and make it the default `dbm` backend.
(Contributed by Raymond Hettinger and Erlend E. Aasland in [gh\-100414](https://github.com/python/cpython/issues/100414).)
* Allow removing all items from the database through
the new [`gdbm.clear()`](../library/dbm.html#dbm.gnu.gdbm.clear "dbm.gnu.gdbm.clear") and [`ndbm.clear()`](../library/dbm.html#dbm.ndbm.ndbm.clear "dbm.ndbm.ndbm.clear") methods.
(Contributed by Donghee Na in [gh\-107122](https://github.com/python/cpython/issues/107122).)

### dis[¶](#dis "Link to this heading")

* Change the output of [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module functions to show logical
labels for jump targets and exception handlers, rather than offsets.
The offsets can be added with the new
[`-O`](../library/dis.html#cmdoption-dis-O) command\-line option
or the *show\_offsets* argument.
(Contributed by Irit Katriel in [gh\-112137](https://github.com/python/cpython/issues/112137).)
* [`get_instructions()`](../library/dis.html#dis.get_instructions "dis.get_instructions") no longer represents cache entries
as separate instructions.
Instead, it returns them as part of the [`Instruction`](../library/dis.html#dis.Instruction "dis.Instruction"),
in the new *cache\_info* field.
The *show\_caches* argument to [`get_instructions()`](../library/dis.html#dis.get_instructions "dis.get_instructions") is deprecated
and no longer has any effect.
(Contributed by Irit Katriel in [gh\-112962](https://github.com/python/cpython/issues/112962).)

### doctest[¶](#doctest "Link to this heading")

* [`doctest`](../library/doctest.html#module-doctest "doctest: Test pieces of code within docstrings.") output is now colored by default.
This can be controlled via the new [`PYTHON_COLORS`](../using/cmdline.html#envvar-PYTHON_COLORS) environment
variable as well as the canonical [`NO_COLOR`](https://no-color.org/)
and [`FORCE_COLOR`](https://force-color.org/) environment variables.
See also [Controlling color](../using/cmdline.html#using-on-controlling-color).
(Contributed by Hugo van Kemenade in [gh\-117225](https://github.com/python/cpython/issues/117225).)
* The [`DocTestRunner.run()`](../library/doctest.html#doctest.DocTestRunner.run "doctest.DocTestRunner.run") method now counts the number of skipped tests.
Add the [`DocTestRunner.skips`](../library/doctest.html#doctest.DocTestRunner.skips "doctest.DocTestRunner.skips") and [`TestResults.skipped`](../library/doctest.html#doctest.TestResults.skipped "doctest.TestResults.skipped") attributes.
(Contributed by Victor Stinner in [gh\-108794](https://github.com/python/cpython/issues/108794).)

### email[¶](#email "Link to this heading")

* Headers with embedded newlines are now quoted on output.
The [`generator`](../library/email.generator.html#module-email.generator "email.generator: Generate flat text email messages from a message structure.") will now refuse to serialize (write) headers
that are improperly folded or delimited, such that they would be parsed as
multiple headers or joined with adjacent data.
If you need to turn this safety feature off,
set [`verify_generated_headers`](../library/email.policy.html#email.policy.Policy.verify_generated_headers "email.policy.Policy.verify_generated_headers").
(Contributed by Bas Bloemsaat and Petr Viktorin in [gh\-121650](https://github.com/python/cpython/issues/121650).)
* [`getaddresses()`](../library/email.utils.html#email.utils.getaddresses "email.utils.getaddresses") and [`parseaddr()`](../library/email.utils.html#email.utils.parseaddr "email.utils.parseaddr") now
return `('', '')` pairs in more situations where invalid email addresses
are encountered instead of potentially inaccurate values.
The two functions have a new optional *strict* parameter (default `True`).
To get the old behavior (accepting malformed input), use `strict=False`.
`getattr(email.utils, 'supports_strict_parsing', False)` can be used
to check if the *strict* parameter is available.
(Contributed by Thomas Dwyer and Victor Stinner for [gh\-102988](https://github.com/python/cpython/issues/102988) to improve
the [**CVE 2023\-27043**](https://www.cve.org/CVERecord?id=CVE-2023-27043) fix.)

### enum[¶](#enum "Link to this heading")

* [`EnumDict`](../library/enum.html#enum.EnumDict "enum.EnumDict") has been made public to better support subclassing
[`EnumType`](../library/enum.html#enum.EnumType "enum.EnumType").

### fractions[¶](#fractions "Link to this heading")

* [`Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") objects now support the standard
[format specification mini\-language](../library/string.html#formatspec) rules
for fill, alignment, sign handling, minimum width, and grouping.
(Contributed by Mark Dickinson in [gh\-111320](https://github.com/python/cpython/issues/111320).)

### glob[¶](#glob "Link to this heading")

* Add [`translate()`](../library/glob.html#glob.translate "glob.translate"), a function to convert a path specification
with shell\-style wildcards to a regular expression.
(Contributed by Barney Gale in [gh\-72904](https://github.com/python/cpython/issues/72904).)

### importlib[¶](#importlib "Link to this heading")

* The following functions in [`importlib.resources`](../library/importlib.resources.html#module-importlib.resources "importlib.resources: Package resource reading, opening, and access") now allow accessing
a directory (or tree) of resources, using multiple positional arguments
(the *encoding* and *errors* arguments in the text\-reading functions
are now keyword\-only):

	+ [`is_resource()`](../library/importlib.resources.html#importlib.resources.is_resource "importlib.resources.is_resource")
	+ [`open_binary()`](../library/importlib.resources.html#importlib.resources.open_binary "importlib.resources.open_binary")
	+ [`open_text()`](../library/importlib.resources.html#importlib.resources.open_text "importlib.resources.open_text")
	+ [`path()`](../library/importlib.resources.html#importlib.resources.path "importlib.resources.path")
	+ [`read_binary()`](../library/importlib.resources.html#importlib.resources.read_binary "importlib.resources.read_binary")
	+ [`read_text()`](../library/importlib.resources.html#importlib.resources.read_text "importlib.resources.read_text")These functions are no longer deprecated and are not scheduled for removal.
(Contributed by Petr Viktorin in [gh\-116608](https://github.com/python/cpython/issues/116608).)
* [`contents()`](../library/importlib.resources.html#importlib.resources.contents "importlib.resources.contents") remains deprecated in favor of
the fully\-featured [`Traversable`](../library/importlib.resources.abc.html#importlib.resources.abc.Traversable "importlib.resources.abc.Traversable") API.
However, there is now no plan to remove it.
(Contributed by Petr Viktorin in [gh\-116608](https://github.com/python/cpython/issues/116608).)

### io[¶](#io "Link to this heading")

* The [`IOBase`](../library/io.html#io.IOBase "io.IOBase") finalizer now logs any errors raised by
the [`close()`](../library/io.html#io.IOBase.close "io.IOBase.close") method with [`sys.unraisablehook`](../library/sys.html#sys.unraisablehook "sys.unraisablehook").
Previously, errors were ignored silently by default,
and only logged in [Python Development Mode](../library/devmode.html#devmode)
or when using a [Python debug build](../using/configure.html#debug-build).
(Contributed by Victor Stinner in [gh\-62948](https://github.com/python/cpython/issues/62948).)

### ipaddress[¶](#ipaddress "Link to this heading")

* Add the [`IPv4Address.ipv6_mapped`](../library/ipaddress.html#ipaddress.IPv4Address.ipv6_mapped "ipaddress.IPv4Address.ipv6_mapped") property,
which returns the IPv4\-mapped IPv6 address.
(Contributed by Charles Machalow in [gh\-109466](https://github.com/python/cpython/issues/109466).)
* Fix `is_global` and `is_private` behavior in
[`IPv4Address`](../library/ipaddress.html#ipaddress.IPv4Address "ipaddress.IPv4Address"), [`IPv6Address`](../library/ipaddress.html#ipaddress.IPv6Address "ipaddress.IPv6Address"),
[`IPv4Network`](../library/ipaddress.html#ipaddress.IPv4Network "ipaddress.IPv4Network"), and [`IPv6Network`](../library/ipaddress.html#ipaddress.IPv6Network "ipaddress.IPv6Network").
(Contributed by Jakub Stasiak in [gh\-113171](https://github.com/python/cpython/issues/113171).)

### itertools[¶](#itertools "Link to this heading")

* [`batched()`](../library/itertools.html#itertools.batched "itertools.batched") has a new *strict* parameter,
which raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the final batch is shorter
than the specified batch size.
(Contributed by Raymond Hettinger in [gh\-113202](https://github.com/python/cpython/issues/113202).)

### marshal[¶](#marshal "Link to this heading")

* Add the *allow\_code* parameter in module functions.
Passing `allow_code=False` prevents serialization and de\-serialization
of code objects which are incompatible between Python versions.
(Contributed by Serhiy Storchaka in [gh\-113626](https://github.com/python/cpython/issues/113626).)

### math[¶](#math "Link to this heading")

* The new function [`fma()`](../library/math.html#math.fma "math.fma") performs fused multiply\-add operations.
This computes `x * y + z` with only a single round,
and so avoids any intermediate loss of precision.
It wraps the `fma()` function provided by C99,
and follows the specification of the IEEE 754 “fusedMultiplyAdd” operation
for special cases.
(Contributed by Mark Dickinson and Victor Stinner in [gh\-73468](https://github.com/python/cpython/issues/73468).)

### mimetypes[¶](#mimetypes "Link to this heading")

* Add the [`guess_file_type()`](../library/mimetypes.html#mimetypes.guess_file_type "mimetypes.guess_file_type") function to guess a MIME type
from a filesystem path.
Using paths with [`guess_type()`](../library/mimetypes.html#mimetypes.guess_type "mimetypes.guess_type") is now [soft deprecated](../glossary.html#term-soft-deprecated).
(Contributed by Serhiy Storchaka in [gh\-66543](https://github.com/python/cpython/issues/66543).)

### mmap[¶](#mmap "Link to this heading")

* [`mmap`](../library/mmap.html#mmap.mmap "mmap.mmap") is now protected from crashing on Windows when the
mapped memory is inaccessible due to file system errors or access violations.
(Contributed by Jannis Weigend in [gh\-118209](https://github.com/python/cpython/issues/118209).)
* [`mmap`](../library/mmap.html#mmap.mmap "mmap.mmap") has a new [`seekable()`](../library/mmap.html#mmap.mmap.seekable "mmap.mmap.seekable") method
that can be used when a seekable file\-like object is required.
The [`seek()`](../library/mmap.html#mmap.mmap.seek "mmap.mmap.seek") method now returns the new absolute position.
(Contributed by Donghee Na and Sylvie Liberman in [gh\-111835](https://github.com/python/cpython/issues/111835).)
* The new UNIX\-only *trackfd* parameter for [`mmap`](../library/mmap.html#mmap.mmap "mmap.mmap") controls
file descriptor duplication;
if false, the file descriptor specified by *fileno* will not be duplicated.
(Contributed by Zackery Spytz and Petr Viktorin in [gh\-78502](https://github.com/python/cpython/issues/78502).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

* The default number of worker threads and processes is now selected using
[`os.process_cpu_count()`](../library/os.html#os.process_cpu_count "os.process_cpu_count") instead of [`os.cpu_count()`](../library/os.html#os.cpu_count "os.cpu_count").
(Contributed by Victor Stinner in [gh\-109649](https://github.com/python/cpython/issues/109649).)

### os[¶](#os "Link to this heading")

* Add [`process_cpu_count()`](../library/os.html#os.process_cpu_count "os.process_cpu_count") function to get the number
of logical CPU cores usable by the calling thread of the current process.
(Contributed by Victor Stinner in [gh\-109649](https://github.com/python/cpython/issues/109649).)
* [`cpu_count()`](../library/os.html#os.cpu_count "os.cpu_count") and [`process_cpu_count()`](../library/os.html#os.process_cpu_count "os.process_cpu_count") can be overridden
through the new environment variable [`PYTHON_CPU_COUNT`](../using/cmdline.html#envvar-PYTHON_CPU_COUNT)
or the new command\-line option [`-X cpu_count`](../using/cmdline.html#cmdoption-X).
This option is useful for users who need to limit CPU resources
of a container system without having to modify application code
or the container itself.
(Contributed by Donghee Na in [gh\-109595](https://github.com/python/cpython/issues/109595).)
* Add a [low level interface](../library/os.html#os-timerfd) to Linux’s
*[timer file descriptors](https://manpages.debian.org/timerfd_create(2))*
via [`timerfd_create()`](../library/os.html#os.timerfd_create "os.timerfd_create"),
[`timerfd_settime()`](../library/os.html#os.timerfd_settime "os.timerfd_settime"), [`timerfd_settime_ns()`](../library/os.html#os.timerfd_settime_ns "os.timerfd_settime_ns"),
[`timerfd_gettime()`](../library/os.html#os.timerfd_gettime "os.timerfd_gettime"), [`timerfd_gettime_ns()`](../library/os.html#os.timerfd_gettime_ns "os.timerfd_gettime_ns"),
[`TFD_NONBLOCK`](../library/os.html#os.TFD_NONBLOCK "os.TFD_NONBLOCK"), [`TFD_CLOEXEC`](../library/os.html#os.TFD_CLOEXEC "os.TFD_CLOEXEC"),
[`TFD_TIMER_ABSTIME`](../library/os.html#os.TFD_TIMER_ABSTIME "os.TFD_TIMER_ABSTIME"), and [`TFD_TIMER_CANCEL_ON_SET`](../library/os.html#os.TFD_TIMER_CANCEL_ON_SET "os.TFD_TIMER_CANCEL_ON_SET")
(Contributed by Masaru Tsuchiyama in [gh\-108277](https://github.com/python/cpython/issues/108277).)
* [`lchmod()`](../library/os.html#os.lchmod "os.lchmod") and the *follow\_symlinks* argument of [`chmod()`](../library/os.html#os.chmod "os.chmod")
are both now available on Windows.
Note that the default value of *follow\_symlinks*
in `lchmod()` is `False` on Windows.
(Contributed by Serhiy Storchaka in [gh\-59616](https://github.com/python/cpython/issues/59616).)
* [`fchmod()`](../library/os.html#os.fchmod "os.fchmod") and support for file descriptors in [`chmod()`](../library/os.html#os.chmod "os.chmod")
are both now available on Windows.
(Contributed by Serhiy Storchaka in [gh\-113191](https://github.com/python/cpython/issues/113191).)
* On Windows, [`mkdir()`](../library/os.html#os.mkdir "os.mkdir") and [`makedirs()`](../library/os.html#os.makedirs "os.makedirs") now support passing
a *mode* value of `0o700` to apply access control to the new directory.
This implicitly affects [`tempfile.mkdtemp()`](../library/tempfile.html#tempfile.mkdtemp "tempfile.mkdtemp")
and is a mitigation for [**CVE 2024\-4030**](https://www.cve.org/CVERecord?id=CVE-2024-4030).
Other values for *mode* continue to be ignored.
(Contributed by Steve Dower in [gh\-118486](https://github.com/python/cpython/issues/118486).)
* [`posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") now accepts `None` for the *env* argument,
which makes the newly spawned process use the current process environment.
(Contributed by Jakub Kulik in [gh\-113119](https://github.com/python/cpython/issues/113119).)
* [`posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") can now use the [`POSIX_SPAWN_CLOSEFROM`](../library/os.html#os.POSIX_SPAWN_CLOSEFROM "os.POSIX_SPAWN_CLOSEFROM")
attribute in the *file\_actions* parameter on platforms that support
`posix_spawn_file_actions_addclosefrom_np()`.
(Contributed by Jakub Kulik in [gh\-113117](https://github.com/python/cpython/issues/113117).)

### os.path[¶](#os-path "Link to this heading")

* Add [`isreserved()`](../library/os.path.html#os.path.isreserved "os.path.isreserved") to check if a path is reserved
on the current system.
This function is only available on Windows.
(Contributed by Barney Gale in [gh\-88569](https://github.com/python/cpython/issues/88569).)
* On Windows, [`isabs()`](../library/os.path.html#os.path.isabs "os.path.isabs") no longer considers paths
starting with exactly one slash (`\` or `/`) to be absolute.
(Contributed by Barney Gale and Jon Foster in [gh\-44626](https://github.com/python/cpython/issues/44626).)
* [`realpath()`](../library/os.path.html#os.path.realpath "os.path.realpath") now resolves MS\-DOS style file names
even if the file is not accessible.
(Contributed by Moonsik Park in [gh\-82367](https://github.com/python/cpython/issues/82367).)

### pathlib[¶](#pathlib "Link to this heading")

* Add [`UnsupportedOperation`](../library/pathlib.html#pathlib.UnsupportedOperation "pathlib.UnsupportedOperation"), which is raised instead of
[`NotImplementedError`](../library/exceptions.html#NotImplementedError "NotImplementedError") when a path operation isn’t supported.
(Contributed by Barney Gale in [gh\-89812](https://github.com/python/cpython/issues/89812).)
* Add a new constructor for creating [`Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") objects
from ‘file’ URIs (`file:///`), [`Path.from_uri()`](../library/pathlib.html#pathlib.Path.from_uri "pathlib.Path.from_uri").
(Contributed by Barney Gale in [gh\-107465](https://github.com/python/cpython/issues/107465).)
* Add [`PurePath.full_match()`](../library/pathlib.html#pathlib.PurePath.full_match "pathlib.PurePath.full_match") for matching paths with
shell\-style wildcards, including the recursive wildcard “`**`”.
(Contributed by Barney Gale in [gh\-73435](https://github.com/python/cpython/issues/73435).)
* Add the [`PurePath.parser`](../library/pathlib.html#pathlib.PurePath.parser "pathlib.PurePath.parser") class attribute to store the
implementation of [`os.path`](../library/os.path.html#module-os.path "os.path: Operations on pathnames.") used
for low\-level path parsing and joining.
This will be either `posixpath` or `ntpath`.
* Add *recurse\_symlinks* keyword\-only argument to
[`Path.glob()`](../library/pathlib.html#pathlib.Path.glob "pathlib.Path.glob") and [`rglob()`](../library/pathlib.html#pathlib.Path.rglob "pathlib.Path.rglob").
(Contributed by Barney Gale in [gh\-77609](https://github.com/python/cpython/issues/77609).)
* [`Path.glob()`](../library/pathlib.html#pathlib.Path.glob "pathlib.Path.glob") and [`rglob()`](../library/pathlib.html#pathlib.Path.rglob "pathlib.Path.rglob")
now return files and directories when given a pattern that ends with “`**`”.
Previously, only directories were returned.
(Contributed by Barney Gale in [gh\-70303](https://github.com/python/cpython/issues/70303).)
* Add the *follow\_symlinks* keyword\-only argument to
[`Path.is_file`](../library/pathlib.html#pathlib.Path.is_file "pathlib.Path.is_file"),
[`Path.is_dir`](../library/pathlib.html#pathlib.Path.is_dir "pathlib.Path.is_dir"),
[`Path.owner()`](../library/pathlib.html#pathlib.Path.owner "pathlib.Path.owner"), and [`Path.group()`](../library/pathlib.html#pathlib.Path.group "pathlib.Path.group").
(Contributed by Barney Gale in [gh\-105793](https://github.com/python/cpython/issues/105793) and Kamil Turek in [gh\-107962](https://github.com/python/cpython/issues/107962).)

### pdb[¶](#pdb "Link to this heading")

* [`breakpoint()`](../library/functions.html#breakpoint "breakpoint") and [`set_trace()`](../library/pdb.html#pdb.set_trace "pdb.set_trace") now enter the debugger immediately
rather than on the next line of code to be executed. This change prevents the
debugger from breaking outside of the context when `breakpoint()` is positioned
at the end of the context.
(Contributed by Tian Gao in [gh\-118579](https://github.com/python/cpython/issues/118579).)
* `sys.path[0]` is no longer replaced by the directory of the script
being debugged when [`sys.flags.safe_path`](../library/sys.html#sys.flags.safe_path "sys.flags.safe_path") is set.
(Contributed by Tian Gao and Christian Walther in [gh\-111762](https://github.com/python/cpython/issues/111762).)
* [`zipapp`](../library/zipapp.html#module-zipapp "zipapp: Manage executable Python zip archives") is now supported as a debugging target.
(Contributed by Tian Gao in [gh\-118501](https://github.com/python/cpython/issues/118501).)
* Add ability to move between chained exceptions during
post\-mortem debugging in [`pm()`](../library/pdb.html#pdb.pm "pdb.pm") using
the new [`exceptions [exc_number]`](../library/pdb.html#pdbcommand-exceptions) command for Pdb.
(Contributed by Matthias Bussonnier in [gh\-106676](https://github.com/python/cpython/issues/106676).)
* Expressions and statements whose prefix is a pdb command are now correctly
identified and executed.
(Contributed by Tian Gao in [gh\-108464](https://github.com/python/cpython/issues/108464).)

### queue[¶](#queue "Link to this heading")

* Add [`Queue.shutdown`](../library/queue.html#queue.Queue.shutdown "queue.Queue.shutdown") and [`ShutDown`](../library/queue.html#queue.ShutDown "queue.ShutDown")
to manage queue termination.
(Contributed by Laurie Opperman and Yves Duprat in [gh\-104750](https://github.com/python/cpython/issues/104750).)

### random[¶](#random "Link to this heading")

* Add a [command\-line interface](../library/random.html#random-cli).
(Contributed by Hugo van Kemenade in [gh\-118131](https://github.com/python/cpython/issues/118131).)

### re[¶](#re "Link to this heading")

* Rename `re.error` to [`PatternError`](../library/re.html#re.PatternError "re.PatternError") for improved clarity.
`re.error` is kept for backward compatibility.

### shutil[¶](#shutil "Link to this heading")

* Support the *dir\_fd* and *follow\_symlinks* keyword arguments
in [`chown()`](../library/shutil.html#shutil.chown "shutil.chown").
(Contributed by Berker Peksag and Tahia K in [gh\-62308](https://github.com/python/cpython/issues/62308))

### site[¶](#site "Link to this heading")

* `.pth` files are now decoded using UTF\-8 first,
and then with the [locale encoding](../glossary.html#term-locale-encoding) if UTF\-8 decoding fails.
(Contributed by Inada Naoki in [gh\-117802](https://github.com/python/cpython/issues/117802).)

### sqlite3[¶](#sqlite3 "Link to this heading")

* A [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning") is now emitted if a [`Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection")
object is not [`closed`](../library/sqlite3.html#sqlite3.Connection.close "sqlite3.Connection.close") explicitly.
(Contributed by Erlend E. Aasland in [gh\-105539](https://github.com/python/cpython/issues/105539).)
* Add the *filter* keyword\-only parameter to [`Connection.iterdump()`](../library/sqlite3.html#sqlite3.Connection.iterdump "sqlite3.Connection.iterdump")
for filtering database objects to dump.
(Contributed by Mariusz Felisiak in [gh\-91602](https://github.com/python/cpython/issues/91602).)

### ssl[¶](#ssl "Link to this heading")

* The [`create_default_context()`](../library/ssl.html#ssl.create_default_context "ssl.create_default_context") API now includes
[`VERIFY_X509_PARTIAL_CHAIN`](../library/ssl.html#ssl.VERIFY_X509_PARTIAL_CHAIN "ssl.VERIFY_X509_PARTIAL_CHAIN") and [`VERIFY_X509_STRICT`](../library/ssl.html#ssl.VERIFY_X509_STRICT "ssl.VERIFY_X509_STRICT")
in its default flags.

Note

[`VERIFY_X509_STRICT`](../library/ssl.html#ssl.VERIFY_X509_STRICT "ssl.VERIFY_X509_STRICT") may reject pre\-[**RFC 5280**](https://datatracker.ietf.org/doc/html/rfc5280.html)
or malformed certificates that the underlying OpenSSL implementation
might otherwise accept.
Whilst disabling this is not recommended, you can do so using:

\`\`\`
import ssl

ctx = ssl.create\_default\_context()
ctx.verify\_flags \&= \~ssl.VERIFY\_X509\_STRICT

\`\`\`

(Contributed by William Woodruff in [gh\-112389](https://github.com/python/cpython/issues/112389).)

### statistics[¶](#statistics "Link to this heading")

* Add [`kde()`](../library/statistics.html#statistics.kde "statistics.kde") for kernel density estimation.
This makes it possible to estimate a continuous probability density function
from a fixed number of discrete samples.
(Contributed by Raymond Hettinger in [gh\-115863](https://github.com/python/cpython/issues/115863).)
* Add [`kde_random()`](../library/statistics.html#statistics.kde_random "statistics.kde_random") for sampling from an
estimated probability density function created by [`kde()`](../library/statistics.html#statistics.kde "statistics.kde").
(Contributed by Raymond Hettinger in [gh\-115863](https://github.com/python/cpython/issues/115863).)

### subprocess[¶](#subprocess "Link to this heading")

* The [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") module now uses the [`posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") function in
more situations.

Notably, when *close\_fds* is `True` (the default),
[`posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") will be used when the C library provides
`posix_spawn_file_actions_addclosefrom_np()`,
which includes recent versions of Linux, FreeBSD, and Solaris.
On Linux, this should perform similarly to the existing
Linux `vfork()` based code.

A private control knob `subprocess._USE_POSIX_SPAWN` can
be set to `False` if you need to force [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.")
to never use [`posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn").
Please report your reason and platform details in
the [issue tracker](../bugs.html#using-the-tracker) if you set this
so that we can improve our API selection logic for everyone.
(Contributed by Jakub Kulik in [gh\-113117](https://github.com/python/cpython/issues/113117).)

### sys[¶](#sys "Link to this heading")

* Add the [`_is_interned()`](../library/sys.html#sys._is_interned "sys._is_interned") function to test if a string was interned.
This function is not guaranteed to exist in all implementations of Python.
(Contributed by Serhiy Storchaka in [gh\-78573](https://github.com/python/cpython/issues/78573).)

### tempfile[¶](#tempfile "Link to this heading")

* On Windows, the default mode `0o700` used by [`tempfile.mkdtemp()`](../library/tempfile.html#tempfile.mkdtemp "tempfile.mkdtemp") now
limits access to the new directory due to changes to [`os.mkdir()`](../library/os.html#os.mkdir "os.mkdir").
This is a mitigation for [**CVE 2024\-4030**](https://www.cve.org/CVERecord?id=CVE-2024-4030).
(Contributed by Steve Dower in [gh\-118486](https://github.com/python/cpython/issues/118486).)

### time[¶](#time "Link to this heading")

* On Windows, [`monotonic()`](../library/time.html#time.monotonic "time.monotonic") now uses the
`QueryPerformanceCounter()` clock for a resolution of 1 microsecond,
instead of the `GetTickCount64()` clock which has
a resolution of 15\.6 milliseconds.
(Contributed by Victor Stinner in [gh\-88494](https://github.com/python/cpython/issues/88494).)
* On Windows, [`time()`](../library/time.html#time.time "time.time") now uses the
`GetSystemTimePreciseAsFileTime()` clock for a resolution of 1 microsecond,
instead of the `GetSystemTimeAsFileTime()` clock which has
a resolution of 15\.6 milliseconds.
(Contributed by Victor Stinner in [gh\-63207](https://github.com/python/cpython/issues/63207).)

### tkinter[¶](#tkinter "Link to this heading")

* Add [`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") widget methods:
`tk_busy_hold()`, `tk_busy_configure()`,
`tk_busy_cget()`, `tk_busy_forget()`,
`tk_busy_current()`, and `tk_busy_status()`.
(Contributed by Miguel, klappnase and Serhiy Storchaka in [gh\-72684](https://github.com/python/cpython/issues/72684).)
* The [`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") widget method `wm_attributes()` now accepts
the attribute name without the minus prefix to get window attributes,
for example `w.wm_attributes('alpha')`
and allows specifying attributes and values to set as keyword arguments,
for example `w.wm_attributes(alpha=0.5)`.
(Contributed by Serhiy Storchaka in [gh\-43457](https://github.com/python/cpython/issues/43457).)
* `wm_attributes()` can now return attributes as a [`dict`](../library/stdtypes.html#dict "dict"),
by using the new optional keyword\-only parameter *return\_python\_dict*.
(Contributed by Serhiy Storchaka in [gh\-43457](https://github.com/python/cpython/issues/43457).)
* `Text.count()` can now return a simple [`int`](../library/functions.html#int "int")
when the new optional keyword\-only parameter *return\_ints* is used.
Otherwise, the single count is returned as a 1\-tuple or `None`.
(Contributed by Serhiy Storchaka in [gh\-97928](https://github.com/python/cpython/issues/97928).)
* Support the “vsapi” element type in
the [`element_create()`](../library/tkinter.ttk.html#tkinter.ttk.Style.element_create "tkinter.ttk.Style.element_create") method of
[`tkinter.ttk.Style`](../library/tkinter.ttk.html#tkinter.ttk.Style "tkinter.ttk.Style").
(Contributed by Serhiy Storchaka in [gh\-68166](https://github.com/python/cpython/issues/68166).)
* Add the `after_info()` method for Tkinter widgets.
(Contributed by Cheryl Sabella in [gh\-77020](https://github.com/python/cpython/issues/77020).)
* Add a new `copy_replace()` method to `PhotoImage`
to copy a region from one image to another,
possibly with pixel zooming, subsampling, or both.
(Contributed by Serhiy Storchaka in [gh\-118225](https://github.com/python/cpython/issues/118225).)
* Add *from\_coords* parameter to the `PhotoImage` methods
`copy()`, `zoom()` and `subsample()`.
Add *zoom* and *subsample* parameters to the `PhotoImage` method
`copy()`.
(Contributed by Serhiy Storchaka in [gh\-118225](https://github.com/python/cpython/issues/118225).)
* Add the `PhotoImage` methods
`read()` to read an image from a file
and `data()` to get the image data.
Add *background* and *grayscale* parameters to the `write()` method.
(Contributed by Serhiy Storchaka in [gh\-118271](https://github.com/python/cpython/issues/118271).)

### traceback[¶](#traceback "Link to this heading")

* Add the [`exc_type_str`](../library/traceback.html#traceback.TracebackException.exc_type_str "traceback.TracebackException.exc_type_str") attribute
to [`TracebackException`](../library/traceback.html#traceback.TracebackException "traceback.TracebackException"),
which holds a string display of the *exc\_type*.
Deprecate the [`exc_type`](../library/traceback.html#traceback.TracebackException.exc_type "traceback.TracebackException.exc_type") attribute,
which holds the type object itself.
Add parameter *save\_exc\_type* (default `True`)
to indicate whether `exc_type` should be saved.
(Contributed by Irit Katriel in [gh\-112332](https://github.com/python/cpython/issues/112332).)
* Add a new *show\_group* keyword\-only parameter to
[`TracebackException.format_exception_only()`](../library/traceback.html#traceback.TracebackException.format_exception_only "traceback.TracebackException.format_exception_only") to (recursively) format
the nested exceptions of a [`BaseExceptionGroup`](../library/exceptions.html#BaseExceptionGroup "BaseExceptionGroup") instance.
(Contributed by Irit Katriel in [gh\-105292](https://github.com/python/cpython/issues/105292).)

### types[¶](#types "Link to this heading")

* [`SimpleNamespace`](../library/types.html#types.SimpleNamespace "types.SimpleNamespace") can now take a single positional argument
to initialise the namespace’s arguments.
This argument must either be a mapping or an iterable of key\-value pairs.
(Contributed by Serhiy Storchaka in [gh\-108191](https://github.com/python/cpython/issues/108191).)

### typing[¶](#typing "Link to this heading")

* [**PEP 705**](https://peps.python.org/pep-0705/): Add [`ReadOnly`](../library/typing.html#typing.ReadOnly "typing.ReadOnly"), a special typing construct
to mark a [`TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") item as read\-only for type checkers.
* [**PEP 742**](https://peps.python.org/pep-0742/): Add [`TypeIs`](../library/typing.html#typing.TypeIs "typing.TypeIs"), a typing construct
that can be used to instruct a type checker how to narrow a type.
* Add [`NoDefault`](../library/typing.html#typing.NoDefault "typing.NoDefault"), a sentinel object used to represent
the defaults of some parameters in the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module.
(Contributed by Jelle Zijlstra in [gh\-116126](https://github.com/python/cpython/issues/116126).)
* Add [`get_protocol_members()`](../library/typing.html#typing.get_protocol_members "typing.get_protocol_members") to return the set of members
defining a [`typing.Protocol`](../library/typing.html#typing.Protocol "typing.Protocol").
(Contributed by Jelle Zijlstra in [gh\-104873](https://github.com/python/cpython/issues/104873).)
* Add [`is_protocol()`](../library/typing.html#typing.is_protocol "typing.is_protocol") to check whether a class
is a [`Protocol`](../library/typing.html#typing.Protocol "typing.Protocol").
(Contributed by Jelle Zijlstra in [gh\-104873](https://github.com/python/cpython/issues/104873).)
* [`ClassVar`](../library/typing.html#typing.ClassVar "typing.ClassVar") can now be nested in [`Final`](../library/typing.html#typing.Final "typing.Final"),
and vice versa.
(Contributed by Mehdi Drissi in [gh\-89547](https://github.com/python/cpython/issues/89547).)

### unicodedata[¶](#unicodedata "Link to this heading")

* Update the Unicode database to [version 15\.1\.0](https://www.unicode.org/versions/Unicode15.1.0/).
(Contributed by James Gerity in [gh\-109559](https://github.com/python/cpython/issues/109559).)

### venv[¶](#venv "Link to this heading")

* Add support for creating source control management (SCM) ignore files
in a virtual environment’s directory.
By default, Git is supported.
This is implemented as opt\-in via the API,
which can be extended to support other SCMs
([`EnvBuilder`](../library/venv.html#venv.EnvBuilder "venv.EnvBuilder") and [`create()`](../library/venv.html#venv.create "venv.create")),
and opt\-out via the CLI, using `--without-scm-ignore-files`.
(Contributed by Brett Cannon in [gh\-108125](https://github.com/python/cpython/issues/108125).)

### warnings[¶](#warnings "Link to this heading")

* [**PEP 702**](https://peps.python.org/pep-0702/): The new [`warnings.deprecated()`](../library/warnings.html#warnings.deprecated "warnings.deprecated") decorator provides a way to
communicate deprecations to a [static type checker](../glossary.html#term-static-type-checker)
and to warn on usage of deprecated classes and functions.
A [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") may also be emitted when
a decorated function or class is used at runtime.
(Contributed by Jelle Zijlstra in [gh\-104003](https://github.com/python/cpython/issues/104003).)

### xml[¶](#xml "Link to this heading")

* Allow controlling Expat \>=2\.6\.0 reparse deferral ([**CVE 2023\-52425**](https://www.cve.org/CVERecord?id=CVE-2023-52425))
by adding five new methods:

	+ [`xml.etree.ElementTree.XMLParser.flush()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser.flush "xml.etree.ElementTree.XMLParser.flush")
	+ [`xml.etree.ElementTree.XMLPullParser.flush()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLPullParser.flush "xml.etree.ElementTree.XMLPullParser.flush")
	+ [`xml.parsers.expat.xmlparser.GetReparseDeferralEnabled()`](../library/pyexpat.html#xml.parsers.expat.xmlparser.GetReparseDeferralEnabled "xml.parsers.expat.xmlparser.GetReparseDeferralEnabled")
	+ [`xml.parsers.expat.xmlparser.SetReparseDeferralEnabled()`](../library/pyexpat.html#xml.parsers.expat.xmlparser.SetReparseDeferralEnabled "xml.parsers.expat.xmlparser.SetReparseDeferralEnabled")
	+ `xml.sax.expatreader.ExpatParser.flush()`(Contributed by Sebastian Pipping in [gh\-115623](https://github.com/python/cpython/issues/115623).)
* Add the `close()` method for the iterator returned by
[`iterparse()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.iterparse "xml.etree.ElementTree.iterparse") for explicit cleanup.
(Contributed by Serhiy Storchaka in [gh\-69893](https://github.com/python/cpython/issues/69893).)

### zipimport[¶](#zipimport "Link to this heading")

* Add support for [ZIP64](https://en.wikipedia.org/wiki/Zip_(file_format)#ZIP64) format files.
Everybody loves huge data, right?
(Contributed by Tim Hatch in [gh\-94146](https://github.com/python/cpython/issues/94146).)

## Optimizations[¶](#optimizations "Link to this heading")

* Several standard library modules have had
their import times significantly improved.
For example, the import time of the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module
has been reduced by around a third by removing dependencies
on [`re`](../library/re.html#module-re "re: Regular expression operations.") and [`contextlib`](../library/contextlib.html#module-contextlib "contextlib: Utilities for with-statement contexts.").
Other modules to enjoy import\-time speedups include
[`email.utils`](../library/email.utils.html#module-email.utils "email.utils: Miscellaneous email package utilities."), [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class."), [`functools`](../library/functools.html#module-functools "functools: Higher-order functions and operations on callable objects."),
[`importlib.metadata`](../library/importlib.metadata.html#module-importlib.metadata "importlib.metadata: Accessing package metadata"), and [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.").
(Contributed by Alex Waygood, Shantanu Jain, Adam Turner, Daniel Hollas,
and others in [gh\-109653](https://github.com/python/cpython/issues/109653).)
* [`textwrap.indent()`](../library/textwrap.html#textwrap.indent "textwrap.indent") is now around 30% faster than before for large input.
(Contributed by Inada Naoki in [gh\-107369](https://github.com/python/cpython/issues/107369).)
* The [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") module now uses the [`posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") function in
more situations, including when *close\_fds* is `True` (the default)
on many modern platforms.
This should provide a notable performance increase
when launching processes on FreeBSD and Solaris.
See the [subprocess](#whatsnew313-subprocess) section above for details.
(Contributed by Jakub Kulik in [gh\-113117](https://github.com/python/cpython/issues/113117).)

## Removed Modules And APIs[¶](#removed-modules-and-apis "Link to this heading")

### PEP 594: Remove “dead batteries” from the standard library[¶](#pep-594-remove-dead-batteries-from-the-standard-library "Link to this heading")

[**PEP 594**](https://peps.python.org/pep-0594/) proposed removing 19 modules from the standard library,
colloquially referred to as ‘dead batteries’ due to their
historic, obsolete, or insecure status.
All of the following modules were deprecated in Python 3\.11,
and are now removed:

* `aifc`
* `audioop`
* `chunk`
* `cgi` and `cgitb`

	+ `cgi.FieldStorage` can typically be replaced with
	[`urllib.parse.parse_qsl()`](../library/urllib.parse.html#urllib.parse.parse_qsl "urllib.parse.parse_qsl") for `GET` and `HEAD` requests,
	and the [`email.message`](../library/email.message.html#module-email.message "email.message: The base class representing email messages.") module or the [multipart](https://pypi.org/project/multipart/) library
	for `POST` and `PUT` requests.
	+ `cgi.parse()` can be replaced by calling
	[`urllib.parse.parse_qs()`](../library/urllib.parse.html#urllib.parse.parse_qs "urllib.parse.parse_qs") directly on the desired query string,
	unless the input is `multipart/form-data`,
	which should be replaced as described below for `cgi.parse_multipart()`.
	+ `cgi.parse_header()` can be replaced with the functionality
	in the [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") package, which implements the same MIME RFCs.
	For example, with [`email.message.EmailMessage`](../library/email.message.html#email.message.EmailMessage "email.message.EmailMessage"):

	\`\`\`
	from email.message import EmailMessage

	msg = EmailMessage()
	msg\['content\-type'] = 'application/json; charset="utf8"'
	main, params = msg.get\_content\_type(), msg\['content\-type'].params

	\`\`\`
	+ `cgi.parse_multipart()` can be replaced with the functionality
	in the [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") package, which implements the same MIME RFCs,
	or with the [multipart](https://pypi.org/project/multipart/) library.
	For example, the [`email.message.EmailMessage`](../library/email.message.html#email.message.EmailMessage "email.message.EmailMessage")
	and [`email.message.Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message") classes.
* `crypt` and the private `_crypt` extension.
The [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") module may be an appropriate replacement
when simply hashing a value is required.
Otherwise, various third\-party libraries on PyPI are available:

	+ [bcrypt](https://pypi.org/project/bcrypt/):
	Modern password hashing for your software and your servers.
	+ [passlib](https://pypi.org/project/passlib/):
	Comprehensive password hashing framework supporting over 30 schemes.
	+ [argon2\-cffi](https://pypi.org/project/argon2-cffi/):
	The secure Argon2 password hashing algorithm.
	+ [legacycrypt](https://pypi.org/project/legacycrypt/):
	[`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python.") wrapper to the POSIX crypt library call
	and associated functionality.
	+ [crypt\_r](https://pypi.org/project/crypt_r/):
	Fork of the `crypt` module,
	wrapper to the *[crypt\_r(3\)](https://manpages.debian.org/crypt_r(3))* library call
	and associated functionality.
* `imghdr`:
The [filetype](https://pypi.org/project/filetype/), [puremagic](https://pypi.org/project/puremagic/), or [python\-magic](https://pypi.org/project/python-magic/) libraries
should be used as replacements.
For example, the `puremagic.what()` function can be used
to replace the `imghdr.what()` function for all file formats
that were supported by `imghdr`.
* `mailcap`:
Use the [`mimetypes`](../library/mimetypes.html#module-mimetypes "mimetypes: Mapping of filename extensions to MIME types.") module instead.
* `msilib`
* `nis`
* `nntplib`:
Use the [pynntp](https://pypi.org/project/pynntp/) library from PyPI instead.
* `ossaudiodev`:
For audio playback, use the [pygame](https://pypi.org/project/pygame/) library from PyPI instead.
* `pipes`:
Use the [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") module instead.
Use [`shlex.quote()`](../library/shlex.html#shlex.quote "shlex.quote") to replace the undocumented `pipes.quote`
function.
* `sndhdr`:
The [filetype](https://pypi.org/project/filetype/), [puremagic](https://pypi.org/project/puremagic/), or [python\-magic](https://pypi.org/project/python-magic/) libraries
should be used as replacements.
* `spwd`:
Use the [python\-pam](https://pypi.org/project/python-pam/) library from PyPI instead.
* `sunau`
* `telnetlib`,
Use the [telnetlib3](https://pypi.org/project/telnetlib3/) or [Exscript](https://pypi.org/project/Exscript/) libraries from PyPI instead.
* `uu`:
Use the [`base64`](../library/base64.html#module-base64 "base64: RFC 4648: Base16, Base32, Base64 Data Encodings; Base85 and Ascii85") module instead, as a modern alternative.
* `xdrlib`

(Contributed by Victor Stinner and Zachary Ware in [gh\-104773](https://github.com/python/cpython/issues/104773) and [gh\-104780](https://github.com/python/cpython/issues/104780).)

### 2to3[¶](#to3 "Link to this heading")

* Remove the **2to3** program and the `lib2to3` module,
previously deprecated in Python 3\.11\.
(Contributed by Victor Stinner in [gh\-104780](https://github.com/python/cpython/issues/104780).)

### builtins[¶](#builtins "Link to this heading")

* Remove support for chained [`classmethod`](../library/functions.html#classmethod "classmethod") descriptors
(introduced in [gh\-63272](https://github.com/python/cpython/issues/63272)).
These can no longer be used to wrap other descriptors,
such as [`property`](../library/functions.html#property "property").
The core design of this feature was flawed and led to several problems.
To “pass\-through” a [`classmethod`](../library/functions.html#classmethod "classmethod"), consider using
the `__wrapped__` attribute that was added in Python 3\.10\.
(Contributed by Raymond Hettinger in [gh\-89519](https://github.com/python/cpython/issues/89519).)
* Raise a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") when calling [`frame.clear()`](../reference/datamodel.html#frame.clear "frame.clear")
on a suspended frame (as has always been the case for an executing frame).
(Contributed by Irit Katriel in [gh\-79932](https://github.com/python/cpython/issues/79932).)

### configparser[¶](#id3 "Link to this heading")

* Remove the undocumented `LegacyInterpolation` class,
deprecated in the docstring since Python 3\.2,
and at runtime since Python 3\.11\.
(Contributed by Hugo van Kemenade in [gh\-104886](https://github.com/python/cpython/issues/104886).)

### importlib.metadata[¶](#importlib-metadata "Link to this heading")

* Remove deprecated subscript ([`__getitem__()`](../reference/datamodel.html#object.__getitem__ "object.__getitem__")) access for
[EntryPoint](../library/importlib.metadata.html#entry-points) objects.
(Contributed by Jason R. Coombs in [gh\-113175](https://github.com/python/cpython/issues/113175).)

### locale[¶](#locale "Link to this heading")

* Remove the `locale.resetlocale()` function, deprecated in Python 3\.11\.
Use `locale.setlocale(locale.LC_ALL, "")` instead.
(Contributed by Victor Stinner in [gh\-104783](https://github.com/python/cpython/issues/104783).)

### opcode[¶](#opcode "Link to this heading")

* Move `opcode.ENABLE_SPECIALIZATION` to `_opcode.ENABLE_SPECIALIZATION`.
This field was added in 3\.12, it was never documented,
and is not intended for external use.
(Contributed by Irit Katriel in [gh\-105481](https://github.com/python/cpython/issues/105481).)
* Remove `opcode.is_pseudo()`, `opcode.MIN_PSEUDO_OPCODE`,
and `opcode.MAX_PSEUDO_OPCODE`, which were added in Python 3\.12,
but were neither documented nor exposed through [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode."),
and were not intended to be used externally.
(Contributed by Irit Katriel in [gh\-105481](https://github.com/python/cpython/issues/105481).)

### optparse[¶](#optparse "Link to this heading")

* This module is no longer considered [soft deprecated](../glossary.html#term-soft-deprecated).
While [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") remains preferred for new projects that
aren’t using a third party command line argument processing
library, there are aspects of the way `argparse` works that
mean the lower level `optparse` module may provide a better
foundation for *writing* argument processing libraries, and
for implementing command line applications which adhere more
strictly than `argparse` does to various Unix command line
processing conventions that originate in the behaviour of the
C `getopt()` function .
(Contributed by Alyssa Coghlan and Serhiy Storchaka in [gh\-126180](https://github.com/python/cpython/issues/126180).)

### pathlib[¶](#id4 "Link to this heading")

* Remove the ability to use [`Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") objects as context managers.
This functionality was deprecated and has had no effect since Python 3\.9\.
(Contributed by Barney Gale in [gh\-83863](https://github.com/python/cpython/issues/83863).)

### re[¶](#id5 "Link to this heading")

* Remove the undocumented, deprecated, and broken
`re.template()` function and `re.TEMPLATE` / `re.T` flag.
(Contributed by Serhiy Storchaka and Nikita Sobolev in [gh\-105687](https://github.com/python/cpython/issues/105687).)

### tkinter.tix[¶](#tkinter-tix "Link to this heading")

* Remove the `tkinter.tix` module, deprecated in Python 3\.6\.
The third\-party Tix library which the module wrapped is unmaintained.
(Contributed by Zachary Ware in [gh\-75552](https://github.com/python/cpython/issues/75552).)

### turtle[¶](#turtle "Link to this heading")

* Remove the `RawTurtle.settiltangle()` method,
deprecated in the documentation since Python 3\.1
and at runtime since Python 3\.11\.
(Contributed by Hugo van Kemenade in [gh\-104876](https://github.com/python/cpython/issues/104876).)

### typing[¶](#id6 "Link to this heading")

* Remove the `typing.io` and `typing.re` namespaces,
deprecated since Python 3\.8\.
The items in those namespaces can be imported directly
from the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module.
(Contributed by Sebastian Rittau in [gh\-92871](https://github.com/python/cpython/issues/92871).)
* Remove the keyword\-argument method of creating
[`TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") types, deprecated in Python 3\.11\.
(Contributed by Tomas Roun in [gh\-104786](https://github.com/python/cpython/issues/104786).)

### unittest[¶](#unittest "Link to this heading")

* Remove the following [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") functions, deprecated in Python 3\.11:

	+ `unittest.findTestCases()`
	+ `unittest.makeSuite()`
	+ `unittest.getTestCaseNames()`Use [`TestLoader`](../library/unittest.html#unittest.TestLoader "unittest.TestLoader") methods instead:

	+ [`loadTestsFromModule()`](../library/unittest.html#unittest.TestLoader.loadTestsFromModule "unittest.TestLoader.loadTestsFromModule")
	+ [`loadTestsFromTestCase()`](../library/unittest.html#unittest.TestLoader.loadTestsFromTestCase "unittest.TestLoader.loadTestsFromTestCase")
	+ [`getTestCaseNames()`](../library/unittest.html#unittest.TestLoader.getTestCaseNames "unittest.TestLoader.getTestCaseNames")(Contributed by Hugo van Kemenade in [gh\-104835](https://github.com/python/cpython/issues/104835).)
* Remove the untested and undocumented `TestProgram.usageExit()`
method, deprecated in Python 3\.11\.
(Contributed by Hugo van Kemenade in [gh\-104992](https://github.com/python/cpython/issues/104992).)

### urllib[¶](#urllib "Link to this heading")

* Remove the *cafile*, *capath*, and *cadefault* parameters of the
[`urllib.request.urlopen()`](../library/urllib.request.html#urllib.request.urlopen "urllib.request.urlopen") function, deprecated in Python 3\.6\.
Use the *context* parameter instead with an [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") instance.
The [`ssl.SSLContext.load_cert_chain()`](../library/ssl.html#ssl.SSLContext.load_cert_chain "ssl.SSLContext.load_cert_chain") function
can be used to load specific certificates,
or let [`ssl.create_default_context()`](../library/ssl.html#ssl.create_default_context "ssl.create_default_context") select
the operating system’s trusted certificate authority (CA) certificates.
(Contributed by Victor Stinner in [gh\-105382](https://github.com/python/cpython/issues/105382).)

### webbrowser[¶](#webbrowser "Link to this heading")

* Remove the untested and undocumented `MacOSX` class,
deprecated in Python 3\.11\.
Use the `MacOSXOSAScript` class (introduced in Python 3\.2\) instead.
(Contributed by Hugo van Kemenade in [gh\-104804](https://github.com/python/cpython/issues/104804).)
* Remove the deprecated `MacOSXOSAScript._name` attribute.
Use the [`MacOSXOSAScript.name`](../library/webbrowser.html#webbrowser.controller.name "webbrowser.controller.name")
attribute instead.
(Contributed by Nikita Sobolev in [gh\-105546](https://github.com/python/cpython/issues/105546).)

## New Deprecations[¶](#new-deprecations "Link to this heading")

* [User\-defined functions](../reference/datamodel.html#user-defined-funcs):

	+ Deprecate assignment to a function’s [`__code__`](../reference/datamodel.html#function.__code__ "function.__code__") attribute,
	where the new code object’s type does not match the function’s type.
	The different types are:
	plain function, generator, async generator, and coroutine.
	(Contributed by Irit Katriel in [gh\-81137](https://github.com/python/cpython/issues/81137).)
* [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values."):

	+ Deprecate the `'u'` format code (`wchar_t`) at runtime.
	This format code has been deprecated in documentation since Python 3\.3,
	and will be removed in Python 3\.16\.
	Use the `'w'` format code ([`Py_UCS4`](../c-api/unicode.html#c.Py_UCS4 "Py_UCS4"))
	for Unicode characters instead.
	(Contributed by Hugo van Kemenade in [gh\-80480](https://github.com/python/cpython/issues/80480).)
* [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python."):

	+ Deprecate the undocumented `SetPointerType()` function,
	to be removed in Python 3\.15\.
	(Contributed by Victor Stinner in [gh\-105733](https://github.com/python/cpython/issues/105733).)
	+ [Soft\-deprecate](../glossary.html#term-soft-deprecated) the [`ARRAY()`](../library/ctypes.html#ctypes.ARRAY "ctypes.ARRAY")
	function in favour of `type * length` multiplication.
	(Contributed by Victor Stinner in [gh\-105733](https://github.com/python/cpython/issues/105733).)
* [`decimal`](../library/decimal.html#module-decimal "decimal: Implementation of the General Decimal Arithmetic  Specification."):

	+ Deprecate the non\-standard and undocumented [`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal")
	format specifier `'N'`,
	which is only supported in the `decimal` module’s C implementation.
	(Contributed by Serhiy Storchaka in [gh\-89902](https://github.com/python/cpython/issues/89902).)
* [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode."):

	+ Deprecate the `HAVE_ARGUMENT` separator.
	Check membership in [`hasarg`](../library/dis.html#dis.hasarg "dis.hasarg") instead.
	(Contributed by Irit Katriel in [gh\-109319](https://github.com/python/cpython/issues/109319).)
* [`gettext`](../library/gettext.html#module-gettext "gettext: Multilingual internationalization services."):

	+ Deprecate non\-integer numbers as arguments to functions and methods
	that consider plural forms in the `gettext` module,
	even if no translation was found.
	(Contributed by Serhiy Storchaka in [gh\-88434](https://github.com/python/cpython/issues/88434).)
* [`glob`](../library/glob.html#module-glob "glob: Unix shell style pathname pattern expansion."):

	+ Deprecate the undocumented `glob0()` and `glob1()` functions.
	Use [`glob()`](../library/glob.html#glob.glob "glob.glob") and pass a [path\-like object](../glossary.html#term-path-like-object) specifying
	the root directory to the *root\_dir* parameter instead.
	(Contributed by Barney Gale in [gh\-117337](https://github.com/python/cpython/issues/117337).)
* [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers."):

	+ Deprecate [`CGIHTTPRequestHandler`](../library/http.server.html#http.server.CGIHTTPRequestHandler "http.server.CGIHTTPRequestHandler"),
	to be removed in Python 3\.15\.
	Process\-based CGI HTTP servers have been out of favor for a very long time.
	This code was outdated, unmaintained, and rarely used.
	It has a high potential for both security and functionality bugs.
	(Contributed by Gregory P. Smith in [gh\-109096](https://github.com/python/cpython/issues/109096).)
	+ Deprecate the `--cgi` flag to
	the **python \-m http.server** command\-line interface,
	to be removed in Python 3\.15\.
	(Contributed by Gregory P. Smith in [gh\-109096](https://github.com/python/cpython/issues/109096).)
* [`mimetypes`](../library/mimetypes.html#module-mimetypes "mimetypes: Mapping of filename extensions to MIME types."):

	+ [Soft\-deprecate](../glossary.html#term-soft-deprecated) file path arguments
	to [`guess_type()`](../library/mimetypes.html#mimetypes.guess_type "mimetypes.guess_type"),
	use [`guess_file_type()`](../library/mimetypes.html#mimetypes.guess_file_type "mimetypes.guess_file_type") instead.
	(Contributed by Serhiy Storchaka in [gh\-66543](https://github.com/python/cpython/issues/66543).)
* [`re`](../library/re.html#module-re "re: Regular expression operations."):

	+ Deprecate passing the optional *maxsplit*, *count*, or *flags* arguments
	as positional arguments to the module\-level
	[`split()`](../library/re.html#re.split "re.split"), [`sub()`](../library/re.html#re.sub "re.sub"), and [`subn()`](../library/re.html#re.subn "re.subn") functions.
	These parameters will become [keyword\-only](../glossary.html#keyword-only-parameter)
	in a future version of Python.
	(Contributed by Serhiy Storchaka in [gh\-56166](https://github.com/python/cpython/issues/56166).)
* [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths"):

	+ Deprecate [`PurePath.is_reserved()`](../library/pathlib.html#pathlib.PurePath.is_reserved "pathlib.PurePath.is_reserved"),
	to be removed in Python 3\.15\.
	Use [`os.path.isreserved()`](../library/os.path.html#os.path.isreserved "os.path.isreserved") to detect reserved paths on Windows.
	(Contributed by Barney Gale in [gh\-88569](https://github.com/python/cpython/issues/88569).)
* [`platform`](../library/platform.html#module-platform "platform: Retrieves as much platform identifying data as possible."):

	+ Deprecate [`java_ver()`](../library/platform.html#platform.java_ver "platform.java_ver"),
	to be removed in Python 3\.15\.
	This function is only useful for Jython support, has a confusing API,
	and is largely untested.
	(Contributed by Nikita Sobolev in [gh\-116349](https://github.com/python/cpython/issues/116349).)
* [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system."):

	+ Deprecate the undocumented `ispackage()` function.
	(Contributed by Zackery Spytz in [gh\-64020](https://github.com/python/cpython/issues/64020).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x."):

	+ Deprecate passing more than one positional argument to
	the [`connect()`](../library/sqlite3.html#sqlite3.connect "sqlite3.connect") function
	and the [`Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") constructor.
	The remaining parameters will become keyword\-only in Python 3\.15\.
	(Contributed by Erlend E. Aasland in [gh\-107948](https://github.com/python/cpython/issues/107948).)
	+ Deprecate passing name, number of arguments, and the callable as keyword
	arguments for [`Connection.create_function()`](../library/sqlite3.html#sqlite3.Connection.create_function "sqlite3.Connection.create_function")
	and [`Connection.create_aggregate()`](../library/sqlite3.html#sqlite3.Connection.create_aggregate "sqlite3.Connection.create_aggregate")
	These parameters will become positional\-only in Python 3\.15\.
	(Contributed by Erlend E. Aasland in [gh\-108278](https://github.com/python/cpython/issues/108278).)
	+ Deprecate passing the callback callable by keyword for the
	[`set_authorizer()`](../library/sqlite3.html#sqlite3.Connection.set_authorizer "sqlite3.Connection.set_authorizer"),
	[`set_progress_handler()`](../library/sqlite3.html#sqlite3.Connection.set_progress_handler "sqlite3.Connection.set_progress_handler"), and
	[`set_trace_callback()`](../library/sqlite3.html#sqlite3.Connection.set_trace_callback "sqlite3.Connection.set_trace_callback")
	[`Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") methods.
	The callback callables will become positional\-only in Python 3\.15\.
	(Contributed by Erlend E. Aasland in [gh\-108278](https://github.com/python/cpython/issues/108278).)
* [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions."):

	+ Deprecate the [`_enablelegacywindowsfsencoding()`](../library/sys.html#sys._enablelegacywindowsfsencoding "sys._enablelegacywindowsfsencoding") function,
	to be removed in Python 3\.16\.
	Use the [`PYTHONLEGACYWINDOWSFSENCODING`](../using/cmdline.html#envvar-PYTHONLEGACYWINDOWSFSENCODING) environment variable instead.
	(Contributed by Inada Naoki in [gh\-73427](https://github.com/python/cpython/issues/73427).)
* [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."):

	+ Deprecate the undocumented and unused `TarFile.tarfile` attribute,
	to be removed in Python 3\.16\.
	(Contributed in [gh\-115256](https://github.com/python/cpython/issues/115256).)
* [`traceback`](../library/traceback.html#module-traceback "traceback: Print or retrieve a stack traceback."):

	+ Deprecate the [`TracebackException.exc_type`](../library/traceback.html#traceback.TracebackException.exc_type "traceback.TracebackException.exc_type") attribute.
	Use [`TracebackException.exc_type_str`](../library/traceback.html#traceback.TracebackException.exc_type_str "traceback.TracebackException.exc_type_str") instead.
	(Contributed by Irit Katriel in [gh\-112332](https://github.com/python/cpython/issues/112332).)
* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."):

	+ Deprecate the undocumented keyword argument syntax for creating
	[`NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") classes
	(e.g. `Point = NamedTuple("Point", x=int, y=int)`),
	to be removed in Python 3\.15\.
	Use the class\-based syntax or the functional syntax instead.
	(Contributed by Alex Waygood in [gh\-105566](https://github.com/python/cpython/issues/105566).)
	+ Deprecate omitting the *fields* parameter when creating
	a [`NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") or [`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict") class,
	and deprecate passing `None` to the *fields* parameter of both types.
	Python 3\.15 will require a valid sequence for the *fields* parameter.
	To create a NamedTuple class with zero fields,
	use `class NT(NamedTuple): pass` or `NT = NamedTuple("NT", ())`.
	To create a TypedDict class with zero fields,
	use `class TD(TypedDict): pass` or `TD = TypedDict("TD", {})`.
	(Contributed by Alex Waygood in [gh\-105566](https://github.com/python/cpython/issues/105566) and [gh\-105570](https://github.com/python/cpython/issues/105570).)
	+ Deprecate the [`typing.no_type_check_decorator()`](../library/typing.html#typing.no_type_check_decorator "typing.no_type_check_decorator") decorator function,
	to be removed in in Python 3\.15\.
	After eight years in the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module,
	it has yet to be supported by any major type checker.
	(Contributed by Alex Waygood in [gh\-106309](https://github.com/python/cpython/issues/106309).)
	+ Deprecate [`typing.AnyStr`](../library/typing.html#typing.AnyStr "typing.AnyStr").
	In Python 3\.16, it will be removed from `typing.__all__`,
	and a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") will be emitted at runtime
	when it is imported or accessed.
	It will be removed entirely in Python 3\.18\.
	Use the new [type parameter syntax](../reference/compound_stmts.html#type-params) instead.
	(Contributed by Michael The in [gh\-107116](https://github.com/python/cpython/issues/107116).)
* [`wave`](../library/wave.html#module-wave "wave: Provide an interface to the WAV sound format."):

	+ Deprecate the [`getmark()`](../library/wave.html#wave.Wave_read.getmark "wave.Wave_read.getmark"), `setmark()`,
	and [`getmarkers()`](../library/wave.html#wave.Wave_read.getmarkers "wave.Wave_read.getmarkers") methods of
	the [`Wave_read`](../library/wave.html#wave.Wave_read "wave.Wave_read") and [`Wave_write`](../library/wave.html#wave.Wave_write "wave.Wave_write") classes,
	to be removed in Python 3\.15\.
	(Contributed by Victor Stinner in [gh\-105096](https://github.com/python/cpython/issues/105096).)

### Pending Removal in Python 3\.14[¶](#pending-removal-in-python-3-14 "Link to this heading")

* [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."): The *type*, *choices*, and *metavar* parameters
of `argparse.BooleanOptionalAction` are deprecated
and will be removed in 3\.14\.
(Contributed by Nikita Sobolev in [gh\-92248](https://github.com/python/cpython/issues/92248).)
* [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation."): The following features have been deprecated in documentation
since Python 3\.8, now cause a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") to be emitted at
runtime when they are accessed or used, and will be removed in Python 3\.14:

	+ `ast.Num`
	+ `ast.Str`
	+ `ast.Bytes`
	+ `ast.NameConstant`
	+ `ast.Ellipsis`Use [`ast.Constant`](../library/ast.html#ast.Constant "ast.Constant") instead.
(Contributed by Serhiy Storchaka in [gh\-90953](https://github.com/python/cpython/issues/90953).)
* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."):

	+ The child watcher classes [`MultiLoopChildWatcher`](../library/asyncio-policy.html#asyncio.MultiLoopChildWatcher "asyncio.MultiLoopChildWatcher"),
	[`FastChildWatcher`](../library/asyncio-policy.html#asyncio.FastChildWatcher "asyncio.FastChildWatcher"), [`AbstractChildWatcher`](../library/asyncio-policy.html#asyncio.AbstractChildWatcher "asyncio.AbstractChildWatcher")
	and [`SafeChildWatcher`](../library/asyncio-policy.html#asyncio.SafeChildWatcher "asyncio.SafeChildWatcher") are deprecated and
	will be removed in Python 3\.14\.
	(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
	+ [`asyncio.set_child_watcher()`](../library/asyncio-policy.html#asyncio.set_child_watcher "asyncio.set_child_watcher"), [`asyncio.get_child_watcher()`](../library/asyncio-policy.html#asyncio.get_child_watcher "asyncio.get_child_watcher"),
	[`asyncio.AbstractEventLoopPolicy.set_child_watcher()`](../library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.set_child_watcher "asyncio.AbstractEventLoopPolicy.set_child_watcher") and
	[`asyncio.AbstractEventLoopPolicy.get_child_watcher()`](../library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.get_child_watcher "asyncio.AbstractEventLoopPolicy.get_child_watcher") are deprecated
	and will be removed in Python 3\.14\.
	(Contributed by Kumar Aditya in [gh\-94597](https://github.com/python/cpython/issues/94597).)
	+ The [`get_event_loop()`](../library/asyncio-eventloop.html#asyncio.get_event_loop "asyncio.get_event_loop") method of the
	default event loop policy now emits a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") if there
	is no current event loop set and it decides to create one.
	(Contributed by Serhiy Storchaka and Guido van Rossum in [gh\-100160](https://github.com/python/cpython/issues/100160).)
* [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers"): Deprecated [`ByteString`](../library/collections.abc.html#collections.abc.ByteString "collections.abc.ByteString").
Prefer `Sequence` or [`Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer").
For use in typing, prefer a union, like `bytes | bytearray`,
or [`collections.abc.Buffer`](../library/collections.abc.html#collections.abc.Buffer "collections.abc.Buffer").
(Contributed by Shantanu Jain in [gh\-91896](https://github.com/python/cpython/issues/91896).)
* [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages."): Deprecated the *isdst* parameter in [`email.utils.localtime()`](../library/email.utils.html#email.utils.localtime "email.utils.localtime").
(Contributed by Alan Williams in [gh\-72346](https://github.com/python/cpython/issues/72346).)
* [`importlib.abc`](../library/importlib.html#module-importlib.abc "importlib.abc: Abstract base classes related to import") deprecated classes:

	+ `importlib.abc.ResourceReader`
	+ `importlib.abc.Traversable`
	+ `importlib.abc.TraversableResources`Use [`importlib.resources.abc`](../library/importlib.resources.abc.html#module-importlib.resources.abc "importlib.resources.abc: Abstract base classes for resources") classes instead:

	+ [`importlib.resources.abc.Traversable`](../library/importlib.resources.abc.html#importlib.resources.abc.Traversable "importlib.resources.abc.Traversable")
	+ [`importlib.resources.abc.TraversableResources`](../library/importlib.resources.abc.html#importlib.resources.abc.TraversableResources "importlib.resources.abc.TraversableResources")(Contributed by Jason R. Coombs and Hugo van Kemenade in [gh\-93963](https://github.com/python/cpython/issues/93963).)
* [`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping.") had undocumented, inefficient, historically buggy,
and inconsistent support for copy, deepcopy, and pickle operations.
This will be removed in 3\.14 for a significant reduction in code
volume and maintenance burden.
(Contributed by Raymond Hettinger in [gh\-101588](https://github.com/python/cpython/issues/101588).)
* [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism."): The default start method will change to a safer one on
Linux, BSDs, and other non\-macOS POSIX platforms where `'fork'` is currently
the default ([gh\-84559](https://github.com/python/cpython/issues/84559)). Adding a runtime warning about this was deemed too
disruptive as the majority of code is not expected to care. Use the
[`get_context()`](../library/multiprocessing.html#multiprocessing.get_context "multiprocessing.get_context") or
[`set_start_method()`](../library/multiprocessing.html#multiprocessing.set_start_method "multiprocessing.set_start_method") APIs to explicitly specify when
your code *requires* `'fork'`. See [Contexts and start methods](../library/multiprocessing.html#multiprocessing-start-methods).
* [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths"): [`is_relative_to()`](../library/pathlib.html#pathlib.PurePath.is_relative_to "pathlib.PurePath.is_relative_to") and
[`relative_to()`](../library/pathlib.html#pathlib.PurePath.relative_to "pathlib.PurePath.relative_to"): passing additional arguments is
deprecated.
* [`pkgutil`](../library/pkgutil.html#module-pkgutil "pkgutil: Utilities for the import system."): [`find_loader()`](../library/pkgutil.html#pkgutil.find_loader "pkgutil.find_loader") and [`get_loader()`](../library/pkgutil.html#pkgutil.get_loader "pkgutil.get_loader")
now raise [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning");
use [`importlib.util.find_spec()`](../library/importlib.html#importlib.util.find_spec "importlib.util.find_spec") instead.
(Contributed by Nikita Sobolev in [gh\-97850](https://github.com/python/cpython/issues/97850).)
* [`pty`](../library/pty.html#module-pty "pty: Pseudo-Terminal Handling for Unix. (Unix)"):

	+ `master_open()`: use [`pty.openpty()`](../library/pty.html#pty.openpty "pty.openpty").
	+ `slave_open()`: use [`pty.openpty()`](../library/pty.html#pty.openpty "pty.openpty").
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x."):

	+ [`version`](../library/sqlite3.html#sqlite3.version "sqlite3.version") and [`version_info`](../library/sqlite3.html#sqlite3.version_info "sqlite3.version_info").
	+ [`execute()`](../library/sqlite3.html#sqlite3.Cursor.execute "sqlite3.Cursor.execute") and [`executemany()`](../library/sqlite3.html#sqlite3.Cursor.executemany "sqlite3.Cursor.executemany")
	if [named placeholders](../library/sqlite3.html#sqlite3-placeholders) are used and
	*parameters* is a sequence instead of a [`dict`](../library/stdtypes.html#dict "dict").
* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."): [`ByteString`](../library/typing.html#typing.ByteString "typing.ByteString"), deprecated since Python 3\.9,
now causes a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") to be emitted when it is used.
* [`urllib`](../library/urllib.html#module-urllib "urllib"):
`urllib.parse.Quoter` is deprecated: it was not intended to be a
public API.
(Contributed by Gregory P. Smith in [gh\-88168](https://github.com/python/cpython/issues/88168).)

### Pending Removal in Python 3\.15[¶](#pending-removal-in-python-3-15 "Link to this heading")

* The import system:

	+ Setting [`__cached__`](../reference/datamodel.html#module.__cached__ "module.__cached__") on a module while
	failing to set [`__spec__.cached`](../library/importlib.html#importlib.machinery.ModuleSpec.cached "importlib.machinery.ModuleSpec.cached")
	is deprecated. In Python 3\.15, `__cached__` will cease to be set or
	take into consideration by the import system or standard library. ([gh\-97879](https://github.com/python/cpython/issues/97879))
	+ Setting [`__package__`](../reference/datamodel.html#module.__package__ "module.__package__") on a module while
	failing to set [`__spec__.parent`](../library/importlib.html#importlib.machinery.ModuleSpec.parent "importlib.machinery.ModuleSpec.parent")
	is deprecated. In Python 3\.15, `__package__` will cease to be set or
	take into consideration by the import system or standard library. ([gh\-97879](https://github.com/python/cpython/issues/97879))
* [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python."):

	+ The undocumented `ctypes.SetPointerType()` function
	has been deprecated since Python 3\.13\.
* [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers."):

	+ The obsolete and rarely used [`CGIHTTPRequestHandler`](../library/http.server.html#http.server.CGIHTTPRequestHandler "http.server.CGIHTTPRequestHandler")
	has been deprecated since Python 3\.13\.
	No direct replacement exists.
	*Anything* is better than CGI to interface
	a web server with a request handler.
	+ The `--cgi` flag to the **python \-m http.server**
	command\-line interface has been deprecated since Python 3\.13\.
* [`locale`](../library/locale.html#module-locale "locale: Internationalization services."):

	+ The [`getdefaultlocale()`](../library/locale.html#locale.getdefaultlocale "locale.getdefaultlocale") function
	has been deprecated since Python 3\.11\.
	Its removal was originally planned for Python 3\.13 ([gh\-90817](https://github.com/python/cpython/issues/90817)),
	but has been postponed to Python 3\.15\.
	Use [`getlocale()`](../library/locale.html#locale.getlocale "locale.getlocale"), [`setlocale()`](../library/locale.html#locale.setlocale "locale.setlocale"),
	and [`getencoding()`](../library/locale.html#locale.getencoding "locale.getencoding") instead.
	(Contributed by Hugo van Kemenade in [gh\-111187](https://github.com/python/cpython/issues/111187).)
* [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths"):

	+ [`PurePath.is_reserved()`](../library/pathlib.html#pathlib.PurePath.is_reserved "pathlib.PurePath.is_reserved")
	has been deprecated since Python 3\.13\.
	Use [`os.path.isreserved()`](../library/os.path.html#os.path.isreserved "os.path.isreserved") to detect reserved paths on Windows.
* [`platform`](../library/platform.html#module-platform "platform: Retrieves as much platform identifying data as possible."):

	+ [`java_ver()`](../library/platform.html#platform.java_ver "platform.java_ver") has been deprecated since Python 3\.13\.
	This function is only useful for Jython support, has a confusing API,
	and is largely untested.
* [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism."):

	+ [`RLock()`](../library/threading.html#threading.RLock "threading.RLock") will take no arguments in Python 3\.15\.
	Passing any arguments has been deprecated since Python 3\.14,
	as the Python version does not permit any arguments,
	but the C version allows any number of positional or keyword arguments,
	ignoring every argument.
* [`types`](../library/types.html#module-types "types: Names for built-in types."):

	+ [`types.CodeType`](../library/types.html#types.CodeType "types.CodeType"): Accessing [`co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab") was
	deprecated in [**PEP 626**](https://peps.python.org/pep-0626/)
	since 3\.10 and was planned to be removed in 3\.12,
	but it only got a proper [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") in 3\.12\.
	May be removed in 3\.15\.
	(Contributed by Nikita Sobolev in [gh\-101866](https://github.com/python/cpython/issues/101866).)
* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."):

	+ The undocumented keyword argument syntax for creating
	[`NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") classes
	(e.g. `Point = NamedTuple("Point", x=int, y=int)`)
	has been deprecated since Python 3\.13\.
	Use the class\-based syntax or the functional syntax instead.
	+ The [`typing.no_type_check_decorator()`](../library/typing.html#typing.no_type_check_decorator "typing.no_type_check_decorator") decorator function
	has been deprecated since Python 3\.13\.
	After eight years in the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module,
	it has yet to be supported by any major type checker.
* [`wave`](../library/wave.html#module-wave "wave: Provide an interface to the WAV sound format."):

	+ The [`getmark()`](../library/wave.html#wave.Wave_read.getmark "wave.Wave_read.getmark"), `setmark()`,
	and [`getmarkers()`](../library/wave.html#wave.Wave_read.getmarkers "wave.Wave_read.getmarkers") methods of
	the [`Wave_read`](../library/wave.html#wave.Wave_read "wave.Wave_read") and [`Wave_write`](../library/wave.html#wave.Wave_write "wave.Wave_write") classes
	have been deprecated since Python 3\.13\.

### Pending removal in Python 3\.16[¶](#pending-removal-in-python-3-16 "Link to this heading")

* The import system:

	+ Setting [`__loader__`](../reference/datamodel.html#module.__loader__ "module.__loader__") on a module while
	failing to set [`__spec__.loader`](../library/importlib.html#importlib.machinery.ModuleSpec.loader "importlib.machinery.ModuleSpec.loader")
	is deprecated. In Python 3\.16, `__loader__` will cease to be set or
	taken into consideration by the import system or the standard library.
* [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values."):

	+ The `'u'` format code (`wchar_t`)
	has been deprecated in documentation since Python 3\.3
	and at runtime since Python 3\.13\.
	Use the `'w'` format code ([`Py_UCS4`](../c-api/unicode.html#c.Py_UCS4 "Py_UCS4"))
	for Unicode characters instead.
* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."):

	+ `asyncio.iscoroutinefunction()` is deprecated
	and will be removed in Python 3\.16,
	use [`inspect.iscoroutinefunction()`](../library/inspect.html#inspect.iscoroutinefunction "inspect.iscoroutinefunction") instead.
	(Contributed by Jiahao Li and Kumar Aditya in [gh\-122875](https://github.com/python/cpython/issues/122875).)
* [`builtins`](../library/builtins.html#module-builtins "builtins: The module that provides the built-in namespace."):

	+ Bitwise inversion on boolean types, `~True` or `~False`
	has been deprecated since Python 3\.12,
	as it produces surprising and unintuitive results (`-2` and `-1`).
	Use `not x` instead for the logical negation of a Boolean.
	In the rare case that you need the bitwise inversion of
	the underlying integer, convert to `int` explicitly (`~int(x)`).
* [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying."):

	+ The `ExecError` exception
	has been deprecated since Python 3\.14\.
	It has not been used by any function in `shutil` since Python 3\.4,
	and is now an alias of [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError").
* [`symtable`](../library/symtable.html#module-symtable "symtable: Interface to the compiler's internal symbol tables."):

	+ The [`Class.get_methods`](../library/symtable.html#symtable.Class.get_methods "symtable.Class.get_methods") method
	has been deprecated since Python 3\.14\.
* [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions."):

	+ The [`_enablelegacywindowsfsencoding()`](../library/sys.html#sys._enablelegacywindowsfsencoding "sys._enablelegacywindowsfsencoding") function
	has been deprecated since Python 3\.13\.
	Use the [`PYTHONLEGACYWINDOWSFSENCODING`](../using/cmdline.html#envvar-PYTHONLEGACYWINDOWSFSENCODING) environment variable instead.
* [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."):

	+ The undocumented and unused `TarFile.tarfile` attribute
	has been deprecated since Python 3\.13\.

### Pending Removal in Future Versions[¶](#pending-removal-in-future-versions "Link to this heading")

The following APIs will be removed in the future,
although there is currently no date scheduled for their removal.

* [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."): Nesting argument groups and nesting mutually exclusive
groups are deprecated.
* [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values.")’s `'u'` format code ([gh\-57281](https://github.com/python/cpython/issues/57281))
* [`builtins`](../library/builtins.html#module-builtins "builtins: The module that provides the built-in namespace."):

	+ `bool(NotImplemented)`.
	+ Generators: `throw(type, exc, tb)` and `athrow(type, exc, tb)`
	signature is deprecated: use `throw(exc)` and `athrow(exc)` instead,
	the single argument signature.
	+ Currently Python accepts numeric literals immediately followed by keywords,
	for example `0in x`, `1or x`, `0if 1else 2`. It allows confusing and
	ambiguous expressions like `[0x1for x in y]` (which can be interpreted as
	`[0x1 for x in y]` or `[0x1f or x in y]`). A syntax warning is raised
	if the numeric literal is immediately followed by one of keywords
	[`and`](../reference/expressions.html#and), [`else`](../reference/compound_stmts.html#else), [`for`](../reference/compound_stmts.html#for), [`if`](../reference/compound_stmts.html#if),
	[`in`](../reference/expressions.html#in), [`is`](../reference/expressions.html#is) and [`or`](../reference/expressions.html#or). In a future release it
	will be changed to a syntax error. ([gh\-87999](https://github.com/python/cpython/issues/87999))
	+ Support for `__index__()` and `__int__()` method returning non\-int type:
	these methods will be required to return an instance of a strict subclass of
	[`int`](../library/functions.html#int "int").
	+ Support for `__float__()` method returning a strict subclass of
	[`float`](../library/functions.html#float "float"): these methods will be required to return an instance of
	[`float`](../library/functions.html#float "float").
	+ Support for `__complex__()` method returning a strict subclass of
	[`complex`](../library/functions.html#complex "complex"): these methods will be required to return an instance of
	[`complex`](../library/functions.html#complex "complex").
	+ Delegation of `int()` to `__trunc__()` method.
	+ Passing a complex number as the *real* or *imag* argument in the
	[`complex()`](../library/functions.html#complex "complex") constructor is now deprecated; it should only be passed
	as a single positional argument.
	(Contributed by Serhiy Storchaka in [gh\-109218](https://github.com/python/cpython/issues/109218).)
* [`calendar`](../library/calendar.html#module-calendar "calendar: Functions for working with calendars, including some emulation of the Unix cal program."): `calendar.January` and `calendar.February` constants are
deprecated and replaced by [`calendar.JANUARY`](../library/calendar.html#calendar.JANUARY "calendar.JANUARY") and
[`calendar.FEBRUARY`](../library/calendar.html#calendar.FEBRUARY "calendar.FEBRUARY").
(Contributed by Prince Roshan in [gh\-103636](https://github.com/python/cpython/issues/103636).)
* [`codeobject.co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab"): use the [`codeobject.co_lines()`](../reference/datamodel.html#codeobject.co_lines "codeobject.co_lines") method
instead.
* [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types."):

	+ [`utcnow()`](../library/datetime.html#datetime.datetime.utcnow "datetime.datetime.utcnow"):
	use `datetime.datetime.now(tz=datetime.UTC)`.
	+ [`utcfromtimestamp()`](../library/datetime.html#datetime.datetime.utcfromtimestamp "datetime.datetime.utcfromtimestamp"):
	use `datetime.datetime.fromtimestamp(timestamp, tz=datetime.UTC)`.
* [`gettext`](../library/gettext.html#module-gettext "gettext: Multilingual internationalization services."): Plural value must be an integer.
* [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery."):

	+ `load_module()` method: use `exec_module()` instead.
	+ [`cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source") *debug\_override* parameter is
	deprecated: use the *optimization* parameter instead.
* [`importlib.metadata`](../library/importlib.metadata.html#module-importlib.metadata "importlib.metadata: Accessing package metadata"):

	+ `EntryPoints` tuple interface.
	+ Implicit `None` on return values.
* [`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications."): the `warn()` method has been deprecated
since Python 3\.3, use [`warning()`](../library/logging.html#logging.warning "logging.warning") instead.
* [`mailbox`](../library/mailbox.html#module-mailbox "mailbox: Manipulate mailboxes in various formats"): Use of StringIO input and text mode is deprecated, use
BytesIO and binary mode instead.
* [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces."): Calling [`os.register_at_fork()`](../library/os.html#os.register_at_fork "os.register_at_fork") in multi\-threaded process.
* `pydoc.ErrorDuringImport`: A tuple value for *exc\_info* parameter is
deprecated, use an exception instance.
* [`re`](../library/re.html#module-re "re: Regular expression operations."): More strict rules are now applied for numerical group references
and group names in regular expressions. Only sequence of ASCII digits is now
accepted as a numerical reference. The group name in bytes patterns and
replacement strings can now only contain ASCII letters and digits and
underscore.
(Contributed by Serhiy Storchaka in [gh\-91760](https://github.com/python/cpython/issues/91760).)
* `sre_compile`, `sre_constants` and `sre_parse` modules.
* [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying."): [`rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree")’s *onerror* parameter is deprecated in
Python 3\.12; use the *onexc* parameter instead.
* [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") options and protocols:

	+ [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") without protocol argument is deprecated.
	+ [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext"): [`set_npn_protocols()`](../library/ssl.html#ssl.SSLContext.set_npn_protocols "ssl.SSLContext.set_npn_protocols") and
	`selected_npn_protocol()` are deprecated: use ALPN
	instead.
	+ `ssl.OP_NO_SSL*` options
	+ `ssl.OP_NO_TLS*` options
	+ `ssl.PROTOCOL_SSLv3`
	+ `ssl.PROTOCOL_TLS`
	+ `ssl.PROTOCOL_TLSv1`
	+ `ssl.PROTOCOL_TLSv1_1`
	+ `ssl.PROTOCOL_TLSv1_2`
	+ `ssl.TLSVersion.SSLv3`
	+ `ssl.TLSVersion.TLSv1`
	+ `ssl.TLSVersion.TLSv1_1`
* [`sysconfig.is_python_build()`](../library/sysconfig.html#sysconfig.is_python_build "sysconfig.is_python_build") *check\_home* parameter is deprecated and
ignored.
* [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") methods:

	+ `threading.Condition.notifyAll()`: use [`notify_all()`](../library/threading.html#threading.Condition.notify_all "threading.Condition.notify_all").
	+ `threading.Event.isSet()`: use [`is_set()`](../library/threading.html#threading.Event.is_set "threading.Event.is_set").
	+ `threading.Thread.isDaemon()`, [`threading.Thread.setDaemon()`](../library/threading.html#threading.Thread.setDaemon "threading.Thread.setDaemon"):
	use [`threading.Thread.daemon`](../library/threading.html#threading.Thread.daemon "threading.Thread.daemon") attribute.
	+ `threading.Thread.getName()`, [`threading.Thread.setName()`](../library/threading.html#threading.Thread.setName "threading.Thread.setName"):
	use [`threading.Thread.name`](../library/threading.html#threading.Thread.name "threading.Thread.name") attribute.
	+ `threading.currentThread()`: use [`threading.current_thread()`](../library/threading.html#threading.current_thread "threading.current_thread").
	+ `threading.activeCount()`: use [`threading.active_count()`](../library/threading.html#threading.active_count "threading.active_count").
* [`typing.Text`](../library/typing.html#typing.Text "typing.Text") ([gh\-92332](https://github.com/python/cpython/issues/92332)).
* [`unittest.IsolatedAsyncioTestCase`](../library/unittest.html#unittest.IsolatedAsyncioTestCase "unittest.IsolatedAsyncioTestCase"): it is deprecated to return a value
that is not `None` from a test case.
* [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") deprecated functions: [`urlparse()`](../library/urllib.parse.html#urllib.parse.urlparse "urllib.parse.urlparse") instead

	+ `splitattr()`
	+ `splithost()`
	+ `splitnport()`
	+ `splitpasswd()`
	+ `splitport()`
	+ `splitquery()`
	+ `splittag()`
	+ `splittype()`
	+ `splituser()`
	+ `splitvalue()`
	+ `to_bytes()`
* [`urllib.request`](../library/urllib.request.html#module-urllib.request "urllib.request: Extensible library for opening URLs."): [`URLopener`](../library/urllib.request.html#urllib.request.URLopener "urllib.request.URLopener") and
[`FancyURLopener`](../library/urllib.request.html#urllib.request.FancyURLopener "urllib.request.FancyURLopener") style of invoking requests is
deprecated. Use newer [`urlopen()`](../library/urllib.request.html#urllib.request.urlopen "urllib.request.urlopen") functions and methods.
* [`wsgiref`](../library/wsgiref.html#module-wsgiref "wsgiref: WSGI Utilities and Reference Implementation."): `SimpleHandler.stdout.write()` should not do partial
writes.
* [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API."): Testing the truth value of an
[`Element`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element "xml.etree.ElementTree.Element") is deprecated. In a future release it
will always return `True`. Prefer explicit `len(elem)` or
`elem is not None` tests instead.
* [`zipimport.zipimporter.load_module()`](../library/zipimport.html#zipimport.zipimporter.load_module "zipimport.zipimporter.load_module") is deprecated:
use [`exec_module()`](../library/zipimport.html#zipimport.zipimporter.exec_module "zipimport.zipimporter.exec_module") instead.

## CPython Bytecode Changes[¶](#cpython-bytecode-changes "Link to this heading")

* The oparg of [`YIELD_VALUE`](../library/dis.html#opcode-YIELD_VALUE) is now
`1` if the yield is part of a yield\-from or await, and `0` otherwise.
The oparg of [`RESUME`](../library/dis.html#opcode-RESUME) was changed to add a bit indicating
if the except\-depth is 1, which is needed to optimize closing of generators.
(Contributed by Irit Katriel in [gh\-111354](https://github.com/python/cpython/issues/111354).)

## C API Changes[¶](#c-api-changes "Link to this heading")

### New Features[¶](#id7 "Link to this heading")

* Add the [PyMonitoring C API](../c-api/monitoring.html#c-api-monitoring)
for generating [**PEP 669**](https://peps.python.org/pep-0669/) monitoring events:

	+ [`PyMonitoringState`](../c-api/monitoring.html#c.PyMonitoringState "PyMonitoringState")
	+ [`PyMonitoring_FirePyStartEvent()`](../c-api/monitoring.html#c.PyMonitoring_FirePyStartEvent "PyMonitoring_FirePyStartEvent")
	+ [`PyMonitoring_FirePyResumeEvent()`](../c-api/monitoring.html#c.PyMonitoring_FirePyResumeEvent "PyMonitoring_FirePyResumeEvent")
	+ [`PyMonitoring_FirePyReturnEvent()`](../c-api/monitoring.html#c.PyMonitoring_FirePyReturnEvent "PyMonitoring_FirePyReturnEvent")
	+ [`PyMonitoring_FirePyYieldEvent()`](../c-api/monitoring.html#c.PyMonitoring_FirePyYieldEvent "PyMonitoring_FirePyYieldEvent")
	+ [`PyMonitoring_FireCallEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireCallEvent "PyMonitoring_FireCallEvent")
	+ [`PyMonitoring_FireLineEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireLineEvent "PyMonitoring_FireLineEvent")
	+ [`PyMonitoring_FireJumpEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireJumpEvent "PyMonitoring_FireJumpEvent")
	+ [`PyMonitoring_FireBranchEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireBranchEvent "PyMonitoring_FireBranchEvent")
	+ [`PyMonitoring_FireCReturnEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireCReturnEvent "PyMonitoring_FireCReturnEvent")
	+ [`PyMonitoring_FirePyThrowEvent()`](../c-api/monitoring.html#c.PyMonitoring_FirePyThrowEvent "PyMonitoring_FirePyThrowEvent")
	+ [`PyMonitoring_FireRaiseEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireRaiseEvent "PyMonitoring_FireRaiseEvent")
	+ [`PyMonitoring_FireCRaiseEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireCRaiseEvent "PyMonitoring_FireCRaiseEvent")
	+ [`PyMonitoring_FireReraiseEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireReraiseEvent "PyMonitoring_FireReraiseEvent")
	+ [`PyMonitoring_FireExceptionHandledEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireExceptionHandledEvent "PyMonitoring_FireExceptionHandledEvent")
	+ [`PyMonitoring_FirePyUnwindEvent()`](../c-api/monitoring.html#c.PyMonitoring_FirePyUnwindEvent "PyMonitoring_FirePyUnwindEvent")
	+ [`PyMonitoring_FireStopIterationEvent()`](../c-api/monitoring.html#c.PyMonitoring_FireStopIterationEvent "PyMonitoring_FireStopIterationEvent")
	+ [`PyMonitoring_EnterScope()`](../c-api/monitoring.html#c.PyMonitoring_EnterScope "PyMonitoring_EnterScope")
	+ [`PyMonitoring_ExitScope()`](../c-api/monitoring.html#c.PyMonitoring_ExitScope "PyMonitoring_ExitScope")(Contributed by Irit Katriel in [gh\-111997](https://github.com/python/cpython/issues/111997)).
* Add [`PyMutex`](../c-api/init.html#c.PyMutex "PyMutex"), a lightweight mutex that occupies a single byte,
and the new [`PyMutex_Lock()`](../c-api/init.html#c.PyMutex_Lock "PyMutex_Lock") and [`PyMutex_Unlock()`](../c-api/init.html#c.PyMutex_Unlock "PyMutex_Unlock") functions.
`PyMutex_Lock()` will release the [GIL](../glossary.html#term-GIL) (if currently held)
if the operation needs to block.
(Contributed by Sam Gross in [gh\-108724](https://github.com/python/cpython/issues/108724).)
* Add the [PyTime C API](../c-api/time.html#c-api-time) to provide access to system clocks:

	+ [`PyTime_t`](../c-api/time.html#c.PyTime_t "PyTime_t").
	+ [`PyTime_MIN`](../c-api/time.html#c.PyTime_MIN "PyTime_MIN") and [`PyTime_MAX`](../c-api/time.html#c.PyTime_MAX "PyTime_MAX").
	+ [`PyTime_AsSecondsDouble()`](../c-api/time.html#c.PyTime_AsSecondsDouble "PyTime_AsSecondsDouble").
	+ [`PyTime_Monotonic()`](../c-api/time.html#c.PyTime_Monotonic "PyTime_Monotonic").
	+ [`PyTime_MonotonicRaw()`](../c-api/time.html#c.PyTime_MonotonicRaw "PyTime_MonotonicRaw").
	+ [`PyTime_PerfCounter()`](../c-api/time.html#c.PyTime_PerfCounter "PyTime_PerfCounter").
	+ [`PyTime_PerfCounterRaw()`](../c-api/time.html#c.PyTime_PerfCounterRaw "PyTime_PerfCounterRaw").
	+ [`PyTime_Time()`](../c-api/time.html#c.PyTime_Time "PyTime_Time").
	+ [`PyTime_TimeRaw()`](../c-api/time.html#c.PyTime_TimeRaw "PyTime_TimeRaw").(Contributed by Victor Stinner and Petr Viktorin in [gh\-110850](https://github.com/python/cpython/issues/110850).)
* Add the [`PyDict_ContainsString()`](../c-api/dict.html#c.PyDict_ContainsString "PyDict_ContainsString") function
with the same behavior as [`PyDict_Contains()`](../c-api/dict.html#c.PyDict_Contains "PyDict_Contains"),
but *key* is specified as a const char\* UTF\-8 encoded bytes string,
rather than a [PyObject](../c-api/structures.html#c.PyObject "PyObject")\*.
(Contributed by Victor Stinner in [gh\-108314](https://github.com/python/cpython/issues/108314).)
* Add the [`PyDict_GetItemRef()`](../c-api/dict.html#c.PyDict_GetItemRef "PyDict_GetItemRef") and [`PyDict_GetItemStringRef()`](../c-api/dict.html#c.PyDict_GetItemStringRef "PyDict_GetItemStringRef")
functions,
which behave similarly to [`PyDict_GetItemWithError()`](../c-api/dict.html#c.PyDict_GetItemWithError "PyDict_GetItemWithError"),
but return a [strong reference](../glossary.html#term-strong-reference) instead of a [borrowed reference](../glossary.html#term-borrowed-reference).
Moreover, these functions return `-1` on error,
removing the need to check `PyErr_Occurred()`.
(Contributed by Victor Stinner in [gh\-106004](https://github.com/python/cpython/issues/106004).)
* Add the [`PyDict_SetDefaultRef()`](../c-api/dict.html#c.PyDict_SetDefaultRef "PyDict_SetDefaultRef") function,
which behaves similarly to [`PyDict_SetDefault()`](../c-api/dict.html#c.PyDict_SetDefault "PyDict_SetDefault"),
but returns a [strong reference](../glossary.html#term-strong-reference) instead of a [borrowed reference](../glossary.html#term-borrowed-reference).
This function returns `-1` on error,
`0` on insertion,
and `1` if the key was already present in the dictionary.
(Contributed by Sam Gross in [gh\-112066](https://github.com/python/cpython/issues/112066).)
* Add the [`PyDict_Pop()`](../c-api/dict.html#c.PyDict_Pop "PyDict_Pop") and [`PyDict_PopString()`](../c-api/dict.html#c.PyDict_PopString "PyDict_PopString") functions
to remove a key from a dictionary and optionally return the removed value.
This is similar to [`dict.pop()`](../library/stdtypes.html#dict.pop "dict.pop"),
though there is no default value,
and [`KeyError`](../library/exceptions.html#KeyError "KeyError") is not raised for missing keys.
(Contributed by Stefan Behnel and Victor Stinner in [gh\-111262](https://github.com/python/cpython/issues/111262).)
* Add the [`PyMapping_GetOptionalItem()`](../c-api/mapping.html#c.PyMapping_GetOptionalItem "PyMapping_GetOptionalItem")
and [`PyMapping_GetOptionalItemString()`](../c-api/mapping.html#c.PyMapping_GetOptionalItemString "PyMapping_GetOptionalItemString") functions
as alternatives to [`PyObject_GetItem()`](../c-api/object.html#c.PyObject_GetItem "PyObject_GetItem")
and [`PyMapping_GetItemString()`](../c-api/mapping.html#c.PyMapping_GetItemString "PyMapping_GetItemString") respectively.
The new functions do not raise [`KeyError`](../library/exceptions.html#KeyError "KeyError")
if the requested key is missing from the mapping.
These variants are more convenient and faster
if a missing key should not be treated as a failure.
(Contributed by Serhiy Storchaka in [gh\-106307](https://github.com/python/cpython/issues/106307).)
* Add the [`PyObject_GetOptionalAttr()`](../c-api/object.html#c.PyObject_GetOptionalAttr "PyObject_GetOptionalAttr")
and [`PyObject_GetOptionalAttrString()`](../c-api/object.html#c.PyObject_GetOptionalAttrString "PyObject_GetOptionalAttrString") functions
as alternatives to [`PyObject_GetAttr()`](../c-api/object.html#c.PyObject_GetAttr "PyObject_GetAttr")
and [`PyObject_GetAttrString()`](../c-api/object.html#c.PyObject_GetAttrString "PyObject_GetAttrString") respectively.
The new functions do not raise [`AttributeError`](../library/exceptions.html#AttributeError "AttributeError")
if the requested attribute is not found on the object.
These variants are more convenient and faster
if the missing attribute should not be treated as a failure.
(Contributed by Serhiy Storchaka in [gh\-106521](https://github.com/python/cpython/issues/106521).)
* Add the [`PyErr_FormatUnraisable()`](../c-api/exceptions.html#c.PyErr_FormatUnraisable "PyErr_FormatUnraisable") function
as an extension to [`PyErr_WriteUnraisable()`](../c-api/exceptions.html#c.PyErr_WriteUnraisable "PyErr_WriteUnraisable")
that allows customizing the warning message.
(Contributed by Serhiy Storchaka in [gh\-108082](https://github.com/python/cpython/issues/108082).)
* Add new functions that return a [strong reference](../glossary.html#term-strong-reference) instead of
a [borrowed reference](../glossary.html#term-borrowed-reference) for frame locals, globals, and builtins,
as part of [PEP 667](#whatsnew313-locals-semantics):

	+ [`PyEval_GetFrameBuiltins()`](../c-api/reflection.html#c.PyEval_GetFrameBuiltins "PyEval_GetFrameBuiltins") replaces [`PyEval_GetBuiltins()`](../c-api/reflection.html#c.PyEval_GetBuiltins "PyEval_GetBuiltins")
	+ [`PyEval_GetFrameGlobals()`](../c-api/reflection.html#c.PyEval_GetFrameGlobals "PyEval_GetFrameGlobals") replaces [`PyEval_GetGlobals()`](../c-api/reflection.html#c.PyEval_GetGlobals "PyEval_GetGlobals")
	+ [`PyEval_GetFrameLocals()`](../c-api/reflection.html#c.PyEval_GetFrameLocals "PyEval_GetFrameLocals") replaces [`PyEval_GetLocals()`](../c-api/reflection.html#c.PyEval_GetLocals "PyEval_GetLocals")(Contributed by Mark Shannon and Tian Gao in [gh\-74929](https://github.com/python/cpython/issues/74929).)
* Add the [`Py_GetConstant()`](../c-api/object.html#c.Py_GetConstant "Py_GetConstant") and [`Py_GetConstantBorrowed()`](../c-api/object.html#c.Py_GetConstantBorrowed "Py_GetConstantBorrowed")
functions to get [strong](../glossary.html#term-strong-reference)
or [borrowed](../glossary.html#term-borrowed-reference) references to constants.
For example, `Py_GetConstant(Py_CONSTANT_ZERO)` returns a strong reference
to the constant zero.
(Contributed by Victor Stinner in [gh\-115754](https://github.com/python/cpython/issues/115754).)
* Add the [`PyImport_AddModuleRef()`](../c-api/import.html#c.PyImport_AddModuleRef "PyImport_AddModuleRef") function
as a replacement for [`PyImport_AddModule()`](../c-api/import.html#c.PyImport_AddModule "PyImport_AddModule")
that returns a [strong reference](../glossary.html#term-strong-reference) instead of a [borrowed reference](../glossary.html#term-borrowed-reference).
(Contributed by Victor Stinner in [gh\-105922](https://github.com/python/cpython/issues/105922).)
* Add the [`Py_IsFinalizing()`](../c-api/init.html#c.Py_IsFinalizing "Py_IsFinalizing") function to check
whether the main Python interpreter is
[shutting down](../glossary.html#term-interpreter-shutdown).
(Contributed by Victor Stinner in [gh\-108014](https://github.com/python/cpython/issues/108014).)
* Add the [`PyList_GetItemRef()`](../c-api/list.html#c.PyList_GetItemRef "PyList_GetItemRef") function
as a replacement for [`PyList_GetItem()`](../c-api/list.html#c.PyList_GetItem "PyList_GetItem")
that returns a [strong reference](../glossary.html#term-strong-reference) instead of a [borrowed reference](../glossary.html#term-borrowed-reference).
(Contributed by Sam Gross in [gh\-114329](https://github.com/python/cpython/issues/114329).)
* Add the [`PyList_Extend()`](../c-api/list.html#c.PyList_Extend "PyList_Extend") and [`PyList_Clear()`](../c-api/list.html#c.PyList_Clear "PyList_Clear") functions,
mirroring the Python `list.extend()` and `list.clear()` methods.
(Contributed by Victor Stinner in [gh\-111138](https://github.com/python/cpython/issues/111138).)
* Add the [`PyLong_AsInt()`](../c-api/long.html#c.PyLong_AsInt "PyLong_AsInt") function.
It behaves similarly to [`PyLong_AsLong()`](../c-api/long.html#c.PyLong_AsLong "PyLong_AsLong"),
but stores the result in a C int instead of a C long.
(Contributed by Victor Stinner in [gh\-108014](https://github.com/python/cpython/issues/108014).)
* Add the [`PyLong_AsNativeBytes()`](../c-api/long.html#c.PyLong_AsNativeBytes "PyLong_AsNativeBytes"), [`PyLong_FromNativeBytes()`](../c-api/long.html#c.PyLong_FromNativeBytes "PyLong_FromNativeBytes"),
and [`PyLong_FromUnsignedNativeBytes()`](../c-api/long.html#c.PyLong_FromUnsignedNativeBytes "PyLong_FromUnsignedNativeBytes") functions
to simplify converting between native integer types
and Python [`int`](../library/functions.html#int "int") objects.
(Contributed by Steve Dower in [gh\-111140](https://github.com/python/cpython/issues/111140).)
* Add [`PyModule_Add()`](../c-api/module.html#c.PyModule_Add "PyModule_Add") function, which is similar to
[`PyModule_AddObjectRef()`](../c-api/module.html#c.PyModule_AddObjectRef "PyModule_AddObjectRef") and [`PyModule_AddObject()`](../c-api/module.html#c.PyModule_AddObject "PyModule_AddObject"),
but always steals a reference to the value.
(Contributed by Serhiy Storchaka in [gh\-86493](https://github.com/python/cpython/issues/86493).)
* Add the [`PyObject_GenericHash()`](../c-api/hash.html#c.PyObject_GenericHash "PyObject_GenericHash") function
that implements the default hashing function of a Python object.
(Contributed by Serhiy Storchaka in [gh\-113024](https://github.com/python/cpython/issues/113024).)
* Add the [`Py_HashPointer()`](../c-api/hash.html#c.Py_HashPointer "Py_HashPointer") function to hash a raw pointer.
(Contributed by Victor Stinner in [gh\-111545](https://github.com/python/cpython/issues/111545).)
* Add the [`PyObject_VisitManagedDict()`](../c-api/object.html#c.PyObject_VisitManagedDict "PyObject_VisitManagedDict") and
[`PyObject_ClearManagedDict()`](../c-api/object.html#c.PyObject_ClearManagedDict "PyObject_ClearManagedDict") functions.
which must be called by the traverse and clear functions of a type using
the [`Py_TPFLAGS_MANAGED_DICT`](../c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT "Py_TPFLAGS_MANAGED_DICT") flag.
The [pythoncapi\-compat project](https://github.com/python/pythoncapi-compat/) can be used to
use these functions with Python 3\.11 and 3\.12\.
(Contributed by Victor Stinner in [gh\-107073](https://github.com/python/cpython/issues/107073).)
* Add the [`PyRefTracer_SetTracer()`](../c-api/init.html#c.PyRefTracer_SetTracer "PyRefTracer_SetTracer")
and [`PyRefTracer_GetTracer()`](../c-api/init.html#c.PyRefTracer_GetTracer "PyRefTracer_GetTracer") functions,
which enable tracking object creation and destruction
in the same way that the [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") module does.
(Contributed by Pablo Galindo in [gh\-93502](https://github.com/python/cpython/issues/93502).)
* Add the [`PySys_AuditTuple()`](../c-api/sys.html#c.PySys_AuditTuple "PySys_AuditTuple") function
as an alternative to [`PySys_Audit()`](../c-api/sys.html#c.PySys_Audit "PySys_Audit")
that takes event arguments as a Python [`tuple`](../library/stdtypes.html#tuple "tuple") object.
(Contributed by Victor Stinner in [gh\-85283](https://github.com/python/cpython/issues/85283).)
* Add the [`PyThreadState_GetUnchecked()`](../c-api/init.html#c.PyThreadState_GetUnchecked "PyThreadState_GetUnchecked") function
as an alternative to [`PyThreadState_Get()`](../c-api/init.html#c.PyThreadState_Get "PyThreadState_Get")
that doesn’t kill the process with a fatal error if it is `NULL`.
The caller is responsible for checking if the result is `NULL`.
(Contributed by Victor Stinner in [gh\-108867](https://github.com/python/cpython/issues/108867).)
* Add the [`PyType_GetFullyQualifiedName()`](../c-api/type.html#c.PyType_GetFullyQualifiedName "PyType_GetFullyQualifiedName") function
to get the type’s fully qualified name.
The module name is prepended if [`type.__module__`](../reference/datamodel.html#type.__module__ "type.__module__") is
a string and is not equal to either `'builtins'` or `'__main__'`.
(Contributed by Victor Stinner in [gh\-111696](https://github.com/python/cpython/issues/111696).)
* Add the [`PyType_GetModuleName()`](../c-api/type.html#c.PyType_GetModuleName "PyType_GetModuleName") function
to get the type’s module name. This is equivalent to getting the
[`type.__module__`](../reference/datamodel.html#type.__module__ "type.__module__") attribute.
(Contributed by Eric Snow and Victor Stinner in [gh\-111696](https://github.com/python/cpython/issues/111696).)
* Add the [`PyUnicode_EqualToUTF8AndSize()`](../c-api/unicode.html#c.PyUnicode_EqualToUTF8AndSize "PyUnicode_EqualToUTF8AndSize")
and [`PyUnicode_EqualToUTF8()`](../c-api/unicode.html#c.PyUnicode_EqualToUTF8 "PyUnicode_EqualToUTF8") functions
to compare a Unicode object with a const char\* UTF\-8 encoded string
and `1` if they are equal or `0` otherwise.
These functions do not raise exceptions.
(Contributed by Serhiy Storchaka in [gh\-110289](https://github.com/python/cpython/issues/110289).)
* Add the [`PyWeakref_GetRef()`](../c-api/weakref.html#c.PyWeakref_GetRef "PyWeakref_GetRef") function
as an alternative to [`PyWeakref_GetObject()`](../c-api/weakref.html#c.PyWeakref_GetObject "PyWeakref_GetObject")
that returns a [strong reference](../glossary.html#term-strong-reference)
or `NULL` if the referent is no longer live.
(Contributed by Victor Stinner in [gh\-105927](https://github.com/python/cpython/issues/105927).)
* Add fixed variants of functions which silently ignore errors:

	+ [`PyObject_HasAttrWithError()`](../c-api/object.html#c.PyObject_HasAttrWithError "PyObject_HasAttrWithError") replaces [`PyObject_HasAttr()`](../c-api/object.html#c.PyObject_HasAttr "PyObject_HasAttr").
	+ [`PyObject_HasAttrStringWithError()`](../c-api/object.html#c.PyObject_HasAttrStringWithError "PyObject_HasAttrStringWithError")
	replaces [`PyObject_HasAttrString()`](../c-api/object.html#c.PyObject_HasAttrString "PyObject_HasAttrString").
	+ [`PyMapping_HasKeyWithError()`](../c-api/mapping.html#c.PyMapping_HasKeyWithError "PyMapping_HasKeyWithError") replaces [`PyMapping_HasKey()`](../c-api/mapping.html#c.PyMapping_HasKey "PyMapping_HasKey").
	+ [`PyMapping_HasKeyStringWithError()`](../c-api/mapping.html#c.PyMapping_HasKeyStringWithError "PyMapping_HasKeyStringWithError")
	replaces [`PyMapping_HasKeyString()`](../c-api/mapping.html#c.PyMapping_HasKeyString "PyMapping_HasKeyString").The new functions return `-1` for errors
and the standard `1` for true and `0` for false.

(Contributed by Serhiy Storchaka in [gh\-108511](https://github.com/python/cpython/issues/108511).)

### Changed C APIs[¶](#changed-c-apis "Link to this heading")

* The *keywords* parameter of [`PyArg_ParseTupleAndKeywords()`](../c-api/arg.html#c.PyArg_ParseTupleAndKeywords "PyArg_ParseTupleAndKeywords")
and [`PyArg_VaParseTupleAndKeywords()`](../c-api/arg.html#c.PyArg_VaParseTupleAndKeywords "PyArg_VaParseTupleAndKeywords")
now has type char \*const\* in C
and const char \*const\* in C\+\+,
instead of char\*\*.
In C\+\+, this makes these functions compatible with arguments
of type const char \*const\*, const char\*\*,
or char \*const\* without an explicit type cast.
In C, the functions only support arguments of type char \*const\*.
This can be overridden with the [`PY_CXX_CONST`](../c-api/arg.html#c.PY_CXX_CONST "PY_CXX_CONST") macro.
(Contributed by Serhiy Storchaka in [gh\-65210](https://github.com/python/cpython/issues/65210).)
* [`PyArg_ParseTupleAndKeywords()`](../c-api/arg.html#c.PyArg_ParseTupleAndKeywords "PyArg_ParseTupleAndKeywords") now supports
non\-ASCII keyword parameter names.
(Contributed by Serhiy Storchaka in [gh\-110815](https://github.com/python/cpython/issues/110815).)
* The `PyCode_GetFirstFree()` function is now unstable API
and is now named [`PyUnstable_Code_GetFirstFree()`](../c-api/code.html#c.PyUnstable_Code_GetFirstFree "PyUnstable_Code_GetFirstFree").
(Contributed by Bogdan Romanyuk in [gh\-115781](https://github.com/python/cpython/issues/115781).)
* The [`PyDict_GetItem()`](../c-api/dict.html#c.PyDict_GetItem "PyDict_GetItem"), [`PyDict_GetItemString()`](../c-api/dict.html#c.PyDict_GetItemString "PyDict_GetItemString"),
[`PyMapping_HasKey()`](../c-api/mapping.html#c.PyMapping_HasKey "PyMapping_HasKey"), [`PyMapping_HasKeyString()`](../c-api/mapping.html#c.PyMapping_HasKeyString "PyMapping_HasKeyString"),
[`PyObject_HasAttr()`](../c-api/object.html#c.PyObject_HasAttr "PyObject_HasAttr"), [`PyObject_HasAttrString()`](../c-api/object.html#c.PyObject_HasAttrString "PyObject_HasAttrString"),
and [`PySys_GetObject()`](../c-api/sys.html#c.PySys_GetObject "PySys_GetObject") functions,
each of which clears all errors which occurred when calling them
now reports these errors using [`sys.unraisablehook()`](../library/sys.html#sys.unraisablehook "sys.unraisablehook").
You may replace them with other functions as recommended in the documentation.
(Contributed by Serhiy Storchaka in [gh\-106672](https://github.com/python/cpython/issues/106672).)
* Add support for the `%T`, `%#T`, `%N` and `%#N` formats
to [`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat"):

	+ `%T`: Get the fully qualified name of an object type
	+ `%#T`: As above, but use a colon as the separator
	+ `%N`: Get the fully qualified name of a type
	+ `%#N`: As above, but use a colon as the separatorSee [**PEP 737**](https://peps.python.org/pep-0737/) for more information.
(Contributed by Victor Stinner in [gh\-111696](https://github.com/python/cpython/issues/111696).)
* You no longer have to define the `PY_SSIZE_T_CLEAN` macro before
including `Python.h` when using `#` formats in
[format codes](../c-api/arg.html#arg-parsing-string-and-buffers).
APIs accepting the format codes always use `Py_ssize_t` for `#` formats.
(Contributed by Inada Naoki in [gh\-104922](https://github.com/python/cpython/issues/104922).)
* If Python is built in [debug mode](../using/configure.html#debug-build)
or [`with assertions`](../using/configure.html#cmdoption-with-assertions),
[`PyTuple_SET_ITEM()`](../c-api/tuple.html#c.PyTuple_SET_ITEM "PyTuple_SET_ITEM") and [`PyList_SET_ITEM()`](../c-api/list.html#c.PyList_SET_ITEM "PyList_SET_ITEM")
now check the index argument with an assertion.
(Contributed by Victor Stinner in [gh\-106168](https://github.com/python/cpython/issues/106168).)

### Limited C API Changes[¶](#limited-c-api-changes "Link to this heading")

* The following functions are now included in the Limited C API:

	+ [`PyMem_RawMalloc()`](../c-api/memory.html#c.PyMem_RawMalloc "PyMem_RawMalloc")
	+ [`PyMem_RawCalloc()`](../c-api/memory.html#c.PyMem_RawCalloc "PyMem_RawCalloc")
	+ [`PyMem_RawRealloc()`](../c-api/memory.html#c.PyMem_RawRealloc "PyMem_RawRealloc")
	+ [`PyMem_RawFree()`](../c-api/memory.html#c.PyMem_RawFree "PyMem_RawFree")
	+ [`PySys_Audit()`](../c-api/sys.html#c.PySys_Audit "PySys_Audit")
	+ [`PySys_AuditTuple()`](../c-api/sys.html#c.PySys_AuditTuple "PySys_AuditTuple")
	+ [`PyType_GetModuleByDef()`](../c-api/type.html#c.PyType_GetModuleByDef "PyType_GetModuleByDef")(Contributed by Victor Stinner in [gh\-85283](https://github.com/python/cpython/issues/85283), [gh\-85283](https://github.com/python/cpython/issues/85283), and [gh\-116936](https://github.com/python/cpython/issues/116936).)
* Python built with [`--with-trace-refs`](../using/configure.html#cmdoption-with-trace-refs) (tracing references)
now supports the [Limited API](../c-api/stable.html#limited-c-api).
(Contributed by Victor Stinner in [gh\-108634](https://github.com/python/cpython/issues/108634).)

### Removed C APIs[¶](#removed-c-apis "Link to this heading")

* Remove several functions, macros, variables, etc
with names prefixed by `_Py` or `_PY` (which are considered private).
If your project is affected by one of these removals
and you believe that the removed API should remain available,
please [open a new issue](../bugs.html#using-the-tracker) to request a public C API
and add `cc: @vstinner` to the issue to notify Victor Stinner.
(Contributed by Victor Stinner in [gh\-106320](https://github.com/python/cpython/issues/106320).)
* Remove old buffer protocols deprecated in Python 3\.0\.
Use [Buffer Protocol](../c-api/buffer.html#bufferobjects) instead.

	+ `PyObject_CheckReadBuffer()`:
	Use [`PyObject_CheckBuffer()`](../c-api/buffer.html#c.PyObject_CheckBuffer "PyObject_CheckBuffer") to test
	whether the object supports the buffer protocol.
	Note that [`PyObject_CheckBuffer()`](../c-api/buffer.html#c.PyObject_CheckBuffer "PyObject_CheckBuffer") doesn’t guarantee
	that [`PyObject_GetBuffer()`](../c-api/buffer.html#c.PyObject_GetBuffer "PyObject_GetBuffer") will succeed.
	To test if the object is actually readable,
	see the next example of [`PyObject_GetBuffer()`](../c-api/buffer.html#c.PyObject_GetBuffer "PyObject_GetBuffer").
	+ `PyObject_AsCharBuffer()`, `PyObject_AsReadBuffer()`:
	Use [`PyObject_GetBuffer()`](../c-api/buffer.html#c.PyObject_GetBuffer "PyObject_GetBuffer") and [`PyBuffer_Release()`](../c-api/buffer.html#c.PyBuffer_Release "PyBuffer_Release") instead:

	\`\`\`
	Py\_buffer view;
	if (PyObject\_GetBuffer(obj, \&view, PyBUF\_SIMPLE) \` standard header. It was
included for the `finite()` function which is now provided by the
`` header. It should now be included explicitly if needed. Remove
also the `HAVE_IEEEFP_H` macro.
(Contributed by Victor Stinner in [gh\-108765](https://github.com/python/cpython/issues/108765).)
* `Python.h` no longer includes these standard header files: ``,
`` and ``. If needed, they should now be
included explicitly. For example, `` provides the `clock()` and
`gmtime()` functions, `` provides the `select()`
function, and `` provides the `futimes()`, `gettimeofday()`
and `setitimer()` functions.
(Contributed by Victor Stinner in [gh\-108765](https://github.com/python/cpython/issues/108765).)
* On Windows, `Python.h` no longer includes the `` standard
header file. If needed, it should now be included explicitly. For example, it
provides `offsetof()` function, and `size_t` and `ptrdiff_t` types.
Including `` explicitly was already needed by all other
platforms, the `HAVE_STDDEF_H` macro is only defined on Windows.
(Contributed by Victor Stinner in [gh\-108765](https://github.com/python/cpython/issues/108765).)
* If the [`Py_LIMITED_API`](../c-api/stable.html#c.Py_LIMITED_API "Py_LIMITED_API") macro is defined, `Py_BUILD_CORE`,
`Py_BUILD_CORE_BUILTIN` and `Py_BUILD_CORE_MODULE` macros
are now undefined by ``.
(Contributed by Victor Stinner in [gh\-85283](https://github.com/python/cpython/issues/85283).)
* The old trashcan macros `Py_TRASHCAN_SAFE_BEGIN` and `Py_TRASHCAN_SAFE_END`
were removed. They should be replaced by the new macros `Py_TRASHCAN_BEGIN`
and `Py_TRASHCAN_END`.

A `tp_dealloc` function that has the old macros, such as:

\`\`\`
static void
mytype\_dealloc(mytype \*p)
{
 PyObject\_GC\_UnTrack(p);
 Py\_TRASHCAN\_SAFE\_BEGIN(p);
 ...
 Py\_TRASHCAN\_SAFE\_END
}

\`\`\`

should migrate to the new macros as follows:

\`\`\`
static void
mytype\_dealloc(mytype \*p)
{
 PyObject\_GC\_UnTrack(p);
 Py\_TRASHCAN\_BEGIN(p, mytype\_dealloc)
 ...
 Py\_TRASHCAN\_END
}

\`\`\`

Note that `Py_TRASHCAN_BEGIN` has a second argument which
should be the deallocation function it is in. The new macros were
added in Python 3\.8 and the old macros were deprecated in Python 3\.11\.
(Contributed by Irit Katriel in [gh\-105111](https://github.com/python/cpython/issues/105111).)

* [PEP 667](#whatsnew313-locals-semantics) introduces several changes
to frame\-related functions:

	+ The effects of mutating the dictionary returned from
	[`PyEval_GetLocals()`](../c-api/reflection.html#c.PyEval_GetLocals "PyEval_GetLocals") in an [optimized scope](../glossary.html#term-optimized-scope) have changed.
	New dict entries added this way will now *only* be visible to
	subsequent [`PyEval_GetLocals()`](../c-api/reflection.html#c.PyEval_GetLocals "PyEval_GetLocals") calls in that frame,
	as [`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals"), [`locals()`](../library/functions.html#locals "locals"),
	and [`FrameType.f_locals`](../reference/datamodel.html#frame.f_locals "frame.f_locals") no longer access
	the same underlying cached dictionary.
	Changes made to entries for actual variable names and names added via
	the write\-through proxy interfaces will be overwritten on subsequent calls
	to [`PyEval_GetLocals()`](../c-api/reflection.html#c.PyEval_GetLocals "PyEval_GetLocals") in that frame.
	The recommended code update depends on how the function was being used,
	so refer to the deprecation notice on the function for details.
	+ Calling [`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals") in an [optimized scope](../glossary.html#term-optimized-scope)
	now returns a write\-through proxy rather than a snapshot
	that gets updated at ill\-specified times.
	If a snapshot is desired, it must be created explicitly
	(e.g. with [`PyDict_Copy()`](../c-api/dict.html#c.PyDict_Copy "PyDict_Copy")),
	or by calling the new [`PyEval_GetFrameLocals()`](../c-api/reflection.html#c.PyEval_GetFrameLocals "PyEval_GetFrameLocals") API.
	+ `PyFrame_FastToLocals()` and `PyFrame_FastToLocalsWithError()`
	no longer have any effect.
	Calling these functions has been redundant since Python 3\.11,
	when [`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals") was first introduced.
	+ `PyFrame_LocalsToFast()` no longer has any effect.
	Calling this function is redundant now that [`PyFrame_GetLocals()`](../c-api/frame.html#c.PyFrame_GetLocals "PyFrame_GetLocals")
	returns a write\-through proxy for [optimized scopes](../glossary.html#term-optimized-scope).

## Regression Test Changes[¶](#regression-test-changes "Link to this heading")

* Python built with `configure` [`--with-pydebug`](../using/configure.html#cmdoption-with-pydebug) now
supports a [`-X presite=package.module`](../using/cmdline.html#cmdoption-X) command\-line
option. If used, it specifies a module that should be imported early
in the lifecycle of the interpreter, before `site.py` is executed.
(Contributed by Łukasz Langa in [gh\-110769](https://github.com/python/cpython/issues/110769).)

## Notable changes in 3\.13\.1[¶](#notable-changes-in-3-13-1 "Link to this heading")

### sys[¶](#id11 "Link to this heading")

* The previously undocumented special function [`sys.getobjects()`](../library/sys.html#sys.getobjects "sys.getobjects"),
which only exists in specialized builds of Python, may now return objects
from other interpreters than the one it’s called in.

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.13](#)
	+ [Summary – Release Highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [A better interactive interpreter](#a-better-interactive-interpreter)
		- [Improved error messages](#improved-error-messages)
		- [Free\-threaded CPython](#free-threaded-cpython)
		- [An experimental just\-in\-time (JIT) compiler](#an-experimental-just-in-time-jit-compiler)
		- [Defined mutation semantics for `locals()`](#defined-mutation-semantics-for-locals)
		- [Support for mobile platforms](#support-for-mobile-platforms)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
	+ [Improved Modules](#improved-modules)
		- [argparse](#argparse)
		- [array](#array)
		- [ast](#ast)
		- [asyncio](#asyncio)
		- [base64](#base64)
		- [compileall](#compileall)
		- [concurrent.futures](#concurrent-futures)
		- [configparser](#configparser)
		- [copy](#copy)
		- [ctypes](#ctypes)
		- [dbm](#dbm)
		- [dis](#dis)
		- [doctest](#doctest)
		- [email](#email)
		- [enum](#enum)
		- [fractions](#fractions)
		- [glob](#glob)
		- [importlib](#importlib)
		- [io](#io)
		- [ipaddress](#ipaddress)
		- [itertools](#itertools)
		- [marshal](#marshal)
		- [math](#math)
		- [mimetypes](#mimetypes)
		- [mmap](#mmap)
		- [multiprocessing](#multiprocessing)
		- [os](#os)
		- [os.path](#os-path)
		- [pathlib](#pathlib)
		- [pdb](#pdb)
		- [queue](#queue)
		- [random](#random)
		- [re](#re)
		- [shutil](#shutil)
		- [site](#site)
		- [sqlite3](#sqlite3)
		- [ssl](#ssl)
		- [statistics](#statistics)
		- [subprocess](#subprocess)
		- [sys](#sys)
		- [tempfile](#tempfile)
		- [time](#time)
		- [tkinter](#tkinter)
		- [traceback](#traceback)
		- [types](#types)
		- [typing](#typing)
		- [unicodedata](#unicodedata)
		- [venv](#venv)
		- [warnings](#warnings)
		- [xml](#xml)
		- [zipimport](#zipimport)
	+ [Optimizations](#optimizations)
	+ [Removed Modules And APIs](#removed-modules-and-apis)
		- [PEP 594: Remove “dead batteries” from the standard library](#pep-594-remove-dead-batteries-from-the-standard-library)
		- [2to3](#to3)
		- [builtins](#builtins)
		- [configparser](#id3)
		- [importlib.metadata](#importlib-metadata)
		- [locale](#locale)
		- [opcode](#opcode)
		- [optparse](#optparse)
		- [pathlib](#id4)
		- [re](#id5)
		- [tkinter.tix](#tkinter-tix)
		- [turtle](#turtle)
		- [typing](#id6)
		- [unittest](#unittest)
		- [urllib](#urllib)
		- [webbrowser](#webbrowser)
	+ [New Deprecations](#new-deprecations)
		- [Pending Removal in Python 3\.14](#pending-removal-in-python-3-14)
		- [Pending Removal in Python 3\.15](#pending-removal-in-python-3-15)
		- [Pending removal in Python 3\.16](#pending-removal-in-python-3-16)
		- [Pending Removal in Future Versions](#pending-removal-in-future-versions)
	+ [CPython Bytecode Changes](#cpython-bytecode-changes)
	+ [C API Changes](#c-api-changes)
		- [New Features](#id7)
		- [Changed C APIs](#changed-c-apis)
		- [Limited C API Changes](#limited-c-api-changes)
		- [Removed C APIs](#removed-c-apis)
		- [Deprecated C APIs](#deprecated-c-apis)
			* [Pending Removal in Python 3\.14](#id8)
			* [Pending Removal in Python 3\.15](#id9)
			* [Pending Removal in Future Versions](#id10)
	+ [Build Changes](#build-changes)
	+ [Porting to Python 3\.13](#porting-to-python-3-13)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
	+ [Regression Test Changes](#regression-test-changes)
	+ [Notable changes in 3\.13\.1](#notable-changes-in-3-13-1)
		- [sys](#id11)

#### Previous topic

[What’s New in Python](index.html "previous chapter")

#### Next topic

[What’s New In Python 3\.12](3.12.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.13.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.12.html "What’s New In Python 3.12") \|
* [previous](index.html "What’s New in Python") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.13
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.2 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.2.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.1.html "What’s New In Python 3.1") \|
* [previous](3.3.html "What’s New In Python 3.3") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.2
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.2[¶](#what-s-new-in-python-3-2 "Link to this heading")

Author:
Raymond Hettinger

This article explains the new features in Python 3\.2 as compared to 3\.1\.
Python 3\.2 was released on February 20, 2011\. It
focuses on a few highlights and gives a few examples. For full details, see the
[Misc/NEWS](https://github.com/python/cpython/blob/076ca6c3c8df3030307e548d9be792ce3c1c6eea/Misc/NEWS)
file.

See also

[**PEP 392**](https://peps.python.org/pep-0392/) \- Python 3\.2 Release Schedule

## PEP 384: Defining a Stable ABI[¶](#pep-384-defining-a-stable-abi "Link to this heading")

In the past, extension modules built for one Python version were often
not usable with other Python versions. Particularly on Windows, every
feature release of Python required rebuilding all extension modules that
one wanted to use. This requirement was the result of the free access to
Python interpreter internals that extension modules could use.

With Python 3\.2, an alternative approach becomes available: extension
modules which restrict themselves to a limited API (by defining
Py\_LIMITED\_API) cannot use many of the internals, but are constrained
to a set of API functions that are promised to be stable for several
releases. As a consequence, extension modules built for 3\.2 in that
mode will also work with 3\.3, 3\.4, and so on. Extension modules that
make use of details of memory structures can still be built, but will
need to be recompiled for every feature release.

See also

[**PEP 384**](https://peps.python.org/pep-0384/) \- Defining a Stable ABIPEP written by Martin von Löwis.

## PEP 389: Argparse Command Line Parsing Module[¶](#pep-389-argparse-command-line-parsing-module "Link to this heading")

A new module for command line parsing, [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."), was introduced to
overcome the limitations of [`optparse`](../library/optparse.html#module-optparse "optparse: Command-line option parsing library.") which did not provide support for
positional arguments (not just options), subcommands, required options and other
common patterns of specifying and validating options.

This module has already had widespread success in the community as a
third\-party module. Being more fully featured than its predecessor, the
[`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") module is now the preferred module for command\-line processing.
The older module is still being kept available because of the substantial amount
of legacy code that depends on it.

Here’s an annotated example parser showing features like limiting results to a
set of choices, specifying a *metavar* in the help screen, validating that one
or more positional arguments is present, and making a required option:

\`\`\`
import argparse
parser = argparse.ArgumentParser(
 description = 'Manage servers', \# main description for help
 epilog = 'Tested on Solaris and Linux') \# displayed after help
parser.add\_argument('action', \# argument name
 choices = \['deploy', 'start', 'stop'], \# three allowed values
 help = 'action on each target') \# help msg
parser.add\_argument('targets',
 metavar = 'HOSTNAME', \# var name used in help msg
 nargs = '\+', \# require one or more targets
 help = 'url for target machines') \# help msg explanation
parser.add\_argument('\-u', '\-\-user', \# \-u or \-\-user option
 required = True, \# make it a required argument
 help = 'login as user')

\`\`\`

Example of calling the parser on a command string:

\`\`\`
\>\>\> cmd = 'deploy sneezy.example.com sleepy.example.com \-u skycaptain'
\>\>\> result = parser.parse\_args(cmd.split())
\>\>\> result.action
'deploy'
\>\>\> result.targets
\['sneezy.example.com', 'sleepy.example.com']
\>\>\> result.user
'skycaptain'

\`\`\`

Example of the parser’s automatically generated help:

\`\`\`
\>\>\> parser.parse\_args('\-h'.split())

usage: manage\_cloud.py \[\-h] \-u USER
 {deploy,start,stop} HOSTNAME \[HOSTNAME ...]

Manage servers

positional arguments:
 {deploy,start,stop} action on each target
 HOSTNAME url for target machines

optional arguments:
 \-h, \-\-help show this help message and exit
 \-u USER, \-\-user USER login as user

Tested on Solaris and Linux

\`\`\`

An especially nice [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") feature is the ability to define subparsers,
each with their own argument patterns and help displays:

\`\`\`
import argparse
parser = argparse.ArgumentParser(prog='HELM')
subparsers = parser.add\_subparsers()

parser\_l = subparsers.add\_parser('launch', help='Launch Control') \# first subgroup
parser\_l.add\_argument('\-m', '\-\-missiles', action='store\_true')
parser\_l.add\_argument('\-t', '\-\-torpedos', action='store\_true')

parser\_m = subparsers.add\_parser('move', help='Move Vessel', \# second subgroup
 aliases=('steer', 'turn')) \# equivalent names
parser\_m.add\_argument('\-c', '\-\-course', type=int, required=True)
parser\_m.add\_argument('\-s', '\-\-speed', type=int, default=0\)

\`\`\`

\`\`\`
$ ./helm.py \-\-help \# top level help (launch and move)
$ ./helm.py launch \-\-help \# help for launch options
$ ./helm.py launch \-\-missiles \# set missiles=True and torpedos=False
$ ./helm.py steer \-\-course 180 \-\-speed 5 \# set movement parameters

\`\`\`

See also

[**PEP 389**](https://peps.python.org/pep-0389/) \- New Command Line Parsing ModulePEP written by Steven Bethard.

[Migrating optparse code to argparse](../howto/argparse-optparse.html#upgrading-optparse-code) for details on the differences from [`optparse`](../library/optparse.html#module-optparse "optparse: Command-line option parsing library.").

## PEP 391: Dictionary Based Configuration for Logging[¶](#pep-391-dictionary-based-configuration-for-logging "Link to this heading")

The [`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications.") module provided two kinds of configuration, one style with
function calls for each option or another style driven by an external file saved
in a [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") format. Those options did not provide the flexibility
to create configurations from JSON or YAML files, nor did they support
incremental configuration, which is needed for specifying logger options from a
command line.

To support a more flexible style, the module now offers
[`logging.config.dictConfig()`](../library/logging.config.html#logging.config.dictConfig "logging.config.dictConfig") for specifying logging configuration with
plain Python dictionaries. The configuration options include formatters,
handlers, filters, and loggers. Here’s a working example of a configuration
dictionary:

\`\`\`
{"version": 1,
 "formatters": {"brief": {"format": "%(levelname)\-8s: %(name)\-15s: %(message)s"},
 "full": {"format": "%(asctime)s %(name)\-15s %(levelname)\-8s %(message)s"}
 },
 "handlers": {"console": {
 "class": "logging.StreamHandler",
 "formatter": "brief",
 "level": "INFO",
 "stream": "ext://sys.stdout"},
 "console\_priority": {
 "class": "logging.StreamHandler",
 "formatter": "full",
 "level": "ERROR",
 "stream": "ext://sys.stderr"}
 },
 "root": {"level": "DEBUG", "handlers": \["console", "console\_priority"]}}

\`\`\`

If that dictionary is stored in a file called `conf.json`, it can be
loaded and called with code like this:

\`\`\`
\>\>\> import json, logging.config
\>\>\> with open('conf.json') as f:
... conf = json.load(f)
...
\>\>\> logging.config.dictConfig(conf)
\>\>\> logging.info("Transaction completed normally")
INFO : root : Transaction completed normally
\>\>\> logging.critical("Abnormal termination")
2011\-02\-17 11:14:36,694 root CRITICAL Abnormal termination

\`\`\`

See also

[**PEP 391**](https://peps.python.org/pep-0391/) \- Dictionary Based Configuration for LoggingPEP written by Vinay Sajip.

## PEP 3148: The `concurrent.futures` module[¶](#pep-3148-the-concurrent-futures-module "Link to this heading")

Code for creating and managing concurrency is being collected in a new top\-level
namespace, *concurrent*. Its first member is a *futures* package which provides
a uniform high\-level interface for managing threads and processes.

The design for [`concurrent.futures`](../library/concurrent.futures.html#module-concurrent.futures "concurrent.futures: Execute computations concurrently using threads or processes.") was inspired by the
*java.util.concurrent* package. In that model, a running call and its result
are represented by a [`Future`](../library/concurrent.futures.html#concurrent.futures.Future "concurrent.futures.Future") object that abstracts
features common to threads, processes, and remote procedure calls. That object
supports status checks (running or done), timeouts, cancellations, adding
callbacks, and access to results or exceptions.

The primary offering of the new module is a pair of executor classes for
launching and managing calls. The goal of the executors is to make it easier to
use existing tools for making parallel calls. They save the effort needed to
setup a pool of resources, launch the calls, create a results queue, add
time\-out handling, and limit the total number of threads, processes, or remote
procedure calls.

Ideally, each application should share a single executor across multiple
components so that process and thread limits can be centrally managed. This
solves the design challenge that arises when each component has its own
competing strategy for resource management.

Both classes share a common interface with three methods:
[`submit()`](../library/concurrent.futures.html#concurrent.futures.Executor.submit "concurrent.futures.Executor.submit") for scheduling a callable and
returning a [`Future`](../library/concurrent.futures.html#concurrent.futures.Future "concurrent.futures.Future") object;
[`map()`](../library/concurrent.futures.html#concurrent.futures.Executor.map "concurrent.futures.Executor.map") for scheduling many asynchronous calls
at a time, and [`shutdown()`](../library/concurrent.futures.html#concurrent.futures.Executor.shutdown "concurrent.futures.Executor.shutdown") for freeing
resources. The class is a [context manager](../glossary.html#term-context-manager) and can be used in a
[`with`](../reference/compound_stmts.html#with) statement to assure that resources are automatically released
when currently pending futures are done executing.

A simple of example of [`ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor") is a
launch of four parallel threads for copying files:

\`\`\`
import concurrent.futures, shutil
with concurrent.futures.ThreadPoolExecutor(max\_workers=4\) as e:
 e.submit(shutil.copy, 'src1\.txt', 'dest1\.txt')
 e.submit(shutil.copy, 'src2\.txt', 'dest2\.txt')
 e.submit(shutil.copy, 'src3\.txt', 'dest3\.txt')
 e.submit(shutil.copy, 'src3\.txt', 'dest4\.txt')

\`\`\`

See also

[**PEP 3148**](https://peps.python.org/pep-3148/) \- Futures – Execute Computations AsynchronouslyPEP written by Brian Quinlan.

[Code for Threaded Parallel URL reads](../library/concurrent.futures.html#threadpoolexecutor-example), an
example using threads to fetch multiple web pages in parallel.

[Code for computing prime numbers in
parallel](../library/concurrent.futures.html#processpoolexecutor-example), an example demonstrating
[`ProcessPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor "concurrent.futures.ProcessPoolExecutor").

## PEP 3147: PYC Repository Directories[¶](#pep-3147-pyc-repository-directories "Link to this heading")

Python’s scheme for caching bytecode in *.pyc* files did not work well in
environments with multiple Python interpreters. If one interpreter encountered
a cached file created by another interpreter, it would recompile the source and
overwrite the cached file, thus losing the benefits of caching.

The issue of “pyc fights” has become more pronounced as it has become
commonplace for Linux distributions to ship with multiple versions of Python.
These conflicts also arise with CPython alternatives such as Unladen Swallow.

To solve this problem, Python’s import machinery has been extended to use
distinct filenames for each interpreter. Instead of Python 3\.2 and Python 3\.3 and
Unladen Swallow each competing for a file called “mymodule.pyc”, they will now
look for “mymodule.cpython\-32\.pyc”, “mymodule.cpython\-33\.pyc”, and
“mymodule.unladen10\.pyc”. And to prevent all of these new files from
cluttering source directories, the *pyc* files are now collected in a
“\_\_pycache\_\_” directory stored under the package directory.

Aside from the filenames and target directories, the new scheme has a few
aspects that are visible to the programmer:

* Imported modules now have a [`__cached__`](../reference/datamodel.html#module.__cached__ "module.__cached__") attribute which stores
the name of the actual file that was imported:

\`\`\`
\>\>\> import collections
\>\>\> collections.\_\_cached\_\_ 
'c:/py32/lib/\_\_pycache\_\_/collections.cpython\-32\.pyc'

\`\`\`
* The tag that is unique to each interpreter is accessible from the `imp`
module:

\`\`\`
\>\>\> import imp 
\>\>\> imp.get\_tag() 
'cpython\-32'

\`\`\`
* Scripts that try to deduce source filename from the imported file now need to
be smarter. It is no longer sufficient to simply strip the “c” from a “.pyc”
filename. Instead, use the new functions in the `imp` module:

\`\`\`
\>\>\> imp.source\_from\_cache('c:/py32/lib/\_\_pycache\_\_/collections.cpython\-32\.pyc') 
'c:/py32/lib/collections.py'
\>\>\> imp.cache\_from\_source('c:/py32/lib/collections.py') 
'c:/py32/lib/\_\_pycache\_\_/collections.cpython\-32\.pyc'

\`\`\`
* The [`py_compile`](../library/py_compile.html#module-py_compile "py_compile: Generate byte-code files from Python source files.") and [`compileall`](../library/compileall.html#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.") modules have been updated to
reflect the new naming convention and target directory. The command\-line
invocation of *compileall* has new options: `-i` for
specifying a list of files and directories to compile and `-b` which causes
bytecode files to be written to their legacy location rather than
*\_\_pycache\_\_*.
* The [`importlib.abc`](../library/importlib.html#module-importlib.abc "importlib.abc: Abstract base classes related to import") module has been updated with new [abstract base
classes](../glossary.html#term-abstract-base-class) for loading bytecode files. The obsolete
ABCs, `PyLoader` and
`PyPycLoader`, have been deprecated (instructions on how
to stay Python 3\.1 compatible are included with the documentation).

See also

[**PEP 3147**](https://peps.python.org/pep-3147/) \- PYC Repository DirectoriesPEP written by Barry Warsaw.

## PEP 3149: ABI Version Tagged .so Files[¶](#pep-3149-abi-version-tagged-so-files "Link to this heading")

The PYC repository directory allows multiple bytecode cache files to be
co\-located. This PEP implements a similar mechanism for shared object files by
giving them a common directory and distinct names for each version.

The common directory is “pyshared” and the file names are made distinct by
identifying the Python implementation (such as CPython, PyPy, Jython, etc.), the
major and minor version numbers, and optional build flags (such as “d” for
debug, “m” for pymalloc, “u” for wide\-unicode). For an arbitrary package “foo”,
you may see these files when the distribution package is installed:

\`\`\`
/usr/share/pyshared/foo.cpython\-32m.so
/usr/share/pyshared/foo.cpython\-33md.so

\`\`\`

In Python itself, the tags are accessible from functions in the [`sysconfig`](../library/sysconfig.html#module-sysconfig "sysconfig: Python's configuration information")
module:

\`\`\`
\>\>\> import sysconfig
\>\>\> sysconfig.get\_config\_var('SOABI') \# find the version tag
'cpython\-32mu'
\>\>\> sysconfig.get\_config\_var('EXT\_SUFFIX') \# find the full filename extension
'.cpython\-32mu.so'

\`\`\`

See also

[**PEP 3149**](https://peps.python.org/pep-3149/) \- ABI Version Tagged .so FilesPEP written by Barry Warsaw.

## PEP 3333: Python Web Server Gateway Interface v1\.0\.1[¶](#pep-3333-python-web-server-gateway-interface-v1-0-1 "Link to this heading")

This informational PEP clarifies how bytes/text issues are to be handled by the
WSGI protocol. The challenge is that string handling in Python 3 is most
conveniently handled with the [`str`](../library/stdtypes.html#str "str") type even though the HTTP protocol
is itself bytes oriented.

The PEP differentiates so\-called *native strings* that are used for
request/response headers and metadata versus *byte strings* which are used for
the bodies of requests and responses.

The *native strings* are always of type [`str`](../library/stdtypes.html#str "str") but are restricted to code
points between *U\+0000* through *U\+00FF* which are translatable to bytes using
*Latin\-1* encoding. These strings are used for the keys and values in the
environment dictionary and for response headers and statuses in the
`start_response()` function. They must follow [**RFC 2616**](https://datatracker.ietf.org/doc/html/rfc2616.html) with respect to
encoding. That is, they must either be *ISO\-8859\-1* characters or use
[**RFC 2047**](https://datatracker.ietf.org/doc/html/rfc2047.html) MIME encoding.

For developers porting WSGI applications from Python 2, here are the salient
points:

* If the app already used strings for headers in Python 2, no change is needed.
* If instead, the app encoded output headers or decoded input headers, then the
headers will need to be re\-encoded to Latin\-1\. For example, an output header
encoded in utf\-8 was using `h.encode('utf-8')` now needs to convert from
bytes to native strings using `h.encode('utf-8').decode('latin-1')`.
* Values yielded by an application or sent using the `write()` method
must be byte strings. The `start_response()` function and environ
must use native strings. The two cannot be mixed.

For server implementers writing CGI\-to\-WSGI pathways or other CGI\-style
protocols, the users must to be able access the environment using native strings
even though the underlying platform may have a different convention. To bridge
this gap, the [`wsgiref`](../library/wsgiref.html#module-wsgiref "wsgiref: WSGI Utilities and Reference Implementation.") module has a new function,
[`wsgiref.handlers.read_environ()`](../library/wsgiref.html#wsgiref.handlers.read_environ "wsgiref.handlers.read_environ") for transcoding CGI variables from
[`os.environ`](../library/os.html#os.environ "os.environ") into native strings and returning a new dictionary.

See also

[**PEP 3333**](https://peps.python.org/pep-3333/) \- Python Web Server Gateway Interface v1\.0\.1PEP written by Phillip Eby.

## Other Language Changes[¶](#other-language-changes "Link to this heading")

Some smaller changes made to the core Python language are:

* String formatting for [`format()`](../library/functions.html#format "format") and [`str.format()`](../library/stdtypes.html#str.format "str.format") gained new
capabilities for the format character **\#**. Previously, for integers in
binary, octal, or hexadecimal, it caused the output to be prefixed with ‘0b’,
‘0o’, or ‘0x’ respectively. Now it can also handle floats, complex, and
Decimal, causing the output to always have a decimal point even when no digits
follow it.

\`\`\`
\>\>\> format(20, '\#o')
'0o24'
\>\>\> format(12\.34, '\#5\.0f')
' 12\.'

\`\`\`

(Suggested by Mark Dickinson and implemented by Eric Smith in [bpo\-7094](https://bugs.python.org/issue?@action=redirect&bpo=7094).)
* There is also a new [`str.format_map()`](../library/stdtypes.html#str.format_map "str.format_map") method that extends the
capabilities of the existing [`str.format()`](../library/stdtypes.html#str.format "str.format") method by accepting arbitrary
[mapping](../glossary.html#term-mapping) objects. This new method makes it possible to use string
formatting with any of Python’s many dictionary\-like objects such as
[`defaultdict`](../library/collections.html#collections.defaultdict "collections.defaultdict"), [`Shelf`](../library/shelve.html#shelve.Shelf "shelve.Shelf"),
[`ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser"), or [`dbm`](../library/dbm.html#module-dbm "dbm: Interfaces to various Unix \"database\" formats."). It is also useful with
custom [`dict`](../library/stdtypes.html#dict "dict") subclasses that normalize keys before look\-up or that
supply a `__missing__()` method for unknown keys:

\`\`\`
\>\>\> import shelve
\>\>\> d = shelve.open('tmp.shl')
\>\>\> 'The {project\_name} status is {status} as of {date}'.format\_map(d)
'The testing project status is green as of February 15, 2011'

\>\>\> class LowerCasedDict(dict):
... def \_\_getitem\_\_(self, key):
... return dict.\_\_getitem\_\_(self, key.lower())
...
\>\>\> lcd = LowerCasedDict(part='widgets', quantity=10\)
\>\>\> 'There are {QUANTITY} {Part} in stock'.format\_map(lcd)
'There are 10 widgets in stock'

\>\>\> class PlaceholderDict(dict):
... def \_\_missing\_\_(self, key):
... return '\'.format(key)
...
\>\>\> 'Hello {name}, welcome to {location}'.format\_map(PlaceholderDict())
'Hello \, welcome to \'

\`\`\`

> (Suggested by Raymond Hettinger and implemented by Eric Smith in
> [bpo\-6081](https://bugs.python.org/issue?@action=redirect&bpo=6081).)

* The interpreter can now be started with a quiet option, `-q`, to prevent
the copyright and version information from being displayed in the interactive
mode. The option can be introspected using the [`sys.flags`](../library/sys.html#sys.flags "sys.flags") attribute:

\`\`\`
$ python \-q
\>\>\> sys.flags
sys.flags(debug=0, division\_warning=0, inspect=0, interactive=0,
optimize=0, dont\_write\_bytecode=0, no\_user\_site=0, no\_site=0,
ignore\_environment=0, verbose=0, bytes\_warning=0, quiet=1\)

\`\`\`

(Contributed by Marcin Wojdyr in [bpo\-1772833](https://bugs.python.org/issue?@action=redirect&bpo=1772833)).
* The [`hasattr()`](../library/functions.html#hasattr "hasattr") function works by calling [`getattr()`](../library/functions.html#getattr "getattr") and detecting
whether an exception is raised. This technique allows it to detect methods
created dynamically by [`__getattr__()`](../reference/datamodel.html#object.__getattr__ "object.__getattr__") or [`__getattribute__()`](../reference/datamodel.html#object.__getattribute__ "object.__getattribute__") which
would otherwise be absent from the class dictionary. Formerly, *hasattr*
would catch any exception, possibly masking genuine errors. Now, *hasattr*
has been tightened to only catch [`AttributeError`](../library/exceptions.html#AttributeError "AttributeError") and let other
exceptions pass through:

\`\`\`
\>\>\> class A:
... @property
... def f(self):
... return 1 // 0
...
\>\>\> a = A()
\>\>\> hasattr(a, 'f')
Traceback (most recent call last):
 ...
ZeroDivisionError: integer division or modulo by zero

\`\`\`

(Discovered by Yury Selivanov and fixed by Benjamin Peterson; [bpo\-9666](https://bugs.python.org/issue?@action=redirect&bpo=9666).)
* The [`str()`](../library/stdtypes.html#str "str") of a float or complex number is now the same as its
[`repr()`](../library/functions.html#repr "repr"). Previously, the [`str()`](../library/stdtypes.html#str "str") form was shorter but that just
caused confusion and is no longer needed now that the shortest possible
[`repr()`](../library/functions.html#repr "repr") is displayed by default:

\`\`\`
\>\>\> import math
\>\>\> repr(math.pi)
'3\.141592653589793'
\>\>\> str(math.pi)
'3\.141592653589793'

\`\`\`

(Proposed and implemented by Mark Dickinson; [bpo\-9337](https://bugs.python.org/issue?@action=redirect&bpo=9337).)
* [`memoryview`](../library/stdtypes.html#memoryview "memoryview") objects now have a [`release()`](../library/stdtypes.html#memoryview.release "memoryview.release") method
and they also now support the context management protocol. This allows timely
release of any resources that were acquired when requesting a buffer from the
original object.

\`\`\`
\>\>\> with memoryview(b'abcdefgh') as v:
... print(v.tolist())
\[97, 98, 99, 100, 101, 102, 103, 104]

\`\`\`

(Added by Antoine Pitrou; [bpo\-9757](https://bugs.python.org/issue?@action=redirect&bpo=9757).)
* Previously it was illegal to delete a name from the local namespace if it
occurs as a free variable in a nested block:

\`\`\`
def outer(x):
 def inner():
 return x
 inner()
 del x

\`\`\`

This is now allowed. Remember that the target of an [`except`](../reference/compound_stmts.html#except) clause
is cleared, so this code which used to work with Python 2\.6, raised a
[`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") with Python 3\.1 and now works again:

\`\`\`
def f():
 def print\_error():
 print(e)
 try:
 something
 except Exception as e:
 print\_error()
 \# implicit "del e" here

\`\`\`

(See [bpo\-4617](https://bugs.python.org/issue?@action=redirect&bpo=4617).)
* [Struct sequence types](../c-api/tuple.html#struct-sequence-objects) are now subclasses of tuple.
This means that C structures like those returned by [`os.stat()`](../library/os.html#os.stat "os.stat"),
[`time.gmtime()`](../library/time.html#time.gmtime "time.gmtime"), and [`sys.version_info`](../library/sys.html#sys.version_info "sys.version_info") now work like a
[named tuple](../glossary.html#term-named-tuple) and now work with functions and methods that
expect a tuple as an argument. This is a big step forward in making the C
structures as flexible as their pure Python counterparts:

\`\`\`
\>\>\> import sys
\>\>\> isinstance(sys.version\_info, tuple)
True
\>\>\> 'Version %d.%d.%d %s(%d)' % sys.version\_info 
'Version 3\.2\.0 final(0\)'

\`\`\`

(Suggested by Arfrever Frehtes Taifersar Arahesis and implemented
by Benjamin Peterson in [bpo\-8413](https://bugs.python.org/issue?@action=redirect&bpo=8413).)
* Warnings are now easier to control using the [`PYTHONWARNINGS`](../using/cmdline.html#envvar-PYTHONWARNINGS)
environment variable as an alternative to using `-W` at the command line:

\`\`\`
$ export PYTHONWARNINGS='ignore::RuntimeWarning::,once::UnicodeWarning::'

\`\`\`

(Suggested by Barry Warsaw and implemented by Philip Jenvey in [bpo\-7301](https://bugs.python.org/issue?@action=redirect&bpo=7301).)
* A new warning category, [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning"), has been added. It is
emitted when potential issues with resource consumption or cleanup
are detected. It is silenced by default in normal release builds but
can be enabled through the means provided by the [`warnings`](../library/warnings.html#module-warnings "warnings: Issue warning messages and control their disposition.")
module, or on the command line.

A [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning") is issued at interpreter shutdown if the
[`gc.garbage`](../library/gc.html#gc.garbage "gc.garbage") list isn’t empty, and if [`gc.DEBUG_UNCOLLECTABLE`](../library/gc.html#gc.DEBUG_UNCOLLECTABLE "gc.DEBUG_UNCOLLECTABLE") is
set, all uncollectable objects are printed. This is meant to make the
programmer aware that their code contains object finalization issues.

A [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning") is also issued when a [file object](../glossary.html#term-file-object) is destroyed
without having been explicitly closed. While the deallocator for such
object ensures it closes the underlying operating system resource
(usually, a file descriptor), the delay in deallocating the object could
produce various issues, especially under Windows. Here is an example
of enabling the warning from the command line:

\`\`\`
$ python \-q \-Wdefault
\>\>\> f = open("foo", "wb")
\>\>\> del f
\_\_main\_\_:1: ResourceWarning: unclosed file \

\`\`\`

(Added by Antoine Pitrou and Georg Brandl in [bpo\-10093](https://bugs.python.org/issue?@action=redirect&bpo=10093) and [bpo\-477863](https://bugs.python.org/issue?@action=redirect&bpo=477863).)
* [`range`](../library/stdtypes.html#range "range") objects now support *index* and *count* methods. This is part
of an effort to make more objects fully implement the
[`collections.Sequence`](../library/collections.abc.html#collections.abc.Sequence "collections.abc.Sequence") [abstract base class](../glossary.html#term-abstract-base-class). As a result, the
language will have a more uniform API. In addition, [`range`](../library/stdtypes.html#range "range") objects
now support slicing and negative indices, even with values larger than
[`sys.maxsize`](../library/sys.html#sys.maxsize "sys.maxsize"). This makes *range* more interoperable with lists:

\`\`\`
\>\>\> range(0, 100, 2\).count(10\)
1
\>\>\> range(0, 100, 2\).index(10\)
5
\>\>\> range(0, 100, 2\)\[5]
10
\>\>\> range(0, 100, 2\)\[0:5]
range(0, 10, 2\)

\`\`\`

(Contributed by Daniel Stutzbach in [bpo\-9213](https://bugs.python.org/issue?@action=redirect&bpo=9213), by Alexander Belopolsky
in [bpo\-2690](https://bugs.python.org/issue?@action=redirect&bpo=2690), and by Nick Coghlan in [bpo\-10889](https://bugs.python.org/issue?@action=redirect&bpo=10889).)
* The [`callable()`](../library/functions.html#callable "callable") builtin function from Py2\.x was resurrected. It provides
a concise, readable alternative to using an [abstract base class](../glossary.html#term-abstract-base-class) in an
expression like `isinstance(x, collections.Callable)`:

\`\`\`
\>\>\> callable(max)
True
\>\>\> callable(20\)
False

\`\`\`

(See [bpo\-10518](https://bugs.python.org/issue?@action=redirect&bpo=10518).)
* Python’s import mechanism can now load modules installed in directories with
non\-ASCII characters in the path name. This solved an aggravating problem
with home directories for users with non\-ASCII characters in their usernames.

> (Required extensive work by Victor Stinner in [bpo\-9425](https://bugs.python.org/issue?@action=redirect&bpo=9425).)

## New, Improved, and Deprecated Modules[¶](#new-improved-and-deprecated-modules "Link to this heading")

Python’s standard library has undergone significant maintenance efforts and
quality improvements.

The biggest news for Python 3\.2 is that the [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") package, [`mailbox`](../library/mailbox.html#module-mailbox "mailbox: Manipulate mailboxes in various formats")
module, and `nntplib` modules now work correctly with the bytes/text model
in Python 3\. For the first time, there is correct handling of messages with
mixed encodings.

Throughout the standard library, there has been more careful attention to
encodings and text versus bytes issues. In particular, interactions with the
operating system are now better able to exchange non\-ASCII data using the
Windows MBCS encoding, locale\-aware encodings, or UTF\-8\.

Another significant win is the addition of substantially better support for
*SSL* connections and security certificates.

In addition, more classes now implement a [context manager](../glossary.html#term-context-manager) to support
convenient and reliable resource clean\-up using a [`with`](../reference/compound_stmts.html#with) statement.

### email[¶](#email "Link to this heading")

The usability of the [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") package in Python 3 has been mostly fixed by
the extensive efforts of R. David Murray. The problem was that emails are
typically read and stored in the form of [`bytes`](../library/stdtypes.html#bytes "bytes") rather than [`str`](../library/stdtypes.html#str "str")
text, and they may contain multiple encodings within a single email. So, the
email package had to be extended to parse and generate email messages in bytes
format.

* New functions [`message_from_bytes()`](../library/email.parser.html#email.message_from_bytes "email.message_from_bytes") and
[`message_from_binary_file()`](../library/email.parser.html#email.message_from_binary_file "email.message_from_binary_file"), and new classes
[`BytesFeedParser`](../library/email.parser.html#email.parser.BytesFeedParser "email.parser.BytesFeedParser") and [`BytesParser`](../library/email.parser.html#email.parser.BytesParser "email.parser.BytesParser")
allow binary message data to be parsed into model objects.
* Given bytes input to the model, [`get_payload()`](../library/email.compat32-message.html#email.message.Message.get_payload "email.message.Message.get_payload")
will by default decode a message body that has a
*Content\-Transfer\-Encoding* of *8bit* using the charset
specified in the MIME headers and return the resulting string.
* Given bytes input to the model, [`Generator`](../library/email.generator.html#email.generator.Generator "email.generator.Generator") will
convert message bodies that have a *Content\-Transfer\-Encoding* of
*8bit* to instead have a *7bit* *Content\-Transfer\-Encoding*.

Headers with unencoded non\-ASCII bytes are deemed to be [**RFC 2047**](https://datatracker.ietf.org/doc/html/rfc2047.html)\-encoded
using the *unknown\-8bit* character set.
* A new class [`BytesGenerator`](../library/email.generator.html#email.generator.BytesGenerator "email.generator.BytesGenerator") produces bytes as output,
preserving any unchanged non\-ASCII data that was present in the input used to
build the model, including message bodies with a
*Content\-Transfer\-Encoding* of *8bit*.
* The [`smtplib`](../library/smtplib.html#module-smtplib "smtplib: SMTP protocol client (requires sockets).") [`SMTP`](../library/smtplib.html#smtplib.SMTP "smtplib.SMTP") class now accepts a byte string
for the *msg* argument to the [`sendmail()`](../library/smtplib.html#smtplib.SMTP.sendmail "smtplib.SMTP.sendmail") method,
and a new method, [`send_message()`](../library/smtplib.html#smtplib.SMTP.send_message "smtplib.SMTP.send_message") accepts a
[`Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message") object and can optionally obtain the
*from\_addr* and *to\_addrs* addresses directly from the object.

(Proposed and implemented by R. David Murray, [bpo\-4661](https://bugs.python.org/issue?@action=redirect&bpo=4661) and [bpo\-10321](https://bugs.python.org/issue?@action=redirect&bpo=10321).)

### elementtree[¶](#elementtree "Link to this heading")

The [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") package and its `xml.etree.cElementTree`
counterpart have been updated to version 1\.3\.

Several new and useful functions and methods have been added:

* [`xml.etree.ElementTree.fromstringlist()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.fromstringlist "xml.etree.ElementTree.fromstringlist") which builds an XML document
from a sequence of fragments
* [`xml.etree.ElementTree.register_namespace()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.register_namespace "xml.etree.ElementTree.register_namespace") for registering a global
namespace prefix
* [`xml.etree.ElementTree.tostringlist()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.tostringlist "xml.etree.ElementTree.tostringlist") for string representation
including all sublists
* [`xml.etree.ElementTree.Element.extend()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.extend "xml.etree.ElementTree.Element.extend") for appending a sequence of zero
or more elements
* [`xml.etree.ElementTree.Element.iterfind()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.iterfind "xml.etree.ElementTree.Element.iterfind") searches an element and
subelements
* [`xml.etree.ElementTree.Element.itertext()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element.itertext "xml.etree.ElementTree.Element.itertext") creates a text iterator over
an element and its subelements
* [`xml.etree.ElementTree.TreeBuilder.end()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.end "xml.etree.ElementTree.TreeBuilder.end") closes the current element
* [`xml.etree.ElementTree.TreeBuilder.doctype()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.doctype "xml.etree.ElementTree.TreeBuilder.doctype") handles a doctype
declaration

Two methods have been deprecated:

* `xml.etree.ElementTree.getchildren()` use `list(elem)` instead.
* `xml.etree.ElementTree.getiterator()` use `Element.iter` instead.

For details of the update, see [Introducing ElementTree](https://web.archive.org/web/20200703234532/http://effbot.org/zone/elementtree-13-intro.htm)
on Fredrik Lundh’s website.

(Contributed by Florent Xicluna and Fredrik Lundh, [bpo\-6472](https://bugs.python.org/issue?@action=redirect&bpo=6472).)

### functools[¶](#functools "Link to this heading")

* The [`functools`](../library/functools.html#module-functools "functools: Higher-order functions and operations on callable objects.") module includes a new decorator for caching function
calls. [`functools.lru_cache()`](../library/functools.html#functools.lru_cache "functools.lru_cache") can save repeated queries to an external
resource whenever the results are expected to be the same.

For example, adding a caching decorator to a database query function can save
database accesses for popular searches:

\`\`\`
\>\>\> import functools
\>\>\> @functools.lru\_cache(maxsize=300\)
... def get\_phone\_number(name):
... c = conn.cursor()
... c.execute('SELECT phonenumber FROM phonelist WHERE name=?', (name,))
... return c.fetchone()\[0]

\`\`\`

\`\`\`
\>\>\> for name in user\_requests: 
... get\_phone\_number(name) \# cached lookup

\`\`\`

To help with choosing an effective cache size, the wrapped function is
instrumented for tracking cache statistics:

\`\`\`
\>\>\> get\_phone\_number.cache\_info() 
CacheInfo(hits=4805, misses=980, maxsize=300, currsize=300\)

\`\`\`

If the phonelist table gets updated, the outdated contents of the cache can be
cleared with:

\`\`\`
\>\>\> get\_phone\_number.cache\_clear()

\`\`\`

(Contributed by Raymond Hettinger and incorporating design ideas from Jim
Baker, Miki Tebeka, and Nick Coghlan; see [recipe 498245](https://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/), [recipe 577479](https://code.activestate.com/recipes/577479-simple-caching-decorator/), [bpo\-10586](https://bugs.python.org/issue?@action=redirect&bpo=10586), and
[bpo\-10593](https://bugs.python.org/issue?@action=redirect&bpo=10593).)
* The [`functools.wraps()`](../library/functools.html#functools.wraps "functools.wraps") decorator now adds a `__wrapped__` attribute
pointing to the original callable function. This allows wrapped functions to
be introspected. It also copies [`__annotations__`](../reference/datamodel.html#function.__annotations__ "function.__annotations__") if
defined. And now it also gracefully skips over missing attributes such as
[`__doc__`](../reference/datamodel.html#function.__doc__ "function.__doc__") which
might not be defined for the wrapped callable.

In the above example, the cache can be removed by recovering the original
function:

\`\`\`
\>\>\> get\_phone\_number = get\_phone\_number.\_\_wrapped\_\_ \# uncached function

\`\`\`

(By Nick Coghlan and Terrence Cole; [bpo\-9567](https://bugs.python.org/issue?@action=redirect&bpo=9567), [bpo\-3445](https://bugs.python.org/issue?@action=redirect&bpo=3445), and
[bpo\-8814](https://bugs.python.org/issue?@action=redirect&bpo=8814).)
* To help write classes with rich comparison methods, a new decorator
[`functools.total_ordering()`](../library/functools.html#functools.total_ordering "functools.total_ordering") will use existing equality and inequality
methods to fill in the remaining methods.

For example, supplying *\_\_eq\_\_* and *\_\_lt\_\_* will enable
[`total_ordering()`](../library/functools.html#functools.total_ordering "functools.total_ordering") to fill\-in *\_\_le\_\_*, *\_\_gt\_\_* and *\_\_ge\_\_*:

\`\`\`
@total\_ordering
class Student:
 def \_\_eq\_\_(self, other):
 return ((self.lastname.lower(), self.firstname.lower()) ==
 (other.lastname.lower(), other.firstname.lower()))

 def \_\_lt\_\_(self, other):
 return ((self.lastname.lower(), self.firstname.lower()) \\>\> \# locale\-aware sort order
\>\>\> sorted(iterable, key=cmp\_to\_key(locale.strcoll)) 

\`\`\`

For sorting examples and a brief sorting tutorial, see the [Sorting HowTo](https://wiki.python.org/moin/HowTo/Sorting/) tutorial.

(Contributed by Raymond Hettinger.)

### itertools[¶](#itertools "Link to this heading")

* The [`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping.") module has a new [`accumulate()`](../library/itertools.html#itertools.accumulate "itertools.accumulate") function
modeled on APL’s *scan* operator and Numpy’s *accumulate* function:

\`\`\`
\>\>\> from itertools import accumulate
\>\>\> list(accumulate(\[8, 2, 50]))
\[8, 10, 60]

\`\`\`

\`\`\`
\>\>\> prob\_dist = \[0\.1, 0\.4, 0\.2, 0\.3]
\>\>\> list(accumulate(prob\_dist)) \# cumulative probability distribution
\[0\.1, 0\.5, 0\.7, 1\.0]

\`\`\`

For an example using [`accumulate()`](../library/itertools.html#itertools.accumulate "itertools.accumulate"), see the [examples for
the random module](../library/random.html#random-examples).

(Contributed by Raymond Hettinger and incorporating design suggestions
from Mark Dickinson.)

### collections[¶](#collections "Link to this heading")

* The [`collections.Counter`](../library/collections.html#collections.Counter "collections.Counter") class now has two forms of in\-place
subtraction, the existing *\-=* operator for [saturating subtraction](https://en.wikipedia.org/wiki/Saturation_arithmetic) and the new
[`subtract()`](../library/collections.html#collections.Counter.subtract "collections.Counter.subtract") method for regular subtraction. The
former is suitable for [multisets](https://en.wikipedia.org/wiki/Multiset)
which only have positive counts, and the latter is more suitable for use cases
that allow negative counts:

\`\`\`
\>\>\> from collections import Counter
\>\>\> tally = Counter(dogs=5, cats=3\)
\>\>\> tally \-= Counter(dogs=2, cats=8\) \# saturating subtraction
\>\>\> tally
Counter({'dogs': 3})

\`\`\`

\`\`\`
\>\>\> tally = Counter(dogs=5, cats=3\)
\>\>\> tally.subtract(dogs=2, cats=8\) \# regular subtraction
\>\>\> tally
Counter({'dogs': 3, 'cats': \-5})

\`\`\`

(Contributed by Raymond Hettinger.)
* The [`collections.OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict") class has a new method
[`move_to_end()`](../library/collections.html#collections.OrderedDict.move_to_end "collections.OrderedDict.move_to_end") which takes an existing key and
moves it to either the first or last position in the ordered sequence.

The default is to move an item to the last position. This is equivalent of
renewing an entry with `od[k] = od.pop(k)`.

A fast move\-to\-end operation is useful for resequencing entries. For example,
an ordered dictionary can be used to track order of access by aging entries
from the oldest to the most recently accessed.

\`\`\`
\>\>\> from collections import OrderedDict
\>\>\> d = OrderedDict.fromkeys(\['a', 'b', 'X', 'd', 'e'])
\>\>\> list(d)
\['a', 'b', 'X', 'd', 'e']
\>\>\> d.move\_to\_end('X')
\>\>\> list(d)
\['a', 'b', 'd', 'e', 'X']

\`\`\`

(Contributed by Raymond Hettinger.)
* The [`collections.deque`](../library/collections.html#collections.deque "collections.deque") class grew two new methods
[`count()`](../library/collections.html#collections.deque.count "collections.deque.count") and [`reverse()`](../library/collections.html#collections.deque.reverse "collections.deque.reverse") that
make them more substitutable for [`list`](../library/stdtypes.html#list "list") objects:

\`\`\`
\>\>\> from collections import deque
\>\>\> d = deque('simsalabim')
\>\>\> d.count('s')
2
\>\>\> d.reverse()
\>\>\> d
deque(\['m', 'i', 'b', 'a', 'l', 'a', 's', 'm', 'i', 's'])

\`\`\`

(Contributed by Raymond Hettinger.)

### threading[¶](#threading "Link to this heading")

The [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") module has a new [`Barrier`](../library/threading.html#threading.Barrier "threading.Barrier")
synchronization class for making multiple threads wait until all of them have
reached a common barrier point. Barriers are useful for making sure that a task
with multiple preconditions does not run until all of the predecessor tasks are
complete.

Barriers can work with an arbitrary number of threads. This is a generalization
of a [Rendezvous](https://en.wikipedia.org/wiki/Synchronous_rendezvous) which
is defined for only two threads.

Implemented as a two\-phase cyclic barrier, [`Barrier`](../library/threading.html#threading.Barrier "threading.Barrier") objects
are suitable for use in loops. The separate *filling* and *draining* phases
assure that all threads get released (drained) before any one of them can loop
back and re\-enter the barrier. The barrier fully resets after each cycle.

Example of using barriers:

\`\`\`
from threading import Barrier, Thread

def get\_votes(site):
 ballots = conduct\_election(site)
 all\_polls\_closed.wait() \# do not count until all polls are closed
 totals = summarize(ballots)
 publish(site, totals)

all\_polls\_closed = Barrier(len(sites))
for site in sites:
 Thread(target=get\_votes, args=(site,)).start()

\`\`\`

In this example, the barrier enforces a rule that votes cannot be counted at any
polling site until all polls are closed. Notice how a solution with a barrier
is similar to one with [`threading.Thread.join()`](../library/threading.html#threading.Thread.join "threading.Thread.join"), but the threads stay alive
and continue to do work (summarizing ballots) after the barrier point is
crossed.

If any of the predecessor tasks can hang or be delayed, a barrier can be created
with an optional *timeout* parameter. Then if the timeout period elapses before
all the predecessor tasks reach the barrier point, all waiting threads are
released and a [`BrokenBarrierError`](../library/threading.html#threading.BrokenBarrierError "threading.BrokenBarrierError") exception is raised:

\`\`\`
def get\_votes(site):
 ballots = conduct\_election(site)
 try:
 all\_polls\_closed.wait(timeout=midnight \- time.now())
 except BrokenBarrierError:
 lockbox = seal\_ballots(ballots)
 queue.put(lockbox)
 else:
 totals = summarize(ballots)
 publish(site, totals)

\`\`\`

In this example, the barrier enforces a more robust rule. If some election
sites do not finish before midnight, the barrier times\-out and the ballots are
sealed and deposited in a queue for later handling.

See [Barrier Synchronization Patterns](https://osl.cs.illinois.edu/media/papers/karmani-2009-barrier_synchronization_pattern.pdf)
for more examples of how barriers can be used in parallel computing. Also, there is
a simple but thorough explanation of barriers in [The Little Book of Semaphores](https://greenteapress.com/semaphores/LittleBookOfSemaphores.pdf), *section 3\.6*.

(Contributed by Kristján Valur Jónsson with an API review by Jeffrey Yasskin in
[bpo\-8777](https://bugs.python.org/issue?@action=redirect&bpo=8777).)

### datetime and time[¶](#datetime-and-time "Link to this heading")

* The [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types.") module has a new type [`timezone`](../library/datetime.html#datetime.timezone "datetime.timezone") that
implements the [`tzinfo`](../library/datetime.html#datetime.tzinfo "datetime.tzinfo") interface by returning a fixed UTC
offset and timezone name. This makes it easier to create timezone\-aware
datetime objects:

\`\`\`
\>\>\> from datetime import datetime, timezone

\>\>\> datetime.now(timezone.utc)
datetime.datetime(2010, 12, 8, 21, 4, 2, 923754, tzinfo=datetime.timezone.utc)

\>\>\> datetime.strptime("01/01/2000 12:00 \+0000", "%m/%d/%Y %H:%M %z")
datetime.datetime(2000, 1, 1, 12, 0, tzinfo=datetime.timezone.utc)

\`\`\`
* Also, [`timedelta`](../library/datetime.html#datetime.timedelta "datetime.timedelta") objects can now be multiplied by
[`float`](../library/functions.html#float "float") and divided by [`float`](../library/functions.html#float "float") and [`int`](../library/functions.html#int "int") objects.
And [`timedelta`](../library/datetime.html#datetime.timedelta "datetime.timedelta") objects can now divide one another.
* The [`datetime.date.strftime()`](../library/datetime.html#datetime.date.strftime "datetime.date.strftime") method is no longer restricted to years
after 1900\. The new supported year range is from 1000 to 9999 inclusive.
* Whenever a two\-digit year is used in a time tuple, the interpretation has been
governed by `time.accept2dyear`. The default is `True` which means that
for a two\-digit year, the century is guessed according to the POSIX rules
governing the `%y` strptime format.

Starting with Py3\.2, use of the century guessing heuristic will emit a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). Instead, it is recommended that
`time.accept2dyear` be set to `False` so that large date ranges
can be used without guesswork:

\`\`\`
\>\>\> import time, warnings
\>\>\> warnings.resetwarnings() \# remove the default warning filters

\>\>\> time.accept2dyear = True \# guess whether 11 means 11 or 2011
\>\>\> time.asctime((11, 1, 1, 12, 34, 56, 4, 1, 0\))
Warning (from warnings module):
 ...
DeprecationWarning: Century info guessed for a 2\-digit year.
'Fri Jan 1 12:34:56 2011'

\>\>\> time.accept2dyear = False \# use the full range of allowable dates
\>\>\> time.asctime((11, 1, 1, 12, 34, 56, 4, 1, 0\))
'Fri Jan 1 12:34:56 11'

\`\`\`

Several functions now have significantly expanded date ranges. When
`time.accept2dyear` is false, the [`time.asctime()`](../library/time.html#time.asctime "time.asctime") function will
accept any year that fits in a C int, while the [`time.mktime()`](../library/time.html#time.mktime "time.mktime") and
[`time.strftime()`](../library/time.html#time.strftime "time.strftime") functions will accept the full range supported by the
corresponding operating system functions.

(Contributed by Alexander Belopolsky and Victor Stinner in [bpo\-1289118](https://bugs.python.org/issue?@action=redirect&bpo=1289118),
[bpo\-5094](https://bugs.python.org/issue?@action=redirect&bpo=5094), [bpo\-6641](https://bugs.python.org/issue?@action=redirect&bpo=6641), [bpo\-2706](https://bugs.python.org/issue?@action=redirect&bpo=2706), [bpo\-1777412](https://bugs.python.org/issue?@action=redirect&bpo=1777412), [bpo\-8013](https://bugs.python.org/issue?@action=redirect&bpo=8013),
and [bpo\-10827](https://bugs.python.org/issue?@action=redirect&bpo=10827).)

### math[¶](#math "Link to this heading")

The [`math`](../library/math.html#module-math "math: Mathematical functions (sin() etc.).") module has been updated with six new functions inspired by the
C99 standard.

The [`isfinite()`](../library/math.html#math.isfinite "math.isfinite") function provides a reliable and fast way to detect
special values. It returns `True` for regular numbers and `False` for *Nan* or
*Infinity*:

\`\`\`
\>\>\> from math import isfinite
\>\>\> \[isfinite(x) for x in (123, 4\.56, float('Nan'), float('Inf'))]
\[True, True, False, False]

\`\`\`

The [`expm1()`](../library/math.html#math.expm1 "math.expm1") function computes `e**x-1` for small values of *x*
without incurring the loss of precision that usually accompanies the subtraction
of nearly equal quantities:

\`\`\`
\>\>\> from math import expm1
\>\>\> expm1(0\.013671875\) \# more accurate way to compute e\*\*x\-1 for a small x
0\.013765762467652909

\`\`\`

The [`erf()`](../library/math.html#math.erf "math.erf") function computes a probability integral or [Gaussian
error function](https://en.wikipedia.org/wiki/Error_function). The
complementary error function, [`erfc()`](../library/math.html#math.erfc "math.erfc"), is `1 - erf(x)`:

\`\`\`
\>\>\> from math import erf, erfc, sqrt
\>\>\> erf(1\.0/sqrt(2\.0\)) \# portion of normal distribution within 1 standard deviation
0\.682689492137086
\>\>\> erfc(1\.0/sqrt(2\.0\)) \# portion of normal distribution outside 1 standard deviation
0\.31731050786291404
\>\>\> erf(1\.0/sqrt(2\.0\)) \+ erfc(1\.0/sqrt(2\.0\))
1\.0

\`\`\`

The [`gamma()`](../library/math.html#math.gamma "math.gamma") function is a continuous extension of the factorial
function. See  for details. Because
the function is related to factorials, it grows large even for small values of
*x*, so there is also a [`lgamma()`](../library/math.html#math.lgamma "math.lgamma") function for computing the natural
logarithm of the gamma function:

\`\`\`
\>\>\> from math import gamma, lgamma
\>\>\> gamma(7\.0\) \# six factorial
720\.0
\>\>\> lgamma(801\.0\) \# log(800 factorial)
4551\.950730698041

\`\`\`

(Contributed by Mark Dickinson.)

### abc[¶](#abc "Link to this heading")

The [`abc`](../library/abc.html#module-abc "abc: Abstract base classes according to :pep:`3119`.") module now supports [`abstractclassmethod()`](../library/abc.html#abc.abstractclassmethod "abc.abstractclassmethod") and
[`abstractstaticmethod()`](../library/abc.html#abc.abstractstaticmethod "abc.abstractstaticmethod").

These tools make it possible to define an [abstract base class](../glossary.html#term-abstract-base-class) that
requires a particular [`classmethod()`](../library/functions.html#classmethod "classmethod") or [`staticmethod()`](../library/functions.html#staticmethod "staticmethod") to be
implemented:

\`\`\`
class Temperature(metaclass=abc.ABCMeta):
 @abc.abstractclassmethod
 def from\_fahrenheit(cls, t):
 ...
 @abc.abstractclassmethod
 def from\_celsius(cls, t):
 ...

\`\`\`

(Patch submitted by Daniel Urban; [bpo\-5867](https://bugs.python.org/issue?@action=redirect&bpo=5867).)

### io[¶](#io "Link to this heading")

The [`io.BytesIO`](../library/io.html#io.BytesIO "io.BytesIO") has a new method, [`getbuffer()`](../library/io.html#io.BytesIO.getbuffer "io.BytesIO.getbuffer"), which
provides functionality similar to [`memoryview()`](../library/stdtypes.html#memoryview "memoryview"). It creates an editable
view of the data without making a copy. The buffer’s random access and support
for slice notation are well\-suited to in\-place editing:

\`\`\`
\>\>\> REC\_LEN, LOC\_START, LOC\_LEN = 34, 7, 11

\>\>\> def change\_location(buffer, record\_number, location):
... start = record\_number \* REC\_LEN \+ LOC\_START
... buffer\[start: start\+LOC\_LEN] = location

\>\>\> import io

\>\>\> byte\_stream = io.BytesIO(
... b'G3805 storeroom Main chassis '
... b'X7899 shipping Reserve cog '
... b'L6988 receiving Primary sprocket'
... )
\>\>\> buffer = byte\_stream.getbuffer()
\>\>\> change\_location(buffer, 1, b'warehouse ')
\>\>\> change\_location(buffer, 0, b'showroom ')
\>\>\> print(byte\_stream.getvalue())
b'G3805 showroom Main chassis '
b'X7899 warehouse Reserve cog '
b'L6988 receiving Primary sprocket'

\`\`\`

(Contributed by Antoine Pitrou in [bpo\-5506](https://bugs.python.org/issue?@action=redirect&bpo=5506).)

### reprlib[¶](#reprlib "Link to this heading")

When writing a [`__repr__()`](../reference/datamodel.html#object.__repr__ "object.__repr__") method for a custom container, it is easy to
forget to handle the case where a member refers back to the container itself.
Python’s builtin objects such as [`list`](../library/stdtypes.html#list "list") and [`set`](../library/stdtypes.html#set "set") handle
self\-reference by displaying “…” in the recursive part of the representation
string.

To help write such [`__repr__()`](../reference/datamodel.html#object.__repr__ "object.__repr__") methods, the [`reprlib`](../library/reprlib.html#module-reprlib "reprlib: Alternate repr() implementation with size limits.") module has a new
decorator, [`recursive_repr()`](../library/reprlib.html#reprlib.recursive_repr "reprlib.recursive_repr"), for detecting recursive calls to
`__repr__()` and substituting a placeholder string instead:

\`\`\`
\>\>\> class MyList(list):
... @recursive\_repr()
... def \_\_repr\_\_(self):
... return '\'
...
\>\>\> m = MyList('abc')
\>\>\> m.append(m)
\>\>\> m.append('x')
\>\>\> print(m)
\

\`\`\`

(Contributed by Raymond Hettinger in [bpo\-9826](https://bugs.python.org/issue?@action=redirect&bpo=9826) and [bpo\-9840](https://bugs.python.org/issue?@action=redirect&bpo=9840).)

### logging[¶](#logging "Link to this heading")

In addition to dictionary\-based configuration described above, the
[`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications.") package has many other improvements.

The logging documentation has been augmented by a [basic tutorial](../howto/logging.html#logging-basic-tutorial), an [advanced tutorial](../howto/logging.html#logging-advanced-tutorial), and a [cookbook](../howto/logging-cookbook.html#logging-cookbook) of
logging recipes. These documents are the fastest way to learn about logging.

The [`logging.basicConfig()`](../library/logging.html#logging.basicConfig "logging.basicConfig") set\-up function gained a *style* argument to
support three different types of string formatting. It defaults to “%” for
traditional %\-formatting, can be set to “{” for the new [`str.format()`](../library/stdtypes.html#str.format "str.format") style, or
can be set to “$” for the shell\-style formatting provided by
[`string.Template`](../library/string.html#string.Template "string.Template"). The following three configurations are equivalent:

\`\`\`
\>\>\> from logging import basicConfig
\>\>\> basicConfig(style='%', format="%(name)s \-\> %(levelname)s: %(message)s")
\>\>\> basicConfig(style='{', format="{name} \-\> {levelname} {message}")
\>\>\> basicConfig(style='$', format="$name \-\> $levelname: $message")

\`\`\`

If no configuration is set\-up before a logging event occurs, there is now a
default configuration using a [`StreamHandler`](../library/logging.handlers.html#logging.StreamHandler "logging.StreamHandler") directed to
[`sys.stderr`](../library/sys.html#sys.stderr "sys.stderr") for events of `WARNING` level or higher. Formerly, an
event occurring before a configuration was set\-up would either raise an
exception or silently drop the event depending on the value of
[`logging.raiseExceptions`](../library/logging.html#logging.raiseExceptions "logging.raiseExceptions"). The new default handler is stored in
[`logging.lastResort`](../library/logging.html#logging.lastResort "logging.lastResort").

The use of filters has been simplified. Instead of creating a
[`Filter`](../library/logging.html#logging.Filter "logging.Filter") object, the predicate can be any Python callable that
returns `True` or `False`.

There were a number of other improvements that add flexibility and simplify
configuration. See the module documentation for a full listing of changes in
Python 3\.2\.

### csv[¶](#csv "Link to this heading")

The [`csv`](../library/csv.html#module-csv "csv: Write and read tabular data to and from delimited files.") module now supports a new dialect, [`unix_dialect`](../library/csv.html#csv.unix_dialect "csv.unix_dialect"),
which applies quoting for all fields and a traditional Unix style with `'\n'` as
the line terminator. The registered dialect name is `unix`.

The [`csv.DictWriter`](../library/csv.html#csv.DictWriter "csv.DictWriter") has a new method,
[`writeheader()`](../library/csv.html#csv.DictWriter.writeheader "csv.DictWriter.writeheader") for writing\-out an initial row to document
the field names:

\`\`\`
\>\>\> import csv, sys
\>\>\> w = csv.DictWriter(sys.stdout, \['name', 'dept'], dialect='unix')
\>\>\> w.writeheader()
"name","dept"
\>\>\> w.writerows(\[
... {'name': 'tom', 'dept': 'accounting'},
... {'name': 'susan', 'dept': 'Salesl'}])
"tom","accounting"
"susan","sales"

\`\`\`

(New dialect suggested by Jay Talbot in [bpo\-5975](https://bugs.python.org/issue?@action=redirect&bpo=5975), and the new method
suggested by Ed Abraham in [bpo\-1537721](https://bugs.python.org/issue?@action=redirect&bpo=1537721).)

### contextlib[¶](#contextlib "Link to this heading")

There is a new and slightly mind\-blowing tool
[`ContextDecorator`](../library/contextlib.html#contextlib.ContextDecorator "contextlib.ContextDecorator") that is helpful for creating a
[context manager](../glossary.html#term-context-manager) that does double duty as a function decorator.

As a convenience, this new functionality is used by
[`contextmanager()`](../library/contextlib.html#contextlib.contextmanager "contextlib.contextmanager") so that no extra effort is needed to support
both roles.

The basic idea is that both context managers and function decorators can be used
for pre\-action and post\-action wrappers. Context managers wrap a group of
statements using a [`with`](../reference/compound_stmts.html#with) statement, and function decorators wrap a
group of statements enclosed in a function. So, occasionally there is a need to
write a pre\-action or post\-action wrapper that can be used in either role.

For example, it is sometimes useful to wrap functions or groups of statements
with a logger that can track the time of entry and time of exit. Rather than
writing both a function decorator and a context manager for the task, the
[`contextmanager()`](../library/contextlib.html#contextlib.contextmanager "contextlib.contextmanager") provides both capabilities in a single
definition:

\`\`\`
from contextlib import contextmanager
import logging

logging.basicConfig(level=logging.INFO)

@contextmanager
def track\_entry\_and\_exit(name):
 logging.info('Entering: %s', name)
 yield
 logging.info('Exiting: %s', name)

\`\`\`

Formerly, this would have only been usable as a context manager:

\`\`\`
with track\_entry\_and\_exit('widget loader'):
 print('Some time consuming activity goes here')
 load\_widget()

\`\`\`

Now, it can be used as a decorator as well:

\`\`\`
@track\_entry\_and\_exit('widget loader')
def activity():
 print('Some time consuming activity goes here')
 load\_widget()

\`\`\`

Trying to fulfill two roles at once places some limitations on the technique.
Context managers normally have the flexibility to return an argument usable by
a [`with`](../reference/compound_stmts.html#with) statement, but there is no parallel for function decorators.

In the above example, there is not a clean way for the *track\_entry\_and\_exit*
context manager to return a logging instance for use in the body of enclosed
statements.

(Contributed by Michael Foord in [bpo\-9110](https://bugs.python.org/issue?@action=redirect&bpo=9110).)

### decimal and fractions[¶](#decimal-and-fractions "Link to this heading")

Mark Dickinson crafted an elegant and efficient scheme for assuring that
different numeric datatypes will have the same hash value whenever their actual
values are equal ([bpo\-8188](https://bugs.python.org/issue?@action=redirect&bpo=8188)):

\`\`\`
assert hash(Fraction(3, 2\)) == hash(1\.5\) == \\
 hash(Decimal("1\.5")) == hash(complex(1\.5, 0\))

\`\`\`

Some of the hashing details are exposed through a new attribute,
[`sys.hash_info`](../library/sys.html#sys.hash_info "sys.hash_info"), which describes the bit width of the hash value, the
prime modulus, the hash values for *infinity* and *nan*, and the multiplier
used for the imaginary part of a number:

\`\`\`
\>\>\> sys.hash\_info 
sys.hash\_info(width=64, modulus=2305843009213693951, inf=314159, nan=0, imag=1000003\)

\`\`\`

An early decision to limit the interoperability of various numeric types has
been relaxed. It is still unsupported (and ill\-advised) to have implicit
mixing in arithmetic expressions such as `Decimal('1.1') + float('1.1')`
because the latter loses information in the process of constructing the binary
float. However, since existing floating\-point value can be converted losslessly
to either a decimal or rational representation, it makes sense to add them to
the constructor and to support mixed\-type comparisons.

* The [`decimal.Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal") constructor now accepts [`float`](../library/functions.html#float "float") objects
directly so there in no longer a need to use the [`from_float()`](../library/decimal.html#decimal.Decimal.from_float "decimal.Decimal.from_float")
method ([bpo\-8257](https://bugs.python.org/issue?@action=redirect&bpo=8257)).
* Mixed type comparisons are now fully supported so that
[`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal") objects can be directly compared with [`float`](../library/functions.html#float "float")
and [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") ([bpo\-2531](https://bugs.python.org/issue?@action=redirect&bpo=2531) and [bpo\-8188](https://bugs.python.org/issue?@action=redirect&bpo=8188)).

Similar changes were made to [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") so that the
[`from_float()`](../library/fractions.html#fractions.Fraction.from_float "fractions.Fraction.from_float") and [`from_decimal()`](../library/fractions.html#fractions.Fraction.from_decimal "fractions.Fraction.from_decimal")
methods are no longer needed ([bpo\-8294](https://bugs.python.org/issue?@action=redirect&bpo=8294)):

\`\`\`
\>\>\> from decimal import Decimal
\>\>\> from fractions import Fraction
\>\>\> Decimal(1\.1\)
Decimal('1\.100000000000000088817841970012523233890533447265625')
\>\>\> Fraction(1\.1\)
Fraction(2476979795053773, 2251799813685248\)

\`\`\`

Another useful change for the [`decimal`](../library/decimal.html#module-decimal "decimal: Implementation of the General Decimal Arithmetic  Specification.") module is that the
`Context.clamp` attribute is now public. This is useful in creating
contexts that correspond to the decimal interchange formats specified in IEEE
754 (see [bpo\-8540](https://bugs.python.org/issue?@action=redirect&bpo=8540)).

(Contributed by Mark Dickinson and Raymond Hettinger.)

### ftp[¶](#ftp "Link to this heading")

The [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") class now supports the context management protocol to
unconditionally consume [`socket.error`](../library/socket.html#socket.error "socket.error") exceptions and to close the FTP
connection when done:

\`\`\`
\>\>\> from ftplib import FTP
\>\>\> with FTP("ftp1\.at.proftpd.org") as ftp:
 ftp.login()
 ftp.dir()

'230 Anonymous login ok, restrictions apply.'
dr\-xr\-xr\-x 9 ftp ftp 154 May 6 10:43 .
dr\-xr\-xr\-x 9 ftp ftp 154 May 6 10:43 ..
dr\-xr\-xr\-x 5 ftp ftp 4096 May 6 10:43 CentOS
dr\-xr\-xr\-x 3 ftp ftp 18 Jul 10 2008 Fedora

\`\`\`

Other file\-like objects such as [`mmap.mmap`](../library/mmap.html#mmap.mmap "mmap.mmap") and [`fileinput.input()`](../library/fileinput.html#fileinput.input "fileinput.input")
also grew auto\-closing context managers:

\`\`\`
with fileinput.input(files=('log1\.txt', 'log2\.txt')) as f:
 for line in f:
 process(line)

\`\`\`

(Contributed by Tarek Ziadé and Giampaolo Rodolà in [bpo\-4972](https://bugs.python.org/issue?@action=redirect&bpo=4972), and
by Georg Brandl in [bpo\-8046](https://bugs.python.org/issue?@action=redirect&bpo=8046) and [bpo\-1286](https://bugs.python.org/issue?@action=redirect&bpo=1286).)

The [`FTP_TLS`](../library/ftplib.html#ftplib.FTP_TLS "ftplib.FTP_TLS") class now accepts a *context* parameter, which is a
[`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") object allowing bundling SSL configuration options,
certificates and private keys into a single (potentially long\-lived) structure.

(Contributed by Giampaolo Rodolà; [bpo\-8806](https://bugs.python.org/issue?@action=redirect&bpo=8806).)

### popen[¶](#popen "Link to this heading")

The [`os.popen()`](../library/os.html#os.popen "os.popen") and [`subprocess.Popen()`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") functions now support
[`with`](../reference/compound_stmts.html#with) statements for auto\-closing of the file descriptors.

(Contributed by Antoine Pitrou and Brian Curtin in [bpo\-7461](https://bugs.python.org/issue?@action=redirect&bpo=7461) and
[bpo\-10554](https://bugs.python.org/issue?@action=redirect&bpo=10554).)

### select[¶](#select "Link to this heading")

The [`select`](../library/select.html#module-select "select: Wait for I/O completion on multiple streams.") module now exposes a new, constant attribute,
[`PIPE_BUF`](../library/select.html#select.PIPE_BUF "select.PIPE_BUF"), which gives the minimum number of bytes which are
guaranteed not to block when [`select.select()`](../library/select.html#select.select "select.select") says a pipe is ready
for writing.

\`\`\`
\>\>\> import select
\>\>\> select.PIPE\_BUF 
512

\`\`\`

(Available on Unix systems. Patch by Sébastien Sablé in [bpo\-9862](https://bugs.python.org/issue?@action=redirect&bpo=9862))

### gzip and zipfile[¶](#gzip-and-zipfile "Link to this heading")

[`gzip.GzipFile`](../library/gzip.html#gzip.GzipFile "gzip.GzipFile") now implements the [`io.BufferedIOBase`](../library/io.html#io.BufferedIOBase "io.BufferedIOBase")
[abstract base class](../glossary.html#term-abstract-base-class) (except for `truncate()`). It also has a
[`peek()`](../library/gzip.html#gzip.GzipFile.peek "gzip.GzipFile.peek") method and supports unseekable as well as
zero\-padded file objects.

The [`gzip`](../library/gzip.html#module-gzip "gzip: Interfaces for gzip compression and decompression using file objects.") module also gains the [`compress()`](../library/gzip.html#gzip.compress "gzip.compress") and
[`decompress()`](../library/gzip.html#gzip.decompress "gzip.decompress") functions for easier in\-memory compression and
decompression. Keep in mind that text needs to be encoded as [`bytes`](../library/stdtypes.html#bytes "bytes")
before compressing and decompressing:

\`\`\`
\>\>\> import gzip
\>\>\> s = 'Three shall be the number thou shalt count, '
\>\>\> s \+= 'and the number of the counting shall be three'
\>\>\> b = s.encode() \# convert to utf\-8
\>\>\> len(b)
89
\>\>\> c = gzip.compress(b)
\>\>\> len(c)
77
\>\>\> gzip.decompress(c).decode()\[:42] \# decompress and convert to text
'Three shall be the number thou shalt count'

\`\`\`

(Contributed by Anand B. Pillai in [bpo\-3488](https://bugs.python.org/issue?@action=redirect&bpo=3488); and by Antoine Pitrou, Nir
Aides and Brian Curtin in [bpo\-9962](https://bugs.python.org/issue?@action=redirect&bpo=9962), [bpo\-1675951](https://bugs.python.org/issue?@action=redirect&bpo=1675951), [bpo\-7471](https://bugs.python.org/issue?@action=redirect&bpo=7471) and
[bpo\-2846](https://bugs.python.org/issue?@action=redirect&bpo=2846).)

Also, the [`zipfile.ZipExtFile`](../library/zipfile.html#zipfile.ZipFile.open "zipfile.ZipFile.open") class was reworked internally to represent
files stored inside an archive. The new implementation is significantly faster
and can be wrapped in an [`io.BufferedReader`](../library/io.html#io.BufferedReader "io.BufferedReader") object for more speedups. It
also solves an issue where interleaved calls to *read* and *readline* gave the
wrong results.

(Patch submitted by Nir Aides in [bpo\-7610](https://bugs.python.org/issue?@action=redirect&bpo=7610).)

### tarfile[¶](#tarfile "Link to this heading")

The [`TarFile`](../library/tarfile.html#tarfile.TarFile "tarfile.TarFile") class can now be used as a context manager. In
addition, its [`add()`](../library/tarfile.html#tarfile.TarFile.add "tarfile.TarFile.add") method has a new option, *filter*,
that controls which files are added to the archive and allows the file metadata
to be edited.

The new *filter* option replaces the older, less flexible *exclude* parameter
which is now deprecated. If specified, the optional *filter* parameter needs to
be a [keyword argument](../glossary.html#term-keyword-argument). The user\-supplied filter function accepts a
[`TarInfo`](../library/tarfile.html#tarfile.TarInfo "tarfile.TarInfo") object and returns an updated
[`TarInfo`](../library/tarfile.html#tarfile.TarInfo "tarfile.TarInfo") object, or if it wants the file to be excluded, the
function can return `None`:

\`\`\`
\>\>\> import tarfile, glob

\>\>\> def myfilter(tarinfo):
... if tarinfo.isfile(): \# only save real files
... tarinfo.uname = 'monty' \# redact the user name
... return tarinfo

\>\>\> with tarfile.open(name='myarchive.tar.gz', mode='w:gz') as tf:
... for filename in glob.glob('\*.txt'):
... tf.add(filename, filter=myfilter)
... tf.list()
\-rw\-r\-\-r\-\- monty/501 902 2011\-01\-26 17:59:11 annotations.txt
\-rw\-r\-\-r\-\- monty/501 123 2011\-01\-26 17:59:11 general\_questions.txt
\-rw\-r\-\-r\-\- monty/501 3514 2011\-01\-26 17:59:11 prion.txt
\-rw\-r\-\-r\-\- monty/501 124 2011\-01\-26 17:59:11 py\_todo.txt
\-rw\-r\-\-r\-\- monty/501 1399 2011\-01\-26 17:59:11 semaphore\_notes.txt

\`\`\`

(Proposed by Tarek Ziadé and implemented by Lars Gustäbel in [bpo\-6856](https://bugs.python.org/issue?@action=redirect&bpo=6856).)

### hashlib[¶](#hashlib "Link to this heading")

The [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") module has two new constant attributes listing the hashing
algorithms guaranteed to be present in all implementations and those available
on the current implementation:

\`\`\`
\>\>\> import hashlib

\>\>\> hashlib.algorithms\_guaranteed
{'sha1', 'sha224', 'sha384', 'sha256', 'sha512', 'md5'}

\>\>\> hashlib.algorithms\_available
{'md2', 'SHA256', 'SHA512', 'dsaWithSHA', 'mdc2', 'SHA224', 'MD4', 'sha256',
'sha512', 'ripemd160', 'SHA1', 'MDC2', 'SHA', 'SHA384', 'MD2',
'ecdsa\-with\-SHA1','md4', 'md5', 'sha1', 'DSA\-SHA', 'sha224',
'dsaEncryption', 'DSA', 'RIPEMD160', 'sha', 'MD5', 'sha384'}

\`\`\`

(Suggested by Carl Chenet in [bpo\-7418](https://bugs.python.org/issue?@action=redirect&bpo=7418).)

### ast[¶](#ast "Link to this heading")

The [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") module has a wonderful a general\-purpose tool for safely
evaluating expression strings using the Python literal
syntax. The [`ast.literal_eval()`](../library/ast.html#ast.literal_eval "ast.literal_eval") function serves as a secure alternative to
the builtin [`eval()`](../library/functions.html#eval "eval") function which is easily abused. Python 3\.2 adds
[`bytes`](../library/stdtypes.html#bytes "bytes") and [`set`](../library/stdtypes.html#set "set") literals to the list of supported types:
strings, bytes, numbers, tuples, lists, dicts, sets, booleans, and `None`.

\`\`\`
\>\>\> from ast import literal\_eval

\>\>\> request = "{'req': 3, 'func': 'pow', 'args': (2, 0\.5\)}"
\>\>\> literal\_eval(request)
{'args': (2, 0\.5\), 'req': 3, 'func': 'pow'}

\>\>\> request = "os.system('do something harmful')"
\>\>\> literal\_eval(request)
Traceback (most recent call last):
 ...
ValueError: malformed node or string: \

\`\`\`

(Implemented by Benjamin Peterson and Georg Brandl.)

### os[¶](#os "Link to this heading")

Different operating systems use various encodings for filenames and environment
variables. The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module provides two new functions,
[`fsencode()`](../library/os.html#os.fsencode "os.fsencode") and [`fsdecode()`](../library/os.html#os.fsdecode "os.fsdecode"), for encoding and decoding
filenames:

\`\`\`
\>\>\> import os
\>\>\> filename = 'Sehenswürdigkeiten'
\>\>\> os.fsencode(filename)
b'Sehensw\\xc3\\xbcrdigkeiten'

\`\`\`

Some operating systems allow direct access to encoded bytes in the
environment. If so, the [`os.supports_bytes_environ`](../library/os.html#os.supports_bytes_environ "os.supports_bytes_environ") constant will be
true.

For direct access to encoded environment variables (if available),
use the new [`os.getenvb()`](../library/os.html#os.getenvb "os.getenvb") function or use [`os.environb`](../library/os.html#os.environb "os.environb")
which is a bytes version of [`os.environ`](../library/os.html#os.environ "os.environ").

(Contributed by Victor Stinner.)

### shutil[¶](#shutil "Link to this heading")

The [`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree") function has two new options:

* *ignore\_dangling\_symlinks*: when `symlinks=False` so that the function
copies a file pointed to by a symlink, not the symlink itself. This option
will silence the error raised if the file doesn’t exist.
* *copy\_function*: is a callable that will be used to copy files.
[`shutil.copy2()`](../library/shutil.html#shutil.copy2 "shutil.copy2") is used by default.

(Contributed by Tarek Ziadé.)

In addition, the [`shutil`](../library/shutil.html#module-shutil "shutil: High-level file operations, including copying.") module now supports [archiving operations](../library/shutil.html#archiving-operations) for zipfiles, uncompressed tarfiles, gzipped tarfiles,
and bzipped tarfiles. And there are functions for registering additional
archiving file formats (such as xz compressed tarfiles or custom formats).

The principal functions are [`make_archive()`](../library/shutil.html#shutil.make_archive "shutil.make_archive") and
[`unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"). By default, both operate on the current
directory (which can be set by [`os.chdir()`](../library/os.html#os.chdir "os.chdir")) and on any sub\-directories.
The archive filename needs to be specified with a full pathname. The archiving
step is non\-destructive (the original files are left unchanged).

\`\`\`
\>\>\> import shutil, pprint

\>\>\> os.chdir('mydata') \# change to the source directory
\>\>\> f = shutil.make\_archive('/var/backup/mydata',
... 'zip') \# archive the current directory
\>\>\> f \# show the name of archive
'/var/backup/mydata.zip'
\>\>\> os.chdir('tmp') \# change to an unpacking
\>\>\> shutil.unpack\_archive('/var/backup/mydata.zip') \# recover the data

\>\>\> pprint.pprint(shutil.get\_archive\_formats()) \# display known formats
\[('bztar', "bzip2'ed tar\-file"),
 ('gztar', "gzip'ed tar\-file"),
 ('tar', 'uncompressed tar file'),
 ('zip', 'ZIP file')]

\>\>\> shutil.register\_archive\_format( \# register a new archive format
... name='xz',
... function=xz.compress, \# callable archiving function
... extra\_args=\[('level', 8\)], \# arguments to the function
... description='xz compression'
... )

\`\`\`

(Contributed by Tarek Ziadé.)

### sqlite3[¶](#sqlite3 "Link to this heading")

The [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") module was updated to pysqlite version 2\.6\.0\. It has two new capabilities.

* The `sqlite3.Connection.in_transit` attribute is true if there is an
active transaction for uncommitted changes.
* The [`sqlite3.Connection.enable_load_extension()`](../library/sqlite3.html#sqlite3.Connection.enable_load_extension "sqlite3.Connection.enable_load_extension") and
[`sqlite3.Connection.load_extension()`](../library/sqlite3.html#sqlite3.Connection.load_extension "sqlite3.Connection.load_extension") methods allows you to load SQLite
extensions from “.so” files. One well\-known extension is the fulltext\-search
extension distributed with SQLite.

(Contributed by R. David Murray and Shashwat Anand; [bpo\-8845](https://bugs.python.org/issue?@action=redirect&bpo=8845).)

### html[¶](#html "Link to this heading")

A new [`html`](../library/html.html#module-html "html: Helpers for manipulating HTML.") module was introduced with only a single function,
[`escape()`](../library/html.html#html.escape "html.escape"), which is used for escaping reserved characters from HTML
markup:

\`\`\`
\>\>\> import html
\>\>\> html.escape('x \> 2 \&\& x \\>\> from unittest import TestCase
\>\>\> TestCase().assertEqual(pow(2, 3\), 8\)

\`\`\`

(Contributed by Michael Foord.)
* The [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") module has two new methods,
[`assertWarns()`](../library/unittest.html#unittest.TestCase.assertWarns "unittest.TestCase.assertWarns") and
[`assertWarnsRegex()`](../library/unittest.html#unittest.TestCase.assertWarnsRegex "unittest.TestCase.assertWarnsRegex") to verify that a given warning type
is triggered by the code under test:

\`\`\`
with self.assertWarns(DeprecationWarning):
 legacy\_function('XYZ')

\`\`\`

(Contributed by Antoine Pitrou, [bpo\-9754](https://bugs.python.org/issue?@action=redirect&bpo=9754).)

Another new method, [`assertCountEqual()`](../library/unittest.html#unittest.TestCase.assertCountEqual "unittest.TestCase.assertCountEqual") is used to
compare two iterables to determine if their element counts are equal (whether
the same elements are present with the same number of occurrences regardless
of order):

\`\`\`
def test\_anagram(self):
 self.assertCountEqual('algorithm', 'logarithm')

\`\`\`

(Contributed by Raymond Hettinger.)
* A principal feature of the unittest module is an effort to produce meaningful
diagnostics when a test fails. When possible, the failure is recorded along
with a diff of the output. This is especially helpful for analyzing log files
of failed test runs. However, since diffs can sometime be voluminous, there is
a new [`maxDiff`](../library/unittest.html#unittest.TestCase.maxDiff "unittest.TestCase.maxDiff") attribute that sets maximum length of
diffs displayed.
* In addition, the method names in the module have undergone a number of clean\-ups.

For example, [`assertRegex()`](../library/unittest.html#unittest.TestCase.assertRegex "unittest.TestCase.assertRegex") is the new name for
`assertRegexpMatches()` which was misnamed because the
test uses [`re.search()`](../library/re.html#re.search "re.search"), not [`re.match()`](../library/re.html#re.match "re.match"). Other methods using
regular expressions are now named using short form “Regex” in preference to
“Regexp” – this matches the names used in other unittest implementations,
matches Python’s old name for the [`re`](../library/re.html#module-re "re: Regular expression operations.") module, and it has unambiguous
camel\-casing.

(Contributed by Raymond Hettinger and implemented by Ezio Melotti.)
* To improve consistency, some long\-standing method aliases are being
deprecated in favor of the preferred names:

> | Old Name | Preferred Name |
> | --- | --- |
> | `assert_()` | [`assertTrue()`](../library/unittest.html#unittest.TestCase.assertTrue "unittest.TestCase.assertTrue") |
> | `assertEquals()` | [`assertEqual()`](../library/unittest.html#unittest.TestCase.assertEqual "unittest.TestCase.assertEqual") |
> | `assertNotEquals()` | [`assertNotEqual()`](../library/unittest.html#unittest.TestCase.assertNotEqual "unittest.TestCase.assertNotEqual") |
> | `assertAlmostEquals()` | [`assertAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertAlmostEqual "unittest.TestCase.assertAlmostEqual") |
> | `assertNotAlmostEquals()` | [`assertNotAlmostEqual()`](../library/unittest.html#unittest.TestCase.assertNotAlmostEqual "unittest.TestCase.assertNotAlmostEqual") |

Likewise, the `TestCase.fail*` methods deprecated in Python 3\.1 are expected
to be removed in Python 3\.3\.

(Contributed by Ezio Melotti; [bpo\-9424](https://bugs.python.org/issue?@action=redirect&bpo=9424).)
* The `assertDictContainsSubset()` method was deprecated
because it was misimplemented with the arguments in the wrong order. This
created hard\-to\-debug optical illusions where tests like
`TestCase().assertDictContainsSubset({'a':1, 'b':2}, {'a':1})` would fail.

(Contributed by Raymond Hettinger.)

### random[¶](#random "Link to this heading")

The integer methods in the [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions.") module now do a better job of producing
uniform distributions. Previously, they computed selections with
`int(n*random())` which had a slight bias whenever *n* was not a power of two.
Now, multiple selections are made from a range up to the next power of two and a
selection is kept only when it falls within the range `0 \>\> from inspect import getgeneratorstate
\>\>\> def gen():
... yield 'demo'
...
\>\>\> g = gen()
\>\>\> getgeneratorstate(g)
'GEN\_CREATED'
\>\>\> next(g)
'demo'
\>\>\> getgeneratorstate(g)
'GEN\_SUSPENDED'
\>\>\> next(g, None)
\>\>\> getgeneratorstate(g)
'GEN\_CLOSED'

\`\`\`

(Contributed by Rodolpho Eckhardt and Nick Coghlan, [bpo\-10220](https://bugs.python.org/issue?@action=redirect&bpo=10220).)
* To support lookups without the possibility of activating a dynamic attribute,
the [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") module has a new function, [`getattr_static()`](../library/inspect.html#inspect.getattr_static "inspect.getattr_static").
Unlike [`hasattr()`](../library/functions.html#hasattr "hasattr"), this is a true read\-only search, guaranteed not to
change state while it is searching:

\`\`\`
\>\>\> class A:
... @property
... def f(self):
... print('Running')
... return 10
...
\>\>\> a = A()
\>\>\> getattr(a, 'f')
Running
10
\>\>\> inspect.getattr\_static(a, 'f')
\

\`\`\`

> (Contributed by Michael Foord.)

### pydoc[¶](#pydoc "Link to this heading")

The [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") module now provides a much\-improved web server interface, as
well as a new command\-line option `-b` to automatically open a browser window
to display that server:

\`\`\`
$ pydoc3\.2 \-b

\`\`\`

(Contributed by Ron Adam; [bpo\-2001](https://bugs.python.org/issue?@action=redirect&bpo=2001).)

### dis[¶](#dis "Link to this heading")

The [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module gained two new functions for inspecting code,
[`code_info()`](../library/dis.html#dis.code_info "dis.code_info") and [`show_code()`](../library/dis.html#dis.show_code "dis.show_code"). Both provide detailed code
object information for the supplied function, method, source code string or code
object. The former returns a string and the latter prints it:

\`\`\`
\>\>\> import dis, random
\>\>\> dis.show\_code(random.choice)
Name: choice
Filename: /Library/Frameworks/Python.framework/Versions/3\.2/lib/python3\.2/random.py
Argument count: 2
Kw\-only arguments: 0
Number of locals: 3
Stack size: 11
Flags: OPTIMIZED, NEWLOCALS, NOFREE
Constants:
 0: 'Choose a random element from a non\-empty sequence.'
 1: 'Cannot choose from an empty sequence'
Names:
 0: \_randbelow
 1: len
 2: ValueError
 3: IndexError
Variable names:
 0: self
 1: seq
 2: i

\`\`\`

In addition, the [`dis()`](../library/dis.html#dis.dis "dis.dis") function now accepts string arguments
so that the common idiom `dis(compile(s, '', 'eval'))` can be shortened
to `dis(s)`:

\`\`\`
\>\>\> dis('3\*x\+1 if x%2==1 else x//2')
 1 0 LOAD\_NAME 0 (x)
 3 LOAD\_CONST 0 (2\)
 6 BINARY\_MODULO
 7 LOAD\_CONST 1 (1\)
 10 COMPARE\_OP 2 (==)
 13 POP\_JUMP\_IF\_FALSE 28
 16 LOAD\_CONST 2 (3\)
 19 LOAD\_NAME 0 (x)
 22 BINARY\_MULTIPLY
 23 LOAD\_CONST 1 (1\)
 26 BINARY\_ADD
 27 RETURN\_VALUE
 \>\> 28 LOAD\_NAME 0 (x)
 31 LOAD\_CONST 0 (2\)
 34 BINARY\_FLOOR\_DIVIDE
 35 RETURN\_VALUE

\`\`\`

Taken together, these improvements make it easier to explore how CPython is
implemented and to see for yourself what the language syntax does
under\-the\-hood.

(Contributed by Nick Coghlan in [bpo\-9147](https://bugs.python.org/issue?@action=redirect&bpo=9147).)

### dbm[¶](#dbm "Link to this heading")

All database modules now support the `get()` and `setdefault()` methods.

(Suggested by Ray Allen in [bpo\-9523](https://bugs.python.org/issue?@action=redirect&bpo=9523).)

### ctypes[¶](#ctypes "Link to this heading")

A new type, [`ctypes.c_ssize_t`](../library/ctypes.html#ctypes.c_ssize_t "ctypes.c_ssize_t") represents the C `ssize_t` datatype.

### site[¶](#site "Link to this heading")

The [`site`](../library/site.html#module-site "site: Module responsible for site-specific configuration.") module has three new functions useful for reporting on the
details of a given Python installation.

* [`getsitepackages()`](../library/site.html#site.getsitepackages "site.getsitepackages") lists all global site\-packages directories.
* [`getuserbase()`](../library/site.html#site.getuserbase "site.getuserbase") reports on the user’s base directory where data can
be stored.
* [`getusersitepackages()`](../library/site.html#site.getusersitepackages "site.getusersitepackages") reveals the user\-specific site\-packages
directory path.

\`\`\`
\>\>\> import site
\>\>\> site.getsitepackages()
\['/Library/Frameworks/Python.framework/Versions/3\.2/lib/python3\.2/site\-packages',
 '/Library/Frameworks/Python.framework/Versions/3\.2/lib/site\-python',
 '/Library/Python/3\.2/site\-packages']
\>\>\> site.getuserbase()
'/Users/raymondhettinger/Library/Python/3\.2'
\>\>\> site.getusersitepackages()
'/Users/raymondhettinger/Library/Python/3\.2/lib/python/site\-packages'

\`\`\`

Conveniently, some of site’s functionality is accessible directly from the
command\-line:

\`\`\`
$ python \-m site \-\-user\-base
/Users/raymondhettinger/.local
$ python \-m site \-\-user\-site
/Users/raymondhettinger/.local/lib/python3\.2/site\-packages

\`\`\`

(Contributed by Tarek Ziadé in [bpo\-6693](https://bugs.python.org/issue?@action=redirect&bpo=6693).)

### sysconfig[¶](#sysconfig "Link to this heading")

The new [`sysconfig`](../library/sysconfig.html#module-sysconfig "sysconfig: Python's configuration information") module makes it straightforward to discover
installation paths and configuration variables that vary across platforms and
installations.

The module offers access simple access functions for platform and version
information:

* [`get_platform()`](../library/sysconfig.html#sysconfig.get_platform "sysconfig.get_platform") returning values like *linux\-i586* or
*macosx\-10\.6\-ppc*.
* [`get_python_version()`](../library/sysconfig.html#sysconfig.get_python_version "sysconfig.get_python_version") returns a Python version string
such as “3\.2”.

It also provides access to the paths and variables corresponding to one of
seven named schemes used by `distutils`. Those include *posix\_prefix*,
*posix\_home*, *posix\_user*, *nt*, *nt\_user*, *os2*, *os2\_home*:

* [`get_paths()`](../library/sysconfig.html#sysconfig.get_paths "sysconfig.get_paths") makes a dictionary containing installation paths
for the current installation scheme.
* [`get_config_vars()`](../library/sysconfig.html#sysconfig.get_config_vars "sysconfig.get_config_vars") returns a dictionary of platform specific
variables.

There is also a convenient command\-line interface:

\`\`\`
C:\\Python32\>python \-m sysconfig
Platform: "win32"
Python version: "3\.2"
Current installation scheme: "nt"

Paths:
 data = "C:\\Python32"
 include = "C:\\Python32\\Include"
 platinclude = "C:\\Python32\\Include"
 platlib = "C:\\Python32\\Lib\\site\-packages"
 platstdlib = "C:\\Python32\\Lib"
 purelib = "C:\\Python32\\Lib\\site\-packages"
 scripts = "C:\\Python32\\Scripts"
 stdlib = "C:\\Python32\\Lib"

Variables:
 BINDIR = "C:\\Python32"
 BINLIBDEST = "C:\\Python32\\Lib"
 EXE = ".exe"
 INCLUDEPY = "C:\\Python32\\Include"
 LIBDEST = "C:\\Python32\\Lib"
 SO = ".pyd"
 VERSION = "32"
 abiflags = ""
 base = "C:\\Python32"
 exec\_prefix = "C:\\Python32"
 platbase = "C:\\Python32"
 prefix = "C:\\Python32"
 projectbase = "C:\\Python32"
 py\_version = "3\.2"
 py\_version\_nodot = "32"
 py\_version\_short = "3\.2"
 srcdir = "C:\\Python32"
 userbase = "C:\\Documents and Settings\\Raymond\\Application Data\\Python"

\`\`\`

(Moved out of Distutils by Tarek Ziadé.)

### pdb[¶](#pdb "Link to this heading")

The [`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters.") debugger module gained a number of usability improvements:

* `pdb.py` now has a `-c` option that executes commands as given in a
`.pdbrc` script file.
* A `.pdbrc` script file can contain `continue` and `next` commands
that continue debugging.
* The [`Pdb`](../library/pdb.html#pdb.Pdb "pdb.Pdb") class constructor now accepts a *nosigint* argument.
* New commands: `l(list)`, `ll(long list)` and `source` for
listing source code.
* New commands: `display` and `undisplay` for showing or hiding
the value of an expression if it has changed.
* New command: `interact` for starting an interactive interpreter containing
the global and local names found in the current scope.
* Breakpoints can be cleared by breakpoint number.

(Contributed by Georg Brandl, Antonio Cuni and Ilya Sandler.)

### configparser[¶](#configparser "Link to this heading")

The [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") module was modified to improve usability and
predictability of the default parser and its supported INI syntax. The old
`ConfigParser` class was removed in favor of `SafeConfigParser`
which has in turn been renamed to [`ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser"). Support
for inline comments is now turned off by default and section or option
duplicates are not allowed in a single configuration source.

Config parsers gained a new API based on the mapping protocol:

\`\`\`
\>\>\> parser = ConfigParser()
\>\>\> parser.read\_string("""
... \[DEFAULT]
... location = upper left
... visible = yes
... editable = no
... color = blue
...
... \[main]
... title = Main Menu
... color = green
...
... \[options]
... title = Options
... """)
\>\>\> parser\['main']\['color']
'green'
\>\>\> parser\['main']\['editable']
'no'
\>\>\> section = parser\['options']
\>\>\> section\['title']
'Options'
\>\>\> section\['title'] = 'Options (editable: %(editable)s)'
\>\>\> section\['title']
'Options (editable: no)'

\`\`\`

The new API is implemented on top of the classical API, so custom parser
subclasses should be able to use it without modifications.

The INI file structure accepted by config parsers can now be customized. Users
can specify alternative option/value delimiters and comment prefixes, change the
name of the *DEFAULT* section or switch the interpolation syntax.

There is support for pluggable interpolation including an additional interpolation
handler [`ExtendedInterpolation`](../library/configparser.html#configparser.ExtendedInterpolation "configparser.ExtendedInterpolation"):

\`\`\`
\>\>\> parser = ConfigParser(interpolation=ExtendedInterpolation())
\>\>\> parser.read\_dict({'buildout': {'directory': '/home/ambv/zope9'},
... 'custom': {'prefix': '/usr/local'}})
\>\>\> parser.read\_string("""
... \[buildout]
... parts =
... zope9
... instance
... find\-links =
... ${buildout:directory}/downloads/dist
...
... \[zope9]
... recipe = plone.recipe.zope9install
... location = /opt/zope
...
... \[instance]
... recipe = plone.recipe.zope9instance
... zope9\-location = ${zope9:location}
... zope\-conf = ${custom:prefix}/etc/zope.conf
... """)
\>\>\> parser\['buildout']\['find\-links']
'\\n/home/ambv/zope9/downloads/dist'
\>\>\> parser\['instance']\['zope\-conf']
'/usr/local/etc/zope.conf'
\>\>\> instance = parser\['instance']
\>\>\> instance\['zope\-conf']
'/usr/local/etc/zope.conf'
\>\>\> instance\['zope9\-location']
'/opt/zope'

\`\`\`

A number of smaller features were also introduced, like support for specifying
encoding in read operations, specifying fallback values for get\-functions, or
reading directly from dictionaries and strings.

(All changes contributed by Łukasz Langa.)

### urllib.parse[¶](#urllib-parse "Link to this heading")

A number of usability improvements were made for the [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") module.

The [`urlparse()`](../library/urllib.parse.html#urllib.parse.urlparse "urllib.parse.urlparse") function now supports [IPv6](https://en.wikipedia.org/wiki/IPv6) addresses as described in [**RFC 2732**](https://datatracker.ietf.org/doc/html/rfc2732.html):

\`\`\`
\>\>\> import urllib.parse
\>\>\> urllib.parse.urlparse('http://\[dead:beef:cafe:5417:affe:8FA3:deaf:feed]/foo/') 
ParseResult(scheme='http',
 netloc='\[dead:beef:cafe:5417:affe:8FA3:deaf:feed]',
 path='/foo/',
 params='',
 query='',
 fragment='')

\`\`\`

The [`urldefrag()`](../library/urllib.parse.html#urllib.parse.urldefrag "urllib.parse.urldefrag") function now returns a [named tuple](../glossary.html#term-named-tuple):

\`\`\`
\>\>\> r = urllib.parse.urldefrag('http://python.org/about/\#target')
\>\>\> r
DefragResult(url='http://python.org/about/', fragment='target')
\>\>\> r\[0]
'http://python.org/about/'
\>\>\> r.fragment
'target'

\`\`\`

And, the [`urlencode()`](../library/urllib.parse.html#urllib.parse.urlencode "urllib.parse.urlencode") function is now much more flexible,
accepting either a string or bytes type for the *query* argument. If it is a
string, then the *safe*, *encoding*, and *error* parameters are sent to
[`quote_plus()`](../library/urllib.parse.html#urllib.parse.quote_plus "urllib.parse.quote_plus") for encoding:

\`\`\`
\>\>\> urllib.parse.urlencode(\[
... ('type', 'telenovela'),
... ('name', '¿Dónde Está Elisa?')],
... encoding='latin\-1')
'type=telenovela\&name=%BFD%F3nde\+Est%E1\+Elisa%3F'

\`\`\`

As detailed in [Parsing ASCII Encoded Bytes](../library/urllib.parse.html#parsing-ascii-encoded-bytes), all the [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.")
functions now accept ASCII\-encoded byte strings as input, so long as they are
not mixed with regular strings. If ASCII\-encoded byte strings are given as
parameters, the return types will also be an ASCII\-encoded byte strings:

\`\`\`
\>\>\> urllib.parse.urlparse(b'http://www.python.org:80/about/') 
ParseResultBytes(scheme=b'http', netloc=b'www.python.org:80',
 path=b'/about/', params=b'', query=b'', fragment=b'')

\`\`\`

(Work by Nick Coghlan, Dan Mahn, and Senthil Kumaran in [bpo\-2987](https://bugs.python.org/issue?@action=redirect&bpo=2987),
[bpo\-5468](https://bugs.python.org/issue?@action=redirect&bpo=5468), and [bpo\-9873](https://bugs.python.org/issue?@action=redirect&bpo=9873).)

### mailbox[¶](#mailbox "Link to this heading")

Thanks to a concerted effort by R. David Murray, the [`mailbox`](../library/mailbox.html#module-mailbox "mailbox: Manipulate mailboxes in various formats") module has
been fixed for Python 3\.2\. The challenge was that mailbox had been originally
designed with a text interface, but email messages are best represented with
[`bytes`](../library/stdtypes.html#bytes "bytes") because various parts of a message may have different encodings.

The solution harnessed the [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") package’s binary support for parsing
arbitrary email messages. In addition, the solution required a number of API
changes.

As expected, the [`add()`](../library/mailbox.html#mailbox.Mailbox.add "mailbox.Mailbox.add") method for
[`mailbox.Mailbox`](../library/mailbox.html#mailbox.Mailbox "mailbox.Mailbox") objects now accepts binary input.

[`StringIO`](../library/io.html#io.StringIO "io.StringIO") and text file input are deprecated. Also, string input
will fail early if non\-ASCII characters are used. Previously it would fail when
the email was processed in a later step.

There is also support for binary output. The [`get_file()`](../library/mailbox.html#mailbox.Mailbox.get_file "mailbox.Mailbox.get_file")
method now returns a file in the binary mode (where it used to incorrectly set
the file to text\-mode). There is also a new [`get_bytes()`](../library/mailbox.html#mailbox.Mailbox.get_bytes "mailbox.Mailbox.get_bytes")
method that returns a [`bytes`](../library/stdtypes.html#bytes "bytes") representation of a message corresponding
to a given *key*.

It is still possible to get non\-binary output using the old API’s
[`get_string()`](../library/mailbox.html#mailbox.Mailbox.get_string "mailbox.Mailbox.get_string") method, but that approach
is not very useful. Instead, it is best to extract messages from
a [`Message`](../library/mailbox.html#mailbox.Message "mailbox.Message") object or to load them from binary input.

(Contributed by R. David Murray, with efforts from Steffen Daode Nurpmeso and an
initial patch by Victor Stinner in [bpo\-9124](https://bugs.python.org/issue?@action=redirect&bpo=9124).)

### turtledemo[¶](#turtledemo "Link to this heading")

The demonstration code for the [`turtle`](../library/turtle.html#module-turtle "turtle: An educational framework for simple graphics applications") module was moved from the *Demo*
directory to main library. It includes over a dozen sample scripts with
lively displays. Being on [`sys.path`](../library/sys.html#sys.path "sys.path"), it can now be run directly
from the command\-line:

\`\`\`
$ python \-m turtledemo

\`\`\`

(Moved from the Demo directory by Alexander Belopolsky in [bpo\-10199](https://bugs.python.org/issue?@action=redirect&bpo=10199).)

## Multi\-threading[¶](#multi-threading "Link to this heading")

* The mechanism for serializing execution of concurrently running Python threads
(generally known as the [GIL](../glossary.html#term-GIL) or Global Interpreter Lock) has
been rewritten. Among the objectives were more predictable switching
intervals and reduced overhead due to lock contention and the number of
ensuing system calls. The notion of a “check interval” to allow thread
switches has been abandoned and replaced by an absolute duration expressed in
seconds. This parameter is tunable through [`sys.setswitchinterval()`](../library/sys.html#sys.setswitchinterval "sys.setswitchinterval").
It currently defaults to 5 milliseconds.

Additional details about the implementation can be read from a [python\-dev
mailing\-list message](https://mail.python.org/pipermail/python-dev/2009-October/093321.html)
(however, “priority requests” as exposed in this message have not been kept
for inclusion).

(Contributed by Antoine Pitrou.)
* Regular and recursive locks now accept an optional *timeout* argument to their
[`acquire()`](../library/threading.html#threading.Lock.acquire "threading.Lock.acquire") method. (Contributed by Antoine Pitrou;
[bpo\-7316](https://bugs.python.org/issue?@action=redirect&bpo=7316).)
* Similarly, [`threading.Semaphore.acquire()`](../library/threading.html#threading.Semaphore.acquire "threading.Semaphore.acquire") also gained a *timeout*
argument. (Contributed by Torsten Landschoff; [bpo\-850728](https://bugs.python.org/issue?@action=redirect&bpo=850728).)
* Regular and recursive lock acquisitions can now be interrupted by signals on
platforms using Pthreads. This means that Python programs that deadlock while
acquiring locks can be successfully killed by repeatedly sending SIGINT to the
process (by pressing `Ctrl+C` in most shells).
(Contributed by Reid Kleckner; [bpo\-8844](https://bugs.python.org/issue?@action=redirect&bpo=8844).)

## Optimizations[¶](#optimizations "Link to this heading")

A number of small performance enhancements have been added:

* Python’s peephole optimizer now recognizes patterns such `x in {1, 2, 3}` as
being a test for membership in a set of constants. The optimizer recasts the
[`set`](../library/stdtypes.html#set "set") as a [`frozenset`](../library/stdtypes.html#frozenset "frozenset") and stores the pre\-built constant.

Now that the speed penalty is gone, it is practical to start writing
membership tests using set\-notation. This style is both semantically clear
and operationally fast:

\`\`\`
extension = name.rpartition('.')\[2]
if extension in {'xml', 'html', 'xhtml', 'css'}:
 handle(name)

\`\`\`

(Patch and additional tests contributed by Dave Malcolm; [bpo\-6690](https://bugs.python.org/issue?@action=redirect&bpo=6690)).
* Serializing and unserializing data using the [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") module is now
several times faster.

(Contributed by Alexandre Vassalotti, Antoine Pitrou
and the Unladen Swallow team in [bpo\-9410](https://bugs.python.org/issue?@action=redirect&bpo=9410) and [bpo\-3873](https://bugs.python.org/issue?@action=redirect&bpo=3873).)
* The [Timsort algorithm](https://en.wikipedia.org/wiki/Timsort) used in
[`list.sort()`](../library/stdtypes.html#list.sort "list.sort") and [`sorted()`](../library/functions.html#sorted "sorted") now runs faster and uses less memory
when called with a [key function](../glossary.html#term-key-function). Previously, every element of
a list was wrapped with a temporary object that remembered the key value
associated with each element. Now, two arrays of keys and values are
sorted in parallel. This saves the memory consumed by the sort wrappers,
and it saves time lost to delegating comparisons.

(Patch by Daniel Stutzbach in [bpo\-9915](https://bugs.python.org/issue?@action=redirect&bpo=9915).)
* JSON decoding performance is improved and memory consumption is reduced
whenever the same string is repeated for multiple keys. Also, JSON encoding
now uses the C speedups when the `sort_keys` argument is true.

(Contributed by Antoine Pitrou in [bpo\-7451](https://bugs.python.org/issue?@action=redirect&bpo=7451) and by Raymond Hettinger and
Antoine Pitrou in [bpo\-10314](https://bugs.python.org/issue?@action=redirect&bpo=10314).)
* Recursive locks (created with the [`threading.RLock()`](../library/threading.html#threading.RLock "threading.RLock") API) now benefit
from a C implementation which makes them as fast as regular locks, and between
10x and 15x faster than their previous pure Python implementation.

(Contributed by Antoine Pitrou; [bpo\-3001](https://bugs.python.org/issue?@action=redirect&bpo=3001).)
* The fast\-search algorithm in stringlib is now used by the [`split()`](../library/stdtypes.html#str.split "str.split"),
[`rsplit()`](../library/stdtypes.html#str.rsplit "str.rsplit"), [`splitlines()`](../library/stdtypes.html#str.splitlines "str.splitlines") and [`replace()`](../library/stdtypes.html#str.replace "str.replace") methods on
[`bytes`](../library/stdtypes.html#bytes "bytes"), [`bytearray`](../library/stdtypes.html#bytearray "bytearray") and [`str`](../library/stdtypes.html#str "str") objects. Likewise, the
algorithm is also used by [`rfind()`](../library/stdtypes.html#str.rfind "str.rfind"), [`rindex()`](../library/stdtypes.html#str.rindex "str.rindex"), [`rsplit()`](../library/stdtypes.html#str.rsplit "str.rsplit") and
[`rpartition()`](../library/stdtypes.html#str.rpartition "str.rpartition").

(Patch by Florent Xicluna in [bpo\-7622](https://bugs.python.org/issue?@action=redirect&bpo=7622) and [bpo\-7462](https://bugs.python.org/issue?@action=redirect&bpo=7462).)
* Integer to string conversions now work two “digits” at a time, reducing the
number of division and modulo operations.

([bpo\-6713](https://bugs.python.org/issue?@action=redirect&bpo=6713) by Gawain Bolton, Mark Dickinson, and Victor Stinner.)

There were several other minor optimizations. Set differencing now runs faster
when one operand is much larger than the other (patch by Andress Bennetts in
[bpo\-8685](https://bugs.python.org/issue?@action=redirect&bpo=8685)). The `array.repeat()` method has a faster implementation
([bpo\-1569291](https://bugs.python.org/issue?@action=redirect&bpo=1569291) by Alexander Belopolsky). The [`BaseHTTPRequestHandler`](../library/http.server.html#http.server.BaseHTTPRequestHandler "http.server.BaseHTTPRequestHandler")
has more efficient buffering ([bpo\-3709](https://bugs.python.org/issue?@action=redirect&bpo=3709) by Andrew Schaaf). The
[`operator.attrgetter()`](../library/operator.html#operator.attrgetter "operator.attrgetter") function has been sped\-up ([bpo\-10160](https://bugs.python.org/issue?@action=redirect&bpo=10160) by
Christos Georgiou). And [`ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser") loads multi\-line arguments a bit
faster ([bpo\-7113](https://bugs.python.org/issue?@action=redirect&bpo=7113) by Łukasz Langa).

## Unicode[¶](#unicode "Link to this heading")

Python has been updated to [Unicode 6\.0\.0](https://unicode.org/versions/Unicode6.0.0/). The update to the standard adds
over 2,000 new characters including [emoji](https://en.wikipedia.org/wiki/Emoji)
symbols which are important for mobile phones.

In addition, the updated standard has altered the character properties for two
Kannada characters (U\+0CF1, U\+0CF2\) and one New Tai Lue numeric character
(U\+19DA), making the former eligible for use in identifiers while disqualifying
the latter. For more information, see [Unicode Character Database Changes](https://www.unicode.org/versions/Unicode6.0.0/#Database_Changes).

## Codecs[¶](#codecs "Link to this heading")

Support was added for *cp720* Arabic DOS encoding ([bpo\-1616979](https://bugs.python.org/issue?@action=redirect&bpo=1616979)).

MBCS encoding no longer ignores the error handler argument. In the default
strict mode, it raises an [`UnicodeDecodeError`](../library/exceptions.html#UnicodeDecodeError "UnicodeDecodeError") when it encounters an
undecodable byte sequence and an [`UnicodeEncodeError`](../library/exceptions.html#UnicodeEncodeError "UnicodeEncodeError") for an unencodable
character.

The MBCS codec supports `'strict'` and `'ignore'` error handlers for
decoding, and `'strict'` and `'replace'` for encoding.

To emulate Python3\.1 MBCS encoding, select the `'ignore'` handler for decoding
and the `'replace'` handler for encoding.

On Mac OS X, Python decodes command line arguments with `'utf-8'` rather than
the locale encoding.

By default, [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") uses `'utf-8'` encoding on Windows (instead of
`'mbcs'`) and the `'surrogateescape'` error handler on all operating
systems.

## Documentation[¶](#documentation "Link to this heading")

The documentation continues to be improved.

* A table of quick links has been added to the top of lengthy sections such as
[Built\-in Functions](../library/functions.html#built-in-funcs). In the case of [`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping."), the links are
accompanied by tables of cheatsheet\-style summaries to provide an overview and
memory jog without having to read all of the docs.
* In some cases, the pure Python source code can be a helpful adjunct to the
documentation, so now many modules now feature quick links to the latest
version of the source code. For example, the [`functools`](../library/functools.html#module-functools "functools: Higher-order functions and operations on callable objects.") module
documentation has a quick link at the top labeled:

> **Source code** [Lib/functools.py](https://github.com/python/cpython/tree/3.13/Lib/functools.py).

(Contributed by Raymond Hettinger; see
[rationale](https://rhettinger.wordpress.com/2011/01/28/open-your-source-more/).)
* The docs now contain more examples and recipes. In particular, [`re`](../library/re.html#module-re "re: Regular expression operations.")
module has an extensive section, [Regular Expression Examples](../library/re.html#re-examples). Likewise, the
[`itertools`](../library/itertools.html#module-itertools "itertools: Functions creating iterators for efficient looping.") module continues to be updated with new
[Itertools Recipes](../library/itertools.html#itertools-recipes).
* The [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types.") module now has an auxiliary implementation in pure Python.
No functionality was changed. This just provides an easier\-to\-read alternate
implementation.

(Contributed by Alexander Belopolsky in [bpo\-9528](https://bugs.python.org/issue?@action=redirect&bpo=9528).)
* The unmaintained `Demo` directory has been removed. Some demos were
integrated into the documentation, some were moved to the `Tools/demo`
directory, and others were removed altogether.

(Contributed by Georg Brandl in [bpo\-7962](https://bugs.python.org/issue?@action=redirect&bpo=7962).)

## IDLE[¶](#idle "Link to this heading")

* The format menu now has an option to clean source files by stripping
trailing whitespace.

(Contributed by Raymond Hettinger; [bpo\-5150](https://bugs.python.org/issue?@action=redirect&bpo=5150).)
* IDLE on Mac OS X now works with both Carbon AquaTk and Cocoa AquaTk.

(Contributed by Kevin Walzer, Ned Deily, and Ronald Oussoren; [bpo\-6075](https://bugs.python.org/issue?@action=redirect&bpo=6075).)

## Code Repository[¶](#code-repository "Link to this heading")

In addition to the existing Subversion code repository at 
there is now a [Mercurial](https://www.mercurial-scm.org/) repository at
.

After the 3\.2 release, there are plans to switch to Mercurial as the primary
repository. This distributed version control system should make it easier for
members of the community to create and share external changesets. See
[**PEP 385**](https://peps.python.org/pep-0385/) for details.

To learn to use the new version control system, see the [Quick Start](https://www.mercurial-scm.org/wiki/QuickStart) or the [Guide to
Mercurial Workflows](https://www.mercurial-scm.org/guide).

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

Changes to Python’s build process and to the C API include:

* The *idle*, *pydoc* and *2to3* scripts are now installed with a
version\-specific suffix on `make altinstall` ([bpo\-10679](https://bugs.python.org/issue?@action=redirect&bpo=10679)).
* The C functions that access the Unicode Database now accept and return
characters from the full Unicode range, even on narrow unicode builds
(Py\_UNICODE\_TOLOWER, Py\_UNICODE\_ISDECIMAL, and others). A visible difference
in Python is that [`unicodedata.numeric()`](../library/unicodedata.html#unicodedata.numeric "unicodedata.numeric") now returns the correct value
for large code points, and [`repr()`](../library/functions.html#repr "repr") may consider more characters as
printable.

(Reported by Bupjoe Lee and fixed by Amaury Forgeot D’Arc; [bpo\-5127](https://bugs.python.org/issue?@action=redirect&bpo=5127).)
* Computed gotos are now enabled by default on supported compilers (which are
detected by the configure script). They can still be disabled selectively by
specifying `--without-computed-gotos`.

(Contributed by Antoine Pitrou; [bpo\-9203](https://bugs.python.org/issue?@action=redirect&bpo=9203).)
* The option `--with-wctype-functions` was removed. The built\-in unicode
database is now used for all functions.

(Contributed by Amaury Forgeot D’Arc; [bpo\-9210](https://bugs.python.org/issue?@action=redirect&bpo=9210).)
* Hash values are now values of a new type, [`Py_hash_t`](../c-api/hash.html#c.Py_hash_t "Py_hash_t"), which is
defined to be the same size as a pointer. Previously they were of type long,
which on some 64\-bit operating systems is still only 32 bits long. As a
result of this fix, [`set`](../library/stdtypes.html#set "set") and [`dict`](../library/stdtypes.html#dict "dict") can now hold more than
`2**32` entries on builds with 64\-bit pointers (previously, they could grow
to that size but their performance degraded catastrophically).

(Suggested by Raymond Hettinger and implemented by Benjamin Peterson;
[bpo\-9778](https://bugs.python.org/issue?@action=redirect&bpo=9778).)
* A new macro `Py_VA_COPY` copies the state of the variable argument
list. It is equivalent to C99 *va\_copy* but available on all Python platforms
([bpo\-2443](https://bugs.python.org/issue?@action=redirect&bpo=2443)).
* A new C API function `PySys_SetArgvEx()` allows an embedded interpreter
to set [`sys.argv`](../library/sys.html#sys.argv "sys.argv") without also modifying [`sys.path`](../library/sys.html#sys.path "sys.path")
([bpo\-5753](https://bugs.python.org/issue?@action=redirect&bpo=5753)).
* `PyEval_CallObject()` is now only available in macro form. The
function declaration, which was kept for backwards compatibility reasons, is
now removed – the macro was introduced in 1997 ([bpo\-8276](https://bugs.python.org/issue?@action=redirect&bpo=8276)).
* There is a new function [`PyLong_AsLongLongAndOverflow()`](../c-api/long.html#c.PyLong_AsLongLongAndOverflow "PyLong_AsLongLongAndOverflow") which
is analogous to [`PyLong_AsLongAndOverflow()`](../c-api/long.html#c.PyLong_AsLongAndOverflow "PyLong_AsLongAndOverflow"). They both serve to
convert Python [`int`](../library/functions.html#int "int") into a native fixed\-width type while providing
detection of cases where the conversion won’t fit ([bpo\-7767](https://bugs.python.org/issue?@action=redirect&bpo=7767)).
* The [`PyUnicode_CompareWithASCIIString()`](../c-api/unicode.html#c.PyUnicode_CompareWithASCIIString "PyUnicode_CompareWithASCIIString") function now returns *not
equal* if the Python string is *NUL* terminated.
* There is a new function [`PyErr_NewExceptionWithDoc()`](../c-api/exceptions.html#c.PyErr_NewExceptionWithDoc "PyErr_NewExceptionWithDoc") that is
like [`PyErr_NewException()`](../c-api/exceptions.html#c.PyErr_NewException "PyErr_NewException") but allows a docstring to be specified.
This lets C exceptions have the same self\-documenting capabilities as
their pure Python counterparts ([bpo\-7033](https://bugs.python.org/issue?@action=redirect&bpo=7033)).
* When compiled with the `--with-valgrind` option, the pymalloc
allocator will be automatically disabled when running under Valgrind. This
gives improved memory leak detection when running under Valgrind, while taking
advantage of pymalloc at other times ([bpo\-2422](https://bugs.python.org/issue?@action=redirect&bpo=2422)).
* Removed the `O?` format from the *PyArg\_Parse* functions. The format is no
longer used and it had never been documented ([bpo\-8837](https://bugs.python.org/issue?@action=redirect&bpo=8837)).

There were a number of other small changes to the C\-API. See the
[Misc/NEWS](https://github.com/python/cpython/blob/v3.2.6/Misc/NEWS)
file for a complete list.

Also, there were a number of updates to the Mac OS X build, see
[Mac/BuildScript/README.txt](https://github.com/python/cpython/blob/v3.2.6/Mac/BuildScript/README.txt)
for details. For users running a 32/64\-bit
build, there is a known problem with the default Tcl/Tk on Mac OS X 10\.6\.
Accordingly, we recommend installing an updated alternative such as
[ActiveState Tcl/Tk 8\.5\.9](https://web.archive.org/web/20101208191259/https://www.activestate.com/activetcl/downloads).
See  for additional details.

## Porting to Python 3\.2[¶](#porting-to-python-3-2 "Link to this heading")

This section lists previously described changes and other bugfixes that may
require changes to your code:

* The [`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") module has a number of clean\-ups. The major change is
to replace the old `ConfigParser` class with long\-standing preferred
alternative `SafeConfigParser`. In addition there are a number of
smaller incompatibilities:

	+ The interpolation syntax is now validated on
	[`get()`](../library/configparser.html#configparser.ConfigParser.get "configparser.ConfigParser.get") and
	[`set()`](../library/configparser.html#configparser.ConfigParser.set "configparser.ConfigParser.set") operations. In the default
	interpolation scheme, only two tokens with percent signs are valid: `%(name)s`
	and `%%`, the latter being an escaped percent sign.
	+ The [`set()`](../library/configparser.html#configparser.ConfigParser.set "configparser.ConfigParser.set") and
	[`add_section()`](../library/configparser.html#configparser.ConfigParser.add_section "configparser.ConfigParser.add_section") methods now verify that
	values are actual strings. Formerly, unsupported types could be introduced
	unintentionally.
	+ Duplicate sections or options from a single source now raise either
	[`DuplicateSectionError`](../library/configparser.html#configparser.DuplicateSectionError "configparser.DuplicateSectionError") or
	[`DuplicateOptionError`](../library/configparser.html#configparser.DuplicateOptionError "configparser.DuplicateOptionError"). Formerly, duplicates would
	silently overwrite a previous entry.
	+ Inline comments are now disabled by default so now the **;** character
	can be safely used in values.
	+ Comments now can be indented. Consequently, for **;** or **\#** to appear at
	the start of a line in multiline values, it has to be interpolated. This
	keeps comment prefix characters in values from being mistaken as comments.
	+ `""` is now a valid value and is no longer automatically converted to an
	empty string. For empty strings, use `"option ="` in a line.
* The `nntplib` module was reworked extensively, meaning that its APIs
are often incompatible with the 3\.1 APIs.
* [`bytearray`](../library/stdtypes.html#bytearray "bytearray") objects can no longer be used as filenames; instead,
they should be converted to [`bytes`](../library/stdtypes.html#bytes "bytes").
* The `array.tostring()` and `array.fromstring()` have been renamed to
[`array.tobytes()`](../library/array.html#array.array.tobytes "array.array.tobytes") and
[`array.frombytes()`](../library/array.html#array.array.frombytes "array.array.frombytes") for clarity. The old names
have been deprecated. (See [bpo\-8990](https://bugs.python.org/issue?@action=redirect&bpo=8990).)
* `PyArg_Parse*()` functions:

	+ “t\#” format has been removed: use “s\#” or “s\*” instead
	+ “w” and “w\#” formats has been removed: use “w\*” instead
* The `PyCObject` type, deprecated in 3\.1, has been removed. To wrap
opaque C pointers in Python objects, the [`PyCapsule`](../c-api/capsule.html#c.PyCapsule "PyCapsule") API should be used
instead; the new type has a well\-defined interface for passing typing safety
information and a less complicated signature for calling a destructor.
* The `sys.setfilesystemencoding()` function was removed because
it had a flawed design.
* The [`random.seed()`](../library/random.html#random.seed "random.seed") function and method now salt string seeds with an
sha512 hash function. To access the previous version of *seed* in order to
reproduce Python 3\.1 sequences, set the *version* argument to *1*,
`random.seed(s, version=1)`.
* The previously deprecated `string.maketrans()` function has been removed
in favor of the static methods [`bytes.maketrans()`](../library/stdtypes.html#bytes.maketrans "bytes.maketrans") and
[`bytearray.maketrans()`](../library/stdtypes.html#bytearray.maketrans "bytearray.maketrans"). This change solves the confusion around which
types were supported by the [`string`](../library/string.html#module-string "string: Common string operations.") module. Now, [`str`](../library/stdtypes.html#str "str"),
[`bytes`](../library/stdtypes.html#bytes "bytes"), and [`bytearray`](../library/stdtypes.html#bytearray "bytearray") each have their own **maketrans** and
**translate** methods with intermediate translation tables of the appropriate
type.

(Contributed by Georg Brandl; [bpo\-5675](https://bugs.python.org/issue?@action=redirect&bpo=5675).)
* The previously deprecated `contextlib.nested()` function has been removed
in favor of a plain [`with`](../reference/compound_stmts.html#with) statement which can accept multiple
context managers. The latter technique is faster (because it is built\-in),
and it does a better job finalizing multiple context managers when one of them
raises an exception:

\`\`\`
with open('mylog.txt') as infile, open('a.out', 'w') as outfile:
 for line in infile:
 if '\' in line:
 outfile.write(line)

\`\`\`

(Contributed by Georg Brandl and Mattias Brändström;
[appspot issue 53094](https://codereview.appspot.com/53094).)
* [`struct.pack()`](../library/struct.html#struct.pack "struct.pack") now only allows bytes for the `s` string pack code.
Formerly, it would accept text arguments and implicitly encode them to bytes
using UTF\-8\. This was problematic because it made assumptions about the
correct encoding and because a variable\-length encoding can fail when writing
to fixed length segment of a structure.

Code such as `struct.pack('<6sHHBBB', 'GIF87a', x, y)` should be rewritten
with to use bytes instead of text, `struct.pack('<6sHHBBB', b'GIF87a', x, y)`.

(Discovered by David Beazley and fixed by Victor Stinner; [bpo\-10783](https://bugs.python.org/issue?@action=redirect&bpo=10783).)
* The [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") class now raises an
[`xml.etree.ElementTree.ParseError`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.ParseError "xml.etree.ElementTree.ParseError") when a parse fails. Previously it
raised an [`xml.parsers.expat.ExpatError`](../library/pyexpat.html#xml.parsers.expat.ExpatError "xml.parsers.expat.ExpatError").
* The new, longer [`str()`](../library/stdtypes.html#str "str") value on floats may break doctests which rely on
the old output format.
* In [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen"), the default value for *close\_fds* is now
`True` under Unix; under Windows, it is `True` if the three standard
streams are set to `None`, `False` otherwise. Previously, *close\_fds*
was always `False` by default, which produced difficult to solve bugs
or race conditions when open file descriptors would leak into the child
process.
* Support for legacy HTTP 0\.9 has been removed from [`urllib.request`](../library/urllib.request.html#module-urllib.request "urllib.request: Extensible library for opening URLs.")
and [`http.client`](../library/http.client.html#module-http.client "http.client: HTTP and HTTPS protocol client (requires sockets)."). Such support is still present on the server side
(in [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers.")).

(Contributed by Antoine Pitrou, [bpo\-10711](https://bugs.python.org/issue?@action=redirect&bpo=10711).)
* SSL sockets in timeout mode now raise [`socket.timeout`](../library/socket.html#socket.timeout "socket.timeout") when a timeout
occurs, rather than a generic [`SSLError`](../library/ssl.html#ssl.SSLError "ssl.SSLError").

(Contributed by Antoine Pitrou, [bpo\-10272](https://bugs.python.org/issue?@action=redirect&bpo=10272).)
* The misleading functions `PyEval_AcquireLock()` and
`PyEval_ReleaseLock()` have been officially deprecated. The
thread\-state aware APIs (such as [`PyEval_SaveThread()`](../c-api/init.html#c.PyEval_SaveThread "PyEval_SaveThread")
and [`PyEval_RestoreThread()`](../c-api/init.html#c.PyEval_RestoreThread "PyEval_RestoreThread")) should be used instead.
* Due to security risks, `asyncore.handle_accept()` has been deprecated, and
a new function, `asyncore.handle_accepted()`, was added to replace it.

(Contributed by Giampaolo Rodola in [bpo\-6706](https://bugs.python.org/issue?@action=redirect&bpo=6706).)
* Due to the new [GIL](../glossary.html#term-GIL) implementation, `PyEval_InitThreads()`
cannot be called before [`Py_Initialize()`](../c-api/init.html#c.Py_Initialize "Py_Initialize") anymore.

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.2](#)
	+ [PEP 384: Defining a Stable ABI](#pep-384-defining-a-stable-abi)
	+ [PEP 389: Argparse Command Line Parsing Module](#pep-389-argparse-command-line-parsing-module)
	+ [PEP 391: Dictionary Based Configuration for Logging](#pep-391-dictionary-based-configuration-for-logging)
	+ [PEP 3148: The `concurrent.futures` module](#pep-3148-the-concurrent-futures-module)
	+ [PEP 3147: PYC Repository Directories](#pep-3147-pyc-repository-directories)
	+ [PEP 3149: ABI Version Tagged .so Files](#pep-3149-abi-version-tagged-so-files)
	+ [PEP 3333: Python Web Server Gateway Interface v1\.0\.1](#pep-3333-python-web-server-gateway-interface-v1-0-1)
	+ [Other Language Changes](#other-language-changes)
	+ [New, Improved, and Deprecated Modules](#new-improved-and-deprecated-modules)
		- [email](#email)
		- [elementtree](#elementtree)
		- [functools](#functools)
		- [itertools](#itertools)
		- [collections](#collections)
		- [threading](#threading)
		- [datetime and time](#datetime-and-time)
		- [math](#math)
		- [abc](#abc)
		- [io](#io)
		- [reprlib](#reprlib)
		- [logging](#logging)
		- [csv](#csv)
		- [contextlib](#contextlib)
		- [decimal and fractions](#decimal-and-fractions)
		- [ftp](#ftp)
		- [popen](#popen)
		- [select](#select)
		- [gzip and zipfile](#gzip-and-zipfile)
		- [tarfile](#tarfile)
		- [hashlib](#hashlib)
		- [ast](#ast)
		- [os](#os)
		- [shutil](#shutil)
		- [sqlite3](#sqlite3)
		- [html](#html)
		- [socket](#socket)
		- [ssl](#ssl)
		- [nntp](#nntp)
		- [certificates](#certificates)
		- [imaplib](#imaplib)
		- [http.client](#http-client)
		- [unittest](#unittest)
		- [random](#random)
		- [poplib](#poplib)
		- [asyncore](#asyncore)
		- [tempfile](#tempfile)
		- [inspect](#inspect)
		- [pydoc](#pydoc)
		- [dis](#dis)
		- [dbm](#dbm)
		- [ctypes](#ctypes)
		- [site](#site)
		- [sysconfig](#sysconfig)
		- [pdb](#pdb)
		- [configparser](#configparser)
		- [urllib.parse](#urllib-parse)
		- [mailbox](#mailbox)
		- [turtledemo](#turtledemo)
	+ [Multi\-threading](#multi-threading)
	+ [Optimizations](#optimizations)
	+ [Unicode](#unicode)
	+ [Codecs](#codecs)
	+ [Documentation](#documentation)
	+ [IDLE](#idle)
	+ [Code Repository](#code-repository)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Porting to Python 3\.2](#porting-to-python-3-2)

#### Previous topic

[What’s New In Python 3\.3](3.3.html "previous chapter")

#### Next topic

[What’s New In Python 3\.1](3.1.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.2.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.1.html "What’s New In Python 3.1") \|
* [previous](3.3.html "What’s New In Python 3.3") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.2
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.3 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.3.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.2.html "What’s New In Python 3.2") \|
* [previous](3.4.html "What’s New In Python 3.4") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.3
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.3[¶](#what-s-new-in-python-3-3 "Link to this heading")

This article explains the new features in Python 3\.3, compared to 3\.2\.
Python 3\.3 was released on September 29, 2012\. For full details,
see the [changelog](https://docs.python.org/3.3/whatsnew/changelog.html).

See also

[**PEP 398**](https://peps.python.org/pep-0398/) \- Python 3\.3 Release Schedule

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* New `yield from` expression for [generator delegation](#pep-380).
* The `u'unicode'` syntax is accepted again for [`str`](../library/stdtypes.html#str "str") objects.

New library modules:

* [`faulthandler`](../library/faulthandler.html#module-faulthandler "faulthandler: Dump the Python traceback.") (helps debugging low\-level crashes)
* [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") (high\-level objects representing IP addresses and masks)
* [`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library.") (compress data using the XZ / LZMA algorithm)
* [`unittest.mock`](../library/unittest.mock.html#module-unittest.mock "unittest.mock: Mock object library.") (replace parts of your system under test with mock objects)
* [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") (Python [virtual environments](#pep-405), as in the
popular `virtualenv` package)

New built\-in features:

* Reworked [I/O exception hierarchy](#pep-3151).

Implementation improvements:

* Rewritten [import machinery](#importlib) based on [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.").
* More compact [unicode strings](#pep-393).
* More compact [attribute dictionaries](#pep-412).

Significantly Improved Library Modules:

* C Accelerator for the [decimal](#new-decimal) module.
* Better unicode handling in the [email](#new-email) module
([provisional](../glossary.html#term-provisional-package)).

Security improvements:

* Hash randomization is switched on by default.

Please read on for a comprehensive list of user\-facing changes.

## PEP 405: Virtual Environments[¶](#pep-405-virtual-environments "Link to this heading")

Virtual environments help create separate Python setups while sharing a
system\-wide base install, for ease of maintenance. Virtual environments
have their own set of private site packages (i.e. locally installed
libraries), and are optionally segregated from the system\-wide site
packages. Their concept and implementation are inspired by the popular
`virtualenv` third\-party package, but benefit from tighter integration
with the interpreter core.

This PEP adds the [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") module for programmatic access, and the
`pyvenv` script for command\-line access and
administration. The Python interpreter checks for a `pyvenv.cfg`,
file whose existence signals the base of a virtual environment’s directory
tree.

See also

[**PEP 405**](https://peps.python.org/pep-0405/) \- Python Virtual EnvironmentsPEP written by Carl Meyer; implementation by Carl Meyer and Vinay Sajip

## PEP 420: Implicit Namespace Packages[¶](#pep-420-implicit-namespace-packages "Link to this heading")

Native support for package directories that don’t require `__init__.py`
marker files and can automatically span multiple path segments (inspired by
various third party approaches to namespace packages, as described in
[**PEP 420**](https://peps.python.org/pep-0420/))

See also

[**PEP 420**](https://peps.python.org/pep-0420/) \- Implicit Namespace PackagesPEP written by Eric V. Smith; implementation by Eric V. Smith
and Barry Warsaw

## PEP 3118: New memoryview implementation and buffer protocol documentation[¶](#pep-3118-new-memoryview-implementation-and-buffer-protocol-documentation "Link to this heading")

The implementation of [**PEP 3118**](https://peps.python.org/pep-3118/) has been significantly improved.

The new memoryview implementation comprehensively fixes all ownership and
lifetime issues of dynamically allocated fields in the Py\_buffer struct
that led to multiple crash reports. Additionally, several functions that
crashed or returned incorrect results for non\-contiguous or multi\-dimensional
input have been fixed.

The memoryview object now has a PEP\-3118 compliant getbufferproc()
that checks the consumer’s request type. Many new features have been
added, most of them work in full generality for non\-contiguous arrays
and arrays with suboffsets.

The documentation has been updated, clearly spelling out responsibilities
for both exporters and consumers. Buffer request flags are grouped into
basic and compound flags. The memory layout of non\-contiguous and
multi\-dimensional NumPy\-style arrays is explained.

### Features[¶](#features "Link to this heading")

* All native single character format specifiers in struct module syntax
(optionally prefixed with ‘@’) are now supported.
* With some restrictions, the cast() method allows changing of format and
shape of C\-contiguous arrays.
* Multi\-dimensional list representations are supported for any array type.
* Multi\-dimensional comparisons are supported for any array type.
* One\-dimensional memoryviews of hashable (read\-only) types with formats B,
b or c are now hashable. (Contributed by Antoine Pitrou in [bpo\-13411](https://bugs.python.org/issue?@action=redirect&bpo=13411).)
* Arbitrary slicing of any 1\-D arrays type is supported. For example, it
is now possible to reverse a memoryview in *O*(1\) by using a negative step.

### API changes[¶](#api-changes "Link to this heading")

* The maximum number of dimensions is officially limited to 64\.
* The representation of empty shape, strides and suboffsets is now
an empty tuple instead of `None`.
* Accessing a memoryview element with format ‘B’ (unsigned bytes)
now returns an integer (in accordance with the struct module syntax).
For returning a bytes object the view must be cast to ‘c’ first.
* memoryview comparisons now use the logical structure of the operands
and compare all array elements by value. All format strings in struct
module syntax are supported. Views with unrecognised format strings
are still permitted, but will always compare as unequal, regardless
of view contents.
* For further changes see [Build and C API Changes](#build-and-c-api-changes) and [Porting C code](#porting-c-code).

(Contributed by Stefan Krah in [bpo\-10181](https://bugs.python.org/issue?@action=redirect&bpo=10181).)

See also

[**PEP 3118**](https://peps.python.org/pep-3118/) \- Revising the Buffer Protocol

## PEP 393: Flexible String Representation[¶](#pep-393-flexible-string-representation "Link to this heading")

The Unicode string type is changed to support multiple internal
representations, depending on the character with the largest Unicode ordinal
(1, 2, or 4 bytes) in the represented string. This allows a space\-efficient
representation in common cases, but gives access to full UCS\-4 on all
systems. For compatibility with existing APIs, several representations may
exist in parallel; over time, this compatibility should be phased out.

On the Python side, there should be no downside to this change.

On the C API side, [**PEP 393**](https://peps.python.org/pep-0393/) is fully backward compatible. The legacy API
should remain available at least five years. Applications using the legacy
API will not fully benefit of the memory reduction, or \- worse \- may use
a bit more memory, because Python may have to maintain two versions of each
string (in the legacy format and in the new efficient storage).

### Functionality[¶](#functionality "Link to this heading")

Changes introduced by [**PEP 393**](https://peps.python.org/pep-0393/) are the following:

* Python now always supports the full range of Unicode code points, including
non\-BMP ones (i.e. from `U+0000` to `U+10FFFF`). The distinction between
narrow and wide builds no longer exists and Python now behaves like a wide
build, even under Windows.
* With the death of narrow builds, the problems specific to narrow builds have
also been fixed, for example:

	+ [`len()`](../library/functions.html#len "len") now always returns 1 for non\-BMP characters,
	so `len('\U0010FFFF') == 1`;
	+ surrogate pairs are not recombined in string literals,
	so `'\uDBFF\uDFFF' != '\U0010FFFF'`;
	+ indexing or slicing non\-BMP characters returns the expected value,
	so `'\U0010FFFF'[0]` now returns `'\U0010FFFF'` and not `'\uDBFF'`;
	+ all other functions in the standard library now correctly handle
	non\-BMP code points.
* The value of [`sys.maxunicode`](../library/sys.html#sys.maxunicode "sys.maxunicode") is now always `1114111` (`0x10FFFF`
in hexadecimal). The `PyUnicode_GetMax()` function still returns
either `0xFFFF` or `0x10FFFF` for backward compatibility, and it should
not be used with the new Unicode API (see [bpo\-13054](https://bugs.python.org/issue?@action=redirect&bpo=13054)).
* The `./configure` flag `--with-wide-unicode` has been removed.

### Performance and resource usage[¶](#performance-and-resource-usage "Link to this heading")

The storage of Unicode strings now depends on the highest code point in the string:

* pure ASCII and Latin1 strings (`U+0000-U+00FF`) use 1 byte per code point;
* BMP strings (`U+0000-U+FFFF`) use 2 bytes per code point;
* non\-BMP strings (`U+10000-U+10FFFF`) use 4 bytes per code point.

The net effect is that for most applications, memory usage of string
storage should decrease significantly \- especially compared to former
wide unicode builds \- as, in many cases, strings will be pure ASCII
even in international contexts (because many strings store non\-human
language data, such as XML fragments, HTTP headers, JSON\-encoded data,
etc.). We also hope that it will, for the same reasons, increase CPU
cache efficiency on non\-trivial applications. The memory usage of
Python 3\.3 is two to three times smaller than Python 3\.2, and a little
bit better than Python 2\.7, on a Django benchmark (see the PEP for
details).

See also

[**PEP 393**](https://peps.python.org/pep-0393/) \- Flexible String RepresentationPEP written by Martin von Löwis; implementation by Torsten Becker
and Martin von Löwis.

## PEP 397: Python Launcher for Windows[¶](#pep-397-python-launcher-for-windows "Link to this heading")

The Python 3\.3 Windows installer now includes a `py` launcher application
that can be used to launch Python applications in a version independent
fashion.

This launcher is invoked implicitly when double\-clicking `*.py` files.
If only a single Python version is installed on the system, that version
will be used to run the file. If multiple versions are installed, the most
recent version is used by default, but this can be overridden by including
a Unix\-style “shebang line” in the Python script.

The launcher can also be used explicitly from the command line as the `py`
application. Running `py` follows the same version selection rules as
implicitly launching scripts, but a more specific version can be selected
by passing appropriate arguments (such as `-3` to request Python 3 when
Python 2 is also installed, or `-2.6` to specifically request an earlier
Python version when a more recent version is installed).

In addition to the launcher, the Windows installer now includes an
option to add the newly installed Python to the system PATH. (Contributed
by Brian Curtin in [bpo\-3561](https://bugs.python.org/issue?@action=redirect&bpo=3561).)

See also

[**PEP 397**](https://peps.python.org/pep-0397/) \- Python Launcher for WindowsPEP written by Mark Hammond and Martin v. Löwis; implementation by
Vinay Sajip.

Launcher documentation: [Python Launcher for Windows](../using/windows.html#launcher)

Installer PATH modification: [Finding the Python executable](../using/windows.html#windows-path-mod)

## PEP 3151: Reworking the OS and IO exception hierarchy[¶](#pep-3151-reworking-the-os-and-io-exception-hierarchy "Link to this heading")

The hierarchy of exceptions raised by operating system errors is now both
simplified and finer\-grained.

You don’t have to worry anymore about choosing the appropriate exception
type between [`OSError`](../library/exceptions.html#OSError "OSError"), [`IOError`](../library/exceptions.html#IOError "IOError"), [`EnvironmentError`](../library/exceptions.html#EnvironmentError "EnvironmentError"),
[`WindowsError`](../library/exceptions.html#WindowsError "WindowsError"), `mmap.error`, [`socket.error`](../library/socket.html#socket.error "socket.error") or
[`select.error`](../library/select.html#select.error "select.error"). All these exception types are now only one:
[`OSError`](../library/exceptions.html#OSError "OSError"). The other names are kept as aliases for compatibility
reasons.

Also, it is now easier to catch a specific error condition. Instead of
inspecting the `errno` attribute (or `args[0]`) for a particular
constant from the [`errno`](../library/errno.html#module-errno "errno: Standard errno system symbols.") module, you can catch the adequate
[`OSError`](../library/exceptions.html#OSError "OSError") subclass. The available subclasses are the following:

* [`BlockingIOError`](../library/exceptions.html#BlockingIOError "BlockingIOError")
* [`ChildProcessError`](../library/exceptions.html#ChildProcessError "ChildProcessError")
* [`ConnectionError`](../library/exceptions.html#ConnectionError "ConnectionError")
* [`FileExistsError`](../library/exceptions.html#FileExistsError "FileExistsError")
* [`FileNotFoundError`](../library/exceptions.html#FileNotFoundError "FileNotFoundError")
* [`InterruptedError`](../library/exceptions.html#InterruptedError "InterruptedError")
* [`IsADirectoryError`](../library/exceptions.html#IsADirectoryError "IsADirectoryError")
* [`NotADirectoryError`](../library/exceptions.html#NotADirectoryError "NotADirectoryError")
* [`PermissionError`](../library/exceptions.html#PermissionError "PermissionError")
* [`ProcessLookupError`](../library/exceptions.html#ProcessLookupError "ProcessLookupError")
* [`TimeoutError`](../library/exceptions.html#TimeoutError "TimeoutError")

And the [`ConnectionError`](../library/exceptions.html#ConnectionError "ConnectionError") itself has finer\-grained subclasses:

* [`BrokenPipeError`](../library/exceptions.html#BrokenPipeError "BrokenPipeError")
* [`ConnectionAbortedError`](../library/exceptions.html#ConnectionAbortedError "ConnectionAbortedError")
* [`ConnectionRefusedError`](../library/exceptions.html#ConnectionRefusedError "ConnectionRefusedError")
* [`ConnectionResetError`](../library/exceptions.html#ConnectionResetError "ConnectionResetError")

Thanks to the new exceptions, common usages of the [`errno`](../library/errno.html#module-errno "errno: Standard errno system symbols.") can now be
avoided. For example, the following code written for Python 3\.2:

\`\`\`
from errno import ENOENT, EACCES, EPERM

try:
 with open("document.txt") as f:
 content = f.read()
except IOError as err:
 if err.errno == ENOENT:
 print("document.txt file is missing")
 elif err.errno in (EACCES, EPERM):
 print("You are not allowed to read document.txt")
 else:
 raise

\`\`\`

can now be written without the [`errno`](../library/errno.html#module-errno "errno: Standard errno system symbols.") import and without manual
inspection of exception attributes:

\`\`\`
try:
 with open("document.txt") as f:
 content = f.read()
except FileNotFoundError:
 print("document.txt file is missing")
except PermissionError:
 print("You are not allowed to read document.txt")

\`\`\`

See also

[**PEP 3151**](https://peps.python.org/pep-3151/) \- Reworking the OS and IO Exception HierarchyPEP written and implemented by Antoine Pitrou

## PEP 380: Syntax for Delegating to a Subgenerator[¶](#pep-380-syntax-for-delegating-to-a-subgenerator "Link to this heading")

PEP 380 adds the `yield from` expression, allowing a [generator](../glossary.html#term-generator) to
delegate
part of its operations to another generator. This allows a section of code
containing [`yield`](../reference/simple_stmts.html#yield) to be factored out and placed in another generator.
Additionally, the subgenerator is allowed to return with a value, and the
value is made available to the delegating generator.

While designed primarily for use in delegating to a subgenerator, the `yield
from` expression actually allows delegation to arbitrary subiterators.

For simple iterators, `yield from iterable` is essentially just a shortened
form of `for item in iterable: yield item`:

\`\`\`
\>\>\> def g(x):
... yield from range(x, 0, \-1\)
... yield from range(x)
...
\>\>\> list(g(5\))
\[5, 4, 3, 2, 1, 0, 1, 2, 3, 4]

\`\`\`

However, unlike an ordinary loop, `yield from` allows subgenerators to
receive sent and thrown values directly from the calling scope, and
return a final value to the outer generator:

\`\`\`
\>\>\> def accumulate():
... tally = 0
... while 1:
... next = yield
... if next is None:
... return tally
... tally \+= next
...
\>\>\> def gather\_tallies(tallies):
... while 1:
... tally = yield from accumulate()
... tallies.append(tally)
...
\>\>\> tallies = \[]
\>\>\> acc = gather\_tallies(tallies)
\>\>\> next(acc) \# Ensure the accumulator is ready to accept values
\>\>\> for i in range(4\):
... acc.send(i)
...
\>\>\> acc.send(None) \# Finish the first tally
\>\>\> for i in range(5\):
... acc.send(i)
...
\>\>\> acc.send(None) \# Finish the second tally
\>\>\> tallies
\[6, 10]

\`\`\`

The main principle driving this change is to allow even generators that are
designed to be used with the `send` and `throw` methods to be split into
multiple subgenerators as easily as a single large function can be split into
multiple subfunctions.

See also

[**PEP 380**](https://peps.python.org/pep-0380/) \- Syntax for Delegating to a SubgeneratorPEP written by Greg Ewing; implementation by Greg Ewing, integrated into
3\.3 by Renaud Blanch, Ryan Kelly and Nick Coghlan; documentation by
Zbigniew Jędrzejewski\-Szmek and Nick Coghlan

## PEP 409: Suppressing exception context[¶](#pep-409-suppressing-exception-context "Link to this heading")

PEP 409 introduces new syntax that allows the display of the chained
exception context to be disabled. This allows cleaner error messages in
applications that convert between exception types:

\`\`\`
\>\>\> class D:
... def \_\_init\_\_(self, extra):
... self.\_extra\_attributes = extra
... def \_\_getattr\_\_(self, attr):
... try:
... return self.\_extra\_attributes\[attr]
... except KeyError:
... raise AttributeError(attr) from None
...
\>\>\> D({}).x
Traceback (most recent call last):
 File "\", line 1, in \
 File "\", line 8, in \_\_getattr\_\_
AttributeError: x

\`\`\`

Without the `from None` suffix to suppress the cause, the original
exception would be displayed by default:

\`\`\`
\>\>\> class C:
... def \_\_init\_\_(self, extra):
... self.\_extra\_attributes = extra
... def \_\_getattr\_\_(self, attr):
... try:
... return self.\_extra\_attributes\[attr]
... except KeyError:
... raise AttributeError(attr)
...
\>\>\> C({}).x
Traceback (most recent call last):
 File "\", line 6, in \_\_getattr\_\_
KeyError: 'x'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
 File "\", line 1, in \
 File "\", line 8, in \_\_getattr\_\_
AttributeError: x

\`\`\`

No debugging capability is lost, as the original exception context remains
available if needed (for example, if an intervening library has incorrectly
suppressed valuable underlying details):

\`\`\`
\>\>\> try:
... D({}).x
... except AttributeError as exc:
... print(repr(exc.\_\_context\_\_))
...
KeyError('x',)

\`\`\`

See also

[**PEP 409**](https://peps.python.org/pep-0409/) \- Suppressing exception contextPEP written by Ethan Furman; implemented by Ethan Furman and Nick
Coghlan.

## PEP 414: Explicit Unicode literals[¶](#pep-414-explicit-unicode-literals "Link to this heading")

To ease the transition from Python 2 for Unicode aware Python applications
that make heavy use of Unicode literals, Python 3\.3 once again supports the
“`u`” prefix for string literals. This prefix has no semantic significance
in Python 3, it is provided solely to reduce the number of purely mechanical
changes in migrating to Python 3, making it easier for developers to focus on
the more significant semantic changes (such as the stricter default
separation of binary and text data).

See also

[**PEP 414**](https://peps.python.org/pep-0414/) \- Explicit Unicode literalsPEP written by Armin Ronacher.

## PEP 3155: Qualified name for classes and functions[¶](#pep-3155-qualified-name-for-classes-and-functions "Link to this heading")

Functions and class objects have a new [`__qualname__`](../library/stdtypes.html#definition.__qualname__ "definition.__qualname__")
attribute representing
the “path” from the module top\-level to their definition. For global functions
and classes, this is the same as [`__name__`](../library/stdtypes.html#definition.__name__ "definition.__name__").
For other functions and classes,
it provides better information about where they were actually defined, and
how they might be accessible from the global scope.

Example with (non\-bound) methods:

\`\`\`
\>\>\> class C:
... def meth(self):
... pass
...
\>\>\> C.meth.\_\_name\_\_
'meth'
\>\>\> C.meth.\_\_qualname\_\_
'C.meth'

\`\`\`

Example with nested classes:

\`\`\`
\>\>\> class C:
... class D:
... def meth(self):
... pass
...
\>\>\> C.D.\_\_name\_\_
'D'
\>\>\> C.D.\_\_qualname\_\_
'C.D'
\>\>\> C.D.meth.\_\_name\_\_
'meth'
\>\>\> C.D.meth.\_\_qualname\_\_
'C.D.meth'

\`\`\`

Example with nested functions:

\`\`\`
\>\>\> def outer():
... def inner():
... pass
... return inner
...
\>\>\> outer().\_\_name\_\_
'inner'
\>\>\> outer().\_\_qualname\_\_
'outer.\.inner'

\`\`\`

The string representation of those objects is also changed to include the
new, more precise information:

\`\`\`
\>\>\> str(C.D)
"\"
\>\>\> str(C.D.meth)
'\'

\`\`\`

See also

[**PEP 3155**](https://peps.python.org/pep-3155/) \- Qualified name for classes and functionsPEP written and implemented by Antoine Pitrou.

## PEP 412: Key\-Sharing Dictionary[¶](#pep-412-key-sharing-dictionary "Link to this heading")

Dictionaries used for the storage of objects’ attributes are now able to
share part of their internal storage between each other (namely, the part
which stores the keys and their respective hashes). This reduces the memory
consumption of programs creating many instances of non\-builtin types.

See also

[**PEP 412**](https://peps.python.org/pep-0412/) \- Key\-Sharing DictionaryPEP written and implemented by Mark Shannon.

## PEP 362: Function Signature Object[¶](#pep-362-function-signature-object "Link to this heading")

A new function [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") makes introspection of python
callables easy and straightforward. A broad range of callables is supported:
python functions, decorated or not, classes, and [`functools.partial()`](../library/functools.html#functools.partial "functools.partial")
objects. New classes [`inspect.Signature`](../library/inspect.html#inspect.Signature "inspect.Signature"), [`inspect.Parameter`](../library/inspect.html#inspect.Parameter "inspect.Parameter")
and [`inspect.BoundArguments`](../library/inspect.html#inspect.BoundArguments "inspect.BoundArguments") hold information about the call signatures,
such as, annotations, default values, parameters kinds, and bound arguments,
which considerably simplifies writing decorators and any code that validates
or amends calling signatures or arguments.

See also

[**PEP 362**](https://peps.python.org/pep-0362/): \- Function Signature ObjectPEP written by Brett Cannon, Yury Selivanov, Larry Hastings, Jiwon Seo;
implemented by Yury Selivanov.

## PEP 421: Adding sys.implementation[¶](#pep-421-adding-sys-implementation "Link to this heading")

A new attribute on the [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") module exposes details specific to the
implementation of the currently running interpreter. The initial set of
attributes on [`sys.implementation`](../library/sys.html#sys.implementation "sys.implementation") are `name`, `version`,
`hexversion`, and `cache_tag`.

The intention of `sys.implementation` is to consolidate into one namespace
the implementation\-specific data used by the standard library. This allows
different Python implementations to share a single standard library code base
much more easily. In its initial state, `sys.implementation` holds only a
small portion of the implementation\-specific data. Over time that ratio will
shift in order to make the standard library more portable.

One example of improved standard library portability is `cache_tag`. As of
Python 3\.3, `sys.implementation.cache_tag` is used by [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") to
support [**PEP 3147**](https://peps.python.org/pep-3147/) compliance. Any Python implementation that uses
`importlib` for its built\-in import system may use `cache_tag` to control
the caching behavior for modules.

### SimpleNamespace[¶](#simplenamespace "Link to this heading")

The implementation of `sys.implementation` also introduces a new type to
Python: [`types.SimpleNamespace`](../library/types.html#types.SimpleNamespace "types.SimpleNamespace"). In contrast to a mapping\-based
namespace, like [`dict`](../library/stdtypes.html#dict "dict"), `SimpleNamespace` is attribute\-based, like
[`object`](../library/functions.html#object "object"). However, unlike `object`, `SimpleNamespace` instances
are writable. This means that you can add, remove, and modify the namespace
through normal attribute access.

See also

[**PEP 421**](https://peps.python.org/pep-0421/) \- Adding sys.implementationPEP written and implemented by Eric Snow.

## Using importlib as the Implementation of Import[¶](#using-importlib-as-the-implementation-of-import "Link to this heading")

[bpo\-2377](https://bugs.python.org/issue?@action=redirect&bpo=2377) \- Replace \_\_import\_\_ w/ importlib.\_\_import\_\_
[bpo\-13959](https://bugs.python.org/issue?@action=redirect&bpo=13959) \- Re\-implement parts of `imp` in pure Python
[bpo\-14605](https://bugs.python.org/issue?@action=redirect&bpo=14605) \- Make import machinery explicit
[bpo\-14646](https://bugs.python.org/issue?@action=redirect&bpo=14646) \- Require loaders set \_\_loader\_\_ and \_\_package\_\_

The [`__import__()`](../library/functions.html#import__ "__import__") function is now powered by [`importlib.__import__()`](../library/importlib.html#importlib.__import__ "importlib.__import__").
This work leads to the completion of “phase 2” of [**PEP 302**](https://peps.python.org/pep-0302/). There are
multiple benefits to this change. First, it has allowed for more of the
machinery powering import to be exposed instead of being implicit and hidden
within the C code. It also provides a single implementation for all Python VMs
supporting Python 3\.3 to use, helping to end any VM\-specific deviations in
import semantics. And finally it eases the maintenance of import, allowing for
future growth to occur.

For the common user, there should be no visible change in semantics. For
those whose code currently manipulates import or calls import
programmatically, the code changes that might possibly be required are covered
in the [Porting Python code](#porting-python-code) section of this document.

### New APIs[¶](#new-apis "Link to this heading")

One of the large benefits of this work is the exposure of what goes into
making the import statement work. That means the various importers that were
once implicit are now fully exposed as part of the [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") package.

The abstract base classes defined in [`importlib.abc`](../library/importlib.html#module-importlib.abc "importlib.abc: Abstract base classes related to import") have been expanded
to properly delineate between [meta path finders](../glossary.html#term-meta-path-finder)
and [path entry finders](../glossary.html#term-path-entry-finder) by introducing
[`importlib.abc.MetaPathFinder`](../library/importlib.html#importlib.abc.MetaPathFinder "importlib.abc.MetaPathFinder") and
[`importlib.abc.PathEntryFinder`](../library/importlib.html#importlib.abc.PathEntryFinder "importlib.abc.PathEntryFinder"), respectively. The old ABC of
`importlib.abc.Finder` is now only provided for backwards\-compatibility
and does not enforce any method requirements.

In terms of finders, [`importlib.machinery.FileFinder`](../library/importlib.html#importlib.machinery.FileFinder "importlib.machinery.FileFinder") exposes the
mechanism used to search for source and bytecode files of a module. Previously
this class was an implicit member of [`sys.path_hooks`](../library/sys.html#sys.path_hooks "sys.path_hooks").

For loaders, the new abstract base class [`importlib.abc.FileLoader`](../library/importlib.html#importlib.abc.FileLoader "importlib.abc.FileLoader") helps
write a loader that uses the file system as the storage mechanism for a module’s
code. The loader for source files
([`importlib.machinery.SourceFileLoader`](../library/importlib.html#importlib.machinery.SourceFileLoader "importlib.machinery.SourceFileLoader")), sourceless bytecode files
([`importlib.machinery.SourcelessFileLoader`](../library/importlib.html#importlib.machinery.SourcelessFileLoader "importlib.machinery.SourcelessFileLoader")), and extension modules
([`importlib.machinery.ExtensionFileLoader`](../library/importlib.html#importlib.machinery.ExtensionFileLoader "importlib.machinery.ExtensionFileLoader")) are now available for
direct use.

[`ImportError`](../library/exceptions.html#ImportError "ImportError") now has `name` and `path` attributes which are set when
there is relevant data to provide. The message for failed imports will also
provide the full name of the module now instead of just the tail end of the
module’s name.

The [`importlib.invalidate_caches()`](../library/importlib.html#importlib.invalidate_caches "importlib.invalidate_caches") function will now call the method with
the same name on all finders cached in [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") to help
clean up any stored state as necessary.

### Visible Changes[¶](#visible-changes "Link to this heading")

For potential required changes to code, see the [Porting Python code](#porting-python-code)
section.

Beyond the expanse of what [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") now exposes, there are other
visible changes to import. The biggest is that [`sys.meta_path`](../library/sys.html#sys.meta_path "sys.meta_path") and
[`sys.path_hooks`](../library/sys.html#sys.path_hooks "sys.path_hooks") now store all of the meta path finders and path entry
hooks used by import. Previously the finders were implicit and hidden within
the C code of import instead of being directly exposed. This means that one can
now easily remove or change the order of the various finders to fit one’s needs.

Another change is that all modules have a `__loader__` attribute, storing the
loader used to create the module. [**PEP 302**](https://peps.python.org/pep-0302/) has been updated to make this
attribute mandatory for loaders to implement, so in the future once 3rd\-party
loaders have been updated people will be able to rely on the existence of the
attribute. Until such time, though, import is setting the module post\-load.

Loaders are also now expected to set the `__package__` attribute from
[**PEP 366**](https://peps.python.org/pep-0366/). Once again, import itself is already setting this on all loaders
from [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") and import itself is setting the attribute post\-load.

`None` is now inserted into [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") when no finder
can be found on [`sys.path_hooks`](../library/sys.html#sys.path_hooks "sys.path_hooks"). Since `imp.NullImporter` is not
directly exposed on [`sys.path_hooks`](../library/sys.html#sys.path_hooks "sys.path_hooks") it could no longer be relied upon to
always be available to use as a value representing no finder found.

All other changes relate to semantic changes which should be taken into
consideration when updating code for Python 3\.3, and thus should be read about
in the [Porting Python code](#porting-python-code) section of this document.

(Implementation by Brett Cannon)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

Some smaller changes made to the core Python language are:

* Added support for Unicode name aliases and named sequences.
Both [`unicodedata.lookup()`](../library/unicodedata.html#unicodedata.lookup "unicodedata.lookup") and `'\N{...}'` now resolve name aliases,
and [`unicodedata.lookup()`](../library/unicodedata.html#unicodedata.lookup "unicodedata.lookup") resolves named sequences too.

(Contributed by Ezio Melotti in [bpo\-12753](https://bugs.python.org/issue?@action=redirect&bpo=12753).)
* Unicode database updated to UCD version 6\.1\.0
* Equality comparisons on [`range()`](../library/stdtypes.html#range "range") objects now return a result reflecting
the equality of the underlying sequences generated by those range objects.
([bpo\-13201](https://bugs.python.org/issue?@action=redirect&bpo=13201))
* The `count()`, `find()`, `rfind()`, `index()` and `rindex()`
methods of [`bytes`](../library/stdtypes.html#bytes "bytes") and [`bytearray`](../library/stdtypes.html#bytearray "bytearray") objects now accept an
integer between 0 and 255 as their first argument.

(Contributed by Petri Lehtinen in [bpo\-12170](https://bugs.python.org/issue?@action=redirect&bpo=12170).)
* The `rjust()`, `ljust()`, and `center()` methods of [`bytes`](../library/stdtypes.html#bytes "bytes")
and [`bytearray`](../library/stdtypes.html#bytearray "bytearray") now accept a [`bytearray`](../library/stdtypes.html#bytearray "bytearray") for the `fill`
argument. (Contributed by Petri Lehtinen in [bpo\-12380](https://bugs.python.org/issue?@action=redirect&bpo=12380).)
* New methods have been added to [`list`](../library/stdtypes.html#list "list") and [`bytearray`](../library/stdtypes.html#bytearray "bytearray"):
`copy()` and `clear()` ([bpo\-10516](https://bugs.python.org/issue?@action=redirect&bpo=10516)). Consequently,
[`MutableSequence`](../library/collections.abc.html#collections.abc.MutableSequence "collections.abc.MutableSequence") now also defines a
`clear()` method ([bpo\-11388](https://bugs.python.org/issue?@action=redirect&bpo=11388)).
* Raw bytes literals can now be written `rb"..."` as well as `br"..."`.

(Contributed by Antoine Pitrou in [bpo\-13748](https://bugs.python.org/issue?@action=redirect&bpo=13748).)
* [`dict.setdefault()`](../library/stdtypes.html#dict.setdefault "dict.setdefault") now does only one lookup for the given key, making
it atomic when used with built\-in types.

(Contributed by Filip Gruszczyński in [bpo\-13521](https://bugs.python.org/issue?@action=redirect&bpo=13521).)
* The error messages produced when a function call does not match the function
signature have been significantly improved.

(Contributed by Benjamin Peterson.)

## A Finer\-Grained Import Lock[¶](#a-finer-grained-import-lock "Link to this heading")

Previous versions of CPython have always relied on a global import lock.
This led to unexpected annoyances, such as deadlocks when importing a module
would trigger code execution in a different thread as a side\-effect.
Clumsy workarounds were sometimes employed, such as the
[`PyImport_ImportModuleNoBlock()`](../c-api/import.html#c.PyImport_ImportModuleNoBlock "PyImport_ImportModuleNoBlock") C API function.

In Python 3\.3, importing a module takes a per\-module lock. This correctly
serializes importation of a given module from multiple threads (preventing
the exposure of incompletely initialized modules), while eliminating the
aforementioned annoyances.

(Contributed by Antoine Pitrou in [bpo\-9260](https://bugs.python.org/issue?@action=redirect&bpo=9260).)

## Builtin functions and types[¶](#builtin-functions-and-types "Link to this heading")

* [`open()`](../library/functions.html#open "open") gets a new *opener* parameter: the underlying file descriptor
for the file object is then obtained by calling *opener* with (*file*,
*flags*). It can be used to use custom flags like [`os.O_CLOEXEC`](../library/os.html#os.O_CLOEXEC "os.O_CLOEXEC") for
example. The `'x'` mode was added: open for exclusive creation, failing if
the file already exists.
* [`print()`](../library/functions.html#print "print"): added the *flush* keyword argument. If the *flush* keyword
argument is true, the stream is forcibly flushed.
* [`hash()`](../library/functions.html#hash "hash"): hash randomization is enabled by default, see
[`object.__hash__()`](../reference/datamodel.html#object.__hash__ "object.__hash__") and [`PYTHONHASHSEED`](../using/cmdline.html#envvar-PYTHONHASHSEED).
* The [`str`](../library/stdtypes.html#str "str") type gets a new [`casefold()`](../library/stdtypes.html#str.casefold "str.casefold") method: return a
casefolded copy of the string, casefolded strings may be used for caseless
matching. For example, `'ß'.casefold()` returns `'ss'`.
* The sequence documentation has been substantially rewritten to better
explain the binary/text sequence distinction and to provide specific
documentation sections for the individual builtin sequence types
([bpo\-4966](https://bugs.python.org/issue?@action=redirect&bpo=4966)).

## New Modules[¶](#new-modules "Link to this heading")

### faulthandler[¶](#faulthandler "Link to this heading")

This new debug module [`faulthandler`](../library/faulthandler.html#module-faulthandler "faulthandler: Dump the Python traceback.") contains functions to dump Python tracebacks explicitly,
on a fault (a crash like a segmentation fault), after a timeout, or on a user
signal. Call [`faulthandler.enable()`](../library/faulthandler.html#faulthandler.enable "faulthandler.enable") to install fault handlers for the
`SIGSEGV`, `SIGFPE`, `SIGABRT`, `SIGBUS`, and
`SIGILL` signals. You can also enable them at startup by setting the
[`PYTHONFAULTHANDLER`](../using/cmdline.html#envvar-PYTHONFAULTHANDLER) environment variable or by using [`-X`](../using/cmdline.html#cmdoption-X)
`faulthandler` command line option.

Example of a segmentation fault on Linux:

\`\`\`
$ python \-q \-X faulthandler
\>\>\> import ctypes
\>\>\> ctypes.string\_at(0\)
Fatal Python error: Segmentation fault

Current thread 0x00007fb899f39700:
 File "/home/python/cpython/Lib/ctypes/\_\_init\_\_.py", line 486 in string\_at
 File "\", line 1 in \
Segmentation fault

\`\`\`

### ipaddress[¶](#ipaddress "Link to this heading")

The new [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") module provides tools for creating and manipulating
objects representing IPv4 and IPv6 addresses, networks and interfaces (i.e.
an IP address associated with a specific IP subnet).

(Contributed by Google and Peter Moody in [**PEP 3144**](https://peps.python.org/pep-3144/).)

### lzma[¶](#lzma "Link to this heading")

The newly added [`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library.") module provides data compression and decompression
using the LZMA algorithm, including support for the `.xz` and `.lzma`
file formats.

(Contributed by Nadeem Vawda and Per Øyvind Karlsen in [bpo\-6715](https://bugs.python.org/issue?@action=redirect&bpo=6715).)

## Improved Modules[¶](#improved-modules "Link to this heading")

### abc[¶](#abc "Link to this heading")

Improved support for abstract base classes containing descriptors composed with
abstract methods. The recommended approach to declaring abstract descriptors is
now to provide `__isabstractmethod__` as a dynamically updated
property. The built\-in descriptors have been updated accordingly.

* [`abc.abstractproperty`](../library/abc.html#abc.abstractproperty "abc.abstractproperty") has been deprecated, use [`property`](../library/functions.html#property "property")
with [`abc.abstractmethod()`](../library/abc.html#abc.abstractmethod "abc.abstractmethod") instead.
* [`abc.abstractclassmethod`](../library/abc.html#abc.abstractclassmethod "abc.abstractclassmethod") has been deprecated, use
[`classmethod`](../library/functions.html#classmethod "classmethod") with [`abc.abstractmethod()`](../library/abc.html#abc.abstractmethod "abc.abstractmethod") instead.
* [`abc.abstractstaticmethod`](../library/abc.html#abc.abstractstaticmethod "abc.abstractstaticmethod") has been deprecated, use
[`staticmethod`](../library/functions.html#staticmethod "staticmethod") with [`abc.abstractmethod()`](../library/abc.html#abc.abstractmethod "abc.abstractmethod") instead.

(Contributed by Darren Dale in [bpo\-11610](https://bugs.python.org/issue?@action=redirect&bpo=11610).)

[`abc.ABCMeta.register()`](../library/abc.html#abc.ABCMeta.register "abc.ABCMeta.register") now returns the registered subclass, which means
it can now be used as a class decorator ([bpo\-10868](https://bugs.python.org/issue?@action=redirect&bpo=10868)).

### array[¶](#array "Link to this heading")

The [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values.") module supports the long long type using `q` and
`Q` type codes.

(Contributed by Oren Tirosh and Hirokazu Yamamoto in [bpo\-1172711](https://bugs.python.org/issue?@action=redirect&bpo=1172711).)

### base64[¶](#base64 "Link to this heading")

ASCII\-only Unicode strings are now accepted by the decoding functions of the
[`base64`](../library/base64.html#module-base64 "base64: RFC 4648: Base16, Base32, Base64 Data Encodings; Base85 and Ascii85") modern interface. For example, `base64.b64decode('YWJj')`
returns `b'abc'`. (Contributed by Catalin Iacob in [bpo\-13641](https://bugs.python.org/issue?@action=redirect&bpo=13641).)

### binascii[¶](#binascii "Link to this heading")

In addition to the binary objects they normally accept, the `a2b_` functions
now all also accept ASCII\-only strings as input. (Contributed by Antoine
Pitrou in [bpo\-13637](https://bugs.python.org/issue?@action=redirect&bpo=13637).)

### bz2[¶](#bz2 "Link to this heading")

The [`bz2`](../library/bz2.html#module-bz2 "bz2: Interfaces for bzip2 compression and decompression.") module has been rewritten from scratch. In the process, several
new features have been added:

* New [`bz2.open()`](../library/bz2.html#bz2.open "bz2.open") function: open a bzip2\-compressed file in binary or
text mode.
* [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") can now read from and write to arbitrary file\-like
objects, by means of its constructor’s *fileobj* argument.

(Contributed by Nadeem Vawda in [bpo\-5863](https://bugs.python.org/issue?@action=redirect&bpo=5863).)
* [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") and [`bz2.decompress()`](../library/bz2.html#bz2.decompress "bz2.decompress") can now decompress
multi\-stream inputs (such as those produced by the **pbzip2** tool).
[`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") can now also be used to create this type of file, using
the `'a'` (append) mode.

(Contributed by Nir Aides in [bpo\-1625](https://bugs.python.org/issue?@action=redirect&bpo=1625).)
* [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") now implements all of the [`io.BufferedIOBase`](../library/io.html#io.BufferedIOBase "io.BufferedIOBase") API,
except for the `detach()` and `truncate()` methods.

### codecs[¶](#codecs "Link to this heading")

The [`mbcs`](../library/codecs.html#module-encodings.mbcs "encodings.mbcs: Windows ANSI codepage") codec has been rewritten to handle correctly
`replace` and `ignore` error handlers on all Windows versions. The
[`mbcs`](../library/codecs.html#module-encodings.mbcs "encodings.mbcs: Windows ANSI codepage") codec now supports all error handlers, instead of only
`replace` to encode and `ignore` to decode.

A new Windows\-only codec has been added: `cp65001` ([bpo\-13216](https://bugs.python.org/issue?@action=redirect&bpo=13216)). It is the
Windows code page 65001 (Windows UTF\-8, `CP_UTF8`). For example, it is used
by `sys.stdout` if the console output code page is set to cp65001 (e.g., using
`chcp 65001` command).

Multibyte CJK decoders now resynchronize faster. They only ignore the first
byte of an invalid byte sequence. For example, `b'\xff\n'.decode('gb2312',
'replace')` now returns a `\n` after the replacement character.

([bpo\-12016](https://bugs.python.org/issue?@action=redirect&bpo=12016))

Incremental CJK codec encoders are no longer reset at each call to their
encode() methods. For example:

\`\`\`
\>\>\> import codecs
\>\>\> encoder = codecs.getincrementalencoder('hz')('strict')
\>\>\> b''.join(encoder.encode(x) for x in '\\u52ff\\u65bd\\u65bc\\u4eba\\u3002 Bye.')
b'\~{NpJ)l6HK!\#\~} Bye.'

\`\`\`

This example gives `b'~{Np~}~{J)~}~{l6~}~{HK~}~{!#~} Bye.'` with older Python
versions.

([bpo\-12100](https://bugs.python.org/issue?@action=redirect&bpo=12100))

The `unicode_internal` codec has been deprecated.

### collections[¶](#collections "Link to this heading")

Addition of a new [`ChainMap`](../library/collections.html#collections.ChainMap "collections.ChainMap") class to allow treating a
number of mappings as a single unit. (Written by Raymond Hettinger for
[bpo\-11089](https://bugs.python.org/issue?@action=redirect&bpo=11089), made public in [bpo\-11297](https://bugs.python.org/issue?@action=redirect&bpo=11297).)

The abstract base classes have been moved in a new [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers")
module, to better differentiate between the abstract and the concrete
collections classes. Aliases for ABCs are still present in the
[`collections`](../library/collections.html#module-collections "collections: Container datatypes") module to preserve existing imports. ([bpo\-11085](https://bugs.python.org/issue?@action=redirect&bpo=11085))

The [`Counter`](../library/collections.html#collections.Counter "collections.Counter") class now supports the unary `+` and `-`
operators, as well as the in\-place operators `+=`, `-=`, `|=`, and
`&=`. (Contributed by Raymond Hettinger in [bpo\-13121](https://bugs.python.org/issue?@action=redirect&bpo=13121).)

### contextlib[¶](#contextlib "Link to this heading")

[`ExitStack`](../library/contextlib.html#contextlib.ExitStack "contextlib.ExitStack") now provides a solid foundation for
programmatic manipulation of context managers and similar cleanup
functionality. Unlike the previous `contextlib.nested` API (which was
deprecated and removed), the new API is designed to work correctly
regardless of whether context managers acquire their resources in
their `__init__` method (for example, file objects) or in their
`__enter__` method (for example, synchronisation objects from the
[`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") module).

([bpo\-13585](https://bugs.python.org/issue?@action=redirect&bpo=13585))

### crypt[¶](#crypt "Link to this heading")

Addition of salt and modular crypt format (hashing method) and the `mksalt()`
function to the `crypt` module.

([bpo\-10924](https://bugs.python.org/issue?@action=redirect&bpo=10924))

### curses[¶](#curses "Link to this heading")

* If the [`curses`](../library/curses.html#module-curses "curses: An interface to the curses library, providing portable terminal handling. (Unix)") module is linked to the ncursesw library, use Unicode
functions when Unicode strings or characters are passed (e.g.
`waddwstr()`), and bytes functions otherwise (e.g. `waddstr()`).
* Use the locale encoding instead of `utf-8` to encode Unicode strings.
* `curses.window` has a new [`curses.window.encoding`](../library/curses.html#curses.window.encoding "curses.window.encoding") attribute.
* The `curses.window` class has a new [`get_wch()`](../library/curses.html#curses.window.get_wch "curses.window.get_wch")
method to get a wide character
* The [`curses`](../library/curses.html#module-curses "curses: An interface to the curses library, providing portable terminal handling. (Unix)") module has a new [`unget_wch()`](../library/curses.html#curses.unget_wch "curses.unget_wch") function to
push a wide character so the next [`get_wch()`](../library/curses.html#curses.window.get_wch "curses.window.get_wch") will return
it

(Contributed by Iñigo Serna in [bpo\-6755](https://bugs.python.org/issue?@action=redirect&bpo=6755).)

### datetime[¶](#datetime "Link to this heading")

* Equality comparisons between naive and aware [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime")
instances now return [`False`](../library/constants.html#False "False") instead of raising [`TypeError`](../library/exceptions.html#TypeError "TypeError")
([bpo\-15006](https://bugs.python.org/issue?@action=redirect&bpo=15006)).
* New [`datetime.datetime.timestamp()`](../library/datetime.html#datetime.datetime.timestamp "datetime.datetime.timestamp") method: Return POSIX timestamp
corresponding to the [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") instance.
* The [`datetime.datetime.strftime()`](../library/datetime.html#datetime.datetime.strftime "datetime.datetime.strftime") method supports formatting years
older than 1000\.
* The [`datetime.datetime.astimezone()`](../library/datetime.html#datetime.datetime.astimezone "datetime.datetime.astimezone") method can now be
called without arguments to convert datetime instance to the system
timezone.

### decimal[¶](#decimal "Link to this heading")

[bpo\-7652](https://bugs.python.org/issue?@action=redirect&bpo=7652) \- integrate fast native decimal arithmetic.C\-module and libmpdec written by Stefan Krah.

The new C version of the decimal module integrates the high speed libmpdec
library for arbitrary precision correctly rounded decimal floating\-point
arithmetic. libmpdec conforms to IBM’s General Decimal Arithmetic Specification.

Performance gains range from 10x for database applications to 100x for
numerically intensive applications. These numbers are expected gains
for standard precisions used in decimal floating\-point arithmetic. Since
the precision is user configurable, the exact figures may vary. For example,
in integer bignum arithmetic the differences can be significantly higher.

The following table is meant as an illustration. Benchmarks are available
at .

> |  | decimal.py | \_decimal | speedup |
> | --- | --- | --- | --- |
> | pi | 42\.02s | 0\.345s | 120x |
> | telco | 172\.19s | 5\.68s | 30x |
> | psycopg | 3\.57s | 0\.29s | 12x |

#### Features[¶](#id1 "Link to this heading")

* The [`FloatOperation`](../library/decimal.html#decimal.FloatOperation "decimal.FloatOperation") signal optionally enables stricter
semantics for mixing floats and Decimals.
* If Python is compiled without threads, the C version automatically
disables the expensive thread local context machinery. In this case,
the variable [`HAVE_THREADS`](../library/decimal.html#decimal.HAVE_THREADS "decimal.HAVE_THREADS") is set to `False`.

#### API changes[¶](#id2 "Link to this heading")

* The C module has the following context limits, depending on the machine
architecture:

> |  | 32\-bit | 64\-bit |
> | --- | --- | --- |
> | `MAX_PREC` | `425000000` | `999999999999999999` |
> | `MAX_EMAX` | `425000000` | `999999999999999999` |
> | `MIN_EMIN` | `-425000000` | `-999999999999999999` |
* In the context templates ([`DefaultContext`](../library/decimal.html#decimal.DefaultContext "decimal.DefaultContext"),
[`BasicContext`](../library/decimal.html#decimal.BasicContext "decimal.BasicContext") and [`ExtendedContext`](../library/decimal.html#decimal.ExtendedContext "decimal.ExtendedContext"))
the magnitude of `Emax` and
`Emin` has changed to `999999`.
* The [`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal") constructor in decimal.py does not observe
the context limits and converts values with arbitrary exponents or precision
exactly. Since the C version has internal limits, the following scheme is
used: If possible, values are converted exactly, otherwise
[`InvalidOperation`](../library/decimal.html#decimal.InvalidOperation "decimal.InvalidOperation") is raised and the result is NaN. In the
latter case it is always possible to use [`create_decimal()`](../library/decimal.html#decimal.Context.create_decimal "decimal.Context.create_decimal")
in order to obtain a rounded or inexact value.
* The power function in decimal.py is always correctly rounded. In the
C version, it is defined in terms of the correctly rounded
[`exp()`](../library/decimal.html#decimal.Decimal.exp "decimal.Decimal.exp") and [`ln()`](../library/decimal.html#decimal.Decimal.ln "decimal.Decimal.ln") functions,
but the final result is only “almost always correctly rounded”.
* In the C version, the context dictionary containing the signals is a
[`MutableMapping`](../library/collections.abc.html#collections.abc.MutableMapping "collections.abc.MutableMapping"). For speed reasons,
`flags` and `traps` always
refer to the same [`MutableMapping`](../library/collections.abc.html#collections.abc.MutableMapping "collections.abc.MutableMapping") that the context
was initialized with. If a new signal dictionary is assigned,
`flags` and `traps`
are updated with the new values, but they do not reference the RHS
dictionary.
* Pickling a [`Context`](../library/decimal.html#decimal.Context "decimal.Context") produces a different output in order
to have a common interchange format for the Python and C versions.
* The order of arguments in the [`Context`](../library/decimal.html#decimal.Context "decimal.Context") constructor has been
changed to match the order displayed by [`repr()`](../library/functions.html#repr "repr").
* The `watchexp` parameter in the [`quantize()`](../library/decimal.html#decimal.Decimal.quantize "decimal.Decimal.quantize") method
is deprecated.

### email[¶](#email "Link to this heading")

#### Policy Framework[¶](#policy-framework "Link to this heading")

The email package now has a [`policy`](../library/email.policy.html#module-email.policy "email.policy: Controlling the parsing and generating of messages") framework. A
[`Policy`](../library/email.policy.html#email.policy.Policy "email.policy.Policy") is an object with several methods and properties
that control how the email package behaves. The primary policy for Python 3\.3
is the [`Compat32`](../library/email.policy.html#email.policy.Compat32 "email.policy.Compat32") policy, which provides backward
compatibility with the email package in Python 3\.2\. A `policy` can be
specified when an email message is parsed by a [`parser`](../library/email.parser.html#module-email.parser "email.parser: Parse flat text email messages to produce a message object structure."), or when a
[`Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message") object is created, or when an email is
serialized using a [`generator`](../library/email.generator.html#module-email.generator "email.generator: Generate flat text email messages from a message structure."). Unless overridden, a policy passed
to a `parser` is inherited by all the `Message` object and sub\-objects
created by the `parser`. By default a `generator` will use the policy of
the `Message` object it is serializing. The default policy is
[`compat32`](../library/email.policy.html#email.policy.compat32 "email.policy.compat32").

The minimum set of controls implemented by all `policy` objects are:

| max\_line\_length | The maximum length, excluding the linesep character(s), individual lines may have when a `Message` is serialized. Defaults to 78\. |
| --- | --- |
| linesep | The character used to separate individual lines when a `Message` is serialized. Defaults to `\n`. |
| cte\_type | `7bit` or `8bit`. `8bit` applies only to a `Bytes` `generator`, and means that non\-ASCII may be used where allowed by the protocol (or where it exists in the original input). |
| raise\_on\_defect | Causes a `parser` to raise error when defects are encountered instead of adding them to the `Message` object’s `defects` list. |

A new policy instance, with new settings, is created using the
[`clone()`](../library/email.policy.html#email.policy.Policy.clone "email.policy.Policy.clone") method of policy objects. `clone` takes
any of the above controls as keyword arguments. Any control not specified in
the call retains its default value. Thus you can create a policy that uses
`\r\n` linesep characters like this:

\`\`\`
mypolicy = compat32\.clone(linesep='\\r\\n')

\`\`\`

Policies can be used to make the generation of messages in the format needed by
your application simpler. Instead of having to remember to specify
`linesep='\r\n'` in all the places you call a `generator`, you can specify
it once, when you set the policy used by the `parser` or the `Message`,
whichever your program uses to create `Message` objects. On the other hand,
if you need to generate messages in multiple forms, you can still specify the
parameters in the appropriate `generator` call. Or you can have custom
policy instances for your different cases, and pass those in when you create
the `generator`.

#### Provisional Policy with New Header API[¶](#provisional-policy-with-new-header-api "Link to this heading")

While the policy framework is worthwhile all by itself, the main motivation for
introducing it is to allow the creation of new policies that implement new
features for the email package in a way that maintains backward compatibility
for those who do not use the new policies. Because the new policies introduce a
new API, we are releasing them in Python 3\.3 as a [provisional policy](../glossary.html#term-provisional-package). Backwards incompatible changes (up to and including
removal of the code) may occur if deemed necessary by the core developers.

The new policies are instances of [`EmailPolicy`](../library/email.policy.html#email.policy.EmailPolicy "email.policy.EmailPolicy"),
and add the following additional controls:

| refold\_source | Controls whether or not headers parsed by a [`parser`](../library/email.parser.html#module-email.parser "email.parser: Parse flat text email messages to produce a message object structure.") are refolded by the [`generator`](../library/email.generator.html#module-email.generator "email.generator: Generate flat text email messages from a message structure."). It can be `none`, `long`, or `all`. The default is `long`, which means that source headers with a line longer than `max_line_length` get refolded. `none` means no line get refolded, and `all` means that all lines get refolded. |
| --- | --- |
| header\_factory | A callable that take a `name` and `value` and produces a custom header object. |

The `header_factory` is the key to the new features provided by the new
policies. When one of the new policies is used, any header retrieved from
a `Message` object is an object produced by the `header_factory`, and any
time you set a header on a `Message` it becomes an object produced by
`header_factory`. All such header objects have a `name` attribute equal
to the header name. Address and Date headers have additional attributes
that give you access to the parsed data of the header. This means you can now
do things like this:

\`\`\`
\>\>\> m = Message(policy=SMTP)
\>\>\> m\['To'] = 'Éric \'
\>\>\> m\['to']
'Éric \'
\>\>\> m\['to'].addresses
(Address(display\_name='Éric', username='foo', domain='example.com'),)
\>\>\> m\['to'].addresses\[0].username
'foo'
\>\>\> m\['to'].addresses\[0].display\_name
'Éric'
\>\>\> m\['Date'] = email.utils.localtime()
\>\>\> m\['Date'].datetime
datetime.datetime(2012, 5, 25, 21, 39, 24, 465484, tzinfo=datetime.timezone(datetime.timedelta(\-1, 72000\), 'EDT'))
\>\>\> m\['Date']
'Fri, 25 May 2012 21:44:27 \-0400'
\>\>\> print(m)
To: =?utf\-8?q?=C3=89ric?= \
Date: Fri, 25 May 2012 21:44:27 \-0400

\`\`\`

You will note that the unicode display name is automatically encoded as
`utf-8` when the message is serialized, but that when the header is accessed
directly, you get the unicode version. This eliminates any need to deal with
the [`email.header`](../library/email.header.html#module-email.header "email.header: Representing non-ASCII headers") [`decode_header()`](../library/email.header.html#email.header.decode_header "email.header.decode_header") or
[`make_header()`](../library/email.header.html#email.header.make_header "email.header.make_header") functions.

You can also create addresses from parts:

\`\`\`
\>\>\> m\['cc'] = \[Group('pals', \[Address('Bob', 'bob', 'example.com'),
... Address('Sally', 'sally', 'example.com')]),
... Address('Bonzo', addr\_spec='bonz@laugh.com')]
\>\>\> print(m)
To: =?utf\-8?q?=C3=89ric?= \
Date: Fri, 25 May 2012 21:44:27 \-0400
cc: pals: Bob \, Sally \;, Bonzo \

\`\`\`

Decoding to unicode is done automatically:

\`\`\`
\>\>\> m2 = message\_from\_string(str(m))
\>\>\> m2\['to']
'Éric \'

\`\`\`

When you parse a message, you can use the `addresses` and `groups`
attributes of the header objects to access the groups and individual
addresses:

\`\`\`
\>\>\> m2\['cc'].addresses
(Address(display\_name='Bob', username='bob', domain='example.com'), Address(display\_name='Sally', username='sally', domain='example.com'), Address(display\_name='Bonzo', username='bonz', domain='laugh.com'))
\>\>\> m2\['cc'].groups
(Group(display\_name='pals', addresses=(Address(display\_name='Bob', username='bob', domain='example.com'), Address(display\_name='Sally', username='sally', domain='example.com')), Group(display\_name=None, addresses=(Address(display\_name='Bonzo', username='bonz', domain='laugh.com'),))

\`\`\`

In summary, if you use one of the new policies, header manipulation works the
way it ought to: your application works with unicode strings, and the email
package transparently encodes and decodes the unicode to and from the RFC
standard Content Transfer Encodings.

#### Other API Changes[¶](#other-api-changes "Link to this heading")

New [`BytesHeaderParser`](../library/email.parser.html#email.parser.BytesHeaderParser "email.parser.BytesHeaderParser"), added to the [`parser`](../library/email.parser.html#module-email.parser "email.parser: Parse flat text email messages to produce a message object structure.")
module to complement [`HeaderParser`](../library/email.parser.html#email.parser.HeaderParser "email.parser.HeaderParser") and complete the Bytes
API.

New utility functions:

* [`format_datetime()`](../library/email.utils.html#email.utils.format_datetime "email.utils.format_datetime"): given a [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime"),
produce a string formatted for use in an email header.
* [`parsedate_to_datetime()`](../library/email.utils.html#email.utils.parsedate_to_datetime "email.utils.parsedate_to_datetime"): given a date string from
an email header, convert it into an aware [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime"),
or a naive [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") if the offset is `-0000`.
* [`localtime()`](../library/email.utils.html#email.utils.localtime "email.utils.localtime"): With no argument, returns the
current local time as an aware [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") using the local
[`timezone`](../library/datetime.html#datetime.timezone "datetime.timezone"). Given an aware [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime"),
converts it into an aware [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") using the
local [`timezone`](../library/datetime.html#datetime.timezone "datetime.timezone").

### ftplib[¶](#ftplib "Link to this heading")

* [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") now accepts a `source_address` keyword argument to
specify the `(host, port)` to use as the source address in the bind call
when creating the outgoing socket. (Contributed by Giampaolo Rodolà
in [bpo\-8594](https://bugs.python.org/issue?@action=redirect&bpo=8594).)
* The [`FTP_TLS`](../library/ftplib.html#ftplib.FTP_TLS "ftplib.FTP_TLS") class now provides a new
[`ccc()`](../library/ftplib.html#ftplib.FTP_TLS.ccc "ftplib.FTP_TLS.ccc") function to revert control channel back to
plaintext. This can be useful to take advantage of firewalls that know how
to handle NAT with non\-secure FTP without opening fixed ports. (Contributed
by Giampaolo Rodolà in [bpo\-12139](https://bugs.python.org/issue?@action=redirect&bpo=12139).)
* Added [`ftplib.FTP.mlsd()`](../library/ftplib.html#ftplib.FTP.mlsd "ftplib.FTP.mlsd") method which provides a parsable directory
listing format and deprecates [`ftplib.FTP.nlst()`](../library/ftplib.html#ftplib.FTP.nlst "ftplib.FTP.nlst") and
[`ftplib.FTP.dir()`](../library/ftplib.html#ftplib.FTP.dir "ftplib.FTP.dir"). (Contributed by Giampaolo Rodolà in [bpo\-11072](https://bugs.python.org/issue?@action=redirect&bpo=11072).)

### functools[¶](#functools "Link to this heading")

The [`functools.lru_cache()`](../library/functools.html#functools.lru_cache "functools.lru_cache") decorator now accepts a `typed` keyword
argument (that defaults to `False` to ensure that it caches values of
different types that compare equal in separate cache slots. (Contributed
by Raymond Hettinger in [bpo\-13227](https://bugs.python.org/issue?@action=redirect&bpo=13227).)

### gc[¶](#gc "Link to this heading")

It is now possible to register callbacks invoked by the garbage collector
before and after collection using the new [`callbacks`](../library/gc.html#gc.callbacks "gc.callbacks") list.

### hmac[¶](#hmac "Link to this heading")

A new [`compare_digest()`](../library/hmac.html#hmac.compare_digest "hmac.compare_digest") function has been added to prevent side
channel attacks on digests through timing analysis. (Contributed by Nick
Coghlan and Christian Heimes in [bpo\-15061](https://bugs.python.org/issue?@action=redirect&bpo=15061).)

### http[¶](#http "Link to this heading")

[`http.server.BaseHTTPRequestHandler`](../library/http.server.html#http.server.BaseHTTPRequestHandler "http.server.BaseHTTPRequestHandler") now buffers the headers and writes
them all at once when [`end_headers()`](../library/http.server.html#http.server.BaseHTTPRequestHandler.end_headers "http.server.BaseHTTPRequestHandler.end_headers") is
called. A new method [`flush_headers()`](../library/http.server.html#http.server.BaseHTTPRequestHandler.flush_headers "http.server.BaseHTTPRequestHandler.flush_headers")
can be used to directly manage when the accumulated headers are sent.
(Contributed by Andrew Schaaf in [bpo\-3709](https://bugs.python.org/issue?@action=redirect&bpo=3709).)

[`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers.") now produces valid `HTML 4.01 strict` output.
(Contributed by Ezio Melotti in [bpo\-13295](https://bugs.python.org/issue?@action=redirect&bpo=13295).)

[`http.client.HTTPResponse`](../library/http.client.html#http.client.HTTPResponse "http.client.HTTPResponse") now has a
[`readinto()`](../library/http.client.html#http.client.HTTPResponse.readinto "http.client.HTTPResponse.readinto") method, which means it can be used
as an [`io.RawIOBase`](../library/io.html#io.RawIOBase "io.RawIOBase") class. (Contributed by John Kuhn in
[bpo\-13464](https://bugs.python.org/issue?@action=redirect&bpo=13464).)

### html[¶](#html "Link to this heading")

[`html.parser.HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") is now able to parse broken markup without
raising errors, therefore the *strict* argument of the constructor and the
`HTMLParseError` exception are now deprecated.
The ability to parse broken markup is the result of a number of bug fixes that
are also available on the latest bug fix releases of Python 2\.7/3\.2\.
(Contributed by Ezio Melotti in [bpo\-15114](https://bugs.python.org/issue?@action=redirect&bpo=15114), and [bpo\-14538](https://bugs.python.org/issue?@action=redirect&bpo=14538),
[bpo\-13993](https://bugs.python.org/issue?@action=redirect&bpo=13993), [bpo\-13960](https://bugs.python.org/issue?@action=redirect&bpo=13960), [bpo\-13358](https://bugs.python.org/issue?@action=redirect&bpo=13358), [bpo\-1745761](https://bugs.python.org/issue?@action=redirect&bpo=1745761),
[bpo\-755670](https://bugs.python.org/issue?@action=redirect&bpo=755670), [bpo\-13357](https://bugs.python.org/issue?@action=redirect&bpo=13357), [bpo\-12629](https://bugs.python.org/issue?@action=redirect&bpo=12629), [bpo\-1200313](https://bugs.python.org/issue?@action=redirect&bpo=1200313),
[bpo\-670664](https://bugs.python.org/issue?@action=redirect&bpo=670664), [bpo\-13273](https://bugs.python.org/issue?@action=redirect&bpo=13273), [bpo\-12888](https://bugs.python.org/issue?@action=redirect&bpo=12888), [bpo\-7311](https://bugs.python.org/issue?@action=redirect&bpo=7311).)

A new [`html5`](../library/html.entities.html#html.entities.html5 "html.entities.html5") dictionary that maps HTML5 named character
references to the equivalent Unicode character(s) (e.g. `html5['gt;'] ==
'>'`) has been added to the [`html.entities`](../library/html.entities.html#module-html.entities "html.entities: Definitions of HTML general entities.") module. The dictionary is
now also used by [`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser"). (Contributed by Ezio
Melotti in [bpo\-11113](https://bugs.python.org/issue?@action=redirect&bpo=11113) and [bpo\-15156](https://bugs.python.org/issue?@action=redirect&bpo=15156).)

### imaplib[¶](#imaplib "Link to this heading")

The [`IMAP4_SSL`](../library/imaplib.html#imaplib.IMAP4_SSL "imaplib.IMAP4_SSL") constructor now accepts an SSLContext
parameter to control parameters of the secure channel.

(Contributed by Sijin Joseph in [bpo\-8808](https://bugs.python.org/issue?@action=redirect&bpo=8808).)

### inspect[¶](#inspect "Link to this heading")

A new [`getclosurevars()`](../library/inspect.html#inspect.getclosurevars "inspect.getclosurevars") function has been added. This function
reports the current binding of all names referenced from the function body and
where those names were resolved, making it easier to verify correct internal
state when testing code that relies on stateful closures.

(Contributed by Meador Inge and Nick Coghlan in [bpo\-13062](https://bugs.python.org/issue?@action=redirect&bpo=13062).)

A new [`getgeneratorlocals()`](../library/inspect.html#inspect.getgeneratorlocals "inspect.getgeneratorlocals") function has been added. This
function reports the current binding of local variables in the generator’s
stack frame, making it easier to verify correct internal state when testing
generators.

(Contributed by Meador Inge in [bpo\-15153](https://bugs.python.org/issue?@action=redirect&bpo=15153).)

### io[¶](#io "Link to this heading")

The [`open()`](../library/io.html#io.open "io.open") function has a new `'x'` mode that can be used to
exclusively create a new file, and raise a [`FileExistsError`](../library/exceptions.html#FileExistsError "FileExistsError") if the file
already exists. It is based on the C11 ‘x’ mode to fopen().

(Contributed by David Townshend in [bpo\-12760](https://bugs.python.org/issue?@action=redirect&bpo=12760).)

The constructor of the [`TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") class has a new
*write\_through* optional argument. If *write\_through* is `True`, calls to
`write()` are guaranteed not to be buffered: any data
written on the [`TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") object is immediately handled to its
underlying binary buffer.

### itertools[¶](#itertools "Link to this heading")

[`accumulate()`](../library/itertools.html#itertools.accumulate "itertools.accumulate") now takes an optional `func` argument for
providing a user\-supplied binary function.

### logging[¶](#logging "Link to this heading")

The [`basicConfig()`](../library/logging.html#logging.basicConfig "logging.basicConfig") function now supports an optional `handlers`
argument taking an iterable of handlers to be added to the root logger.

A class level attribute `append_nul` has
been added to [`SysLogHandler`](../library/logging.handlers.html#logging.handlers.SysLogHandler "logging.handlers.SysLogHandler") to allow control of the
appending of the `NUL` (`\000`) byte to syslog records, since for some
daemons it is required while for others it is passed through to the log.

### math[¶](#math "Link to this heading")

The [`math`](../library/math.html#module-math "math: Mathematical functions (sin() etc.).") module has a new function, [`log2()`](../library/math.html#math.log2 "math.log2"), which returns
the base\-2 logarithm of *x*.

(Written by Mark Dickinson in [bpo\-11888](https://bugs.python.org/issue?@action=redirect&bpo=11888).)

### mmap[¶](#mmap "Link to this heading")

The [`read()`](../library/mmap.html#mmap.mmap.read "mmap.mmap.read") method is now more compatible with other file\-like
objects: if the argument is omitted or specified as `None`, it returns the
bytes from the current file position to the end of the mapping. (Contributed
by Petri Lehtinen in [bpo\-12021](https://bugs.python.org/issue?@action=redirect&bpo=12021).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

The new [`multiprocessing.connection.wait()`](../library/multiprocessing.html#multiprocessing.connection.wait "multiprocessing.connection.wait") function allows polling
multiple objects (such as connections, sockets and pipes) with a timeout.
(Contributed by Richard Oudkerk in [bpo\-12328](https://bugs.python.org/issue?@action=redirect&bpo=12328).)

`multiprocessing.Connection` objects can now be transferred over
multiprocessing connections.
(Contributed by Richard Oudkerk in [bpo\-4892](https://bugs.python.org/issue?@action=redirect&bpo=4892).)

[`multiprocessing.Process`](../library/multiprocessing.html#multiprocessing.Process "multiprocessing.Process") now accepts a `daemon` keyword argument
to override the default behavior of inheriting the `daemon` flag from
the parent process ([bpo\-6064](https://bugs.python.org/issue?@action=redirect&bpo=6064)).

New attribute [`multiprocessing.Process.sentinel`](../library/multiprocessing.html#multiprocessing.Process.sentinel "multiprocessing.Process.sentinel") allows a
program to wait on multiple [`Process`](../library/multiprocessing.html#multiprocessing.Process "multiprocessing.Process") objects at one
time using the appropriate OS primitives (for example, [`select`](../library/select.html#module-select "select: Wait for I/O completion on multiple streams.") on
posix systems).

New methods [`multiprocessing.pool.Pool.starmap()`](../library/multiprocessing.html#multiprocessing.pool.Pool.starmap "multiprocessing.pool.Pool.starmap") and
[`starmap_async()`](../library/multiprocessing.html#multiprocessing.pool.Pool.starmap_async "multiprocessing.pool.Pool.starmap_async") provide
[`itertools.starmap()`](../library/itertools.html#itertools.starmap "itertools.starmap") equivalents to the existing
[`multiprocessing.pool.Pool.map()`](../library/multiprocessing.html#multiprocessing.pool.Pool.map "multiprocessing.pool.Pool.map") and
[`map_async()`](../library/multiprocessing.html#multiprocessing.pool.Pool.map_async "multiprocessing.pool.Pool.map_async") functions. (Contributed by Hynek
Schlawack in [bpo\-12708](https://bugs.python.org/issue?@action=redirect&bpo=12708).)

### nntplib[¶](#nntplib "Link to this heading")

The `nntplib.NNTP` class now supports the context management protocol to
unconditionally consume [`socket.error`](../library/socket.html#socket.error "socket.error") exceptions and to close the NNTP
connection when done:

\`\`\`
\>\>\> from nntplib import NNTP
\>\>\> with NNTP('news.gmane.org') as n:
... n.group('gmane.comp.python.committers')
...
('211 1755 1 1755 gmane.comp.python.committers', 1755, 1, 1755, 'gmane.comp.python.committers')
\>\>\>

\`\`\`

(Contributed by Giampaolo Rodolà in [bpo\-9795](https://bugs.python.org/issue?@action=redirect&bpo=9795).)

### os[¶](#os "Link to this heading")

* The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module has a new [`pipe2()`](../library/os.html#os.pipe2 "os.pipe2") function that makes it
possible to create a pipe with [`O_CLOEXEC`](../library/os.html#os.O_CLOEXEC "os.O_CLOEXEC") or
[`O_NONBLOCK`](../library/os.html#os.O_NONBLOCK "os.O_NONBLOCK") flags set atomically. This is especially useful to
avoid race conditions in multi\-threaded programs.
* The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module has a new [`sendfile()`](../library/os.html#os.sendfile "os.sendfile") function which provides
an efficient “zero\-copy” way for copying data from one file (or socket)
descriptor to another. The phrase “zero\-copy” refers to the fact that all of
the copying of data between the two descriptors is done entirely by the
kernel, with no copying of data into userspace buffers. [`sendfile()`](../library/os.html#os.sendfile "os.sendfile")
can be used to efficiently copy data from a file on disk to a network socket,
e.g. for downloading a file.

(Patch submitted by Ross Lagerwall and Giampaolo Rodolà in [bpo\-10882](https://bugs.python.org/issue?@action=redirect&bpo=10882).)
* To avoid race conditions like symlink attacks and issues with temporary
files and directories, it is more reliable (and also faster) to manipulate
file descriptors instead of file names. Python 3\.3 enhances existing functions
and introduces new functions to work on file descriptors ([bpo\-4761](https://bugs.python.org/issue?@action=redirect&bpo=4761),
[bpo\-10755](https://bugs.python.org/issue?@action=redirect&bpo=10755) and [bpo\-14626](https://bugs.python.org/issue?@action=redirect&bpo=14626)).

	+ The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module has a new [`fwalk()`](../library/os.html#os.fwalk "os.fwalk") function similar to
	[`walk()`](../library/os.html#os.walk "os.walk") except that it also yields file descriptors referring to the
	directories visited. This is especially useful to avoid symlink races.
	+ The following functions get new optional *dir\_fd* ([paths relative to
	directory descriptors](../library/os.html#dir-fd)) and/or *follow\_symlinks* ([not
	following symlinks](../library/os.html#follow-symlinks)):
	[`access()`](../library/os.html#os.access "os.access"), [`chflags()`](../library/os.html#os.chflags "os.chflags"), [`chmod()`](../library/os.html#os.chmod "os.chmod"), [`chown()`](../library/os.html#os.chown "os.chown"),
	[`link()`](../library/os.html#os.link "os.link"), [`lstat()`](../library/os.html#os.lstat "os.lstat"), [`mkdir()`](../library/os.html#os.mkdir "os.mkdir"), [`mkfifo()`](../library/os.html#os.mkfifo "os.mkfifo"),
	[`mknod()`](../library/os.html#os.mknod "os.mknod"), [`open()`](../library/os.html#os.open "os.open"), [`readlink()`](../library/os.html#os.readlink "os.readlink"), [`remove()`](../library/os.html#os.remove "os.remove"),
	[`rename()`](../library/os.html#os.rename "os.rename"), [`replace()`](../library/os.html#os.replace "os.replace"), [`rmdir()`](../library/os.html#os.rmdir "os.rmdir"), [`stat()`](../library/os.html#os.stat "os.stat"),
	[`symlink()`](../library/os.html#os.symlink "os.symlink"), [`unlink()`](../library/os.html#os.unlink "os.unlink"), [`utime()`](../library/os.html#os.utime "os.utime"). Platform
	support for using these parameters can be checked via the sets
	[`os.supports_dir_fd`](../library/os.html#os.supports_dir_fd "os.supports_dir_fd") and `os.supports_follows_symlinks`.
	+ The following functions now support a file descriptor for their path argument:
	[`chdir()`](../library/os.html#os.chdir "os.chdir"), [`chmod()`](../library/os.html#os.chmod "os.chmod"), [`chown()`](../library/os.html#os.chown "os.chown"),
	[`execve()`](../library/os.html#os.execve "os.execve"), [`listdir()`](../library/os.html#os.listdir "os.listdir"), [`pathconf()`](../library/os.html#os.pathconf "os.pathconf"), [`exists()`](../library/os.path.html#os.path.exists "os.path.exists"),
	[`stat()`](../library/os.html#os.stat "os.stat"), [`statvfs()`](../library/os.html#os.statvfs "os.statvfs"), [`utime()`](../library/os.html#os.utime "os.utime"). Platform support
	for this can be checked via the [`os.supports_fd`](../library/os.html#os.supports_fd "os.supports_fd") set.
* [`access()`](../library/os.html#os.access "os.access") accepts an `effective_ids` keyword argument to turn on
using the effective uid/gid rather than the real uid/gid in the access check.
Platform support for this can be checked via the
[`supports_effective_ids`](../library/os.html#os.supports_effective_ids "os.supports_effective_ids") set.
* The [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") module has two new functions: [`getpriority()`](../library/os.html#os.getpriority "os.getpriority") and
[`setpriority()`](../library/os.html#os.setpriority "os.setpriority"). They can be used to get or set process
niceness/priority in a fashion similar to [`os.nice()`](../library/os.html#os.nice "os.nice") but extended to all
processes instead of just the current one.

(Patch submitted by Giampaolo Rodolà in [bpo\-10784](https://bugs.python.org/issue?@action=redirect&bpo=10784).)
* The new [`os.replace()`](../library/os.html#os.replace "os.replace") function allows cross\-platform renaming of a
file with overwriting the destination. With [`os.rename()`](../library/os.html#os.rename "os.rename"), an existing
destination file is overwritten under POSIX, but raises an error under
Windows.
(Contributed by Antoine Pitrou in [bpo\-8828](https://bugs.python.org/issue?@action=redirect&bpo=8828).)
* The stat family of functions ([`stat()`](../library/os.html#os.stat "os.stat"), [`fstat()`](../library/os.html#os.fstat "os.fstat"),
and [`lstat()`](../library/os.html#os.lstat "os.lstat")) now support reading a file’s timestamps
with nanosecond precision. Symmetrically, [`utime()`](../library/os.html#os.utime "os.utime")
can now write file timestamps with nanosecond precision. (Contributed by
Larry Hastings in [bpo\-14127](https://bugs.python.org/issue?@action=redirect&bpo=14127).)
* The new [`os.get_terminal_size()`](../library/os.html#os.get_terminal_size "os.get_terminal_size") function queries the size of the
terminal attached to a file descriptor. See also
[`shutil.get_terminal_size()`](../library/shutil.html#shutil.get_terminal_size "shutil.get_terminal_size").
(Contributed by Zbigniew Jędrzejewski\-Szmek in [bpo\-13609](https://bugs.python.org/issue?@action=redirect&bpo=13609).)

* New functions to support Linux extended attributes ([bpo\-12720](https://bugs.python.org/issue?@action=redirect&bpo=12720)):
[`getxattr()`](../library/os.html#os.getxattr "os.getxattr"), [`listxattr()`](../library/os.html#os.listxattr "os.listxattr"), [`removexattr()`](../library/os.html#os.removexattr "os.removexattr"),
[`setxattr()`](../library/os.html#os.setxattr "os.setxattr").
* New interface to the scheduler. These functions
control how a process is allocated CPU time by the operating system. New
functions:
[`sched_get_priority_max()`](../library/os.html#os.sched_get_priority_max "os.sched_get_priority_max"), [`sched_get_priority_min()`](../library/os.html#os.sched_get_priority_min "os.sched_get_priority_min"),
[`sched_getaffinity()`](../library/os.html#os.sched_getaffinity "os.sched_getaffinity"), [`sched_getparam()`](../library/os.html#os.sched_getparam "os.sched_getparam"),
[`sched_getscheduler()`](../library/os.html#os.sched_getscheduler "os.sched_getscheduler"), [`sched_rr_get_interval()`](../library/os.html#os.sched_rr_get_interval "os.sched_rr_get_interval"),
[`sched_setaffinity()`](../library/os.html#os.sched_setaffinity "os.sched_setaffinity"), [`sched_setparam()`](../library/os.html#os.sched_setparam "os.sched_setparam"),
[`sched_setscheduler()`](../library/os.html#os.sched_setscheduler "os.sched_setscheduler"), [`sched_yield()`](../library/os.html#os.sched_yield "os.sched_yield"),
* New functions to control the file system:

	+ [`posix_fadvise()`](../library/os.html#os.posix_fadvise "os.posix_fadvise"): Announces an intention to access data in a
	specific pattern thus allowing the kernel to make optimizations.
	+ [`posix_fallocate()`](../library/os.html#os.posix_fallocate "os.posix_fallocate"): Ensures that enough disk space is allocated
	for a file.
	+ [`sync()`](../library/os.html#os.sync "os.sync"): Force write of everything to disk.
* Additional new posix functions:

	+ [`lockf()`](../library/os.html#os.lockf "os.lockf"): Apply, test or remove a POSIX lock on an open file descriptor.
	+ [`pread()`](../library/os.html#os.pread "os.pread"): Read from a file descriptor at an offset, the file
	offset remains unchanged.
	+ [`pwrite()`](../library/os.html#os.pwrite "os.pwrite"): Write to a file descriptor from an offset, leaving
	the file offset unchanged.
	+ [`readv()`](../library/os.html#os.readv "os.readv"): Read from a file descriptor into a number of writable buffers.
	+ [`truncate()`](../library/os.html#os.truncate "os.truncate"): Truncate the file corresponding to *path*, so that
	it is at most *length* bytes in size.
	+ [`waitid()`](../library/os.html#os.waitid "os.waitid"): Wait for the completion of one or more child processes.
	+ [`writev()`](../library/os.html#os.writev "os.writev"): Write the contents of *buffers* to a file descriptor,
	where *buffers* is an arbitrary sequence of buffers.
	+ [`getgrouplist()`](../library/os.html#os.getgrouplist "os.getgrouplist") ([bpo\-9344](https://bugs.python.org/issue?@action=redirect&bpo=9344)): Return list of group ids that
	specified user belongs to.
* [`times()`](../library/os.html#os.times "os.times") and [`uname()`](../library/os.html#os.uname "os.uname"): Return type changed from a tuple to
a tuple\-like object with named attributes.
* Some platforms now support additional constants for the [`lseek()`](../library/os.html#os.lseek "os.lseek")
function, such as `os.SEEK_HOLE` and `os.SEEK_DATA`.
* New constants [`RTLD_LAZY`](../library/os.html#os.RTLD_LAZY "os.RTLD_LAZY"), [`RTLD_NOW`](../library/os.html#os.RTLD_NOW "os.RTLD_NOW"),
[`RTLD_GLOBAL`](../library/os.html#os.RTLD_GLOBAL "os.RTLD_GLOBAL"), [`RTLD_LOCAL`](../library/os.html#os.RTLD_LOCAL "os.RTLD_LOCAL"), [`RTLD_NODELETE`](../library/os.html#os.RTLD_NODELETE "os.RTLD_NODELETE"),
[`RTLD_NOLOAD`](../library/os.html#os.RTLD_NOLOAD "os.RTLD_NOLOAD"), and [`RTLD_DEEPBIND`](../library/os.html#os.RTLD_DEEPBIND "os.RTLD_DEEPBIND") are available on
platforms that support them. These are for use with the
[`sys.setdlopenflags()`](../library/sys.html#sys.setdlopenflags "sys.setdlopenflags") function, and supersede the similar constants
defined in [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python.") and `DLFCN`. (Contributed by Victor Stinner
in [bpo\-13226](https://bugs.python.org/issue?@action=redirect&bpo=13226).)
* [`os.symlink()`](../library/os.html#os.symlink "os.symlink") now accepts (and ignores) the `target_is_directory`
keyword argument on non\-Windows platforms, to ease cross\-platform support.

### pdb[¶](#pdb "Link to this heading")

Tab\-completion is now available not only for command names, but also their
arguments. For example, for the `break` command, function and file names
are completed.

(Contributed by Georg Brandl in [bpo\-14210](https://bugs.python.org/issue?@action=redirect&bpo=14210))

### pickle[¶](#pickle "Link to this heading")

[`pickle.Pickler`](../library/pickle.html#pickle.Pickler "pickle.Pickler") objects now have an optional
[`dispatch_table`](../library/pickle.html#pickle.Pickler.dispatch_table "pickle.Pickler.dispatch_table") attribute allowing per\-pickler
reduction functions to be set.

(Contributed by Richard Oudkerk in [bpo\-14166](https://bugs.python.org/issue?@action=redirect&bpo=14166).)

### pydoc[¶](#pydoc "Link to this heading")

The Tk GUI and the `serve()` function have been removed from the
[`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") module: `pydoc -g` and `serve()` have been deprecated
in Python 3\.2\.

### re[¶](#re "Link to this heading")

[`str`](../library/stdtypes.html#str "str") regular expressions now support `\u` and `\U` escapes.

(Contributed by Serhiy Storchaka in [bpo\-3665](https://bugs.python.org/issue?@action=redirect&bpo=3665).)

### sched[¶](#sched "Link to this heading")

* [`run()`](../library/sched.html#sched.scheduler.run "sched.scheduler.run") now accepts a *blocking* parameter which when
set to false makes the method execute the scheduled events due to expire
soonest (if any) and then return immediately.
This is useful in case you want to use the [`scheduler`](../library/sched.html#sched.scheduler "sched.scheduler") in
non\-blocking applications. (Contributed by Giampaolo Rodolà in [bpo\-13449](https://bugs.python.org/issue?@action=redirect&bpo=13449).)
* [`scheduler`](../library/sched.html#sched.scheduler "sched.scheduler") class can now be safely used in multi\-threaded
environments. (Contributed by Josiah Carlson and Giampaolo Rodolà in
[bpo\-8684](https://bugs.python.org/issue?@action=redirect&bpo=8684).)
* *timefunc* and *delayfunct* parameters of [`scheduler`](../library/sched.html#sched.scheduler "sched.scheduler") class
constructor are now optional and defaults to [`time.time()`](../library/time.html#time.time "time.time") and
[`time.sleep()`](../library/time.html#time.sleep "time.sleep") respectively. (Contributed by Chris Clark in
[bpo\-13245](https://bugs.python.org/issue?@action=redirect&bpo=13245).)
* [`enter()`](../library/sched.html#sched.scheduler.enter "sched.scheduler.enter") and [`enterabs()`](../library/sched.html#sched.scheduler.enterabs "sched.scheduler.enterabs")
*argument* parameter is now optional. (Contributed by Chris Clark in
[bpo\-13245](https://bugs.python.org/issue?@action=redirect&bpo=13245).)
* [`enter()`](../library/sched.html#sched.scheduler.enter "sched.scheduler.enter") and [`enterabs()`](../library/sched.html#sched.scheduler.enterabs "sched.scheduler.enterabs")
now accept a *kwargs* parameter. (Contributed by Chris Clark in
[bpo\-13245](https://bugs.python.org/issue?@action=redirect&bpo=13245).)

### select[¶](#select "Link to this heading")

Solaris and derivative platforms have a new class [`select.devpoll`](../library/select.html#select.devpoll "select.devpoll")
for high performance asynchronous sockets via `/dev/poll`.
(Contributed by Jesús Cea Avión in [bpo\-6397](https://bugs.python.org/issue?@action=redirect&bpo=6397).)

### shlex[¶](#shlex "Link to this heading")

The previously undocumented helper function `quote` from the
`pipes` modules has been moved to the [`shlex`](../library/shlex.html#module-shlex "shlex: Simple lexical analysis for Unix shell-like languages.") module and
documented. [`quote()`](../library/shlex.html#shlex.quote "shlex.quote") properly escapes all characters in a string
that might be otherwise given special meaning by the shell.

### shutil[¶](#shutil "Link to this heading")

* New functions:

	+ [`disk_usage()`](../library/shutil.html#shutil.disk_usage "shutil.disk_usage"): provides total, used and free disk space
	statistics. (Contributed by Giampaolo Rodolà in [bpo\-12442](https://bugs.python.org/issue?@action=redirect&bpo=12442).)
	+ [`chown()`](../library/shutil.html#shutil.chown "shutil.chown"): allows one to change user and/or group of the given
	path also specifying the user/group names and not only their numeric
	ids. (Contributed by Sandro Tosi in [bpo\-12191](https://bugs.python.org/issue?@action=redirect&bpo=12191).)
	+ [`shutil.get_terminal_size()`](../library/shutil.html#shutil.get_terminal_size "shutil.get_terminal_size"): returns the size of the terminal window
	to which the interpreter is attached. (Contributed by Zbigniew
	Jędrzejewski\-Szmek in [bpo\-13609](https://bugs.python.org/issue?@action=redirect&bpo=13609).)
* [`copy2()`](../library/shutil.html#shutil.copy2 "shutil.copy2") and [`copystat()`](../library/shutil.html#shutil.copystat "shutil.copystat") now preserve file
timestamps with nanosecond precision on platforms that support it.
They also preserve file “extended attributes” on Linux. (Contributed
by Larry Hastings in [bpo\-14127](https://bugs.python.org/issue?@action=redirect&bpo=14127) and [bpo\-15238](https://bugs.python.org/issue?@action=redirect&bpo=15238).)
* Several functions now take an optional `symlinks` argument: when that
parameter is true, symlinks aren’t dereferenced and the operation instead
acts on the symlink itself (or creates one, if relevant).
(Contributed by Hynek Schlawack in [bpo\-12715](https://bugs.python.org/issue?@action=redirect&bpo=12715).)
* When copying files to a different file system, [`move()`](../library/shutil.html#shutil.move "shutil.move") now
handles symlinks the way the posix `mv` command does, recreating the
symlink rather than copying the target file contents. (Contributed by
Jonathan Niehof in [bpo\-9993](https://bugs.python.org/issue?@action=redirect&bpo=9993).) [`move()`](../library/shutil.html#shutil.move "shutil.move") now also returns
the `dst` argument as its result.
* [`rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree") is now resistant to symlink attacks on platforms
which support the new `dir_fd` parameter in [`os.open()`](../library/os.html#os.open "os.open") and
[`os.unlink()`](../library/os.html#os.unlink "os.unlink"). (Contributed by Martin von Löwis and Hynek Schlawack
in [bpo\-4489](https://bugs.python.org/issue?@action=redirect&bpo=4489).)

### signal[¶](#signal "Link to this heading")

* The [`signal`](../library/signal.html#module-signal "signal: Set handlers for asynchronous events.") module has new functions:

	+ [`pthread_sigmask()`](../library/signal.html#signal.pthread_sigmask "signal.pthread_sigmask"): fetch and/or change the signal mask of the
	calling thread (Contributed by Jean\-Paul Calderone in [bpo\-8407](https://bugs.python.org/issue?@action=redirect&bpo=8407));
	+ [`pthread_kill()`](../library/signal.html#signal.pthread_kill "signal.pthread_kill"): send a signal to a thread;
	+ [`sigpending()`](../library/signal.html#signal.sigpending "signal.sigpending"): examine pending functions;
	+ [`sigwait()`](../library/signal.html#signal.sigwait "signal.sigwait"): wait a signal;
	+ [`sigwaitinfo()`](../library/signal.html#signal.sigwaitinfo "signal.sigwaitinfo"): wait for a signal, returning detailed
	information about it;
	+ [`sigtimedwait()`](../library/signal.html#signal.sigtimedwait "signal.sigtimedwait"): like [`sigwaitinfo()`](../library/signal.html#signal.sigwaitinfo "signal.sigwaitinfo") but with a
	timeout.
* The signal handler writes the signal number as a single byte instead of
a nul byte into the wakeup file descriptor. So it is possible to wait more
than one signal and know which signals were raised.
* [`signal.signal()`](../library/signal.html#signal.signal "signal.signal") and [`signal.siginterrupt()`](../library/signal.html#signal.siginterrupt "signal.siginterrupt") raise an OSError,
instead of a RuntimeError: OSError has an errno attribute.

### smtpd[¶](#smtpd "Link to this heading")

The `smtpd` module now supports [**RFC 5321**](https://datatracker.ietf.org/doc/html/rfc5321.html) (extended SMTP) and [**RFC 1870**](https://datatracker.ietf.org/doc/html/rfc1870.html)
(size extension). Per the standard, these extensions are enabled if and only
if the client initiates the session with an `EHLO` command.

(Initial `ELHO` support by Alberto Trevino. Size extension by Juhana
Jauhiainen. Substantial additional work on the patch contributed by Michele
Orrù and Dan Boswell. [bpo\-8739](https://bugs.python.org/issue?@action=redirect&bpo=8739))

### smtplib[¶](#smtplib "Link to this heading")

The [`SMTP`](../library/smtplib.html#smtplib.SMTP "smtplib.SMTP"), [`SMTP_SSL`](../library/smtplib.html#smtplib.SMTP_SSL "smtplib.SMTP_SSL"), and
[`LMTP`](../library/smtplib.html#smtplib.LMTP "smtplib.LMTP") classes now accept a `source_address` keyword argument
to specify the `(host, port)` to use as the source address in the bind call
when creating the outgoing socket. (Contributed by Paulo Scardine in
[bpo\-11281](https://bugs.python.org/issue?@action=redirect&bpo=11281).)

[`SMTP`](../library/smtplib.html#smtplib.SMTP "smtplib.SMTP") now supports the context management protocol, allowing an
`SMTP` instance to be used in a `with` statement. (Contributed
by Giampaolo Rodolà in [bpo\-11289](https://bugs.python.org/issue?@action=redirect&bpo=11289).)

The [`SMTP_SSL`](../library/smtplib.html#smtplib.SMTP_SSL "smtplib.SMTP_SSL") constructor and the [`starttls()`](../library/smtplib.html#smtplib.SMTP.starttls "smtplib.SMTP.starttls")
method now accept an SSLContext parameter to control parameters of the secure
channel. (Contributed by Kasun Herath in [bpo\-8809](https://bugs.python.org/issue?@action=redirect&bpo=8809).)

### socket[¶](#socket "Link to this heading")

* The [`socket`](../library/socket.html#socket.socket "socket.socket") class now exposes additional methods to process
ancillary data when supported by the underlying platform:

	+ [`sendmsg()`](../library/socket.html#socket.socket.sendmsg "socket.socket.sendmsg")
	+ [`recvmsg()`](../library/socket.html#socket.socket.recvmsg "socket.socket.recvmsg")
	+ [`recvmsg_into()`](../library/socket.html#socket.socket.recvmsg_into "socket.socket.recvmsg_into")(Contributed by David Watson in [bpo\-6560](https://bugs.python.org/issue?@action=redirect&bpo=6560), based on an earlier patch by
Heiko Wundram)
* The [`socket`](../library/socket.html#socket.socket "socket.socket") class now supports the PF\_CAN protocol family
(), on Linux
().

(Contributed by Matthias Fuchs, updated by Tiago Gonçalves in [bpo\-10141](https://bugs.python.org/issue?@action=redirect&bpo=10141).)
* The [`socket`](../library/socket.html#socket.socket "socket.socket") class now supports the PF\_RDS protocol family
( and
[https://oss.oracle.com/projects/rds](https://web.archive.org/web/20130115155505/https://oss.oracle.com/projects/rds/)).
* The [`socket`](../library/socket.html#socket.socket "socket.socket") class now supports the `PF_SYSTEM` protocol
family on OS X. (Contributed by Michael Goderbauer in [bpo\-13777](https://bugs.python.org/issue?@action=redirect&bpo=13777).)
* New function [`sethostname()`](../library/socket.html#socket.sethostname "socket.sethostname") allows the hostname to be set
on Unix systems if the calling process has sufficient privileges.
(Contributed by Ross Lagerwall in [bpo\-10866](https://bugs.python.org/issue?@action=redirect&bpo=10866).)

### socketserver[¶](#socketserver "Link to this heading")

[`BaseServer`](../library/socketserver.html#socketserver.BaseServer "socketserver.BaseServer") now has an overridable method
[`service_actions()`](../library/socketserver.html#socketserver.BaseServer.service_actions "socketserver.BaseServer.service_actions") that is called by the
[`serve_forever()`](../library/socketserver.html#socketserver.BaseServer.serve_forever "socketserver.BaseServer.serve_forever") method in the service loop.
[`ForkingMixIn`](../library/socketserver.html#socketserver.ForkingMixIn "socketserver.ForkingMixIn") now uses this to clean up zombie
child processes. (Contributed by Justin Warkentin in [bpo\-11109](https://bugs.python.org/issue?@action=redirect&bpo=11109).)

### sqlite3[¶](#sqlite3 "Link to this heading")

New [`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") method
[`set_trace_callback()`](../library/sqlite3.html#sqlite3.Connection.set_trace_callback "sqlite3.Connection.set_trace_callback") can be used to capture a trace of
all sql commands processed by sqlite. (Contributed by Torsten Landschoff
in [bpo\-11688](https://bugs.python.org/issue?@action=redirect&bpo=11688).)

### ssl[¶](#ssl "Link to this heading")

* The [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module has two new random generation functions:

	+ [`RAND_bytes()`](../library/ssl.html#ssl.RAND_bytes "ssl.RAND_bytes"): generate cryptographically strong
	pseudo\-random bytes.
	+ `RAND_pseudo_bytes()`: generate pseudo\-random bytes.(Contributed by Victor Stinner in [bpo\-12049](https://bugs.python.org/issue?@action=redirect&bpo=12049).)
* The [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module now exposes a finer\-grained exception hierarchy
in order to make it easier to inspect the various kinds of errors.
(Contributed by Antoine Pitrou in [bpo\-11183](https://bugs.python.org/issue?@action=redirect&bpo=11183).)
* [`load_cert_chain()`](../library/ssl.html#ssl.SSLContext.load_cert_chain "ssl.SSLContext.load_cert_chain") now accepts a *password* argument
to be used if the private key is encrypted.
(Contributed by Adam Simpkins in [bpo\-12803](https://bugs.python.org/issue?@action=redirect&bpo=12803).)
* Diffie\-Hellman key exchange, both regular and Elliptic Curve\-based, is
now supported through the [`load_dh_params()`](../library/ssl.html#ssl.SSLContext.load_dh_params "ssl.SSLContext.load_dh_params") and
[`set_ecdh_curve()`](../library/ssl.html#ssl.SSLContext.set_ecdh_curve "ssl.SSLContext.set_ecdh_curve") methods.
(Contributed by Antoine Pitrou in [bpo\-13626](https://bugs.python.org/issue?@action=redirect&bpo=13626) and [bpo\-13627](https://bugs.python.org/issue?@action=redirect&bpo=13627).)
* SSL sockets have a new [`get_channel_binding()`](../library/ssl.html#ssl.SSLSocket.get_channel_binding "ssl.SSLSocket.get_channel_binding") method
allowing the implementation of certain authentication mechanisms such as
SCRAM\-SHA\-1\-PLUS. (Contributed by Jacek Konieczny in [bpo\-12551](https://bugs.python.org/issue?@action=redirect&bpo=12551).)
* You can query the SSL compression algorithm used by an SSL socket, thanks
to its new [`compression()`](../library/ssl.html#ssl.SSLSocket.compression "ssl.SSLSocket.compression") method. The new attribute
[`OP_NO_COMPRESSION`](../library/ssl.html#ssl.OP_NO_COMPRESSION "ssl.OP_NO_COMPRESSION") can be used to disable compression.
(Contributed by Antoine Pitrou in [bpo\-13634](https://bugs.python.org/issue?@action=redirect&bpo=13634).)
* Support has been added for the Next Protocol Negotiation extension using
the [`ssl.SSLContext.set_npn_protocols()`](../library/ssl.html#ssl.SSLContext.set_npn_protocols "ssl.SSLContext.set_npn_protocols") method.
(Contributed by Colin Marc in [bpo\-14204](https://bugs.python.org/issue?@action=redirect&bpo=14204).)
* SSL errors can now be introspected more easily thanks to
[`library`](../library/ssl.html#ssl.SSLError.library "ssl.SSLError.library") and [`reason`](../library/ssl.html#ssl.SSLError.reason "ssl.SSLError.reason") attributes.
(Contributed by Antoine Pitrou in [bpo\-14837](https://bugs.python.org/issue?@action=redirect&bpo=14837).)
* The [`get_server_certificate()`](../library/ssl.html#ssl.get_server_certificate "ssl.get_server_certificate") function now supports IPv6\.
(Contributed by Charles\-François Natali in [bpo\-11811](https://bugs.python.org/issue?@action=redirect&bpo=11811).)
* New attribute [`OP_CIPHER_SERVER_PREFERENCE`](../library/ssl.html#ssl.OP_CIPHER_SERVER_PREFERENCE "ssl.OP_CIPHER_SERVER_PREFERENCE") allows setting
SSLv3 server sockets to use the server’s cipher ordering preference rather
than the client’s ([bpo\-13635](https://bugs.python.org/issue?@action=redirect&bpo=13635)).

### stat[¶](#stat "Link to this heading")

The undocumented tarfile.filemode function has been moved to
[`stat.filemode()`](../library/stat.html#stat.filemode "stat.filemode"). It can be used to convert a file’s mode to a string of
the form ‘\-rwxrwxrwx’.

(Contributed by Giampaolo Rodolà in [bpo\-14807](https://bugs.python.org/issue?@action=redirect&bpo=14807).)

### struct[¶](#struct "Link to this heading")

The [`struct`](../library/struct.html#module-struct "struct: Interpret bytes as packed binary data.") module now supports `ssize_t` and `size_t` via the
new codes `n` and `N`, respectively. (Contributed by Antoine Pitrou
in [bpo\-3163](https://bugs.python.org/issue?@action=redirect&bpo=3163).)

### subprocess[¶](#subprocess "Link to this heading")

Command strings can now be bytes objects on posix platforms. (Contributed by
Victor Stinner in [bpo\-8513](https://bugs.python.org/issue?@action=redirect&bpo=8513).)

A new constant [`DEVNULL`](../library/subprocess.html#subprocess.DEVNULL "subprocess.DEVNULL") allows suppressing output in a
platform\-independent fashion. (Contributed by Ross Lagerwall in
[bpo\-5870](https://bugs.python.org/issue?@action=redirect&bpo=5870).)

### sys[¶](#sys "Link to this heading")

The [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") module has a new [`thread_info`](../library/sys.html#sys.thread_info "sys.thread_info") [named
tuple](../glossary.html#term-named-tuple) holding information about the thread implementation
([bpo\-11223](https://bugs.python.org/issue?@action=redirect&bpo=11223)).

### tarfile[¶](#tarfile "Link to this heading")

[`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") now supports `lzma` encoding via the [`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library.") module.
(Contributed by Lars Gustäbel in [bpo\-5689](https://bugs.python.org/issue?@action=redirect&bpo=5689).)

### tempfile[¶](#tempfile "Link to this heading")

[`tempfile.SpooledTemporaryFile`](../library/tempfile.html#tempfile.SpooledTemporaryFile "tempfile.SpooledTemporaryFile")'s
`truncate()` method now accepts
a `size` parameter. (Contributed by Ryan Kelly in [bpo\-9957](https://bugs.python.org/issue?@action=redirect&bpo=9957).)

### textwrap[¶](#textwrap "Link to this heading")

The [`textwrap`](../library/textwrap.html#module-textwrap "textwrap: Text wrapping and filling") module has a new [`indent()`](../library/textwrap.html#textwrap.indent "textwrap.indent") that makes
it straightforward to add a common prefix to selected lines in a block
of text ([bpo\-13857](https://bugs.python.org/issue?@action=redirect&bpo=13857)).

### threading[¶](#threading "Link to this heading")

[`threading.Condition`](../library/threading.html#threading.Condition "threading.Condition"), [`threading.Semaphore`](../library/threading.html#threading.Semaphore "threading.Semaphore"),
[`threading.BoundedSemaphore`](../library/threading.html#threading.BoundedSemaphore "threading.BoundedSemaphore"), [`threading.Event`](../library/threading.html#threading.Event "threading.Event"), and
[`threading.Timer`](../library/threading.html#threading.Timer "threading.Timer"), all of which used to be factory functions returning a
class instance, are now classes and may be subclassed. (Contributed by Éric
Araujo in [bpo\-10968](https://bugs.python.org/issue?@action=redirect&bpo=10968).)

The [`threading.Thread`](../library/threading.html#threading.Thread "threading.Thread") constructor now accepts a `daemon` keyword
argument to override the default behavior of inheriting the `daemon` flag
value from the parent thread ([bpo\-6064](https://bugs.python.org/issue?@action=redirect&bpo=6064)).

The formerly private function `_thread.get_ident` is now available as the
public function [`threading.get_ident()`](../library/threading.html#threading.get_ident "threading.get_ident"). This eliminates several cases of
direct access to the `_thread` module in the stdlib. Third party code that
used `_thread.get_ident` should likewise be changed to use the new public
interface.

### time[¶](#time "Link to this heading")

The [**PEP 418**](https://peps.python.org/pep-0418/) added new functions to the [`time`](../library/time.html#module-time "time: Time access and conversions.") module:

* [`get_clock_info()`](../library/time.html#time.get_clock_info "time.get_clock_info"): Get information on a clock.
* [`monotonic()`](../library/time.html#time.monotonic "time.monotonic"): Monotonic clock (cannot go backward), not affected
by system clock updates.
* [`perf_counter()`](../library/time.html#time.perf_counter "time.perf_counter"): Performance counter with the highest available
resolution to measure a short duration.
* [`process_time()`](../library/time.html#time.process_time "time.process_time"): Sum of the system and user CPU time of the
current process.

Other new functions:

* [`clock_getres()`](../library/time.html#time.clock_getres "time.clock_getres"), [`clock_gettime()`](../library/time.html#time.clock_gettime "time.clock_gettime") and
[`clock_settime()`](../library/time.html#time.clock_settime "time.clock_settime") functions with `CLOCK_xxx` constants.
(Contributed by Victor Stinner in [bpo\-10278](https://bugs.python.org/issue?@action=redirect&bpo=10278).)

To improve cross platform consistency, [`sleep()`](../library/time.html#time.sleep "time.sleep") now raises a
[`ValueError`](../library/exceptions.html#ValueError "ValueError") when passed a negative sleep value. Previously this was an
error on posix, but produced an infinite sleep on Windows.

### types[¶](#types "Link to this heading")

Add a new [`types.MappingProxyType`](../library/types.html#types.MappingProxyType "types.MappingProxyType") class: Read\-only proxy of a mapping.
([bpo\-14386](https://bugs.python.org/issue?@action=redirect&bpo=14386))

The new functions [`types.new_class()`](../library/types.html#types.new_class "types.new_class") and [`types.prepare_class()`](../library/types.html#types.prepare_class "types.prepare_class") provide support
for [**PEP 3115**](https://peps.python.org/pep-3115/) compliant dynamic type creation. ([bpo\-14588](https://bugs.python.org/issue?@action=redirect&bpo=14588))

### unittest[¶](#unittest "Link to this heading")

[`assertRaises()`](../library/unittest.html#unittest.TestCase.assertRaises "unittest.TestCase.assertRaises"), [`assertRaisesRegex()`](../library/unittest.html#unittest.TestCase.assertRaisesRegex "unittest.TestCase.assertRaisesRegex"), [`assertWarns()`](../library/unittest.html#unittest.TestCase.assertWarns "unittest.TestCase.assertWarns"), and
[`assertWarnsRegex()`](../library/unittest.html#unittest.TestCase.assertWarnsRegex "unittest.TestCase.assertWarnsRegex") now accept a keyword argument *msg* when used as
context managers. (Contributed by Ezio Melotti and Winston Ewert in
[bpo\-10775](https://bugs.python.org/issue?@action=redirect&bpo=10775).)

[`unittest.TestCase.run()`](../library/unittest.html#unittest.TestCase.run "unittest.TestCase.run") now returns the [`TestResult`](../library/unittest.html#unittest.TestResult "unittest.TestResult")
object.

### urllib[¶](#urllib "Link to this heading")

The [`Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request") class, now accepts a *method* argument
used by [`get_method()`](../library/urllib.request.html#urllib.request.Request.get_method "urllib.request.Request.get_method") to determine what HTTP method
should be used. For example, this will send a `'HEAD'` request:

\`\`\`
\>\>\> urlopen(Request('https://www.python.org', method='HEAD'))

\`\`\`

([bpo\-1673007](https://bugs.python.org/issue?@action=redirect&bpo=1673007))

### webbrowser[¶](#webbrowser "Link to this heading")

The [`webbrowser`](../library/webbrowser.html#module-webbrowser "webbrowser: Easy-to-use controller for web browsers.") module supports more “browsers”: Google Chrome (named
**chrome**, **chromium**, **chrome\-browser** or
**chromium\-browser** depending on the version and operating system),
and the generic launchers **xdg\-open**, from the FreeDesktop.org
project, and **gvfs\-open**, which is the default URI handler for GNOME
3\. (The former contributed by Arnaud Calmettes in [bpo\-13620](https://bugs.python.org/issue?@action=redirect&bpo=13620), the latter
by Matthias Klose in [bpo\-14493](https://bugs.python.org/issue?@action=redirect&bpo=14493).)

### xml.etree.ElementTree[¶](#xml-etree-elementtree "Link to this heading")

The [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") module now imports its C accelerator by
default; there is no longer a need to explicitly import
`xml.etree.cElementTree` (this module stays for backwards compatibility,
but is now deprecated). In addition, the `iter` family of methods of
[`Element`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element "xml.etree.ElementTree.Element") has been optimized (rewritten in C).
The module’s documentation has also been greatly improved with added examples
and a more detailed reference.

### zlib[¶](#zlib "Link to this heading")

New attribute [`zlib.Decompress.eof`](../library/zlib.html#zlib.Decompress.eof "zlib.Decompress.eof") makes it possible to distinguish
between a properly formed compressed stream and an incomplete or truncated one.
(Contributed by Nadeem Vawda in [bpo\-12646](https://bugs.python.org/issue?@action=redirect&bpo=12646).)

New attribute [`zlib.ZLIB_RUNTIME_VERSION`](../library/zlib.html#zlib.ZLIB_RUNTIME_VERSION "zlib.ZLIB_RUNTIME_VERSION") reports the version string of
the underlying `zlib` library that is loaded at runtime. (Contributed by
Torsten Landschoff in [bpo\-12306](https://bugs.python.org/issue?@action=redirect&bpo=12306).)

## Optimizations[¶](#optimizations "Link to this heading")

Major performance enhancements have been added:

* Thanks to [**PEP 393**](https://peps.python.org/pep-0393/), some operations on Unicode strings have been optimized:

	+ the memory footprint is divided by 2 to 4 depending on the text
	+ encode an ASCII string to UTF\-8 doesn’t need to encode characters anymore,
	the UTF\-8 representation is shared with the ASCII representation
	+ the UTF\-8 encoder has been optimized
	+ repeating a single ASCII letter and getting a substring of an ASCII string
	is 4 times faster
* UTF\-8 is now 2x to 4x faster. UTF\-16 encoding is now up to 10x faster.

(Contributed by Serhiy Storchaka, [bpo\-14624](https://bugs.python.org/issue?@action=redirect&bpo=14624), [bpo\-14738](https://bugs.python.org/issue?@action=redirect&bpo=14738) and
[bpo\-15026](https://bugs.python.org/issue?@action=redirect&bpo=15026).)

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

Changes to Python’s build process and to the C API include:

* New [**PEP 3118**](https://peps.python.org/pep-3118/) related function:

	+ [`PyMemoryView_FromMemory()`](../c-api/memoryview.html#c.PyMemoryView_FromMemory "PyMemoryView_FromMemory")
* [**PEP 393**](https://peps.python.org/pep-0393/) added new Unicode types, macros and functions:

	+ High\-level API:

		- [`PyUnicode_CopyCharacters()`](../c-api/unicode.html#c.PyUnicode_CopyCharacters "PyUnicode_CopyCharacters")
		- [`PyUnicode_FindChar()`](../c-api/unicode.html#c.PyUnicode_FindChar "PyUnicode_FindChar")
		- [`PyUnicode_GetLength()`](../c-api/unicode.html#c.PyUnicode_GetLength "PyUnicode_GetLength"), [`PyUnicode_GET_LENGTH`](../c-api/unicode.html#c.PyUnicode_GET_LENGTH "PyUnicode_GET_LENGTH")
		- [`PyUnicode_New()`](../c-api/unicode.html#c.PyUnicode_New "PyUnicode_New")
		- [`PyUnicode_Substring()`](../c-api/unicode.html#c.PyUnicode_Substring "PyUnicode_Substring")
		- [`PyUnicode_ReadChar()`](../c-api/unicode.html#c.PyUnicode_ReadChar "PyUnicode_ReadChar"), [`PyUnicode_WriteChar()`](../c-api/unicode.html#c.PyUnicode_WriteChar "PyUnicode_WriteChar")
	+ Low\-level API:

		- [`Py_UCS1`](../c-api/unicode.html#c.Py_UCS1 "Py_UCS1"), [`Py_UCS2`](../c-api/unicode.html#c.Py_UCS2 "Py_UCS2"), [`Py_UCS4`](../c-api/unicode.html#c.Py_UCS4 "Py_UCS4") types
		- [`PyASCIIObject`](../c-api/unicode.html#c.PyASCIIObject "PyASCIIObject") and [`PyCompactUnicodeObject`](../c-api/unicode.html#c.PyCompactUnicodeObject "PyCompactUnicodeObject") structures
		- [`PyUnicode_READY`](../c-api/unicode.html#c.PyUnicode_READY "PyUnicode_READY")
		- [`PyUnicode_FromKindAndData()`](../c-api/unicode.html#c.PyUnicode_FromKindAndData "PyUnicode_FromKindAndData")
		- [`PyUnicode_AsUCS4()`](../c-api/unicode.html#c.PyUnicode_AsUCS4 "PyUnicode_AsUCS4"), [`PyUnicode_AsUCS4Copy()`](../c-api/unicode.html#c.PyUnicode_AsUCS4Copy "PyUnicode_AsUCS4Copy")
		- [`PyUnicode_DATA`](../c-api/unicode.html#c.PyUnicode_DATA "PyUnicode_DATA"), [`PyUnicode_1BYTE_DATA`](../c-api/unicode.html#c.PyUnicode_1BYTE_DATA "PyUnicode_1BYTE_DATA"),
		[`PyUnicode_2BYTE_DATA`](../c-api/unicode.html#c.PyUnicode_2BYTE_DATA "PyUnicode_2BYTE_DATA"), [`PyUnicode_4BYTE_DATA`](../c-api/unicode.html#c.PyUnicode_4BYTE_DATA "PyUnicode_4BYTE_DATA")
		- [`PyUnicode_KIND`](../c-api/unicode.html#c.PyUnicode_KIND "PyUnicode_KIND") with `PyUnicode_Kind` enum:
		`PyUnicode_WCHAR_KIND`, [`PyUnicode_1BYTE_KIND`](../c-api/unicode.html#c.PyUnicode_1BYTE_KIND "PyUnicode_1BYTE_KIND"),
		[`PyUnicode_2BYTE_KIND`](../c-api/unicode.html#c.PyUnicode_2BYTE_KIND "PyUnicode_2BYTE_KIND"), [`PyUnicode_4BYTE_KIND`](../c-api/unicode.html#c.PyUnicode_4BYTE_KIND "PyUnicode_4BYTE_KIND")
		- [`PyUnicode_READ`](../c-api/unicode.html#c.PyUnicode_READ "PyUnicode_READ"), [`PyUnicode_READ_CHAR`](../c-api/unicode.html#c.PyUnicode_READ_CHAR "PyUnicode_READ_CHAR"), [`PyUnicode_WRITE`](../c-api/unicode.html#c.PyUnicode_WRITE "PyUnicode_WRITE")
		- [`PyUnicode_MAX_CHAR_VALUE`](../c-api/unicode.html#c.PyUnicode_MAX_CHAR_VALUE "PyUnicode_MAX_CHAR_VALUE")
* [`PyArg_ParseTuple`](../c-api/arg.html#c.PyArg_ParseTuple "PyArg_ParseTuple") now accepts a [`bytearray`](../library/stdtypes.html#bytearray "bytearray") for the `c`
format ([bpo\-12380](https://bugs.python.org/issue?@action=redirect&bpo=12380)).

## Deprecated[¶](#deprecated "Link to this heading")

### Unsupported Operating Systems[¶](#unsupported-operating-systems "Link to this heading")

OS/2 and VMS are no longer supported due to the lack of a maintainer.

Windows 2000 and Windows platforms which set `COMSPEC` to `command.com`
are no longer supported due to maintenance burden.

OSF support, which was deprecated in 3\.2, has been completely removed.

### Deprecated Python modules, functions and methods[¶](#deprecated-python-modules-functions-and-methods "Link to this heading")

* Passing a non\-empty string to `object.__format__()` is deprecated, and
will produce a [`TypeError`](../library/exceptions.html#TypeError "TypeError") in Python 3\.4 ([bpo\-9856](https://bugs.python.org/issue?@action=redirect&bpo=9856)).
* The `unicode_internal` codec has been deprecated because of the
[**PEP 393**](https://peps.python.org/pep-0393/), use UTF\-8, UTF\-16 (`utf-16-le` or `utf-16-be`), or UTF\-32
(`utf-32-le` or `utf-32-be`)
* [`ftplib.FTP.nlst()`](../library/ftplib.html#ftplib.FTP.nlst "ftplib.FTP.nlst") and [`ftplib.FTP.dir()`](../library/ftplib.html#ftplib.FTP.dir "ftplib.FTP.dir"): use
[`ftplib.FTP.mlsd()`](../library/ftplib.html#ftplib.FTP.mlsd "ftplib.FTP.mlsd")
* `platform.popen()`: use the [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") module. Check especially
the [Replacing Older Functions with the subprocess Module](../library/subprocess.html#subprocess-replacements) section ([bpo\-11377](https://bugs.python.org/issue?@action=redirect&bpo=11377)).
* [bpo\-13374](https://bugs.python.org/issue?@action=redirect&bpo=13374): The Windows bytes API has been deprecated in the [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.")
module. Use Unicode filenames, instead of bytes filenames, to not depend on
the ANSI code page anymore and to support any filename.
* [bpo\-13988](https://bugs.python.org/issue?@action=redirect&bpo=13988): The `xml.etree.cElementTree` module is deprecated. The
accelerator is used automatically whenever available.
* The behaviour of `time.clock()` depends on the platform: use the new
[`time.perf_counter()`](../library/time.html#time.perf_counter "time.perf_counter") or [`time.process_time()`](../library/time.html#time.process_time "time.process_time") function instead,
depending on your requirements, to have a well defined behaviour.
* The `os.stat_float_times()` function is deprecated.
* [`abc`](../library/abc.html#module-abc "abc: Abstract base classes according to :pep:`3119`.") module:

	+ [`abc.abstractproperty`](../library/abc.html#abc.abstractproperty "abc.abstractproperty") has been deprecated, use [`property`](../library/functions.html#property "property")
	with [`abc.abstractmethod()`](../library/abc.html#abc.abstractmethod "abc.abstractmethod") instead.
	+ [`abc.abstractclassmethod`](../library/abc.html#abc.abstractclassmethod "abc.abstractclassmethod") has been deprecated, use
	[`classmethod`](../library/functions.html#classmethod "classmethod") with [`abc.abstractmethod()`](../library/abc.html#abc.abstractmethod "abc.abstractmethod") instead.
	+ [`abc.abstractstaticmethod`](../library/abc.html#abc.abstractstaticmethod "abc.abstractstaticmethod") has been deprecated, use
	[`staticmethod`](../library/functions.html#staticmethod "staticmethod") with [`abc.abstractmethod()`](../library/abc.html#abc.abstractmethod "abc.abstractmethod") instead.
* [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") package:

	+ [`importlib.abc.SourceLoader.path_mtime()`](../library/importlib.html#importlib.abc.SourceLoader.path_mtime "importlib.abc.SourceLoader.path_mtime") is now deprecated in favour of
	[`importlib.abc.SourceLoader.path_stats()`](../library/importlib.html#importlib.abc.SourceLoader.path_stats "importlib.abc.SourceLoader.path_stats") as bytecode files now store
	both the modification time and size of the source file the bytecode file was
	compiled from.

### Deprecated functions and types of the C API[¶](#deprecated-functions-and-types-of-the-c-api "Link to this heading")

The [`Py_UNICODE`](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE") has been deprecated by [**PEP 393**](https://peps.python.org/pep-0393/) and will be
removed in Python 4\. All functions using this type are deprecated:

Unicode functions and methods using [`Py_UNICODE`](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE") and
[Py\_UNICODE](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE")\* types:

* `PyUnicode_FromUnicode`: use [`PyUnicode_FromWideChar()`](../c-api/unicode.html#c.PyUnicode_FromWideChar "PyUnicode_FromWideChar") or
[`PyUnicode_FromKindAndData()`](../c-api/unicode.html#c.PyUnicode_FromKindAndData "PyUnicode_FromKindAndData")
* `PyUnicode_AS_UNICODE`, `PyUnicode_AsUnicode()`,
`PyUnicode_AsUnicodeAndSize()`: use [`PyUnicode_AsWideCharString()`](../c-api/unicode.html#c.PyUnicode_AsWideCharString "PyUnicode_AsWideCharString")
* `PyUnicode_AS_DATA`: use [`PyUnicode_DATA`](../c-api/unicode.html#c.PyUnicode_DATA "PyUnicode_DATA") with
[`PyUnicode_READ`](../c-api/unicode.html#c.PyUnicode_READ "PyUnicode_READ") and [`PyUnicode_WRITE`](../c-api/unicode.html#c.PyUnicode_WRITE "PyUnicode_WRITE")
* `PyUnicode_GET_SIZE`, `PyUnicode_GetSize()`: use
[`PyUnicode_GET_LENGTH`](../c-api/unicode.html#c.PyUnicode_GET_LENGTH "PyUnicode_GET_LENGTH") or [`PyUnicode_GetLength()`](../c-api/unicode.html#c.PyUnicode_GetLength "PyUnicode_GetLength")
* `PyUnicode_GET_DATA_SIZE`: use
`PyUnicode_GET_LENGTH(str) * PyUnicode_KIND(str)` (only work on ready
strings)
* `PyUnicode_AsUnicodeCopy()`: use [`PyUnicode_AsUCS4Copy()`](../c-api/unicode.html#c.PyUnicode_AsUCS4Copy "PyUnicode_AsUCS4Copy") or
[`PyUnicode_AsWideCharString()`](../c-api/unicode.html#c.PyUnicode_AsWideCharString "PyUnicode_AsWideCharString")
* `PyUnicode_GetMax()`

Functions and macros manipulating Py\_UNICODE\* strings:

* `Py_UNICODE_strlen()`: use [`PyUnicode_GetLength()`](../c-api/unicode.html#c.PyUnicode_GetLength "PyUnicode_GetLength") or
[`PyUnicode_GET_LENGTH`](../c-api/unicode.html#c.PyUnicode_GET_LENGTH "PyUnicode_GET_LENGTH")
* `Py_UNICODE_strcat()`: use [`PyUnicode_CopyCharacters()`](../c-api/unicode.html#c.PyUnicode_CopyCharacters "PyUnicode_CopyCharacters") or
[`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat")
* `Py_UNICODE_strcpy()`, `Py_UNICODE_strncpy()`,
`Py_UNICODE_COPY()`: use [`PyUnicode_CopyCharacters()`](../c-api/unicode.html#c.PyUnicode_CopyCharacters "PyUnicode_CopyCharacters") or
[`PyUnicode_Substring()`](../c-api/unicode.html#c.PyUnicode_Substring "PyUnicode_Substring")
* `Py_UNICODE_strcmp()`: use [`PyUnicode_Compare()`](../c-api/unicode.html#c.PyUnicode_Compare "PyUnicode_Compare")
* `Py_UNICODE_strncmp()`: use [`PyUnicode_Tailmatch()`](../c-api/unicode.html#c.PyUnicode_Tailmatch "PyUnicode_Tailmatch")
* `Py_UNICODE_strchr()`, `Py_UNICODE_strrchr()`: use
[`PyUnicode_FindChar()`](../c-api/unicode.html#c.PyUnicode_FindChar "PyUnicode_FindChar")
* `Py_UNICODE_FILL()`: use [`PyUnicode_Fill()`](../c-api/unicode.html#c.PyUnicode_Fill "PyUnicode_Fill")
* `Py_UNICODE_MATCH`

Encoders:

* `PyUnicode_Encode()`: use `PyUnicode_AsEncodedObject()`
* `PyUnicode_EncodeUTF7()`
* `PyUnicode_EncodeUTF8()`: use [`PyUnicode_AsUTF8()`](../c-api/unicode.html#c.PyUnicode_AsUTF8 "PyUnicode_AsUTF8") or
[`PyUnicode_AsUTF8String()`](../c-api/unicode.html#c.PyUnicode_AsUTF8String "PyUnicode_AsUTF8String")
* `PyUnicode_EncodeUTF32()`
* `PyUnicode_EncodeUTF16()`
* `PyUnicode_EncodeUnicodeEscape()` use
[`PyUnicode_AsUnicodeEscapeString()`](../c-api/unicode.html#c.PyUnicode_AsUnicodeEscapeString "PyUnicode_AsUnicodeEscapeString")
* `PyUnicode_EncodeRawUnicodeEscape()` use
[`PyUnicode_AsRawUnicodeEscapeString()`](../c-api/unicode.html#c.PyUnicode_AsRawUnicodeEscapeString "PyUnicode_AsRawUnicodeEscapeString")
* `PyUnicode_EncodeLatin1()`: use [`PyUnicode_AsLatin1String()`](../c-api/unicode.html#c.PyUnicode_AsLatin1String "PyUnicode_AsLatin1String")
* `PyUnicode_EncodeASCII()`: use [`PyUnicode_AsASCIIString()`](../c-api/unicode.html#c.PyUnicode_AsASCIIString "PyUnicode_AsASCIIString")
* `PyUnicode_EncodeCharmap()`
* `PyUnicode_TranslateCharmap()`
* `PyUnicode_EncodeMBCS()`: use [`PyUnicode_AsMBCSString()`](../c-api/unicode.html#c.PyUnicode_AsMBCSString "PyUnicode_AsMBCSString") or
[`PyUnicode_EncodeCodePage()`](../c-api/unicode.html#c.PyUnicode_EncodeCodePage "PyUnicode_EncodeCodePage") (with `CP_ACP` code\_page)
* `PyUnicode_EncodeDecimal()`,
`PyUnicode_TransformDecimalToASCII()`

### Deprecated features[¶](#deprecated-features "Link to this heading")

The [`array`](../library/array.html#module-array "array: Space efficient arrays of uniformly typed numeric values.") module’s `'u'` format code is now deprecated and will be
removed in Python 4 together with the rest of the ([`Py_UNICODE`](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE")) API.

## Porting to Python 3\.3[¶](#porting-to-python-3-3 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Porting Python code[¶](#porting-python-code "Link to this heading")

* Hash randomization is enabled by default. Set the [`PYTHONHASHSEED`](../using/cmdline.html#envvar-PYTHONHASHSEED)
environment variable to `0` to disable hash randomization. See also the
[`object.__hash__()`](../reference/datamodel.html#object.__hash__ "object.__hash__") method.
* [bpo\-12326](https://bugs.python.org/issue?@action=redirect&bpo=12326): On Linux, sys.platform doesn’t contain the major version
anymore. It is now always ‘linux’, instead of ‘linux2’ or ‘linux3’ depending
on the Linux version used to build Python. Replace sys.platform == ‘linux2’
with sys.platform.startswith(‘linux’), or directly sys.platform == ‘linux’ if
you don’t need to support older Python versions.
* [bpo\-13847](https://bugs.python.org/issue?@action=redirect&bpo=13847), [bpo\-14180](https://bugs.python.org/issue?@action=redirect&bpo=14180): [`time`](../library/time.html#module-time "time: Time access and conversions.") and [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types."):
[`OverflowError`](../library/exceptions.html#OverflowError "OverflowError") is now raised instead of [`ValueError`](../library/exceptions.html#ValueError "ValueError") if a
timestamp is out of range. [`OSError`](../library/exceptions.html#OSError "OSError") is now raised if C functions
`gmtime()` or `localtime()` failed.
* The default finders used by import now utilize a cache of what is contained
within a specific directory. If you create a Python source file or sourceless
bytecode file, make sure to call [`importlib.invalidate_caches()`](../library/importlib.html#importlib.invalidate_caches "importlib.invalidate_caches") to clear
out the cache for the finders to notice the new file.
* [`ImportError`](../library/exceptions.html#ImportError "ImportError") now uses the full name of the module that was attempted to
be imported. Doctests that check ImportErrors’ message will need to be
updated to use the full name of the module instead of just the tail of the
name.
* The *index* argument to [`__import__()`](../library/functions.html#import__ "__import__") now defaults to 0 instead of \-1
and no longer support negative values. It was an oversight when [**PEP 328**](https://peps.python.org/pep-0328/) was
implemented that the default value remained \-1\. If you need to continue to
perform a relative import followed by an absolute import, then perform the
relative import using an index of 1, followed by another import using an
index of 0\. It is preferred, though, that you use
[`importlib.import_module()`](../library/importlib.html#importlib.import_module "importlib.import_module") rather than call [`__import__()`](../library/functions.html#import__ "__import__") directly.
* [`__import__()`](../library/functions.html#import__ "__import__") no longer allows one to use an index value other than 0
for top\-level modules. E.g. `__import__('sys', level=1)` is now an error.
* Because [`sys.meta_path`](../library/sys.html#sys.meta_path "sys.meta_path") and [`sys.path_hooks`](../library/sys.html#sys.path_hooks "sys.path_hooks") now have finders on
them by default, you will most likely want to use `list.insert()` instead
of `list.append()` to add to those lists.
* Because `None` is now inserted into [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache"), if you
are clearing out entries in the dictionary of paths that do not have a
finder, you will need to remove keys paired with values of `None` **and**
`imp.NullImporter` to be backwards\-compatible. This will lead to extra
overhead on older versions of Python that re\-insert `None` into
[`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") where it represents the use of implicit
finders, but semantically it should not change anything.
* `importlib.abc.Finder` no longer specifies a `find_module()` abstract
method that must be implemented. If you were relying on subclasses to
implement that method, make sure to check for the method’s existence first.
You will probably want to check for `find_loader()` first, though, in the
case of working with [path entry finders](../glossary.html#term-path-entry-finder).
* [`pkgutil`](../library/pkgutil.html#module-pkgutil "pkgutil: Utilities for the import system.") has been converted to use [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") internally. This
eliminates many edge cases where the old behaviour of the [**PEP 302**](https://peps.python.org/pep-0302/) import
emulation failed to match the behaviour of the real import system. The
import emulation itself is still present, but is now deprecated. The
[`pkgutil.iter_importers()`](../library/pkgutil.html#pkgutil.iter_importers "pkgutil.iter_importers") and [`pkgutil.walk_packages()`](../library/pkgutil.html#pkgutil.walk_packages "pkgutil.walk_packages") functions
special case the standard import hooks so they are still supported even
though they do not provide the non\-standard `iter_modules()` method.
* A longstanding RFC\-compliance bug ([bpo\-1079](https://bugs.python.org/issue?@action=redirect&bpo=1079)) in the parsing done by
[`email.header.decode_header()`](../library/email.header.html#email.header.decode_header "email.header.decode_header") has been fixed. Code that uses the
standard idiom to convert encoded headers into unicode
(`str(make_header(decode_header(h))`) will see no change, but code that
looks at the individual tuples returned by decode\_header will see that
whitespace that precedes or follows `ASCII` sections is now included in the
`ASCII` section. Code that builds headers using `make_header` should
also continue to work without change, since `make_header` continues to add
whitespace between `ASCII` and non\-`ASCII` sections if it is not already
present in the input strings.
* [`email.utils.formataddr()`](../library/email.utils.html#email.utils.formataddr "email.utils.formataddr") now does the correct content transfer
encoding when passed non\-`ASCII` display names. Any code that depended on
the previous buggy behavior that preserved the non\-`ASCII` unicode in the
formatted output string will need to be changed ([bpo\-1690608](https://bugs.python.org/issue?@action=redirect&bpo=1690608)).
* [`poplib.POP3.quit()`](../library/poplib.html#poplib.POP3.quit "poplib.POP3.quit") may now raise protocol errors like all other
`poplib` methods. Code that assumes `quit` does not raise
[`poplib.error_proto`](../library/poplib.html#poplib.error_proto "poplib.error_proto") errors may need to be changed if errors on `quit`
are encountered by a particular application ([bpo\-11291](https://bugs.python.org/issue?@action=redirect&bpo=11291)).
* The `strict` argument to [`email.parser.Parser`](../library/email.parser.html#email.parser.Parser "email.parser.Parser"), deprecated since
Python 2\.4, has finally been removed.
* The deprecated method `unittest.TestCase.assertSameElements` has been
removed.
* The deprecated variable `time.accept2dyear` has been removed.
* The deprecated `Context._clamp` attribute has been removed from the
[`decimal`](../library/decimal.html#module-decimal "decimal: Implementation of the General Decimal Arithmetic  Specification.") module. It was previously replaced by the public attribute
`clamp`. (See [bpo\-8540](https://bugs.python.org/issue?@action=redirect&bpo=8540).)
* The undocumented internal helper class `SSLFakeFile` has been removed
from [`smtplib`](../library/smtplib.html#module-smtplib "smtplib: SMTP protocol client (requires sockets)."), since its functionality has long been provided directly
by [`socket.socket.makefile()`](../library/socket.html#socket.socket.makefile "socket.socket.makefile").
* Passing a negative value to [`time.sleep()`](../library/time.html#time.sleep "time.sleep") on Windows now raises an
error instead of sleeping forever. It has always raised an error on posix.
* The `ast.__version__` constant has been removed. If you need to
make decisions affected by the AST version, use [`sys.version_info`](../library/sys.html#sys.version_info "sys.version_info")
to make the decision.
* Code that used to work around the fact that the [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") module used
factory functions by subclassing the private classes will need to change to
subclass the now\-public classes.
* The undocumented debugging machinery in the threading module has been
removed, simplifying the code. This should have no effect on production
code, but is mentioned here in case any application debug frameworks were
interacting with it ([bpo\-13550](https://bugs.python.org/issue?@action=redirect&bpo=13550)).

### Porting C code[¶](#porting-c-code "Link to this heading")

* In the course of changes to the buffer API the undocumented
`smalltable` member of the
[`Py_buffer`](../c-api/buffer.html#c.Py_buffer "Py_buffer") structure has been removed and the
layout of the `PyMemoryViewObject` has changed.

All extensions relying on the relevant parts in `memoryobject.h`
or `object.h` must be rebuilt.
* Due to [PEP 393](#pep-393), the [`Py_UNICODE`](../c-api/unicode.html#c.Py_UNICODE "Py_UNICODE") type and all
functions using this type are deprecated (but will stay available for
at least five years). If you were using low\-level Unicode APIs to
construct and access unicode objects and you want to benefit of the
memory footprint reduction provided by [**PEP 393**](https://peps.python.org/pep-0393/), you have to convert
your code to the new [Unicode API](../c-api/unicode.html).

However, if you only have been using high\-level functions such as
[`PyUnicode_Concat()`](../c-api/unicode.html#c.PyUnicode_Concat "PyUnicode_Concat"), [`PyUnicode_Join()`](../c-api/unicode.html#c.PyUnicode_Join "PyUnicode_Join") or
[`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat"), your code will automatically take
advantage of the new unicode representations.
* [`PyImport_GetMagicNumber()`](../c-api/import.html#c.PyImport_GetMagicNumber "PyImport_GetMagicNumber") now returns `-1` upon failure.
* As a negative value for the *level* argument to [`__import__()`](../library/functions.html#import__ "__import__") is no
longer valid, the same now holds for [`PyImport_ImportModuleLevel()`](../c-api/import.html#c.PyImport_ImportModuleLevel "PyImport_ImportModuleLevel").
This also means that the value of *level* used by
[`PyImport_ImportModuleEx()`](../c-api/import.html#c.PyImport_ImportModuleEx "PyImport_ImportModuleEx") is now `0` instead of `-1`.

### Building C extensions[¶](#building-c-extensions "Link to this heading")

* The range of possible file names for C extensions has been narrowed.
Very rarely used spellings have been suppressed: under POSIX, files
named `xxxmodule.so`, `xxxmodule.abi3.so` and
`xxxmodule.cpython-*.so` are no longer recognized as implementing
the `xxx` module. If you had been generating such files, you have
to switch to the other spellings (i.e., remove the `module` string
from the file names).

(implemented in [bpo\-14040](https://bugs.python.org/issue?@action=redirect&bpo=14040).)

### Command Line Switch Changes[¶](#command-line-switch-changes "Link to this heading")

* The \-Q command\-line flag and related artifacts have been removed. Code
checking sys.flags.division\_warning will need updating.

([bpo\-10998](https://bugs.python.org/issue?@action=redirect&bpo=10998), contributed by Éric Araujo.)
* When **python** is started with [`-S`](../using/cmdline.html#cmdoption-S), `import site`
will no longer add site\-specific paths to the module search paths. In
previous versions, it did.

([bpo\-11591](https://bugs.python.org/issue?@action=redirect&bpo=11591), contributed by Carl Meyer with editions by Éric Araujo.)

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.3](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [PEP 405: Virtual Environments](#pep-405-virtual-environments)
	+ [PEP 420: Implicit Namespace Packages](#pep-420-implicit-namespace-packages)
	+ [PEP 3118: New memoryview implementation and buffer protocol documentation](#pep-3118-new-memoryview-implementation-and-buffer-protocol-documentation)
		- [Features](#features)
		- [API changes](#api-changes)
	+ [PEP 393: Flexible String Representation](#pep-393-flexible-string-representation)
		- [Functionality](#functionality)
		- [Performance and resource usage](#performance-and-resource-usage)
	+ [PEP 397: Python Launcher for Windows](#pep-397-python-launcher-for-windows)
	+ [PEP 3151: Reworking the OS and IO exception hierarchy](#pep-3151-reworking-the-os-and-io-exception-hierarchy)
	+ [PEP 380: Syntax for Delegating to a Subgenerator](#pep-380-syntax-for-delegating-to-a-subgenerator)
	+ [PEP 409: Suppressing exception context](#pep-409-suppressing-exception-context)
	+ [PEP 414: Explicit Unicode literals](#pep-414-explicit-unicode-literals)
	+ [PEP 3155: Qualified name for classes and functions](#pep-3155-qualified-name-for-classes-and-functions)
	+ [PEP 412: Key\-Sharing Dictionary](#pep-412-key-sharing-dictionary)
	+ [PEP 362: Function Signature Object](#pep-362-function-signature-object)
	+ [PEP 421: Adding sys.implementation](#pep-421-adding-sys-implementation)
		- [SimpleNamespace](#simplenamespace)
	+ [Using importlib as the Implementation of Import](#using-importlib-as-the-implementation-of-import)
		- [New APIs](#new-apis)
		- [Visible Changes](#visible-changes)
	+ [Other Language Changes](#other-language-changes)
	+ [A Finer\-Grained Import Lock](#a-finer-grained-import-lock)
	+ [Builtin functions and types](#builtin-functions-and-types)
	+ [New Modules](#new-modules)
		- [faulthandler](#faulthandler)
		- [ipaddress](#ipaddress)
		- [lzma](#lzma)
	+ [Improved Modules](#improved-modules)
		- [abc](#abc)
		- [array](#array)
		- [base64](#base64)
		- [binascii](#binascii)
		- [bz2](#bz2)
		- [codecs](#codecs)
		- [collections](#collections)
		- [contextlib](#contextlib)
		- [crypt](#crypt)
		- [curses](#curses)
		- [datetime](#datetime)
		- [decimal](#decimal)
			* [Features](#id1)
			* [API changes](#id2)
		- [email](#email)
			* [Policy Framework](#policy-framework)
			* [Provisional Policy with New Header API](#provisional-policy-with-new-header-api)
			* [Other API Changes](#other-api-changes)
		- [ftplib](#ftplib)
		- [functools](#functools)
		- [gc](#gc)
		- [hmac](#hmac)
		- [http](#http)
		- [html](#html)
		- [imaplib](#imaplib)
		- [inspect](#inspect)
		- [io](#io)
		- [itertools](#itertools)
		- [logging](#logging)
		- [math](#math)
		- [mmap](#mmap)
		- [multiprocessing](#multiprocessing)
		- [nntplib](#nntplib)
		- [os](#os)
		- [pdb](#pdb)
		- [pickle](#pickle)
		- [pydoc](#pydoc)
		- [re](#re)
		- [sched](#sched)
		- [select](#select)
		- [shlex](#shlex)
		- [shutil](#shutil)
		- [signal](#signal)
		- [smtpd](#smtpd)
		- [smtplib](#smtplib)
		- [socket](#socket)
		- [socketserver](#socketserver)
		- [sqlite3](#sqlite3)
		- [ssl](#ssl)
		- [stat](#stat)
		- [struct](#struct)
		- [subprocess](#subprocess)
		- [sys](#sys)
		- [tarfile](#tarfile)
		- [tempfile](#tempfile)
		- [textwrap](#textwrap)
		- [threading](#threading)
		- [time](#time)
		- [types](#types)
		- [unittest](#unittest)
		- [urllib](#urllib)
		- [webbrowser](#webbrowser)
		- [xml.etree.ElementTree](#xml-etree-elementtree)
		- [zlib](#zlib)
	+ [Optimizations](#optimizations)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Deprecated](#deprecated)
		- [Unsupported Operating Systems](#unsupported-operating-systems)
		- [Deprecated Python modules, functions and methods](#deprecated-python-modules-functions-and-methods)
		- [Deprecated functions and types of the C API](#deprecated-functions-and-types-of-the-c-api)
		- [Deprecated features](#deprecated-features)
	+ [Porting to Python 3\.3](#porting-to-python-3-3)
		- [Porting Python code](#porting-python-code)
		- [Porting C code](#porting-c-code)
		- [Building C extensions](#building-c-extensions)
		- [Command Line Switch Changes](#command-line-switch-changes)

#### Previous topic

[What’s New In Python 3\.4](3.4.html "previous chapter")

#### Next topic

[What’s New In Python 3\.2](3.2.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.3.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.2.html "What’s New In Python 3.2") \|
* [previous](3.4.html "What’s New In Python 3.4") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.3
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.4 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.4.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.3.html "What’s New In Python 3.3") \|
* [previous](3.5.html "What’s New In Python 3.5") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.4
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.4[¶](#what-s-new-in-python-3-4 "Link to this heading")

Author:
R. David Murray \ (Editor)

This article explains the new features in Python 3\.4, compared to 3\.3\.
Python 3\.4 was released on March 16, 2014\. For full details, see the
[changelog](https://docs.python.org/3.4/whatsnew/changelog.html).

See also

[**PEP 429**](https://peps.python.org/pep-0429/) – Python 3\.4 Release Schedule

## Summary – Release Highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* No new syntax features were added in Python 3\.4\.

Other new features:

* [pip should always be available](#whatsnew-pep-453) ([**PEP 453**](https://peps.python.org/pep-0453/)).
* [Newly created file descriptors are non\-inheritable](#whatsnew-pep-446)
([**PEP 446**](https://peps.python.org/pep-0446/)).
* command line option for [isolated mode](#whatsnew-isolated-mode)
([bpo\-16499](https://bugs.python.org/issue?@action=redirect&bpo=16499)).
* [improvements in the handling of codecs](#codec-handling-improvements)
that are not text encodings (multiple issues).
* [A ModuleSpec Type](#whatsnew-pep-451) for the Import System
([**PEP 451**](https://peps.python.org/pep-0451/)). (Affects importer authors.)
* The [`marshal`](../library/marshal.html#module-marshal "marshal: Convert Python objects to streams of bytes and back (with different constraints).") format has been made [more compact and efficient](#whatsnew-marshal-3) ([bpo\-16475](https://bugs.python.org/issue?@action=redirect&bpo=16475)).

New library modules:

* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."): [New provisional API for asynchronous IO](#whatsnew-asyncio) ([**PEP 3156**](https://peps.python.org/pep-3156/)).
* [`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment."): [Bootstrapping the pip installer](#whatsnew-ensurepip)
([**PEP 453**](https://peps.python.org/pep-0453/)).
* [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class."): [Support for enumeration types](#whatsnew-enum)
([**PEP 435**](https://peps.python.org/pep-0435/)).
* [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths"): [Object\-oriented filesystem paths](#whatsnew-pathlib)
([**PEP 428**](https://peps.python.org/pep-0428/)).
* [`selectors`](../library/selectors.html#module-selectors "selectors: High-level I/O multiplexing."): [High\-level and efficient I/O multiplexing](#whatsnew-selectors), built upon the [`select`](../library/select.html#module-select "select: Wait for I/O completion on multiple streams.") module primitives (part
of [**PEP 3156**](https://peps.python.org/pep-3156/)).
* [`statistics`](../library/statistics.html#module-statistics "statistics: Mathematical statistics functions"): A basic [numerically stable statistics library](#whatsnew-statistics) ([**PEP 450**](https://peps.python.org/pep-0450/)).
* [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations."): [Trace Python memory allocations](#whatsnew-tracemalloc) ([**PEP 454**](https://peps.python.org/pep-0454/)).

Significantly improved library modules:

* [Single\-dispatch generic functions](#whatsnew-singledispatch) in
[`functools`](../library/functools.html#module-functools "functools: Higher-order functions and operations on callable objects.") ([**PEP 443**](https://peps.python.org/pep-0443/)).
* New [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") [protocol 4](#whatsnew-protocol-4) ([**PEP 3154**](https://peps.python.org/pep-3154/)).
* [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") now has [an option to avoid using os.fork
on Unix](#whatsnew-multiprocessing-no-fork) ([bpo\-8713](https://bugs.python.org/issue?@action=redirect&bpo=8713)).
* [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") has a new submodule, [`contentmanager`](../library/email.contentmanager.html#module-email.contentmanager "email.contentmanager: Storing and Retrieving Content from MIME Parts"), and
a new [`Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message") subclass
(`EmailMessage`) that [simplify MIME
handling](#whatsnew-email-contentmanager) ([bpo\-18891](https://bugs.python.org/issue?@action=redirect&bpo=18891)).
* The [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") and [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") modules are now capable of
correct introspection of a much wider variety of callable objects,
which improves the output of the Python [`help()`](../library/functions.html#help "help") system.
* The [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") module API has been declared stable

Security improvements:

* [Secure and interchangeable hash algorithm](#whatsnew-pep-456)
([**PEP 456**](https://peps.python.org/pep-0456/)).
* [Make newly created file descriptors non\-inheritable](#whatsnew-pep-446)
([**PEP 446**](https://peps.python.org/pep-0446/)) to avoid leaking file descriptors to child processes.
* New command line option for [isolated mode](#whatsnew-isolated-mode),
([bpo\-16499](https://bugs.python.org/issue?@action=redirect&bpo=16499)).
* [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") now has [an option to avoid using os.fork
on Unix](#whatsnew-multiprocessing-no-fork). *spawn* and *forkserver* are
more secure because they avoid sharing data with child processes.
* [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") child processes on Windows no longer inherit
all of the parent’s inheritable handles, only the necessary ones.
* A new [`hashlib.pbkdf2_hmac()`](../library/hashlib.html#hashlib.pbkdf2_hmac "hashlib.pbkdf2_hmac") function provides
the [PKCS\#5 password\-based key derivation function 2](https://en.wikipedia.org/wiki/PBKDF2).
* [TLSv1\.1 and TLSv1\.2 support](#whatsnew-tls-11-12) for [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects").
* [Retrieving certificates from the Windows system cert store support](#whatsnew34-win-cert-store) for [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects").
* [Server\-side SNI (Server Name Indication) support](#whatsnew34-sni) for [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects").
* The [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") class has a [lot of improvements](#whatsnew34-sslcontext).
* All modules in the standard library that support SSL now support server
certificate verification, including hostname matching
(`ssl.match_hostname()`) and CRLs (Certificate Revocation lists, see
[`ssl.SSLContext.load_verify_locations()`](../library/ssl.html#ssl.SSLContext.load_verify_locations "ssl.SSLContext.load_verify_locations")).

CPython implementation improvements:

* [Safe object finalization](#whatsnew-pep-442) ([**PEP 442**](https://peps.python.org/pep-0442/)).
* Leveraging [**PEP 442**](https://peps.python.org/pep-0442/), in most cases [module globals are no longer set
to None during finalization](#whatsnew-pep-442) ([bpo\-18214](https://bugs.python.org/issue?@action=redirect&bpo=18214)).
* [Configurable memory allocators](#whatsnew-pep-445) ([**PEP 445**](https://peps.python.org/pep-0445/)).
* [Argument Clinic](#whatsnew-pep-436) ([**PEP 436**](https://peps.python.org/pep-0436/)).

Please read on for a comprehensive list of user\-facing changes, including many
other smaller improvements, CPython optimizations, deprecations, and potential
porting issues.

## New Features[¶](#new-features "Link to this heading")

### PEP 453: Explicit Bootstrapping of PIP in Python Installations[¶](#pep-453-explicit-bootstrapping-of-pip-in-python-installations "Link to this heading")

#### Bootstrapping pip By Default[¶](#bootstrapping-pip-by-default "Link to this heading")

The new [`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment.") module (defined in [**PEP 453**](https://peps.python.org/pep-0453/)) provides a standard
cross\-platform mechanism to bootstrap the pip installer into Python
installations and virtual environments. The version of `pip` included
with Python 3\.4\.0 is `pip` 1\.5\.4, and future 3\.4\.x maintenance releases
will update the bundled version to the latest version of `pip` that is
available at the time of creating the release candidate.

By default, the commands `pipX` and `pipX.Y` will be installed on all
platforms (where X.Y stands for the version of the Python installation),
along with the `pip` Python package and its dependencies. On Windows and
in virtual environments on all platforms, the unversioned `pip` command
will also be installed. On other platforms, the system wide unversioned
`pip` command typically refers to the separately installed Python 2
version.

The `pyvenv` command line utility and the [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.")
module make use of the [`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment.") module to make `pip` readily
available in virtual environments. When using the command line utility,
`pip` is installed by default, while when using the [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") module
[API](../library/venv.html#venv-api) installation of `pip` must be requested explicitly.

For CPython [source builds on POSIX systems](../using/unix.html#building-python-on-unix),
the `make install` and `make altinstall` commands bootstrap `pip` by
default. This behaviour can be controlled through configure options, and
overridden through Makefile options.

On Windows and Mac OS X, the CPython installers now default to installing
`pip` along with CPython itself (users may opt out of installing it
during the installation process). Window users will need to opt in to the
automatic `PATH` modifications to have `pip` available from the command
line by default, otherwise it can still be accessed through the Python
launcher for Windows as `py -m pip`.

As [**discussed in the PEP**](https://peps.python.org/pep-0453/#recommendations-for-downstream-distributors)
platform packagers may choose not to install
these commands by default, as long as, when invoked, they provide clear and
simple directions on how to install them on that platform (usually using
the system package manager).

Note

To avoid conflicts between parallel Python 2 and Python 3 installations,
only the versioned `pip3` and `pip3.4` commands are bootstrapped by
default when `ensurepip` is invoked directly \- the `--default-pip`
option is needed to also request the unversioned `pip` command.
`pyvenv` and the Windows installer ensure that the unqualified `pip`
command is made available in those environments, and `pip` can always be
invoked via the `-m` switch rather than directly to avoid ambiguity on
systems with multiple Python installations.

#### Documentation Changes[¶](#documentation-changes "Link to this heading")

As part of this change, the [Installing Python Modules](../installing/index.html#installing-index) and
[Distributing Python Modules](../distributing/index.html#distributing-index) sections of the documentation have been
completely redesigned as short getting started and FAQ documents. Most
packaging documentation has now been moved out to the Python Packaging
Authority maintained [Python Packaging User Guide](https://packaging.python.org) and the documentation of the individual
projects.

However, as this migration is currently still incomplete, the legacy
versions of those guides remaining available as [Building C and C\+\+ Extensions with setuptools](../extending/building.html#install-index)
and [Building C and C\+\+ Extensions with setuptools](../extending/building.html#setuptools-index).

See also

[**PEP 453**](https://peps.python.org/pep-0453/) – Explicit bootstrapping of pip in Python installationsPEP written by Donald Stufft and Nick Coghlan, implemented by
Donald Stufft, Nick Coghlan, Martin von Löwis and Ned Deily.

### PEP 446: Newly Created File Descriptors Are Non\-Inheritable[¶](#pep-446-newly-created-file-descriptors-are-non-inheritable "Link to this heading")

[**PEP 446**](https://peps.python.org/pep-0446/) makes newly created file descriptors [non\-inheritable](../library/os.html#fd-inheritance). In general, this is the behavior an application will
want: when launching a new process, having currently open files also
open in the new process can lead to all sorts of hard to find bugs,
and potentially to security issues.

However, there are occasions when inheritance is desired. To support
these cases, the following new functions and methods are available:

* [`os.get_inheritable()`](../library/os.html#os.get_inheritable "os.get_inheritable"), [`os.set_inheritable()`](../library/os.html#os.set_inheritable "os.set_inheritable")
* [`os.get_handle_inheritable()`](../library/os.html#os.get_handle_inheritable "os.get_handle_inheritable"), [`os.set_handle_inheritable()`](../library/os.html#os.set_handle_inheritable "os.set_handle_inheritable")
* [`socket.socket.get_inheritable()`](../library/socket.html#socket.socket.get_inheritable "socket.socket.get_inheritable"), [`socket.socket.set_inheritable()`](../library/socket.html#socket.socket.set_inheritable "socket.socket.set_inheritable")

See also

[**PEP 446**](https://peps.python.org/pep-0446/) – Make newly created file descriptors non\-inheritablePEP written and implemented by Victor Stinner.

### Improvements to Codec Handling[¶](#improvements-to-codec-handling "Link to this heading")

Since it was first introduced, the [`codecs`](../library/codecs.html#module-codecs "codecs: Encode and decode data and streams.") module has always been
intended to operate as a type\-neutral dynamic encoding and decoding
system. However, its close coupling with the Python text model, especially
the type restricted convenience methods on the builtin [`str`](../library/stdtypes.html#str "str"),
[`bytes`](../library/stdtypes.html#bytes "bytes") and [`bytearray`](../library/stdtypes.html#bytearray "bytearray") types, has historically obscured that
fact.

As a key step in clarifying the situation, the [`codecs.encode()`](../library/codecs.html#codecs.encode "codecs.encode") and
[`codecs.decode()`](../library/codecs.html#codecs.decode "codecs.decode") convenience functions are now properly documented in
Python 2\.7, 3\.3 and 3\.4\. These functions have existed in the [`codecs`](../library/codecs.html#module-codecs "codecs: Encode and decode data and streams.")
module (and have been covered by the regression test suite) since Python 2\.4,
but were previously only discoverable through runtime introspection.

Unlike the convenience methods on [`str`](../library/stdtypes.html#str "str"), [`bytes`](../library/stdtypes.html#bytes "bytes") and
[`bytearray`](../library/stdtypes.html#bytearray "bytearray"), the [`codecs`](../library/codecs.html#module-codecs "codecs: Encode and decode data and streams.") convenience functions support arbitrary
codecs in both Python 2 and Python 3, rather than being limited to Unicode text
encodings (in Python 3\) or `basestring` \ `basestring` conversions (in
Python 2\).

In Python 3\.4, the interpreter is able to identify the known non\-text
encodings provided in the standard library and direct users towards these
general purpose convenience functions when appropriate:

\`\`\`
\>\>\> b"abcdef".decode("hex")
Traceback (most recent call last):
 File "\", line 1, in \
LookupError: 'hex' is not a text encoding; use codecs.decode() to handle arbitrary codecs

\>\>\> "hello".encode("rot13")
Traceback (most recent call last):
 File "\", line 1, in \
LookupError: 'rot13' is not a text encoding; use codecs.encode() to handle arbitrary codecs

\>\>\> open("foo.txt", encoding="hex")
Traceback (most recent call last):
 File "\", line 1, in \
LookupError: 'hex' is not a text encoding; use codecs.open() to handle arbitrary codecs

\`\`\`

In a related change, whenever it is feasible without breaking backwards
compatibility, exceptions raised during encoding and decoding operations
are wrapped in a chained exception of the same type that mentions the
name of the codec responsible for producing the error:

\`\`\`
\>\>\> import codecs

\>\>\> codecs.decode(b"abcdefgh", "hex")
Traceback (most recent call last):
 File "/usr/lib/python3\.4/encodings/hex\_codec.py", line 20, in hex\_decode
 return (binascii.a2b\_hex(input), len(input))
binascii.Error: Non\-hexadecimal digit found

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
 File "\", line 1, in \
binascii.Error: decoding with 'hex' codec failed (Error: Non\-hexadecimal digit found)

\>\>\> codecs.encode("hello", "bz2")
Traceback (most recent call last):
 File "/usr/lib/python3\.4/encodings/bz2\_codec.py", line 17, in bz2\_encode
 return (bz2\.compress(input), len(input))
 File "/usr/lib/python3\.4/bz2\.py", line 498, in compress
 return comp.compress(data) \+ comp.flush()
TypeError: 'str' does not support the buffer interface

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
 File "\", line 1, in \
TypeError: encoding with 'bz2' codec failed (TypeError: 'str' does not support the buffer interface)

\`\`\`

Finally, as the examples above show, these improvements have permitted
the restoration of the convenience aliases for the non\-Unicode codecs that
were themselves restored in Python 3\.2\. This means that encoding binary data
to and from its hexadecimal representation (for example) can now be written
as:

\`\`\`
\>\>\> from codecs import encode, decode
\>\>\> encode(b"hello", "hex")
b'68656c6c6f'
\>\>\> decode(b"68656c6c6f", "hex")
b'hello'

\`\`\`

The binary and text transforms provided in the standard library are detailed
in [Binary Transforms](../library/codecs.html#binary-transforms) and [Text Transforms](../library/codecs.html#text-transforms).

(Contributed by Nick Coghlan in [bpo\-7475](https://bugs.python.org/issue?@action=redirect&bpo=7475), [bpo\-17827](https://bugs.python.org/issue?@action=redirect&bpo=17827),
[bpo\-17828](https://bugs.python.org/issue?@action=redirect&bpo=17828) and [bpo\-19619](https://bugs.python.org/issue?@action=redirect&bpo=19619).)

### PEP 451: A ModuleSpec Type for the Import System[¶](#pep-451-a-modulespec-type-for-the-import-system "Link to this heading")

[**PEP 451**](https://peps.python.org/pep-0451/) provides an encapsulation of the information about a module that the
import machinery will use to load it (that is, a module specification). This
helps simplify both the import implementation and several import\-related APIs.
The change is also a stepping stone for [several future import\-related
improvements](https://mail.python.org/pipermail/python-dev/2013-November/130111.html).

The public\-facing changes from the PEP are entirely backward\-compatible.
Furthermore, they should be transparent to everyone but importer authors. Key
finder and loader methods have been deprecated, but they will continue working.
New importers should use the new methods described in the PEP. Existing
importers should be updated to implement the new methods. See the
[Deprecated](#deprecated-3-4) section for a list of methods that should be replaced and
their replacements.

### Other Language Changes[¶](#other-language-changes "Link to this heading")

Some smaller changes made to the core Python language are:

* Unicode database updated to UCD version 6\.3\.
* [`min()`](../library/functions.html#min "min") and [`max()`](../library/functions.html#max "max") now accept a *default* keyword\-only argument that
can be used to specify the value they return if the iterable they are
evaluating has no elements. (Contributed by Julian Berman in
[bpo\-18111](https://bugs.python.org/issue?@action=redirect&bpo=18111).)
* Module objects are now [weakly referenceable](../library/weakref.html#mod-weakref).
* Module `__file__` attributes (and related values) should now always
contain absolute paths by default, with the sole exception of
`__main__.__file__` when a script has been executed directly using
a relative path. (Contributed by Brett Cannon in [bpo\-18416](https://bugs.python.org/issue?@action=redirect&bpo=18416).)
* All the UTF\-\* codecs (except UTF\-7\) now reject surrogates during both
encoding and decoding unless the `surrogatepass` error handler is used,
with the exception of the UTF\-16 decoder (which accepts valid surrogate pairs)
and the UTF\-16 encoder (which produces them while encoding non\-BMP characters).
(Contributed by Victor Stinner, Kang\-Hao (Kenny) Lu and Serhiy Storchaka in
[bpo\-12892](https://bugs.python.org/issue?@action=redirect&bpo=12892).)
* New German EBCDIC [codec](../library/codecs.html#standard-encodings) `cp273`. (Contributed
by Michael Bierenfeld and Andrew Kuchling in [bpo\-1097797](https://bugs.python.org/issue?@action=redirect&bpo=1097797).)
* New Ukrainian [codec](../library/codecs.html#standard-encodings) `cp1125`. (Contributed by
Serhiy Storchaka in [bpo\-19668](https://bugs.python.org/issue?@action=redirect&bpo=19668).)
* [`bytes`](../library/stdtypes.html#bytes "bytes").join() and [`bytearray`](../library/stdtypes.html#bytearray "bytearray").join() now accept arbitrary
buffer objects as arguments. (Contributed by Antoine Pitrou in
[bpo\-15958](https://bugs.python.org/issue?@action=redirect&bpo=15958).)
* The [`int`](../library/functions.html#int "int") constructor now accepts any object that has an `__index__`
method for its *base* argument. (Contributed by Mark Dickinson in
[bpo\-16772](https://bugs.python.org/issue?@action=redirect&bpo=16772).)
* Frame objects now have a [`clear()`](../reference/datamodel.html#frame.clear "frame.clear") method that clears all
references to local variables from the frame. (Contributed by Antoine Pitrou
in [bpo\-17934](https://bugs.python.org/issue?@action=redirect&bpo=17934).)
* [`memoryview`](../library/stdtypes.html#memoryview "memoryview") is now registered as a [`Sequence`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers"),
and supports the [`reversed()`](../library/functions.html#reversed "reversed") builtin. (Contributed by Nick Coghlan
and Claudiu Popa in [bpo\-18690](https://bugs.python.org/issue?@action=redirect&bpo=18690) and [bpo\-19078](https://bugs.python.org/issue?@action=redirect&bpo=19078).)
* Signatures reported by [`help()`](../library/functions.html#help "help") have been modified and improved in
several cases as a result of the introduction of Argument Clinic and other
changes to the [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") and [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") modules.
* [`__length_hint__()`](../reference/datamodel.html#object.__length_hint__ "object.__length_hint__") is now part of the formal language
specification (see [**PEP 424**](https://peps.python.org/pep-0424/)). (Contributed by Armin Ronacher in
[bpo\-16148](https://bugs.python.org/issue?@action=redirect&bpo=16148).)

## New Modules[¶](#new-modules "Link to this heading")

### asyncio[¶](#asyncio "Link to this heading")

The new [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module (defined in [**PEP 3156**](https://peps.python.org/pep-3156/)) provides a standard
pluggable event loop model for Python, providing solid asynchronous IO
support in the standard library, and making it easier for other event loop
implementations to interoperate with the standard library and each other.

For Python 3\.4, this module is considered a [provisional API](../glossary.html#term-provisional-API).

See also

[**PEP 3156**](https://peps.python.org/pep-3156/) – Asynchronous IO Support Rebooted: the “asyncio” ModulePEP written and implementation led by Guido van Rossum.

### ensurepip[¶](#ensurepip "Link to this heading")

The new [`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment.") module is the primary infrastructure for the
[**PEP 453**](https://peps.python.org/pep-0453/) implementation. In the normal course of events end users will not
need to interact with this module, but it can be used to manually bootstrap
`pip` if the automated bootstrapping into an installation or virtual
environment was declined.

[`ensurepip`](../library/ensurepip.html#module-ensurepip "ensurepip: Bootstrapping the \"pip\" installer into an existing Python installation or virtual environment.") includes a bundled copy of `pip`, up\-to\-date as of the first
release candidate of the release of CPython with which it ships (this applies
to both maintenance releases and feature releases). `ensurepip` does not
access the internet. If the installation has internet access, after
`ensurepip` is run the bundled `pip` can be used to upgrade `pip` to a
more recent release than the bundled one. (Note that such an upgraded version
of `pip` is considered to be a separately installed package and will not be
removed if Python is uninstalled.)

The module is named *ensure*pip because if called when `pip` is already
installed, it does nothing. It also has an `--upgrade` option that will
cause it to install the bundled copy of `pip` if the existing installed
version of `pip` is older than the bundled copy.

### enum[¶](#enum "Link to this heading")

The new [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class.") module (defined in [**PEP 435**](https://peps.python.org/pep-0435/)) provides a standard
implementation of enumeration types, allowing other modules (such as
[`socket`](../library/socket.html#module-socket "socket: Low-level networking interface.")) to provide more informative error messages and better
debugging support by replacing opaque integer constants with backwards
compatible enumeration values.

See also

[**PEP 435**](https://peps.python.org/pep-0435/) – Adding an Enum type to the Python standard libraryPEP written by Barry Warsaw, Eli Bendersky and Ethan Furman,
implemented by Ethan Furman.

### pathlib[¶](#pathlib "Link to this heading")

The new [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths") module offers classes representing filesystem paths
with semantics appropriate for different operating systems. Path classes are
divided between *pure paths*, which provide purely computational operations
without I/O, and *concrete paths*, which inherit from pure paths but also
provide I/O operations.

For Python 3\.4, this module is considered a [provisional API](../glossary.html#term-provisional-API).

See also

[**PEP 428**](https://peps.python.org/pep-0428/) – The pathlib module – object\-oriented filesystem pathsPEP written and implemented by Antoine Pitrou.

### selectors[¶](#selectors "Link to this heading")

The new [`selectors`](../library/selectors.html#module-selectors "selectors: High-level I/O multiplexing.") module (created as part of implementing [**PEP 3156**](https://peps.python.org/pep-3156/))
allows high\-level and efficient I/O multiplexing, built upon the
[`select`](../library/select.html#module-select "select: Wait for I/O completion on multiple streams.") module primitives.

### statistics[¶](#statistics "Link to this heading")

The new [`statistics`](../library/statistics.html#module-statistics "statistics: Mathematical statistics functions") module (defined in [**PEP 450**](https://peps.python.org/pep-0450/)) offers some core
statistics functionality directly in the standard library. This module
supports calculation of the mean, median, mode, variance and standard
deviation of a data series.

See also

[**PEP 450**](https://peps.python.org/pep-0450/) – Adding A Statistics Module To The Standard LibraryPEP written and implemented by Steven D’Aprano

### tracemalloc[¶](#tracemalloc "Link to this heading")

The new [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") module (defined in [**PEP 454**](https://peps.python.org/pep-0454/)) is a debug tool to
trace memory blocks allocated by Python. It provides the following information:

* Trace where an object was allocated
* Statistics on allocated memory blocks per filename and per line number:
total size, number and average size of allocated memory blocks
* Compute the differences between two snapshots to detect memory leaks

See also

[**PEP 454**](https://peps.python.org/pep-0454/) – Add a new tracemalloc module to trace Python memory allocationsPEP written and implemented by Victor Stinner

## Improved Modules[¶](#improved-modules "Link to this heading")

### abc[¶](#abc "Link to this heading")

New function [`abc.get_cache_token()`](../library/abc.html#abc.get_cache_token "abc.get_cache_token") can be used to know when to invalidate
caches that are affected by changes in the object graph. (Contributed
by Łukasz Langa in [bpo\-16832](https://bugs.python.org/issue?@action=redirect&bpo=16832).)

New class [`ABC`](../library/abc.html#abc.ABC "abc.ABC") has [`ABCMeta`](../library/abc.html#abc.ABCMeta "abc.ABCMeta") as its meta class.
Using `ABC` as a base class has essentially the same effect as specifying
`metaclass=abc.ABCMeta`, but is simpler to type and easier to read.
(Contributed by Bruno Dupuis in [bpo\-16049](https://bugs.python.org/issue?@action=redirect&bpo=16049).)

### aifc[¶](#aifc "Link to this heading")

The `getparams()` method now returns a namedtuple rather than a
plain tuple. (Contributed by Claudiu Popa in [bpo\-17818](https://bugs.python.org/issue?@action=redirect&bpo=17818).)

`aifc.open()` now supports the context management protocol: when used in a
[`with`](../reference/compound_stmts.html#with) block, the `close()` method of the returned
object will be called automatically at the end of the block. (Contributed by
Serhiy Storchacha in [bpo\-16486](https://bugs.python.org/issue?@action=redirect&bpo=16486).)

The `writeframesraw()` and `writeframes()`
methods now accept any [bytes\-like object](../glossary.html#term-bytes-like-object). (Contributed by Serhiy
Storchaka in [bpo\-8311](https://bugs.python.org/issue?@action=redirect&bpo=8311).)

### argparse[¶](#argparse "Link to this heading")

The [`FileType`](../library/argparse.html#argparse.FileType "argparse.FileType") class now accepts *encoding* and
*errors* arguments, which are passed through to [`open()`](../library/functions.html#open "open"). (Contributed
by Lucas Maystre in [bpo\-11175](https://bugs.python.org/issue?@action=redirect&bpo=11175).)

### audioop[¶](#audioop "Link to this heading")

`audioop` now supports 24\-bit samples. (Contributed by Serhiy Storchaka
in [bpo\-12866](https://bugs.python.org/issue?@action=redirect&bpo=12866).)

New `byteswap()` function converts big\-endian samples to
little\-endian and vice versa. (Contributed by Serhiy Storchaka in
[bpo\-19641](https://bugs.python.org/issue?@action=redirect&bpo=19641).)

All `audioop` functions now accept any [bytes\-like object](../glossary.html#term-bytes-like-object). Strings
are not accepted: they didn’t work before, now they raise an error right away.
(Contributed by Serhiy Storchaka in [bpo\-16685](https://bugs.python.org/issue?@action=redirect&bpo=16685).)

### base64[¶](#base64 "Link to this heading")

The encoding and decoding functions in [`base64`](../library/base64.html#module-base64 "base64: RFC 4648: Base16, Base32, Base64 Data Encodings; Base85 and Ascii85") now accept any
[bytes\-like object](../glossary.html#term-bytes-like-object) in cases where it previously required a
[`bytes`](../library/stdtypes.html#bytes "bytes") or [`bytearray`](../library/stdtypes.html#bytearray "bytearray") instance. (Contributed by Nick Coghlan in
[bpo\-17839](https://bugs.python.org/issue?@action=redirect&bpo=17839).)

New functions [`a85encode()`](../library/base64.html#base64.a85encode "base64.a85encode"), [`a85decode()`](../library/base64.html#base64.a85decode "base64.a85decode"),
[`b85encode()`](../library/base64.html#base64.b85encode "base64.b85encode"), and [`b85decode()`](../library/base64.html#base64.b85decode "base64.b85decode") provide the ability to
encode and decode binary data from and to `Ascii85` and the git/mercurial
`Base85` formats, respectively. The `a85` functions have options that can
be used to make them compatible with the variants of the `Ascii85` encoding,
including the Adobe variant. (Contributed by Martin Morrison, the Mercurial
project, Serhiy Storchaka, and Antoine Pitrou in [bpo\-17618](https://bugs.python.org/issue?@action=redirect&bpo=17618).)

### collections[¶](#collections "Link to this heading")

The [`ChainMap.new_child()`](../library/collections.html#collections.ChainMap.new_child "collections.ChainMap.new_child") method now accepts an *m* argument specifying
the child map to add to the chain. This allows an existing mapping and/or a
custom mapping type to be used for the child. (Contributed by Vinay Sajip in
[bpo\-16613](https://bugs.python.org/issue?@action=redirect&bpo=16613).)

### colorsys[¶](#colorsys "Link to this heading")

The number of digits in the coefficients for the RGB — YIQ conversions have
been expanded so that they match the FCC NTSC versions. The change in
results should be less than 1% and may better match results found elsewhere.
(Contributed by Brian Landers and Serhiy Storchaka in [bpo\-14323](https://bugs.python.org/issue?@action=redirect&bpo=14323).)

### contextlib[¶](#contextlib "Link to this heading")

The new [`contextlib.suppress`](../library/contextlib.html#contextlib.suppress "contextlib.suppress") context manager helps to clarify the
intent of code that deliberately suppresses exceptions from a single
statement. (Contributed by Raymond Hettinger in [bpo\-15806](https://bugs.python.org/issue?@action=redirect&bpo=15806) and
Zero Piraeus in [bpo\-19266](https://bugs.python.org/issue?@action=redirect&bpo=19266).)

The new [`contextlib.redirect_stdout()`](../library/contextlib.html#contextlib.redirect_stdout "contextlib.redirect_stdout") context manager makes it easier
for utility scripts to handle inflexible APIs that write their output to
[`sys.stdout`](../library/sys.html#sys.stdout "sys.stdout") and don’t provide any options to redirect it. Using the
context manager, the [`sys.stdout`](../library/sys.html#sys.stdout "sys.stdout") output can be redirected to any
other stream or, in conjunction with [`io.StringIO`](../library/io.html#io.StringIO "io.StringIO"), to a string.
The latter can be especially useful, for example, to capture output
from a function that was written to implement a command line interface.
It is recommended only for utility scripts because it affects the
global state of [`sys.stdout`](../library/sys.html#sys.stdout "sys.stdout"). (Contributed by Raymond Hettinger
in [bpo\-15805](https://bugs.python.org/issue?@action=redirect&bpo=15805).)

The [`contextlib`](../library/contextlib.html#module-contextlib "contextlib: Utilities for with-statement contexts.") documentation has also been updated to include a
[discussion](../library/contextlib.html#single-use-reusable-and-reentrant-cms) of the
differences between single use, reusable and reentrant context managers.

### dbm[¶](#dbm "Link to this heading")

[`dbm.open()`](../library/dbm.html#dbm.open "dbm.open") objects now support the context management protocol. When
used in a [`with`](../reference/compound_stmts.html#with) statement, the `close` method of the database
object will be called automatically at the end of the block. (Contributed by
Claudiu Popa and Nick Coghlan in [bpo\-19282](https://bugs.python.org/issue?@action=redirect&bpo=19282).)

### dis[¶](#dis "Link to this heading")

Functions [`show_code()`](../library/dis.html#dis.show_code "dis.show_code"), [`dis()`](../library/dis.html#dis.dis "dis.dis"), `distb()`, and
[`disassemble()`](../library/dis.html#dis.disassemble "dis.disassemble") now accept a keyword\-only *file* argument that
controls where they write their output.

The [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module is now built around an [`Instruction`](../library/dis.html#dis.Instruction "dis.Instruction") class
that provides object oriented access to the details of each individual bytecode
operation.

A new method, [`get_instructions()`](../library/dis.html#dis.get_instructions "dis.get_instructions"), provides an iterator that emits
the Instruction stream for a given piece of Python code. Thus it is now
possible to write a program that inspects and manipulates a bytecode
object in ways different from those provided by the [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module
itself. For example:

\`\`\`
\>\>\> import dis
\>\>\> for instr in dis.get\_instructions(lambda x: x \+ 1\):
... print(instr.opname)
LOAD\_FAST
LOAD\_CONST
BINARY\_ADD
RETURN\_VALUE

\`\`\`

The various display tools in the [`dis`](../library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module have been rewritten to use
these new components.

In addition, a new application\-friendly class [`Bytecode`](../library/dis.html#dis.Bytecode "dis.Bytecode") provides
an object\-oriented API for inspecting bytecode in both in human\-readable form
and for iterating over instructions. The [`Bytecode`](../library/dis.html#dis.Bytecode "dis.Bytecode") constructor
takes the same arguments that `get_instruction()` does (plus an
optional *current\_offset*), and the resulting object can be iterated to produce
[`Instruction`](../library/dis.html#dis.Instruction "dis.Instruction") objects. But it also has a [`dis`](../library/dis.html#dis.Bytecode.dis "dis.Bytecode.dis")
method, equivalent to calling [`dis`](../library/dis.html#dis.dis "dis.dis") on the constructor argument, but
returned as a multi\-line string:

\`\`\`
\>\>\> bytecode = dis.Bytecode(lambda x: x \+ 1, current\_offset=3\)
\>\>\> for instr in bytecode:
... print('{} ({})'.format(instr.opname, instr.opcode))
LOAD\_FAST (124\)
LOAD\_CONST (100\)
BINARY\_ADD (23\)
RETURN\_VALUE (83\)
\>\>\> bytecode.dis().splitlines() 
\[' 1 0 LOAD\_FAST 0 (x)',
 ' \-\-\> 3 LOAD\_CONST 1 (1\)',
 ' 6 BINARY\_ADD',
 ' 7 RETURN\_VALUE']

\`\`\`

[`Bytecode`](../library/dis.html#dis.Bytecode "dis.Bytecode") also has a class method,
[`from_traceback()`](../library/dis.html#dis.Bytecode.from_traceback "dis.Bytecode.from_traceback"), that provides the ability to manipulate a
traceback (that is, `print(Bytecode.from_traceback(tb).dis())` is equivalent
to `distb(tb)`).

(Contributed by Nick Coghlan, Ryan Kelly and Thomas Kluyver in [bpo\-11816](https://bugs.python.org/issue?@action=redirect&bpo=11816)
and Claudiu Popa in [bpo\-17916](https://bugs.python.org/issue?@action=redirect&bpo=17916).)

New function [`stack_effect()`](../library/dis.html#dis.stack_effect "dis.stack_effect") computes the effect on the Python stack
of a given opcode and argument, information that is not otherwise available.
(Contributed by Larry Hastings in [bpo\-19722](https://bugs.python.org/issue?@action=redirect&bpo=19722).)

### doctest[¶](#doctest "Link to this heading")

A new [option flag](../library/doctest.html#doctest-options), [`FAIL_FAST`](../library/doctest.html#doctest.FAIL_FAST "doctest.FAIL_FAST"), halts
test running as soon as the first failure is detected. (Contributed by R.
David Murray and Daniel Urban in [bpo\-16522](https://bugs.python.org/issue?@action=redirect&bpo=16522).)

The [`doctest`](../library/doctest.html#module-doctest "doctest: Test pieces of code within docstrings.") command line interface now uses [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library."), and has two
new options, `-o` and `-f`. `-o` allows [doctest options](../library/doctest.html#doctest-options) to be specified on the command line, and `-f` is a
shorthand for `-o FAIL_FAST` (to parallel the similar option supported by the
[`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") CLI). (Contributed by R. David Murray in [bpo\-11390](https://bugs.python.org/issue?@action=redirect&bpo=11390).)

[`doctest`](../library/doctest.html#module-doctest "doctest: Test pieces of code within docstrings.") will now find doctests in extension module `__doc__` strings.
(Contributed by Zachary Ware in [bpo\-3158](https://bugs.python.org/issue?@action=redirect&bpo=3158).)

### email[¶](#email "Link to this heading")

[`as_string()`](../library/email.compat32-message.html#email.message.Message.as_string "email.message.Message.as_string") now accepts a *policy* argument to
override the default policy of the message when generating a string
representation of it. This means that `as_string` can now be used in more
circumstances, instead of having to create and use a [`generator`](../library/email.generator.html#module-email.generator "email.generator: Generate flat text email messages from a message structure.") in
order to pass formatting parameters to its `flatten` method. (Contributed by
R. David Murray in [bpo\-18600](https://bugs.python.org/issue?@action=redirect&bpo=18600).)

New method [`as_bytes()`](../library/email.compat32-message.html#email.message.Message.as_bytes "email.message.Message.as_bytes") added to produce a bytes
representation of the message in a fashion similar to how `as_string`
produces a string representation. It does not accept the *maxheaderlen*
argument, but does accept the *unixfrom* and *policy* arguments. The
[`Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message") [`__bytes__()`](../library/email.compat32-message.html#email.message.Message.__bytes__ "email.message.Message.__bytes__") method
calls it, meaning that `bytes(mymsg)` will now produce the intuitive
result: a bytes object containing the fully formatted message. (Contributed
by R. David Murray in [bpo\-18600](https://bugs.python.org/issue?@action=redirect&bpo=18600).)

The [`Message.set_param()`](../library/email.compat32-message.html#email.message.Message.set_param "email.message.Message.set_param") message now accepts a *replace* keyword argument.
When specified, the associated header will be updated without changing
its location in the list of headers. For backward compatibility, the default
is `False`. (Contributed by R. David Murray in [bpo\-18891](https://bugs.python.org/issue?@action=redirect&bpo=18891).)

A pair of new subclasses of [`Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message") have been added
([`EmailMessage`](../library/email.message.html#email.message.EmailMessage "email.message.EmailMessage") and [`MIMEPart`](../library/email.message.html#email.message.MIMEPart "email.message.MIMEPart")), along with a new sub\-module,
[`contentmanager`](../library/email.contentmanager.html#module-email.contentmanager "email.contentmanager: Storing and Retrieving Content from MIME Parts") and a new [`policy`](../library/email.policy.html#module-email.policy "email.policy: Controlling the parsing and generating of messages") attribute
[`content_manager`](../library/email.policy.html#email.policy.EmailPolicy.content_manager "email.policy.EmailPolicy.content_manager"). All documentation is
currently in the new module, which is being added as part of email’s new
[provisional API](../glossary.html#term-provisional-API). These classes provide a number of new methods that
make extracting content from and inserting content into email messages much
easier. For details, see the [`contentmanager`](../library/email.contentmanager.html#module-email.contentmanager "email.contentmanager: Storing and Retrieving Content from MIME Parts") documentation and
the [email: Examples](../library/email.examples.html#email-examples). These API additions complete the
bulk of the work that was planned as part of the email6 project. The currently
provisional API is scheduled to become final in Python 3\.5 (possibly with a few
minor additions in the area of error handling). (Contributed by R. David
Murray in [bpo\-18891](https://bugs.python.org/issue?@action=redirect&bpo=18891).)

### filecmp[¶](#filecmp "Link to this heading")

A new [`clear_cache()`](../library/filecmp.html#filecmp.clear_cache "filecmp.clear_cache") function provides the ability to clear the
[`filecmp`](../library/filecmp.html#module-filecmp "filecmp: Compare files efficiently.") comparison cache, which uses [`os.stat()`](../library/os.html#os.stat "os.stat") information to
determine if the file has changed since the last compare. This can be used,
for example, if the file might have been changed and re\-checked in less time
than the resolution of a particular filesystem’s file modification time field.
(Contributed by Mark Levitt in [bpo\-18149](https://bugs.python.org/issue?@action=redirect&bpo=18149).)

New module attribute [`DEFAULT_IGNORES`](../library/filecmp.html#filecmp.DEFAULT_IGNORES "filecmp.DEFAULT_IGNORES") provides the list of
directories that are used as the default value for the *ignore* parameter of
the [`dircmp()`](../library/filecmp.html#filecmp.dircmp "filecmp.dircmp") function. (Contributed by Eli Bendersky in
[bpo\-15442](https://bugs.python.org/issue?@action=redirect&bpo=15442).)

### functools[¶](#functools "Link to this heading")

The new [`partialmethod()`](../library/functools.html#functools.partialmethod "functools.partialmethod") descriptor brings partial argument
application to descriptors, just as [`partial()`](../library/functools.html#functools.partial "functools.partial") provides
for normal callables. The new descriptor also makes it easier to get
arbitrary callables (including [`partial()`](../library/functools.html#functools.partial "functools.partial") instances)
to behave like normal instance methods when included in a class definition.
(Contributed by Alon Horev and Nick Coghlan in [bpo\-4331](https://bugs.python.org/issue?@action=redirect&bpo=4331).)

The new [`singledispatch()`](../library/functools.html#functools.singledispatch "functools.singledispatch") decorator brings support for
single\-dispatch generic functions to the Python standard library. Where
object oriented programming focuses on grouping multiple operations on a
common set of data into a class, a generic function focuses on grouping
multiple implementations of an operation that allows it to work with
*different* kinds of data.

See also

[**PEP 443**](https://peps.python.org/pep-0443/) – Single\-dispatch generic functionsPEP written and implemented by Łukasz Langa.

[`total_ordering()`](../library/functools.html#functools.total_ordering "functools.total_ordering") now supports a return value of
[`NotImplemented`](../library/constants.html#NotImplemented "NotImplemented") from the underlying comparison function. (Contributed
by Katie Miller in [bpo\-10042](https://bugs.python.org/issue?@action=redirect&bpo=10042).)

A pure\-python version of the [`partial()`](../library/functools.html#functools.partial "functools.partial") function is now in the
stdlib; in CPython it is overridden by the C accelerated version, but it is
available for other implementations to use. (Contributed by Brian Thorne in
[bpo\-12428](https://bugs.python.org/issue?@action=redirect&bpo=12428).)

### gc[¶](#gc "Link to this heading")

New function [`get_stats()`](../library/gc.html#gc.get_stats "gc.get_stats") returns a list of three per\-generation
dictionaries containing the collections statistics since interpreter startup.
(Contributed by Antoine Pitrou in [bpo\-16351](https://bugs.python.org/issue?@action=redirect&bpo=16351).)

### glob[¶](#glob "Link to this heading")

A new function [`escape()`](../library/glob.html#glob.escape "glob.escape") provides a way to escape special characters
in a filename so that they do not become part of the globbing expansion but are
instead matched literally. (Contributed by Serhiy Storchaka in [bpo\-8402](https://bugs.python.org/issue?@action=redirect&bpo=8402).)

### hashlib[¶](#hashlib "Link to this heading")

A new [`hashlib.pbkdf2_hmac()`](../library/hashlib.html#hashlib.pbkdf2_hmac "hashlib.pbkdf2_hmac") function provides
the [PKCS\#5 password\-based key derivation function 2](https://en.wikipedia.org/wiki/PBKDF2). (Contributed by Christian
Heimes in [bpo\-18582](https://bugs.python.org/issue?@action=redirect&bpo=18582).)

The [`name`](../library/hashlib.html#hashlib.hash.name "hashlib.hash.name") attribute of [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") hash objects is now
a formally supported interface. It has always existed in CPython’s
[`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") (although it did not return lower case names for all supported
hashes), but it was not a public interface and so some other Python
implementations have not previously supported it. (Contributed by Jason R.
Coombs in [bpo\-18532](https://bugs.python.org/issue?@action=redirect&bpo=18532).)

### hmac[¶](#hmac "Link to this heading")

[`hmac`](../library/hmac.html#module-hmac "hmac: Keyed-Hashing for Message Authentication (HMAC) implementation") now accepts `bytearray` as well as `bytes` for the *key*
argument to the [`new()`](../library/hmac.html#hmac.new "hmac.new") function, and the *msg* parameter to both the
[`new()`](../library/hmac.html#hmac.new "hmac.new") function and the [`update()`](../library/hmac.html#hmac.HMAC.update "hmac.HMAC.update") method now
accepts any type supported by the [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") module. (Contributed
by Jonas Borgström in [bpo\-18240](https://bugs.python.org/issue?@action=redirect&bpo=18240).)

The *digestmod* argument to the [`hmac.new()`](../library/hmac.html#hmac.new "hmac.new") function may now be any hash
digest name recognized by [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms."). In addition, the current behavior in
which the value of *digestmod* defaults to `MD5` is deprecated: in a
future version of Python there will be no default value. (Contributed by
Christian Heimes in [bpo\-17276](https://bugs.python.org/issue?@action=redirect&bpo=17276).)

With the addition of [`block_size`](../library/hmac.html#hmac.HMAC.block_size "hmac.HMAC.block_size") and [`name`](../library/hmac.html#hmac.HMAC.name "hmac.HMAC.name")
attributes (and the formal documentation of the [`digest_size`](../library/hmac.html#hmac.HMAC.digest_size "hmac.HMAC.digest_size")
attribute), the [`hmac`](../library/hmac.html#module-hmac "hmac: Keyed-Hashing for Message Authentication (HMAC) implementation") module now conforms fully to the [**PEP 247**](https://peps.python.org/pep-0247/) API.
(Contributed by Christian Heimes in [bpo\-18775](https://bugs.python.org/issue?@action=redirect&bpo=18775).)

### html[¶](#html "Link to this heading")

New function [`unescape()`](../library/html.html#html.unescape "html.unescape") function converts HTML5 character references to
the corresponding Unicode characters. (Contributed by Ezio Melotti in
[bpo\-2927](https://bugs.python.org/issue?@action=redirect&bpo=2927).)

[`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") accepts a new keyword argument
*convert\_charrefs* that, when `True`, automatically converts all character
references. For backward\-compatibility, its value defaults to `False`, but
it will change to `True` in a future version of Python, so you are invited to
set it explicitly and update your code to use this new feature. (Contributed
by Ezio Melotti in [bpo\-13633](https://bugs.python.org/issue?@action=redirect&bpo=13633).)

The *strict* argument of [`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") is now deprecated.
(Contributed by Ezio Melotti in [bpo\-15114](https://bugs.python.org/issue?@action=redirect&bpo=15114).)

### http[¶](#http "Link to this heading")

[`send_error()`](../library/http.server.html#http.server.BaseHTTPRequestHandler.send_error "http.server.BaseHTTPRequestHandler.send_error") now accepts an
optional additional *explain* parameter which can be used to provide an
extended error description, overriding the hardcoded default if there is one.
This extended error description will be formatted using the
`error_message_format` attribute and sent as the body
of the error response. (Contributed by Karl Cow in [bpo\-12921](https://bugs.python.org/issue?@action=redirect&bpo=12921).)

The [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers.") [command line interface](../library/http.server.html#http-server-cli) now has
a `-b/--bind` option that causes the server to listen on a specific address.
(Contributed by Malte Swart in [bpo\-17764](https://bugs.python.org/issue?@action=redirect&bpo=17764).)

### idlelib and IDLE[¶](#idlelib-and-idle "Link to this heading")

Since idlelib implements the IDLE shell and editor and is not intended for
import by other programs, it gets improvements with every release. See
`Lib/idlelib/NEWS.txt` for a cumulative list of changes since 3\.3\.0,
as well as changes made in future 3\.4\.x releases. This file is also available
from the IDLE Help ‣ About IDLE dialog.

### importlib[¶](#importlib "Link to this heading")

The [`InspectLoader`](../library/importlib.html#importlib.abc.InspectLoader "importlib.abc.InspectLoader") ABC defines a new method,
[`source_to_code()`](../library/importlib.html#importlib.abc.InspectLoader.source_to_code "importlib.abc.InspectLoader.source_to_code") that accepts source
data and a path and returns a code object. The default implementation
is equivalent to `compile(data, path, 'exec', dont_inherit=True)`.
(Contributed by Eric Snow and Brett Cannon in [bpo\-15627](https://bugs.python.org/issue?@action=redirect&bpo=15627).)

[`InspectLoader`](../library/importlib.html#importlib.abc.InspectLoader "importlib.abc.InspectLoader") also now has a default implementation
for the [`get_code()`](../library/importlib.html#importlib.abc.InspectLoader.get_code "importlib.abc.InspectLoader.get_code") method. However,
it will normally be desirable to override the default implementation
for performance reasons. (Contributed by Brett Cannon in [bpo\-18072](https://bugs.python.org/issue?@action=redirect&bpo=18072).)

The [`reload()`](../library/importlib.html#importlib.reload "importlib.reload") function has been moved from `imp` to
[`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") as part of the `imp` module deprecation. (Contributed by
Berker Peksag in [bpo\-18193](https://bugs.python.org/issue?@action=redirect&bpo=18193).)

[`importlib.util`](../library/importlib.html#module-importlib.util "importlib.util: Utility code for importers") now has a [`MAGIC_NUMBER`](../library/importlib.html#importlib.util.MAGIC_NUMBER "importlib.util.MAGIC_NUMBER") attribute
providing access to the bytecode version number. This replaces the
`get_magic()` function in the deprecated `imp` module.
(Contributed by Brett Cannon in [bpo\-18192](https://bugs.python.org/issue?@action=redirect&bpo=18192).)

New [`importlib.util`](../library/importlib.html#module-importlib.util "importlib.util: Utility code for importers") functions [`cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source")
and [`source_from_cache()`](../library/importlib.html#importlib.util.source_from_cache "importlib.util.source_from_cache") replace the same\-named functions
in the deprecated `imp` module. (Contributed by Brett Cannon in
[bpo\-18194](https://bugs.python.org/issue?@action=redirect&bpo=18194).)

The [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") bootstrap [`NamespaceLoader`](../library/importlib.html#importlib.machinery.NamespaceLoader "importlib.machinery.NamespaceLoader") now conforms to
the [`InspectLoader`](../library/importlib.html#importlib.abc.InspectLoader "importlib.abc.InspectLoader") ABC, which means that `runpy` and
`python -m` can now be used with namespace packages. (Contributed
by Brett Cannon in [bpo\-18058](https://bugs.python.org/issue?@action=redirect&bpo=18058).)

[`importlib.util`](../library/importlib.html#module-importlib.util "importlib.util: Utility code for importers") has a new function [`decode_source()`](../library/importlib.html#importlib.util.decode_source "importlib.util.decode_source")
that decodes source from bytes using universal newline processing. This is
useful for implementing [`InspectLoader.get_source()`](../library/importlib.html#importlib.abc.InspectLoader.get_source "importlib.abc.InspectLoader.get_source") methods.

[`importlib.machinery.ExtensionFileLoader`](../library/importlib.html#importlib.machinery.ExtensionFileLoader "importlib.machinery.ExtensionFileLoader") now has a
[`get_filename()`](../library/importlib.html#importlib.machinery.ExtensionFileLoader.get_filename "importlib.machinery.ExtensionFileLoader.get_filename") method. This was
inadvertently omitted in the original implementation. (Contributed by Eric
Snow in [bpo\-19152](https://bugs.python.org/issue?@action=redirect&bpo=19152).)

### inspect[¶](#inspect "Link to this heading")

The [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") module now offers a basic [command line interface](../library/inspect.html#inspect-module-cli) to quickly display source code and other
information for modules, classes and functions. (Contributed by Claudiu Popa
and Nick Coghlan in [bpo\-18626](https://bugs.python.org/issue?@action=redirect&bpo=18626).)

[`unwrap()`](../library/inspect.html#inspect.unwrap "inspect.unwrap") makes it easy to unravel wrapper function chains
created by [`functools.wraps()`](../library/functools.html#functools.wraps "functools.wraps") (and any other API that sets the
`__wrapped__` attribute on a wrapper function). (Contributed by
Daniel Urban, Aaron Iles and Nick Coghlan in [bpo\-13266](https://bugs.python.org/issue?@action=redirect&bpo=13266).)

As part of the implementation of the new [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class.") module, the
[`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") module now has substantially better support for custom
`__dir__` methods and dynamic class attributes provided through
metaclasses. (Contributed by Ethan Furman in [bpo\-18929](https://bugs.python.org/issue?@action=redirect&bpo=18929) and
[bpo\-19030](https://bugs.python.org/issue?@action=redirect&bpo=19030).)

[`getfullargspec()`](../library/inspect.html#inspect.getfullargspec "inspect.getfullargspec") and `getargspec()`
now use the [`signature()`](../library/inspect.html#inspect.signature "inspect.signature") API. This allows them to
support a much broader range of callables, including those with
`__signature__` attributes, those with metadata provided by argument
clinic, [`functools.partial()`](../library/functools.html#functools.partial "functools.partial") objects and more. Note that, unlike
[`signature()`](../library/inspect.html#inspect.signature "inspect.signature"), these functions still ignore `__wrapped__`
attributes, and report the already bound first argument for bound methods,
so it is still necessary to update your code to use
[`signature()`](../library/inspect.html#inspect.signature "inspect.signature") directly if those features are desired.
(Contributed by Yury Selivanov in [bpo\-17481](https://bugs.python.org/issue?@action=redirect&bpo=17481).)

[`signature()`](../library/inspect.html#inspect.signature "inspect.signature") now supports duck types of CPython functions,
which adds support for functions compiled with Cython. (Contributed
by Stefan Behnel and Yury Selivanov in [bpo\-17159](https://bugs.python.org/issue?@action=redirect&bpo=17159).)

### ipaddress[¶](#ipaddress "Link to this heading")

[`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") was added to the standard library in Python 3\.3 as a
[provisional API](../glossary.html#term-provisional-API). With the release of Python 3\.4, this qualification
has been removed: [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") is now considered a stable API, covered
by the normal standard library requirements to maintain backwards
compatibility.

A new [`is_global`](../library/ipaddress.html#ipaddress.IPv4Address.is_global "ipaddress.IPv4Address.is_global") property is `True` if
an address is globally routeable. (Contributed by Peter Moody in
[bpo\-17400](https://bugs.python.org/issue?@action=redirect&bpo=17400).)

### logging[¶](#logging "Link to this heading")

The [`TimedRotatingFileHandler`](../library/logging.handlers.html#logging.handlers.TimedRotatingFileHandler "logging.handlers.TimedRotatingFileHandler") has a new *atTime*
parameter that can be used to specify the time of day when rollover should
happen. (Contributed by Ronald Oussoren in [bpo\-9556](https://bugs.python.org/issue?@action=redirect&bpo=9556).)

[`SocketHandler`](../library/logging.handlers.html#logging.handlers.SocketHandler "logging.handlers.SocketHandler") and
[`DatagramHandler`](../library/logging.handlers.html#logging.handlers.DatagramHandler "logging.handlers.DatagramHandler") now support Unix domain sockets (by
setting *port* to `None`). (Contributed by Vinay Sajip in commit
ce46195b56a9\.)

[`fileConfig()`](../library/logging.config.html#logging.config.fileConfig "logging.config.fileConfig") now accepts a
[`configparser.RawConfigParser`](../library/configparser.html#configparser.RawConfigParser "configparser.RawConfigParser") subclass instance for the *fname*
parameter. This facilitates using a configuration file when logging
configuration is just a part of the overall application configuration, or where
the application modifies the configuration before passing it to
[`fileConfig()`](../library/logging.config.html#logging.config.fileConfig "logging.config.fileConfig"). (Contributed by Vinay Sajip in
[bpo\-16110](https://bugs.python.org/issue?@action=redirect&bpo=16110).)

Logging configuration data received from a socket via the
[`logging.config.listen()`](../library/logging.config.html#logging.config.listen "logging.config.listen") function can now be validated before being
processed by supplying a verification function as the argument to the new
*verify* keyword argument. (Contributed by Vinay Sajip in [bpo\-15452](https://bugs.python.org/issue?@action=redirect&bpo=15452).)

### marshal[¶](#marshal "Link to this heading")

The default [`marshal`](../library/marshal.html#module-marshal "marshal: Convert Python objects to streams of bytes and back (with different constraints).") version has been bumped to 3\. The code implementing
the new version restores the Python2 behavior of recording only one copy of
interned strings and preserving the interning on deserialization, and extends
this “one copy” ability to any object type (including handling recursive
references). This reduces both the size of `.pyc` files and the amount of
memory a module occupies in memory when it is loaded from a `.pyc` (or
`.pyo`) file. (Contributed by Kristján Valur Jónsson in [bpo\-16475](https://bugs.python.org/issue?@action=redirect&bpo=16475),
with additional speedups by Antoine Pitrou in [bpo\-19219](https://bugs.python.org/issue?@action=redirect&bpo=19219).)

### mmap[¶](#mmap "Link to this heading")

mmap objects are now [weakly referenceable](../library/weakref.html#mod-weakref).
(Contributed by Valerie Lambert in [bpo\-4885](https://bugs.python.org/issue?@action=redirect&bpo=4885).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

On Unix two new [start methods](../library/multiprocessing.html#multiprocessing-start-methods),
`spawn` and `forkserver`, have been added for starting processes using
[`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism."). These make the mixing of processes with threads more
robust, and the `spawn` method matches the semantics that multiprocessing has
always used on Windows. New function
[`get_all_start_methods()`](../library/multiprocessing.html#multiprocessing.get_all_start_methods "multiprocessing.get_all_start_methods") reports all start methods
available on the platform, [`get_start_method()`](../library/multiprocessing.html#multiprocessing.get_start_method "multiprocessing.get_start_method") reports
the current start method, and [`set_start_method()`](../library/multiprocessing.html#multiprocessing.set_start_method "multiprocessing.set_start_method") sets
the start method. (Contributed by Richard Oudkerk in [bpo\-8713](https://bugs.python.org/issue?@action=redirect&bpo=8713).)

[`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") also now has the concept of a `context`, which
determines how child processes are created. New function
[`get_context()`](../library/multiprocessing.html#multiprocessing.get_context "multiprocessing.get_context") returns a context that uses a specified
start method. It has the same API as the [`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") module itself,
so you can use it to create [`Pool`](../library/multiprocessing.html#multiprocessing.pool.Pool "multiprocessing.pool.Pool")s and other
objects that will operate within that context. This allows a framework and an
application or different parts of the same application to use multiprocessing
without interfering with each other. (Contributed by Richard Oudkerk in
[bpo\-18999](https://bugs.python.org/issue?@action=redirect&bpo=18999).)

Except when using the old *fork* start method, child processes no longer
inherit unneeded handles/file descriptors from their parents (part of
[bpo\-8713](https://bugs.python.org/issue?@action=redirect&bpo=8713)).

[`multiprocessing`](../library/multiprocessing.html#module-multiprocessing "multiprocessing: Process-based parallelism.") now relies on [`runpy`](../library/runpy.html#module-runpy "runpy: Locate and run Python modules without importing them first.") (which implements the
`-m` switch) to initialise `__main__` appropriately in child processes
when using the `spawn` or `forkserver` start methods. This resolves some
edge cases where combining multiprocessing, the `-m` command line switch,
and explicit relative imports could cause obscure failures in child
processes. (Contributed by Nick Coghlan in [bpo\-19946](https://bugs.python.org/issue?@action=redirect&bpo=19946).)

### operator[¶](#operator "Link to this heading")

New function [`length_hint()`](../library/operator.html#operator.length_hint "operator.length_hint") provides an implementation of the
specification for how the [`__length_hint__()`](../reference/datamodel.html#object.__length_hint__ "object.__length_hint__") special method should
be used, as part of the [**PEP 424**](https://peps.python.org/pep-0424/) formal specification of this language
feature. (Contributed by Armin Ronacher in [bpo\-16148](https://bugs.python.org/issue?@action=redirect&bpo=16148).)

There is now a pure\-python version of the [`operator`](../library/operator.html#module-operator "operator: Functions corresponding to the standard operators.") module available for
reference and for use by alternate implementations of Python. (Contributed by
Zachary Ware in [bpo\-16694](https://bugs.python.org/issue?@action=redirect&bpo=16694).)

### os[¶](#os "Link to this heading")

There are new functions to get and set the [inheritable flag](../library/os.html#fd-inheritance) of a file descriptor ([`os.get_inheritable()`](../library/os.html#os.get_inheritable "os.get_inheritable"),
[`os.set_inheritable()`](../library/os.html#os.set_inheritable "os.set_inheritable")) or a Windows handle
([`os.get_handle_inheritable()`](../library/os.html#os.get_handle_inheritable "os.get_handle_inheritable"), [`os.set_handle_inheritable()`](../library/os.html#os.set_handle_inheritable "os.set_handle_inheritable")).

New function [`cpu_count()`](../library/os.html#os.cpu_count "os.cpu_count") reports the number of CPUs available on the
platform on which Python is running (or `None` if the count can’t be
determined). The [`multiprocessing.cpu_count()`](../library/multiprocessing.html#multiprocessing.cpu_count "multiprocessing.cpu_count") function is now implemented
in terms of this function). (Contributed by Trent Nelson, Yogesh Chaudhari,
Victor Stinner, and Charles\-François Natali in [bpo\-17914](https://bugs.python.org/issue?@action=redirect&bpo=17914).)

[`os.path.samestat()`](../library/os.path.html#os.path.samestat "os.path.samestat") is now available on the Windows platform (and the
[`os.path.samefile()`](../library/os.path.html#os.path.samefile "os.path.samefile") implementation is now shared between Unix and
Windows). (Contributed by Brian Curtin in [bpo\-11939](https://bugs.python.org/issue?@action=redirect&bpo=11939).)

[`os.path.ismount()`](../library/os.path.html#os.path.ismount "os.path.ismount") now recognizes volumes mounted below a drive
root on Windows. (Contributed by Tim Golden in [bpo\-9035](https://bugs.python.org/issue?@action=redirect&bpo=9035).)

[`os.open()`](../library/os.html#os.open "os.open") supports two new flags on platforms that provide them,
[`O_PATH`](../library/os.html#os.O_PATH "os.O_PATH") (un\-opened file descriptor), and [`O_TMPFILE`](../library/os.html#os.O_TMPFILE "os.O_TMPFILE")
(unnamed temporary file; as of 3\.4\.0 release available only on Linux systems
with a kernel version of 3\.11 or newer that have uapi headers). (Contributed
by Christian Heimes in [bpo\-18673](https://bugs.python.org/issue?@action=redirect&bpo=18673) and Benjamin Peterson, respectively.)

### pdb[¶](#pdb "Link to this heading")

[`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters.") has been enhanced to handle generators, [`yield`](../reference/simple_stmts.html#yield), and
`yield from` in a more useful fashion. This is especially helpful when
debugging [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") based programs. (Contributed by Andrew Svetlov and
Xavier de Gaye in [bpo\-16596](https://bugs.python.org/issue?@action=redirect&bpo=16596).)

The `print` command has been removed from [`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters."), restoring access to the
Python [`print()`](../library/functions.html#print "print") function from the pdb command line. Python2’s `pdb` did
not have a `print` command; instead, entering `print` executed the
`print` statement. In Python3 `print` was mistakenly made an alias for the
pdb [`p`](../library/pdb.html#pdbcommand-p) command. `p`, however, prints the `repr` of its argument,
not the `str` like the Python2 `print` command did. Worse, the Python3
`pdb print` command shadowed the Python3 `print` function, making it
inaccessible at the `pdb` prompt. (Contributed by Connor Osborn in
[bpo\-18764](https://bugs.python.org/issue?@action=redirect&bpo=18764).)

### pickle[¶](#pickle "Link to this heading")

[`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") now supports (but does not use by default) a new pickle protocol,
protocol 4\. This new protocol addresses a number of issues that were present
in previous protocols, such as the serialization of nested classes, very large
strings and containers, and classes whose `__new__()` method takes
keyword\-only arguments. It also provides some efficiency improvements.

See also

[**PEP 3154**](https://peps.python.org/pep-3154/) – Pickle protocol 4PEP written by Antoine Pitrou and implemented by Alexandre Vassalotti.

### plistlib[¶](#plistlib "Link to this heading")

[`plistlib`](../library/plistlib.html#module-plistlib "plistlib: Generate and parse Apple plist files.") now has an API that is similar to the standard pattern for
stdlib serialization protocols, with new [`load()`](../library/plistlib.html#plistlib.load "plistlib.load"),
[`dump()`](../library/plistlib.html#plistlib.dump "plistlib.dump"), [`loads()`](../library/plistlib.html#plistlib.loads "plistlib.loads"), and [`dumps()`](../library/plistlib.html#plistlib.dumps "plistlib.dumps")
functions. (The older API is now deprecated.) In addition to the already
supported XML plist format ([`FMT_XML`](../library/plistlib.html#plistlib.FMT_XML "plistlib.FMT_XML")), it also now supports
the binary plist format ([`FMT_BINARY`](../library/plistlib.html#plistlib.FMT_BINARY "plistlib.FMT_BINARY")). (Contributed by Ronald
Oussoren and others in [bpo\-14455](https://bugs.python.org/issue?@action=redirect&bpo=14455).)

### poplib[¶](#poplib "Link to this heading")

Two new methods have been added to [`poplib`](../library/poplib.html#module-poplib "poplib: POP3 protocol client (requires sockets)."): [`capa()`](../library/poplib.html#poplib.POP3.capa "poplib.POP3.capa"),
which returns the list of capabilities advertised by the POP server, and
[`stls()`](../library/poplib.html#poplib.POP3.stls "poplib.POP3.stls"), which switches a clear\-text POP3 session into an
encrypted POP3 session if the POP server supports it. (Contributed by Lorenzo
Catucci in [bpo\-4473](https://bugs.python.org/issue?@action=redirect&bpo=4473).)

### pprint[¶](#pprint "Link to this heading")

The [`pprint`](../library/pprint.html#module-pprint "pprint: Data pretty printer.") module’s [`PrettyPrinter`](../library/pprint.html#pprint.PrettyPrinter "pprint.PrettyPrinter") class and its
[`pformat()`](../library/pprint.html#pprint.pformat "pprint.pformat"), and [`pprint()`](../library/pprint.html#pprint.pprint "pprint.pprint") functions have a new
option, *compact*, that controls how the output is formatted. Currently
setting *compact* to `True` means that sequences will be printed with as many
sequence elements as will fit within *width* on each (indented) line.
(Contributed by Serhiy Storchaka in [bpo\-19132](https://bugs.python.org/issue?@action=redirect&bpo=19132).)

Long strings are now wrapped using Python’s normal line continuation
syntax. (Contributed by Antoine Pitrou in [bpo\-17150](https://bugs.python.org/issue?@action=redirect&bpo=17150).)

### pty[¶](#pty "Link to this heading")

[`pty.spawn()`](../library/pty.html#pty.spawn "pty.spawn") now returns the status value from [`os.waitpid()`](../library/os.html#os.waitpid "os.waitpid") on
the child process, instead of `None`. (Contributed by Gregory P. Smith.)

### pydoc[¶](#pydoc "Link to this heading")

The [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") module is now based directly on the [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature")
introspection API, allowing it to provide signature information for a wider
variety of callable objects. This change also means that `__wrapped__`
attributes are now taken into account when displaying help information.
(Contributed by Larry Hastings in [bpo\-19674](https://bugs.python.org/issue?@action=redirect&bpo=19674).)

The [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") module no longer displays the `self` parameter for
already bound methods. Instead, it aims to always display the exact current
signature of the supplied callable. (Contributed by Larry Hastings in
[bpo\-20710](https://bugs.python.org/issue?@action=redirect&bpo=20710).)

In addition to the changes that have been made to [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") directly,
its handling of custom `__dir__` methods and various descriptor
behaviours has also been improved substantially by the underlying changes in
the [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") module.

As the [`help()`](../library/functions.html#help "help") builtin is based on [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system."), the above changes also
affect the behaviour of [`help()`](../library/functions.html#help "help").

### re[¶](#re "Link to this heading")

New [`fullmatch()`](../library/re.html#re.fullmatch "re.fullmatch") function and `regex.fullmatch()` method anchor
the pattern at both ends of the string to match. This provides a way to be
explicit about the goal of the match, which avoids a class of subtle bugs where
`$` characters get lost during code changes or the addition of alternatives
to an existing regular expression. (Contributed by Matthew Barnett in
[bpo\-16203](https://bugs.python.org/issue?@action=redirect&bpo=16203).)

The repr of [regex objects](../library/re.html#re-objects) now includes the pattern
and the flags; the repr of [match objects](../library/re.html#match-objects) now
includes the start, end, and the part of the string that matched. (Contributed
by Hugo Lopes Tavares and Serhiy Storchaka in [bpo\-13592](https://bugs.python.org/issue?@action=redirect&bpo=13592) and
[bpo\-17087](https://bugs.python.org/issue?@action=redirect&bpo=17087).)

### resource[¶](#resource "Link to this heading")

New [`prlimit()`](../library/resource.html#resource.prlimit "resource.prlimit") function, available on Linux platforms with a
kernel version of 2\.6\.36 or later and glibc of 2\.13 or later, provides the
ability to query or set the resource limits for processes other than the one
making the call. (Contributed by Christian Heimes in [bpo\-16595](https://bugs.python.org/issue?@action=redirect&bpo=16595).)

On Linux kernel version 2\.6\.36 or later, there are also some new
Linux specific constants: [`RLIMIT_MSGQUEUE`](../library/resource.html#resource.RLIMIT_MSGQUEUE "resource.RLIMIT_MSGQUEUE"),
[`RLIMIT_NICE`](../library/resource.html#resource.RLIMIT_NICE "resource.RLIMIT_NICE"), [`RLIMIT_RTPRIO`](../library/resource.html#resource.RLIMIT_RTPRIO "resource.RLIMIT_RTPRIO"),
[`RLIMIT_RTTIME`](../library/resource.html#resource.RLIMIT_RTTIME "resource.RLIMIT_RTTIME"), and [`RLIMIT_SIGPENDING`](../library/resource.html#resource.RLIMIT_SIGPENDING "resource.RLIMIT_SIGPENDING").
(Contributed by Christian Heimes in [bpo\-19324](https://bugs.python.org/issue?@action=redirect&bpo=19324).)

On FreeBSD version 9 and later, there some new FreeBSD specific constants:
[`RLIMIT_SBSIZE`](../library/resource.html#resource.RLIMIT_SBSIZE "resource.RLIMIT_SBSIZE"), [`RLIMIT_SWAP`](../library/resource.html#resource.RLIMIT_SWAP "resource.RLIMIT_SWAP"), and
[`RLIMIT_NPTS`](../library/resource.html#resource.RLIMIT_NPTS "resource.RLIMIT_NPTS"). (Contributed by Claudiu Popa in
[bpo\-19343](https://bugs.python.org/issue?@action=redirect&bpo=19343).)

### select[¶](#select "Link to this heading")

[`epoll`](../library/select.html#select.epoll "select.epoll") objects now support the context management protocol.
When used in a [`with`](../reference/compound_stmts.html#with) statement, the [`close()`](../library/select.html#select.epoll.close "select.epoll.close")
method will be called automatically at the end of the block. (Contributed
by Serhiy Storchaka in [bpo\-16488](https://bugs.python.org/issue?@action=redirect&bpo=16488).)

[`devpoll`](../library/select.html#select.devpoll "select.devpoll") objects now have [`fileno()`](../library/select.html#select.devpoll.fileno "select.devpoll.fileno") and
[`close()`](../library/select.html#select.devpoll.close "select.devpoll.close") methods, as well as a new attribute
[`closed`](../library/select.html#select.devpoll.closed "select.devpoll.closed"). (Contributed by Victor Stinner in
[bpo\-18794](https://bugs.python.org/issue?@action=redirect&bpo=18794).)

### shelve[¶](#shelve "Link to this heading")

[`Shelf`](../library/shelve.html#shelve.Shelf "shelve.Shelf") instances may now be used in [`with`](../reference/compound_stmts.html#with) statements,
and will be automatically closed at the end of the `with` block.
(Contributed by Filip Gruszczyński in [bpo\-13896](https://bugs.python.org/issue?@action=redirect&bpo=13896).)

### shutil[¶](#shutil "Link to this heading")

[`copyfile()`](../library/shutil.html#shutil.copyfile "shutil.copyfile") now raises a specific [`Error`](../library/shutil.html#shutil.Error "shutil.Error") subclass,
[`SameFileError`](../library/shutil.html#shutil.SameFileError "shutil.SameFileError"), when the source and destination are the same
file, which allows an application to take appropriate action on this specific
error. (Contributed by Atsuo Ishimoto and Hynek Schlawack in
[bpo\-1492704](https://bugs.python.org/issue?@action=redirect&bpo=1492704).)

### smtpd[¶](#smtpd "Link to this heading")

The `SMTPServer` and `SMTPChannel` classes now
accept a *map* keyword argument which, if specified, is passed in to
`asynchat.async_chat` as its *map* argument. This allows an application
to avoid affecting the global socket map. (Contributed by Vinay Sajip in
[bpo\-11959](https://bugs.python.org/issue?@action=redirect&bpo=11959).)

### smtplib[¶](#smtplib "Link to this heading")

[`SMTPException`](../library/smtplib.html#smtplib.SMTPException "smtplib.SMTPException") is now a subclass of [`OSError`](../library/exceptions.html#OSError "OSError"), which allows
both socket level errors and SMTP protocol level errors to be caught in one
try/except statement by code that only cares whether or not an error occurred.
(Contributed by Ned Jackson Lovely in [bpo\-2118](https://bugs.python.org/issue?@action=redirect&bpo=2118).)

### socket[¶](#socket "Link to this heading")

The socket module now supports the [`CAN_BCM`](../library/socket.html#socket.CAN_BCM "socket.CAN_BCM") protocol on
platforms that support it. (Contributed by Brian Thorne in [bpo\-15359](https://bugs.python.org/issue?@action=redirect&bpo=15359).)

Socket objects have new methods to get or set their [inheritable flag](../library/os.html#fd-inheritance), [`get_inheritable()`](../library/socket.html#socket.socket.get_inheritable "socket.socket.get_inheritable") and
[`set_inheritable()`](../library/socket.html#socket.socket.set_inheritable "socket.socket.set_inheritable").

The `socket.AF_*` and `socket.SOCK_*` constants are now enumeration values
using the new [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class.") module. This allows meaningful names to be printed
during debugging, instead of integer “magic numbers”.

The [`AF_LINK`](../library/socket.html#socket.AF_LINK "socket.AF_LINK") constant is now available on BSD and OSX.

[`inet_pton()`](../library/socket.html#socket.inet_pton "socket.inet_pton") and [`inet_ntop()`](../library/socket.html#socket.inet_ntop "socket.inet_ntop") are now supported
on Windows. (Contributed by Atsuo Ishimoto in [bpo\-7171](https://bugs.python.org/issue?@action=redirect&bpo=7171).)

### sqlite3[¶](#sqlite3 "Link to this heading")

A new boolean parameter to the [`connect()`](../library/sqlite3.html#sqlite3.connect "sqlite3.connect") function, *uri*, can be
used to indicate that the *database* parameter is a `uri` (see the [SQLite
URI documentation](https://www.sqlite.org/uri.html)). (Contributed by poq in
[bpo\-13773](https://bugs.python.org/issue?@action=redirect&bpo=13773).)

### ssl[¶](#ssl "Link to this heading")

[`PROTOCOL_TLSv1_1`](../library/ssl.html#ssl.PROTOCOL_TLSv1_1 "ssl.PROTOCOL_TLSv1_1") and [`PROTOCOL_TLSv1_2`](../library/ssl.html#ssl.PROTOCOL_TLSv1_2 "ssl.PROTOCOL_TLSv1_2") (TLSv1\.1 and
TLSv1\.2 support) have been added; support for these protocols is only available if
Python is linked with OpenSSL 1\.0\.1 or later. (Contributed by Michele Orrù and
Antoine Pitrou in [bpo\-16692](https://bugs.python.org/issue?@action=redirect&bpo=16692).)

New function [`create_default_context()`](../library/ssl.html#ssl.create_default_context "ssl.create_default_context") provides a standard way to
obtain an [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") whose settings are intended to be a
reasonable balance between compatibility and security. These settings are
more stringent than the defaults provided by the [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext")
constructor, and may be adjusted in the future, without prior deprecation, if
best\-practice security requirements change. The new recommended best
practice for using stdlib libraries that support SSL is to use
[`create_default_context()`](../library/ssl.html#ssl.create_default_context "ssl.create_default_context") to obtain an [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext")
object, modify it if needed, and then pass it as the *context* argument
of the appropriate stdlib API. (Contributed by Christian Heimes
in [bpo\-19689](https://bugs.python.org/issue?@action=redirect&bpo=19689).)

[`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") method [`load_verify_locations()`](../library/ssl.html#ssl.SSLContext.load_verify_locations "ssl.SSLContext.load_verify_locations")
accepts a new optional argument *cadata*, which can be used to provide PEM or
DER encoded certificates directly via strings or bytes, respectively.
(Contributed by Christian Heimes in [bpo\-18138](https://bugs.python.org/issue?@action=redirect&bpo=18138).)

New function [`get_default_verify_paths()`](../library/ssl.html#ssl.get_default_verify_paths "ssl.get_default_verify_paths") returns
a named tuple of the paths and environment variables that the
[`set_default_verify_paths()`](../library/ssl.html#ssl.SSLContext.set_default_verify_paths "ssl.SSLContext.set_default_verify_paths") method uses to set
OpenSSL’s default `cafile` and `capath`. This can be an aid in
debugging default verification issues. (Contributed by Christian Heimes
in [bpo\-18143](https://bugs.python.org/issue?@action=redirect&bpo=18143).)

[`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") has a new method,
[`cert_store_stats()`](../library/ssl.html#ssl.SSLContext.cert_store_stats "ssl.SSLContext.cert_store_stats"), that reports the number of loaded
`X.509` certs, `X.509 CA` certs, and certificate revocation lists
(`crl`s), as well as a [`get_ca_certs()`](../library/ssl.html#ssl.SSLContext.get_ca_certs "ssl.SSLContext.get_ca_certs") method that
returns a list of the loaded `CA` certificates. (Contributed by Christian
Heimes in [bpo\-18147](https://bugs.python.org/issue?@action=redirect&bpo=18147).)

If OpenSSL 0\.9\.8 or later is available, [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") has a new
attribute [`verify_flags`](../library/ssl.html#ssl.SSLContext.verify_flags "ssl.SSLContext.verify_flags") that can be used to control the
certificate verification process by setting it to some combination of the new
constants [`VERIFY_DEFAULT`](../library/ssl.html#ssl.VERIFY_DEFAULT "ssl.VERIFY_DEFAULT"), [`VERIFY_CRL_CHECK_LEAF`](../library/ssl.html#ssl.VERIFY_CRL_CHECK_LEAF "ssl.VERIFY_CRL_CHECK_LEAF"),
[`VERIFY_CRL_CHECK_CHAIN`](../library/ssl.html#ssl.VERIFY_CRL_CHECK_CHAIN "ssl.VERIFY_CRL_CHECK_CHAIN"), or [`VERIFY_X509_STRICT`](../library/ssl.html#ssl.VERIFY_X509_STRICT "ssl.VERIFY_X509_STRICT").
OpenSSL does not do any CRL verification by default. (Contributed by
Christien Heimes in [bpo\-8813](https://bugs.python.org/issue?@action=redirect&bpo=8813).)

New [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") method [`load_default_certs()`](../library/ssl.html#ssl.SSLContext.load_default_certs "ssl.SSLContext.load_default_certs")
loads a set of default “certificate authority” (CA) certificates from default
locations, which vary according to the platform. It can be used to load both
TLS web server authentication certificates
(`purpose=`[`SERVER_AUTH`](../library/ssl.html#ssl.Purpose.SERVER_AUTH "ssl.Purpose.SERVER_AUTH")) for a client to use to verify a
server, and certificates for a server to use in verifying client certificates
(`purpose=`[`CLIENT_AUTH`](../library/ssl.html#ssl.Purpose.CLIENT_AUTH "ssl.Purpose.CLIENT_AUTH")). (Contributed by Christian
Heimes in [bpo\-19292](https://bugs.python.org/issue?@action=redirect&bpo=19292).)

Two new windows\-only functions, [`enum_certificates()`](../library/ssl.html#ssl.enum_certificates "ssl.enum_certificates") and
[`enum_crls()`](../library/ssl.html#ssl.enum_crls "ssl.enum_crls") provide the ability to retrieve certificates,
certificate information, and CRLs from the Windows cert store. (Contributed
by Christian Heimes in [bpo\-17134](https://bugs.python.org/issue?@action=redirect&bpo=17134).)

Support for server\-side SNI (Server Name Indication) using the new
[`ssl.SSLContext.set_servername_callback()`](../library/ssl.html#ssl.SSLContext.set_servername_callback "ssl.SSLContext.set_servername_callback") method.
(Contributed by Daniel Black in [bpo\-8109](https://bugs.python.org/issue?@action=redirect&bpo=8109).)

The dictionary returned by [`SSLSocket.getpeercert()`](../library/ssl.html#ssl.SSLSocket.getpeercert "ssl.SSLSocket.getpeercert") contains additional
`X509v3` extension items: `crlDistributionPoints`, `calIssuers`, and
`OCSP` URIs. (Contributed by Christian Heimes in [bpo\-18379](https://bugs.python.org/issue?@action=redirect&bpo=18379).)

### stat[¶](#stat "Link to this heading")

The [`stat`](../library/stat.html#module-stat "stat: Utilities for interpreting the results of os.stat(), os.lstat() and os.fstat().") module is now backed by a C implementation in `_stat`. A C
implementation is required as most of the values aren’t standardized and
are platform\-dependent. (Contributed by Christian Heimes in [bpo\-11016](https://bugs.python.org/issue?@action=redirect&bpo=11016).)

The module supports new [`ST_MODE`](../library/stat.html#stat.ST_MODE "stat.ST_MODE") flags, [`S_IFDOOR`](../library/stat.html#stat.S_IFDOOR "stat.S_IFDOOR"),
[`S_IFPORT`](../library/stat.html#stat.S_IFPORT "stat.S_IFPORT"), and [`S_IFWHT`](../library/stat.html#stat.S_IFWHT "stat.S_IFWHT"). (Contributed by
Christian Hiemes in [bpo\-11016](https://bugs.python.org/issue?@action=redirect&bpo=11016).)

### struct[¶](#struct "Link to this heading")

New function [`iter_unpack`](../library/struct.html#struct.iter_unpack "struct.iter_unpack") and a new
[`struct.Struct.iter_unpack()`](../library/struct.html#struct.Struct.iter_unpack "struct.Struct.iter_unpack") method on compiled formats provide streamed
unpacking of a buffer containing repeated instances of a given format of data.
(Contributed by Antoine Pitrou in [bpo\-17804](https://bugs.python.org/issue?@action=redirect&bpo=17804).)

### subprocess[¶](#subprocess "Link to this heading")

[`check_output()`](../library/subprocess.html#subprocess.check_output "subprocess.check_output") now accepts an *input* argument that can
be used to provide the contents of `stdin` for the command that is run.
(Contributed by Zack Weinberg in [bpo\-16624](https://bugs.python.org/issue?@action=redirect&bpo=16624).)

`getstatus()` and [`getstatusoutput()`](../library/subprocess.html#subprocess.getstatusoutput "subprocess.getstatusoutput") now
work on Windows. This change was actually inadvertently made in 3\.3\.4\.
(Contributed by Tim Golden in [bpo\-10197](https://bugs.python.org/issue?@action=redirect&bpo=10197).)

### sunau[¶](#sunau "Link to this heading")

The `getparams()` method now returns a namedtuple rather than a
plain tuple. (Contributed by Claudiu Popa in [bpo\-18901](https://bugs.python.org/issue?@action=redirect&bpo=18901).)

`sunau.open()` now supports the context management protocol: when used in a
[`with`](../reference/compound_stmts.html#with) block, the `close` method of the returned object will be
called automatically at the end of the block. (Contributed by Serhiy Storchaka
in [bpo\-18878](https://bugs.python.org/issue?@action=redirect&bpo=18878).)

`AU_write.setsampwidth()` now supports 24 bit samples, thus adding
support for writing 24 sample using the module. (Contributed by
Serhiy Storchaka in [bpo\-19261](https://bugs.python.org/issue?@action=redirect&bpo=19261).)

The `writeframesraw()` and
`writeframes()` methods now accept any [bytes\-like
object](../glossary.html#term-bytes-like-object). (Contributed by Serhiy Storchaka in [bpo\-8311](https://bugs.python.org/issue?@action=redirect&bpo=8311).)

### sys[¶](#sys "Link to this heading")

New function [`sys.getallocatedblocks()`](../library/sys.html#sys.getallocatedblocks "sys.getallocatedblocks") returns the current number of
blocks allocated by the interpreter. (In CPython with the default
`--with-pymalloc` setting, this is allocations made through the
[`PyObject_Malloc()`](../c-api/memory.html#c.PyObject_Malloc "PyObject_Malloc") API.) This can be useful for tracking memory leaks,
especially if automated via a test suite. (Contributed by Antoine Pitrou
in [bpo\-13390](https://bugs.python.org/issue?@action=redirect&bpo=13390).)

When the Python interpreter starts in [interactive mode](../tutorial/interpreter.html#tut-interactive), it checks for an [`__interactivehook__`](../library/sys.html#sys.__interactivehook__ "sys.__interactivehook__") attribute
on the [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") module. If the attribute exists, its value is called with no
arguments just before interactive mode is started. The check is made after the
[`PYTHONSTARTUP`](../using/cmdline.html#envvar-PYTHONSTARTUP) file is read, so it can be set there. The [`site`](../library/site.html#module-site "site: Module responsible for site-specific configuration.")
module [sets it](../library/site.html#rlcompleter-config) to a function that enables tab
completion and history saving (in `~/.python-history`) if the platform
supports [`readline`](../library/readline.html#module-readline "readline: GNU readline support for Python. (Unix)"). If you do not want this (new) behavior, you can
override it in [`PYTHONSTARTUP`](../using/cmdline.html#envvar-PYTHONSTARTUP), [`sitecustomize`](../library/site.html#module-sitecustomize "sitecustomize"), or
[`usercustomize`](../library/site.html#module-usercustomize "usercustomize") by deleting this attribute from [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") (or setting it
to some other callable). (Contributed by Éric Araujo and Antoine Pitrou in
[bpo\-5845](https://bugs.python.org/issue?@action=redirect&bpo=5845).)

### tarfile[¶](#tarfile "Link to this heading")

The [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") module now supports a simple [Command\-Line Interface](../library/tarfile.html#tarfile-commandline) when
called as a script directly or via `-m`. This can be used to create and
extract tarfile archives. (Contributed by Berker Peksag in [bpo\-13477](https://bugs.python.org/issue?@action=redirect&bpo=13477).)

### textwrap[¶](#textwrap "Link to this heading")

The [`TextWrapper`](../library/textwrap.html#textwrap.TextWrapper "textwrap.TextWrapper") class has two new attributes/constructor
arguments: [`max_lines`](../library/textwrap.html#textwrap.TextWrapper.max_lines "textwrap.TextWrapper.max_lines"), which limits the number of
lines in the output, and [`placeholder`](../library/textwrap.html#textwrap.TextWrapper.placeholder "textwrap.TextWrapper.placeholder"), which is a
string that will appear at the end of the output if it has been truncated
because of *max\_lines*. Building on these capabilities, a new convenience
function [`shorten()`](../library/textwrap.html#textwrap.shorten "textwrap.shorten") collapses all of the whitespace in the input
to single spaces and produces a single line of a given *width* that ends with
the *placeholder* (by default, `[...]`). (Contributed by Antoine Pitrou and
Serhiy Storchaka in [bpo\-18585](https://bugs.python.org/issue?@action=redirect&bpo=18585) and [bpo\-18725](https://bugs.python.org/issue?@action=redirect&bpo=18725).)

### threading[¶](#threading "Link to this heading")

The [`Thread`](../library/threading.html#threading.Thread "threading.Thread") object representing the main thread can be
obtained from the new [`main_thread()`](../library/threading.html#threading.main_thread "threading.main_thread") function. In normal
conditions this will be the thread from which the Python interpreter was
started. (Contributed by Andrew Svetlov in [bpo\-18882](https://bugs.python.org/issue?@action=redirect&bpo=18882).)

### traceback[¶](#traceback "Link to this heading")

A new [`traceback.clear_frames()`](../library/traceback.html#traceback.clear_frames "traceback.clear_frames") function takes a traceback object
and clears the local variables in all of the frames it references,
reducing the amount of memory consumed. (Contributed by Andrew Kuchling in
[bpo\-1565525](https://bugs.python.org/issue?@action=redirect&bpo=1565525).)

### types[¶](#types "Link to this heading")

A new [`DynamicClassAttribute()`](../library/types.html#types.DynamicClassAttribute "types.DynamicClassAttribute") descriptor provides a way to define
an attribute that acts normally when looked up through an instance object, but
which is routed to the *class* `__getattr__` when looked up through the
class. This allows one to have properties active on a class, and have virtual
attributes on the class with the same name (see `Enum` for an example).
(Contributed by Ethan Furman in [bpo\-19030](https://bugs.python.org/issue?@action=redirect&bpo=19030).)

### urllib[¶](#urllib "Link to this heading")

[`urllib.request`](../library/urllib.request.html#module-urllib.request "urllib.request: Extensible library for opening URLs.") now supports `data:` URLs via the
[`DataHandler`](../library/urllib.request.html#urllib.request.DataHandler "urllib.request.DataHandler") class. (Contributed by Mathias Panzenböck
in [bpo\-16423](https://bugs.python.org/issue?@action=redirect&bpo=16423).)

The http method that will be used by a [`Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request") class
can now be specified by setting a [`method`](../library/urllib.request.html#urllib.request.Request.method "urllib.request.Request.method")
class attribute on the subclass. (Contributed by Jason R Coombs in
[bpo\-18978](https://bugs.python.org/issue?@action=redirect&bpo=18978).)

[`Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request") objects are now reusable: if the
[`full_url`](../library/urllib.request.html#urllib.request.Request.full_url "urllib.request.Request.full_url") or [`data`](../library/urllib.request.html#urllib.request.Request.data "urllib.request.Request.data")
attributes are modified, all relevant internal properties are updated. This
means, for example, that it is now possible to use the same
[`Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request") object in more than one
[`OpenerDirector.open()`](../library/urllib.request.html#urllib.request.OpenerDirector.open "urllib.request.OpenerDirector.open") call with different *data* arguments, or to
modify a [`Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request")‘s `url` rather than recomputing it
from scratch. There is also a new
[`remove_header()`](../library/urllib.request.html#urllib.request.Request.remove_header "urllib.request.Request.remove_header") method that can be used to remove
headers from a [`Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request"). (Contributed by Alexey
Kachayev in [bpo\-16464](https://bugs.python.org/issue?@action=redirect&bpo=16464), Daniel Wozniak in [bpo\-17485](https://bugs.python.org/issue?@action=redirect&bpo=17485), and Damien Brecht
and Senthil Kumaran in [bpo\-17272](https://bugs.python.org/issue?@action=redirect&bpo=17272).)

[`HTTPError`](../library/urllib.error.html#urllib.error.HTTPError "urllib.error.HTTPError") objects now have a
[`headers`](../library/urllib.error.html#urllib.error.HTTPError.headers "urllib.error.HTTPError.headers") attribute that provides access to the
HTTP response headers associated with the error. (Contributed by
Berker Peksag in [bpo\-15701](https://bugs.python.org/issue?@action=redirect&bpo=15701).)

### unittest[¶](#unittest "Link to this heading")

The [`TestCase`](../library/unittest.html#unittest.TestCase "unittest.TestCase") class has a new method,
[`subTest()`](../library/unittest.html#unittest.TestCase.subTest "unittest.TestCase.subTest"), that produces a context manager whose
[`with`](../reference/compound_stmts.html#with) block becomes a “sub\-test”. This context manager allows a test
method to dynamically generate subtests by, say, calling the `subTest`
context manager inside a loop. A single test method can thereby produce an
indefinite number of separately identified and separately counted tests, all of
which will run even if one or more of them fail. For example:

\`\`\`
class NumbersTest(unittest.TestCase):
 def test\_even(self):
 for i in range(6\):
 with self.subTest(i=i):
 self.assertEqual(i % 2, 0\)

\`\`\`

will result in six subtests, each identified in the unittest verbose output
with a label consisting of the variable name `i` and a particular value for
that variable (`i=0`, `i=1`, etc). See [Distinguishing test iterations using subtests](../library/unittest.html#subtests) for the full
version of this example. (Contributed by Antoine Pitrou in [bpo\-16997](https://bugs.python.org/issue?@action=redirect&bpo=16997).)

[`unittest.main()`](../library/unittest.html#unittest.main "unittest.main") now accepts an iterable of test names for
*defaultTest*, where previously it only accepted a single test name as a
string. (Contributed by Jyrki Pulliainen in [bpo\-15132](https://bugs.python.org/issue?@action=redirect&bpo=15132).)

If [`SkipTest`](../library/unittest.html#unittest.SkipTest "unittest.SkipTest") is raised during test discovery (that is, at the
module level in the test file), it is now reported as a skip instead of an
error. (Contributed by Zach Ware in [bpo\-16935](https://bugs.python.org/issue?@action=redirect&bpo=16935).)

[`discover()`](../library/unittest.html#unittest.TestLoader.discover "unittest.TestLoader.discover") now sorts the discovered files to provide
consistent test ordering. (Contributed by Martin Melin and Jeff Ramnani in
[bpo\-16709](https://bugs.python.org/issue?@action=redirect&bpo=16709).)

[`TestSuite`](../library/unittest.html#unittest.TestSuite "unittest.TestSuite") now drops references to tests as soon as the test
has been run, if the test is successful. On Python interpreters that do
garbage collection, this allows the tests to be garbage collected if nothing
else is holding a reference to the test. It is possible to override this
behavior by creating a [`TestSuite`](../library/unittest.html#unittest.TestSuite "unittest.TestSuite") subclass that defines a
custom `_removeTestAtIndex` method. (Contributed by Tom Wardill, Matt
McClure, and Andrew Svetlov in [bpo\-11798](https://bugs.python.org/issue?@action=redirect&bpo=11798).)

A new test assertion context\-manager, [`assertLogs()`](../library/unittest.html#unittest.TestCase.assertLogs "unittest.TestCase.assertLogs"),
will ensure that a given block of code emits a log message using the
[`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications.") module. By default the message can come from any logger and
have a priority of `INFO` or higher, but both the logger name and an
alternative minimum logging level may be specified. The object returned by the
context manager can be queried for the [`LogRecord`](../library/logging.html#logging.LogRecord "logging.LogRecord")s and/or
formatted messages that were logged. (Contributed by Antoine Pitrou in
[bpo\-18937](https://bugs.python.org/issue?@action=redirect&bpo=18937).)

Test discovery now works with namespace packages (Contributed by Claudiu Popa
in [bpo\-17457](https://bugs.python.org/issue?@action=redirect&bpo=17457).)

[`unittest.mock`](../library/unittest.mock.html#module-unittest.mock "unittest.mock: Mock object library.") objects now inspect their specification signatures when
matching calls, which means an argument can now be matched by either position
or name, instead of only by position. (Contributed by Antoine Pitrou in
[bpo\-17015](https://bugs.python.org/issue?@action=redirect&bpo=17015).)

`mock_open()` objects now have `readline` and `readlines`
methods. (Contributed by Toshio Kuratomi in [bpo\-17467](https://bugs.python.org/issue?@action=redirect&bpo=17467).)

### venv[¶](#venv "Link to this heading")

[`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") now includes activation scripts for the `csh` and `fish`
shells. (Contributed by Andrew Svetlov in [bpo\-15417](https://bugs.python.org/issue?@action=redirect&bpo=15417).)

[`EnvBuilder`](../library/venv.html#venv.EnvBuilder "venv.EnvBuilder") and the [`create()`](../library/venv.html#venv.create "venv.create") convenience function
take a new keyword argument *with\_pip*, which defaults to `False`, that
controls whether or not [`EnvBuilder`](../library/venv.html#venv.EnvBuilder "venv.EnvBuilder") ensures that `pip` is
installed in the virtual environment. (Contributed by Nick Coghlan in
[bpo\-19552](https://bugs.python.org/issue?@action=redirect&bpo=19552) as part of the [**PEP 453**](https://peps.python.org/pep-0453/) implementation.)

### wave[¶](#wave "Link to this heading")

The `getparams()` method now returns a namedtuple rather than a
plain tuple. (Contributed by Claudiu Popa in [bpo\-17487](https://bugs.python.org/issue?@action=redirect&bpo=17487).)

[`wave.open()`](../library/wave.html#wave.open "wave.open") now supports the context management protocol. (Contributed
by Claudiu Popa in [bpo\-17616](https://bugs.python.org/issue?@action=redirect&bpo=17616).)

[`wave`](../library/wave.html#module-wave "wave: Provide an interface to the WAV sound format.") can now [write output to unseekable files](../library/wave.html#wave-write-objects). (Contributed by David Jones, Guilherme Polo, and Serhiy
Storchaka in [bpo\-5202](https://bugs.python.org/issue?@action=redirect&bpo=5202).)

The [`writeframesraw()`](../library/wave.html#wave.Wave_write.writeframesraw "wave.Wave_write.writeframesraw") and
[`writeframes()`](../library/wave.html#wave.Wave_write.writeframes "wave.Wave_write.writeframes") methods now accept any [bytes\-like
object](../glossary.html#term-bytes-like-object). (Contributed by Serhiy Storchaka in [bpo\-8311](https://bugs.python.org/issue?@action=redirect&bpo=8311).)

### weakref[¶](#weakref "Link to this heading")

New [`WeakMethod`](../library/weakref.html#weakref.WeakMethod "weakref.WeakMethod") class simulates weak references to bound
methods. (Contributed by Antoine Pitrou in [bpo\-14631](https://bugs.python.org/issue?@action=redirect&bpo=14631).)

New [`finalize`](../library/weakref.html#weakref.finalize "weakref.finalize") class makes it possible to register a callback
to be invoked when an object is garbage collected, without needing to
carefully manage the lifecycle of the weak reference itself. (Contributed by
Richard Oudkerk in [bpo\-15528](https://bugs.python.org/issue?@action=redirect&bpo=15528).)

The callback, if any, associated with a [`ref`](../library/weakref.html#weakref.ref "weakref.ref") is now
exposed via the [`__callback__`](../library/weakref.html#weakref.ref.__callback__ "weakref.ref.__callback__") attribute. (Contributed
by Mark Dickinson in [bpo\-17643](https://bugs.python.org/issue?@action=redirect&bpo=17643).)

### xml.etree[¶](#xml-etree "Link to this heading")

A new parser, [`XMLPullParser`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLPullParser "xml.etree.ElementTree.XMLPullParser"), allows a
non\-blocking applications to parse XML documents. An example can be
seen at [Pull API for non\-blocking parsing](../library/xml.etree.elementtree.html#elementtree-pull-parsing). (Contributed by Antoine
Pitrou in [bpo\-17741](https://bugs.python.org/issue?@action=redirect&bpo=17741).)

The [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") [`tostring()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.tostring "xml.etree.ElementTree.tostring") and
[`tostringlist()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.tostringlist "xml.etree.ElementTree.tostringlist") functions, and the
[`ElementTree`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.ElementTree "xml.etree.ElementTree.ElementTree")
[`write()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.ElementTree.write "xml.etree.ElementTree.ElementTree.write") method, now have a
*short\_empty\_elements* [keyword\-only parameter](../glossary.html#keyword-only-parameter)
providing control over whether elements with no content are written in
abbreviated (``) or expanded (``) form. (Contributed by
Ariel Poliak and Serhiy Storchaka in [bpo\-14377](https://bugs.python.org/issue?@action=redirect&bpo=14377).)

### zipfile[¶](#zipfile "Link to this heading")

The [`writepy()`](../library/zipfile.html#zipfile.PyZipFile.writepy "zipfile.PyZipFile.writepy") method of the
[`PyZipFile`](../library/zipfile.html#zipfile.PyZipFile "zipfile.PyZipFile") class has a new *filterfunc* option that can be
used to control which directories and files are added to the archive. For
example, this could be used to exclude test files from the archive.
(Contributed by Christian Tismer in [bpo\-19274](https://bugs.python.org/issue?@action=redirect&bpo=19274).)

The *allowZip64* parameter to [`ZipFile`](../library/zipfile.html#zipfile.ZipFile "zipfile.ZipFile") and
`PyZipfile` is now `True` by default. (Contributed by
William Mallard in [bpo\-17201](https://bugs.python.org/issue?@action=redirect&bpo=17201).)

## CPython Implementation Changes[¶](#cpython-implementation-changes "Link to this heading")

### PEP 445: Customization of CPython Memory Allocators[¶](#pep-445-customization-of-cpython-memory-allocators "Link to this heading")

[**PEP 445**](https://peps.python.org/pep-0445/) adds new C level interfaces to customize memory allocation in
the CPython interpreter.

See also

[**PEP 445**](https://peps.python.org/pep-0445/) – Add new APIs to customize Python memory allocatorsPEP written and implemented by Victor Stinner.

### PEP 442: Safe Object Finalization[¶](#pep-442-safe-object-finalization "Link to this heading")

[**PEP 442**](https://peps.python.org/pep-0442/) removes the current limitations and quirks of object finalization
in CPython. With it, objects with `__del__()` methods, as well as
generators with [`finally`](../reference/compound_stmts.html#finally) clauses, can be finalized when they are
part of a reference cycle.

As part of this change, module globals are no longer forcibly set to
[`None`](../library/constants.html#None "None") during interpreter shutdown in most cases, instead relying
on the normal operation of the cyclic garbage collector. This avoids a
whole class of interpreter\-shutdown\-time errors, usually involving
`__del__` methods, that have plagued Python since the cyclic GC
was first introduced.

See also

[**PEP 442**](https://peps.python.org/pep-0442/) – Safe object finalizationPEP written and implemented by Antoine Pitrou.

### PEP 456: Secure and Interchangeable Hash Algorithm[¶](#pep-456-secure-and-interchangeable-hash-algorithm "Link to this heading")

[**PEP 456**](https://peps.python.org/pep-0456/) follows up on earlier security fix work done on Python’s hash
algorithm to address certain DOS attacks to which public facing APIs backed by
dictionary lookups may be subject. (See [bpo\-14621](https://bugs.python.org/issue?@action=redirect&bpo=14621) for the start of the
current round of improvements.) The PEP unifies CPython’s hash code to make it
easier for a packager to substitute a different hash algorithm, and switches
Python’s default implementation to a SipHash implementation on platforms that
have a 64 bit data type. Any performance differences in comparison with the
older FNV algorithm are trivial.

The PEP adds additional fields to the [`sys.hash_info`](../library/sys.html#sys.hash_info "sys.hash_info") named tuple to
describe the hash algorithm in use by the currently executing binary. Otherwise,
the PEP does not alter any existing CPython APIs.

### PEP 436: Argument Clinic[¶](#pep-436-argument-clinic "Link to this heading")

“Argument Clinic” ([**PEP 436**](https://peps.python.org/pep-0436/)) is now part of the CPython build process
and can be used to simplify the process of defining and maintaining
accurate signatures for builtins and standard library extension modules
implemented in C.

Some standard library extension modules have been converted to use Argument
Clinic in Python 3\.4, and [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") and [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") have been updated
accordingly.

It is expected that signature metadata for programmatic introspection will
be added to additional callables implemented in C as part of Python 3\.4
maintenance releases.

Note

The Argument Clinic PEP is not fully up to date with the state of the
implementation. This has been deemed acceptable by the release manager
and core development team in this case, as Argument Clinic will not
be made available as a public API for third party use in Python 3\.4\.

See also

[**PEP 436**](https://peps.python.org/pep-0436/) – The Argument Clinic DSLPEP written and implemented by Larry Hastings.

### Other Build and C API Changes[¶](#other-build-and-c-api-changes "Link to this heading")

* The new [`PyType_GetSlot()`](../c-api/type.html#c.PyType_GetSlot "PyType_GetSlot") function has been added to the stable ABI,
allowing retrieval of function pointers from named type slots when using
the limited API. (Contributed by Martin von Löwis in [bpo\-17162](https://bugs.python.org/issue?@action=redirect&bpo=17162).)
* The new `Py_SetStandardStreamEncoding()` pre\-initialization API
allows applications embedding the CPython interpreter to reliably force
a particular encoding and error handler for the standard streams.
(Contributed by Bastien Montagne and Nick Coghlan in [bpo\-16129](https://bugs.python.org/issue?@action=redirect&bpo=16129).)
* Most Python C APIs that don’t mutate string arguments are now correctly
marked as accepting `const char *` rather than `char *`. (Contributed
by Serhiy Storchaka in [bpo\-1772673](https://bugs.python.org/issue?@action=redirect&bpo=1772673).)
* A new shell version of `python-config` can be used even when a python
interpreter is not available (for example, in cross compilation scenarios).
* [`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat") now supports width and precision
specifications for `%s`, `%A`, `%U`, `%V`, `%S`, and `%R`.
(Contributed by Ysj Ray and Victor Stinner in [bpo\-7330](https://bugs.python.org/issue?@action=redirect&bpo=7330).)
* New function [`PyStructSequence_InitType2()`](../c-api/tuple.html#c.PyStructSequence_InitType2 "PyStructSequence_InitType2") supplements the
existing [`PyStructSequence_InitType()`](../c-api/tuple.html#c.PyStructSequence_InitType "PyStructSequence_InitType") function. The difference
is that it returns `0` on success and `-1` on failure.
* The CPython source can now be compiled using the address sanity checking
features of recent versions of GCC and clang: the false alarms in the small
object allocator have been silenced. (Contributed by Dhiru Kholia in
[bpo\-18596](https://bugs.python.org/issue?@action=redirect&bpo=18596).)
* The Windows build now uses [Address Space Layout Randomization](https://en.wikipedia.org/wiki/Address_space_layout_randomization) and [Data Execution Prevention](https://en.wikipedia.org/wiki/Data_Execution_Prevention). (Contributed by
Christian Heimes in [bpo\-16632](https://bugs.python.org/issue?@action=redirect&bpo=16632).)
* New function [`PyObject_LengthHint()`](../c-api/object.html#c.PyObject_LengthHint "PyObject_LengthHint") is the C API equivalent
of [`operator.length_hint()`](../library/operator.html#operator.length_hint "operator.length_hint"). (Contributed by Armin Ronacher in
[bpo\-16148](https://bugs.python.org/issue?@action=redirect&bpo=16148).)

### Other Improvements[¶](#other-improvements "Link to this heading")

* The [python](../using/cmdline.html#using-on-cmdline) command has a new [option](../using/cmdline.html#using-on-misc-options), `-I`, which causes it to run in “isolated mode”,
which means that [`sys.path`](../library/sys.html#sys.path "sys.path") contains neither the script’s directory nor
the user’s `site-packages` directory, and all `PYTHON*` environment
variables are ignored (it implies both `-s` and `-E`). Other
restrictions may also be applied in the future, with the goal being to
isolate the execution of a script from the user’s environment. This is
appropriate, for example, when Python is used to run a system script. On
most POSIX systems it can and should be used in the `#!` line of system
scripts. (Contributed by Christian Heimes in [bpo\-16499](https://bugs.python.org/issue?@action=redirect&bpo=16499).)
* Tab\-completion is now enabled by default in the interactive interpreter
on systems that support [`readline`](../library/readline.html#module-readline "readline: GNU readline support for Python. (Unix)"). History is also enabled by default,
and is written to (and read from) the file `~/.python-history`.
(Contributed by Antoine Pitrou and Éric Araujo in [bpo\-5845](https://bugs.python.org/issue?@action=redirect&bpo=5845).)
* Invoking the Python interpreter with `--version` now outputs the version to
standard output instead of standard error ([bpo\-18338](https://bugs.python.org/issue?@action=redirect&bpo=18338)). Similar changes
were made to [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") ([bpo\-18920](https://bugs.python.org/issue?@action=redirect&bpo=18920)) and other modules that have
script\-like invocation capabilities ([bpo\-18922](https://bugs.python.org/issue?@action=redirect&bpo=18922)).
* The CPython Windows installer now adds `.py` to the `PATHEXT`
variable when extensions are registered, allowing users to run a python
script at the windows command prompt by just typing its name without the
`.py` extension. (Contributed by Paul Moore in [bpo\-18569](https://bugs.python.org/issue?@action=redirect&bpo=18569).)
* A new `make` target [coverage\-report](https://devguide.python.org/coverage/#measuring-coverage-of-c-code-with-gcov-and-lcov)
will build python, run the test suite, and generate an HTML coverage report
for the C codebase using `gcov` and [lcov](https://github.com/linux-test-project/lcov).
* The `-R` option to the [python regression test suite](../library/test.html#regrtest) now
also checks for memory allocation leaks, using
[`sys.getallocatedblocks()`](../library/sys.html#sys.getallocatedblocks "sys.getallocatedblocks"). (Contributed by Antoine Pitrou in
[bpo\-13390](https://bugs.python.org/issue?@action=redirect&bpo=13390).)
* `python -m` now works with namespace packages.
* The [`stat`](../library/stat.html#module-stat "stat: Utilities for interpreting the results of os.stat(), os.lstat() and os.fstat().") module is now implemented in C, which means it gets the
values for its constants from the C header files, instead of having the
values hard\-coded in the python module as was previously the case.
* Loading multiple python modules from a single OS module (`.so`, `.dll`)
now works correctly (previously it silently returned the first python
module in the file). (Contributed by Václav Šmilauer in [bpo\-16421](https://bugs.python.org/issue?@action=redirect&bpo=16421).)
* A new opcode, `LOAD_CLASSDEREF`, has been added to fix a bug in the
loading of free variables in class bodies that could be triggered by certain
uses of [\_\_prepare\_\_](../reference/datamodel.html#prepare). (Contributed by Benjamin Peterson in
[bpo\-17853](https://bugs.python.org/issue?@action=redirect&bpo=17853).)
* A number of MemoryError\-related crashes were identified and fixed by Victor
Stinner using his [**PEP 445**](https://peps.python.org/pep-0445/)\-based `pyfailmalloc` tool ([bpo\-18408](https://bugs.python.org/issue?@action=redirect&bpo=18408),
[bpo\-18520](https://bugs.python.org/issue?@action=redirect&bpo=18520)).
* The `pyvenv` command now accepts a `--copies` option
to use copies rather than symlinks even on systems where symlinks are the
default. (Contributed by Vinay Sajip in [bpo\-18807](https://bugs.python.org/issue?@action=redirect&bpo=18807).)
* The `pyvenv` command also accepts a `--without-pip`
option to suppress the otherwise\-automatic bootstrapping of pip into
the virtual environment. (Contributed by Nick Coghlan in [bpo\-19552](https://bugs.python.org/issue?@action=redirect&bpo=19552)
as part of the [**PEP 453**](https://peps.python.org/pep-0453/) implementation.)
* The encoding name is now optional in the value set for the
[`PYTHONIOENCODING`](../using/cmdline.html#envvar-PYTHONIOENCODING) environment variable. This makes it possible to
set just the error handler, without changing the default encoding.
(Contributed by Serhiy Storchaka in [bpo\-18818](https://bugs.python.org/issue?@action=redirect&bpo=18818).)
* The [`bz2`](../library/bz2.html#module-bz2 "bz2: Interfaces for bzip2 compression and decompression."), [`lzma`](../library/lzma.html#module-lzma "lzma: A Python wrapper for the liblzma compression library."), and [`gzip`](../library/gzip.html#module-gzip "gzip: Interfaces for gzip compression and decompression using file objects.") module `open` functions now
support `x` (exclusive creation) mode. (Contributed by Tim Heaney and
Vajrasky Kok in [bpo\-19201](https://bugs.python.org/issue?@action=redirect&bpo=19201), [bpo\-19222](https://bugs.python.org/issue?@action=redirect&bpo=19222), and [bpo\-19223](https://bugs.python.org/issue?@action=redirect&bpo=19223).)

### Significant Optimizations[¶](#significant-optimizations "Link to this heading")

* The UTF\-32 decoder is now 3x to 4x faster. (Contributed by Serhiy Storchaka
in [bpo\-14625](https://bugs.python.org/issue?@action=redirect&bpo=14625).)
* The cost of hash collisions for sets is now reduced. Each hash table
probe now checks a series of consecutive, adjacent key/hash pairs before
continuing to make random probes through the hash table. This exploits
cache locality to make collision resolution less expensive.
The collision resolution scheme can be described as a hybrid of linear
probing and open addressing. The number of additional linear probes
defaults to nine. This can be changed at compile\-time by defining
LINEAR\_PROBES to be any value. Set LINEAR\_PROBES=0 to turn\-off
linear probing entirely. (Contributed by Raymond Hettinger in
[bpo\-18771](https://bugs.python.org/issue?@action=redirect&bpo=18771).)
* The interpreter starts about 30% faster. A couple of measures lead to the
speedup. The interpreter loads fewer modules on startup, e.g. the [`re`](../library/re.html#module-re "re: Regular expression operations."),
[`collections`](../library/collections.html#module-collections "collections: Container datatypes") and [`locale`](../library/locale.html#module-locale "locale: Internationalization services.") modules and their dependencies are no
longer imported by default. The marshal module has been improved to load
compiled Python code faster. (Contributed by Antoine Pitrou, Christian
Heimes and Victor Stinner in [bpo\-19219](https://bugs.python.org/issue?@action=redirect&bpo=19219), [bpo\-19218](https://bugs.python.org/issue?@action=redirect&bpo=19218), [bpo\-19209](https://bugs.python.org/issue?@action=redirect&bpo=19209),
[bpo\-19205](https://bugs.python.org/issue?@action=redirect&bpo=19205) and [bpo\-9548](https://bugs.python.org/issue?@action=redirect&bpo=9548).)
* [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") is now as fast or faster than the Python2 version for
most cases. [`lzma.LZMAFile`](../library/lzma.html#lzma.LZMAFile "lzma.LZMAFile") has also been optimized. (Contributed by
Serhiy Storchaka and Nadeem Vawda in [bpo\-16034](https://bugs.python.org/issue?@action=redirect&bpo=16034).)
* [`random.getrandbits()`](../library/random.html#random.getrandbits "random.getrandbits") is 20%\-40% faster for small integers (the most
common use case). (Contributed by Serhiy Storchaka in [bpo\-16674](https://bugs.python.org/issue?@action=redirect&bpo=16674).)
* By taking advantage of the new storage format for strings, pickling of
strings is now significantly faster. (Contributed by Victor Stinner and
Antoine Pitrou in [bpo\-15596](https://bugs.python.org/issue?@action=redirect&bpo=15596).)
* A performance issue in `io.FileIO.readall()` has been solved. This
particularly affects Windows, and significantly speeds up the case of piping
significant amounts of data through [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management."). (Contributed
by Richard Oudkerk in [bpo\-15758](https://bugs.python.org/issue?@action=redirect&bpo=15758).)
* [`html.escape()`](../library/html.html#html.escape "html.escape") is now 10x faster. (Contributed by Matt Bryant in
[bpo\-18020](https://bugs.python.org/issue?@action=redirect&bpo=18020).)
* On Windows, the native `VirtualAlloc` is now used instead of the CRT
`malloc` in `obmalloc`. Artificial benchmarks show about a 3% memory
savings.
* [`os.urandom()`](../library/os.html#os.urandom "os.urandom") now uses a lazily opened persistent file descriptor
so as to avoid using many file descriptors when run in parallel from
multiple threads. (Contributed by Antoine Pitrou in [bpo\-18756](https://bugs.python.org/issue?@action=redirect&bpo=18756).)

## Deprecated[¶](#deprecated "Link to this heading")

This section covers various APIs and other features that have been deprecated
in Python 3\.4, and will be removed in Python 3\.5 or later. In most (but not
all) cases, using the deprecated APIs will produce a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning")
when the interpreter is run with deprecation warnings enabled (for example, by
using `-Wd`).

### Deprecations in the Python API[¶](#deprecations-in-the-python-api "Link to this heading")

* As mentioned in [PEP 451: A ModuleSpec Type for the Import System](#whatsnew-pep-451), a number of [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.")
methods and functions are deprecated: `importlib.find_loader()` is
replaced by [`importlib.util.find_spec()`](../library/importlib.html#importlib.util.find_spec "importlib.util.find_spec");
`importlib.machinery.PathFinder.find_module()` is replaced by
[`importlib.machinery.PathFinder.find_spec()`](../library/importlib.html#importlib.machinery.PathFinder.find_spec "importlib.machinery.PathFinder.find_spec");
`importlib.abc.MetaPathFinder.find_module()` is replaced by
[`importlib.abc.MetaPathFinder.find_spec()`](../library/importlib.html#importlib.abc.MetaPathFinder.find_spec "importlib.abc.MetaPathFinder.find_spec");
`importlib.abc.PathEntryFinder.find_loader()` and
`find_module()` are replaced by
[`importlib.abc.PathEntryFinder.find_spec()`](../library/importlib.html#importlib.abc.PathEntryFinder.find_spec "importlib.abc.PathEntryFinder.find_spec"); all of the `xxxLoader` ABC
`load_module` methods (`importlib.abc.Loader.load_module()`,
`importlib.abc.InspectLoader.load_module()`,
`importlib.abc.FileLoader.load_module()`,
`importlib.abc.SourceLoader.load_module()`) should no longer be
implemented, instead loaders should implement an
`exec_module` method
([`importlib.abc.Loader.exec_module()`](../library/importlib.html#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module"),
[`importlib.abc.InspectLoader.exec_module()`](../library/importlib.html#importlib.abc.InspectLoader.exec_module "importlib.abc.InspectLoader.exec_module")
[`importlib.abc.SourceLoader.exec_module()`](../library/importlib.html#importlib.abc.SourceLoader.exec_module "importlib.abc.SourceLoader.exec_module")) and let the import system
take care of the rest; and
`importlib.abc.Loader.module_repr()`,
`importlib.util.module_for_loader()`, `importlib.util.set_loader()`,
and `importlib.util.set_package()` are no longer needed because their
functions are now handled automatically by the import system.
* The `imp` module is pending deprecation. To keep compatibility with
Python 2/3 code bases, the module’s removal is currently not scheduled.
* The `formatter` module is pending deprecation and is slated for removal
in Python 3\.6\.
* `MD5` as the default *digestmod* for the [`hmac.new()`](../library/hmac.html#hmac.new "hmac.new") function is
deprecated. Python 3\.6 will require an explicit digest name or constructor as
*digestmod* argument.
* The internal `Netrc` class in the [`ftplib`](../library/ftplib.html#module-ftplib "ftplib: FTP protocol client (requires sockets).") module has been documented
as deprecated in its docstring for quite some time. It now emits a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") and will be removed completely in Python 3\.5\.
* The undocumented *endtime* argument to [`subprocess.Popen.wait()`](../library/subprocess.html#subprocess.Popen.wait "subprocess.Popen.wait") should
not have been exposed and is hopefully not in use; it is deprecated and
will mostly likely be removed in Python 3\.5\.
* The *strict* argument of [`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") is deprecated.
* The [`plistlib`](../library/plistlib.html#module-plistlib "plistlib: Generate and parse Apple plist files.") `readPlist()`,
`writePlist()`, `readPlistFromBytes()`, and
`writePlistToBytes()` functions are deprecated in favor of the
corresponding new functions [`load()`](../library/plistlib.html#plistlib.load "plistlib.load"), [`dump()`](../library/plistlib.html#plistlib.dump "plistlib.dump"),
[`loads()`](../library/plistlib.html#plistlib.loads "plistlib.loads"), and [`dumps()`](../library/plistlib.html#plistlib.dumps "plistlib.dumps"). `Data()`
is deprecated in favor of just using the [`bytes`](../library/stdtypes.html#bytes "bytes") constructor.
* The [`sysconfig`](../library/sysconfig.html#module-sysconfig "sysconfig: Python's configuration information") key `SO` is deprecated, it has been replaced by
`EXT_SUFFIX`.
* The `U` mode accepted by various `open` functions is deprecated.
In Python3 it does not do anything useful, and should be replaced by
appropriate uses of [`io.TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") (if needed) and its *newline*
argument.
* The *parser* argument of [`xml.etree.ElementTree.iterparse()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.iterparse "xml.etree.ElementTree.iterparse") has
been deprecated, as has the *html* argument of
[`XMLParser()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser "xml.etree.ElementTree.XMLParser"). To prepare for the removal of the
latter, all arguments to `XMLParser` should be passed by keyword.

### Deprecated Features[¶](#deprecated-features "Link to this heading")

* Running [IDLE](../library/idle.html#idle) with the `-n` flag (no subprocess) is deprecated.
However, the feature will not be removed until [bpo\-18823](https://bugs.python.org/issue?@action=redirect&bpo=18823) is resolved.
* The site module adding a “site\-python” directory to sys.path, if it
exists, is deprecated ([bpo\-19375](https://bugs.python.org/issue?@action=redirect&bpo=19375)).

## Removed[¶](#removed "Link to this heading")

### Operating Systems No Longer Supported[¶](#operating-systems-no-longer-supported "Link to this heading")

Support for the following operating systems has been removed from the source
and build tools:

* OS/2 ([bpo\-16135](https://bugs.python.org/issue?@action=redirect&bpo=16135)).
* Windows 2000 (changeset e52df05b496a).
* Windows systems where `COMSPEC` points to `command.com` ([bpo\-14470](https://bugs.python.org/issue?@action=redirect&bpo=14470)).
* VMS ([bpo\-16136](https://bugs.python.org/issue?@action=redirect&bpo=16136)).

### API and Feature Removals[¶](#api-and-feature-removals "Link to this heading")

The following obsolete and previously deprecated APIs and features have been
removed:

* The unmaintained `Misc/TextMate` and `Misc/vim` directories have been
removed (see the [devguide](https://devguide.python.org)
for suggestions on what to use instead).
* The `SO` makefile macro is removed (it was replaced by the
`SHLIB_SUFFIX` and `EXT_SUFFIX` macros) ([bpo\-16754](https://bugs.python.org/issue?@action=redirect&bpo=16754)).
* The `PyThreadState.tick_counter` field has been removed; its value has
been meaningless since Python 3\.2, when the “new GIL” was introduced
([bpo\-19199](https://bugs.python.org/issue?@action=redirect&bpo=19199)).
* `PyLoader` and `PyPycLoader` have been removed from [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.").
(Contributed by Taras Lyapun in [bpo\-15641](https://bugs.python.org/issue?@action=redirect&bpo=15641).)
* The *strict* argument to [`HTTPConnection`](../library/http.client.html#http.client.HTTPConnection "http.client.HTTPConnection") and
[`HTTPSConnection`](../library/http.client.html#http.client.HTTPSConnection "http.client.HTTPSConnection") has been removed. HTTP 0\.9\-style
“Simple Responses” are no longer supported.
* The deprecated [`urllib.request.Request`](../library/urllib.request.html#urllib.request.Request "urllib.request.Request") getter and setter methods
`add_data`, `has_data`, `get_data`, `get_type`, `get_host`,
`get_selector`, `set_proxy`, `get_origin_req_host`, and
`is_unverifiable` have been removed (use direct attribute access instead).
* Support for loading the deprecated `TYPE_INT64` has been removed from
[`marshal`](../library/marshal.html#module-marshal "marshal: Convert Python objects to streams of bytes and back (with different constraints)."). (Contributed by Dan Riti in [bpo\-15480](https://bugs.python.org/issue?@action=redirect&bpo=15480).)
* [`inspect.Signature`](../library/inspect.html#inspect.Signature "inspect.Signature"): positional\-only parameters are now required
to have a valid name.
* [`object.__format__()`](../reference/datamodel.html#object.__format__ "object.__format__") no longer accepts non\-empty format strings, it now
raises a [`TypeError`](../library/exceptions.html#TypeError "TypeError") instead. Using a non\-empty string has been
deprecated since Python 3\.2\. This change has been made to prevent a
situation where previously working (but incorrect) code would start failing
if an object gained a \_\_format\_\_ method, which means that your code may now
raise a [`TypeError`](../library/exceptions.html#TypeError "TypeError") if you are using an `'s'` format code with objects
that do not have a \_\_format\_\_ method that handles it. See [bpo\-7994](https://bugs.python.org/issue?@action=redirect&bpo=7994) for
background.
* `difflib.SequenceMatcher.isbjunk()` and
`difflib.SequenceMatcher.isbpopular()` were deprecated in 3\.2, and have
now been removed: use `x in sm.bjunk` and
`x in sm.bpopular`, where *sm* is a [`SequenceMatcher`](../library/difflib.html#difflib.SequenceMatcher "difflib.SequenceMatcher") object
([bpo\-13248](https://bugs.python.org/issue?@action=redirect&bpo=13248)).

### Code Cleanups[¶](#code-cleanups "Link to this heading")

* The unused and undocumented internal `Scanner` class has been removed from
the [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") module.
* The private and effectively unused `_gestalt` module has been removed,
along with the private [`platform`](../library/platform.html#module-platform "platform: Retrieves as much platform identifying data as possible.") functions `_mac_ver_lookup`,
`_mac_ver_gstalt`, and `_bcd2str`, which would only have ever been called
on badly broken OSX systems (see [bpo\-18393](https://bugs.python.org/issue?@action=redirect&bpo=18393)).
* The hardcoded copies of certain [`stat`](../library/stat.html#module-stat "stat: Utilities for interpreting the results of os.stat(), os.lstat() and os.fstat().") constants that were included in
the [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") module namespace have been removed.

## Porting to Python 3\.4[¶](#porting-to-python-3-4 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in ‘python’ Command Behavior[¶](#changes-in-python-command-behavior "Link to this heading")

* In a posix shell, setting the `PATH` environment variable to
an empty value is equivalent to not setting it at all. However, setting
[`PYTHONPATH`](../using/cmdline.html#envvar-PYTHONPATH) to an empty value was *not* equivalent to not setting it
at all: setting [`PYTHONPATH`](../using/cmdline.html#envvar-PYTHONPATH) to an empty value was equivalent to
setting it to `.`, which leads to confusion when reasoning by analogy to
how `PATH` works. The behavior now conforms to the posix convention
for `PATH`.
* The \[X refs, Y blocks] output of a debug (`--with-pydebug`) build of the
CPython interpreter is now off by default. It can be re\-enabled using the
`-X showrefcount` option. (Contributed by Ezio Melotti in [bpo\-17323](https://bugs.python.org/issue?@action=redirect&bpo=17323).)
* The python command and most stdlib scripts (as well as [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.")) now
output `--version` information to `stdout` instead of `stderr` (for
issue list see [Other Improvements](#other-improvements-3-4) above).

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* The ABCs defined in [`importlib.abc`](../library/importlib.html#module-importlib.abc "importlib.abc: Abstract base classes related to import") now either raise the appropriate
exception or return a default value instead of raising
[`NotImplementedError`](../library/exceptions.html#NotImplementedError "NotImplementedError") blindly. This will only affect code calling
[`super()`](../library/functions.html#super "super") and falling through all the way to the ABCs. For compatibility,
catch both [`NotImplementedError`](../library/exceptions.html#NotImplementedError "NotImplementedError") or the appropriate exception as needed.
* The module type now initializes the [`__package__`](../reference/datamodel.html#module.__package__ "module.__package__") and
[`__loader__`](../reference/datamodel.html#module.__loader__ "module.__loader__")
attributes to `None` by default. To determine if these attributes were set
in a backwards\-compatible fashion, use e.g.
`getattr(module, '__loader__', None) is not None`. ([bpo\-17115](https://bugs.python.org/issue?@action=redirect&bpo=17115).)
* `importlib.util.module_for_loader()` now sets `__loader__` and
`__package__` unconditionally to properly support reloading. If this is not
desired then you will need to set these attributes manually. You can use
`importlib.util.module_to_load()` for module management.
* Import now resets relevant attributes (e.g. `__name__`, `__loader__`,
`__package__`, `__file__`, `__cached__`) unconditionally when reloading.
Note that this restores a pre\-3\.3 behavior in that it means a module is
re\-found when re\-loaded ([bpo\-19413](https://bugs.python.org/issue?@action=redirect&bpo=19413)).
* Frozen packages no longer set `__path__` to a list containing the package
name, they now set it to an empty list. The previous behavior could cause
the import system to do the wrong thing on submodule imports if there was
also a directory with the same name as the frozen package. The correct way
to determine if a module is a package or not is to use `hasattr(module,
'__path__')` ([bpo\-18065](https://bugs.python.org/issue?@action=redirect&bpo=18065)).
* Frozen modules no longer define a `__file__` attribute. It’s semantically
incorrect for frozen modules to set the attribute as they are not loaded from
any explicit location. If you must know that a module comes from frozen code
then you can see if the module’s `__spec__.location` is set to `'frozen'`,
check if the loader is a subclass of
[`importlib.machinery.FrozenImporter`](../library/importlib.html#importlib.machinery.FrozenImporter "importlib.machinery.FrozenImporter"),
or if Python 2 compatibility is necessary you can use `imp.is_frozen()`.
* [`py_compile.compile()`](../library/py_compile.html#py_compile.compile "py_compile.compile") now raises [`FileExistsError`](../library/exceptions.html#FileExistsError "FileExistsError") if the file path
it would write to is a symlink or a non\-regular file. This is to act as a
warning that import will overwrite those files with a regular file regardless
of what type of file path they were originally.
* [`importlib.abc.SourceLoader.get_source()`](../library/importlib.html#importlib.abc.SourceLoader.get_source "importlib.abc.SourceLoader.get_source") no longer raises
[`ImportError`](../library/exceptions.html#ImportError "ImportError") when the source code being loaded triggers a
[`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError") or [`UnicodeDecodeError`](../library/exceptions.html#UnicodeDecodeError "UnicodeDecodeError"). As [`ImportError`](../library/exceptions.html#ImportError "ImportError") is
meant to be raised only when source code cannot be found but it should, it was
felt to be over\-reaching/overloading of that meaning when the source code is
found but improperly structured. If you were catching ImportError before and
wish to continue to ignore syntax or decoding issues, catch all three
exceptions now.
* [`functools.update_wrapper()`](../library/functools.html#functools.update_wrapper "functools.update_wrapper") and [`functools.wraps()`](../library/functools.html#functools.wraps "functools.wraps") now correctly
set the `__wrapped__` attribute to the function being wrapped, even if
that function also had its `__wrapped__` attribute set. This means
`__wrapped__` attributes now correctly link a stack of decorated
functions rather than every `__wrapped__` attribute in the chain
referring to the innermost function. Introspection libraries that
assumed the previous behaviour was intentional can use
[`inspect.unwrap()`](../library/inspect.html#inspect.unwrap "inspect.unwrap") to access the first function in the chain that has
no `__wrapped__` attribute.
* [`inspect.getfullargspec()`](../library/inspect.html#inspect.getfullargspec "inspect.getfullargspec") has been reimplemented on top of
[`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") and hence handles a much wider variety of callable
objects than it did in the past. It is expected that additional builtin and
extension module callables will gain signature metadata over the course of
the Python 3\.4 series. Code that assumes that
[`inspect.getfullargspec()`](../library/inspect.html#inspect.getfullargspec "inspect.getfullargspec") will fail on non\-Python callables may need
to be adjusted accordingly.
* [`importlib.machinery.PathFinder`](../library/importlib.html#importlib.machinery.PathFinder "importlib.machinery.PathFinder") now passes on the current working
directory to objects in [`sys.path_hooks`](../library/sys.html#sys.path_hooks "sys.path_hooks") for the empty string. This
results in [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") never containing `''`, thus
iterating through [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") based on [`sys.path`](../library/sys.html#sys.path "sys.path")
will not find all keys. A module’s `__file__` when imported in the current
working directory will also now have an absolute path, including when using
`-m` with the interpreter (except for `__main__.__file__` when a script
has been executed directly using a relative path) (Contributed by Brett
Cannon in [bpo\-18416](https://bugs.python.org/issue?@action=redirect&bpo=18416)). is specified on the command\-line)
([bpo\-18416](https://bugs.python.org/issue?@action=redirect&bpo=18416)).
* The removal of the *strict* argument to [`HTTPConnection`](../library/http.client.html#http.client.HTTPConnection "http.client.HTTPConnection")
and [`HTTPSConnection`](../library/http.client.html#http.client.HTTPSConnection "http.client.HTTPSConnection") changes the meaning of the
remaining arguments if you are specifying them positionally rather than by
keyword. If you’ve been paying attention to deprecation warnings your code
should already be specifying any additional arguments via keywords.
* Strings between `from __future__ import ...` statements now *always* raise
a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError"). Previously if there was no leading docstring, an
interstitial string would sometimes be ignored. This brings CPython into
compliance with the language spec; Jython and PyPy already were.
([bpo\-17434](https://bugs.python.org/issue?@action=redirect&bpo=17434)).
* [`ssl.SSLSocket.getpeercert()`](../library/ssl.html#ssl.SSLSocket.getpeercert "ssl.SSLSocket.getpeercert") and [`ssl.SSLSocket.do_handshake()`](../library/ssl.html#ssl.SSLSocket.do_handshake "ssl.SSLSocket.do_handshake")
now raise an [`OSError`](../library/exceptions.html#OSError "OSError") with `ENOTCONN` when the `SSLSocket` is not
connected, instead of the previous behavior of raising an
[`AttributeError`](../library/exceptions.html#AttributeError "AttributeError"). In addition, [`getpeercert()`](../library/ssl.html#ssl.SSLSocket.getpeercert "ssl.SSLSocket.getpeercert")
will raise a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the handshake has not yet been done.
* [`base64.b32decode()`](../library/base64.html#base64.b32decode "base64.b32decode") now raises a [`binascii.Error`](../library/binascii.html#binascii.Error "binascii.Error") when the
input string contains non\-b32\-alphabet characters, instead of a
[`TypeError`](../library/exceptions.html#TypeError "TypeError"). This particular [`TypeError`](../library/exceptions.html#TypeError "TypeError") was missed when the other
[`TypeError`](../library/exceptions.html#TypeError "TypeError")s were converted. (Contributed by Serhiy Storchaka in
[bpo\-18011](https://bugs.python.org/issue?@action=redirect&bpo=18011).) Note: this change was also inadvertently applied in Python
3\.3\.3\.
* The `file` attribute is now automatically closed when
the creating `cgi.FieldStorage` instance is garbage collected. If you
were pulling the file object out separately from the `cgi.FieldStorage`
instance and not keeping the instance alive, then you should either store the
entire `cgi.FieldStorage` instance or read the contents of the file
before the `cgi.FieldStorage` instance is garbage collected.
* Calling `read` or `write` on a closed SSL socket now raises an
informative [`ValueError`](../library/exceptions.html#ValueError "ValueError") rather than the previous more mysterious
[`AttributeError`](../library/exceptions.html#AttributeError "AttributeError") ([bpo\-9177](https://bugs.python.org/issue?@action=redirect&bpo=9177)).
* [`slice.indices()`](../reference/datamodel.html#slice.indices "slice.indices") no longer produces an [`OverflowError`](../library/exceptions.html#OverflowError "OverflowError") for huge
values. As a consequence of this fix, [`slice.indices()`](../reference/datamodel.html#slice.indices "slice.indices") now raises a
[`ValueError`](../library/exceptions.html#ValueError "ValueError") if given a negative length; previously it returned nonsense
values ([bpo\-14794](https://bugs.python.org/issue?@action=redirect&bpo=14794)).
* The [`complex`](../library/functions.html#complex "complex") constructor, unlike the [`cmath`](../library/cmath.html#module-cmath "cmath: Mathematical functions for complex numbers.") functions, was
incorrectly accepting [`float`](../library/functions.html#float "float") values if an object’s `__complex__`
special method returned one. This now raises a [`TypeError`](../library/exceptions.html#TypeError "TypeError").
([bpo\-16290](https://bugs.python.org/issue?@action=redirect&bpo=16290).)
* The [`int`](../library/functions.html#int "int") constructor in 3\.2 and 3\.3 erroneously accepts [`float`](../library/functions.html#float "float")
values for the *base* parameter. It is unlikely anyone was doing this, but
if so, it will now raise a [`TypeError`](../library/exceptions.html#TypeError "TypeError") ([bpo\-16772](https://bugs.python.org/issue?@action=redirect&bpo=16772)).
* Defaults for keyword\-only arguments are now evaluated *after* defaults for
regular keyword arguments, instead of before. Hopefully no one wrote any
code that depends on the previous buggy behavior ([bpo\-16967](https://bugs.python.org/issue?@action=redirect&bpo=16967)).
* Stale thread states are now cleared after [`fork()`](../library/os.html#os.fork "os.fork"). This may cause
some system resources to be released that previously were incorrectly kept
perpetually alive (for example, database connections kept in thread\-local
storage). ([bpo\-17094](https://bugs.python.org/issue?@action=redirect&bpo=17094).)
* Parameter names in `__annotations__` dicts are now mangled properly,
similarly to [`__kwdefaults__`](../reference/datamodel.html#function.__kwdefaults__ "function.__kwdefaults__").
(Contributed by Yury Selivanov in [bpo\-20625](https://bugs.python.org/issue?@action=redirect&bpo=20625).)
* [`hashlib.hash.name`](../library/hashlib.html#hashlib.hash.name "hashlib.hash.name") now always returns the identifier in lower case.
Previously some builtin hashes had uppercase names, but now that it is a
formal public interface the naming has been made consistent ([bpo\-18532](https://bugs.python.org/issue?@action=redirect&bpo=18532)).
* Because [`unittest.TestSuite`](../library/unittest.html#unittest.TestSuite "unittest.TestSuite") now drops references to tests after they
are run, test harnesses that reuse a [`TestSuite`](../library/unittest.html#unittest.TestSuite "unittest.TestSuite") to re\-run
a set of tests may fail. Test suites should not be re\-used in this fashion
since it means state is retained between test runs, breaking the test
isolation that [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") is designed to provide. However, if the lack
of isolation is considered acceptable, the old behavior can be restored by
creating a [`TestSuite`](../library/unittest.html#unittest.TestSuite "unittest.TestSuite") subclass that defines a
`_removeTestAtIndex` method that does nothing (see
[`TestSuite.__iter__()`](../library/unittest.html#unittest.TestSuite.__iter__ "unittest.TestSuite.__iter__")) ([bpo\-11798](https://bugs.python.org/issue?@action=redirect&bpo=11798)).
* [`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") now uses [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") for command line parsing. There are
certain invalid command forms that used to work that are no longer allowed;
in theory this should not cause backward compatibility issues since the
disallowed command forms didn’t make any sense and are unlikely to be in use.
* The [`re.split()`](../library/re.html#re.split "re.split"), [`re.findall()`](../library/re.html#re.findall "re.findall"), and [`re.sub()`](../library/re.html#re.sub "re.sub") functions, and
the `group()` and `groups()` methods of
`match` objects now always return a *bytes* object when the string
to be matched is a [bytes\-like object](../glossary.html#term-bytes-like-object). Previously the return type
matched the input type, so if your code was depending on the return value
being, say, a `bytearray`, you will need to change your code.
* `audioop` functions now raise an error immediately if passed string
input, instead of failing randomly later on ([bpo\-16685](https://bugs.python.org/issue?@action=redirect&bpo=16685)).
* The new *convert\_charrefs* argument to [`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser")
currently defaults to `False` for backward compatibility, but will
eventually be changed to default to `True`. It is recommended that you add
this keyword, with the appropriate value, to any
[`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") calls in your code ([bpo\-13633](https://bugs.python.org/issue?@action=redirect&bpo=13633)).
* Since the *digestmod* argument to the [`hmac.new()`](../library/hmac.html#hmac.new "hmac.new") function will in the
future have no default, all calls to [`hmac.new()`](../library/hmac.html#hmac.new "hmac.new") should be changed to
explicitly specify a *digestmod* ([bpo\-17276](https://bugs.python.org/issue?@action=redirect&bpo=17276)).
* Calling [`sysconfig.get_config_var()`](../library/sysconfig.html#sysconfig.get_config_var "sysconfig.get_config_var") with the `SO` key, or looking
`SO` up in the results of a call to [`sysconfig.get_config_vars()`](../library/sysconfig.html#sysconfig.get_config_vars "sysconfig.get_config_vars")
is deprecated. This key should be replaced by `EXT_SUFFIX` or
`SHLIB_SUFFIX`, depending on the context ([bpo\-19555](https://bugs.python.org/issue?@action=redirect&bpo=19555)).
* Any calls to `open` functions that specify `U` should be modified.
`U` is ineffective in Python3 and will eventually raise an error if used.
Depending on the function, the equivalent of its old Python2 behavior can be
achieved using either a *newline* argument, or if necessary by wrapping the
stream in [`TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") to use its *newline* argument
([bpo\-15204](https://bugs.python.org/issue?@action=redirect&bpo=15204)).
* If you use `pyvenv` in a script and desire that pip
*not* be installed, you must add `--without-pip` to your command
invocation.
* The default behavior of [`json.dump()`](../library/json.html#json.dump "json.dump") and [`json.dumps()`](../library/json.html#json.dumps "json.dumps") when
an indent is specified has changed: it no longer produces trailing
spaces after the item separating commas at the ends of lines. This
will matter only if you have tests that are doing white\-space\-sensitive
comparisons of such output ([bpo\-16333](https://bugs.python.org/issue?@action=redirect&bpo=16333)).
* [`doctest`](../library/doctest.html#module-doctest "doctest: Test pieces of code within docstrings.") now looks for doctests in extension module `__doc__`
strings, so if your doctest test discovery includes extension modules that
have things that look like doctests in them you may see test failures you’ve
never seen before when running your tests ([bpo\-3158](https://bugs.python.org/issue?@action=redirect&bpo=3158)).
* The [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers") module has been slightly refactored as
part of the Python startup improvements. As a consequence of this, it is no
longer the case that importing [`collections`](../library/collections.html#module-collections "collections: Container datatypes") automatically imports
[`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers"). If your program depended on the (undocumented)
implicit import, you will need to add an explicit `import collections.abc`
([bpo\-20784](https://bugs.python.org/issue?@action=redirect&bpo=20784)).

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

* [`PyEval_EvalFrameEx()`](../c-api/veryhigh.html#c.PyEval_EvalFrameEx "PyEval_EvalFrameEx"), [`PyObject_Repr()`](../c-api/object.html#c.PyObject_Repr "PyObject_Repr"), and
[`PyObject_Str()`](../c-api/object.html#c.PyObject_Str "PyObject_Str"), along with some other internal C APIs, now include
a debugging assertion that ensures they are not used in situations where
they may silently discard a currently active exception. In cases where
discarding the active exception is expected and desired (for example,
because it has already been saved locally with [`PyErr_Fetch()`](../c-api/exceptions.html#c.PyErr_Fetch "PyErr_Fetch") or
is being deliberately replaced with a different exception), an explicit
[`PyErr_Clear()`](../c-api/exceptions.html#c.PyErr_Clear "PyErr_Clear") call will be needed to avoid triggering the
assertion when invoking these operations (directly or indirectly) and
running against a version of Python that is compiled with assertions
enabled.
* [`PyErr_SetImportError()`](../c-api/exceptions.html#c.PyErr_SetImportError "PyErr_SetImportError") now sets [`TypeError`](../library/exceptions.html#TypeError "TypeError") when its **msg**
argument is not set. Previously only `NULL` was returned with no exception
set.
* The result of the [`PyOS_ReadlineFunctionPointer`](../c-api/veryhigh.html#c.PyOS_ReadlineFunctionPointer "PyOS_ReadlineFunctionPointer") callback must
now be a string allocated by [`PyMem_RawMalloc()`](../c-api/memory.html#c.PyMem_RawMalloc "PyMem_RawMalloc") or
[`PyMem_RawRealloc()`](../c-api/memory.html#c.PyMem_RawRealloc "PyMem_RawRealloc"), or `NULL` if an error occurred, instead of a
string allocated by [`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc") or [`PyMem_Realloc()`](../c-api/memory.html#c.PyMem_Realloc "PyMem_Realloc")
([bpo\-16742](https://bugs.python.org/issue?@action=redirect&bpo=16742))
* [`PyThread_set_key_value()`](../c-api/init.html#c.PyThread_set_key_value "PyThread_set_key_value") now always set the value. In Python
3\.3, the function did nothing if the key already exists (if the current
value is a non\-`NULL` pointer).
* The `f_tstate` (thread state) field of the [`PyFrameObject`](../c-api/frame.html#c.PyFrameObject "PyFrameObject")
structure has been removed to fix a bug: see [bpo\-14432](https://bugs.python.org/issue?@action=redirect&bpo=14432) for the
rationale.

## Changed in 3\.4\.3[¶](#changed-in-3-4-3 "Link to this heading")

### PEP 476: Enabling certificate verification by default for stdlib http clients[¶](#pep-476-enabling-certificate-verification-by-default-for-stdlib-http-clients "Link to this heading")

[`http.client`](../library/http.client.html#module-http.client "http.client: HTTP and HTTPS protocol client (requires sockets).") and modules which use it, such as [`urllib.request`](../library/urllib.request.html#module-urllib.request "urllib.request: Extensible library for opening URLs.") and
[`xmlrpc.client`](../library/xmlrpc.client.html#module-xmlrpc.client "xmlrpc.client: XML-RPC client access."), will now verify that the server presents a certificate
which is signed by a CA in the platform trust store and whose hostname matches
the hostname being requested by default, significantly improving security for
many applications.

For applications which require the old previous behavior, they can pass an
alternate context:

\`\`\`
import urllib.request
import ssl

\# This disables all verification
context = ssl.\_create\_unverified\_context()

\# This allows using a specific certificate for the host, which doesn't need
\# to be in the trust store
context = ssl.create\_default\_context(cafile="/path/to/file.crt")

urllib.request.urlopen("https://invalid\-cert", context=context)

\`\`\`

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.4](#)
	+ [Summary – Release Highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [PEP 453: Explicit Bootstrapping of PIP in Python Installations](#pep-453-explicit-bootstrapping-of-pip-in-python-installations)
			* [Bootstrapping pip By Default](#bootstrapping-pip-by-default)
			* [Documentation Changes](#documentation-changes)
		- [PEP 446: Newly Created File Descriptors Are Non\-Inheritable](#pep-446-newly-created-file-descriptors-are-non-inheritable)
		- [Improvements to Codec Handling](#improvements-to-codec-handling)
		- [PEP 451: A ModuleSpec Type for the Import System](#pep-451-a-modulespec-type-for-the-import-system)
		- [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
		- [asyncio](#asyncio)
		- [ensurepip](#ensurepip)
		- [enum](#enum)
		- [pathlib](#pathlib)
		- [selectors](#selectors)
		- [statistics](#statistics)
		- [tracemalloc](#tracemalloc)
	+ [Improved Modules](#improved-modules)
		- [abc](#abc)
		- [aifc](#aifc)
		- [argparse](#argparse)
		- [audioop](#audioop)
		- [base64](#base64)
		- [collections](#collections)
		- [colorsys](#colorsys)
		- [contextlib](#contextlib)
		- [dbm](#dbm)
		- [dis](#dis)
		- [doctest](#doctest)
		- [email](#email)
		- [filecmp](#filecmp)
		- [functools](#functools)
		- [gc](#gc)
		- [glob](#glob)
		- [hashlib](#hashlib)
		- [hmac](#hmac)
		- [html](#html)
		- [http](#http)
		- [idlelib and IDLE](#idlelib-and-idle)
		- [importlib](#importlib)
		- [inspect](#inspect)
		- [ipaddress](#ipaddress)
		- [logging](#logging)
		- [marshal](#marshal)
		- [mmap](#mmap)
		- [multiprocessing](#multiprocessing)
		- [operator](#operator)
		- [os](#os)
		- [pdb](#pdb)
		- [pickle](#pickle)
		- [plistlib](#plistlib)
		- [poplib](#poplib)
		- [pprint](#pprint)
		- [pty](#pty)
		- [pydoc](#pydoc)
		- [re](#re)
		- [resource](#resource)
		- [select](#select)
		- [shelve](#shelve)
		- [shutil](#shutil)
		- [smtpd](#smtpd)
		- [smtplib](#smtplib)
		- [socket](#socket)
		- [sqlite3](#sqlite3)
		- [ssl](#ssl)
		- [stat](#stat)
		- [struct](#struct)
		- [subprocess](#subprocess)
		- [sunau](#sunau)
		- [sys](#sys)
		- [tarfile](#tarfile)
		- [textwrap](#textwrap)
		- [threading](#threading)
		- [traceback](#traceback)
		- [types](#types)
		- [urllib](#urllib)
		- [unittest](#unittest)
		- [venv](#venv)
		- [wave](#wave)
		- [weakref](#weakref)
		- [xml.etree](#xml-etree)
		- [zipfile](#zipfile)
	+ [CPython Implementation Changes](#cpython-implementation-changes)
		- [PEP 445: Customization of CPython Memory Allocators](#pep-445-customization-of-cpython-memory-allocators)
		- [PEP 442: Safe Object Finalization](#pep-442-safe-object-finalization)
		- [PEP 456: Secure and Interchangeable Hash Algorithm](#pep-456-secure-and-interchangeable-hash-algorithm)
		- [PEP 436: Argument Clinic](#pep-436-argument-clinic)
		- [Other Build and C API Changes](#other-build-and-c-api-changes)
		- [Other Improvements](#other-improvements)
		- [Significant Optimizations](#significant-optimizations)
	+ [Deprecated](#deprecated)
		- [Deprecations in the Python API](#deprecations-in-the-python-api)
		- [Deprecated Features](#deprecated-features)
	+ [Removed](#removed)
		- [Operating Systems No Longer Supported](#operating-systems-no-longer-supported)
		- [API and Feature Removals](#api-and-feature-removals)
		- [Code Cleanups](#code-cleanups)
	+ [Porting to Python 3\.4](#porting-to-python-3-4)
		- [Changes in ‘python’ Command Behavior](#changes-in-python-command-behavior)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
	+ [Changed in 3\.4\.3](#changed-in-3-4-3)
		- [PEP 476: Enabling certificate verification by default for stdlib http clients](#pep-476-enabling-certificate-verification-by-default-for-stdlib-http-clients)

#### Previous topic

[What’s New In Python 3\.5](3.5.html "previous chapter")

#### Next topic

[What’s New In Python 3\.3](3.3.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.4.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.3.html "What’s New In Python 3.3") \|
* [previous](3.5.html "What’s New In Python 3.5") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.4
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.5 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.5.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.4.html "What’s New In Python 3.4") \|
* [previous](3.6.html "What’s New In Python 3.6") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.5
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.5[¶](#what-s-new-in-python-3-5 "Link to this heading")

Editors:
Elvis Pranskevichus \, Yury Selivanov \

This article explains the new features in Python 3\.5, compared to 3\.4\.
Python 3\.5 was released on September 13, 2015\.  See the
[changelog](https://docs.python.org/3.5/whatsnew/changelog.html) for a full
list of changes.

See also

[**PEP 478**](https://peps.python.org/pep-0478/) \- Python 3\.5 Release Schedule

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* [PEP 492](#whatsnew-pep-492), coroutines with async and await syntax.
* [PEP 465](#whatsnew-pep-465), a new matrix multiplication operator: `a @ b`.
* [PEP 448](#whatsnew-pep-448), additional unpacking generalizations.

New library modules:

* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."): [PEP 484 – Type Hints](#whatsnew-pep-484).
* [`zipapp`](../library/zipapp.html#module-zipapp "zipapp: Manage executable Python zip archives"): [PEP 441 Improving Python ZIP Application Support](#whatsnew-zipapp).

New built\-in features:

* `bytes % args`, `bytearray % args`: [PEP 461](#whatsnew-pep-461) –
Adding `%` formatting to bytes and bytearray.
* New [`bytes.hex()`](../library/stdtypes.html#bytes.hex "bytes.hex"), [`bytearray.hex()`](../library/stdtypes.html#bytearray.hex "bytearray.hex") and [`memoryview.hex()`](../library/stdtypes.html#memoryview.hex "memoryview.hex")
methods. (Contributed by Arnon Yaari in [bpo\-9951](https://bugs.python.org/issue?@action=redirect&bpo=9951).)
* [`memoryview`](../library/stdtypes.html#memoryview "memoryview") now supports tuple indexing (including multi\-dimensional).
(Contributed by Antoine Pitrou in [bpo\-23632](https://bugs.python.org/issue?@action=redirect&bpo=23632).)
* Generators have a new `gi_yieldfrom` attribute, which returns the
object being iterated by `yield from` expressions. (Contributed
by Benno Leslie and Yury Selivanov in [bpo\-24450](https://bugs.python.org/issue?@action=redirect&bpo=24450).)
* A new [`RecursionError`](../library/exceptions.html#RecursionError "RecursionError") exception is now raised when maximum
recursion depth is reached. (Contributed by Georg Brandl
in [bpo\-19235](https://bugs.python.org/issue?@action=redirect&bpo=19235).)

CPython implementation improvements:

* When the `LC_TYPE` locale is the POSIX locale (`C` locale),
[`sys.stdin`](../library/sys.html#sys.stdin "sys.stdin") and [`sys.stdout`](../library/sys.html#sys.stdout "sys.stdout") now use the
`surrogateescape` error handler, instead of the `strict` error handler.
(Contributed by Victor Stinner in [bpo\-19977](https://bugs.python.org/issue?@action=redirect&bpo=19977).)
* `.pyo` files are no longer used and have been replaced by a more flexible
scheme that includes the optimization level explicitly in `.pyc` name.
(See [PEP 488 overview](#whatsnew-pep-488).)
* Builtin and extension modules are now initialized in a multi\-phase process,
which is similar to how Python modules are loaded.
(See [PEP 489 overview](#whatsnew-pep-489).)

Significant improvements in the standard library:

* [`collections.OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict") is now
[implemented in C](#whatsnew-ordereddict), which makes it
4 to 100 times faster.
* The [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module gained
[support for Memory BIO](#whatsnew-sslmemorybio), which decouples SSL
protocol handling from network IO.
* The new [`os.scandir()`](../library/os.html#os.scandir "os.scandir") function provides a
[better and significantly faster way](#whatsnew-pep-471)
of directory traversal.
* [`functools.lru_cache()`](../library/functools.html#functools.lru_cache "functools.lru_cache") has been mostly
[reimplemented in C](#whatsnew-lrucache), yielding much better
performance.
* The new [`subprocess.run()`](../library/subprocess.html#subprocess.run "subprocess.run") function provides a
[streamlined way to run subprocesses](#whatsnew-subprocess).
* The [`traceback`](../library/traceback.html#module-traceback "traceback: Print or retrieve a stack traceback.") module has been significantly
[enhanced](#whatsnew-traceback) for improved
performance and developer convenience.

Security improvements:

* SSLv3 is now disabled throughout the standard library.
It can still be enabled by instantiating a [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext")
manually. (See [bpo\-22638](https://bugs.python.org/issue?@action=redirect&bpo=22638) for more details; this change was
backported to CPython 3\.4 and 2\.7\.)
* HTTP cookie parsing is now stricter, in order to protect
against potential injection attacks. (Contributed by Antoine Pitrou
in [bpo\-22796](https://bugs.python.org/issue?@action=redirect&bpo=22796).)

Windows improvements:

* A new installer for Windows has replaced the old MSI.
See [Using Python on Windows](../using/windows.html#using-on-windows) for more information.
* Windows builds now use Microsoft Visual C\+\+ 14\.0, and extension modules
should use the same.

Please read on for a comprehensive list of user\-facing changes, including many
other smaller improvements, CPython optimizations, deprecations, and potential
porting issues.

## New Features[¶](#new-features "Link to this heading")

### PEP 492 \- Coroutines with async and await syntax[¶](#pep-492-coroutines-with-async-and-await-syntax "Link to this heading")

[**PEP 492**](https://peps.python.org/pep-0492/) greatly improves support for asynchronous programming in Python
by adding [awaitable objects](../glossary.html#term-awaitable),
[coroutine functions](../glossary.html#term-coroutine-function),
[asynchronous iteration](../glossary.html#term-asynchronous-iterable),
and [asynchronous context managers](../glossary.html#term-asynchronous-context-manager).

Coroutine functions are declared using the new [`async def`](../reference/compound_stmts.html#async-def) syntax:

\`\`\`
\>\>\> async def coro():
... return 'spam'

\`\`\`

Inside a coroutine function, the new [`await`](../reference/expressions.html#await) expression can be used
to suspend coroutine execution until the result is available. Any object
can be *awaited*, as long as it implements the [awaitable](../glossary.html#term-awaitable) protocol by
defining the `__await__()` method.

PEP 492 also adds [`async for`](../reference/compound_stmts.html#async-for) statement for convenient iteration
over asynchronous iterables.

An example of a rudimentary HTTP client written using the new syntax:

\`\`\`
import asyncio

async def http\_get(domain):
 reader, writer = await asyncio.open\_connection(domain, 80\)

 writer.write(b'\\r\\n'.join(\[
 b'GET / HTTP/1\.1',
 b'Host: %b' % domain.encode('latin\-1'),
 b'Connection: close',
 b'', b''
 ]))

 async for line in reader:
 print('\>\>\>', line)

 writer.close()

loop = asyncio.get\_event\_loop()
try:
 loop.run\_until\_complete(http\_get('example.com'))
finally:
 loop.close()

\`\`\`

Similarly to asynchronous iteration, there is a new syntax for asynchronous
context managers. The following script:

\`\`\`
import asyncio

async def coro(name, lock):
 print('coro {}: waiting for lock'.format(name))
 async with lock:
 print('coro {}: holding the lock'.format(name))
 await asyncio.sleep(1\)
 print('coro {}: releasing the lock'.format(name))

loop = asyncio.get\_event\_loop()
lock = asyncio.Lock()
coros = asyncio.gather(coro(1, lock), coro(2, lock))
try:
 loop.run\_until\_complete(coros)
finally:
 loop.close()

\`\`\`

will output:

\`\`\`
coro 2: waiting for lock
coro 2: holding the lock
coro 1: waiting for lock
coro 2: releasing the lock
coro 1: holding the lock
coro 1: releasing the lock

\`\`\`

Note that both [`async for`](../reference/compound_stmts.html#async-for) and [`async with`](../reference/compound_stmts.html#async-with) can only
be used inside a coroutine function declared with [`async def`](../reference/compound_stmts.html#async-def).

Coroutine functions are intended to be run inside a compatible event loop,
such as the [asyncio loop](../library/asyncio-eventloop.html#asyncio-event-loop).

Note

Changed in version 3\.5\.2: Starting with CPython 3\.5\.2, `__aiter__` can directly return
[asynchronous iterators](../glossary.html#term-asynchronous-iterator). Returning
an [awaitable](../glossary.html#term-awaitable) object will result in a
[`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning").

See more details in the [Asynchronous Iterators](../reference/datamodel.html#async-iterators) documentation
section.

See also

[**PEP 492**](https://peps.python.org/pep-0492/) – Coroutines with async and await syntaxPEP written and implemented by Yury Selivanov.

### PEP 465 \- A dedicated infix operator for matrix multiplication[¶](#pep-465-a-dedicated-infix-operator-for-matrix-multiplication "Link to this heading")

[**PEP 465**](https://peps.python.org/pep-0465/) adds the `@` infix operator for matrix multiplication.
Currently, no builtin Python types implement the new operator, however, it
can be implemented by defining `__matmul__()`, `__rmatmul__()`,
and `__imatmul__()` for regular, reflected, and in\-place matrix
multiplication. The semantics of these methods is similar to that of
methods defining other infix arithmetic operators.

Matrix multiplication is a notably common operation in many fields of
mathematics, science, engineering, and the addition of `@` allows writing
cleaner code:

\`\`\`
S = (H @ beta \- r).T @ inv(H @ V @ H.T) @ (H @ beta \- r)

\`\`\`

instead of:

\`\`\`
S = dot((dot(H, beta) \- r).T,
 dot(inv(dot(dot(H, V), H.T)), dot(H, beta) \- r))

\`\`\`

NumPy 1\.10 has support for the new operator:

\`\`\`
\>\>\> import numpy

\>\>\> x = numpy.ones(3\)
\>\>\> x
array(\[ 1\., 1\., 1\.])

\>\>\> m = numpy.eye(3\)
\>\>\> m
array(\[\[ 1\., 0\., 0\.],
 \[ 0\., 1\., 0\.],
 \[ 0\., 0\., 1\.]])

\>\>\> x @ m
array(\[ 1\., 1\., 1\.])

\`\`\`

See also

[**PEP 465**](https://peps.python.org/pep-0465/) – A dedicated infix operator for matrix multiplicationPEP written by Nathaniel J. Smith; implemented by Benjamin Peterson.

### PEP 448 \- Additional Unpacking Generalizations[¶](#pep-448-additional-unpacking-generalizations "Link to this heading")

[**PEP 448**](https://peps.python.org/pep-0448/) extends the allowed uses of the `*` iterable unpacking
operator and `**` dictionary unpacking operator. It is now possible
to use an arbitrary number of unpackings in [function calls](../reference/expressions.html#calls):

\`\`\`
\>\>\> print(\*\[1], \*\[2], 3, \*\[4, 5])
1 2 3 4 5

\>\>\> def fn(a, b, c, d):
... print(a, b, c, d)
...

\>\>\> fn(\*\*{'a': 1, 'c': 3}, \*\*{'b': 2, 'd': 4})
1 2 3 4

\`\`\`

Similarly, tuple, list, set, and dictionary displays allow multiple
unpackings (see [Expression lists](../reference/expressions.html#exprlists) and [Dictionary displays](../reference/expressions.html#dict)):

\`\`\`
\>\>\> \*range(4\), 4
(0, 1, 2, 3, 4\)

\>\>\> \[\*range(4\), 4]
\[0, 1, 2, 3, 4]

\>\>\> {\*range(4\), 4, \*(5, 6, 7\)}
{0, 1, 2, 3, 4, 5, 6, 7}

\>\>\> {'x': 1, \*\*{'y': 2}}
{'x': 1, 'y': 2}

\`\`\`

See also

[**PEP 448**](https://peps.python.org/pep-0448/) – Additional Unpacking GeneralizationsPEP written by Joshua Landau; implemented by Neil Girdhar,
Thomas Wouters, and Joshua Landau.

### PEP 461 \- percent formatting support for bytes and bytearray[¶](#pep-461-percent-formatting-support-for-bytes-and-bytearray "Link to this heading")

[**PEP 461**](https://peps.python.org/pep-0461/) adds support for the `%`
[interpolation operator](../library/stdtypes.html#bytes-formatting) to [`bytes`](../library/stdtypes.html#bytes "bytes")
and [`bytearray`](../library/stdtypes.html#bytearray "bytearray").

While interpolation is usually thought of as a string operation, there are
cases where interpolation on `bytes` or `bytearrays` makes sense, and the
work needed to make up for this missing functionality detracts from the
overall readability of the code. This issue is particularly important when
dealing with wire format protocols, which are often a mixture of binary
and ASCII compatible text.

Examples:

\`\`\`
\>\>\> b'Hello %b!' % b'World'
b'Hello World!'

\>\>\> b'x=%i y=%f' % (1, 2\.5\)
b'x=1 y=2\.500000'

\`\`\`

Unicode is not allowed for `%b`, but it is accepted by `%a` (equivalent of
`repr(obj).encode('ascii', 'backslashreplace')`):

\`\`\`
\>\>\> b'Hello %b!' % 'World'
Traceback (most recent call last):
 File "\", line 1, in \
TypeError: %b requires bytes, or an object that implements \_\_bytes\_\_, not 'str'

\>\>\> b'price: %a' % '10€'
b"price: '10\\\\u20ac'"

\`\`\`

Note that `%s` and `%r` conversion types, although supported, should
only be used in codebases that need compatibility with Python 2\.

See also

[**PEP 461**](https://peps.python.org/pep-0461/) – Adding % formatting to bytes and bytearrayPEP written by Ethan Furman; implemented by Neil Schemenauer and
Ethan Furman.

### PEP 484 \- Type Hints[¶](#pep-484-type-hints "Link to this heading")

Function annotation syntax has been a Python feature since version 3\.0
([**PEP 3107**](https://peps.python.org/pep-3107/)), however the semantics of annotations has been left undefined.

Experience has shown that the majority of function annotation
uses were to provide type hints to function parameters and return values. It
became evident that it would be beneficial for Python users, if the
standard library included the base definitions and tools for type annotations.

[**PEP 484**](https://peps.python.org/pep-0484/) introduces a [provisional module](../glossary.html#term-provisional-API) to
provide these standard definitions and tools, along with some conventions
for situations where annotations are not available.

For example, here is a simple function whose argument and return type
are declared in the annotations:

\`\`\`
def greeting(name: str) \-\> str:
 return 'Hello ' \+ name

\`\`\`

While these annotations are available at runtime through the usual
`__annotations__` attribute, *no automatic type checking happens
at runtime*. Instead, it is assumed that a separate off\-line type checker
(e.g. [mypy](https://mypy-lang.org)) will be used for on\-demand
source code analysis.

The type system supports unions, generic types, and a special type
named [`Any`](../library/typing.html#typing.Any "typing.Any") which is consistent with (i.e. assignable to
and from) all types.

See also

* [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module documentation
* [**PEP 484**](https://peps.python.org/pep-0484/) – Type HintsPEP written by Guido van Rossum, Jukka Lehtosalo, and Łukasz Langa;
implemented by Guido van Rossum.
* [**PEP 483**](https://peps.python.org/pep-0483/) – The Theory of Type HintsPEP written by Guido van Rossum

### PEP 471 \- os.scandir() function – a better and faster directory iterator[¶](#pep-471-os-scandir-function-a-better-and-faster-directory-iterator "Link to this heading")

[**PEP 471**](https://peps.python.org/pep-0471/) adds a new directory iteration function, [`os.scandir()`](../library/os.html#os.scandir "os.scandir"),
to the standard library. Additionally, [`os.walk()`](../library/os.html#os.walk "os.walk") is now
implemented using `scandir`, which makes it 3 to 5 times faster
on POSIX systems and 7 to 20 times faster on Windows systems. This is
largely achieved by greatly reducing the number of calls to [`os.stat()`](../library/os.html#os.stat "os.stat")
required to walk a directory tree.

Additionally, `scandir` returns an iterator, as opposed to returning
a list of file names, which improves memory efficiency when iterating
over very large directories.

The following example shows a simple use of [`os.scandir()`](../library/os.html#os.scandir "os.scandir") to display all
the files (excluding directories) in the given *path* that don’t start with
`'.'`. The [`entry.is_file()`](../library/os.html#os.DirEntry.is_file "os.DirEntry.is_file") call will generally
not make an additional system call:

\`\`\`
for entry in os.scandir(path):
 if not entry.name.startswith('.') and entry.is\_file():
 print(entry.name)

\`\`\`

See also

[**PEP 471**](https://peps.python.org/pep-0471/) – os.scandir() function – a better and faster directory iteratorPEP written and implemented by Ben Hoyt with the help of Victor Stinner.

### PEP 475: Retry system calls failing with EINTR[¶](#pep-475-retry-system-calls-failing-with-eintr "Link to this heading")

An [`errno.EINTR`](../library/errno.html#errno.EINTR "errno.EINTR") error code is returned whenever a system call, that
is waiting for I/O, is interrupted by a signal. Previously, Python would
raise [`InterruptedError`](../library/exceptions.html#InterruptedError "InterruptedError") in such cases. This meant that, when writing a
Python application, the developer had two choices:

1. Ignore the `InterruptedError`.
2. Handle the `InterruptedError` and attempt to restart the interrupted
system call at every call site.

The first option makes an application fail intermittently.
The second option adds a large amount of boilerplate that makes the
code nearly unreadable. Compare:

\`\`\`
print("Hello World")

\`\`\`

and:

\`\`\`
while True:
 try:
 print("Hello World")
 break
 except InterruptedError:
 continue

\`\`\`

[**PEP 475**](https://peps.python.org/pep-0475/) implements automatic retry of system calls on
`EINTR`. This removes the burden of dealing with `EINTR`
or [`InterruptedError`](../library/exceptions.html#InterruptedError "InterruptedError") in user code in most situations and makes
Python programs, including the standard library, more robust. Note that
the system call is only retried if the signal handler does not raise an
exception.

Below is a list of functions which are now retried when interrupted
by a signal:

* [`open()`](../library/functions.html#open "open") and [`io.open()`](../library/io.html#io.open "io.open");
* functions of the [`faulthandler`](../library/faulthandler.html#module-faulthandler "faulthandler: Dump the Python traceback.") module;
* [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") functions: [`fchdir()`](../library/os.html#os.fchdir "os.fchdir"), [`fchmod()`](../library/os.html#os.fchmod "os.fchmod"),
[`fchown()`](../library/os.html#os.fchown "os.fchown"), [`fdatasync()`](../library/os.html#os.fdatasync "os.fdatasync"), [`fstat()`](../library/os.html#os.fstat "os.fstat"),
[`fstatvfs()`](../library/os.html#os.fstatvfs "os.fstatvfs"), [`fsync()`](../library/os.html#os.fsync "os.fsync"), [`ftruncate()`](../library/os.html#os.ftruncate "os.ftruncate"),
[`mkfifo()`](../library/os.html#os.mkfifo "os.mkfifo"), [`mknod()`](../library/os.html#os.mknod "os.mknod"), [`open()`](../library/os.html#os.open "os.open"),
[`posix_fadvise()`](../library/os.html#os.posix_fadvise "os.posix_fadvise"), [`posix_fallocate()`](../library/os.html#os.posix_fallocate "os.posix_fallocate"), [`pread()`](../library/os.html#os.pread "os.pread"),
[`pwrite()`](../library/os.html#os.pwrite "os.pwrite"), [`read()`](../library/os.html#os.read "os.read"), [`readv()`](../library/os.html#os.readv "os.readv"), [`sendfile()`](../library/os.html#os.sendfile "os.sendfile"),
[`wait3()`](../library/os.html#os.wait3 "os.wait3"), [`wait4()`](../library/os.html#os.wait4 "os.wait4"), [`wait()`](../library/os.html#os.wait "os.wait"),
[`waitid()`](../library/os.html#os.waitid "os.waitid"), [`waitpid()`](../library/os.html#os.waitpid "os.waitpid"), [`write()`](../library/os.html#os.write "os.write"),
[`writev()`](../library/os.html#os.writev "os.writev");
* special cases: [`os.close()`](../library/os.html#os.close "os.close") and [`os.dup2()`](../library/os.html#os.dup2 "os.dup2") now ignore
[`EINTR`](../library/errno.html#errno.EINTR "errno.EINTR") errors; the syscall is not retried (see the PEP
for the rationale);
* [`select`](../library/select.html#module-select "select: Wait for I/O completion on multiple streams.") functions: [`devpoll.poll()`](../library/select.html#select.devpoll.poll "select.devpoll.poll"),
[`epoll.poll()`](../library/select.html#select.epoll.poll "select.epoll.poll"),
[`kqueue.control()`](../library/select.html#select.kqueue.control "select.kqueue.control"),
[`poll.poll()`](../library/select.html#select.poll.poll "select.poll.poll"), [`select()`](../library/select.html#select.select "select.select");
* methods of the [`socket`](../library/socket.html#socket.socket "socket.socket") class: [`accept()`](../library/socket.html#socket.socket.accept "socket.socket.accept"),
[`connect()`](../library/socket.html#socket.socket.connect "socket.socket.connect") (except for non\-blocking sockets),
[`recv()`](../library/socket.html#socket.socket.recv "socket.socket.recv"), [`recvfrom()`](../library/socket.html#socket.socket.recvfrom "socket.socket.recvfrom"),
[`recvmsg()`](../library/socket.html#socket.socket.recvmsg "socket.socket.recvmsg"), [`send()`](../library/socket.html#socket.socket.send "socket.socket.send"),
[`sendall()`](../library/socket.html#socket.socket.sendall "socket.socket.sendall"), [`sendmsg()`](../library/socket.html#socket.socket.sendmsg "socket.socket.sendmsg"),
[`sendto()`](../library/socket.html#socket.socket.sendto "socket.socket.sendto");
* [`signal.sigtimedwait()`](../library/signal.html#signal.sigtimedwait "signal.sigtimedwait") and [`signal.sigwaitinfo()`](../library/signal.html#signal.sigwaitinfo "signal.sigwaitinfo");
* [`time.sleep()`](../library/time.html#time.sleep "time.sleep").

See also

[**PEP 475**](https://peps.python.org/pep-0475/) – Retry system calls failing with EINTRPEP and implementation written by Charles\-François Natali and
Victor Stinner, with the help of Antoine Pitrou (the French connection).

### PEP 479: Change StopIteration handling inside generators[¶](#pep-479-change-stopiteration-handling-inside-generators "Link to this heading")

The interaction of generators and [`StopIteration`](../library/exceptions.html#StopIteration "StopIteration") in Python 3\.4 and
earlier was sometimes surprising, and could conceal obscure bugs. Previously,
`StopIteration` raised accidentally inside a generator function was
interpreted as the end of the iteration by the loop construct driving the
generator.

[**PEP 479**](https://peps.python.org/pep-0479/) changes the behavior of generators: when a `StopIteration`
exception is raised inside a generator, it is replaced with a
[`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") before it exits the generator frame. The main goal of
this change is to ease debugging in the situation where an unguarded
[`next()`](../library/functions.html#next "next") call raises `StopIteration` and causes the iteration controlled
by the generator to terminate silently. This is particularly pernicious in
combination with the `yield from` construct.

This is a backwards incompatible change, so to enable the new behavior,
a [\_\_future\_\_](../glossary.html#term-__future__) import is necessary:

\`\`\`
\>\>\> from \_\_future\_\_ import generator\_stop

\>\>\> def gen():
... next(iter(\[]))
... yield
...
\>\>\> next(gen())
Traceback (most recent call last):
 File "\", line 2, in gen
StopIteration

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
 File "\", line 1, in \
RuntimeError: generator raised StopIteration

\`\`\`

Without a `__future__` import, a [`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning") will be
raised whenever a [`StopIteration`](../library/exceptions.html#StopIteration "StopIteration") exception is raised inside a generator.

See also

[**PEP 479**](https://peps.python.org/pep-0479/) – Change StopIteration handling inside generatorsPEP written by Chris Angelico and Guido van Rossum. Implemented by
Chris Angelico, Yury Selivanov and Nick Coghlan.

### PEP 485: A function for testing approximate equality[¶](#pep-485-a-function-for-testing-approximate-equality "Link to this heading")

[**PEP 485**](https://peps.python.org/pep-0485/) adds the [`math.isclose()`](../library/math.html#math.isclose "math.isclose") and [`cmath.isclose()`](../library/cmath.html#cmath.isclose "cmath.isclose")
functions which tell whether two values are approximately equal or
“close” to each other. Whether or not two values are considered
close is determined according to given absolute and relative tolerances.
Relative tolerance is the maximum allowed difference between `isclose`
arguments, relative to the larger absolute value:

\`\`\`
\>\>\> import math
\>\>\> a = 5\.0
\>\>\> b = 4\.99998
\>\>\> math.isclose(a, b, rel\_tol=1e\-5\)
True
\>\>\> math.isclose(a, b, rel\_tol=1e\-6\)
False

\`\`\`

It is also possible to compare two values using absolute tolerance, which
must be a non\-negative value:

\`\`\`
\>\>\> import math
\>\>\> a = 5\.0
\>\>\> b = 4\.99998
\>\>\> math.isclose(a, b, abs\_tol=0\.00003\)
True
\>\>\> math.isclose(a, b, abs\_tol=0\.00001\)
False

\`\`\`

See also

[**PEP 485**](https://peps.python.org/pep-0485/) – A function for testing approximate equalityPEP written by Christopher Barker; implemented by Chris Barker and
Tal Einat.

### PEP 486: Make the Python Launcher aware of virtual environments[¶](#pep-486-make-the-python-launcher-aware-of-virtual-environments "Link to this heading")

[**PEP 486**](https://peps.python.org/pep-0486/) makes the Windows launcher (see [**PEP 397**](https://peps.python.org/pep-0397/)) aware of an active
virtual environment. When the default interpreter would be used and the
`VIRTUAL_ENV` environment variable is set, the interpreter in the virtual
environment will be used.

See also

[**PEP 486**](https://peps.python.org/pep-0486/) – Make the Python Launcher aware of virtual environmentsPEP written and implemented by Paul Moore.

### PEP 488: Elimination of PYO files[¶](#pep-488-elimination-of-pyo-files "Link to this heading")

[**PEP 488**](https://peps.python.org/pep-0488/) does away with the concept of `.pyo` files. This means that
`.pyc` files represent both unoptimized and optimized bytecode. To prevent the
need to constantly regenerate bytecode files, `.pyc` files now have an
optional `opt-` tag in their name when the bytecode is optimized. This has the
side\-effect of no more bytecode file name clashes when running under either
[`-O`](../using/cmdline.html#cmdoption-O) or [`-OO`](../using/cmdline.html#cmdoption-OO). Consequently, bytecode files generated from
[`-O`](../using/cmdline.html#cmdoption-O), and [`-OO`](../using/cmdline.html#cmdoption-OO) may now exist simultaneously.
[`importlib.util.cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source") has an updated API to help with
this change.

See also

[**PEP 488**](https://peps.python.org/pep-0488/) – Elimination of PYO filesPEP written and implemented by Brett Cannon.

### PEP 489: Multi\-phase extension module initialization[¶](#pep-489-multi-phase-extension-module-initialization "Link to this heading")

[**PEP 489**](https://peps.python.org/pep-0489/) updates extension module initialization to take advantage of the
two step module loading mechanism introduced by [**PEP 451**](https://peps.python.org/pep-0451/) in Python 3\.4\.

This change brings the import semantics of extension modules that opt\-in to
using the new mechanism much closer to those of Python source and bytecode
modules, including the ability to use any valid identifier as a module name,
rather than being restricted to ASCII.

See also

[**PEP 489**](https://peps.python.org/pep-0489/) – Multi\-phase extension module initializationPEP written by Petr Viktorin, Stefan Behnel, and Nick Coghlan;
implemented by Petr Viktorin.

## Other Language Changes[¶](#other-language-changes "Link to this heading")

Some smaller changes made to the core Python language are:

* Added the `"namereplace"` error handlers. The `"backslashreplace"`
error handlers now work with decoding and translating.
(Contributed by Serhiy Storchaka in [bpo\-19676](https://bugs.python.org/issue?@action=redirect&bpo=19676) and [bpo\-22286](https://bugs.python.org/issue?@action=redirect&bpo=22286).)
* The [`-b`](../using/cmdline.html#cmdoption-b) option now affects comparisons of [`bytes`](../library/stdtypes.html#bytes "bytes") with
[`int`](../library/functions.html#int "int"). (Contributed by Serhiy Storchaka in [bpo\-23681](https://bugs.python.org/issue?@action=redirect&bpo=23681).)
* New Kazakh `kz1048` and Tajik `koi8_t` [codecs](../library/codecs.html#standard-encodings).
(Contributed by Serhiy Storchaka in [bpo\-22682](https://bugs.python.org/issue?@action=redirect&bpo=22682) and [bpo\-22681](https://bugs.python.org/issue?@action=redirect&bpo=22681).)
* Property docstrings are now writable. This is especially useful for
[`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") docstrings.
(Contributed by Berker Peksag in [bpo\-24064](https://bugs.python.org/issue?@action=redirect&bpo=24064).)
* Circular imports involving relative imports are now supported.
(Contributed by Brett Cannon and Antoine Pitrou in [bpo\-17636](https://bugs.python.org/issue?@action=redirect&bpo=17636).)

## New Modules[¶](#new-modules "Link to this heading")

### typing[¶](#typing "Link to this heading")

The new [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") [provisional](../glossary.html#term-provisional-API) module
provides standard definitions and tools for function type annotations.
See [Type Hints](#whatsnew-pep-484) for more information.

### zipapp[¶](#zipapp "Link to this heading")

The new [`zipapp`](../library/zipapp.html#module-zipapp "zipapp: Manage executable Python zip archives") module (specified in [**PEP 441**](https://peps.python.org/pep-0441/)) provides an API and
command line tool for creating executable Python Zip Applications, which
were introduced in Python 2\.6 in [bpo\-1739468](https://bugs.python.org/issue?@action=redirect&bpo=1739468), but which were not well
publicized, either at the time or since.

With the new module, bundling your application is as simple as putting all
the files, including a `__main__.py` file, into a directory `myapp`
and running:

\`\`\`
$ python \-m zipapp myapp
$ python myapp.pyz

\`\`\`

The module implementation has been contributed by Paul Moore in
[bpo\-23491](https://bugs.python.org/issue?@action=redirect&bpo=23491).

See also

[**PEP 441**](https://peps.python.org/pep-0441/) – Improving Python ZIP Application Support

## Improved Modules[¶](#improved-modules "Link to this heading")

### argparse[¶](#argparse "Link to this heading")

The [`ArgumentParser`](../library/argparse.html#argparse.ArgumentParser "argparse.ArgumentParser") class now allows disabling
[abbreviated usage](../library/argparse.html#prefix-matching) of long options by setting
[allow\_abbrev](../library/argparse.html#allow-abbrev) to `False`. (Contributed by Jonathan Paugh,
Steven Bethard, paul j3 and Daniel Eriksson in [bpo\-14910](https://bugs.python.org/issue?@action=redirect&bpo=14910).)

### asyncio[¶](#asyncio "Link to this heading")

Since the [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module is [provisional](../glossary.html#term-provisional-API),
all changes introduced in Python 3\.5 have also been backported to Python 3\.4\.x.

Notable changes in the [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module since Python 3\.4\.0:

* New debugging APIs: [`loop.set_debug()`](../library/asyncio-eventloop.html#asyncio.loop.set_debug "asyncio.loop.set_debug")
and [`loop.get_debug()`](../library/asyncio-eventloop.html#asyncio.loop.get_debug "asyncio.loop.get_debug") methods.
(Contributed by Victor Stinner.)
* The proactor event loop now supports SSL.
(Contributed by Antoine Pitrou and Victor Stinner in [bpo\-22560](https://bugs.python.org/issue?@action=redirect&bpo=22560).)
* A new [`loop.is_closed()`](../library/asyncio-eventloop.html#asyncio.loop.is_closed "asyncio.loop.is_closed") method to
check if the event loop is closed.
(Contributed by Victor Stinner in [bpo\-21326](https://bugs.python.org/issue?@action=redirect&bpo=21326).)
* A new [`loop.create_task()`](../library/asyncio-eventloop.html#asyncio.loop.create_task "asyncio.loop.create_task")
to conveniently create and schedule a new [`Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task")
for a coroutine. The `create_task` method is also used by all
asyncio functions that wrap coroutines into tasks, such as
[`asyncio.wait()`](../library/asyncio-task.html#asyncio.wait "asyncio.wait"), [`asyncio.gather()`](../library/asyncio-task.html#asyncio.gather "asyncio.gather"), etc.
(Contributed by Victor Stinner.)
* A new [`transport.get_write_buffer_limits()`](../library/asyncio-protocol.html#asyncio.WriteTransport.get_write_buffer_limits "asyncio.WriteTransport.get_write_buffer_limits")
method to inquire for *high\-* and *low\-* water limits of the flow
control.
(Contributed by Victor Stinner.)
* The `async()` function is deprecated in favor of
[`ensure_future()`](../library/asyncio-future.html#asyncio.ensure_future "asyncio.ensure_future").
(Contributed by Yury Selivanov.)
* New [`loop.set_task_factory()`](../library/asyncio-eventloop.html#asyncio.loop.set_task_factory "asyncio.loop.set_task_factory") and
[`loop.get_task_factory()`](../library/asyncio-eventloop.html#asyncio.loop.get_task_factory "asyncio.loop.get_task_factory")
methods to customize the task factory that [`loop.create_task()`](../library/asyncio-eventloop.html#asyncio.loop.create_task "asyncio.loop.create_task") method uses. (Contributed by Yury
Selivanov.)
* New [`Queue.join()`](../library/asyncio-queue.html#asyncio.Queue.join "asyncio.Queue.join") and
[`Queue.task_done()`](../library/asyncio-queue.html#asyncio.Queue.task_done "asyncio.Queue.task_done") queue methods.
(Contributed by Victor Stinner.)
* The `JoinableQueue` class was removed, in favor of the
[`asyncio.Queue`](../library/asyncio-queue.html#asyncio.Queue "asyncio.Queue") class.
(Contributed by Victor Stinner.)

Updates in 3\.5\.1:

* The [`ensure_future()`](../library/asyncio-future.html#asyncio.ensure_future "asyncio.ensure_future") function and all functions that
use it, such as [`loop.run_until_complete()`](../library/asyncio-eventloop.html#asyncio.loop.run_until_complete "asyncio.loop.run_until_complete"),
now accept all kinds of [awaitable objects](../glossary.html#term-awaitable).
(Contributed by Yury Selivanov.)
* New [`run_coroutine_threadsafe()`](../library/asyncio-task.html#asyncio.run_coroutine_threadsafe "asyncio.run_coroutine_threadsafe") function to submit
coroutines to event loops from other threads.
(Contributed by Vincent Michel.)
* New [`Transport.is_closing()`](../library/asyncio-protocol.html#asyncio.BaseTransport.is_closing "asyncio.BaseTransport.is_closing")
method to check if the transport is closing or closed.
(Contributed by Yury Selivanov.)
* The [`loop.create_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_server "asyncio.loop.create_server")
method can now accept a list of hosts.
(Contributed by Yann Sionneau.)

Updates in 3\.5\.2:

* New [`loop.create_future()`](../library/asyncio-eventloop.html#asyncio.loop.create_future "asyncio.loop.create_future")
method to create Future objects. This allows alternative event
loop implementations, such as
[uvloop](https://github.com/MagicStack/uvloop), to provide a faster
[`asyncio.Future`](../library/asyncio-future.html#asyncio.Future "asyncio.Future") implementation.
(Contributed by Yury Selivanov.)
* New [`loop.get_exception_handler()`](../library/asyncio-eventloop.html#asyncio.loop.get_exception_handler "asyncio.loop.get_exception_handler")
method to get the current exception handler.
(Contributed by Yury Selivanov.)
* New [`StreamReader.readuntil()`](../library/asyncio-stream.html#asyncio.StreamReader.readuntil "asyncio.StreamReader.readuntil")
method to read data from the stream until a separator bytes
sequence appears.
(Contributed by Mark Korenberg.)
* The [`loop.create_connection()`](../library/asyncio-eventloop.html#asyncio.loop.create_connection "asyncio.loop.create_connection")
and [`loop.create_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_server "asyncio.loop.create_server")
methods are optimized to avoid calling the system `getaddrinfo`
function if the address is already resolved.
(Contributed by A. Jesse Jiryu Davis.)
* The [`loop.sock_connect(sock, address)`](../library/asyncio-eventloop.html#asyncio.loop.sock_connect "asyncio.loop.sock_connect")
no longer requires the *address* to be resolved prior to the call.
(Contributed by A. Jesse Jiryu Davis.)

### bz2[¶](#bz2 "Link to this heading")

The [`BZ2Decompressor.decompress`](../library/bz2.html#bz2.BZ2Decompressor.decompress "bz2.BZ2Decompressor.decompress")
method now accepts an optional *max\_length* argument to limit the maximum
size of decompressed data. (Contributed by Nikolaus Rath in [bpo\-15955](https://bugs.python.org/issue?@action=redirect&bpo=15955).)

### cgi[¶](#cgi "Link to this heading")

The `FieldStorage` class now supports the [context manager](../glossary.html#term-context-manager)
protocol. (Contributed by Berker Peksag in [bpo\-20289](https://bugs.python.org/issue?@action=redirect&bpo=20289).)

### cmath[¶](#cmath "Link to this heading")

A new function [`isclose()`](../library/cmath.html#cmath.isclose "cmath.isclose") provides a way to test for approximate
equality. (Contributed by Chris Barker and Tal Einat in [bpo\-24270](https://bugs.python.org/issue?@action=redirect&bpo=24270).)

### code[¶](#code "Link to this heading")

The [`InteractiveInterpreter.showtraceback()`](../library/code.html#code.InteractiveInterpreter.showtraceback "code.InteractiveInterpreter.showtraceback")
method now prints the full chained traceback, just like the interactive
interpreter. (Contributed by Claudiu Popa in [bpo\-17442](https://bugs.python.org/issue?@action=redirect&bpo=17442).)

### collections[¶](#collections "Link to this heading")

The [`OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict") class is now implemented in C, which
makes it 4 to 100 times faster. (Contributed by Eric Snow in [bpo\-16991](https://bugs.python.org/issue?@action=redirect&bpo=16991).)

`OrderedDict.items()`,
`OrderedDict.keys()`,
`OrderedDict.values()` views now support
[`reversed()`](../library/functions.html#reversed "reversed") iteration.
(Contributed by Serhiy Storchaka in [bpo\-19505](https://bugs.python.org/issue?@action=redirect&bpo=19505).)

The [`deque`](../library/collections.html#collections.deque "collections.deque") class now defines
[`index()`](../library/collections.html#collections.deque.index "collections.deque.index"), [`insert()`](../library/collections.html#collections.deque.insert "collections.deque.insert"), and
[`copy()`](../library/collections.html#collections.deque.copy "collections.deque.copy"), and supports the `+` and `*` operators.
This allows deques to be recognized as a [`MutableSequence`](../library/collections.abc.html#collections.abc.MutableSequence "collections.abc.MutableSequence")
and improves their substitutability for lists.
(Contributed by Raymond Hettinger in [bpo\-23704](https://bugs.python.org/issue?@action=redirect&bpo=23704).)

Docstrings produced by [`namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") can now be updated:

\`\`\`
Point = namedtuple('Point', \['x', 'y'])
Point.\_\_doc\_\_ \+= ': Cartesian coordinate'
Point.x.\_\_doc\_\_ = 'abscissa'
Point.y.\_\_doc\_\_ = 'ordinate'

\`\`\`

(Contributed by Berker Peksag in [bpo\-24064](https://bugs.python.org/issue?@action=redirect&bpo=24064).)

The [`UserString`](../library/collections.html#collections.UserString "collections.UserString") class now implements the
`__getnewargs__()`, `__rmod__()`, [`casefold()`](../library/stdtypes.html#str.casefold "str.casefold"),
[`format_map()`](../library/stdtypes.html#str.format_map "str.format_map"), [`isprintable()`](../library/stdtypes.html#str.isprintable "str.isprintable"), and [`maketrans()`](../library/stdtypes.html#str.maketrans "str.maketrans")
methods to match the corresponding methods of [`str`](../library/stdtypes.html#str "str").
(Contributed by Joe Jevnik in [bpo\-22189](https://bugs.python.org/issue?@action=redirect&bpo=22189).)

### collections.abc[¶](#collections-abc "Link to this heading")

The `Sequence.index()` method now
accepts *start* and *stop* arguments to match the corresponding methods
of [`tuple`](../library/stdtypes.html#tuple "tuple"), [`list`](../library/stdtypes.html#list "list"), etc.
(Contributed by Devin Jeanpierre in [bpo\-23086](https://bugs.python.org/issue?@action=redirect&bpo=23086).)

A new [`Generator`](../library/collections.abc.html#collections.abc.Generator "collections.abc.Generator") abstract base class. (Contributed
by Stefan Behnel in [bpo\-24018](https://bugs.python.org/issue?@action=redirect&bpo=24018).)

New [`Awaitable`](../library/collections.abc.html#collections.abc.Awaitable "collections.abc.Awaitable"), [`Coroutine`](../library/collections.abc.html#collections.abc.Coroutine "collections.abc.Coroutine"),
[`AsyncIterator`](../library/collections.abc.html#collections.abc.AsyncIterator "collections.abc.AsyncIterator"), and
[`AsyncIterable`](../library/collections.abc.html#collections.abc.AsyncIterable "collections.abc.AsyncIterable") abstract base classes.
(Contributed by Yury Selivanov in [bpo\-24184](https://bugs.python.org/issue?@action=redirect&bpo=24184).)

For earlier Python versions, a backport of the new ABCs is available in an
external [PyPI package](https://pypi.org/project/backports_abc/).

### compileall[¶](#compileall "Link to this heading")

A new [`compileall`](../library/compileall.html#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.") option, `-j N`, allows running *N* workers
simultaneously to perform parallel bytecode compilation.
The [`compile_dir()`](../library/compileall.html#compileall.compile_dir "compileall.compile_dir") function has a corresponding `workers`
parameter. (Contributed by Claudiu Popa in [bpo\-16104](https://bugs.python.org/issue?@action=redirect&bpo=16104).)

Another new option, `-r`, allows controlling the maximum recursion
level for subdirectories. (Contributed by Claudiu Popa in [bpo\-19628](https://bugs.python.org/issue?@action=redirect&bpo=19628).)

The `-q` command line option can now be specified more than once, in
which case all output, including errors, will be suppressed. The corresponding
`quiet` parameter in [`compile_dir()`](../library/compileall.html#compileall.compile_dir "compileall.compile_dir"),
[`compile_file()`](../library/compileall.html#compileall.compile_file "compileall.compile_file"), and [`compile_path()`](../library/compileall.html#compileall.compile_path "compileall.compile_path") can now
accept an integer value indicating the level of output suppression.
(Contributed by Thomas Kluyver in [bpo\-21338](https://bugs.python.org/issue?@action=redirect&bpo=21338).)

### concurrent.futures[¶](#concurrent-futures "Link to this heading")

The [`Executor.map()`](../library/concurrent.futures.html#concurrent.futures.Executor.map "concurrent.futures.Executor.map") method now accepts a
*chunksize* argument to allow batching of tasks to improve performance when
[`ProcessPoolExecutor()`](../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor "concurrent.futures.ProcessPoolExecutor") is used.
(Contributed by Dan O’Reilly in [bpo\-11271](https://bugs.python.org/issue?@action=redirect&bpo=11271).)

The number of workers in the [`ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor")
constructor is optional now. The default value is 5 times the number of CPUs.
(Contributed by Claudiu Popa in [bpo\-21527](https://bugs.python.org/issue?@action=redirect&bpo=21527).)

### configparser[¶](#configparser "Link to this heading")

[`configparser`](../library/configparser.html#module-configparser "configparser: Configuration file parser.") now provides a way to customize the conversion
of values by specifying a dictionary of converters in the
[`ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser") constructor, or by defining them
as methods in `ConfigParser` subclasses. Converters defined in
a parser instance are inherited by its section proxies.

Example:

\`\`\`
\>\>\> import configparser
\>\>\> conv = {}
\>\>\> conv\['list'] = lambda v: \[e.strip() for e in v.split() if e.strip()]
\>\>\> cfg = configparser.ConfigParser(converters=conv)
\>\>\> cfg.read\_string("""
... \[s]
... list = a b c d e f g
... """)
\>\>\> cfg.get('s', 'list')
'a b c d e f g'
\>\>\> cfg.getlist('s', 'list')
\['a', 'b', 'c', 'd', 'e', 'f', 'g']
\>\>\> section = cfg\['s']
\>\>\> section.getlist('list')
\['a', 'b', 'c', 'd', 'e', 'f', 'g']

\`\`\`

(Contributed by Łukasz Langa in [bpo\-18159](https://bugs.python.org/issue?@action=redirect&bpo=18159).)

### contextlib[¶](#contextlib "Link to this heading")

The new [`redirect_stderr()`](../library/contextlib.html#contextlib.redirect_stderr "contextlib.redirect_stderr") [context manager](../glossary.html#term-context-manager) (similar to
[`redirect_stdout()`](../library/contextlib.html#contextlib.redirect_stdout "contextlib.redirect_stdout")) makes it easier for utility scripts to
handle inflexible APIs that write their output to [`sys.stderr`](../library/sys.html#sys.stderr "sys.stderr") and
don’t provide any options to redirect it:

\`\`\`
\>\>\> import contextlib, io, logging
\>\>\> f = io.StringIO()
\>\>\> with contextlib.redirect\_stderr(f):
... logging.warning('warning')
...
\>\>\> f.getvalue()
'WARNING:root:warning\\n'

\`\`\`

(Contributed by Berker Peksag in [bpo\-22389](https://bugs.python.org/issue?@action=redirect&bpo=22389).)

### csv[¶](#csv "Link to this heading")

The [`writerow()`](../library/csv.html#csv.csvwriter.writerow "csv.csvwriter.writerow") method now supports arbitrary iterables,
not just sequences. (Contributed by Serhiy Storchaka in [bpo\-23171](https://bugs.python.org/issue?@action=redirect&bpo=23171).)

### curses[¶](#curses "Link to this heading")

The new [`update_lines_cols()`](../library/curses.html#curses.update_lines_cols "curses.update_lines_cols") function updates the `LINES`
and `COLS` module variables. This is useful for detecting
manual screen resizing. (Contributed by Arnon Yaari in [bpo\-4254](https://bugs.python.org/issue?@action=redirect&bpo=4254).)

### dbm[¶](#dbm "Link to this heading")

[`dumb.open`](../library/dbm.html#dbm.dumb.open "dbm.dumb.open") always creates a new database when the flag
has the value `"n"`. (Contributed by Claudiu Popa in [bpo\-18039](https://bugs.python.org/issue?@action=redirect&bpo=18039).)

### difflib[¶](#difflib "Link to this heading")

The charset of HTML documents generated by
[`HtmlDiff.make_file()`](../library/difflib.html#difflib.HtmlDiff.make_file "difflib.HtmlDiff.make_file")
can now be customized by using a new *charset* keyword\-only argument.
The default charset of HTML document changed from `"ISO-8859-1"`
to `"utf-8"`.
(Contributed by Berker Peksag in [bpo\-2052](https://bugs.python.org/issue?@action=redirect&bpo=2052).)

The [`diff_bytes()`](../library/difflib.html#difflib.diff_bytes "difflib.diff_bytes") function can now compare lists of byte
strings. This fixes a regression from Python 2\.
(Contributed by Terry J. Reedy and Greg Ward in [bpo\-17445](https://bugs.python.org/issue?@action=redirect&bpo=17445).)

### distutils[¶](#distutils "Link to this heading")

Both the `build` and `build_ext` commands now accept a `-j` option to
enable parallel building of extension modules.
(Contributed by Antoine Pitrou in [bpo\-5309](https://bugs.python.org/issue?@action=redirect&bpo=5309).)

The `distutils` module now supports `xz` compression, and can be
enabled by passing `xztar` as an argument to `bdist --format`.
(Contributed by Serhiy Storchaka in [bpo\-16314](https://bugs.python.org/issue?@action=redirect&bpo=16314).)

### doctest[¶](#doctest "Link to this heading")

The [`DocTestSuite()`](../library/doctest.html#doctest.DocTestSuite "doctest.DocTestSuite") function returns an empty
[`unittest.TestSuite`](../library/unittest.html#unittest.TestSuite "unittest.TestSuite") if *module* contains no docstrings, instead of
raising [`ValueError`](../library/exceptions.html#ValueError "ValueError"). (Contributed by Glenn Jones in [bpo\-15916](https://bugs.python.org/issue?@action=redirect&bpo=15916).)

### email[¶](#email "Link to this heading")

A new policy option [`Policy.mangle_from_`](../library/email.policy.html#email.policy.Policy.mangle_from_ "email.policy.Policy.mangle_from_")
controls whether or not lines that start with `"From "` in email bodies are
prefixed with a `">"` character by generators. The default is `True` for
[`compat32`](../library/email.policy.html#email.policy.compat32 "email.policy.compat32") and `False` for all other policies.
(Contributed by Milan Oberkirch in [bpo\-20098](https://bugs.python.org/issue?@action=redirect&bpo=20098).)

A new
[`Message.get_content_disposition()`](../library/email.compat32-message.html#email.message.Message.get_content_disposition "email.message.Message.get_content_disposition")
method provides easy access to a canonical value for the
*Content\-Disposition* header.
(Contributed by Abhilash Raj in [bpo\-21083](https://bugs.python.org/issue?@action=redirect&bpo=21083).)

A new policy option [`EmailPolicy.utf8`](../library/email.policy.html#email.policy.EmailPolicy.utf8 "email.policy.EmailPolicy.utf8")
can be set to `True` to encode email headers using the UTF\-8 charset instead
of using encoded words. This allows `Messages` to be formatted according to
[**RFC 6532**](https://datatracker.ietf.org/doc/html/rfc6532.html) and used with an SMTP server that supports the [**RFC 6531**](https://datatracker.ietf.org/doc/html/rfc6531.html)
`SMTPUTF8` extension. (Contributed by R. David Murray in
[bpo\-24211](https://bugs.python.org/issue?@action=redirect&bpo=24211).)

The [`mime.text.MIMEText`](../library/email.mime.html#email.mime.text.MIMEText "email.mime.text.MIMEText") constructor now
accepts a [`charset.Charset`](../library/email.charset.html#email.charset.Charset "email.charset.Charset") instance.
(Contributed by Claude Paroz and Berker Peksag in [bpo\-16324](https://bugs.python.org/issue?@action=redirect&bpo=16324).)

### enum[¶](#enum "Link to this heading")

The [`Enum`](../library/enum.html#enum.Enum "enum.Enum") callable has a new parameter *start* to
specify the initial number of enum values if only *names* are provided:

\`\`\`
\>\>\> Animal = enum.Enum('Animal', 'cat dog', start=10\)
\>\>\> Animal.cat
\
\>\>\> Animal.dog
\

\`\`\`

(Contributed by Ethan Furman in [bpo\-21706](https://bugs.python.org/issue?@action=redirect&bpo=21706).)

### faulthandler[¶](#faulthandler "Link to this heading")

The [`enable()`](../library/faulthandler.html#faulthandler.enable "faulthandler.enable"), [`register()`](../library/faulthandler.html#faulthandler.register "faulthandler.register"),
[`dump_traceback()`](../library/faulthandler.html#faulthandler.dump_traceback "faulthandler.dump_traceback") and
[`dump_traceback_later()`](../library/faulthandler.html#faulthandler.dump_traceback_later "faulthandler.dump_traceback_later") functions now accept file
descriptors in addition to file\-like objects.
(Contributed by Wei Wu in [bpo\-23566](https://bugs.python.org/issue?@action=redirect&bpo=23566).)

### functools[¶](#functools "Link to this heading")

Most of the [`lru_cache()`](../library/functools.html#functools.lru_cache "functools.lru_cache") machinery is now implemented in C, making
it significantly faster. (Contributed by Matt Joiner, Alexey Kachayev, and
Serhiy Storchaka in [bpo\-14373](https://bugs.python.org/issue?@action=redirect&bpo=14373).)

### glob[¶](#glob "Link to this heading")

The [`iglob()`](../library/glob.html#glob.iglob "glob.iglob") and [`glob()`](../library/glob.html#glob.glob "glob.glob") functions now support recursive
search in subdirectories, using the `"**"` pattern.
(Contributed by Serhiy Storchaka in [bpo\-13968](https://bugs.python.org/issue?@action=redirect&bpo=13968).)

### gzip[¶](#gzip "Link to this heading")

The *mode* argument of the [`GzipFile`](../library/gzip.html#gzip.GzipFile "gzip.GzipFile") constructor now
accepts `"x"` to request exclusive creation.
(Contributed by Tim Heaney in [bpo\-19222](https://bugs.python.org/issue?@action=redirect&bpo=19222).)

### heapq[¶](#heapq "Link to this heading")

Element comparison in [`merge()`](../library/heapq.html#heapq.merge "heapq.merge") can now be customized by
passing a [key function](../glossary.html#term-key-function) in a new optional *key* keyword argument,
and a new optional *reverse* keyword argument can be used to reverse element
comparison:

\`\`\`
\>\>\> import heapq
\>\>\> a = \['9', '777', '55555']
\>\>\> b = \['88', '6666']
\>\>\> list(heapq.merge(a, b, key=len))
\['9', '88', '777', '6666', '55555']
\>\>\> list(heapq.merge(reversed(a), reversed(b), key=len, reverse=True))
\['55555', '6666', '777', '88', '9']

\`\`\`

(Contributed by Raymond Hettinger in [bpo\-13742](https://bugs.python.org/issue?@action=redirect&bpo=13742).)

### http[¶](#http "Link to this heading")

A new [`HTTPStatus`](../library/http.html#http.HTTPStatus "http.HTTPStatus") enum that defines a set of
HTTP status codes, reason phrases and long descriptions written in English.
(Contributed by Demian Brecht in [bpo\-21793](https://bugs.python.org/issue?@action=redirect&bpo=21793).)

### http.client[¶](#http-client "Link to this heading")

[`HTTPConnection.getresponse()`](../library/http.client.html#http.client.HTTPConnection.getresponse "http.client.HTTPConnection.getresponse")
now raises a [`RemoteDisconnected`](../library/http.client.html#http.client.RemoteDisconnected "http.client.RemoteDisconnected") exception when a
remote server connection is closed unexpectedly. Additionally, if a
[`ConnectionError`](../library/exceptions.html#ConnectionError "ConnectionError") (of which `RemoteDisconnected`
is a subclass) is raised, the client socket is now closed automatically,
and will reconnect on the next request:

\`\`\`
import http.client
conn = http.client.HTTPConnection('www.python.org')
for retries in range(3\):
 try:
 conn.request('GET', '/')
 resp = conn.getresponse()
 except http.client.RemoteDisconnected:
 pass

\`\`\`

(Contributed by Martin Panter in [bpo\-3566](https://bugs.python.org/issue?@action=redirect&bpo=3566).)

### idlelib and IDLE[¶](#idlelib-and-idle "Link to this heading")

Since idlelib implements the IDLE shell and editor and is not intended for
import by other programs, it gets improvements with every release. See
`Lib/idlelib/NEWS.txt` for a cumulative list of changes since 3\.4\.0,
as well as changes made in future 3\.5\.x releases. This file is also available
from the IDLE Help ‣ About IDLE dialog.

### imaplib[¶](#imaplib "Link to this heading")

The [`IMAP4`](../library/imaplib.html#imaplib.IMAP4 "imaplib.IMAP4") class now supports the [context manager](../glossary.html#term-context-manager) protocol.
When used in a [`with`](../reference/compound_stmts.html#with) statement, the IMAP4 `LOGOUT`
command will be called automatically at the end of the block.
(Contributed by Tarek Ziadé and Serhiy Storchaka in [bpo\-4972](https://bugs.python.org/issue?@action=redirect&bpo=4972).)

The [`imaplib`](../library/imaplib.html#module-imaplib "imaplib: IMAP4 protocol client (requires sockets).") module now supports [**RFC 5161**](https://datatracker.ietf.org/doc/html/rfc5161.html) (ENABLE Extension)
and [**RFC 6855**](https://datatracker.ietf.org/doc/html/rfc6855.html) (UTF\-8 Support) via the [`IMAP4.enable()`](../library/imaplib.html#imaplib.IMAP4.enable "imaplib.IMAP4.enable")
method. A new [`IMAP4.utf8_enabled`](../library/imaplib.html#imaplib.IMAP4.utf8_enabled "imaplib.IMAP4.utf8_enabled")
attribute tracks whether or not [**RFC 6855**](https://datatracker.ietf.org/doc/html/rfc6855.html) support is enabled.
(Contributed by Milan Oberkirch, R. David Murray, and Maciej Szulik in
[bpo\-21800](https://bugs.python.org/issue?@action=redirect&bpo=21800).)

The [`imaplib`](../library/imaplib.html#module-imaplib "imaplib: IMAP4 protocol client (requires sockets).") module now automatically encodes non\-ASCII string usernames
and passwords using UTF\-8, as recommended by the RFCs. (Contributed by Milan
Oberkirch in [bpo\-21800](https://bugs.python.org/issue?@action=redirect&bpo=21800).)

### imghdr[¶](#imghdr "Link to this heading")

The `what()` function now recognizes the
[OpenEXR](https://www.openexr.com) format
(contributed by Martin Vignali and Claudiu Popa in [bpo\-20295](https://bugs.python.org/issue?@action=redirect&bpo=20295)),
and the [WebP](https://en.wikipedia.org/wiki/WebP) format
(contributed by Fabrice Aneche and Claudiu Popa in [bpo\-20197](https://bugs.python.org/issue?@action=redirect&bpo=20197).)

### importlib[¶](#importlib "Link to this heading")

The [`util.LazyLoader`](../library/importlib.html#importlib.util.LazyLoader "importlib.util.LazyLoader") class allows for
lazy loading of modules in applications where startup time is important.
(Contributed by Brett Cannon in [bpo\-17621](https://bugs.python.org/issue?@action=redirect&bpo=17621).)

The [`abc.InspectLoader.source_to_code()`](../library/importlib.html#importlib.abc.InspectLoader.source_to_code "importlib.abc.InspectLoader.source_to_code")
method is now a static method. This makes it easier to initialize a module
object with code compiled from a string by running
`exec(code, module.__dict__)`.
(Contributed by Brett Cannon in [bpo\-21156](https://bugs.python.org/issue?@action=redirect&bpo=21156).)

The new [`util.module_from_spec()`](../library/importlib.html#importlib.util.module_from_spec "importlib.util.module_from_spec")
function is now the preferred way to create a new module. As opposed to
creating a [`types.ModuleType`](../library/types.html#types.ModuleType "types.ModuleType") instance directly, this new function
will set the various import\-controlled attributes based on the passed\-in
spec object. (Contributed by Brett Cannon in [bpo\-20383](https://bugs.python.org/issue?@action=redirect&bpo=20383).)

### inspect[¶](#inspect "Link to this heading")

Both the [`Signature`](../library/inspect.html#inspect.Signature "inspect.Signature") and [`Parameter`](../library/inspect.html#inspect.Parameter "inspect.Parameter") classes are
now picklable and hashable. (Contributed by Yury Selivanov in [bpo\-20726](https://bugs.python.org/issue?@action=redirect&bpo=20726)
and [bpo\-20334](https://bugs.python.org/issue?@action=redirect&bpo=20334).)

A new
[`BoundArguments.apply_defaults()`](../library/inspect.html#inspect.BoundArguments.apply_defaults "inspect.BoundArguments.apply_defaults")
method provides a way to set default values for missing arguments:

\`\`\`
\>\>\> def foo(a, b='ham', \*args): pass
\>\>\> ba = inspect.signature(foo).bind('spam')
\>\>\> ba.apply\_defaults()
\>\>\> ba.arguments
OrderedDict(\[('a', 'spam'), ('b', 'ham'), ('args', ())])

\`\`\`

(Contributed by Yury Selivanov in [bpo\-24190](https://bugs.python.org/issue?@action=redirect&bpo=24190).)

A new class method
[`Signature.from_callable()`](../library/inspect.html#inspect.Signature.from_callable "inspect.Signature.from_callable") makes
subclassing of [`Signature`](../library/inspect.html#inspect.Signature "inspect.Signature") easier. (Contributed
by Yury Selivanov and Eric Snow in [bpo\-17373](https://bugs.python.org/issue?@action=redirect&bpo=17373).)

The [`signature()`](../library/inspect.html#inspect.signature "inspect.signature") function now accepts a *follow\_wrapped*
optional keyword argument, which, when set to `False`, disables automatic
following of `__wrapped__` links.
(Contributed by Yury Selivanov in [bpo\-20691](https://bugs.python.org/issue?@action=redirect&bpo=20691).)

A set of new functions to inspect
[coroutine functions](../glossary.html#term-coroutine-function) and
[coroutine objects](../glossary.html#term-coroutine) has been added:
[`iscoroutine()`](../library/inspect.html#inspect.iscoroutine "inspect.iscoroutine"), [`iscoroutinefunction()`](../library/inspect.html#inspect.iscoroutinefunction "inspect.iscoroutinefunction"),
[`isawaitable()`](../library/inspect.html#inspect.isawaitable "inspect.isawaitable"), [`getcoroutinelocals()`](../library/inspect.html#inspect.getcoroutinelocals "inspect.getcoroutinelocals"),
and [`getcoroutinestate()`](../library/inspect.html#inspect.getcoroutinestate "inspect.getcoroutinestate").
(Contributed by Yury Selivanov in [bpo\-24017](https://bugs.python.org/issue?@action=redirect&bpo=24017) and [bpo\-24400](https://bugs.python.org/issue?@action=redirect&bpo=24400).)

The [`stack()`](../library/inspect.html#inspect.stack "inspect.stack"), [`trace()`](../library/inspect.html#inspect.trace "inspect.trace"),
[`getouterframes()`](../library/inspect.html#inspect.getouterframes "inspect.getouterframes"), and [`getinnerframes()`](../library/inspect.html#inspect.getinnerframes "inspect.getinnerframes")
functions now return a list of named tuples.
(Contributed by Daniel Shahaf in [bpo\-16808](https://bugs.python.org/issue?@action=redirect&bpo=16808).)

### io[¶](#io "Link to this heading")

A new [`BufferedIOBase.readinto1()`](../library/io.html#io.BufferedIOBase.readinto1 "io.BufferedIOBase.readinto1")
method, that uses at most one call to the underlying raw stream’s
[`RawIOBase.read()`](../library/io.html#io.RawIOBase.read "io.RawIOBase.read") or
[`RawIOBase.readinto()`](../library/io.html#io.RawIOBase.readinto "io.RawIOBase.readinto") methods.
(Contributed by Nikolaus Rath in [bpo\-20578](https://bugs.python.org/issue?@action=redirect&bpo=20578).)

### ipaddress[¶](#ipaddress "Link to this heading")

Both the [`IPv4Network`](../library/ipaddress.html#ipaddress.IPv4Network "ipaddress.IPv4Network") and [`IPv6Network`](../library/ipaddress.html#ipaddress.IPv6Network "ipaddress.IPv6Network") classes
now accept an `(address, netmask)` tuple argument, so as to easily construct
network objects from existing addresses:

\`\`\`
\>\>\> import ipaddress
\>\>\> ipaddress.IPv4Network(('127\.0\.0\.0', 8\))
IPv4Network('127\.0\.0\.0/8')
\>\>\> ipaddress.IPv4Network(('127\.0\.0\.0', '255\.0\.0\.0'))
IPv4Network('127\.0\.0\.0/8')

\`\`\`

(Contributed by Peter Moody and Antoine Pitrou in [bpo\-16531](https://bugs.python.org/issue?@action=redirect&bpo=16531).)

A new `reverse_pointer` attribute for the
[`IPv4Network`](../library/ipaddress.html#ipaddress.IPv4Network "ipaddress.IPv4Network") and [`IPv6Network`](../library/ipaddress.html#ipaddress.IPv6Network "ipaddress.IPv6Network") classes
returns the name of the reverse DNS PTR record:

\`\`\`
\>\>\> import ipaddress
\>\>\> addr = ipaddress.IPv4Address('127\.0\.0\.1')
\>\>\> addr.reverse\_pointer
'1\.0\.0\.127\.in\-addr.arpa'
\>\>\> addr6 = ipaddress.IPv6Address('::1')
\>\>\> addr6\.reverse\_pointer
'1\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.0\.ip6\.arpa'

\`\`\`

(Contributed by Leon Weber in [bpo\-20480](https://bugs.python.org/issue?@action=redirect&bpo=20480).)

### json[¶](#json "Link to this heading")

The [`json.tool`](../library/json.html#module-json.tool "json.tool: A command line to validate and pretty-print JSON.") command line interface now preserves the order of keys in
JSON objects passed in input. The new `--sort-keys` option can be used
to sort the keys alphabetically. (Contributed by Berker Peksag
in [bpo\-21650](https://bugs.python.org/issue?@action=redirect&bpo=21650).)

JSON decoder now raises [`JSONDecodeError`](../library/json.html#json.JSONDecodeError "json.JSONDecodeError") instead of
[`ValueError`](../library/exceptions.html#ValueError "ValueError") to provide better context information about the error.
(Contributed by Serhiy Storchaka in [bpo\-19361](https://bugs.python.org/issue?@action=redirect&bpo=19361).)

### linecache[¶](#linecache "Link to this heading")

A new [`lazycache()`](../library/linecache.html#linecache.lazycache "linecache.lazycache") function can be used to capture information
about a non\-file\-based module to permit getting its lines later via
[`getline()`](../library/linecache.html#linecache.getline "linecache.getline"). This avoids doing I/O until a line is actually
needed, without having to carry the module globals around indefinitely.
(Contributed by Robert Collins in [bpo\-17911](https://bugs.python.org/issue?@action=redirect&bpo=17911).)

### locale[¶](#locale "Link to this heading")

A new [`delocalize()`](../library/locale.html#locale.delocalize "locale.delocalize") function can be used to convert a string into
a normalized number string, taking the `LC_NUMERIC` settings into account:

\`\`\`
\>\>\> import locale
\>\>\> locale.setlocale(locale.LC\_NUMERIC, 'de\_DE.UTF\-8')
'de\_DE.UTF\-8'
\>\>\> locale.delocalize('1\.234,56')
'1234\.56'
\>\>\> locale.setlocale(locale.LC\_NUMERIC, 'en\_US.UTF\-8')
'en\_US.UTF\-8'
\>\>\> locale.delocalize('1,234\.56')
'1234\.56'

\`\`\`

(Contributed by Cédric Krier in [bpo\-13918](https://bugs.python.org/issue?@action=redirect&bpo=13918).)

### logging[¶](#logging "Link to this heading")

All logging methods ([`Logger`](../library/logging.html#logging.Logger "logging.Logger") [`log()`](../library/logging.html#logging.Logger.log "logging.Logger.log"),
[`exception()`](../library/logging.html#logging.Logger.exception "logging.Logger.exception"), [`critical()`](../library/logging.html#logging.Logger.critical "logging.Logger.critical"),
[`debug()`](../library/logging.html#logging.Logger.debug "logging.Logger.debug"), etc.), now accept exception instances
as an *exc\_info* argument, in addition to boolean values and exception
tuples:

\`\`\`
\>\>\> import logging
\>\>\> try:
... 1/0
... except ZeroDivisionError as ex:
... logging.error('exception', exc\_info=ex)
ERROR:root:exception

\`\`\`

(Contributed by Yury Selivanov in [bpo\-20537](https://bugs.python.org/issue?@action=redirect&bpo=20537).)

The [`handlers.HTTPHandler`](../library/logging.handlers.html#logging.handlers.HTTPHandler "logging.handlers.HTTPHandler") class now
accepts an optional [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") instance to configure SSL
settings used in an HTTP connection.
(Contributed by Alex Gaynor in [bpo\-22788](https://bugs.python.org/issue?@action=redirect&bpo=22788).)

The [`handlers.QueueListener`](../library/logging.handlers.html#logging.handlers.QueueListener "logging.handlers.QueueListener") class now
takes a *respect\_handler\_level* keyword argument which, if set to `True`,
will pass messages to handlers taking handler levels into account.
(Contributed by Vinay Sajip.)

### lzma[¶](#lzma "Link to this heading")

The [`LZMADecompressor.decompress()`](../library/lzma.html#lzma.LZMADecompressor.decompress "lzma.LZMADecompressor.decompress")
method now accepts an optional *max\_length* argument to limit the maximum
size of decompressed data.
(Contributed by Martin Panter in [bpo\-15955](https://bugs.python.org/issue?@action=redirect&bpo=15955).)

### math[¶](#math "Link to this heading")

Two new constants have been added to the [`math`](../library/math.html#module-math "math: Mathematical functions (sin() etc.).") module: [`inf`](../library/math.html#math.inf "math.inf")
and [`nan`](../library/math.html#math.nan "math.nan"). (Contributed by Mark Dickinson in [bpo\-23185](https://bugs.python.org/issue?@action=redirect&bpo=23185).)

A new function [`isclose()`](../library/math.html#math.isclose "math.isclose") provides a way to test for approximate
equality. (Contributed by Chris Barker and Tal Einat in [bpo\-24270](https://bugs.python.org/issue?@action=redirect&bpo=24270).)

A new [`gcd()`](../library/math.html#math.gcd "math.gcd") function has been added. The `fractions.gcd()`
function is now deprecated. (Contributed by Mark Dickinson and Serhiy
Storchaka in [bpo\-22486](https://bugs.python.org/issue?@action=redirect&bpo=22486).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

[`sharedctypes.synchronized()`](../library/multiprocessing.html#multiprocessing.sharedctypes.synchronized "multiprocessing.sharedctypes.synchronized")
objects now support the [context manager](../glossary.html#term-context-manager) protocol.
(Contributed by Charles\-François Natali in [bpo\-21565](https://bugs.python.org/issue?@action=redirect&bpo=21565).)

### operator[¶](#operator "Link to this heading")

[`attrgetter()`](../library/operator.html#operator.attrgetter "operator.attrgetter"), [`itemgetter()`](../library/operator.html#operator.itemgetter "operator.itemgetter"),
and [`methodcaller()`](../library/operator.html#operator.methodcaller "operator.methodcaller") objects now support pickling.
(Contributed by Josh Rosenberg and Serhiy Storchaka in [bpo\-22955](https://bugs.python.org/issue?@action=redirect&bpo=22955).)

New [`matmul()`](../library/operator.html#operator.matmul "operator.matmul") and [`imatmul()`](../library/operator.html#operator.imatmul "operator.imatmul") functions
to perform matrix multiplication.
(Contributed by Benjamin Peterson in [bpo\-21176](https://bugs.python.org/issue?@action=redirect&bpo=21176).)

### os[¶](#os "Link to this heading")

The new [`scandir()`](../library/os.html#os.scandir "os.scandir") function returning an iterator of
[`DirEntry`](../library/os.html#os.DirEntry "os.DirEntry") objects has been added. If possible, [`scandir()`](../library/os.html#os.scandir "os.scandir")
extracts file attributes while scanning a directory, removing the need to
perform subsequent system calls to determine file type or attributes, which may
significantly improve performance. (Contributed by Ben Hoyt with the help
of Victor Stinner in [bpo\-22524](https://bugs.python.org/issue?@action=redirect&bpo=22524).)

On Windows, a new
[`stat_result.st_file_attributes`](../library/os.html#os.stat_result.st_file_attributes "os.stat_result.st_file_attributes")
attribute is now available. It corresponds to the `dwFileAttributes` member
of the `BY_HANDLE_FILE_INFORMATION` structure returned by
`GetFileInformationByHandle()`. (Contributed by Ben Hoyt in [bpo\-21719](https://bugs.python.org/issue?@action=redirect&bpo=21719).)

The [`urandom()`](../library/os.html#os.urandom "os.urandom") function now uses the `getrandom()` syscall on Linux 3\.17
or newer, and `getentropy()` on OpenBSD 5\.6 and newer, removing the need to
use `/dev/urandom` and avoiding failures due to potential file descriptor
exhaustion. (Contributed by Victor Stinner in [bpo\-22181](https://bugs.python.org/issue?@action=redirect&bpo=22181).)

New [`get_blocking()`](../library/os.html#os.get_blocking "os.get_blocking") and [`set_blocking()`](../library/os.html#os.set_blocking "os.set_blocking") functions allow
getting and setting a file descriptor’s blocking mode ([`O_NONBLOCK`](../library/os.html#os.O_NONBLOCK "os.O_NONBLOCK").)
(Contributed by Victor Stinner in [bpo\-22054](https://bugs.python.org/issue?@action=redirect&bpo=22054).)

The [`truncate()`](../library/os.html#os.truncate "os.truncate") and [`ftruncate()`](../library/os.html#os.ftruncate "os.ftruncate") functions are now supported
on Windows. (Contributed by Steve Dower in [bpo\-23668](https://bugs.python.org/issue?@action=redirect&bpo=23668).)

There is a new [`os.path.commonpath()`](../library/os.path.html#os.path.commonpath "os.path.commonpath") function returning the longest
common sub\-path of each passed pathname. Unlike the
[`os.path.commonprefix()`](../library/os.path.html#os.path.commonprefix "os.path.commonprefix") function, it always returns a valid
path:

\`\`\`
\>\>\> os.path.commonprefix(\['/usr/lib', '/usr/local/lib'])
'/usr/l'

\>\>\> os.path.commonpath(\['/usr/lib', '/usr/local/lib'])
'/usr'

\`\`\`

(Contributed by Rafik Draoui and Serhiy Storchaka in [bpo\-10395](https://bugs.python.org/issue?@action=redirect&bpo=10395).)

### pathlib[¶](#pathlib "Link to this heading")

The new [`Path.samefile()`](../library/pathlib.html#pathlib.Path.samefile "pathlib.Path.samefile") method can be used
to check whether the path points to the same file as another path, which can
be either another [`Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") object, or a string:

\`\`\`
\>\>\> import pathlib
\>\>\> p1 = pathlib.Path('/etc/hosts')
\>\>\> p2 = pathlib.Path('/etc/../etc/hosts')
\>\>\> p1\.samefile(p2\)
True

\`\`\`

(Contributed by Vajrasky Kok and Antoine Pitrou in [bpo\-19775](https://bugs.python.org/issue?@action=redirect&bpo=19775).)

The [`Path.mkdir()`](../library/pathlib.html#pathlib.Path.mkdir "pathlib.Path.mkdir") method now accepts a new optional
*exist\_ok* argument to match `mkdir -p` and [`os.makedirs()`](../library/os.html#os.makedirs "os.makedirs")
functionality. (Contributed by Berker Peksag in [bpo\-21539](https://bugs.python.org/issue?@action=redirect&bpo=21539).)

There is a new [`Path.expanduser()`](../library/pathlib.html#pathlib.Path.expanduser "pathlib.Path.expanduser") method to
expand `~` and `~user` prefixes. (Contributed by Serhiy Storchaka and
Claudiu Popa in [bpo\-19776](https://bugs.python.org/issue?@action=redirect&bpo=19776).)

A new [`Path.home()`](../library/pathlib.html#pathlib.Path.home "pathlib.Path.home") class method can be used to get
a [`Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") instance representing the user’s home
directory.
(Contributed by Victor Salgado and Mayank Tripathi in [bpo\-19777](https://bugs.python.org/issue?@action=redirect&bpo=19777).)

New [`Path.write_text()`](../library/pathlib.html#pathlib.Path.write_text "pathlib.Path.write_text"),
[`Path.read_text()`](../library/pathlib.html#pathlib.Path.read_text "pathlib.Path.read_text"),
[`Path.write_bytes()`](../library/pathlib.html#pathlib.Path.write_bytes "pathlib.Path.write_bytes"),
[`Path.read_bytes()`](../library/pathlib.html#pathlib.Path.read_bytes "pathlib.Path.read_bytes") methods to simplify
read/write operations on files.

The following code snippet will create or rewrite existing file
`~/spam42`:

\`\`\`
\>\>\> import pathlib
\>\>\> p = pathlib.Path('\~/spam42')
\>\>\> p.expanduser().write\_text('ham')
3

\`\`\`

(Contributed by Christopher Welborn in [bpo\-20218](https://bugs.python.org/issue?@action=redirect&bpo=20218).)

### pickle[¶](#pickle "Link to this heading")

Nested objects, such as unbound methods or nested classes, can now be pickled
using [pickle protocols](../library/pickle.html#pickle-protocols) older than protocol version 4\.
Protocol version 4 already supports these cases. (Contributed by Serhiy
Storchaka in [bpo\-23611](https://bugs.python.org/issue?@action=redirect&bpo=23611).)

### poplib[¶](#poplib "Link to this heading")

A new [`POP3.utf8()`](../library/poplib.html#poplib.POP3.utf8 "poplib.POP3.utf8") command enables [**RFC 6856**](https://datatracker.ietf.org/doc/html/rfc6856.html)
(Internationalized Email) support, if a POP server supports it.
(Contributed by Milan OberKirch in [bpo\-21804](https://bugs.python.org/issue?@action=redirect&bpo=21804).)

### re[¶](#re "Link to this heading")

References and conditional references to groups with fixed length are now
allowed in lookbehind assertions:

\`\`\`
\>\>\> import re
\>\>\> pat = re.compile(r'(a\|b).(?\\>\> pat.match('aac')
\
\>\>\> pat.match('bbc')
\

\`\`\`

(Contributed by Serhiy Storchaka in [bpo\-9179](https://bugs.python.org/issue?@action=redirect&bpo=9179).)

The number of capturing groups in regular expressions is no longer limited to
100\. (Contributed by Serhiy Storchaka in [bpo\-22437](https://bugs.python.org/issue?@action=redirect&bpo=22437).)

The [`sub()`](../library/re.html#re.sub "re.sub") and [`subn()`](../library/re.html#re.subn "re.subn") functions now replace unmatched
groups with empty strings instead of raising an exception.
(Contributed by Serhiy Storchaka in [bpo\-1519638](https://bugs.python.org/issue?@action=redirect&bpo=1519638).)

The `re.error` exceptions have new attributes,
`msg`, `pattern`,
`pos`, `lineno`,
and `colno`, that provide better context
information about the error:

\`\`\`
\>\>\> re.compile("""
... (?x)
... .\+\+
... """)
Traceback (most recent call last):
 ...
sre\_constants.error: multiple repeat at position 16 (line 3, column 7\)

\`\`\`

(Contributed by Serhiy Storchaka in [bpo\-22578](https://bugs.python.org/issue?@action=redirect&bpo=22578).)

### readline[¶](#readline "Link to this heading")

A new [`append_history_file()`](../library/readline.html#readline.append_history_file "readline.append_history_file") function can be used to append
the specified number of trailing elements in history to the given file.
(Contributed by Bruno Cauet in [bpo\-22940](https://bugs.python.org/issue?@action=redirect&bpo=22940).)

### selectors[¶](#selectors "Link to this heading")

The new [`DevpollSelector`](../library/selectors.html#selectors.DevpollSelector "selectors.DevpollSelector") supports efficient
`/dev/poll` polling on Solaris.
(Contributed by Giampaolo Rodola’ in [bpo\-18931](https://bugs.python.org/issue?@action=redirect&bpo=18931).)

### shutil[¶](#shutil "Link to this heading")

The [`move()`](../library/shutil.html#shutil.move "shutil.move") function now accepts a *copy\_function* argument,
allowing, for example, the [`copy()`](../library/shutil.html#shutil.copy "shutil.copy") function to be used instead of
the default [`copy2()`](../library/shutil.html#shutil.copy2 "shutil.copy2") if there is a need to ignore file metadata
when moving.
(Contributed by Claudiu Popa in [bpo\-19840](https://bugs.python.org/issue?@action=redirect&bpo=19840).)

The [`make_archive()`](../library/shutil.html#shutil.make_archive "shutil.make_archive") function now supports the *xztar* format.
(Contributed by Serhiy Storchaka in [bpo\-5411](https://bugs.python.org/issue?@action=redirect&bpo=5411).)

### signal[¶](#signal "Link to this heading")

On Windows, the [`set_wakeup_fd()`](../library/signal.html#signal.set_wakeup_fd "signal.set_wakeup_fd") function now also supports
socket handles. (Contributed by Victor Stinner in [bpo\-22018](https://bugs.python.org/issue?@action=redirect&bpo=22018).)

Various `SIG*` constants in the [`signal`](../library/signal.html#module-signal "signal: Set handlers for asynchronous events.") module have been converted into
[`Enums`](../library/enum.html#module-enum "enum: Implementation of an enumeration class."). This allows meaningful names to be printed
during debugging, instead of integer “magic numbers”.
(Contributed by Giampaolo Rodola’ in [bpo\-21076](https://bugs.python.org/issue?@action=redirect&bpo=21076).)

### smtpd[¶](#smtpd "Link to this heading")

Both the `SMTPServer` and `SMTPChannel` classes now
accept a *decode\_data* keyword argument to determine if the `DATA` portion of
the SMTP transaction is decoded using the `"utf-8"` codec or is instead
provided to the
`SMTPServer.process_message()`
method as a byte string. The default is `True` for backward compatibility
reasons, but will change to `False` in Python 3\.6\. If *decode\_data* is set
to `False`, the `process_message` method must be prepared to accept keyword
arguments.
(Contributed by Maciej Szulik in [bpo\-19662](https://bugs.python.org/issue?@action=redirect&bpo=19662).)

The `SMTPServer` class now advertises the `8BITMIME` extension
([**RFC 6152**](https://datatracker.ietf.org/doc/html/rfc6152.html)) if *decode\_data* has been set `True`. If the client
specifies `BODY=8BITMIME` on the `MAIL` command, it is passed to
`SMTPServer.process_message()`
via the *mail\_options* keyword.
(Contributed by Milan Oberkirch and R. David Murray in [bpo\-21795](https://bugs.python.org/issue?@action=redirect&bpo=21795).)

The `SMTPServer` class now also supports the `SMTPUTF8`
extension ([**RFC 6531**](https://datatracker.ietf.org/doc/html/rfc6531.html): Internationalized Email). If the client specified
`SMTPUTF8 BODY=8BITMIME` on the `MAIL` command, they are passed to
`SMTPServer.process_message()`
via the *mail\_options* keyword. It is the responsibility of the
`process_message` method to correctly handle the `SMTPUTF8` data.
(Contributed by Milan Oberkirch in [bpo\-21725](https://bugs.python.org/issue?@action=redirect&bpo=21725).)

It is now possible to provide, directly or via name resolution, IPv6
addresses in the `SMTPServer` constructor, and have it
successfully connect. (Contributed by Milan Oberkirch in [bpo\-14758](https://bugs.python.org/issue?@action=redirect&bpo=14758).)

### smtplib[¶](#smtplib "Link to this heading")

A new [`SMTP.auth()`](../library/smtplib.html#smtplib.SMTP.auth "smtplib.SMTP.auth") method provides a convenient way to
implement custom authentication mechanisms. (Contributed by Milan
Oberkirch in [bpo\-15014](https://bugs.python.org/issue?@action=redirect&bpo=15014).)

The [`SMTP.set_debuglevel()`](../library/smtplib.html#smtplib.SMTP.set_debuglevel "smtplib.SMTP.set_debuglevel") method now
accepts an additional debuglevel (2\), which enables timestamps in debug
messages. (Contributed by Gavin Chappell and Maciej Szulik in [bpo\-16914](https://bugs.python.org/issue?@action=redirect&bpo=16914).)

Both the [`SMTP.sendmail()`](../library/smtplib.html#smtplib.SMTP.sendmail "smtplib.SMTP.sendmail") and
[`SMTP.send_message()`](../library/smtplib.html#smtplib.SMTP.send_message "smtplib.SMTP.send_message") methods now
support [**RFC 6531**](https://datatracker.ietf.org/doc/html/rfc6531.html) (SMTPUTF8\).
(Contributed by Milan Oberkirch and R. David Murray in [bpo\-22027](https://bugs.python.org/issue?@action=redirect&bpo=22027).)

### sndhdr[¶](#sndhdr "Link to this heading")

The `what()` and `whathdr()` functions now return
a [`namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple"). (Contributed by Claudiu Popa in
[bpo\-18615](https://bugs.python.org/issue?@action=redirect&bpo=18615).)

### socket[¶](#socket "Link to this heading")

Functions with timeouts now use a monotonic clock, instead of a system clock.
(Contributed by Victor Stinner in [bpo\-22043](https://bugs.python.org/issue?@action=redirect&bpo=22043).)

A new [`socket.sendfile()`](../library/socket.html#socket.socket.sendfile "socket.socket.sendfile") method allows
sending a file over a socket by using the high\-performance [`os.sendfile()`](../library/os.html#os.sendfile "os.sendfile")
function on UNIX, resulting in uploads being from 2 to 3 times faster than when
using plain [`socket.send()`](../library/socket.html#socket.socket.send "socket.socket.send").
(Contributed by Giampaolo Rodola’ in [bpo\-17552](https://bugs.python.org/issue?@action=redirect&bpo=17552).)

The [`socket.sendall()`](../library/socket.html#socket.socket.sendall "socket.socket.sendall") method no longer resets the
socket timeout every time bytes are received or sent. The socket timeout is
now the maximum total duration to send all data.
(Contributed by Victor Stinner in [bpo\-23853](https://bugs.python.org/issue?@action=redirect&bpo=23853).)

The *backlog* argument of the [`socket.listen()`](../library/socket.html#socket.socket.listen "socket.socket.listen")
method is now optional. By default it is set to
[`SOMAXCONN`](../library/socket.html#socket.SOMAXCONN "socket.SOMAXCONN") or to `128`, whichever is less.
(Contributed by Charles\-François Natali in [bpo\-21455](https://bugs.python.org/issue?@action=redirect&bpo=21455).)

### ssl[¶](#ssl "Link to this heading")

#### Memory BIO Support[¶](#memory-bio-support "Link to this heading")

(Contributed by Geert Jansen in [bpo\-21965](https://bugs.python.org/issue?@action=redirect&bpo=21965).)

The new [`SSLObject`](../library/ssl.html#ssl.SSLObject "ssl.SSLObject") class has been added to provide SSL protocol
support for cases when the network I/O capabilities of [`SSLSocket`](../library/ssl.html#ssl.SSLSocket "ssl.SSLSocket")
are not necessary or are suboptimal. `SSLObject` represents
an SSL protocol instance, but does not implement any network I/O methods, and
instead provides a memory buffer interface. The new [`MemoryBIO`](../library/ssl.html#ssl.MemoryBIO "ssl.MemoryBIO")
class can be used to pass data between Python and an SSL protocol instance.

The memory BIO SSL support is primarily intended to be used in frameworks
implementing asynchronous I/O for which [`SSLSocket`](../library/ssl.html#ssl.SSLSocket "ssl.SSLSocket")’s readiness
model (“select/poll”) is inefficient.

A new [`SSLContext.wrap_bio()`](../library/ssl.html#ssl.SSLContext.wrap_bio "ssl.SSLContext.wrap_bio") method can be used
to create a new `SSLObject` instance.

#### Application\-Layer Protocol Negotiation Support[¶](#application-layer-protocol-negotiation-support "Link to this heading")

(Contributed by Benjamin Peterson in [bpo\-20188](https://bugs.python.org/issue?@action=redirect&bpo=20188).)

Where OpenSSL support is present, the [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module now implements
the *Application\-Layer Protocol Negotiation* TLS extension as described
in [**RFC 7301**](https://datatracker.ietf.org/doc/html/rfc7301.html).

The new [`SSLContext.set_alpn_protocols()`](../library/ssl.html#ssl.SSLContext.set_alpn_protocols "ssl.SSLContext.set_alpn_protocols")
can be used to specify which protocols a socket should advertise during
the TLS handshake.

The new
[`SSLSocket.selected_alpn_protocol()`](../library/ssl.html#ssl.SSLSocket.selected_alpn_protocol "ssl.SSLSocket.selected_alpn_protocol")
returns the protocol that was selected during the TLS handshake.
The [`HAS_ALPN`](../library/ssl.html#ssl.HAS_ALPN "ssl.HAS_ALPN") flag indicates whether ALPN support is present.

#### Other Changes[¶](#other-changes "Link to this heading")

There is a new [`SSLSocket.version()`](../library/ssl.html#ssl.SSLSocket.version "ssl.SSLSocket.version") method to
query the actual protocol version in use.
(Contributed by Antoine Pitrou in [bpo\-20421](https://bugs.python.org/issue?@action=redirect&bpo=20421).)

The [`SSLSocket`](../library/ssl.html#ssl.SSLSocket "ssl.SSLSocket") class now implements
a `SSLSocket.sendfile()` method.
(Contributed by Giampaolo Rodola’ in [bpo\-17552](https://bugs.python.org/issue?@action=redirect&bpo=17552).)

The `SSLSocket.send()` method now raises either
the [`ssl.SSLWantReadError`](../library/ssl.html#ssl.SSLWantReadError "ssl.SSLWantReadError") or [`ssl.SSLWantWriteError`](../library/ssl.html#ssl.SSLWantWriteError "ssl.SSLWantWriteError") exception on a
non\-blocking socket if the operation would block. Previously, it would return
`0`. (Contributed by Nikolaus Rath in [bpo\-20951](https://bugs.python.org/issue?@action=redirect&bpo=20951).)

The [`cert_time_to_seconds()`](../library/ssl.html#ssl.cert_time_to_seconds "ssl.cert_time_to_seconds") function now interprets the input time
as UTC and not as local time, per [**RFC 5280**](https://datatracker.ietf.org/doc/html/rfc5280.html). Additionally, the return
value is always an [`int`](../library/functions.html#int "int"). (Contributed by Akira Li in [bpo\-19940](https://bugs.python.org/issue?@action=redirect&bpo=19940).)

New `SSLObject.shared_ciphers()` and
[`SSLSocket.shared_ciphers()`](../library/ssl.html#ssl.SSLSocket.shared_ciphers "ssl.SSLSocket.shared_ciphers") methods return
the list of ciphers sent by the client during the handshake.
(Contributed by Benjamin Peterson in [bpo\-23186](https://bugs.python.org/issue?@action=redirect&bpo=23186).)

The [`SSLSocket.do_handshake()`](../library/ssl.html#ssl.SSLSocket.do_handshake "ssl.SSLSocket.do_handshake"),
[`SSLSocket.read()`](../library/ssl.html#ssl.SSLSocket.read "ssl.SSLSocket.read"),
`SSLSocket.shutdown()`, and
[`SSLSocket.write()`](../library/ssl.html#ssl.SSLSocket.write "ssl.SSLSocket.write") methods of the [`SSLSocket`](../library/ssl.html#ssl.SSLSocket "ssl.SSLSocket")
class no longer reset the socket timeout every time bytes are received or sent.
The socket timeout is now the maximum total duration of the method.
(Contributed by Victor Stinner in [bpo\-23853](https://bugs.python.org/issue?@action=redirect&bpo=23853).)

The `match_hostname()` function now supports matching of IP addresses.
(Contributed by Antoine Pitrou in [bpo\-23239](https://bugs.python.org/issue?@action=redirect&bpo=23239).)

### sqlite3[¶](#sqlite3 "Link to this heading")

The [`Row`](../library/sqlite3.html#sqlite3.Row "sqlite3.Row") class now fully supports the sequence protocol,
in particular [`reversed()`](../library/functions.html#reversed "reversed") iteration and slice indexing.
(Contributed by Claudiu Popa in [bpo\-10203](https://bugs.python.org/issue?@action=redirect&bpo=10203); by Lucas Sinclair,
Jessica McKellar, and Serhiy Storchaka in [bpo\-13583](https://bugs.python.org/issue?@action=redirect&bpo=13583).)

### subprocess[¶](#subprocess "Link to this heading")

The new [`run()`](../library/subprocess.html#subprocess.run "subprocess.run") function has been added.
It runs the specified command and returns a
[`CompletedProcess`](../library/subprocess.html#subprocess.CompletedProcess "subprocess.CompletedProcess") object, which describes a finished
process. The new API is more consistent and is the recommended approach
to invoking subprocesses in Python code that does not need to maintain
compatibility with earlier Python versions.
(Contributed by Thomas Kluyver in [bpo\-23342](https://bugs.python.org/issue?@action=redirect&bpo=23342).)

Examples:

\`\`\`
\>\>\> subprocess.run(\["ls", "\-l"]) \# doesn't capture output
CompletedProcess(args=\['ls', '\-l'], returncode=0\)

\>\>\> subprocess.run("exit 1", shell=True, check=True)
Traceback (most recent call last):
 ...
subprocess.CalledProcessError: Command 'exit 1' returned non\-zero exit status 1

\>\>\> subprocess.run(\["ls", "\-l", "/dev/null"], stdout=subprocess.PIPE)
CompletedProcess(args=\['ls', '\-l', '/dev/null'], returncode=0,
stdout=b'crw\-rw\-rw\- 1 root root 1, 3 Jan 23 16:23 /dev/null\\n')

\`\`\`

### sys[¶](#sys "Link to this heading")

A new `set_coroutine_wrapper()` function allows setting a global
hook that will be called whenever a [coroutine object](../glossary.html#term-coroutine)
is created by an [`async def`](../reference/compound_stmts.html#async-def) function. A corresponding
`get_coroutine_wrapper()` can be used to obtain a currently set
wrapper. Both functions are [provisional](../glossary.html#term-provisional-API),
and are intended for debugging purposes only. (Contributed by Yury Selivanov
in [bpo\-24017](https://bugs.python.org/issue?@action=redirect&bpo=24017).)

A new [`is_finalizing()`](../library/sys.html#sys.is_finalizing "sys.is_finalizing") function can be used to check if the Python
interpreter is [shutting down](../glossary.html#term-interpreter-shutdown).
(Contributed by Antoine Pitrou in [bpo\-22696](https://bugs.python.org/issue?@action=redirect&bpo=22696).)

### sysconfig[¶](#sysconfig "Link to this heading")

The name of the user scripts directory on Windows now includes the first
two components of the Python version. (Contributed by Paul Moore
in [bpo\-23437](https://bugs.python.org/issue?@action=redirect&bpo=23437).)

### tarfile[¶](#tarfile "Link to this heading")

The *mode* argument of the [`open()`](../library/tarfile.html#tarfile.open "tarfile.open") function now accepts `"x"`
to request exclusive creation. (Contributed by Berker Peksag in [bpo\-21717](https://bugs.python.org/issue?@action=redirect&bpo=21717).)

The [`TarFile.extractall()`](../library/tarfile.html#tarfile.TarFile.extractall "tarfile.TarFile.extractall") and
[`TarFile.extract()`](../library/tarfile.html#tarfile.TarFile.extract "tarfile.TarFile.extract") methods now take a keyword
argument *numeric\_owner*. If set to `True`, the extracted files and
directories will be owned by the numeric `uid` and `gid` from the tarfile.
If set to `False` (the default, and the behavior in versions prior to 3\.5\),
they will be owned by the named user and group in the tarfile.
(Contributed by Michael Vogt and Eric Smith in [bpo\-23193](https://bugs.python.org/issue?@action=redirect&bpo=23193).)

The [`TarFile.list()`](../library/tarfile.html#tarfile.TarFile.list "tarfile.TarFile.list") now accepts an optional
*members* keyword argument that can be set to a subset of the list returned
by [`TarFile.getmembers()`](../library/tarfile.html#tarfile.TarFile.getmembers "tarfile.TarFile.getmembers").
(Contributed by Serhiy Storchaka in [bpo\-21549](https://bugs.python.org/issue?@action=redirect&bpo=21549).)

### threading[¶](#threading "Link to this heading")

Both the [`Lock.acquire()`](../library/threading.html#threading.Lock.acquire "threading.Lock.acquire") and
[`RLock.acquire()`](../library/threading.html#threading.RLock.acquire "threading.RLock.acquire") methods
now use a monotonic clock for timeout management.
(Contributed by Victor Stinner in [bpo\-22043](https://bugs.python.org/issue?@action=redirect&bpo=22043).)

### time[¶](#time "Link to this heading")

The [`monotonic()`](../library/time.html#time.monotonic "time.monotonic") function is now always available.
(Contributed by Victor Stinner in [bpo\-22043](https://bugs.python.org/issue?@action=redirect&bpo=22043).)

### timeit[¶](#timeit "Link to this heading")

A new command line option `-u` or `--unit=U` can be used to specify the time
unit for the timer output. Supported options are `usec`, `msec`,
or `sec`. (Contributed by Julian Gindi in [bpo\-18983](https://bugs.python.org/issue?@action=redirect&bpo=18983).)

The [`timeit()`](../library/timeit.html#timeit.timeit "timeit.timeit") function has a new *globals* parameter for
specifying the namespace in which the code will be running.
(Contributed by Ben Roberts in [bpo\-2527](https://bugs.python.org/issue?@action=redirect&bpo=2527).)

### tkinter[¶](#tkinter "Link to this heading")

The `tkinter._fix` module used for setting up the Tcl/Tk environment
on Windows has been replaced by a private function in the `_tkinter`
module which makes no permanent changes to environment variables.
(Contributed by Zachary Ware in [bpo\-20035](https://bugs.python.org/issue?@action=redirect&bpo=20035).)

### traceback[¶](#traceback "Link to this heading")

New [`walk_stack()`](../library/traceback.html#traceback.walk_stack "traceback.walk_stack") and [`walk_tb()`](../library/traceback.html#traceback.walk_tb "traceback.walk_tb")
functions to conveniently traverse frame and
[traceback objects](../reference/datamodel.html#traceback-objects).
(Contributed by Robert Collins in [bpo\-17911](https://bugs.python.org/issue?@action=redirect&bpo=17911).)

New lightweight classes: [`TracebackException`](../library/traceback.html#traceback.TracebackException "traceback.TracebackException"),
[`StackSummary`](../library/traceback.html#traceback.StackSummary "traceback.StackSummary"), and [`FrameSummary`](../library/traceback.html#traceback.FrameSummary "traceback.FrameSummary").
(Contributed by Robert Collins in [bpo\-17911](https://bugs.python.org/issue?@action=redirect&bpo=17911).)

Both the [`print_tb()`](../library/traceback.html#traceback.print_tb "traceback.print_tb") and [`print_stack()`](../library/traceback.html#traceback.print_stack "traceback.print_stack") functions
now support negative values for the *limit* argument.
(Contributed by Dmitry Kazakov in [bpo\-22619](https://bugs.python.org/issue?@action=redirect&bpo=22619).)

### types[¶](#types "Link to this heading")

A new [`coroutine()`](../library/types.html#types.coroutine "types.coroutine") function to transform
[generator](../glossary.html#term-generator-iterator) and
[`generator-like`](../library/collections.abc.html#collections.abc.Generator "collections.abc.Generator") objects into
[awaitables](../glossary.html#term-awaitable).
(Contributed by Yury Selivanov in [bpo\-24017](https://bugs.python.org/issue?@action=redirect&bpo=24017).)

A new type called [`CoroutineType`](../library/types.html#types.CoroutineType "types.CoroutineType"), which is used for
[coroutine](../glossary.html#term-coroutine) objects created by [`async def`](../reference/compound_stmts.html#async-def) functions.
(Contributed by Yury Selivanov in [bpo\-24400](https://bugs.python.org/issue?@action=redirect&bpo=24400).)

### unicodedata[¶](#unicodedata "Link to this heading")

The [`unicodedata`](../library/unicodedata.html#module-unicodedata "unicodedata: Access the Unicode Database.") module now uses data from [Unicode 8\.0\.0](https://unicode.org/versions/Unicode8.0.0/).

### unittest[¶](#unittest "Link to this heading")

The [`TestLoader.loadTestsFromModule()`](../library/unittest.html#unittest.TestLoader.loadTestsFromModule "unittest.TestLoader.loadTestsFromModule")
method now accepts a keyword\-only argument *pattern* which is passed to
`load_tests` as the third argument. Found packages are now checked for
`load_tests` regardless of whether their path matches *pattern*, because it
is impossible for a package name to match the default pattern.
(Contributed by Robert Collins and Barry A. Warsaw in [bpo\-16662](https://bugs.python.org/issue?@action=redirect&bpo=16662).)

Unittest discovery errors now are exposed in the
[`TestLoader.errors`](../library/unittest.html#unittest.TestLoader.errors "unittest.TestLoader.errors") attribute of the
[`TestLoader`](../library/unittest.html#unittest.TestLoader "unittest.TestLoader") instance.
(Contributed by Robert Collins in [bpo\-19746](https://bugs.python.org/issue?@action=redirect&bpo=19746).)

A new command line option `--locals` to show local variables in
tracebacks. (Contributed by Robert Collins in [bpo\-22936](https://bugs.python.org/issue?@action=redirect&bpo=22936).)

### unittest.mock[¶](#unittest-mock "Link to this heading")

The [`Mock`](../library/unittest.mock.html#unittest.mock.Mock "unittest.mock.Mock") class has the following improvements:

* The class constructor has a new *unsafe* parameter, which causes mock
objects to raise [`AttributeError`](../library/exceptions.html#AttributeError "AttributeError") on attribute names starting
with `"assert"`.
(Contributed by Kushal Das in [bpo\-21238](https://bugs.python.org/issue?@action=redirect&bpo=21238).)
* A new [`Mock.assert_not_called()`](../library/unittest.mock.html#unittest.mock.Mock.assert_not_called "unittest.mock.Mock.assert_not_called")
method to check if the mock object was called.
(Contributed by Kushal Das in [bpo\-21262](https://bugs.python.org/issue?@action=redirect&bpo=21262).)

The [`MagicMock`](../library/unittest.mock.html#unittest.mock.MagicMock "unittest.mock.MagicMock") class now supports `__truediv__()`,
`__divmod__()` and `__matmul__()` operators.
(Contributed by Johannes Baiter in [bpo\-20968](https://bugs.python.org/issue?@action=redirect&bpo=20968), and Håkan Lövdahl
in [bpo\-23581](https://bugs.python.org/issue?@action=redirect&bpo=23581) and [bpo\-23568](https://bugs.python.org/issue?@action=redirect&bpo=23568).)

It is no longer necessary to explicitly pass `create=True` to the
[`patch()`](../library/unittest.mock.html#unittest.mock.patch "unittest.mock.patch") function when patching builtin names.
(Contributed by Kushal Das in [bpo\-17660](https://bugs.python.org/issue?@action=redirect&bpo=17660).)

### urllib[¶](#urllib "Link to this heading")

A new
[`request.HTTPPasswordMgrWithPriorAuth`](../library/urllib.request.html#urllib.request.HTTPPasswordMgrWithPriorAuth "urllib.request.HTTPPasswordMgrWithPriorAuth")
class allows HTTP Basic Authentication credentials to be managed so as to
eliminate unnecessary `401` response handling, or to unconditionally send
credentials on the first request in order to communicate with servers that
return a `404` response instead of a `401` if the `Authorization` header
is not sent. (Contributed by Matej Cepl in [bpo\-19494](https://bugs.python.org/issue?@action=redirect&bpo=19494) and Akshit Khurana in
[bpo\-7159](https://bugs.python.org/issue?@action=redirect&bpo=7159).)

A new *quote\_via* argument for the
[`parse.urlencode()`](../library/urllib.parse.html#urllib.parse.urlencode "urllib.parse.urlencode")
function provides a way to control the encoding of query parts if needed.
(Contributed by Samwyse and Arnon Yaari in [bpo\-13866](https://bugs.python.org/issue?@action=redirect&bpo=13866).)

The [`request.urlopen()`](../library/urllib.request.html#urllib.request.urlopen "urllib.request.urlopen") function accepts an
[`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") object as a *context* argument, which will be used for
the HTTPS connection. (Contributed by Alex Gaynor in [bpo\-22366](https://bugs.python.org/issue?@action=redirect&bpo=22366).)

The [`parse.urljoin()`](../library/urllib.parse.html#urllib.parse.urljoin "urllib.parse.urljoin") was updated to use the
[**RFC 3986**](https://datatracker.ietf.org/doc/html/rfc3986.html) semantics for the resolution of relative URLs, rather than
[**RFC 1808**](https://datatracker.ietf.org/doc/html/rfc1808.html) and [**RFC 2396**](https://datatracker.ietf.org/doc/html/rfc2396.html).
(Contributed by Demian Brecht and Senthil Kumaran in [bpo\-22118](https://bugs.python.org/issue?@action=redirect&bpo=22118).)

### wsgiref[¶](#wsgiref "Link to this heading")

The *headers* argument of the [`headers.Headers`](../library/wsgiref.html#wsgiref.headers.Headers "wsgiref.headers.Headers")
class constructor is now optional.
(Contributed by Pablo Torres Navarrete and SilentGhost in [bpo\-5800](https://bugs.python.org/issue?@action=redirect&bpo=5800).)

### xmlrpc[¶](#xmlrpc "Link to this heading")

The [`client.ServerProxy`](../library/xmlrpc.client.html#xmlrpc.client.ServerProxy "xmlrpc.client.ServerProxy") class now supports
the [context manager](../glossary.html#term-context-manager) protocol.
(Contributed by Claudiu Popa in [bpo\-20627](https://bugs.python.org/issue?@action=redirect&bpo=20627).)

The [`client.ServerProxy`](../library/xmlrpc.client.html#xmlrpc.client.ServerProxy "xmlrpc.client.ServerProxy") constructor now accepts
an optional [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") instance.
(Contributed by Alex Gaynor in [bpo\-22960](https://bugs.python.org/issue?@action=redirect&bpo=22960).)

### xml.sax[¶](#xml-sax "Link to this heading")

SAX parsers now support a character stream of the
[`xmlreader.InputSource`](../library/xml.sax.reader.html#xml.sax.xmlreader.InputSource "xml.sax.xmlreader.InputSource") object.
(Contributed by Serhiy Storchaka in [bpo\-2175](https://bugs.python.org/issue?@action=redirect&bpo=2175).)

[`parseString()`](../library/xml.sax.html#xml.sax.parseString "xml.sax.parseString") now accepts a [`str`](../library/stdtypes.html#str "str") instance.
(Contributed by Serhiy Storchaka in [bpo\-10590](https://bugs.python.org/issue?@action=redirect&bpo=10590).)

### zipfile[¶](#zipfile "Link to this heading")

ZIP output can now be written to unseekable streams.
(Contributed by Serhiy Storchaka in [bpo\-23252](https://bugs.python.org/issue?@action=redirect&bpo=23252).)

The *mode* argument of [`ZipFile.open()`](../library/zipfile.html#zipfile.ZipFile.open "zipfile.ZipFile.open") method now
accepts `"x"` to request exclusive creation.
(Contributed by Serhiy Storchaka in [bpo\-21717](https://bugs.python.org/issue?@action=redirect&bpo=21717).)

## Other module\-level changes[¶](#other-module-level-changes "Link to this heading")

Many functions in the [`mmap`](../library/mmap.html#module-mmap "mmap: Interface to memory-mapped files for Unix and Windows."), `ossaudiodev`, [`socket`](../library/socket.html#module-socket "socket: Low-level networking interface."),
[`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects"), and [`codecs`](../library/codecs.html#module-codecs "codecs: Encode and decode data and streams.") modules now accept writable
[bytes\-like objects](../glossary.html#term-bytes-like-object).
(Contributed by Serhiy Storchaka in [bpo\-23001](https://bugs.python.org/issue?@action=redirect&bpo=23001).)

## Optimizations[¶](#optimizations "Link to this heading")

The [`os.walk()`](../library/os.html#os.walk "os.walk") function has been sped up by 3 to 5 times on POSIX systems,
and by 7 to 20 times on Windows. This was done using the new [`os.scandir()`](../library/os.html#os.scandir "os.scandir")
function, which exposes file information from the underlying `readdir` or
`FindFirstFile`/`FindNextFile` system calls. (Contributed by
Ben Hoyt with help from Victor Stinner in [bpo\-23605](https://bugs.python.org/issue?@action=redirect&bpo=23605).)

Construction of `bytes(int)` (filled by zero bytes) is faster and uses less
memory for large objects. `calloc()` is used instead of `malloc()` to
allocate memory for these objects.
(Contributed by Victor Stinner in [bpo\-21233](https://bugs.python.org/issue?@action=redirect&bpo=21233).)

Some operations on [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") [`IPv4Network`](../library/ipaddress.html#ipaddress.IPv4Network "ipaddress.IPv4Network") and
[`IPv6Network`](../library/ipaddress.html#ipaddress.IPv6Network "ipaddress.IPv6Network") have been massively sped up, such as
[`subnets()`](../library/ipaddress.html#ipaddress.IPv4Network.subnets "ipaddress.IPv4Network.subnets"), [`supernet()`](../library/ipaddress.html#ipaddress.IPv4Network.supernet "ipaddress.IPv4Network.supernet"),
[`summarize_address_range()`](../library/ipaddress.html#ipaddress.summarize_address_range "ipaddress.summarize_address_range"), [`collapse_addresses()`](../library/ipaddress.html#ipaddress.collapse_addresses "ipaddress.collapse_addresses").
The speed up can range from 3 to 15 times.
(Contributed by Antoine Pitrou, Michel Albert, and Markus in
[bpo\-21486](https://bugs.python.org/issue?@action=redirect&bpo=21486), [bpo\-21487](https://bugs.python.org/issue?@action=redirect&bpo=21487), [bpo\-20826](https://bugs.python.org/issue?@action=redirect&bpo=20826), [bpo\-23266](https://bugs.python.org/issue?@action=redirect&bpo=23266).)

Pickling of [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") objects was optimized to produce significantly
smaller output. (Contributed by Serhiy Storchaka in [bpo\-23133](https://bugs.python.org/issue?@action=redirect&bpo=23133).)

Many operations on [`io.BytesIO`](../library/io.html#io.BytesIO "io.BytesIO") are now 50% to 100% faster.
(Contributed by Serhiy Storchaka in [bpo\-15381](https://bugs.python.org/issue?@action=redirect&bpo=15381) and David Wilson in
[bpo\-22003](https://bugs.python.org/issue?@action=redirect&bpo=22003).)

The [`marshal.dumps()`](../library/marshal.html#marshal.dumps "marshal.dumps") function is now faster: 65–85% with versions 3
and 4, 20–25% with versions 0 to 2 on typical data, and up to 5 times in
best cases.
(Contributed by Serhiy Storchaka in [bpo\-20416](https://bugs.python.org/issue?@action=redirect&bpo=20416) and [bpo\-23344](https://bugs.python.org/issue?@action=redirect&bpo=23344).)

The UTF\-32 encoder is now 3 to 7 times faster.
(Contributed by Serhiy Storchaka in [bpo\-15027](https://bugs.python.org/issue?@action=redirect&bpo=15027).)

Regular expressions are now parsed up to 10% faster.
(Contributed by Serhiy Storchaka in [bpo\-19380](https://bugs.python.org/issue?@action=redirect&bpo=19380).)

The [`json.dumps()`](../library/json.html#json.dumps "json.dumps") function was optimized to run with
`ensure_ascii=False` as fast as with `ensure_ascii=True`.
(Contributed by Naoki Inada in [bpo\-23206](https://bugs.python.org/issue?@action=redirect&bpo=23206).)

The [`PyObject_IsInstance()`](../c-api/object.html#c.PyObject_IsInstance "PyObject_IsInstance") and [`PyObject_IsSubclass()`](../c-api/object.html#c.PyObject_IsSubclass "PyObject_IsSubclass")
functions have been sped up in the common case that the second argument
has [`type`](../library/functions.html#type "type") as its metaclass.
(Contributed Georg Brandl by in [bpo\-22540](https://bugs.python.org/issue?@action=redirect&bpo=22540).)

Method caching was slightly improved, yielding up to 5% performance
improvement in some benchmarks.
(Contributed by Antoine Pitrou in [bpo\-22847](https://bugs.python.org/issue?@action=redirect&bpo=22847).)

Objects from the [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions.") module now use 50% less memory on 64\-bit
builds. (Contributed by Serhiy Storchaka in [bpo\-23488](https://bugs.python.org/issue?@action=redirect&bpo=23488).)

The [`property()`](../library/functions.html#property "property") getter calls are up to 25% faster.
(Contributed by Joe Jevnik in [bpo\-23910](https://bugs.python.org/issue?@action=redirect&bpo=23910).)

Instantiation of [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") is now up to 30% faster.
(Contributed by Stefan Behnel in [bpo\-22464](https://bugs.python.org/issue?@action=redirect&bpo=22464).)

String methods [`find()`](../library/stdtypes.html#str.find "str.find"), [`rfind()`](../library/stdtypes.html#str.rfind "str.rfind"), [`split()`](../library/stdtypes.html#str.split "str.split"),
[`partition()`](../library/stdtypes.html#str.partition "str.partition") and the [`in`](../reference/expressions.html#in) string operator are now significantly
faster for searching 1\-character substrings.
(Contributed by Serhiy Storchaka in [bpo\-23573](https://bugs.python.org/issue?@action=redirect&bpo=23573).)

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

New `calloc` functions were added:

* [`PyMem_RawCalloc()`](../c-api/memory.html#c.PyMem_RawCalloc "PyMem_RawCalloc"),
* [`PyMem_Calloc()`](../c-api/memory.html#c.PyMem_Calloc "PyMem_Calloc"),
* [`PyObject_Calloc()`](../c-api/memory.html#c.PyObject_Calloc "PyObject_Calloc").

(Contributed by Victor Stinner in [bpo\-21233](https://bugs.python.org/issue?@action=redirect&bpo=21233).)

New encoding/decoding helper functions:

* [`Py_DecodeLocale()`](../c-api/sys.html#c.Py_DecodeLocale "Py_DecodeLocale") (replaced `_Py_char2wchar()`),
* [`Py_EncodeLocale()`](../c-api/sys.html#c.Py_EncodeLocale "Py_EncodeLocale") (replaced `_Py_wchar2char()`).

(Contributed by Victor Stinner in [bpo\-18395](https://bugs.python.org/issue?@action=redirect&bpo=18395).)

A new [`PyCodec_NameReplaceErrors()`](../c-api/codec.html#c.PyCodec_NameReplaceErrors "PyCodec_NameReplaceErrors") function to replace the unicode
encode error with `\N{...}` escapes.
(Contributed by Serhiy Storchaka in [bpo\-19676](https://bugs.python.org/issue?@action=redirect&bpo=19676).)

A new [`PyErr_FormatV()`](../c-api/exceptions.html#c.PyErr_FormatV "PyErr_FormatV") function similar to [`PyErr_Format()`](../c-api/exceptions.html#c.PyErr_Format "PyErr_Format"),
but accepts a `va_list` argument.
(Contributed by Antoine Pitrou in [bpo\-18711](https://bugs.python.org/issue?@action=redirect&bpo=18711).)

A new `PyExc_RecursionError` exception.
(Contributed by Georg Brandl in [bpo\-19235](https://bugs.python.org/issue?@action=redirect&bpo=19235).)

New [`PyModule_FromDefAndSpec()`](../c-api/module.html#c.PyModule_FromDefAndSpec "PyModule_FromDefAndSpec"), [`PyModule_FromDefAndSpec2()`](../c-api/module.html#c.PyModule_FromDefAndSpec2 "PyModule_FromDefAndSpec2"),
and [`PyModule_ExecDef()`](../c-api/module.html#c.PyModule_ExecDef "PyModule_ExecDef") functions introduced by [**PEP 489**](https://peps.python.org/pep-0489/) –
multi\-phase extension module initialization.
(Contributed by Petr Viktorin in [bpo\-24268](https://bugs.python.org/issue?@action=redirect&bpo=24268).)

New [`PyNumber_MatrixMultiply()`](../c-api/number.html#c.PyNumber_MatrixMultiply "PyNumber_MatrixMultiply") and
[`PyNumber_InPlaceMatrixMultiply()`](../c-api/number.html#c.PyNumber_InPlaceMatrixMultiply "PyNumber_InPlaceMatrixMultiply") functions to perform matrix
multiplication.
(Contributed by Benjamin Peterson in [bpo\-21176](https://bugs.python.org/issue?@action=redirect&bpo=21176). See also [**PEP 465**](https://peps.python.org/pep-0465/)
for details.)

The [`PyTypeObject.tp_finalize`](../c-api/typeobj.html#c.PyTypeObject.tp_finalize "PyTypeObject.tp_finalize") slot is now part of the stable ABI.

Windows builds now require Microsoft Visual C\+\+ 14\.0, which
is available as part of [Visual Studio 2015](https://visualstudio.microsoft.com/en/vs/older-downloads/#visual-studio-2015-and-other-products).

Extension modules now include a platform information tag in their filename on
some platforms (the tag is optional, and CPython will import extensions without
it, although if the tag is present and mismatched, the extension won’t be
loaded):

* On Linux, extension module filenames end with
`.cpython-m--.pyd`:

	+ `` is the major number of the Python version;
	for Python 3\.5 this is `3`.
	+ `` is the minor number of the Python version;
	for Python 3\.5 this is `5`.
	+ `` is the hardware architecture the extension module
	was built to run on. It’s most commonly either `i386` for 32\-bit Intel
	platforms or `x86_64` for 64\-bit Intel (and AMD) platforms.
	+ `` is always `linux-gnu`, except for extensions built to
	talk to the 32\-bit ABI on 64\-bit platforms, in which case it is
	`linux-gnu32` (and `` will be `x86_64`).
* On Windows, extension module filenames end with
`.cp-.pyd`:

	+ `` is the major number of the Python version;
	for Python 3\.5 this is `3`.
	+ `` is the minor number of the Python version;
	for Python 3\.5 this is `5`.
	+ `` is the platform the extension module was built for,
	either `win32` for Win32, `win_amd64` for Win64, `win_ia64` for
	Windows Itanium 64, and `win_arm` for Windows on ARM.
	+ If built in debug mode, `` will be `_d`,
	otherwise it will be blank.
* On OS X platforms, extension module filenames now end with `-darwin.so`.
* On all other platforms, extension module filenames are the same as they were
with Python 3\.4\.

## Deprecated[¶](#deprecated "Link to this heading")

### New Keywords[¶](#new-keywords "Link to this heading")

`async` and `await` are not recommended to be used as variable, class,
function or module names. Introduced by [**PEP 492**](https://peps.python.org/pep-0492/) in Python 3\.5, they will
become proper keywords in Python 3\.7\.

### Deprecated Python Behavior[¶](#deprecated-python-behavior "Link to this heading")

Raising the [`StopIteration`](../library/exceptions.html#StopIteration "StopIteration") exception inside a generator will now generate a silent
[`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning"), which will become a non\-silent deprecation
warning in Python 3\.6 and will trigger a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") in Python 3\.7\.
See [PEP 479: Change StopIteration handling inside generators](#whatsnew-pep-479)
for details.

### Unsupported Operating Systems[¶](#unsupported-operating-systems "Link to this heading")

Windows XP is no longer supported by Microsoft, thus, per [**PEP 11**](https://peps.python.org/pep-0011/), CPython
3\.5 is no longer officially supported on this OS.

### Deprecated Python modules, functions and methods[¶](#deprecated-python-modules-functions-and-methods "Link to this heading")

The `formatter` module has now graduated to full deprecation and is still
slated for removal in Python 3\.6\.

The `asyncio.async()` function is deprecated in favor of
[`ensure_future()`](../library/asyncio-future.html#asyncio.ensure_future "asyncio.ensure_future").

The `smtpd` module has in the past always decoded the DATA portion of
email messages using the `utf-8` codec. This can now be controlled by the
new *decode\_data* keyword to `SMTPServer`. The default value is
`True`, but this default is deprecated. Specify the *decode\_data* keyword
with an appropriate value to avoid the deprecation warning.

Directly assigning values to the [`key`](../library/http.cookies.html#http.cookies.Morsel.key "http.cookies.Morsel.key"),
[`value`](../library/http.cookies.html#http.cookies.Morsel.value "http.cookies.Morsel.value") and
[`coded_value`](../library/http.cookies.html#http.cookies.Morsel.coded_value "http.cookies.Morsel.coded_value") of [`http.cookies.Morsel`](../library/http.cookies.html#http.cookies.Morsel "http.cookies.Morsel")
objects is deprecated. Use the [`set()`](../library/http.cookies.html#http.cookies.Morsel.set "http.cookies.Morsel.set") method
instead. In addition, the undocumented *LegalChars* parameter of
[`set()`](../library/http.cookies.html#http.cookies.Morsel.set "http.cookies.Morsel.set") is deprecated, and is now ignored.

Passing a format string as keyword argument *format\_string* to the
[`format()`](../library/string.html#string.Formatter.format "string.Formatter.format") method of the [`string.Formatter`](../library/string.html#string.Formatter "string.Formatter")
class has been deprecated.
(Contributed by Serhiy Storchaka in [bpo\-23671](https://bugs.python.org/issue?@action=redirect&bpo=23671).)

The `platform.dist()` and `platform.linux_distribution()` functions
are now deprecated. Linux distributions use too many different ways of
describing themselves, so the functionality is left to a package.
(Contributed by Vajrasky Kok and Berker Peksag in [bpo\-1322](https://bugs.python.org/issue?@action=redirect&bpo=1322).)

The previously undocumented `from_function` and `from_builtin` methods of
[`inspect.Signature`](../library/inspect.html#inspect.Signature "inspect.Signature") are deprecated. Use the new
[`Signature.from_callable()`](../library/inspect.html#inspect.Signature.from_callable "inspect.Signature.from_callable")
method instead. (Contributed by Yury Selivanov in [bpo\-24248](https://bugs.python.org/issue?@action=redirect&bpo=24248).)

The `inspect.getargspec()` function is deprecated and scheduled to be
removed in Python 3\.6\. (See [bpo\-20438](https://bugs.python.org/issue?@action=redirect&bpo=20438) for details.)

The [`inspect`](../library/inspect.html#module-inspect "inspect: Extract information and source code from live objects.") [`getfullargspec()`](../library/inspect.html#inspect.getfullargspec "inspect.getfullargspec"),
[`getcallargs()`](../library/inspect.html#inspect.getcallargs "inspect.getcallargs"), and `formatargspec()` functions are
deprecated in favor of the [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") API. (Contributed by Yury
Selivanov in [bpo\-20438](https://bugs.python.org/issue?@action=redirect&bpo=20438).)

[`getargvalues()`](../library/inspect.html#inspect.getargvalues "inspect.getargvalues") and [`formatargvalues()`](../library/inspect.html#inspect.formatargvalues "inspect.formatargvalues") functions
were inadvertently marked as deprecated with the release of Python 3\.5\.0\.

Use of [`re.LOCALE`](../library/re.html#re.LOCALE "re.LOCALE") flag with str patterns or [`re.ASCII`](../library/re.html#re.ASCII "re.ASCII") is now
deprecated. (Contributed by Serhiy Storchaka in [bpo\-22407](https://bugs.python.org/issue?@action=redirect&bpo=22407).)

Use of unrecognized special sequences consisting of `'\'` and an ASCII letter
in regular expression patterns and replacement patterns now raises a
deprecation warning and will be forbidden in Python 3\.6\.
(Contributed by Serhiy Storchaka in [bpo\-23622](https://bugs.python.org/issue?@action=redirect&bpo=23622).)

The undocumented and unofficial *use\_load\_tests* default argument of the
[`unittest.TestLoader.loadTestsFromModule()`](../library/unittest.html#unittest.TestLoader.loadTestsFromModule "unittest.TestLoader.loadTestsFromModule") method now is
deprecated and ignored.
(Contributed by Robert Collins and Barry A. Warsaw in [bpo\-16662](https://bugs.python.org/issue?@action=redirect&bpo=16662).)

## Removed[¶](#removed "Link to this heading")

### API and Feature Removals[¶](#api-and-feature-removals "Link to this heading")

The following obsolete and previously deprecated APIs and features have been
removed:

* The `__version__` attribute has been dropped from the email package. The
email code hasn’t been shipped separately from the stdlib for a long time,
and the `__version__` string was not updated in the last few releases.
* The internal `Netrc` class in the [`ftplib`](../library/ftplib.html#module-ftplib "ftplib: FTP protocol client (requires sockets).") module was deprecated in
3\.4, and has now been removed.
(Contributed by Matt Chaput in [bpo\-6623](https://bugs.python.org/issue?@action=redirect&bpo=6623).)
* The concept of `.pyo` files has been removed.
* The JoinableQueue class in the provisional [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module was
deprecated in 3\.4\.4 and is now removed.
(Contributed by A. Jesse Jiryu Davis in [bpo\-23464](https://bugs.python.org/issue?@action=redirect&bpo=23464).)

## Porting to Python 3\.5[¶](#porting-to-python-3-5 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in Python behavior[¶](#changes-in-python-behavior "Link to this heading")

* Due to an oversight, earlier Python versions erroneously accepted the
following syntax:

\`\`\`
f(1 for x in \[1], \*args)
f(1 for x in \[1], \*\*kwargs)

\`\`\`

Python 3\.5 now correctly raises a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError"), as generator
expressions must be put in parentheses if not a sole argument to a function.

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* [**PEP 475**](https://peps.python.org/pep-0475/): System calls are now retried when interrupted by a signal instead
of raising [`InterruptedError`](../library/exceptions.html#InterruptedError "InterruptedError") if the Python signal handler does not
raise an exception.
* Before Python 3\.5, a [`datetime.time`](../library/datetime.html#datetime.time "datetime.time") object was considered to be false
if it represented midnight in UTC. This behavior was considered obscure and
error\-prone and has been removed in Python 3\.5\. See [bpo\-13936](https://bugs.python.org/issue?@action=redirect&bpo=13936) for full
details.
* The `ssl.SSLSocket.send()` method now raises either
[`ssl.SSLWantReadError`](../library/ssl.html#ssl.SSLWantReadError "ssl.SSLWantReadError") or [`ssl.SSLWantWriteError`](../library/ssl.html#ssl.SSLWantWriteError "ssl.SSLWantWriteError")
on a non\-blocking socket if the operation would block. Previously,
it would return `0`. (Contributed by Nikolaus Rath in [bpo\-20951](https://bugs.python.org/issue?@action=redirect&bpo=20951).)
* The `__name__` attribute of generators is now set from the function name,
instead of being set from the code name. Use `gen.gi_code.co_name` to
retrieve the code name. Generators also have a new `__qualname__`
attribute, the qualified name, which is now used for the representation
of a generator (`repr(gen)`).
(Contributed by Victor Stinner in [bpo\-21205](https://bugs.python.org/issue?@action=redirect&bpo=21205).)
* The deprecated “strict” mode and argument of [`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser"),
`HTMLParser.error()`, and the `HTMLParserError` exception have been
removed. (Contributed by Ezio Melotti in [bpo\-15114](https://bugs.python.org/issue?@action=redirect&bpo=15114).)
The *convert\_charrefs* argument of [`HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") is
now `True` by default. (Contributed by Berker Peksag in [bpo\-21047](https://bugs.python.org/issue?@action=redirect&bpo=21047).)
* Although it is not formally part of the API, it is worth noting for porting
purposes (ie: fixing tests) that error messages that were previously of the
form “‘sometype’ does not support the buffer protocol” are now of the form “a
[bytes\-like object](../glossary.html#term-bytes-like-object) is required, not ‘sometype’”.
(Contributed by Ezio Melotti in [bpo\-16518](https://bugs.python.org/issue?@action=redirect&bpo=16518).)
* If the current directory is set to a directory that no longer exists then
[`FileNotFoundError`](../library/exceptions.html#FileNotFoundError "FileNotFoundError") will no longer be raised and instead
[`find_spec()`](../library/importlib.html#importlib.machinery.FileFinder.find_spec "importlib.machinery.FileFinder.find_spec") will return `None`
**without** caching `None` in [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache"), which is
different than the typical case ([bpo\-22834](https://bugs.python.org/issue?@action=redirect&bpo=22834)).
* HTTP status code and messages from [`http.client`](../library/http.client.html#module-http.client "http.client: HTTP and HTTPS protocol client (requires sockets).") and [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers.")
were refactored into a common [`HTTPStatus`](../library/http.html#http.HTTPStatus "http.HTTPStatus") enum. The values in
[`http.client`](../library/http.client.html#module-http.client "http.client: HTTP and HTTPS protocol client (requires sockets).") and [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers.") remain available for backwards
compatibility. (Contributed by Demian Brecht in [bpo\-21793](https://bugs.python.org/issue?@action=redirect&bpo=21793).)
* When an import loader defines `importlib.machinery.Loader.exec_module()`
it is now expected to also define
`create_module()` (raises a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") now, will be an error in Python 3\.6\). If the loader
inherits from [`importlib.abc.Loader`](../library/importlib.html#importlib.abc.Loader "importlib.abc.Loader") then there is nothing to do, else
simply define `create_module()` to return
`None`. (Contributed by Brett Cannon in [bpo\-23014](https://bugs.python.org/issue?@action=redirect&bpo=23014).)
* The [`re.split()`](../library/re.html#re.split "re.split") function always ignored empty pattern matches, so the
`"x*"` pattern worked the same as `"x+"`, and the `"\b"` pattern never
worked. Now [`re.split()`](../library/re.html#re.split "re.split") raises a warning if the pattern could match
an empty string. For compatibility, use patterns that never match an empty
string (e.g. `"x+"` instead of `"x*"`). Patterns that could only match
an empty string (such as `"\b"`) now raise an error.
(Contributed by Serhiy Storchaka in [bpo\-22818](https://bugs.python.org/issue?@action=redirect&bpo=22818).)
* The [`http.cookies.Morsel`](../library/http.cookies.html#http.cookies.Morsel "http.cookies.Morsel") dict\-like interface has been made self
consistent: morsel comparison now takes the [`key`](../library/http.cookies.html#http.cookies.Morsel.key "http.cookies.Morsel.key")
and [`value`](../library/http.cookies.html#http.cookies.Morsel.value "http.cookies.Morsel.value") into account,
[`copy()`](../library/http.cookies.html#http.cookies.Morsel.copy "http.cookies.Morsel.copy") now results in a
[`Morsel`](../library/http.cookies.html#http.cookies.Morsel "http.cookies.Morsel") instance rather than a [`dict`](../library/stdtypes.html#dict "dict"), and
[`update()`](../library/http.cookies.html#http.cookies.Morsel.update "http.cookies.Morsel.update") will now raise an exception if any of the
keys in the update dictionary are invalid. In addition, the undocumented
*LegalChars* parameter of [`set()`](../library/http.cookies.html#http.cookies.Morsel.set "http.cookies.Morsel.set") is deprecated and
is now ignored. (Contributed by Demian Brecht in [bpo\-2211](https://bugs.python.org/issue?@action=redirect&bpo=2211).)
* [**PEP 488**](https://peps.python.org/pep-0488/) has removed `.pyo` files from Python and introduced the optional
`opt-` tag in `.pyc` file names. The
[`importlib.util.cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source") has gained an *optimization*
parameter to help control the `opt-` tag. Because of this, the
*debug\_override* parameter of the function is now deprecated. `.pyo` files
are also no longer supported as a file argument to the Python interpreter and
thus serve no purpose when distributed on their own (i.e. sourceless code
distribution). Due to the fact that the magic number for bytecode has changed
in Python 3\.5, all old `.pyo` files from previous versions of Python are
invalid regardless of this PEP.
* The [`socket`](../library/socket.html#module-socket "socket: Low-level networking interface.") module now exports the [`CAN_RAW_FD_FRAMES`](../library/socket.html#socket.CAN_RAW_FD_FRAMES "socket.CAN_RAW_FD_FRAMES")
constant on linux 3\.6 and greater.
* The [`ssl.cert_time_to_seconds()`](../library/ssl.html#ssl.cert_time_to_seconds "ssl.cert_time_to_seconds") function now interprets the input time
as UTC and not as local time, per [**RFC 5280**](https://datatracker.ietf.org/doc/html/rfc5280.html). Additionally, the return
value is always an [`int`](../library/functions.html#int "int"). (Contributed by Akira Li in [bpo\-19940](https://bugs.python.org/issue?@action=redirect&bpo=19940).)
* The `pygettext.py` Tool now uses the standard \+NNNN format for timezones in
the POT\-Creation\-Date header.
* The [`smtplib`](../library/smtplib.html#module-smtplib "smtplib: SMTP protocol client (requires sockets).") module now uses [`sys.stderr`](../library/sys.html#sys.stderr "sys.stderr") instead of the previous
module\-level `stderr` variable for debug output. If your (test)
program depends on patching the module\-level variable to capture the debug
output, you will need to update it to capture sys.stderr instead.
* The [`str.startswith()`](../library/stdtypes.html#str.startswith "str.startswith") and [`str.endswith()`](../library/stdtypes.html#str.endswith "str.endswith") methods no longer return
`True` when finding the empty string and the indexes are completely out of
range. (Contributed by Serhiy Storchaka in [bpo\-24284](https://bugs.python.org/issue?@action=redirect&bpo=24284).)
* The [`inspect.getdoc()`](../library/inspect.html#inspect.getdoc "inspect.getdoc") function now returns documentation strings
inherited from base classes. Documentation strings no longer need to be
duplicated if the inherited documentation is appropriate. To suppress an
inherited string, an empty string must be specified (or the documentation
may be filled in). This change affects the output of the [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.")
module and the [`help()`](../library/functions.html#help "help") function.
(Contributed by Serhiy Storchaka in [bpo\-15582](https://bugs.python.org/issue?@action=redirect&bpo=15582).)
* Nested [`functools.partial()`](../library/functools.html#functools.partial "functools.partial") calls are now flattened. If you were
relying on the previous behavior, you can now either add an attribute to a
[`functools.partial()`](../library/functools.html#functools.partial "functools.partial") object or you can create a subclass of
[`functools.partial()`](../library/functools.html#functools.partial "functools.partial").
(Contributed by Alexander Belopolsky in [bpo\-7830](https://bugs.python.org/issue?@action=redirect&bpo=7830).)

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

* The undocumented `format` member of the
(non\-public) `PyMemoryViewObject` structure has been removed.
All extensions relying on the relevant parts in `memoryobject.h`
must be rebuilt.
* The `PyMemAllocator` structure was renamed to
[`PyMemAllocatorEx`](../c-api/memory.html#c.PyMemAllocatorEx "PyMemAllocatorEx") and a new `calloc` field was added.
* Removed non\-documented macro `PyObject_REPR()` which leaked references.
Use format character `%R` in [`PyUnicode_FromFormat()`](../c-api/unicode.html#c.PyUnicode_FromFormat "PyUnicode_FromFormat")\-like functions
to format the [`repr()`](../library/functions.html#repr "repr") of the object.
(Contributed by Serhiy Storchaka in [bpo\-22453](https://bugs.python.org/issue?@action=redirect&bpo=22453).)
* Because the lack of the [`__module__`](../reference/datamodel.html#type.__module__ "type.__module__") attribute breaks pickling and
introspection, a deprecation warning is now raised for builtin types without
the [`__module__`](../reference/datamodel.html#type.__module__ "type.__module__") attribute. This will be an [`AttributeError`](../library/exceptions.html#AttributeError "AttributeError") in
the future.
(Contributed by Serhiy Storchaka in [bpo\-20204](https://bugs.python.org/issue?@action=redirect&bpo=20204).)
* As part of the [**PEP 492**](https://peps.python.org/pep-0492/) implementation, the `tp_reserved` slot of
[`PyTypeObject`](../c-api/type.html#c.PyTypeObject "PyTypeObject") was replaced with a
[`tp_as_async`](../c-api/typeobj.html#c.PyTypeObject.tp_as_async "PyTypeObject.tp_as_async") slot. Refer to [Coroutine Objects](../c-api/coro.html#coro-objects) for
new types, structures and functions.

## Notable changes in Python 3\.5\.4[¶](#notable-changes-in-python-3-5-4 "Link to this heading")

### New `make regen-all` build target[¶](#new-make-regen-all-build-target "Link to this heading")

To simplify cross\-compilation, and to ensure that CPython can reliably be
compiled without requiring an existing version of Python to already be
available, the autotools\-based build system no longer attempts to implicitly
recompile generated files based on file modification times.

Instead, a new `make regen-all` command has been added to force regeneration
of these files when desired (e.g. after an initial version of Python has
already been built based on the pregenerated versions).

More selective regeneration targets are also defined \- see
[Makefile.pre.in](https://github.com/python/cpython/tree/3.13/Makefile.pre.in) for details.

(Contributed by Victor Stinner in [bpo\-23404](https://bugs.python.org/issue?@action=redirect&bpo=23404).)

Added in version 3\.5\.4\.

### Removal of `make touch` build target[¶](#removal-of-make-touch-build-target "Link to this heading")

The `make touch` build target previously used to request implicit regeneration
of generated files by updating their modification times has been removed.

It has been replaced by the new `make regen-all` target.

(Contributed by Victor Stinner in [bpo\-23404](https://bugs.python.org/issue?@action=redirect&bpo=23404).)

Changed in version 3\.5\.4\.

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.5](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [PEP 492 \- Coroutines with async and await syntax](#pep-492-coroutines-with-async-and-await-syntax)
		- [PEP 465 \- A dedicated infix operator for matrix multiplication](#pep-465-a-dedicated-infix-operator-for-matrix-multiplication)
		- [PEP 448 \- Additional Unpacking Generalizations](#pep-448-additional-unpacking-generalizations)
		- [PEP 461 \- percent formatting support for bytes and bytearray](#pep-461-percent-formatting-support-for-bytes-and-bytearray)
		- [PEP 484 \- Type Hints](#pep-484-type-hints)
		- [PEP 471 \- os.scandir() function – a better and faster directory iterator](#pep-471-os-scandir-function-a-better-and-faster-directory-iterator)
		- [PEP 475: Retry system calls failing with EINTR](#pep-475-retry-system-calls-failing-with-eintr)
		- [PEP 479: Change StopIteration handling inside generators](#pep-479-change-stopiteration-handling-inside-generators)
		- [PEP 485: A function for testing approximate equality](#pep-485-a-function-for-testing-approximate-equality)
		- [PEP 486: Make the Python Launcher aware of virtual environments](#pep-486-make-the-python-launcher-aware-of-virtual-environments)
		- [PEP 488: Elimination of PYO files](#pep-488-elimination-of-pyo-files)
		- [PEP 489: Multi\-phase extension module initialization](#pep-489-multi-phase-extension-module-initialization)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
		- [typing](#typing)
		- [zipapp](#zipapp)
	+ [Improved Modules](#improved-modules)
		- [argparse](#argparse)
		- [asyncio](#asyncio)
		- [bz2](#bz2)
		- [cgi](#cgi)
		- [cmath](#cmath)
		- [code](#code)
		- [collections](#collections)
		- [collections.abc](#collections-abc)
		- [compileall](#compileall)
		- [concurrent.futures](#concurrent-futures)
		- [configparser](#configparser)
		- [contextlib](#contextlib)
		- [csv](#csv)
		- [curses](#curses)
		- [dbm](#dbm)
		- [difflib](#difflib)
		- [distutils](#distutils)
		- [doctest](#doctest)
		- [email](#email)
		- [enum](#enum)
		- [faulthandler](#faulthandler)
		- [functools](#functools)
		- [glob](#glob)
		- [gzip](#gzip)
		- [heapq](#heapq)
		- [http](#http)
		- [http.client](#http-client)
		- [idlelib and IDLE](#idlelib-and-idle)
		- [imaplib](#imaplib)
		- [imghdr](#imghdr)
		- [importlib](#importlib)
		- [inspect](#inspect)
		- [io](#io)
		- [ipaddress](#ipaddress)
		- [json](#json)
		- [linecache](#linecache)
		- [locale](#locale)
		- [logging](#logging)
		- [lzma](#lzma)
		- [math](#math)
		- [multiprocessing](#multiprocessing)
		- [operator](#operator)
		- [os](#os)
		- [pathlib](#pathlib)
		- [pickle](#pickle)
		- [poplib](#poplib)
		- [re](#re)
		- [readline](#readline)
		- [selectors](#selectors)
		- [shutil](#shutil)
		- [signal](#signal)
		- [smtpd](#smtpd)
		- [smtplib](#smtplib)
		- [sndhdr](#sndhdr)
		- [socket](#socket)
		- [ssl](#ssl)
			* [Memory BIO Support](#memory-bio-support)
			* [Application\-Layer Protocol Negotiation Support](#application-layer-protocol-negotiation-support)
			* [Other Changes](#other-changes)
		- [sqlite3](#sqlite3)
		- [subprocess](#subprocess)
		- [sys](#sys)
		- [sysconfig](#sysconfig)
		- [tarfile](#tarfile)
		- [threading](#threading)
		- [time](#time)
		- [timeit](#timeit)
		- [tkinter](#tkinter)
		- [traceback](#traceback)
		- [types](#types)
		- [unicodedata](#unicodedata)
		- [unittest](#unittest)
		- [unittest.mock](#unittest-mock)
		- [urllib](#urllib)
		- [wsgiref](#wsgiref)
		- [xmlrpc](#xmlrpc)
		- [xml.sax](#xml-sax)
		- [zipfile](#zipfile)
	+ [Other module\-level changes](#other-module-level-changes)
	+ [Optimizations](#optimizations)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Deprecated](#deprecated)
		- [New Keywords](#new-keywords)
		- [Deprecated Python Behavior](#deprecated-python-behavior)
		- [Unsupported Operating Systems](#unsupported-operating-systems)
		- [Deprecated Python modules, functions and methods](#deprecated-python-modules-functions-and-methods)
	+ [Removed](#removed)
		- [API and Feature Removals](#api-and-feature-removals)
	+ [Porting to Python 3\.5](#porting-to-python-3-5)
		- [Changes in Python behavior](#changes-in-python-behavior)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
	+ [Notable changes in Python 3\.5\.4](#notable-changes-in-python-3-5-4)
		- [New `make regen-all` build target](#new-make-regen-all-build-target)
		- [Removal of `make touch` build target](#removal-of-make-touch-build-target)

#### Previous topic

[What’s New In Python 3\.6](3.6.html "previous chapter")

#### Next topic

[What’s New In Python 3\.4](3.4.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.5.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.4.html "What’s New In Python 3.4") \|
* [previous](3.6.html "What’s New In Python 3.6") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.5
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.6 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.6.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.5.html "What’s New In Python 3.5") \|
* [previous](3.7.html "What’s New In Python 3.7") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.6
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.6[¶](#what-s-new-in-python-3-6 "Link to this heading")

Editors:
Elvis Pranskevichus \, Yury Selivanov \

This article explains the new features in Python 3\.6, compared to 3\.5\.
Python 3\.6 was released on December 23, 2016\.  See the
[changelog](https://docs.python.org/3.6/whatsnew/changelog.html) for a full
list of changes.

See also

[**PEP 494**](https://peps.python.org/pep-0494/) \- Python 3\.6 Release Schedule

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* [PEP 498](#whatsnew36-pep498), formatted string literals.
* [PEP 515](#whatsnew36-pep515), underscores in numeric literals.
* [PEP 526](#whatsnew36-pep526), syntax for variable annotations.
* [PEP 525](#whatsnew36-pep525), asynchronous generators.
* [PEP 530](#whatsnew36-pep530): asynchronous comprehensions.

New library modules:

* [`secrets`](../library/secrets.html#module-secrets "secrets: Generate secure random numbers for managing secrets."): [PEP 506 – Adding A Secrets Module To The Standard Library](#whatsnew36-pep506).

CPython implementation improvements:

* The [dict](../library/stdtypes.html#typesmapping) type has been reimplemented to use
a [more compact representation](#whatsnew36-compactdict)
based on [a proposal by Raymond Hettinger](https://mail.python.org/pipermail/python-dev/2012-December/123028.html)
and similar to the [PyPy dict implementation](https://morepypy.blogspot.com/2015/01/faster-more-memory-efficient-and-more.html). This resulted in dictionaries
using 20% to 25% less memory when compared to Python 3\.5\.
* Customization of class creation has been simplified with the
[new protocol](#whatsnew36-pep487).
* The class attribute definition order is
[now preserved](#whatsnew36-pep520).
* The order of elements in `**kwargs` now
[corresponds to the order](#whatsnew36-pep468) in which keyword
arguments were passed to the function.
* DTrace and SystemTap [probing support](#whatsnew36-tracing) has
been added.
* The new [PYTHONMALLOC](#whatsnew36-pythonmalloc) environment variable
can now be used to debug the interpreter memory allocation and access
errors.

Significant improvements in the standard library:

* The [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module has received new features, significant
usability and performance improvements, and a fair amount of bug fixes.
Starting with Python 3\.6 the `asyncio` module is no longer provisional
and its API is considered stable.
* A new [file system path protocol](#whatsnew36-pep519) has been
implemented to support [path\-like objects](../glossary.html#term-path-like-object).
All standard library functions operating on paths have been updated to
work with the new protocol.
* The [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types.") module has gained support for
[Local Time Disambiguation](#whatsnew36-pep495).
* The [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module received a number of
[improvements](#whatsnew36-typing).
* The [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") module has been significantly reworked
and is now used to provide better output for [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning")
as well as provide better diagnostics for memory allocation errors.
See the [PYTHONMALLOC section](#whatsnew36-pythonmalloc) for more
information.

Security improvements:

* The new [`secrets`](../library/secrets.html#module-secrets "secrets: Generate secure random numbers for managing secrets.") module has been added to simplify the generation of
cryptographically strong pseudo\-random numbers suitable for
managing secrets such as account authentication, tokens, and similar.
* On Linux, [`os.urandom()`](../library/os.html#os.urandom "os.urandom") now blocks until the system urandom entropy
pool is initialized to increase the security. See the [**PEP 524**](https://peps.python.org/pep-0524/) for the
rationale.
* The [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") and [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") modules now support OpenSSL 1\.1\.0\.
* The default settings and feature set of the [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module have been
improved.
* The [`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") module received support for the BLAKE2, SHA\-3 and SHAKE
hash algorithms and the [`scrypt()`](../library/hashlib.html#hashlib.scrypt "hashlib.scrypt") key derivation function.

Windows improvements:

* [PEP 528](#whatsnew36-pep528) and [PEP 529](#whatsnew36-pep529),
Windows filesystem and console encoding changed to UTF\-8\.
* The `py.exe` launcher, when used interactively, no longer prefers
Python 2 over Python 3 when the user doesn’t specify a version (via
command line arguments or a config file). Handling of shebang lines
remains unchanged \- “python” refers to Python 2 in that case.
* `python.exe` and `pythonw.exe` have been marked as long\-path aware,
which means that the 260 character path limit may no longer apply.
See [removing the MAX\_PATH limitation](../using/windows.html#max-path) for details.
* A `._pth` file can be added to force isolated mode and fully specify
all search paths to avoid registry and environment lookup. See
[the documentation](../using/windows.html#windows-finding-modules) for more information.
* A `python36.zip` file now works as a landmark to infer
[`PYTHONHOME`](../using/cmdline.html#envvar-PYTHONHOME). See [the documentation](../using/windows.html#windows-finding-modules) for
more information.

## New Features[¶](#new-features "Link to this heading")

### PEP 498: Formatted string literals[¶](#pep-498-formatted-string-literals "Link to this heading")

[**PEP 498**](https://peps.python.org/pep-0498/) introduces a new kind of string literals: *f\-strings*, or
[formatted string literals](../reference/lexical_analysis.html#f-strings).

Formatted string literals are prefixed with `'f'` and are similar to
the format strings accepted by [`str.format()`](../library/stdtypes.html#str.format "str.format"). They contain replacement
fields surrounded by curly braces. The replacement fields are expressions,
which are evaluated at run time, and then formatted using the
[`format()`](../library/functions.html#format "format") protocol:

\`\`\`
\>\>\> name = "Fred"
\>\>\> f"He said his name is {name}."
'He said his name is Fred.'
\>\>\> width = 10
\>\>\> precision = 4
\>\>\> value = decimal.Decimal("12\.34567")
\>\>\> f"result: {value:{width}.{precision}}" \# nested fields
'result: 12\.35'

\`\`\`

See also

[**PEP 498**](https://peps.python.org/pep-0498/) – Literal String Interpolation.PEP written and implemented by Eric V. Smith.

[Feature documentation](../reference/lexical_analysis.html#f-strings).

### PEP 526: Syntax for variable annotations[¶](#pep-526-syntax-for-variable-annotations "Link to this heading")

[**PEP 484**](https://peps.python.org/pep-0484/) introduced the standard for type annotations of function
parameters, a.k.a. type hints. This PEP adds syntax to Python for annotating
the types of variables including class variables and instance variables:

\`\`\`
primes: List\[int] = \[]

captain: str \# Note: no initial value!

class Starship:
 stats: Dict\[str, int] = {}

\`\`\`

Just as for function annotations, the Python interpreter does not attach any
particular meaning to variable annotations and only stores them in the
`__annotations__` attribute of a class or module.

In contrast to variable declarations in statically typed languages,
the goal of annotation syntax is to provide an easy way to specify structured
type metadata for third party tools and libraries via the abstract syntax tree
and the `__annotations__` attribute.

See also

[**PEP 526**](https://peps.python.org/pep-0526/) – Syntax for variable annotations.PEP written by Ryan Gonzalez, Philip House, Ivan Levkivskyi, Lisa Roach,
and Guido van Rossum. Implemented by Ivan Levkivskyi.

Tools that use or will use the new syntax:
[mypy](https://www.mypy-lang.org/),
[pytype](https://github.com/google/pytype), PyCharm, etc.

### PEP 515: Underscores in Numeric Literals[¶](#pep-515-underscores-in-numeric-literals "Link to this heading")

[**PEP 515**](https://peps.python.org/pep-0515/) adds the ability to use underscores in numeric literals for
improved readability. For example:

\`\`\`
\>\>\> 1\_000\_000\_000\_000\_000
1000000000000000
\>\>\> 0x\_FF\_FF\_FF\_FF
4294967295

\`\`\`

Single underscores are allowed between digits and after any base
specifier. Leading, trailing, or multiple underscores in a row are not
allowed.

The [string formatting](../library/string.html#formatspec) language also now has support
for the `'_'` option to signal the use of an underscore for a thousands
separator for floating\-point presentation types and for integer
presentation type `'d'`. For integer presentation types `'b'`,
`'o'`, `'x'`, and `'X'`, underscores will be inserted every 4
digits:

\`\`\`
\>\>\> '{:\_}'.format(1000000\)
'1\_000\_000'
\>\>\> '{:\_x}'.format(0xFFFFFFFF)
'ffff\_ffff'

\`\`\`

See also

[**PEP 515**](https://peps.python.org/pep-0515/) – Underscores in Numeric LiteralsPEP written by Georg Brandl and Serhiy Storchaka.

### PEP 525: Asynchronous Generators[¶](#pep-525-asynchronous-generators "Link to this heading")

[**PEP 492**](https://peps.python.org/pep-0492/) introduced support for native coroutines and `async` / `await`
syntax to Python 3\.5\. A notable limitation of the Python 3\.5 implementation
is that it was not possible to use `await` and `yield` in the same
function body. In Python 3\.6 this restriction has been lifted, making it
possible to define *asynchronous generators*:

\`\`\`
async def ticker(delay, to):
 """Yield numbers from 0 to \*to\* every \*delay\* seconds."""
 for i in range(to):
 yield i
 await asyncio.sleep(delay)

\`\`\`

The new syntax allows for faster and more concise code.

See also

[**PEP 525**](https://peps.python.org/pep-0525/) – Asynchronous GeneratorsPEP written and implemented by Yury Selivanov.

### PEP 530: Asynchronous Comprehensions[¶](#pep-530-asynchronous-comprehensions "Link to this heading")

[**PEP 530**](https://peps.python.org/pep-0530/) adds support for using `async for` in list, set, dict
comprehensions and generator expressions:

\`\`\`
result = \[i async for i in aiter() if i % 2]

\`\`\`

Additionally, `await` expressions are supported in all kinds
of comprehensions:

\`\`\`
result = \[await fun() for fun in funcs if await condition()]

\`\`\`

See also

[**PEP 530**](https://peps.python.org/pep-0530/) – Asynchronous ComprehensionsPEP written and implemented by Yury Selivanov.

### PEP 487: Simpler customization of class creation[¶](#pep-487-simpler-customization-of-class-creation "Link to this heading")

It is now possible to customize subclass creation without using a metaclass.
The new `__init_subclass__` classmethod will be called on the base class
whenever a new subclass is created:

\`\`\`
class PluginBase:
 subclasses = \[]

 def \_\_init\_subclass\_\_(cls, \*\*kwargs):
 super().\_\_init\_subclass\_\_(\*\*kwargs)
 cls.subclasses.append(cls)

class Plugin1(PluginBase):
 pass

class Plugin2(PluginBase):
 pass

\`\`\`

In order to allow zero\-argument [`super()`](../library/functions.html#super "super") calls to work correctly from
[`__init_subclass__()`](../reference/datamodel.html#object.__init_subclass__ "object.__init_subclass__") implementations, custom metaclasses must
ensure that the new `__classcell__` namespace entry is propagated to
`type.__new__` (as described in [Creating the class object](../reference/datamodel.html#class-object-creation)).

See also

[**PEP 487**](https://peps.python.org/pep-0487/) – Simpler customization of class creationPEP written and implemented by Martin Teichmann.

[Feature documentation](../reference/datamodel.html#class-customization)

### PEP 487: Descriptor Protocol Enhancements[¶](#pep-487-descriptor-protocol-enhancements "Link to this heading")

[**PEP 487**](https://peps.python.org/pep-0487/) extends the descriptor protocol to include the new optional
[`__set_name__()`](../reference/datamodel.html#object.__set_name__ "object.__set_name__") method. Whenever a new class is defined, the new
method will be called on all descriptors included in the definition, providing
them with a reference to the class being defined and the name given to the
descriptor within the class namespace. In other words, instances of
descriptors can now know the attribute name of the descriptor in the
owner class:

\`\`\`
class IntField:
 def \_\_get\_\_(self, instance, owner):
 return instance.\_\_dict\_\_\[self.name]

 def \_\_set\_\_(self, instance, value):
 if not isinstance(value, int):
 raise ValueError(f'expecting integer in {self.name}')
 instance.\_\_dict\_\_\[self.name] = value

 \# this is the new initializer:
 def \_\_set\_name\_\_(self, owner, name):
 self.name = name

class Model:
 int\_field = IntField()

\`\`\`

See also

[**PEP 487**](https://peps.python.org/pep-0487/) – Simpler customization of class creationPEP written and implemented by Martin Teichmann.

[Feature documentation](../reference/datamodel.html#descriptors)

### PEP 519: Adding a file system path protocol[¶](#pep-519-adding-a-file-system-path-protocol "Link to this heading")

File system paths have historically been represented as [`str`](../library/stdtypes.html#str "str")
or [`bytes`](../library/stdtypes.html#bytes "bytes") objects. This has led to people who write code which
operate on file system paths to assume that such objects are only one
of those two types (an [`int`](../library/functions.html#int "int") representing a file descriptor
does not count as that is not a file path). Unfortunately that
assumption prevents alternative object representations of file system
paths like [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths") from working with pre\-existing code,
including Python’s standard library.

To fix this situation, a new interface represented by
[`os.PathLike`](../library/os.html#os.PathLike "os.PathLike") has been defined. By implementing the
[`__fspath__()`](../library/os.html#os.PathLike.__fspath__ "os.PathLike.__fspath__") method, an object signals that it
represents a path. An object can then provide a low\-level
representation of a file system path as a [`str`](../library/stdtypes.html#str "str") or
[`bytes`](../library/stdtypes.html#bytes "bytes") object. This means an object is considered
[path\-like](../glossary.html#term-path-like-object) if it implements
[`os.PathLike`](../library/os.html#os.PathLike "os.PathLike") or is a [`str`](../library/stdtypes.html#str "str") or [`bytes`](../library/stdtypes.html#bytes "bytes") object
which represents a file system path. Code can use [`os.fspath()`](../library/os.html#os.fspath "os.fspath"),
[`os.fsdecode()`](../library/os.html#os.fsdecode "os.fsdecode"), or [`os.fsencode()`](../library/os.html#os.fsencode "os.fsencode") to explicitly get a
[`str`](../library/stdtypes.html#str "str") and/or [`bytes`](../library/stdtypes.html#bytes "bytes") representation of a path\-like
object.

The built\-in [`open()`](../library/functions.html#open "open") function has been updated to accept
[`os.PathLike`](../library/os.html#os.PathLike "os.PathLike") objects, as have all relevant functions in the
[`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") and [`os.path`](../library/os.path.html#module-os.path "os.path: Operations on pathnames.") modules, and most other functions and
classes in the standard library. The [`os.DirEntry`](../library/os.html#os.DirEntry "os.DirEntry") class
and relevant classes in [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths") have also been updated to
implement [`os.PathLike`](../library/os.html#os.PathLike "os.PathLike").

The hope is that updating the fundamental functions for operating
on file system paths will lead to third\-party code to implicitly
support all [path\-like objects](../glossary.html#term-path-like-object) without any
code changes, or at least very minimal ones (e.g. calling
[`os.fspath()`](../library/os.html#os.fspath "os.fspath") at the beginning of code before operating on a
path\-like object).

Here are some examples of how the new interface allows for
[`pathlib.Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") to be used more easily and transparently with
pre\-existing code:

\`\`\`
\>\>\> import pathlib
\>\>\> with open(pathlib.Path("README")) as f:
... contents = f.read()
...
\>\>\> import os.path
\>\>\> os.path.splitext(pathlib.Path("some\_file.txt"))
('some\_file', '.txt')
\>\>\> os.path.join("/a/b", pathlib.Path("c"))
'/a/b/c'
\>\>\> import os
\>\>\> os.fspath(pathlib.Path("some\_file.txt"))
'some\_file.txt'

\`\`\`

(Implemented by Brett Cannon, Ethan Furman, Dusty Phillips, and Jelle Zijlstra.)

See also

[**PEP 519**](https://peps.python.org/pep-0519/) – Adding a file system path protocolPEP written by Brett Cannon and Koos Zevenhoven.

### PEP 495: Local Time Disambiguation[¶](#pep-495-local-time-disambiguation "Link to this heading")

In most world locations, there have been and will be times when local clocks
are moved back. In those times, intervals are introduced in which local
clocks show the same time twice in the same day. In these situations, the
information displayed on a local clock (or stored in a Python datetime
instance) is insufficient to identify a particular moment in time.

[**PEP 495**](https://peps.python.org/pep-0495/) adds the new *fold* attribute to instances of
[`datetime.datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") and [`datetime.time`](../library/datetime.html#datetime.time "datetime.time") classes to differentiate
between two moments in time for which local times are the same:

\`\`\`
\>\>\> u0 = datetime(2016, 11, 6, 4, tzinfo=timezone.utc)
\>\>\> for i in range(4\):
... u = u0 \+ i\*HOUR
... t = u.astimezone(Eastern)
... print(u.time(), 'UTC =', t.time(), t.tzname(), t.fold)
...
04:00:00 UTC = 00:00:00 EDT 0
05:00:00 UTC = 01:00:00 EDT 0
06:00:00 UTC = 01:00:00 EST 1
07:00:00 UTC = 02:00:00 EST 0

\`\`\`

The values of the [`fold`](../library/datetime.html#datetime.datetime.fold "datetime.datetime.fold") attribute have the
value `0` for all instances except those that represent the second
(chronologically) moment in time in an ambiguous case.

See also

[**PEP 495**](https://peps.python.org/pep-0495/) – Local Time DisambiguationPEP written by Alexander Belopolsky and Tim Peters, implementation
by Alexander Belopolsky.

### PEP 529: Change Windows filesystem encoding to UTF\-8[¶](#pep-529-change-windows-filesystem-encoding-to-utf-8 "Link to this heading")

Representing filesystem paths is best performed with str (Unicode) rather than
bytes. However, there are some situations where using bytes is sufficient and
correct.

Prior to Python 3\.6, data loss could result when using bytes paths on Windows.
With this change, using bytes to represent paths is now supported on Windows,
provided those bytes are encoded with the encoding returned by
[`sys.getfilesystemencoding()`](../library/sys.html#sys.getfilesystemencoding "sys.getfilesystemencoding"), which now defaults to `'utf-8'`.

Applications that do not use str to represent paths should use
[`os.fsencode()`](../library/os.html#os.fsencode "os.fsencode") and [`os.fsdecode()`](../library/os.html#os.fsdecode "os.fsdecode") to ensure their bytes are
correctly encoded. To revert to the previous behaviour, set
[`PYTHONLEGACYWINDOWSFSENCODING`](../using/cmdline.html#envvar-PYTHONLEGACYWINDOWSFSENCODING) or call
[`sys._enablelegacywindowsfsencoding()`](../library/sys.html#sys._enablelegacywindowsfsencoding "sys._enablelegacywindowsfsencoding").

See [**PEP 529**](https://peps.python.org/pep-0529/) for more information and discussion of code modifications that
may be required.

### PEP 528: Change Windows console encoding to UTF\-8[¶](#pep-528-change-windows-console-encoding-to-utf-8 "Link to this heading")

The default console on Windows will now accept all Unicode characters and
provide correctly read str objects to Python code. `sys.stdin`,
`sys.stdout` and `sys.stderr` now default to utf\-8 encoding.

This change only applies when using an interactive console, and not when
redirecting files or pipes. To revert to the previous behaviour for interactive
console use, set [`PYTHONLEGACYWINDOWSSTDIO`](../using/cmdline.html#envvar-PYTHONLEGACYWINDOWSSTDIO).

See also

[**PEP 528**](https://peps.python.org/pep-0528/) – Change Windows console encoding to UTF\-8PEP written and implemented by Steve Dower.

### PEP 520: Preserving Class Attribute Definition Order[¶](#pep-520-preserving-class-attribute-definition-order "Link to this heading")

Attributes in a class definition body have a natural ordering: the same
order in which the names appear in the source. This order is now
preserved in the new class’s [`__dict__`](../reference/datamodel.html#type.__dict__ "type.__dict__") attribute.

Also, the effective default class *execution* namespace (returned from
[type.\_\_prepare\_\_()](../reference/datamodel.html#prepare)) is now an insertion\-order\-preserving
mapping.

See also

[**PEP 520**](https://peps.python.org/pep-0520/) – Preserving Class Attribute Definition OrderPEP written and implemented by Eric Snow.

### PEP 468: Preserving Keyword Argument Order[¶](#pep-468-preserving-keyword-argument-order "Link to this heading")

`**kwargs` in a function signature is now guaranteed to be an
insertion\-order\-preserving mapping.

See also

[**PEP 468**](https://peps.python.org/pep-0468/) – Preserving Keyword Argument OrderPEP written and implemented by Eric Snow.

### New [dict](../library/stdtypes.html#typesmapping) implementation[¶](#new-dict-implementation "Link to this heading")

The [dict](../library/stdtypes.html#typesmapping) type now uses a “compact” representation
based on [a proposal by Raymond Hettinger](https://mail.python.org/pipermail/python-dev/2012-December/123028.html)
which was [first implemented by PyPy](https://morepypy.blogspot.com/2015/01/faster-more-memory-efficient-and-more.html).
The memory usage of the new [`dict()`](../library/stdtypes.html#dict "dict") is between 20% and 25% smaller
compared to Python 3\.5\.

The order\-preserving aspect of this new implementation is considered an
implementation detail and should not be relied upon (this may change in
the future, but it is desired to have this new dict implementation in
the language for a few releases before changing the language spec to mandate
order\-preserving semantics for all current and future Python
implementations; this also helps preserve backwards\-compatibility
with older versions of the language where random iteration order is
still in effect, e.g. Python 3\.5\).

(Contributed by INADA Naoki in [bpo\-27350](https://bugs.python.org/issue?@action=redirect&bpo=27350). Idea
[originally suggested by Raymond Hettinger](https://mail.python.org/pipermail/python-dev/2012-December/123028.html).)

### PEP 523: Adding a frame evaluation API to CPython[¶](#pep-523-adding-a-frame-evaluation-api-to-cpython "Link to this heading")

While Python provides extensive support to customize how code
executes, one place it has not done so is in the evaluation of frame
objects. If you wanted some way to intercept frame evaluation in
Python there really wasn’t any way without directly manipulating
function pointers for defined functions.

[**PEP 523**](https://peps.python.org/pep-0523/) changes this by providing an API to make frame
evaluation pluggable at the C level. This will allow for tools such
as debuggers and JITs to intercept frame evaluation before the
execution of Python code begins. This enables the use of alternative
evaluation implementations for Python code, tracking frame
evaluation, etc.

This API is not part of the limited C API and is marked as private to
signal that usage of this API is expected to be limited and only
applicable to very select, low\-level use\-cases. Semantics of the
API will change with Python as necessary.

See also

[**PEP 523**](https://peps.python.org/pep-0523/) – Adding a frame evaluation API to CPythonPEP written by Brett Cannon and Dino Viehland.

### PYTHONMALLOC environment variable[¶](#pythonmalloc-environment-variable "Link to this heading")

The new [`PYTHONMALLOC`](../using/cmdline.html#envvar-PYTHONMALLOC) environment variable allows setting the Python
memory allocators and installing debug hooks.

It is now possible to install debug hooks on Python memory allocators on Python
compiled in release mode using `PYTHONMALLOC=debug`. Effects of debug hooks:

* Newly allocated memory is filled with the byte `0xCB`
* Freed memory is filled with the byte `0xDB`
* Detect violations of the Python memory allocator API. For example,
[`PyObject_Free()`](../c-api/memory.html#c.PyObject_Free "PyObject_Free") called on a memory block allocated by
[`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc").
* Detect writes before the start of a buffer (buffer underflows)
* Detect writes after the end of a buffer (buffer overflows)
* Check that the [GIL](../glossary.html#term-global-interpreter-lock) is held when allocator
functions of [`PYMEM_DOMAIN_OBJ`](../c-api/memory.html#c.PYMEM_DOMAIN_OBJ "PYMEM_DOMAIN_OBJ") (ex: [`PyObject_Malloc()`](../c-api/memory.html#c.PyObject_Malloc "PyObject_Malloc")) and
[`PYMEM_DOMAIN_MEM`](../c-api/memory.html#c.PYMEM_DOMAIN_MEM "PYMEM_DOMAIN_MEM") (ex: [`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc")) domains are called.

Checking if the GIL is held is also a new feature of Python 3\.6\.

See the [`PyMem_SetupDebugHooks()`](../c-api/memory.html#c.PyMem_SetupDebugHooks "PyMem_SetupDebugHooks") function for debug hooks on Python
memory allocators.

It is now also possible to force the usage of the `malloc()` allocator of
the C library for all Python memory allocations using `PYTHONMALLOC=malloc`.
This is helpful when using external memory debuggers like Valgrind on
a Python compiled in release mode.

On error, the debug hooks on Python memory allocators now use the
[`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") module to get the traceback where a memory block was
allocated.

Example of fatal error on buffer overflow using
`python3.6 -X tracemalloc=5` (store 5 frames in traces):

\`\`\`
Debug memory block at address p=0x7fbcd41666f8: API 'o'
 4 bytes originally requested
 The 7 pad bytes at p\-7 are FORBIDDENBYTE, as expected.
 The 8 pad bytes at tail=0x7fbcd41666fc are not all FORBIDDENBYTE (0xfb):
 at tail\+0: 0x02 \*\*\* OUCH
 at tail\+1: 0xfb
 at tail\+2: 0xfb
 at tail\+3: 0xfb
 at tail\+4: 0xfb
 at tail\+5: 0xfb
 at tail\+6: 0xfb
 at tail\+7: 0xfb
 The block was made by call \#1233329 to debug malloc/realloc.
 Data at p: 1a 2b 30 00

Memory block allocated at (most recent call first):
 File "test/test\_bytes.py", line 323
 File "unittest/case.py", line 600
 File "unittest/case.py", line 648
 File "unittest/suite.py", line 122
 File "unittest/suite.py", line 84

Fatal Python error: bad trailing pad byte

Current thread 0x00007fbcdbd32700 (most recent call first):
 File "test/test\_bytes.py", line 323 in test\_hex
 File "unittest/case.py", line 600 in run
 File "unittest/case.py", line 648 in \_\_call\_\_
 File "unittest/suite.py", line 122 in run
 File "unittest/suite.py", line 84 in \_\_call\_\_
 File "unittest/suite.py", line 122 in run
 File "unittest/suite.py", line 84 in \_\_call\_\_
 ...

\`\`\`

(Contributed by Victor Stinner in [bpo\-26516](https://bugs.python.org/issue?@action=redirect&bpo=26516) and [bpo\-26564](https://bugs.python.org/issue?@action=redirect&bpo=26564).)

### DTrace and SystemTap probing support[¶](#dtrace-and-systemtap-probing-support "Link to this heading")

Python can now be built `--with-dtrace` which enables static markers
for the following events in the interpreter:

* function call/return
* garbage collection started/finished
* line of code executed.

This can be used to instrument running interpreters in production,
without the need to recompile specific [debug builds](../using/configure.html#debug-build) or
providing application\-specific profiling/debugging code.

More details in [Instrumenting CPython with DTrace and SystemTap](../howto/instrumentation.html#instrumentation).

The current implementation is tested on Linux and macOS. Additional
markers may be added in the future.

(Contributed by Łukasz Langa in [bpo\-21590](https://bugs.python.org/issue?@action=redirect&bpo=21590), based on patches by
Jesús Cea Avión, David Malcolm, and Nikhil Benesch.)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

Some smaller changes made to the core Python language are:

* A `global` or `nonlocal` statement must now textually appear
before the first use of the affected name in the same scope.
Previously this was a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning").
* It is now possible to set a [special method](../reference/datamodel.html#specialnames) to
`None` to indicate that the corresponding operation is not available.
For example, if a class sets `__iter__()` to `None`, the class
is not iterable.
(Contributed by Andrew Barnert and Ivan Levkivskyi in [bpo\-25958](https://bugs.python.org/issue?@action=redirect&bpo=25958).)
* Long sequences of repeated traceback lines are now abbreviated as
`"[Previous line repeated {count} more times]"` (see
[traceback](#whatsnew36-traceback) for an example).
(Contributed by Emanuel Barry in [bpo\-26823](https://bugs.python.org/issue?@action=redirect&bpo=26823).)
* Import now raises the new exception [`ModuleNotFoundError`](../library/exceptions.html#ModuleNotFoundError "ModuleNotFoundError")
(subclass of [`ImportError`](../library/exceptions.html#ImportError "ImportError")) when it cannot find a module. Code
that currently checks for ImportError (in try\-except) will still work.
(Contributed by Eric Snow in [bpo\-15767](https://bugs.python.org/issue?@action=redirect&bpo=15767).)
* Class methods relying on zero\-argument `super()` will now work correctly
when called from metaclass methods during class creation.
(Contributed by Martin Teichmann in [bpo\-23722](https://bugs.python.org/issue?@action=redirect&bpo=23722).)

## New Modules[¶](#new-modules "Link to this heading")

### secrets[¶](#secrets "Link to this heading")

The main purpose of the new [`secrets`](../library/secrets.html#module-secrets "secrets: Generate secure random numbers for managing secrets.") module is to provide an obvious way
to reliably generate cryptographically strong pseudo\-random values suitable
for managing secrets, such as account authentication, tokens, and similar.

Warning

Note that the pseudo\-random generators in the [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions.") module
should *NOT* be used for security purposes. Use [`secrets`](../library/secrets.html#module-secrets "secrets: Generate secure random numbers for managing secrets.")
on Python 3\.6\+ and [`os.urandom()`](../library/os.html#os.urandom "os.urandom") on Python 3\.5 and earlier.

See also

[**PEP 506**](https://peps.python.org/pep-0506/) – Adding A Secrets Module To The Standard LibraryPEP written and implemented by Steven D’Aprano.

## Improved Modules[¶](#improved-modules "Link to this heading")

### array[¶](#array "Link to this heading")

Exhausted iterators of [`array.array`](../library/array.html#array.array "array.array") will now stay exhausted even
if the iterated array is extended. This is consistent with the behavior
of other mutable sequences.

Contributed by Serhiy Storchaka in [bpo\-26492](https://bugs.python.org/issue?@action=redirect&bpo=26492).

### ast[¶](#ast "Link to this heading")

The new [`ast.Constant`](../library/ast.html#ast.Constant "ast.Constant") AST node has been added. It can be used
by external AST optimizers for the purposes of constant folding.

Contributed by Victor Stinner in [bpo\-26146](https://bugs.python.org/issue?@action=redirect&bpo=26146).

### asyncio[¶](#asyncio "Link to this heading")

Starting with Python 3\.6 the `asyncio` module is no longer provisional and its
API is considered stable.

Notable changes in the [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module since Python 3\.5\.0
(all backported to 3\.5\.x due to the provisional status):

* The [`get_event_loop()`](../library/asyncio-eventloop.html#asyncio.get_event_loop "asyncio.get_event_loop") function has been changed to
always return the currently running loop when called from coroutines
and callbacks.
(Contributed by Yury Selivanov in [bpo\-28613](https://bugs.python.org/issue?@action=redirect&bpo=28613).)
* The [`ensure_future()`](../library/asyncio-future.html#asyncio.ensure_future "asyncio.ensure_future") function and all functions that
use it, such as [`loop.run_until_complete()`](../library/asyncio-eventloop.html#asyncio.loop.run_until_complete "asyncio.loop.run_until_complete"),
now accept all kinds of [awaitable objects](../glossary.html#term-awaitable).
(Contributed by Yury Selivanov.)
* New [`run_coroutine_threadsafe()`](../library/asyncio-task.html#asyncio.run_coroutine_threadsafe "asyncio.run_coroutine_threadsafe") function to submit
coroutines to event loops from other threads.
(Contributed by Vincent Michel.)
* New [`Transport.is_closing()`](../library/asyncio-protocol.html#asyncio.BaseTransport.is_closing "asyncio.BaseTransport.is_closing")
method to check if the transport is closing or closed.
(Contributed by Yury Selivanov.)
* The [`loop.create_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_server "asyncio.loop.create_server")
method can now accept a list of hosts.
(Contributed by Yann Sionneau.)
* New [`loop.create_future()`](../library/asyncio-eventloop.html#asyncio.loop.create_future "asyncio.loop.create_future")
method to create Future objects. This allows alternative event
loop implementations, such as
[uvloop](https://github.com/MagicStack/uvloop), to provide a faster
[`asyncio.Future`](../library/asyncio-future.html#asyncio.Future "asyncio.Future") implementation.
(Contributed by Yury Selivanov in [bpo\-27041](https://bugs.python.org/issue?@action=redirect&bpo=27041).)
* New [`loop.get_exception_handler()`](../library/asyncio-eventloop.html#asyncio.loop.get_exception_handler "asyncio.loop.get_exception_handler")
method to get the current exception handler.
(Contributed by Yury Selivanov in [bpo\-27040](https://bugs.python.org/issue?@action=redirect&bpo=27040).)
* New [`StreamReader.readuntil()`](../library/asyncio-stream.html#asyncio.StreamReader.readuntil "asyncio.StreamReader.readuntil")
method to read data from the stream until a separator bytes
sequence appears.
(Contributed by Mark Korenberg.)
* The performance of [`StreamReader.readexactly()`](../library/asyncio-stream.html#asyncio.StreamReader.readexactly "asyncio.StreamReader.readexactly")
has been improved.
(Contributed by Mark Korenberg in [bpo\-28370](https://bugs.python.org/issue?@action=redirect&bpo=28370).)
* The [`loop.getaddrinfo()`](../library/asyncio-eventloop.html#asyncio.loop.getaddrinfo "asyncio.loop.getaddrinfo")
method is optimized to avoid calling the system `getaddrinfo`
function if the address is already resolved.
(Contributed by A. Jesse Jiryu Davis.)
* The [`loop.stop()`](../library/asyncio-eventloop.html#asyncio.loop.stop "asyncio.loop.stop")
method has been changed to stop the loop immediately after
the current iteration. Any new callbacks scheduled as a result
of the last iteration will be discarded.
(Contributed by Guido van Rossum in [bpo\-25593](https://bugs.python.org/issue?@action=redirect&bpo=25593).)
* `Future.set_exception`
will now raise [`TypeError`](../library/exceptions.html#TypeError "TypeError") when passed an instance of
the [`StopIteration`](../library/exceptions.html#StopIteration "StopIteration") exception.
(Contributed by Chris Angelico in [bpo\-26221](https://bugs.python.org/issue?@action=redirect&bpo=26221).)
* New [`loop.connect_accepted_socket()`](../library/asyncio-eventloop.html#asyncio.loop.connect_accepted_socket "asyncio.loop.connect_accepted_socket")
method to be used by servers that accept connections outside of asyncio,
but that use asyncio to handle them.
(Contributed by Jim Fulton in [bpo\-27392](https://bugs.python.org/issue?@action=redirect&bpo=27392).)
* `TCP_NODELAY` flag is now set for all TCP transports by default.
(Contributed by Yury Selivanov in [bpo\-27456](https://bugs.python.org/issue?@action=redirect&bpo=27456).)
* New [`loop.shutdown_asyncgens()`](../library/asyncio-eventloop.html#asyncio.loop.shutdown_asyncgens "asyncio.loop.shutdown_asyncgens")
to properly close pending asynchronous generators before closing the
loop.
(Contributed by Yury Selivanov in [bpo\-28003](https://bugs.python.org/issue?@action=redirect&bpo=28003).)
* [`Future`](../library/asyncio-future.html#asyncio.Future "asyncio.Future") and [`Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task")
classes now have an optimized C implementation which makes asyncio
code up to 30% faster.
(Contributed by Yury Selivanov and INADA Naoki in [bpo\-26081](https://bugs.python.org/issue?@action=redirect&bpo=26081)
and [bpo\-28544](https://bugs.python.org/issue?@action=redirect&bpo=28544).)

### binascii[¶](#binascii "Link to this heading")

The [`b2a_base64()`](../library/binascii.html#binascii.b2a_base64 "binascii.b2a_base64") function now accepts an optional *newline*
keyword argument to control whether the newline character is appended to the
return value.
(Contributed by Victor Stinner in [bpo\-25357](https://bugs.python.org/issue?@action=redirect&bpo=25357).)

### cmath[¶](#cmath "Link to this heading")

The new [`cmath.tau`](../library/cmath.html#cmath.tau "cmath.tau") (*τ*) constant has been added.
(Contributed by Lisa Roach in [bpo\-12345](https://bugs.python.org/issue?@action=redirect&bpo=12345), see [**PEP 628**](https://peps.python.org/pep-0628/) for details.)

New constants: [`cmath.inf`](../library/cmath.html#cmath.inf "cmath.inf") and [`cmath.nan`](../library/cmath.html#cmath.nan "cmath.nan") to
match [`math.inf`](../library/math.html#math.inf "math.inf") and [`math.nan`](../library/math.html#math.nan "math.nan"), and also [`cmath.infj`](../library/cmath.html#cmath.infj "cmath.infj")
and [`cmath.nanj`](../library/cmath.html#cmath.nanj "cmath.nanj") to match the format used by complex repr.
(Contributed by Mark Dickinson in [bpo\-23229](https://bugs.python.org/issue?@action=redirect&bpo=23229).)

### collections[¶](#collections "Link to this heading")

The new [`Collection`](../library/collections.abc.html#collections.abc.Collection "collections.abc.Collection") abstract base class has been
added to represent sized iterable container classes.
(Contributed by Ivan Levkivskyi, docs by Neil Girdhar in [bpo\-27598](https://bugs.python.org/issue?@action=redirect&bpo=27598).)

The new [`Reversible`](../library/collections.abc.html#collections.abc.Reversible "collections.abc.Reversible") abstract base class represents
iterable classes that also provide the `__reversed__()` method.
(Contributed by Ivan Levkivskyi in [bpo\-25987](https://bugs.python.org/issue?@action=redirect&bpo=25987).)

The new [`AsyncGenerator`](../library/collections.abc.html#collections.abc.AsyncGenerator "collections.abc.AsyncGenerator") abstract base class represents
asynchronous generators.
(Contributed by Yury Selivanov in [bpo\-28720](https://bugs.python.org/issue?@action=redirect&bpo=28720).)

The [`namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") function now accepts an optional
keyword argument *module*, which, when specified, is used for
the [`__module__`](../reference/datamodel.html#type.__module__ "type.__module__") attribute of the returned named tuple class.
(Contributed by Raymond Hettinger in [bpo\-17941](https://bugs.python.org/issue?@action=redirect&bpo=17941).)

The *verbose* and *rename* arguments for
[`namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") are now keyword\-only.
(Contributed by Raymond Hettinger in [bpo\-25628](https://bugs.python.org/issue?@action=redirect&bpo=25628).)

Recursive [`collections.deque`](../library/collections.html#collections.deque "collections.deque") instances can now be pickled.
(Contributed by Serhiy Storchaka in [bpo\-26482](https://bugs.python.org/issue?@action=redirect&bpo=26482).)

### concurrent.futures[¶](#concurrent-futures "Link to this heading")

The [`ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor")
class constructor now accepts an optional *thread\_name\_prefix* argument
to make it possible to customize the names of the threads created by the
pool.
(Contributed by Gregory P. Smith in [bpo\-27664](https://bugs.python.org/issue?@action=redirect&bpo=27664).)

### contextlib[¶](#contextlib "Link to this heading")

The [`contextlib.AbstractContextManager`](../library/contextlib.html#contextlib.AbstractContextManager "contextlib.AbstractContextManager") class has been added to
provide an abstract base class for context managers. It provides a
sensible default implementation for `__enter__()` which returns
`self` and leaves `__exit__()` an abstract method. A matching
class has been added to the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module as
[`typing.ContextManager`](../library/typing.html#typing.ContextManager "typing.ContextManager").
(Contributed by Brett Cannon in [bpo\-25609](https://bugs.python.org/issue?@action=redirect&bpo=25609).)

### datetime[¶](#datetime "Link to this heading")

The [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") and [`time`](../library/datetime.html#datetime.time "datetime.time") classes have
the new `fold` attribute used to disambiguate local time
when necessary. Many functions in the [`datetime`](../library/datetime.html#module-datetime "datetime: Basic date and time types.") have been
updated to support local time disambiguation.
See [Local Time Disambiguation](#whatsnew36-pep495) section for more
information.
(Contributed by Alexander Belopolsky in [bpo\-24773](https://bugs.python.org/issue?@action=redirect&bpo=24773).)

The [`datetime.strftime()`](../library/datetime.html#datetime.datetime.strftime "datetime.datetime.strftime") and
[`date.strftime()`](../library/datetime.html#datetime.date.strftime "datetime.date.strftime") methods now support
ISO 8601 date directives `%G`, `%u` and `%V`.
(Contributed by Ashley Anderson in [bpo\-12006](https://bugs.python.org/issue?@action=redirect&bpo=12006).)

The [`datetime.isoformat()`](../library/datetime.html#datetime.datetime.isoformat "datetime.datetime.isoformat") function
now accepts an optional *timespec* argument that specifies the number
of additional components of the time value to include.
(Contributed by Alessandro Cucci and Alexander Belopolsky in [bpo\-19475](https://bugs.python.org/issue?@action=redirect&bpo=19475).)

The [`datetime.combine()`](../library/datetime.html#datetime.datetime.combine "datetime.datetime.combine") now
accepts an optional *tzinfo* argument.
(Contributed by Alexander Belopolsky in [bpo\-27661](https://bugs.python.org/issue?@action=redirect&bpo=27661).)

### decimal[¶](#decimal "Link to this heading")

New [`Decimal.as_integer_ratio()`](../library/decimal.html#decimal.Decimal.as_integer_ratio "decimal.Decimal.as_integer_ratio")
method that returns a pair `(n, d)` of integers that represent the given
[`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal") instance as a fraction, in lowest terms and
with a positive denominator:

\`\`\`
\>\>\> Decimal('\-3\.14').as\_integer\_ratio()
(\-157, 50\)

\`\`\`

(Contributed by Stefan Krah amd Mark Dickinson in [bpo\-25928](https://bugs.python.org/issue?@action=redirect&bpo=25928).)

### distutils[¶](#distutils "Link to this heading")

The `default_format` attribute has been removed from
`distutils.command.sdist.sdist` and the `formats`
attribute defaults to `['gztar']`. Although not anticipated,
any code relying on the presence of `default_format` may
need to be adapted. See [bpo\-27819](https://bugs.python.org/issue?@action=redirect&bpo=27819) for more details.

### email[¶](#email "Link to this heading")

The new email API, enabled via the *policy* keyword to various constructors, is
no longer provisional. The [`email`](../library/email.html#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") documentation has been reorganized and
rewritten to focus on the new API, while retaining the old documentation for
the legacy API. (Contributed by R. David Murray in [bpo\-24277](https://bugs.python.org/issue?@action=redirect&bpo=24277).)

The [`email.mime`](../library/email.mime.html#module-email.mime "email.mime: Build MIME messages.") classes now all accept an optional *policy* keyword.
(Contributed by Berker Peksag in [bpo\-27331](https://bugs.python.org/issue?@action=redirect&bpo=27331).)

The [`DecodedGenerator`](../library/email.generator.html#email.generator.DecodedGenerator "email.generator.DecodedGenerator") now supports the *policy*
keyword.

There is a new [`policy`](../library/email.policy.html#module-email.policy "email.policy: Controlling the parsing and generating of messages") attribute,
[`message_factory`](../library/email.policy.html#email.policy.Policy.message_factory "email.policy.Policy.message_factory"), that controls what class is used
by default when the parser creates new message objects. For the
[`email.policy.compat32`](../library/email.policy.html#email.policy.compat32 "email.policy.compat32") policy this is [`Message`](../library/email.compat32-message.html#email.message.Message "email.message.Message"),
for the new policies it is [`EmailMessage`](../library/email.message.html#email.message.EmailMessage "email.message.EmailMessage").
(Contributed by R. David Murray in [bpo\-20476](https://bugs.python.org/issue?@action=redirect&bpo=20476).)

### encodings[¶](#encodings "Link to this heading")

On Windows, added the `'oem'` encoding to use `CP_OEMCP`, and the `'ansi'`
alias for the existing `'mbcs'` encoding, which uses the `CP_ACP` code page.
(Contributed by Steve Dower in [bpo\-27959](https://bugs.python.org/issue?@action=redirect&bpo=27959).)

### enum[¶](#enum "Link to this heading")

Two new enumeration base classes have been added to the [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class.") module:
[`Flag`](../library/enum.html#enum.Flag "enum.Flag") and `IntFlags`. Both are used to define
constants that can be combined using the bitwise operators.
(Contributed by Ethan Furman in [bpo\-23591](https://bugs.python.org/issue?@action=redirect&bpo=23591).)

Many standard library modules have been updated to use the
`IntFlags` class for their constants.

The new [`enum.auto`](../library/enum.html#enum.auto "enum.auto") value can be used to assign values to enum
members automatically:

\`\`\`
\>\>\> from enum import Enum, auto
\>\>\> class Color(Enum):
... red = auto()
... blue = auto()
... green = auto()
...
\>\>\> list(Color)
\[\, \, \]

\`\`\`

### faulthandler[¶](#faulthandler "Link to this heading")

On Windows, the [`faulthandler`](../library/faulthandler.html#module-faulthandler "faulthandler: Dump the Python traceback.") module now installs a handler for Windows
exceptions: see [`faulthandler.enable()`](../library/faulthandler.html#faulthandler.enable "faulthandler.enable"). (Contributed by Victor Stinner in
[bpo\-23848](https://bugs.python.org/issue?@action=redirect&bpo=23848).)

### fileinput[¶](#fileinput "Link to this heading")

[`hook_encoded()`](../library/fileinput.html#fileinput.hook_encoded "fileinput.hook_encoded") now supports the *errors* argument.
(Contributed by Joseph Hackman in [bpo\-25788](https://bugs.python.org/issue?@action=redirect&bpo=25788).)

### hashlib[¶](#hashlib "Link to this heading")

[`hashlib`](../library/hashlib.html#module-hashlib "hashlib: Secure hash and message digest algorithms.") supports OpenSSL 1\.1\.0\. The minimum recommend version is 1\.0\.2\.
(Contributed by Christian Heimes in [bpo\-26470](https://bugs.python.org/issue?@action=redirect&bpo=26470).)

BLAKE2 hash functions were added to the module. [`blake2b()`](../library/hashlib.html#hashlib.blake2b "hashlib.blake2b")
and [`blake2s()`](../library/hashlib.html#hashlib.blake2s "hashlib.blake2s") are always available and support the full
feature set of BLAKE2\.
(Contributed by Christian Heimes in [bpo\-26798](https://bugs.python.org/issue?@action=redirect&bpo=26798) based on code by
Dmitry Chestnykh and Samuel Neves. Documentation written by Dmitry Chestnykh.)

The SHA\-3 hash functions [`sha3_224()`](../library/hashlib.html#hashlib.sha3_224 "hashlib.sha3_224"), [`sha3_256()`](../library/hashlib.html#hashlib.sha3_256 "hashlib.sha3_256"),
[`sha3_384()`](../library/hashlib.html#hashlib.sha3_384 "hashlib.sha3_384"), [`sha3_512()`](../library/hashlib.html#hashlib.sha3_512 "hashlib.sha3_512"), and SHAKE hash functions
[`shake_128()`](../library/hashlib.html#hashlib.shake_128 "hashlib.shake_128") and [`shake_256()`](../library/hashlib.html#hashlib.shake_256 "hashlib.shake_256") were added.
(Contributed by Christian Heimes in [bpo\-16113](https://bugs.python.org/issue?@action=redirect&bpo=16113). Keccak Code Package
by Guido Bertoni, Joan Daemen, Michaël Peeters, Gilles Van Assche, and
Ronny Van Keer.)

The password\-based key derivation function [`scrypt()`](../library/hashlib.html#hashlib.scrypt "hashlib.scrypt") is now
available with OpenSSL 1\.1\.0 and newer.
(Contributed by Christian Heimes in [bpo\-27928](https://bugs.python.org/issue?@action=redirect&bpo=27928).)

### http.client[¶](#http-client "Link to this heading")

[`HTTPConnection.request()`](../library/http.client.html#http.client.HTTPConnection.request "http.client.HTTPConnection.request") and
[`endheaders()`](../library/http.client.html#http.client.HTTPConnection.endheaders "http.client.HTTPConnection.endheaders") both now support
chunked encoding request bodies.
(Contributed by Demian Brecht and Rolf Krahl in [bpo\-12319](https://bugs.python.org/issue?@action=redirect&bpo=12319).)

### idlelib and IDLE[¶](#idlelib-and-idle "Link to this heading")

The idlelib package is being modernized and refactored to make IDLE look and
work better and to make the code easier to understand, test, and improve. Part
of making IDLE look better, especially on Linux and Mac, is using ttk widgets,
mostly in the dialogs. As a result, IDLE no longer runs with tcl/tk 8\.4\. It
now requires tcl/tk 8\.5 or 8\.6\. We recommend running the latest release of
either.

‘Modernizing’ includes renaming and consolidation of idlelib modules. The
renaming of files with partial uppercase names is similar to the renaming of,
for instance, Tkinter and TkFont to tkinter and tkinter.font in 3\.0\. As a
result, imports of idlelib files that worked in 3\.5 will usually not work in
3\.6\. At least a module name change will be needed (see idlelib/README.txt),
sometimes more. (Name changes contributed by Al Swiegart and Terry Reedy in
[bpo\-24225](https://bugs.python.org/issue?@action=redirect&bpo=24225). Most idlelib patches since have been and will be part of the
process.)

In compensation, the eventual result with be that some idlelib classes will be
easier to use, with better APIs and docstrings explaining them. Additional
useful information will be added to idlelib when available.

New in 3\.6\.2:

Multiple fixes for autocompletion. (Contributed by Louie Lu in [bpo\-15786](https://bugs.python.org/issue?@action=redirect&bpo=15786).)

New in 3\.6\.3:

Module Browser (on the File menu, formerly called Class Browser),
now displays nested functions and classes in addition to top\-level
functions and classes.
(Contributed by Guilherme Polo, Cheryl Sabella, and Terry Jan Reedy
in [bpo\-1612262](https://bugs.python.org/issue?@action=redirect&bpo=1612262).)

The IDLE features formerly implemented as extensions have been reimplemented
as normal features. Their settings have been moved from the Extensions tab
to other dialog tabs.
(Contributed by Charles Wohlganger and Terry Jan Reedy in [bpo\-27099](https://bugs.python.org/issue?@action=redirect&bpo=27099).)

The Settings dialog (Options, Configure IDLE) has been partly rewritten
to improve both appearance and function.
(Contributed by Cheryl Sabella and Terry Jan Reedy in multiple issues.)

New in 3\.6\.4:

The font sample now includes a selection of non\-Latin characters so that
users can better see the effect of selecting a particular font.
(Contributed by Terry Jan Reedy in [bpo\-13802](https://bugs.python.org/issue?@action=redirect&bpo=13802).)
The sample can be edited to include other characters.
(Contributed by Serhiy Storchaka in [bpo\-31860](https://bugs.python.org/issue?@action=redirect&bpo=31860).)

New in 3\.6\.6:

Editor code context option revised. Box displays all context lines up to
maxlines. Clicking on a context line jumps the editor to that line. Context
colors for custom themes is added to Highlights tab of Settings dialog.
(Contributed by Cheryl Sabella and Terry Jan Reedy in [bpo\-33642](https://bugs.python.org/issue?@action=redirect&bpo=33642),
[bpo\-33768](https://bugs.python.org/issue?@action=redirect&bpo=33768), and [bpo\-33679](https://bugs.python.org/issue?@action=redirect&bpo=33679).)

On Windows, a new API call tells Windows that tk scales for DPI. On Windows
8\.1\+ or 10, with DPI compatibility properties of the Python binary
unchanged, and a monitor resolution greater than 96 DPI, this should
make text and lines sharper. It should otherwise have no effect.
(Contributed by Terry Jan Reedy in [bpo\-33656](https://bugs.python.org/issue?@action=redirect&bpo=33656).)

New in 3\.6\.7:

Output over N lines (50 by default) is squeezed down to a button.
N can be changed in the PyShell section of the General page of the
Settings dialog. Fewer, but possibly extra long, lines can be squeezed by
right clicking on the output. Squeezed output can be expanded in place
by double\-clicking the button or into the clipboard or a separate window
by right\-clicking the button. (Contributed by Tal Einat in [bpo\-1529353](https://bugs.python.org/issue?@action=redirect&bpo=1529353).)

### importlib[¶](#importlib "Link to this heading")

Import now raises the new exception [`ModuleNotFoundError`](../library/exceptions.html#ModuleNotFoundError "ModuleNotFoundError")
(subclass of [`ImportError`](../library/exceptions.html#ImportError "ImportError")) when it cannot find a module. Code
that current checks for `ImportError` (in try\-except) will still work.
(Contributed by Eric Snow in [bpo\-15767](https://bugs.python.org/issue?@action=redirect&bpo=15767).)

[`importlib.util.LazyLoader`](../library/importlib.html#importlib.util.LazyLoader "importlib.util.LazyLoader") now calls
[`create_module()`](../library/importlib.html#importlib.abc.Loader.create_module "importlib.abc.Loader.create_module") on the wrapped loader, removing the
restriction that [`importlib.machinery.BuiltinImporter`](../library/importlib.html#importlib.machinery.BuiltinImporter "importlib.machinery.BuiltinImporter") and
[`importlib.machinery.ExtensionFileLoader`](../library/importlib.html#importlib.machinery.ExtensionFileLoader "importlib.machinery.ExtensionFileLoader") couldn’t be used with
[`importlib.util.LazyLoader`](../library/importlib.html#importlib.util.LazyLoader "importlib.util.LazyLoader").

[`importlib.util.cache_from_source()`](../library/importlib.html#importlib.util.cache_from_source "importlib.util.cache_from_source"),
[`importlib.util.source_from_cache()`](../library/importlib.html#importlib.util.source_from_cache "importlib.util.source_from_cache"), and
[`importlib.util.spec_from_file_location()`](../library/importlib.html#importlib.util.spec_from_file_location "importlib.util.spec_from_file_location") now accept a
[path\-like object](../glossary.html#term-path-like-object).

### inspect[¶](#inspect "Link to this heading")

The [`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") function now reports the
implicit `.0` parameters generated by the compiler for comprehension and
generator expression scopes as if they were positional\-only parameters called
`implicit0`. (Contributed by Jelle Zijlstra in [bpo\-19611](https://bugs.python.org/issue?@action=redirect&bpo=19611).)

To reduce code churn when upgrading from Python 2\.7 and the legacy
`inspect.getargspec()` API, the previously documented deprecation of
[`inspect.getfullargspec()`](../library/inspect.html#inspect.getfullargspec "inspect.getfullargspec") has been reversed. While this function is
convenient for single/source Python 2/3 code bases, the richer
[`inspect.signature()`](../library/inspect.html#inspect.signature "inspect.signature") interface remains the recommended approach for new
code. (Contributed by Nick Coghlan in [bpo\-27172](https://bugs.python.org/issue?@action=redirect&bpo=27172))

### json[¶](#json "Link to this heading")

[`json.load()`](../library/json.html#json.load "json.load") and [`json.loads()`](../library/json.html#json.loads "json.loads") now support binary input. Encoded
JSON should be represented using either UTF\-8, UTF\-16, or UTF\-32\.
(Contributed by Serhiy Storchaka in [bpo\-17909](https://bugs.python.org/issue?@action=redirect&bpo=17909).)

### logging[¶](#logging "Link to this heading")

The new [`WatchedFileHandler.reopenIfNeeded()`](../library/logging.handlers.html#logging.handlers.WatchedFileHandler.reopenIfNeeded "logging.handlers.WatchedFileHandler.reopenIfNeeded")
method has been added to add the ability to check if the log file needs to
be reopened.
(Contributed by Marian Horban in [bpo\-24884](https://bugs.python.org/issue?@action=redirect&bpo=24884).)

### math[¶](#math "Link to this heading")

The tau (*τ*) constant has been added to the [`math`](../library/math.html#module-math "math: Mathematical functions (sin() etc.).") and [`cmath`](../library/cmath.html#module-cmath "cmath: Mathematical functions for complex numbers.")
modules.
(Contributed by Lisa Roach in [bpo\-12345](https://bugs.python.org/issue?@action=redirect&bpo=12345), see [**PEP 628**](https://peps.python.org/pep-0628/) for details.)

### multiprocessing[¶](#multiprocessing "Link to this heading")

[Proxy Objects](../library/multiprocessing.html#multiprocessing-proxy-objects) returned by
[`multiprocessing.Manager()`](../library/multiprocessing.html#multiprocessing.Manager "multiprocessing.Manager") can now be nested.
(Contributed by Davin Potts in [bpo\-6766](https://bugs.python.org/issue?@action=redirect&bpo=6766).)

### os[¶](#os "Link to this heading")

See the summary of [PEP 519](#whatsnew36-pep519) for details on how the
[`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") and [`os.path`](../library/os.path.html#module-os.path "os.path: Operations on pathnames.") modules now support
[path\-like objects](../glossary.html#term-path-like-object).

[`scandir()`](../library/os.html#os.scandir "os.scandir") now supports [`bytes`](../library/stdtypes.html#bytes "bytes") paths on Windows.

A new [`close()`](../library/os.html#os.scandir.close "os.scandir.close") method allows explicitly closing a
[`scandir()`](../library/os.html#os.scandir "os.scandir") iterator. The [`scandir()`](../library/os.html#os.scandir "os.scandir") iterator now
supports the [context manager](../glossary.html#term-context-manager) protocol. If a `scandir()`
iterator is neither exhausted nor explicitly closed a [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning")
will be emitted in its destructor.
(Contributed by Serhiy Storchaka in [bpo\-25994](https://bugs.python.org/issue?@action=redirect&bpo=25994).)

On Linux, [`os.urandom()`](../library/os.html#os.urandom "os.urandom") now blocks until the system urandom entropy pool
is initialized to increase the security. See the [**PEP 524**](https://peps.python.org/pep-0524/) for the rationale.

The Linux `getrandom()` syscall (get random bytes) is now exposed as the new
[`os.getrandom()`](../library/os.html#os.getrandom "os.getrandom") function.
(Contributed by Victor Stinner, part of the [**PEP 524**](https://peps.python.org/pep-0524/))

### pathlib[¶](#pathlib "Link to this heading")

[`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths") now supports [path\-like objects](../glossary.html#term-path-like-object).
(Contributed by Brett Cannon in [bpo\-27186](https://bugs.python.org/issue?@action=redirect&bpo=27186).)

See the summary of [PEP 519](#whatsnew36-pep519) for details.

### pdb[¶](#pdb "Link to this heading")

The [`Pdb`](../library/pdb.html#pdb.Pdb "pdb.Pdb") class constructor has a new optional *readrc* argument
to control whether `.pdbrc` files should be read.

### pickle[¶](#pickle "Link to this heading")

Objects that need `__new__` called with keyword arguments can now be pickled
using [pickle protocols](../library/pickle.html#pickle-protocols) older than protocol version 4\.
Protocol version 4 already supports this case. (Contributed by Serhiy
Storchaka in [bpo\-24164](https://bugs.python.org/issue?@action=redirect&bpo=24164).)

### pickletools[¶](#pickletools "Link to this heading")

[`pickletools.dis()`](../library/pickletools.html#pickletools.dis "pickletools.dis") now outputs the implicit memo index for the
`MEMOIZE` opcode.
(Contributed by Serhiy Storchaka in [bpo\-25382](https://bugs.python.org/issue?@action=redirect&bpo=25382).)

### pydoc[¶](#pydoc "Link to this heading")

The [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") module has learned to respect the `MANPAGER`
environment variable.
(Contributed by Matthias Klose in [bpo\-8637](https://bugs.python.org/issue?@action=redirect&bpo=8637).)

[`help()`](../library/functions.html#help "help") and [`pydoc`](../library/pydoc.html#module-pydoc "pydoc: Documentation generator and online help system.") can now list named tuple fields in the
order they were defined rather than alphabetically.
(Contributed by Raymond Hettinger in [bpo\-24879](https://bugs.python.org/issue?@action=redirect&bpo=24879).)

### random[¶](#random "Link to this heading")

The new [`choices()`](../library/random.html#random.choices "random.choices") function returns a list of elements of
specified size from the given population with optional weights.
(Contributed by Raymond Hettinger in [bpo\-18844](https://bugs.python.org/issue?@action=redirect&bpo=18844).)

### re[¶](#re "Link to this heading")

Added support of modifier spans in regular expressions. Examples:
`'(?i:p)ython'` matches `'python'` and `'Python'`, but not `'PYTHON'`;
`'(?i)g(?-i:v)r'` matches `'GvR'` and `'gvr'`, but not `'GVR'`.
(Contributed by Serhiy Storchaka in [bpo\-433028](https://bugs.python.org/issue?@action=redirect&bpo=433028).)

Match object groups can be accessed by `__getitem__`, which is
equivalent to `group()`. So `mo['name']` is now equivalent to
`mo.group('name')`. (Contributed by Eric Smith in [bpo\-24454](https://bugs.python.org/issue?@action=redirect&bpo=24454).)

[`Match`](../library/re.html#re.Match "re.Match") objects now support
[`index-like objects`](../reference/datamodel.html#object.__index__ "object.__index__") as group
indices.
(Contributed by Jeroen Demeyer and Xiang Zhang in [bpo\-27177](https://bugs.python.org/issue?@action=redirect&bpo=27177).)

### readline[¶](#readline "Link to this heading")

Added [`set_auto_history()`](../library/readline.html#readline.set_auto_history "readline.set_auto_history") to enable or disable
automatic addition of input to the history list. (Contributed by
Tyler Crompton in [bpo\-26870](https://bugs.python.org/issue?@action=redirect&bpo=26870).)

### rlcompleter[¶](#rlcompleter "Link to this heading")

Private and special attribute names now are omitted unless the prefix starts
with underscores. A space or a colon is added after some completed keywords.
(Contributed by Serhiy Storchaka in [bpo\-25011](https://bugs.python.org/issue?@action=redirect&bpo=25011) and [bpo\-25209](https://bugs.python.org/issue?@action=redirect&bpo=25209).)

### shlex[¶](#shlex "Link to this heading")

The [`shlex`](../library/shlex.html#shlex.shlex "shlex.shlex") has much
[improved shell compatibility](../library/shlex.html#improved-shell-compatibility)
through the new *punctuation\_chars* argument to control which characters
are treated as punctuation.
(Contributed by Vinay Sajip in [bpo\-1521950](https://bugs.python.org/issue?@action=redirect&bpo=1521950).)

### site[¶](#site "Link to this heading")

When specifying paths to add to [`sys.path`](../library/sys.html#sys.path "sys.path") in a `.pth` file,
you may now specify file paths on top of directories (e.g. zip files).
(Contributed by Wolfgang Langner in [bpo\-26587](https://bugs.python.org/issue?@action=redirect&bpo=26587)).

### sqlite3[¶](#sqlite3 "Link to this heading")

[`sqlite3.Cursor.lastrowid`](../library/sqlite3.html#sqlite3.Cursor.lastrowid "sqlite3.Cursor.lastrowid") now supports the `REPLACE` statement.
(Contributed by Alex LordThorsen in [bpo\-16864](https://bugs.python.org/issue?@action=redirect&bpo=16864).)

### socket[¶](#socket "Link to this heading")

The [`ioctl()`](../library/socket.html#socket.socket.ioctl "socket.socket.ioctl") function now supports the
[`SIO_LOOPBACK_FAST_PATH`](../library/socket.html#socket.SIO_LOOPBACK_FAST_PATH "socket.SIO_LOOPBACK_FAST_PATH") control code.
(Contributed by Daniel Stokes in [bpo\-26536](https://bugs.python.org/issue?@action=redirect&bpo=26536).)

The [`getsockopt()`](../library/socket.html#socket.socket.getsockopt "socket.socket.getsockopt") constants `SO_DOMAIN`,
`SO_PROTOCOL`, `SO_PEERSEC`, and `SO_PASSSEC` are now supported.
(Contributed by Christian Heimes in [bpo\-26907](https://bugs.python.org/issue?@action=redirect&bpo=26907).)

The [`setsockopt()`](../library/socket.html#socket.socket.setsockopt "socket.socket.setsockopt") now supports the
`setsockopt(level, optname, None, optlen: int)` form.
(Contributed by Christian Heimes in [bpo\-27744](https://bugs.python.org/issue?@action=redirect&bpo=27744).)

The socket module now supports the address family
[`AF_ALG`](../library/socket.html#socket.AF_ALG "socket.AF_ALG") to interface with Linux Kernel crypto API. `ALG_*`,
`SOL_ALG` and [`sendmsg_afalg()`](../library/socket.html#socket.socket.sendmsg_afalg "socket.socket.sendmsg_afalg") were added.
(Contributed by Christian Heimes in [bpo\-27744](https://bugs.python.org/issue?@action=redirect&bpo=27744) with support from
Victor Stinner.)

New Linux constants `TCP_USER_TIMEOUT` and `TCP_CONGESTION` were added.
(Contributed by Omar Sandoval, [bpo\-26273](https://bugs.python.org/issue?@action=redirect&bpo=26273)).

### socketserver[¶](#socketserver "Link to this heading")

Servers based on the [`socketserver`](../library/socketserver.html#module-socketserver "socketserver: A framework for network servers.") module, including those
defined in [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers."), [`xmlrpc.server`](../library/xmlrpc.server.html#module-xmlrpc.server "xmlrpc.server: Basic XML-RPC server implementations.") and
[`wsgiref.simple_server`](../library/wsgiref.html#module-wsgiref.simple_server "wsgiref.simple_server: A simple WSGI HTTP server."), now support the [context manager](../glossary.html#term-context-manager)
protocol.
(Contributed by Aviv Palivoda in [bpo\-26404](https://bugs.python.org/issue?@action=redirect&bpo=26404).)

The `wfile` attribute of
[`StreamRequestHandler`](../library/socketserver.html#socketserver.StreamRequestHandler "socketserver.StreamRequestHandler") classes now implements
the [`io.BufferedIOBase`](../library/io.html#io.BufferedIOBase "io.BufferedIOBase") writable interface. In particular,
calling [`write()`](../library/io.html#io.BufferedIOBase.write "io.BufferedIOBase.write") is now guaranteed to send the
data in full. (Contributed by Martin Panter in [bpo\-26721](https://bugs.python.org/issue?@action=redirect&bpo=26721).)

### ssl[¶](#ssl "Link to this heading")

[`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") supports OpenSSL 1\.1\.0\. The minimum recommend version is 1\.0\.2\.
(Contributed by Christian Heimes in [bpo\-26470](https://bugs.python.org/issue?@action=redirect&bpo=26470).)

3DES has been removed from the default cipher suites and ChaCha20 Poly1305
cipher suites have been added.
(Contributed by Christian Heimes in [bpo\-27850](https://bugs.python.org/issue?@action=redirect&bpo=27850) and [bpo\-27766](https://bugs.python.org/issue?@action=redirect&bpo=27766).)

[`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") has better default configuration for options
and ciphers.
(Contributed by Christian Heimes in [bpo\-28043](https://bugs.python.org/issue?@action=redirect&bpo=28043).)

SSL session can be copied from one client\-side connection to another
with the new [`SSLSession`](../library/ssl.html#ssl.SSLSession "ssl.SSLSession") class. TLS session resumption can
speed up the initial handshake, reduce latency and improve performance
(Contributed by Christian Heimes in [bpo\-19500](https://bugs.python.org/issue?@action=redirect&bpo=19500) based on a draft by
Alex Warhawk.)

The new [`get_ciphers()`](../library/ssl.html#ssl.SSLContext.get_ciphers "ssl.SSLContext.get_ciphers") method can be used to
get a list of enabled ciphers in order of cipher priority.

All constants and flags have been converted to [`IntEnum`](../library/enum.html#enum.IntEnum "enum.IntEnum") and
`IntFlags`.
(Contributed by Christian Heimes in [bpo\-28025](https://bugs.python.org/issue?@action=redirect&bpo=28025).)

Server and client\-side specific TLS protocols for [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext")
were added.
(Contributed by Christian Heimes in [bpo\-28085](https://bugs.python.org/issue?@action=redirect&bpo=28085).)

Added [`ssl.SSLContext.post_handshake_auth`](../library/ssl.html#ssl.SSLContext.post_handshake_auth "ssl.SSLContext.post_handshake_auth") to enable and
[`ssl.SSLSocket.verify_client_post_handshake()`](../library/ssl.html#ssl.SSLSocket.verify_client_post_handshake "ssl.SSLSocket.verify_client_post_handshake") to initiate TLS 1\.3
post\-handshake authentication.
(Contributed by Christian Heimes in [gh\-78851](https://github.com/python/cpython/issues/78851).)

### statistics[¶](#statistics "Link to this heading")

A new [`harmonic_mean()`](../library/statistics.html#statistics.harmonic_mean "statistics.harmonic_mean") function has been added.
(Contributed by Steven D’Aprano in [bpo\-27181](https://bugs.python.org/issue?@action=redirect&bpo=27181).)

### struct[¶](#struct "Link to this heading")

[`struct`](../library/struct.html#module-struct "struct: Interpret bytes as packed binary data.") now supports IEEE 754 half\-precision floats via the `'e'`
format specifier.
(Contributed by Eli Stevens, Mark Dickinson in [bpo\-11734](https://bugs.python.org/issue?@action=redirect&bpo=11734).)

### subprocess[¶](#subprocess "Link to this heading")

[`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") destructor now emits a [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning") warning
if the child process is still running. Use the context manager protocol (`with
proc: ...`) or explicitly call the [`wait()`](../library/subprocess.html#subprocess.Popen.wait "subprocess.Popen.wait") method to
read the exit status of the child process. (Contributed by Victor Stinner in
[bpo\-26741](https://bugs.python.org/issue?@action=redirect&bpo=26741).)

The [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") constructor and all functions that pass arguments
through to it now accept *encoding* and *errors* arguments. Specifying either
of these will enable text mode for the *stdin*, *stdout* and *stderr* streams.
(Contributed by Steve Dower in [bpo\-6135](https://bugs.python.org/issue?@action=redirect&bpo=6135).)

### sys[¶](#sys "Link to this heading")

The new [`getfilesystemencodeerrors()`](../library/sys.html#sys.getfilesystemencodeerrors "sys.getfilesystemencodeerrors") function returns the name of
the error mode used to convert between Unicode filenames and bytes filenames.
(Contributed by Steve Dower in [bpo\-27781](https://bugs.python.org/issue?@action=redirect&bpo=27781).)

On Windows the return value of the [`getwindowsversion()`](../library/sys.html#sys.getwindowsversion "sys.getwindowsversion") function
now includes the *platform\_version* field which contains the accurate major
version, minor version and build number of the current operating system,
rather than the version that is being emulated for the process
(Contributed by Steve Dower in [bpo\-27932](https://bugs.python.org/issue?@action=redirect&bpo=27932).)

### telnetlib[¶](#telnetlib "Link to this heading")

`telnetlib.Telnet` is now a context manager (contributed by
Stéphane Wirtel in [bpo\-25485](https://bugs.python.org/issue?@action=redirect&bpo=25485)).

### time[¶](#time "Link to this heading")

The [`struct_time`](../library/time.html#time.struct_time "time.struct_time") attributes `tm_gmtoff` and
`tm_zone` are now available on all platforms.

### timeit[¶](#timeit "Link to this heading")

The new [`Timer.autorange()`](../library/timeit.html#timeit.Timer.autorange "timeit.Timer.autorange") convenience
method has been added to call [`Timer.timeit()`](../library/timeit.html#timeit.Timer.timeit "timeit.Timer.timeit")
repeatedly so that the total run time is greater or equal to 200 milliseconds.
(Contributed by Steven D’Aprano in [bpo\-6422](https://bugs.python.org/issue?@action=redirect&bpo=6422).)

[`timeit`](../library/timeit.html#module-timeit "timeit: Measure the execution time of small code snippets.") now warns when there is substantial (4x) variance
between best and worst times.
(Contributed by Serhiy Storchaka in [bpo\-23552](https://bugs.python.org/issue?@action=redirect&bpo=23552).)

### tkinter[¶](#tkinter "Link to this heading")

Added methods `trace_add()`,
`trace_remove()` and `trace_info()`
in the `tkinter.Variable` class. They replace old methods
`trace_variable()`, `trace()`,
`trace_vdelete()` and
`trace_vinfo()` that use obsolete Tcl commands and might
not work in future versions of Tcl.
(Contributed by Serhiy Storchaka in [bpo\-22115](https://bugs.python.org/issue?@action=redirect&bpo=22115)).

### traceback[¶](#traceback "Link to this heading")

Both the traceback module and the interpreter’s builtin exception display now
abbreviate long sequences of repeated lines in tracebacks as shown in the
following example:

\`\`\`
\>\>\> def f(): f()
...
\>\>\> f()
Traceback (most recent call last):
 File "\", line 1, in \
 File "\", line 1, in f
 File "\", line 1, in f
 File "\", line 1, in f
 \[Previous line repeated 995 more times]
RecursionError: maximum recursion depth exceeded

\`\`\`

(Contributed by Emanuel Barry in [bpo\-26823](https://bugs.python.org/issue?@action=redirect&bpo=26823).)

### tracemalloc[¶](#tracemalloc "Link to this heading")

The [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") module now supports tracing memory allocations in
multiple different address spaces.

The new [`DomainFilter`](../library/tracemalloc.html#tracemalloc.DomainFilter "tracemalloc.DomainFilter") filter class has been added
to filter block traces by their address space (domain).

(Contributed by Victor Stinner in [bpo\-26588](https://bugs.python.org/issue?@action=redirect&bpo=26588).)

### typing[¶](#typing "Link to this heading")

Since the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module is [provisional](../glossary.html#term-provisional-API),
all changes introduced in Python 3\.6 have also been
backported to Python 3\.5\.x.

The [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module has a much improved support for generic type
aliases. For example `Dict[str, Tuple[S, T]]` is now a valid
type annotation.
(Contributed by Guido van Rossum in [Github \#195](https://github.com/python/typing/pull/195).)

The [`typing.ContextManager`](../library/typing.html#typing.ContextManager "typing.ContextManager") class has been added for
representing [`contextlib.AbstractContextManager`](../library/contextlib.html#contextlib.AbstractContextManager "contextlib.AbstractContextManager").
(Contributed by Brett Cannon in [bpo\-25609](https://bugs.python.org/issue?@action=redirect&bpo=25609).)

The [`typing.Collection`](../library/typing.html#typing.Collection "typing.Collection") class has been added for
representing [`collections.abc.Collection`](../library/collections.abc.html#collections.abc.Collection "collections.abc.Collection").
(Contributed by Ivan Levkivskyi in [bpo\-27598](https://bugs.python.org/issue?@action=redirect&bpo=27598).)

The [`typing.ClassVar`](../library/typing.html#typing.ClassVar "typing.ClassVar") type construct has been added to
mark class variables. As introduced in [**PEP 526**](https://peps.python.org/pep-0526/), a variable annotation
wrapped in ClassVar indicates that a given attribute is intended to be used as
a class variable and should not be set on instances of that class.
(Contributed by Ivan Levkivskyi in [Github \#280](https://github.com/python/typing/pull/280).)

A new [`TYPE_CHECKING`](../library/typing.html#typing.TYPE_CHECKING "typing.TYPE_CHECKING") constant that is assumed to be
`True` by the static type checkers, but is `False` at runtime.
(Contributed by Guido van Rossum in [Github \#230](https://github.com/python/typing/issues/230).)

A new [`NewType()`](../library/typing.html#typing.NewType "typing.NewType") helper function has been added to create
lightweight distinct types for annotations:

\`\`\`
from typing import NewType

UserId = NewType('UserId', int)
some\_id = UserId(524313\)

\`\`\`

The static type checker will treat the new type as if it were a subclass
of the original type. (Contributed by Ivan Levkivskyi in [Github \#189](https://github.com/python/typing/issues/189).)

### unicodedata[¶](#unicodedata "Link to this heading")

The [`unicodedata`](../library/unicodedata.html#module-unicodedata "unicodedata: Access the Unicode Database.") module now uses data from [Unicode 9\.0\.0](https://unicode.org/versions/Unicode9.0.0/).
(Contributed by Benjamin Peterson.)

### unittest.mock[¶](#unittest-mock "Link to this heading")

The [`Mock`](../library/unittest.mock.html#unittest.mock.Mock "unittest.mock.Mock") class has the following improvements:

* Two new methods, [`Mock.assert_called()`](../library/unittest.mock.html#unittest.mock.Mock.assert_called "unittest.mock.Mock.assert_called") and [`Mock.assert_called_once()`](../library/unittest.mock.html#unittest.mock.Mock.assert_called_once "unittest.mock.Mock.assert_called_once") to check if the mock object
was called.
(Contributed by Amit Saha in [bpo\-26323](https://bugs.python.org/issue?@action=redirect&bpo=26323).)
* The [`Mock.reset_mock()`](../library/unittest.mock.html#unittest.mock.Mock.reset_mock "unittest.mock.Mock.reset_mock") method
now has two optional keyword only arguments: *return\_value* and
*side\_effect*.
(Contributed by Kushal Das in [bpo\-21271](https://bugs.python.org/issue?@action=redirect&bpo=21271).)

### urllib.request[¶](#urllib-request "Link to this heading")

If a HTTP request has a file or iterable body (other than a
bytes object) but no `Content-Length` header, rather than
throwing an error, `AbstractHTTPHandler` now
falls back to use chunked transfer encoding.
(Contributed by Demian Brecht and Rolf Krahl in [bpo\-12319](https://bugs.python.org/issue?@action=redirect&bpo=12319).)

### urllib.robotparser[¶](#urllib-robotparser "Link to this heading")

[`RobotFileParser`](../library/urllib.robotparser.html#urllib.robotparser.RobotFileParser "urllib.robotparser.RobotFileParser") now supports the `Crawl-delay` and
`Request-rate` extensions.
(Contributed by Nikolay Bogoychev in [bpo\-16099](https://bugs.python.org/issue?@action=redirect&bpo=16099).)

### venv[¶](#venv "Link to this heading")

[`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") accepts a new parameter `--prompt`. This parameter provides an
alternative prefix for the virtual environment. (Proposed by Łukasz Balcerzak
and ported to 3\.6 by Stéphane Wirtel in [bpo\-22829](https://bugs.python.org/issue?@action=redirect&bpo=22829).)

### warnings[¶](#warnings "Link to this heading")

A new optional *source* parameter has been added to the
[`warnings.warn_explicit()`](../library/warnings.html#warnings.warn_explicit "warnings.warn_explicit") function: the destroyed object which emitted a
[`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning"). A *source* attribute has also been added to
`warnings.WarningMessage` (contributed by Victor Stinner in
[bpo\-26568](https://bugs.python.org/issue?@action=redirect&bpo=26568) and [bpo\-26567](https://bugs.python.org/issue?@action=redirect&bpo=26567)).

When a [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning") warning is logged, the [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") module is now
used to try to retrieve the traceback where the destroyed object was allocated.

Example with the script `example.py`:

\`\`\`
import warnings

def func():
 return open(\_\_file\_\_)

f = func()
f = None

\`\`\`

Output of the command `python3.6 -Wd -X tracemalloc=5 example.py`:

\`\`\`
example.py:7: ResourceWarning: unclosed file \
 f = None
Object allocated at (most recent call first):
 File "example.py", lineno 4
 return open(\_\_file\_\_)
 File "example.py", lineno 6
 f = func()

\`\`\`

The “Object allocated at” traceback is new and is only displayed if
[`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") is tracing Python memory allocations and if the
[`warnings`](../library/warnings.html#module-warnings "warnings: Issue warning messages and control their disposition.") module was already imported.

### winreg[¶](#winreg "Link to this heading")

Added the 64\-bit integer type [`REG_QWORD`](../library/winreg.html#winreg.REG_QWORD "winreg.REG_QWORD").
(Contributed by Clement Rouault in [bpo\-23026](https://bugs.python.org/issue?@action=redirect&bpo=23026).)

### winsound[¶](#winsound "Link to this heading")

Allowed keyword arguments to be passed to [`Beep`](../library/winsound.html#winsound.Beep "winsound.Beep"),
[`MessageBeep`](../library/winsound.html#winsound.MessageBeep "winsound.MessageBeep"), and [`PlaySound`](../library/winsound.html#winsound.PlaySound "winsound.PlaySound") ([bpo\-27982](https://bugs.python.org/issue?@action=redirect&bpo=27982)).

### xmlrpc.client[¶](#xmlrpc-client "Link to this heading")

The [`xmlrpc.client`](../library/xmlrpc.client.html#module-xmlrpc.client "xmlrpc.client: XML-RPC client access.") module now supports unmarshalling
additional data types used by the Apache XML\-RPC implementation
for numerics and `None`.
(Contributed by Serhiy Storchaka in [bpo\-26885](https://bugs.python.org/issue?@action=redirect&bpo=26885).)

### zipfile[¶](#zipfile "Link to this heading")

A new [`ZipInfo.from_file()`](../library/zipfile.html#zipfile.ZipInfo.from_file "zipfile.ZipInfo.from_file") class method
allows making a [`ZipInfo`](../library/zipfile.html#zipfile.ZipInfo "zipfile.ZipInfo") instance from a filesystem file.
A new [`ZipInfo.is_dir()`](../library/zipfile.html#zipfile.ZipInfo.is_dir "zipfile.ZipInfo.is_dir") method can be used
to check if the [`ZipInfo`](../library/zipfile.html#zipfile.ZipInfo "zipfile.ZipInfo") instance represents a directory.
(Contributed by Thomas Kluyver in [bpo\-26039](https://bugs.python.org/issue?@action=redirect&bpo=26039).)

The [`ZipFile.open()`](../library/zipfile.html#zipfile.ZipFile.open "zipfile.ZipFile.open") method can now be used to
write data into a ZIP file, as well as for extracting data.
(Contributed by Thomas Kluyver in [bpo\-26039](https://bugs.python.org/issue?@action=redirect&bpo=26039).)

### zlib[¶](#zlib "Link to this heading")

The [`compress()`](../library/zlib.html#zlib.compress "zlib.compress") and [`decompress()`](../library/zlib.html#zlib.decompress "zlib.decompress") functions now accept
keyword arguments.
(Contributed by Aviv Palivoda in [bpo\-26243](https://bugs.python.org/issue?@action=redirect&bpo=26243) and
Xiang Zhang in [bpo\-16764](https://bugs.python.org/issue?@action=redirect&bpo=16764) respectively.)

## Optimizations[¶](#optimizations "Link to this heading")

* The Python interpreter now uses a 16\-bit wordcode instead of bytecode which
made a number of opcode optimizations possible.
(Contributed by Demur Rumed with input and reviews from
Serhiy Storchaka and Victor Stinner in [bpo\-26647](https://bugs.python.org/issue?@action=redirect&bpo=26647) and [bpo\-28050](https://bugs.python.org/issue?@action=redirect&bpo=28050).)
* The [`asyncio.Future`](../library/asyncio-future.html#asyncio.Future "asyncio.Future") class now has an optimized C implementation.
(Contributed by Yury Selivanov and INADA Naoki in [bpo\-26081](https://bugs.python.org/issue?@action=redirect&bpo=26081).)
* The [`asyncio.Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task") class now has an optimized
C implementation. (Contributed by Yury Selivanov in [bpo\-28544](https://bugs.python.org/issue?@action=redirect&bpo=28544).)
* Various implementation improvements in the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module
(such as caching of generic types) allow up to 30 times performance
improvements and reduced memory footprint.
* The ASCII decoder is now up to 60 times as fast for error handlers
`surrogateescape`, `ignore` and `replace` (Contributed
by Victor Stinner in [bpo\-24870](https://bugs.python.org/issue?@action=redirect&bpo=24870)).
* The ASCII and the Latin1 encoders are now up to 3 times as fast for the
error handler `surrogateescape`
(Contributed by Victor Stinner in [bpo\-25227](https://bugs.python.org/issue?@action=redirect&bpo=25227)).
* The UTF\-8 encoder is now up to 75 times as fast for error handlers
`ignore`, `replace`, `surrogateescape`, `surrogatepass` (Contributed
by Victor Stinner in [bpo\-25267](https://bugs.python.org/issue?@action=redirect&bpo=25267)).
* The UTF\-8 decoder is now up to 15 times as fast for error handlers
`ignore`, `replace` and `surrogateescape` (Contributed
by Victor Stinner in [bpo\-25301](https://bugs.python.org/issue?@action=redirect&bpo=25301)).
* `bytes % args` is now up to 2 times faster. (Contributed by Victor Stinner
in [bpo\-25349](https://bugs.python.org/issue?@action=redirect&bpo=25349)).
* `bytearray % args` is now between 2\.5 and 5 times faster. (Contributed by
Victor Stinner in [bpo\-25399](https://bugs.python.org/issue?@action=redirect&bpo=25399)).
* Optimize [`bytes.fromhex()`](../library/stdtypes.html#bytes.fromhex "bytes.fromhex") and [`bytearray.fromhex()`](../library/stdtypes.html#bytearray.fromhex "bytearray.fromhex"): they are now
between 2x and 3\.5x faster. (Contributed by Victor Stinner in [bpo\-25401](https://bugs.python.org/issue?@action=redirect&bpo=25401)).
* Optimize `bytes.replace(b'', b'.')` and `bytearray.replace(b'', b'.')`:
up to 80% faster. (Contributed by Josh Snider in [bpo\-26574](https://bugs.python.org/issue?@action=redirect&bpo=26574)).
* Allocator functions of the [`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc") domain
([`PYMEM_DOMAIN_MEM`](../c-api/memory.html#c.PYMEM_DOMAIN_MEM "PYMEM_DOMAIN_MEM")) now use the [pymalloc memory allocator](../c-api/memory.html#pymalloc) instead of `malloc()` function of the C library. The
pymalloc allocator is optimized for objects smaller or equal to 512 bytes
with a short lifetime, and use `malloc()` for larger memory blocks.
(Contributed by Victor Stinner in [bpo\-26249](https://bugs.python.org/issue?@action=redirect&bpo=26249)).
* [`pickle.load()`](../library/pickle.html#pickle.load "pickle.load") and [`pickle.loads()`](../library/pickle.html#pickle.loads "pickle.loads") are now up to 10% faster when
deserializing many small objects (Contributed by Victor Stinner in
[bpo\-27056](https://bugs.python.org/issue?@action=redirect&bpo=27056)).
* Passing [keyword arguments](../glossary.html#term-keyword-argument) to a function has an
overhead in comparison with passing [positional arguments](../glossary.html#term-positional-argument). Now in extension functions implemented with using
Argument Clinic this overhead is significantly decreased.
(Contributed by Serhiy Storchaka in [bpo\-27574](https://bugs.python.org/issue?@action=redirect&bpo=27574)).
* Optimized [`glob()`](../library/glob.html#glob.glob "glob.glob") and [`iglob()`](../library/glob.html#glob.iglob "glob.iglob") functions in the
[`glob`](../library/glob.html#module-glob "glob: Unix shell style pathname pattern expansion.") module; they are now about 3–6 times faster.
(Contributed by Serhiy Storchaka in [bpo\-25596](https://bugs.python.org/issue?@action=redirect&bpo=25596)).
* Optimized globbing in [`pathlib`](../library/pathlib.html#module-pathlib "pathlib: Object-oriented filesystem paths") by using [`os.scandir()`](../library/os.html#os.scandir "os.scandir");
it is now about 1\.5–4 times faster.
(Contributed by Serhiy Storchaka in [bpo\-26032](https://bugs.python.org/issue?@action=redirect&bpo=26032)).
* [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") parsing, iteration and deepcopy performance
has been significantly improved.
(Contributed by Serhiy Storchaka in [bpo\-25638](https://bugs.python.org/issue?@action=redirect&bpo=25638), [bpo\-25873](https://bugs.python.org/issue?@action=redirect&bpo=25873),
and [bpo\-25869](https://bugs.python.org/issue?@action=redirect&bpo=25869).)
* Creation of [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") instances from floats and
decimals is now 2 to 3 times faster.
(Contributed by Serhiy Storchaka in [bpo\-25971](https://bugs.python.org/issue?@action=redirect&bpo=25971).)

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

* Python now requires some C99 support in the toolchain to build.
Most notably, Python now uses standard integer types and macros in
place of custom macros like `PY_LONG_LONG`.
For more information, see [**PEP 7**](https://peps.python.org/pep-0007/) and [bpo\-17884](https://bugs.python.org/issue?@action=redirect&bpo=17884).
* Cross\-compiling CPython with the Android NDK and the Android API level set to
21 (Android 5\.0 Lollipop) or greater runs successfully. While Android is not
yet a supported platform, the Python test suite runs on the Android emulator
with only about 16 tests failures. See the Android meta\-issue [bpo\-26865](https://bugs.python.org/issue?@action=redirect&bpo=26865).
* The `--enable-optimizations` configure flag has been added. Turning it on
will activate expensive optimizations like PGO.
(Original patch by Alecsandru Patrascu of Intel in [bpo\-26359](https://bugs.python.org/issue?@action=redirect&bpo=26359).)
* The [GIL](../glossary.html#term-global-interpreter-lock) must now be held when allocator
functions of [`PYMEM_DOMAIN_OBJ`](../c-api/memory.html#c.PYMEM_DOMAIN_OBJ "PYMEM_DOMAIN_OBJ") (ex: [`PyObject_Malloc()`](../c-api/memory.html#c.PyObject_Malloc "PyObject_Malloc")) and
[`PYMEM_DOMAIN_MEM`](../c-api/memory.html#c.PYMEM_DOMAIN_MEM "PYMEM_DOMAIN_MEM") (ex: [`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc")) domains are called.
* New [`Py_FinalizeEx()`](../c-api/init.html#c.Py_FinalizeEx "Py_FinalizeEx") API which indicates if flushing buffered data
failed.
(Contributed by Martin Panter in [bpo\-5319](https://bugs.python.org/issue?@action=redirect&bpo=5319).)
* [`PyArg_ParseTupleAndKeywords()`](../c-api/arg.html#c.PyArg_ParseTupleAndKeywords "PyArg_ParseTupleAndKeywords") now supports [positional\-only
parameters](../glossary.html#positional-only-parameter). Positional\-only parameters are
defined by empty names.
(Contributed by Serhiy Storchaka in [bpo\-26282](https://bugs.python.org/issue?@action=redirect&bpo=26282)).
* `PyTraceback_Print` method now abbreviates long sequences of repeated lines
as `"[Previous line repeated {count} more times]"`.
(Contributed by Emanuel Barry in [bpo\-26823](https://bugs.python.org/issue?@action=redirect&bpo=26823).)
* The new [`PyErr_SetImportErrorSubclass()`](../c-api/exceptions.html#c.PyErr_SetImportErrorSubclass "PyErr_SetImportErrorSubclass") function allows for
specifying a subclass of [`ImportError`](../library/exceptions.html#ImportError "ImportError") to raise.
(Contributed by Eric Snow in [bpo\-15767](https://bugs.python.org/issue?@action=redirect&bpo=15767).)
* The new [`PyErr_ResourceWarning()`](../c-api/exceptions.html#c.PyErr_ResourceWarning "PyErr_ResourceWarning") function can be used to generate
a [`ResourceWarning`](../library/exceptions.html#ResourceWarning "ResourceWarning") providing the source of the resource allocation.
(Contributed by Victor Stinner in [bpo\-26567](https://bugs.python.org/issue?@action=redirect&bpo=26567).)
* The new [`PyOS_FSPath()`](../c-api/sys.html#c.PyOS_FSPath "PyOS_FSPath") function returns the file system
representation of a [path\-like object](../glossary.html#term-path-like-object).
(Contributed by Brett Cannon in [bpo\-27186](https://bugs.python.org/issue?@action=redirect&bpo=27186).)
* The [`PyUnicode_FSConverter()`](../c-api/unicode.html#c.PyUnicode_FSConverter "PyUnicode_FSConverter") and [`PyUnicode_FSDecoder()`](../c-api/unicode.html#c.PyUnicode_FSDecoder "PyUnicode_FSDecoder")
functions will now accept [path\-like objects](../glossary.html#term-path-like-object).

## Other Improvements[¶](#other-improvements "Link to this heading")

* When [`--version`](../using/cmdline.html#cmdoption-version) (short form: [`-V`](../using/cmdline.html#cmdoption-V)) is supplied twice,
Python prints [`sys.version`](../library/sys.html#sys.version "sys.version") for detailed information.

\`\`\`
$ ./python \-VV
Python 3\.6\.0b4\+ (3\.6:223967b49e49\+, Nov 21 2016, 20:55:04\)
\[GCC 4\.2\.1 Compatible Apple LLVM 8\.0\.0 (clang\-800\.0\.42\.1\)]

\`\`\`

## Deprecated[¶](#deprecated "Link to this heading")

### New Keywords[¶](#new-keywords "Link to this heading")

`async` and `await` are not recommended to be used as variable, class,
function or module names. Introduced by [**PEP 492**](https://peps.python.org/pep-0492/) in Python 3\.5, they will
become proper keywords in Python 3\.7\. Starting in Python 3\.6, the use of
`async` or `await` as names will generate a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").

### Deprecated Python behavior[¶](#deprecated-python-behavior "Link to this heading")

Raising the [`StopIteration`](../library/exceptions.html#StopIteration "StopIteration") exception inside a generator will now
generate a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"), and will trigger a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError")
in Python 3\.7\. See [PEP 479: Change StopIteration handling inside generators](3.5.html#whatsnew-pep-479) for details.

The `__aiter__()` method is now expected to return an asynchronous
iterator directly instead of returning an awaitable as previously.
Doing the former will trigger a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). Backward
compatibility will be removed in Python 3\.7\.
(Contributed by Yury Selivanov in [bpo\-27243](https://bugs.python.org/issue?@action=redirect&bpo=27243).)

A backslash\-character pair that is not a valid escape sequence now generates
a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"). Although this will eventually become a
[`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError"), that will not be for several Python releases.
(Contributed by Emanuel Barry in [bpo\-27364](https://bugs.python.org/issue?@action=redirect&bpo=27364).)

When performing a relative import, falling back on `__name__` and
`__path__` from the calling module when `__spec__` or
`__package__` are not defined now raises an [`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning").
(Contributed by Rose Ames in [bpo\-25791](https://bugs.python.org/issue?@action=redirect&bpo=25791).)

### Deprecated Python modules, functions and methods[¶](#deprecated-python-modules-functions-and-methods "Link to this heading")

#### asynchat[¶](#asynchat "Link to this heading")

The `asynchat` has been deprecated in favor of [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.").
(Contributed by Mariatta in [bpo\-25002](https://bugs.python.org/issue?@action=redirect&bpo=25002).)

#### asyncore[¶](#asyncore "Link to this heading")

The `asyncore` has been deprecated in favor of [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.").
(Contributed by Mariatta in [bpo\-25002](https://bugs.python.org/issue?@action=redirect&bpo=25002).)

#### dbm[¶](#dbm "Link to this heading")

Unlike other [`dbm`](../library/dbm.html#module-dbm "dbm: Interfaces to various Unix \"database\" formats.") implementations, the [`dbm.dumb`](../library/dbm.html#module-dbm.dumb "dbm.dumb: Portable implementation of the simple DBM interface.") module
creates databases with the `'rw'` mode and allows modifying the database
opened with the `'r'` mode. This behavior is now deprecated and will
be removed in 3\.8\.
(Contributed by Serhiy Storchaka in [bpo\-21708](https://bugs.python.org/issue?@action=redirect&bpo=21708).)

#### distutils[¶](#id2 "Link to this heading")

The undocumented `extra_path` argument to the
`distutils.Distribution` constructor is now considered deprecated
and will raise a warning if set. Support for this parameter will be
removed in a future Python release. See [bpo\-27919](https://bugs.python.org/issue?@action=redirect&bpo=27919) for details.

#### grp[¶](#grp "Link to this heading")

The support of non\-integer arguments in [`getgrgid()`](../library/grp.html#grp.getgrgid "grp.getgrgid") has been
deprecated.
(Contributed by Serhiy Storchaka in [bpo\-26129](https://bugs.python.org/issue?@action=redirect&bpo=26129).)

#### importlib[¶](#id3 "Link to this heading")

The [`importlib.machinery.SourceFileLoader.load_module()`](../library/importlib.html#importlib.machinery.SourceFileLoader.load_module "importlib.machinery.SourceFileLoader.load_module") and
[`importlib.machinery.SourcelessFileLoader.load_module()`](../library/importlib.html#importlib.machinery.SourcelessFileLoader.load_module "importlib.machinery.SourcelessFileLoader.load_module") methods
are now deprecated. They were the only remaining implementations of
[`importlib.abc.Loader.load_module()`](../library/importlib.html#importlib.abc.Loader.load_module "importlib.abc.Loader.load_module") in [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") that had not
been deprecated in previous versions of Python in favour of
[`importlib.abc.Loader.exec_module()`](../library/importlib.html#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module").

The [`importlib.machinery.WindowsRegistryFinder`](../library/importlib.html#importlib.machinery.WindowsRegistryFinder "importlib.machinery.WindowsRegistryFinder") class is now
deprecated. As of 3\.6\.0, it is still added to [`sys.meta_path`](../library/sys.html#sys.meta_path "sys.meta_path") by
default (on Windows), but this may change in future releases.

#### os[¶](#id4 "Link to this heading")

Undocumented support of general [bytes\-like objects](../glossary.html#term-bytes-like-object)
as paths in [`os`](../library/os.html#module-os "os: Miscellaneous operating system interfaces.") functions, [`compile()`](../library/functions.html#compile "compile") and similar functions is
now deprecated.
(Contributed by Serhiy Storchaka in [bpo\-25791](https://bugs.python.org/issue?@action=redirect&bpo=25791) and [bpo\-26754](https://bugs.python.org/issue?@action=redirect&bpo=26754).)

#### re[¶](#id5 "Link to this heading")

Support for inline flags `(?letters)` in the middle of the regular
expression has been deprecated and will be removed in a future Python
version. Flags at the start of a regular expression are still allowed.
(Contributed by Serhiy Storchaka in [bpo\-22493](https://bugs.python.org/issue?@action=redirect&bpo=22493).)

#### ssl[¶](#id6 "Link to this heading")

OpenSSL 0\.9\.8, 1\.0\.0 and 1\.0\.1 are deprecated and no longer supported.
In the future the [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module will require at least OpenSSL 1\.0\.2 or
1\.1\.0\.

SSL\-related arguments like `certfile`, `keyfile` and `check_hostname`
in [`ftplib`](../library/ftplib.html#module-ftplib "ftplib: FTP protocol client (requires sockets)."), [`http.client`](../library/http.client.html#module-http.client "http.client: HTTP and HTTPS protocol client (requires sockets)."), [`imaplib`](../library/imaplib.html#module-imaplib "imaplib: IMAP4 protocol client (requires sockets)."), [`poplib`](../library/poplib.html#module-poplib "poplib: POP3 protocol client (requires sockets)."),
and [`smtplib`](../library/smtplib.html#module-smtplib "smtplib: SMTP protocol client (requires sockets).") have been deprecated in favor of `context`.
(Contributed by Christian Heimes in [bpo\-28022](https://bugs.python.org/issue?@action=redirect&bpo=28022).)

A couple of protocols and functions of the [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module are now
deprecated. Some features will no longer be available in future versions
of OpenSSL. Other features are deprecated in favor of a different API.
(Contributed by Christian Heimes in [bpo\-28022](https://bugs.python.org/issue?@action=redirect&bpo=28022) and [bpo\-26470](https://bugs.python.org/issue?@action=redirect&bpo=26470).)

#### tkinter[¶](#id7 "Link to this heading")

The `tkinter.tix` module is now deprecated. [`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") users
should use [`tkinter.ttk`](../library/tkinter.ttk.html#module-tkinter.ttk "tkinter.ttk: Tk themed widget set") instead.

#### venv[¶](#whatsnew36-venv "Link to this heading")

The `pyvenv` script has been deprecated in favour of `python3 -m venv`.
This prevents confusion as to what Python interpreter `pyvenv` is
connected to and thus what Python interpreter will be used by the virtual
environment. (Contributed by Brett Cannon in [bpo\-25154](https://bugs.python.org/issue?@action=redirect&bpo=25154).)

### xml[¶](#xml "Link to this heading")

* As mitigation against DTD and external entity retrieval, the
[`xml.dom.minidom`](../library/xml.dom.minidom.html#module-xml.dom.minidom "xml.dom.minidom: Minimal Document Object Model (DOM) implementation.") and [`xml.sax`](../library/xml.sax.html#module-xml.sax "xml.sax: Package containing SAX2 base classes and convenience functions.") modules no longer process
external entities by default.
(Contributed by Christian Heimes in [gh\-61441](https://github.com/python/cpython/issues/61441).)

### Deprecated functions and types of the C API[¶](#deprecated-functions-and-types-of-the-c-api "Link to this heading")

Undocumented functions `PyUnicode_AsEncodedObject()`,
`PyUnicode_AsDecodedObject()`, `PyUnicode_AsEncodedUnicode()`
and `PyUnicode_AsDecodedUnicode()` are deprecated now.
Use the [generic codec based API](../c-api/codec.html#codec-registry) instead.

### Deprecated Build Options[¶](#deprecated-build-options "Link to this heading")

The `--with-system-ffi` configure flag is now on by default on non\-macOS
UNIX platforms. It may be disabled by using `--without-system-ffi`, but
using the flag is deprecated and will not be accepted in Python 3\.7\.
macOS is unaffected by this change. Note that many OS distributors already
use the `--with-system-ffi` flag when building their system Python.

## Removed[¶](#removed "Link to this heading")

### API and Feature Removals[¶](#api-and-feature-removals "Link to this heading")

* Unknown escapes consisting of `'\'` and an ASCII letter in
regular expressions will now cause an error. In replacement templates for
[`re.sub()`](../library/re.html#re.sub "re.sub") they are still allowed, but deprecated.
The [`re.LOCALE`](../library/re.html#re.LOCALE "re.LOCALE") flag can now only be used with binary patterns.
* `inspect.getmoduleinfo()` was removed (was deprecated since CPython 3\.3\).
[`inspect.getmodulename()`](../library/inspect.html#inspect.getmodulename "inspect.getmodulename") should be used for obtaining the module
name for a given path.
(Contributed by Yury Selivanov in [bpo\-13248](https://bugs.python.org/issue?@action=redirect&bpo=13248).)
* `traceback.Ignore` class and `traceback.usage`, `traceback.modname`,
`traceback.fullmodname`, `traceback.find_lines_from_code`,
`traceback.find_lines`, `traceback.find_strings`,
`traceback.find_executable_lines` methods were removed from the
[`traceback`](../library/traceback.html#module-traceback "traceback: Print or retrieve a stack traceback.") module. They were undocumented methods deprecated since
Python 3\.2 and equivalent functionality is available from private methods.
* The `tk_menuBar()` and `tk_bindForTraversal()` dummy methods in
[`tkinter`](../library/tkinter.html#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") widget classes were removed (corresponding Tk commands
were obsolete since Tk 4\.0\).
* The [`open()`](../library/zipfile.html#zipfile.ZipFile.open "zipfile.ZipFile.open") method of the [`zipfile.ZipFile`](../library/zipfile.html#zipfile.ZipFile "zipfile.ZipFile")
class no longer supports the `'U'` mode (was deprecated since Python 3\.4\).
Use [`io.TextIOWrapper`](../library/io.html#io.TextIOWrapper "io.TextIOWrapper") for reading compressed text files in
[universal newlines](../glossary.html#term-universal-newlines) mode.
* The undocumented `IN`, `CDROM`, `DLFCN`, `TYPES`, `CDIO`, and
`STROPTS` modules have been removed. They had been available in the
platform specific `Lib/plat-*/` directories, but were chronically out of
date, inconsistently available across platforms, and unmaintained. The
script that created these modules is still available in the source
distribution at [Tools/scripts/h2py.py](https://github.com/python/cpython/blob/v3.6.15/Tools/scripts/h2py.py).
* The deprecated `asynchat.fifo` class has been removed.

## Porting to Python 3\.6[¶](#porting-to-python-3-6 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in ‘python’ Command Behavior[¶](#changes-in-python-command-behavior "Link to this heading")

* The output of a special Python build with defined `COUNT_ALLOCS`,
`SHOW_ALLOC_COUNT` or `SHOW_TRACK_COUNT` macros is now off by
default. It can be re\-enabled using the `-X showalloccount` option.
It now outputs to `stderr` instead of `stdout`.
(Contributed by Serhiy Storchaka in [bpo\-23034](https://bugs.python.org/issue?@action=redirect&bpo=23034).)

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* [`open()`](../library/functions.html#open "open") will no longer allow combining the `'U'` mode flag
with `'+'`.
(Contributed by Jeff Balogh and John O’Connor in [bpo\-2091](https://bugs.python.org/issue?@action=redirect&bpo=2091).)
* [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") no longer implicitly commits an open transaction before DDL
statements.
* On Linux, [`os.urandom()`](../library/os.html#os.urandom "os.urandom") now blocks until the system urandom entropy pool
is initialized to increase the security.
* When [`importlib.abc.Loader.exec_module()`](../library/importlib.html#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") is defined,
[`importlib.abc.Loader.create_module()`](../library/importlib.html#importlib.abc.Loader.create_module "importlib.abc.Loader.create_module") must also be defined.
* [`PyErr_SetImportError()`](../c-api/exceptions.html#c.PyErr_SetImportError "PyErr_SetImportError") now sets [`TypeError`](../library/exceptions.html#TypeError "TypeError") when its **msg**
argument is not set. Previously only `NULL` was returned.
* The format of the [`co_lnotab`](../reference/datamodel.html#codeobject.co_lnotab "codeobject.co_lnotab") attribute of code objects
changed to support
a negative line number delta. By default, Python does not emit bytecode with
a negative line number delta. Functions using [`frame.f_lineno`](../reference/datamodel.html#frame.f_lineno "frame.f_lineno"),
`PyFrame_GetLineNumber()` or `PyCode_Addr2Line()` are not affected.
Functions directly decoding `co_lnotab` should be updated to use a signed
8\-bit integer type for the line number delta, but this is only required to
support applications using a negative line number delta. See
`Objects/lnotab_notes.txt` for the `co_lnotab` format and how to decode
it, and see the [**PEP 511**](https://peps.python.org/pep-0511/) for the rationale.
* The functions in the [`compileall`](../library/compileall.html#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.") module now return booleans instead
of `1` or `0` to represent success or failure, respectively. Thanks to
booleans being a subclass of integers, this should only be an issue if you
were doing identity checks for `1` or `0`. See [bpo\-25768](https://bugs.python.org/issue?@action=redirect&bpo=25768).
* Reading the `port` attribute of
[`urllib.parse.urlsplit()`](../library/urllib.parse.html#urllib.parse.urlsplit "urllib.parse.urlsplit") and [`urlparse()`](../library/urllib.parse.html#urllib.parse.urlparse "urllib.parse.urlparse") results
now raises [`ValueError`](../library/exceptions.html#ValueError "ValueError") for out\-of\-range values, rather than
returning [`None`](../library/constants.html#None "None"). See [bpo\-20059](https://bugs.python.org/issue?@action=redirect&bpo=20059).
* The `imp` module now raises a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") instead of
[`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning").
* The following modules have had missing APIs added to their `__all__`
attributes to match the documented APIs:
[`calendar`](../library/calendar.html#module-calendar "calendar: Functions for working with calendars, including some emulation of the Unix cal program."), `cgi`, [`csv`](../library/csv.html#module-csv "csv: Write and read tabular data to and from delimited files."),
[`ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API."), [`enum`](../library/enum.html#module-enum "enum: Implementation of an enumeration class."),
[`fileinput`](../library/fileinput.html#module-fileinput "fileinput: Loop over standard input or a list of files."), [`ftplib`](../library/ftplib.html#module-ftplib "ftplib: FTP protocol client (requires sockets)."), [`logging`](../library/logging.html#module-logging "logging: Flexible event logging system for applications."), [`mailbox`](../library/mailbox.html#module-mailbox "mailbox: Manipulate mailboxes in various formats"),
[`mimetypes`](../library/mimetypes.html#module-mimetypes "mimetypes: Mapping of filename extensions to MIME types."), [`optparse`](../library/optparse.html#module-optparse "optparse: Command-line option parsing library."), [`plistlib`](../library/plistlib.html#module-plistlib "plistlib: Generate and parse Apple plist files."), `smtpd`,
[`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management."), [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") and
[`wave`](../library/wave.html#module-wave "wave: Provide an interface to the WAV sound format."). This means they will export new symbols when `import *`
is used.
(Contributed by Joel Taddei and Jacek Kołodziej in [bpo\-23883](https://bugs.python.org/issue?@action=redirect&bpo=23883).)
* When performing a relative import, if `__package__` does not compare equal
to `__spec__.parent` then [`ImportWarning`](../library/exceptions.html#ImportWarning "ImportWarning") is raised.
(Contributed by Brett Cannon in [bpo\-25791](https://bugs.python.org/issue?@action=redirect&bpo=25791).)
* When a relative import is performed and no parent package is known, then
[`ImportError`](../library/exceptions.html#ImportError "ImportError") will be raised. Previously, [`SystemError`](../library/exceptions.html#SystemError "SystemError") could be
raised. (Contributed by Brett Cannon in [bpo\-18018](https://bugs.python.org/issue?@action=redirect&bpo=18018).)
* Servers based on the [`socketserver`](../library/socketserver.html#module-socketserver "socketserver: A framework for network servers.") module, including those
defined in [`http.server`](../library/http.server.html#module-http.server "http.server: HTTP server and request handlers."), [`xmlrpc.server`](../library/xmlrpc.server.html#module-xmlrpc.server "xmlrpc.server: Basic XML-RPC server implementations.") and
[`wsgiref.simple_server`](../library/wsgiref.html#module-wsgiref.simple_server "wsgiref.simple_server: A simple WSGI HTTP server."), now only catch exceptions derived
from [`Exception`](../library/exceptions.html#Exception "Exception"). Therefore if a request handler raises
an exception like [`SystemExit`](../library/exceptions.html#SystemExit "SystemExit") or [`KeyboardInterrupt`](../library/exceptions.html#KeyboardInterrupt "KeyboardInterrupt"),
[`handle_error()`](../library/socketserver.html#socketserver.BaseServer.handle_error "socketserver.BaseServer.handle_error") is no longer called, and
the exception will stop a single\-threaded server. (Contributed by
Martin Panter in [bpo\-23430](https://bugs.python.org/issue?@action=redirect&bpo=23430).)
* `spwd.getspnam()` now raises a [`PermissionError`](../library/exceptions.html#PermissionError "PermissionError") instead of
[`KeyError`](../library/exceptions.html#KeyError "KeyError") if the user doesn’t have privileges.
* The [`socket.socket.close()`](../library/socket.html#socket.socket.close "socket.socket.close") method now raises an exception if
an error (e.g. `EBADF`) was reported by the underlying system call.
(Contributed by Martin Panter in [bpo\-26685](https://bugs.python.org/issue?@action=redirect&bpo=26685).)
* The *decode\_data* argument for the `smtpd.SMTPChannel` and
`smtpd.SMTPServer` constructors is now `False` by default.
This means that the argument passed to
`process_message()` is now a bytes object by
default, and `process_message()` will be passed keyword arguments.
Code that has already been updated in accordance with the deprecation
warning generated by 3\.5 will not be affected.
* All optional arguments of the [`dump()`](../library/json.html#json.dump "json.dump"), [`dumps()`](../library/json.html#json.dumps "json.dumps"),
[`load()`](../library/json.html#json.load "json.load") and [`loads()`](../library/json.html#json.loads "json.loads") functions and
[`JSONEncoder`](../library/json.html#json.JSONEncoder "json.JSONEncoder") and [`JSONDecoder`](../library/json.html#json.JSONDecoder "json.JSONDecoder") class
constructors in the [`json`](../library/json.html#module-json "json: Encode and decode the JSON format.") module are now [keyword\-only](../glossary.html#keyword-only-parameter).
(Contributed by Serhiy Storchaka in [bpo\-18726](https://bugs.python.org/issue?@action=redirect&bpo=18726).)
* Subclasses of [`type`](../library/functions.html#type "type") which don’t override `type.__new__` may no
longer use the one\-argument form to get the type of an object.
* As part of [**PEP 487**](https://peps.python.org/pep-0487/), the handling of keyword arguments passed to
[`type`](../library/functions.html#type "type") (other than the metaclass hint, `metaclass`) is now
consistently delegated to [`object.__init_subclass__()`](../reference/datamodel.html#object.__init_subclass__ "object.__init_subclass__"). This means that
`type.__new__()` and `type.__init__()` both now accept arbitrary
keyword arguments, but [`object.__init_subclass__()`](../reference/datamodel.html#object.__init_subclass__ "object.__init_subclass__") (which is called from
`type.__new__()`) will reject them by default. Custom metaclasses
accepting additional keyword arguments will need to adjust their calls to
`type.__new__()` (whether direct or via [`super`](../library/functions.html#super "super")) accordingly.
* In `distutils.command.sdist.sdist`, the `default_format`
attribute has been removed and is no longer honored. Instead, the
gzipped tarfile format is the default on all platforms and no
platform\-specific selection is made.
In environments where distributions are
built on Windows and zip distributions are required, configure
the project with a `setup.cfg` file containing the following:

\`\`\`
\[sdist]
formats=zip

\`\`\`

This behavior has also been backported to earlier Python versions
by Setuptools 26\.0\.0\.
* In the [`urllib.request`](../library/urllib.request.html#module-urllib.request "urllib.request: Extensible library for opening URLs.") module and the
[`http.client.HTTPConnection.request()`](../library/http.client.html#http.client.HTTPConnection.request "http.client.HTTPConnection.request") method, if no Content\-Length
header field has been specified and the request body is a file object,
it is now sent with HTTP 1\.1 chunked encoding. If a file object has to
be sent to a HTTP 1\.0 server, the Content\-Length value now has to be
specified by the caller.
(Contributed by Demian Brecht and Rolf Krahl with tweaks from
Martin Panter in [bpo\-12319](https://bugs.python.org/issue?@action=redirect&bpo=12319).)
* The [`DictReader`](../library/csv.html#csv.DictReader "csv.DictReader") now returns rows of type
[`OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict").
(Contributed by Steve Holden in [bpo\-27842](https://bugs.python.org/issue?@action=redirect&bpo=27842).)
* The `crypt.METHOD_CRYPT` will no longer be added to `crypt.methods`
if unsupported by the platform.
(Contributed by Victor Stinner in [bpo\-25287](https://bugs.python.org/issue?@action=redirect&bpo=25287).)
* The *verbose* and *rename* arguments for
[`namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") are now keyword\-only.
(Contributed by Raymond Hettinger in [bpo\-25628](https://bugs.python.org/issue?@action=redirect&bpo=25628).)
* On Linux, [`ctypes.util.find_library()`](../library/ctypes.html#ctypes.util.find_library "ctypes.util.find_library") now looks in
`LD_LIBRARY_PATH` for shared libraries.
(Contributed by Vinay Sajip in [bpo\-9998](https://bugs.python.org/issue?@action=redirect&bpo=9998).)
* The [`imaplib.IMAP4`](../library/imaplib.html#imaplib.IMAP4 "imaplib.IMAP4") class now handles flags containing the
`']'` character in messages sent from the server to improve
real\-world compatibility.
(Contributed by Lita Cho in [bpo\-21815](https://bugs.python.org/issue?@action=redirect&bpo=21815).)
* The `mmap.write()` function now returns the number
of bytes written like other write methods.
(Contributed by Jakub Stasiak in [bpo\-26335](https://bugs.python.org/issue?@action=redirect&bpo=26335).)
* The [`pkgutil.iter_modules()`](../library/pkgutil.html#pkgutil.iter_modules "pkgutil.iter_modules") and [`pkgutil.walk_packages()`](../library/pkgutil.html#pkgutil.walk_packages "pkgutil.walk_packages")
functions now return [`ModuleInfo`](../library/pkgutil.html#pkgutil.ModuleInfo "pkgutil.ModuleInfo") named tuples.
(Contributed by Ramchandra Apte in [bpo\-17211](https://bugs.python.org/issue?@action=redirect&bpo=17211).)
* [`re.sub()`](../library/re.html#re.sub "re.sub") now raises an error for invalid numerical group
references in replacement templates even if the pattern is not
found in the string. The error message for invalid group references
now includes the group index and the position of the reference.
(Contributed by SilentGhost, Serhiy Storchaka in [bpo\-25953](https://bugs.python.org/issue?@action=redirect&bpo=25953).)
* [`zipfile.ZipFile`](../library/zipfile.html#zipfile.ZipFile "zipfile.ZipFile") will now raise [`NotImplementedError`](../library/exceptions.html#NotImplementedError "NotImplementedError") for
unrecognized compression values. Previously a plain [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError")
was raised. Additionally, calling [`ZipFile`](../library/zipfile.html#zipfile.ZipFile "zipfile.ZipFile") methods
on a closed ZipFile or calling the [`write()`](../library/zipfile.html#zipfile.ZipFile.write "zipfile.ZipFile.write") method
on a ZipFile created with mode `'r'` will raise a [`ValueError`](../library/exceptions.html#ValueError "ValueError").
Previously, a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") was raised in those scenarios.
* when custom metaclasses are combined with zero\-argument [`super()`](../library/functions.html#super "super") or
direct references from methods to the implicit `__class__` closure
variable, the implicit `__classcell__` namespace entry must now be passed
up to `type.__new__` for initialisation. Failing to do so will result in
a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") in Python 3\.6 and a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") in
Python 3\.8\.
* With the introduction of [`ModuleNotFoundError`](../library/exceptions.html#ModuleNotFoundError "ModuleNotFoundError"), import system consumers
may start expecting import system replacements to raise that more specific
exception when appropriate, rather than the less\-specific [`ImportError`](../library/exceptions.html#ImportError "ImportError").
To provide future compatibility with such consumers, implementers of
alternative import systems that completely replace [`__import__()`](../library/functions.html#import__ "__import__") will
need to update their implementations to raise the new subclass when a module
can’t be found at all. Implementers of compliant plugins to the default
import system shouldn’t need to make any changes, as the default import
system will raise the new subclass when appropriate.

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

* The [`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc") allocator family now uses the [pymalloc allocator](../c-api/memory.html#pymalloc) rather than the system `malloc()`. Applications calling
[`PyMem_Malloc()`](../c-api/memory.html#c.PyMem_Malloc "PyMem_Malloc") without holding the GIL can now crash. Set the
[`PYTHONMALLOC`](../using/cmdline.html#envvar-PYTHONMALLOC) environment variable to `debug` to validate the
usage of memory allocators in your application. See [bpo\-26249](https://bugs.python.org/issue?@action=redirect&bpo=26249).
* [`Py_Exit()`](../c-api/sys.html#c.Py_Exit "Py_Exit") (and the main interpreter) now override the exit status
with 120 if flushing buffered data failed. See [bpo\-5319](https://bugs.python.org/issue?@action=redirect&bpo=5319).

### CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

There have been several major changes to the [bytecode](../glossary.html#term-bytecode) in Python 3\.6\.

* The Python interpreter now uses a 16\-bit wordcode instead of bytecode.
(Contributed by Demur Rumed with input and reviews from
Serhiy Storchaka and Victor Stinner in [bpo\-26647](https://bugs.python.org/issue?@action=redirect&bpo=26647) and [bpo\-28050](https://bugs.python.org/issue?@action=redirect&bpo=28050).)
* The new `FORMAT_VALUE` and [`BUILD_STRING`](../library/dis.html#opcode-BUILD_STRING) opcodes as part
of the [formatted string literal](#whatsnew36-pep498) implementation.
(Contributed by Eric Smith in [bpo\-25483](https://bugs.python.org/issue?@action=redirect&bpo=25483) and
Serhiy Storchaka in [bpo\-27078](https://bugs.python.org/issue?@action=redirect&bpo=27078).)
* The new [`BUILD_CONST_KEY_MAP`](../library/dis.html#opcode-BUILD_CONST_KEY_MAP) opcode to optimize the creation
of dictionaries with constant keys.
(Contributed by Serhiy Storchaka in [bpo\-27140](https://bugs.python.org/issue?@action=redirect&bpo=27140).)
* The function call opcodes have been heavily reworked for better performance
and simpler implementation.
The [`MAKE_FUNCTION`](../library/dis.html#opcode-MAKE_FUNCTION), `CALL_FUNCTION`,
`CALL_FUNCTION_KW` and `BUILD_MAP_UNPACK_WITH_CALL` opcodes
have been modified, the new [`CALL_FUNCTION_EX`](../library/dis.html#opcode-CALL_FUNCTION_EX) and
`BUILD_TUPLE_UNPACK_WITH_CALL` have been added, and
`CALL_FUNCTION_VAR`, `CALL_FUNCTION_VAR_KW` and `MAKE_CLOSURE` opcodes
have been removed.
(Contributed by Demur Rumed in [bpo\-27095](https://bugs.python.org/issue?@action=redirect&bpo=27095), and Serhiy Storchaka in
[bpo\-27213](https://bugs.python.org/issue?@action=redirect&bpo=27213), [bpo\-28257](https://bugs.python.org/issue?@action=redirect&bpo=28257).)
* The new [`SETUP_ANNOTATIONS`](../library/dis.html#opcode-SETUP_ANNOTATIONS) and `STORE_ANNOTATION` opcodes
have been added to support the new [variable annotation](../glossary.html#term-variable-annotation) syntax.
(Contributed by Ivan Levkivskyi in [bpo\-27985](https://bugs.python.org/issue?@action=redirect&bpo=27985).)

## Notable changes in Python 3\.6\.2[¶](#notable-changes-in-python-3-6-2 "Link to this heading")

### New `make regen-all` build target[¶](#new-make-regen-all-build-target "Link to this heading")

To simplify cross\-compilation, and to ensure that CPython can reliably be
compiled without requiring an existing version of Python to already be
available, the autotools\-based build system no longer attempts to implicitly
recompile generated files based on file modification times.

Instead, a new `make regen-all` command has been added to force regeneration
of these files when desired (e.g. after an initial version of Python has
already been built based on the pregenerated versions).

More selective regeneration targets are also defined \- see
[Makefile.pre.in](https://github.com/python/cpython/tree/3.13/Makefile.pre.in) for details.

(Contributed by Victor Stinner in [bpo\-23404](https://bugs.python.org/issue?@action=redirect&bpo=23404).)

Added in version 3\.6\.2\.

### Removal of `make touch` build target[¶](#removal-of-make-touch-build-target "Link to this heading")

The `make touch` build target previously used to request implicit regeneration
of generated files by updating their modification times has been removed.

It has been replaced by the new `make regen-all` target.

(Contributed by Victor Stinner in [bpo\-23404](https://bugs.python.org/issue?@action=redirect&bpo=23404).)

Changed in version 3\.6\.2\.

## Notable changes in Python 3\.6\.4[¶](#notable-changes-in-python-3-6-4 "Link to this heading")

The `PyExc_RecursionErrorInst` singleton that was part of the public API
has been removed as its members being never cleared may cause a segfault
during finalization of the interpreter.
(Contributed by Xavier de Gaye in [bpo\-22898](https://bugs.python.org/issue?@action=redirect&bpo=22898) and [bpo\-30697](https://bugs.python.org/issue?@action=redirect&bpo=30697).)

## Notable changes in Python 3\.6\.5[¶](#notable-changes-in-python-3-6-5 "Link to this heading")

The [`locale.localeconv()`](../library/locale.html#locale.localeconv "locale.localeconv") function now sets temporarily the `LC_CTYPE`
locale to the `LC_NUMERIC` locale in some cases.
(Contributed by Victor Stinner in [bpo\-31900](https://bugs.python.org/issue?@action=redirect&bpo=31900).)

## Notable changes in Python 3\.6\.7[¶](#notable-changes-in-python-3-6-7 "Link to this heading")

[`xml.dom.minidom`](../library/xml.dom.minidom.html#module-xml.dom.minidom "xml.dom.minidom: Minimal Document Object Model (DOM) implementation.") and [`xml.sax`](../library/xml.sax.html#module-xml.sax "xml.sax: Package containing SAX2 base classes and convenience functions.") modules no longer process
external entities by default. See also [gh\-61441](https://github.com/python/cpython/issues/61441).

In 3\.6\.7 the [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module now implicitly emits a `NEWLINE` token
when provided with input that does not have a trailing new line. This behavior
now matches what the C tokenizer does internally.
(Contributed by Ammar Askar in [bpo\-33899](https://bugs.python.org/issue?@action=redirect&bpo=33899).)

## Notable changes in Python 3\.6\.10[¶](#notable-changes-in-python-3-6-10 "Link to this heading")

Due to significant security concerns, the *reuse\_address* parameter of
[`asyncio.loop.create_datagram_endpoint()`](../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint") is no longer supported. This is
because of the behavior of the socket option `SO_REUSEADDR` in UDP. For more
details, see the documentation for `loop.create_datagram_endpoint()`.
(Contributed by Kyle Stanley, Antoine Pitrou, and Yury Selivanov in
[bpo\-37228](https://bugs.python.org/issue?@action=redirect&bpo=37228).)

## Notable changes in Python 3\.6\.13[¶](#notable-changes-in-python-3-6-13 "Link to this heading")

Earlier Python versions allowed using both `;` and `&` as
query parameter separators in [`urllib.parse.parse_qs()`](../library/urllib.parse.html#urllib.parse.parse_qs "urllib.parse.parse_qs") and
[`urllib.parse.parse_qsl()`](../library/urllib.parse.html#urllib.parse.parse_qsl "urllib.parse.parse_qsl"). Due to security concerns, and to conform with
newer W3C recommendations, this has been changed to allow only a single
separator key, with `&` as the default. This change also affects
`cgi.parse()` and `cgi.parse_multipart()` as they use the affected
functions internally. For more details, please see their respective
documentation.
(Contributed by Adam Goldschmidt, Senthil Kumaran and Ken Jin in [bpo\-42967](https://bugs.python.org/issue?@action=redirect&bpo=42967).)

## Notable changes in Python 3\.6\.14[¶](#notable-changes-in-python-3-6-14 "Link to this heading")

A security fix alters the [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") behavior to not trust the
IPv4 address sent from the remote server when setting up a passive data
channel. We reuse the ftp server IP address instead. For unusual code
requiring the old behavior, set a `trust_server_pasv_ipv4_address`
attribute on your FTP instance to `True`. (See [gh\-87451](https://github.com/python/cpython/issues/87451))

The presence of newline or tab characters in parts of a URL allows for some
forms of attacks. Following the WHATWG specification that updates RFC 3986,
ASCII newline `\n`, `\r` and tab `\t` characters are stripped from the
URL by the parser [`urllib.parse()`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") preventing such attacks. The removal
characters are controlled by a new module level variable
`urllib.parse._UNSAFE_URL_BYTES_TO_REMOVE`. (See [gh\-88048](https://github.com/python/cpython/issues/88048))

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.6](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [PEP 498: Formatted string literals](#pep-498-formatted-string-literals)
		- [PEP 526: Syntax for variable annotations](#pep-526-syntax-for-variable-annotations)
		- [PEP 515: Underscores in Numeric Literals](#pep-515-underscores-in-numeric-literals)
		- [PEP 525: Asynchronous Generators](#pep-525-asynchronous-generators)
		- [PEP 530: Asynchronous Comprehensions](#pep-530-asynchronous-comprehensions)
		- [PEP 487: Simpler customization of class creation](#pep-487-simpler-customization-of-class-creation)
		- [PEP 487: Descriptor Protocol Enhancements](#pep-487-descriptor-protocol-enhancements)
		- [PEP 519: Adding a file system path protocol](#pep-519-adding-a-file-system-path-protocol)
		- [PEP 495: Local Time Disambiguation](#pep-495-local-time-disambiguation)
		- [PEP 529: Change Windows filesystem encoding to UTF\-8](#pep-529-change-windows-filesystem-encoding-to-utf-8)
		- [PEP 528: Change Windows console encoding to UTF\-8](#pep-528-change-windows-console-encoding-to-utf-8)
		- [PEP 520: Preserving Class Attribute Definition Order](#pep-520-preserving-class-attribute-definition-order)
		- [PEP 468: Preserving Keyword Argument Order](#pep-468-preserving-keyword-argument-order)
		- [New dict implementation](#new-dict-implementation)
		- [PEP 523: Adding a frame evaluation API to CPython](#pep-523-adding-a-frame-evaluation-api-to-cpython)
		- [PYTHONMALLOC environment variable](#pythonmalloc-environment-variable)
		- [DTrace and SystemTap probing support](#dtrace-and-systemtap-probing-support)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
		- [secrets](#secrets)
	+ [Improved Modules](#improved-modules)
		- [array](#array)
		- [ast](#ast)
		- [asyncio](#asyncio)
		- [binascii](#binascii)
		- [cmath](#cmath)
		- [collections](#collections)
		- [concurrent.futures](#concurrent-futures)
		- [contextlib](#contextlib)
		- [datetime](#datetime)
		- [decimal](#decimal)
		- [distutils](#distutils)
		- [email](#email)
		- [encodings](#encodings)
		- [enum](#enum)
		- [faulthandler](#faulthandler)
		- [fileinput](#fileinput)
		- [hashlib](#hashlib)
		- [http.client](#http-client)
		- [idlelib and IDLE](#idlelib-and-idle)
		- [importlib](#importlib)
		- [inspect](#inspect)
		- [json](#json)
		- [logging](#logging)
		- [math](#math)
		- [multiprocessing](#multiprocessing)
		- [os](#os)
		- [pathlib](#pathlib)
		- [pdb](#pdb)
		- [pickle](#pickle)
		- [pickletools](#pickletools)
		- [pydoc](#pydoc)
		- [random](#random)
		- [re](#re)
		- [readline](#readline)
		- [rlcompleter](#rlcompleter)
		- [shlex](#shlex)
		- [site](#site)
		- [sqlite3](#sqlite3)
		- [socket](#socket)
		- [socketserver](#socketserver)
		- [ssl](#ssl)
		- [statistics](#statistics)
		- [struct](#struct)
		- [subprocess](#subprocess)
		- [sys](#sys)
		- [telnetlib](#telnetlib)
		- [time](#time)
		- [timeit](#timeit)
		- [tkinter](#tkinter)
		- [traceback](#traceback)
		- [tracemalloc](#tracemalloc)
		- [typing](#typing)
		- [unicodedata](#unicodedata)
		- [unittest.mock](#unittest-mock)
		- [urllib.request](#urllib-request)
		- [urllib.robotparser](#urllib-robotparser)
		- [venv](#venv)
		- [warnings](#warnings)
		- [winreg](#winreg)
		- [winsound](#winsound)
		- [xmlrpc.client](#xmlrpc-client)
		- [zipfile](#zipfile)
		- [zlib](#zlib)
	+ [Optimizations](#optimizations)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Other Improvements](#other-improvements)
	+ [Deprecated](#deprecated)
		- [New Keywords](#new-keywords)
		- [Deprecated Python behavior](#deprecated-python-behavior)
		- [Deprecated Python modules, functions and methods](#deprecated-python-modules-functions-and-methods)
			* [asynchat](#asynchat)
			* [asyncore](#asyncore)
			* [dbm](#dbm)
			* [distutils](#id2)
			* [grp](#grp)
			* [importlib](#id3)
			* [os](#id4)
			* [re](#id5)
			* [ssl](#id6)
			* [tkinter](#id7)
			* [venv](#whatsnew36-venv)
		- [xml](#xml)
		- [Deprecated functions and types of the C API](#deprecated-functions-and-types-of-the-c-api)
		- [Deprecated Build Options](#deprecated-build-options)
	+ [Removed](#removed)
		- [API and Feature Removals](#api-and-feature-removals)
	+ [Porting to Python 3\.6](#porting-to-python-3-6)
		- [Changes in ‘python’ Command Behavior](#changes-in-python-command-behavior)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
		- [CPython bytecode changes](#cpython-bytecode-changes)
	+ [Notable changes in Python 3\.6\.2](#notable-changes-in-python-3-6-2)
		- [New `make regen-all` build target](#new-make-regen-all-build-target)
		- [Removal of `make touch` build target](#removal-of-make-touch-build-target)
	+ [Notable changes in Python 3\.6\.4](#notable-changes-in-python-3-6-4)
	+ [Notable changes in Python 3\.6\.5](#notable-changes-in-python-3-6-5)
	+ [Notable changes in Python 3\.6\.7](#notable-changes-in-python-3-6-7)
	+ [Notable changes in Python 3\.6\.10](#notable-changes-in-python-3-6-10)
	+ [Notable changes in Python 3\.6\.13](#notable-changes-in-python-3-6-13)
	+ [Notable changes in Python 3\.6\.14](#notable-changes-in-python-3-6-14)

#### Previous topic

[What’s New In Python 3\.7](3.7.html "previous chapter")

#### Next topic

[What’s New In Python 3\.5](3.5.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.6.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.5.html "What’s New In Python 3.5") \|
* [previous](3.7.html "What’s New In Python 3.7") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.6
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.7 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.7.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.6.html "What’s New In Python 3.6") \|
* [previous](3.8.html "What’s New In Python 3.8") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.7
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.7[¶](#what-s-new-in-python-3-7 "Link to this heading")

Editor:
Elvis Pranskevichus \

This article explains the new features in Python 3\.7, compared to 3\.6\.
Python 3\.7 was released on June 27, 2018\.
For full details, see the [changelog](changelog.html#changelog).

## Summary – Release Highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* [PEP 563](#whatsnew37-pep563), postponed evaluation of type annotations.

Backwards incompatible syntax changes:

* [`async`](../reference/compound_stmts.html#async) and [`await`](../reference/expressions.html#await) are now reserved keywords.

New library modules:

* [`contextvars`](../library/contextvars.html#module-contextvars "contextvars: Context Variables"): [PEP 567 – Context Variables](#whatsnew37-pep567)
* [`dataclasses`](../library/dataclasses.html#module-dataclasses "dataclasses: Generate special methods on user-defined classes."): [PEP 557 – Data Classes](#whatsnew37-pep557)
* [importlib.resources](#whatsnew37-importlib-resources)

New built\-in features:

* [PEP 553](#whatsnew37-pep553), the new [`breakpoint()`](../library/functions.html#breakpoint "breakpoint") function.

Python data model improvements:

* [PEP 562](#whatsnew37-pep562), customization of access to
module attributes.
* [PEP 560](#whatsnew37-pep560), core support for typing module and
generic types.
* the insertion\-order preservation nature of [dict](../library/stdtypes.html#typesmapping)
objects [has been declared](https://mail.python.org/pipermail/python-dev/2017-December/151283.html) to be an official
part of the Python language spec.

Significant improvements in the standard library:

* The [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module has received new features, significant
[usability and performance improvements](#whatsnew37-asyncio).
* The [`time`](../library/time.html#module-time "time: Time access and conversions.") module gained support for
[functions with nanosecond resolution](#whatsnew37-pep564).

CPython implementation improvements:

* Avoiding the use of ASCII as a default text encoding:

	+ [PEP 538](#whatsnew37-pep538), legacy C locale coercion
	+ [PEP 540](#whatsnew37-pep540), forced UTF\-8 runtime mode
* [PEP 552](#whatsnew37-pep552), deterministic .pycs
* [New Python Development Mode](#whatsnew37-devmode)
* [PEP 565](#whatsnew37-pep565), improved [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning")
handling

C API improvements:

* [PEP 539](#whatsnew37-pep539), new C API for thread\-local storage

Documentation improvements:

* [PEP 545](#whatsnew37-pep545), Python documentation translations
* New documentation translations: [Japanese](https://docs.python.org/ja/),
[French](https://docs.python.org/fr/), and
[Korean](https://docs.python.org/ko/).

This release features notable performance improvements in many areas.
The [Optimizations](#whatsnew37-perf) section lists them in detail.

For a list of changes that may affect compatibility with previous Python
releases please refer to the [Porting to Python 3\.7](#porting-to-python-37) section.

## New Features[¶](#new-features "Link to this heading")

### PEP 563: Postponed Evaluation of Annotations[¶](#pep-563-postponed-evaluation-of-annotations "Link to this heading")

The advent of type hints in Python uncovered two glaring usability issues
with the functionality of annotations added in [**PEP 3107**](https://peps.python.org/pep-3107/) and refined
further in [**PEP 526**](https://peps.python.org/pep-0526/):

* annotations could only use names which were already available in the
current scope, in other words they didn’t support forward references
of any kind; and
* annotating source code had adverse effects on startup time of Python
programs.

Both of these issues are fixed by postponing the evaluation of
annotations. Instead of compiling code which executes expressions in
annotations at their definition time, the compiler stores the annotation
in a string form equivalent to the AST of the expression in question.
If needed, annotations can be resolved at runtime using
[`typing.get_type_hints()`](../library/typing.html#typing.get_type_hints "typing.get_type_hints"). In the common case where this is not
required, the annotations are cheaper to store (since short strings
are interned by the interpreter) and make startup time faster.

Usability\-wise, annotations now support forward references, making the
following syntax valid:

\`\`\`
class C:
 @classmethod
 def from\_string(cls, source: str) \-\> C:
 ...

 def validate\_b(self, obj: B) \-\> bool:
 ...

class B:
 ...

\`\`\`

Since this change breaks compatibility, the new behavior needs to be enabled
on a per\-module basis in Python 3\.7 using a [`__future__`](../library/__future__.html#module-__future__ "__future__: Future statement definitions") import:

\`\`\`
from \_\_future\_\_ import annotations

\`\`\`

It will become the default in Python 3\.10\.

See also

[**PEP 563**](https://peps.python.org/pep-0563/) – Postponed evaluation of annotationsPEP written and implemented by Łukasz Langa.

### PEP 538: Legacy C Locale Coercion[¶](#pep-538-legacy-c-locale-coercion "Link to this heading")

An ongoing challenge within the Python 3 series has been determining a sensible
default strategy for handling the “7\-bit ASCII” text encoding assumption
currently implied by the use of the default C or POSIX locale on non\-Windows
platforms.

[**PEP 538**](https://peps.python.org/pep-0538/) updates the default interpreter command line interface to
automatically coerce that locale to an available UTF\-8 based locale as
described in the documentation of the new [`PYTHONCOERCECLOCALE`](../using/cmdline.html#envvar-PYTHONCOERCECLOCALE)
environment variable. Automatically setting `LC_CTYPE` this way means that
both the core interpreter and locale\-aware C extensions (such as
[`readline`](../library/readline.html#module-readline "readline: GNU readline support for Python. (Unix)")) will assume the use of UTF\-8 as the default text encoding,
rather than ASCII.

The platform support definition in [**PEP 11**](https://peps.python.org/pep-0011/) has also been updated to limit
full text handling support to suitably configured non\-ASCII based locales.

As part of this change, the default error handler for [`stdin`](../library/sys.html#sys.stdin "sys.stdin") and
[`stdout`](../library/sys.html#sys.stdout "sys.stdout") is now `surrogateescape` (rather than `strict`) when
using any of the defined coercion target locales (currently `C.UTF-8`,
`C.utf8`, and `UTF-8`). The default error handler for [`stderr`](../library/sys.html#sys.stderr "sys.stderr")
continues to be `backslashreplace`, regardless of locale.

Locale coercion is silent by default, but to assist in debugging potentially
locale related integration problems, explicit warnings (emitted directly on
[`stderr`](../library/sys.html#sys.stderr "sys.stderr")) can be requested by setting `PYTHONCOERCECLOCALE=warn`.
This setting will also cause the Python runtime to emit a warning if the
legacy C locale remains active when the core interpreter is initialized.

While [**PEP 538**](https://peps.python.org/pep-0538/)’s locale coercion has the benefit of also affecting extension
modules (such as GNU `readline`), as well as child processes (including those
running non\-Python applications and older versions of Python), it has the
downside of requiring that a suitable target locale be present on the running
system. To better handle the case where no suitable target locale is available
(as occurs on RHEL/CentOS 7, for example), Python 3\.7 also implements
[PEP 540: Forced UTF\-8 Runtime Mode](#whatsnew37-pep540).

See also

[**PEP 538**](https://peps.python.org/pep-0538/) – Coercing the legacy C locale to a UTF\-8 based localePEP written and implemented by Nick Coghlan.

### PEP 540: Forced UTF\-8 Runtime Mode[¶](#pep-540-forced-utf-8-runtime-mode "Link to this heading")

The new [`-X`](../using/cmdline.html#cmdoption-X) `utf8` command line option and [`PYTHONUTF8`](../using/cmdline.html#envvar-PYTHONUTF8)
environment variable can be used to enable the [Python UTF\-8 Mode](../library/os.html#utf8-mode).

When in UTF\-8 mode, CPython ignores the locale settings, and uses the
UTF\-8 encoding by default. The error handlers for [`sys.stdin`](../library/sys.html#sys.stdin "sys.stdin") and
[`sys.stdout`](../library/sys.html#sys.stdout "sys.stdout") streams are set to `surrogateescape`.

The forced UTF\-8 mode can be used to change the text handling behavior in
an embedded Python interpreter without changing the locale settings of
an embedding application.

While [**PEP 540**](https://peps.python.org/pep-0540/)’s UTF\-8 mode has the benefit of working regardless of which
locales are available on the running system, it has the downside of having no
effect on extension modules (such as GNU `readline`), child processes running
non\-Python applications, and child processes running older versions of Python.
To reduce the risk of corrupting text data when communicating with such
components, Python 3\.7 also implements [PEP 540: Forced UTF\-8 Runtime Mode](#whatsnew37-pep540)).

The UTF\-8 mode is enabled by default when the locale is `C` or `POSIX`, and
the [**PEP 538**](https://peps.python.org/pep-0538/) locale coercion feature fails to change it to a UTF\-8 based
alternative (whether that failure is due to `PYTHONCOERCECLOCALE=0` being set,
`LC_ALL` being set, or the lack of a suitable target locale).

See also

[**PEP 540**](https://peps.python.org/pep-0540/) – Add a new UTF\-8 modePEP written and implemented by Victor Stinner

### PEP 553: Built\-in `breakpoint()`[¶](#pep-553-built-in-breakpoint "Link to this heading")

Python 3\.7 includes the new built\-in [`breakpoint()`](../library/functions.html#breakpoint "breakpoint") function as
an easy and consistent way to enter the Python debugger.

Built\-in `breakpoint()` calls [`sys.breakpointhook()`](../library/sys.html#sys.breakpointhook "sys.breakpointhook"). By default, the
latter imports [`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters.") and then calls `pdb.set_trace()`, but by binding
`sys.breakpointhook()` to the function of your choosing, `breakpoint()` can
enter any debugger. Additionally, the environment variable
[`PYTHONBREAKPOINT`](../using/cmdline.html#envvar-PYTHONBREAKPOINT) can be set to the callable of your debugger of
choice. Set `PYTHONBREAKPOINT=0` to completely disable built\-in
`breakpoint()`.

See also

[**PEP 553**](https://peps.python.org/pep-0553/) – Built\-in breakpoint()PEP written and implemented by Barry Warsaw

### PEP 539: New C API for Thread\-Local Storage[¶](#pep-539-new-c-api-for-thread-local-storage "Link to this heading")

While Python provides a C API for thread\-local storage support; the existing
[Thread Local Storage (TLS) API](../c-api/init.html#thread-local-storage-api) has used
int to represent TLS keys across all platforms. This has not
generally been a problem for officially support platforms, but that is neither
POSIX\-compliant, nor portable in any practical sense.

[**PEP 539**](https://peps.python.org/pep-0539/) changes this by providing a new [Thread Specific Storage (TSS)
API](../c-api/init.html#thread-specific-storage-api) to CPython which supersedes use of the
existing TLS API within the CPython interpreter, while deprecating the existing
API. The TSS API uses a new type [`Py_tss_t`](../c-api/init.html#c.Py_tss_t "Py_tss_t") instead of int
to represent TSS keys–an opaque type the definition of which may depend on
the underlying TLS implementation. Therefore, this will allow to build CPython
on platforms where the native TLS key is defined in a way that cannot be safely
cast to int.

Note that on platforms where the native TLS key is defined in a way that cannot
be safely cast to int, all functions of the existing TLS API will be
no\-op and immediately return failure. This indicates clearly that the old API
is not supported on platforms where it cannot be used reliably, and that no
effort will be made to add such support.

See also

[**PEP 539**](https://peps.python.org/pep-0539/) – A New C\-API for Thread\-Local Storage in CPythonPEP written by Erik M. Bray; implementation by Masayuki Yamamoto.

### PEP 562: Customization of Access to Module Attributes[¶](#pep-562-customization-of-access-to-module-attributes "Link to this heading")

Python 3\.7 allows defining `__getattr__()` on modules and will call
it whenever a module attribute is otherwise not found. Defining
`__dir__()` on modules is now also allowed.

A typical example of where this may be useful is module attribute deprecation
and lazy loading.

See also

[**PEP 562**](https://peps.python.org/pep-0562/) – Module `__getattr__` and `__dir__`PEP written and implemented by Ivan Levkivskyi

### PEP 564: New Time Functions With Nanosecond Resolution[¶](#pep-564-new-time-functions-with-nanosecond-resolution "Link to this heading")

The resolution of clocks in modern systems can exceed the limited precision
of a floating\-point number returned by the [`time.time()`](../library/time.html#time.time "time.time") function
and its variants. To avoid loss of precision, [**PEP 564**](https://peps.python.org/pep-0564/) adds six new
“nanosecond” variants of the existing timer functions to the [`time`](../library/time.html#module-time "time: Time access and conversions.")
module:

* [`time.clock_gettime_ns()`](../library/time.html#time.clock_gettime_ns "time.clock_gettime_ns")
* [`time.clock_settime_ns()`](../library/time.html#time.clock_settime_ns "time.clock_settime_ns")
* [`time.monotonic_ns()`](../library/time.html#time.monotonic_ns "time.monotonic_ns")
* [`time.perf_counter_ns()`](../library/time.html#time.perf_counter_ns "time.perf_counter_ns")
* [`time.process_time_ns()`](../library/time.html#time.process_time_ns "time.process_time_ns")
* [`time.time_ns()`](../library/time.html#time.time_ns "time.time_ns")

The new functions return the number of nanoseconds as an integer value.

[**Measurements**](https://peps.python.org/pep-0564/#annex-clocks-resolution-in-python)
show that on Linux and Windows the resolution of [`time.time_ns()`](../library/time.html#time.time_ns "time.time_ns") is
approximately 3 times better than that of [`time.time()`](../library/time.html#time.time "time.time").

See also

[**PEP 564**](https://peps.python.org/pep-0564/) – Add new time functions with nanosecond resolutionPEP written and implemented by Victor Stinner

### PEP 565: Show DeprecationWarning in `__main__`[¶](#pep-565-show-deprecationwarning-in-main "Link to this heading")

The default handling of [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") has been changed such that
these warnings are once more shown by default, but only when the code
triggering them is running directly in the [`__main__`](../library/__main__.html#module-__main__ "__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``.") module. As a result,
developers of single file scripts and those using Python interactively should
once again start seeing deprecation warnings for the APIs they use, but
deprecation warnings triggered by imported application, library and framework
modules will continue to be hidden by default.

As a result of this change, the standard library now allows developers to choose
between three different deprecation warning behaviours:

* [`FutureWarning`](../library/exceptions.html#FutureWarning "FutureWarning"): always displayed by default, recommended for warnings
intended to be seen by application end users (e.g. for deprecated application
configuration settings).
* [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning"): displayed by default only in [`__main__`](../library/__main__.html#module-__main__ "__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``.") and when
running tests, recommended for warnings intended to be seen by other Python
developers where a version upgrade may result in changed behaviour or an
error.
* [`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning"): displayed by default only when running
tests, intended for cases where a future version upgrade will change the
warning category to [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") or [`FutureWarning`](../library/exceptions.html#FutureWarning "FutureWarning").

Previously both [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") and [`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning")
were only visible when running tests, which meant that developers primarily
writing single file scripts or using Python interactively could be surprised
by breaking changes in the APIs they used.

See also

[**PEP 565**](https://peps.python.org/pep-0565/) – Show DeprecationWarning in `__main__`PEP written and implemented by Nick Coghlan

### PEP 560: Core Support for `typing` module and Generic Types[¶](#pep-560-core-support-for-typing-module-and-generic-types "Link to this heading")

Initially [**PEP 484**](https://peps.python.org/pep-0484/) was designed in such way that it would not introduce *any*
changes to the core CPython interpreter. Now type hints and the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).")
module are extensively used by the community, so this restriction is removed.
The PEP introduces two special methods `__class_getitem__()` and
`__mro_entries__`, these methods are now used by most classes and special
constructs in [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`)."). As a result, the speed of various operations
with types increased up to 7 times, the generic types can be used without
metaclass conflicts, and several long standing bugs in [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module are
fixed.

See also

[**PEP 560**](https://peps.python.org/pep-0560/) – Core support for typing module and generic typesPEP written and implemented by Ivan Levkivskyi

### PEP 552: Hash\-based .pyc Files[¶](#pep-552-hash-based-pyc-files "Link to this heading")

Python has traditionally checked the up\-to\-dateness of bytecode cache files
(i.e., `.pyc` files) by comparing the source metadata (last\-modified timestamp
and size) with source metadata saved in the cache file header when it was
generated. While effective, this invalidation method has its drawbacks. When
filesystem timestamps are too coarse, Python can miss source updates, leading to
user confusion. Additionally, having a timestamp in the cache file is
problematic for [build reproducibility](https://reproducible-builds.org/) and
content\-based build systems.

[**PEP 552**](https://peps.python.org/pep-0552/) extends the pyc format to allow the hash of the source file to be
used for invalidation instead of the source timestamp. Such `.pyc` files are
called “hash\-based”. By default, Python still uses timestamp\-based invalidation
and does not generate hash\-based `.pyc` files at runtime. Hash\-based `.pyc`
files may be generated with [`py_compile`](../library/py_compile.html#module-py_compile "py_compile: Generate byte-code files from Python source files.") or [`compileall`](../library/compileall.html#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.").

Hash\-based `.pyc` files come in two variants: checked and unchecked. Python
validates checked hash\-based `.pyc` files against the corresponding source
files at runtime but doesn’t do so for unchecked hash\-based pycs. Unchecked
hash\-based `.pyc` files are a useful performance optimization for environments
where a system external to Python (e.g., the build system) is responsible for
keeping `.pyc` files up\-to\-date.

See [Cached bytecode invalidation](../reference/import.html#pyc-invalidation) for more information.

See also

[**PEP 552**](https://peps.python.org/pep-0552/) – Deterministic pycsPEP written and implemented by Benjamin Peterson

### PEP 545: Python Documentation Translations[¶](#pep-545-python-documentation-translations "Link to this heading")

[**PEP 545**](https://peps.python.org/pep-0545/) describes the process of creating and maintaining Python
documentation translations.

Three new translations have been added:

* Japanese: 
* French: 
* Korean: 

See also

[**PEP 545**](https://peps.python.org/pep-0545/) – Python Documentation TranslationsPEP written and implemented by Julien Palard, Inada Naoki, and
Victor Stinner.

### Python Development Mode (\-X dev)[¶](#python-development-mode-x-dev "Link to this heading")

The new [`-X`](../using/cmdline.html#cmdoption-X) `dev` command line option or the new
[`PYTHONDEVMODE`](../using/cmdline.html#envvar-PYTHONDEVMODE) environment variable can be used to enable
[Python Development Mode](../library/devmode.html#devmode). When in development mode, Python performs
additional runtime checks that are too expensive to be enabled by default.
See [Python Development Mode](../library/devmode.html#devmode) documentation for the full
description.

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* An [`await`](../reference/expressions.html#await) expression and comprehensions containing an
[`async for`](../reference/compound_stmts.html#async-for) clause were illegal in the expressions in
[formatted string literals](../reference/lexical_analysis.html#f-strings) due to a problem with the
implementation. In Python 3\.7 this restriction was lifted.
* More than 255 arguments can now be passed to a function, and a function can
now have more than 255 parameters. (Contributed by Serhiy Storchaka in
[bpo\-12844](https://bugs.python.org/issue?@action=redirect&bpo=12844) and [bpo\-18896](https://bugs.python.org/issue?@action=redirect&bpo=18896).)
* [`bytes.fromhex()`](../library/stdtypes.html#bytes.fromhex "bytes.fromhex") and [`bytearray.fromhex()`](../library/stdtypes.html#bytearray.fromhex "bytearray.fromhex") now ignore all ASCII
whitespace, not only spaces. (Contributed by Robert Xiao in [bpo\-28927](https://bugs.python.org/issue?@action=redirect&bpo=28927).)
* [`str`](../library/stdtypes.html#str "str"), [`bytes`](../library/stdtypes.html#bytes "bytes"), and [`bytearray`](../library/stdtypes.html#bytearray "bytearray") gained support for
the new [`isascii()`](../library/stdtypes.html#str.isascii "str.isascii") method, which can be used to
test if a string or bytes contain only the ASCII characters.
(Contributed by INADA Naoki in [bpo\-32677](https://bugs.python.org/issue?@action=redirect&bpo=32677).)
* [`ImportError`](../library/exceptions.html#ImportError "ImportError") now displays module name and module `__file__` path when
`from ... import ...` fails. (Contributed by Matthias Bussonnier in
[bpo\-29546](https://bugs.python.org/issue?@action=redirect&bpo=29546).)
* Circular imports involving absolute imports with binding a submodule to
a name are now supported.
(Contributed by Serhiy Storchaka in [bpo\-30024](https://bugs.python.org/issue?@action=redirect&bpo=30024).)
* `object.__format__(x, '')` is now equivalent to `str(x)` rather than
`format(str(self), '')`.
(Contributed by Serhiy Storchaka in [bpo\-28974](https://bugs.python.org/issue?@action=redirect&bpo=28974).)
* In order to better support dynamic creation of stack traces,
[`types.TracebackType`](../library/types.html#types.TracebackType "types.TracebackType") can now be instantiated from Python code, and
the [`tb_next`](../reference/datamodel.html#traceback.tb_next "traceback.tb_next") attribute on
[tracebacks](../reference/datamodel.html#traceback-objects) is now writable.
(Contributed by Nathaniel J. Smith in [bpo\-30579](https://bugs.python.org/issue?@action=redirect&bpo=30579).)
* When using the [`-m`](../using/cmdline.html#cmdoption-m) switch, `sys.path[0]` is now eagerly expanded
to the full starting directory path, rather than being left as the empty
directory (which allows imports from the *current* working directory at the
time when an import occurs)
(Contributed by Nick Coghlan in [bpo\-33053](https://bugs.python.org/issue?@action=redirect&bpo=33053).)
* The new [`-X`](../using/cmdline.html#cmdoption-X) `importtime` option or the
[`PYTHONPROFILEIMPORTTIME`](../using/cmdline.html#envvar-PYTHONPROFILEIMPORTTIME) environment variable can be used to show
the timing of each module import.
(Contributed by Inada Naoki in [bpo\-31415](https://bugs.python.org/issue?@action=redirect&bpo=31415).)

## New Modules[¶](#new-modules "Link to this heading")

### contextvars[¶](#contextvars "Link to this heading")

The new [`contextvars`](../library/contextvars.html#module-contextvars "contextvars: Context Variables") module and a set of
[new C APIs](../c-api/contextvars.html#contextvarsobjects) introduce
support for *context variables*. Context variables are conceptually
similar to thread\-local variables. Unlike TLS, context variables
support asynchronous code correctly.

The [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") and [`decimal`](../library/decimal.html#module-decimal "decimal: Implementation of the General Decimal Arithmetic  Specification.") modules have been updated to use
and support context variables out of the box. Particularly the active
decimal context is now stored in a context variable, which allows
decimal operations to work with the correct context in asynchronous code.

See also

[**PEP 567**](https://peps.python.org/pep-0567/) – Context VariablesPEP written and implemented by Yury Selivanov

### dataclasses[¶](#dataclasses "Link to this heading")

The new [`dataclass()`](../library/dataclasses.html#dataclasses.dataclass "dataclasses.dataclass") decorator provides a way to declare
*data classes*. A data class describes its attributes using class variable
annotations. Its constructor and other magic methods, such as
[`__repr__()`](../reference/datamodel.html#object.__repr__ "object.__repr__"), [`__eq__()`](../reference/datamodel.html#object.__eq__ "object.__eq__"), and
[`__hash__()`](../reference/datamodel.html#object.__hash__ "object.__hash__") are generated automatically.

Example:

\`\`\`
@dataclass
class Point:
 x: float
 y: float
 z: float = 0\.0

p = Point(1\.5, 2\.5\)
print(p) \# produces "Point(x=1\.5, y=2\.5, z=0\.0\)"

\`\`\`

See also

[**PEP 557**](https://peps.python.org/pep-0557/) – Data ClassesPEP written and implemented by Eric V. Smith

### importlib.resources[¶](#importlib-resources "Link to this heading")

The new [`importlib.resources`](../library/importlib.resources.html#module-importlib.resources "importlib.resources: Package resource reading, opening, and access") module provides several new APIs and one
new ABC for access to, opening, and reading *resources* inside packages.
Resources are roughly similar to files inside packages, but they needn’t
be actual files on the physical file system. Module loaders can provide a
`get_resource_reader()` function which returns
a [`importlib.abc.ResourceReader`](../library/importlib.html#importlib.abc.ResourceReader "importlib.abc.ResourceReader") instance to support this
new API. Built\-in file path loaders and zip file loaders both support this.

Contributed by Barry Warsaw and Brett Cannon in [bpo\-32248](https://bugs.python.org/issue?@action=redirect&bpo=32248).

See also

[importlib\_resources](https://importlib-resources.readthedocs.io/en/latest/)
– a PyPI backport for earlier Python versions.

## Improved Modules[¶](#improved-modules "Link to this heading")

### argparse[¶](#argparse "Link to this heading")

The new [`ArgumentParser.parse_intermixed_args()`](../library/argparse.html#argparse.ArgumentParser.parse_intermixed_args "argparse.ArgumentParser.parse_intermixed_args")
method allows intermixing options and positional arguments.
(Contributed by paul.j3 in [bpo\-14191](https://bugs.python.org/issue?@action=redirect&bpo=14191).)

### asyncio[¶](#asyncio "Link to this heading")

The [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module has received many new features, usability and
[performance improvements](#whatsnew37-asyncio-perf). Notable changes
include:

* The new [provisional](../glossary.html#term-provisional-API) [`asyncio.run()`](../library/asyncio-runner.html#asyncio.run "asyncio.run") function can
be used to run a coroutine from synchronous code by automatically creating and
destroying the event loop.
(Contributed by Yury Selivanov in [bpo\-32314](https://bugs.python.org/issue?@action=redirect&bpo=32314).)
* asyncio gained support for [`contextvars`](../library/contextvars.html#module-contextvars "contextvars: Context Variables").
[`loop.call_soon()`](../library/asyncio-eventloop.html#asyncio.loop.call_soon "asyncio.loop.call_soon"),
[`loop.call_soon_threadsafe()`](../library/asyncio-eventloop.html#asyncio.loop.call_soon_threadsafe "asyncio.loop.call_soon_threadsafe"),
[`loop.call_later()`](../library/asyncio-eventloop.html#asyncio.loop.call_later "asyncio.loop.call_later"),
[`loop.call_at()`](../library/asyncio-eventloop.html#asyncio.loop.call_at "asyncio.loop.call_at"), and
[`Future.add_done_callback()`](../library/asyncio-future.html#asyncio.Future.add_done_callback "asyncio.Future.add_done_callback")
have a new optional keyword\-only *context* parameter.
[`Tasks`](../library/asyncio-task.html#asyncio.Task "asyncio.Task") now track their context automatically.
See [**PEP 567**](https://peps.python.org/pep-0567/) for more details.
(Contributed by Yury Selivanov in [bpo\-32436](https://bugs.python.org/issue?@action=redirect&bpo=32436).)
* The new [`asyncio.create_task()`](../library/asyncio-task.html#asyncio.create_task "asyncio.create_task") function has been added as a shortcut
to `asyncio.get_event_loop().create_task()`.
(Contributed by Andrew Svetlov in [bpo\-32311](https://bugs.python.org/issue?@action=redirect&bpo=32311).)
* The new [`loop.start_tls()`](../library/asyncio-eventloop.html#asyncio.loop.start_tls "asyncio.loop.start_tls")
method can be used to upgrade an existing connection to TLS.
(Contributed by Yury Selivanov in [bpo\-23749](https://bugs.python.org/issue?@action=redirect&bpo=23749).)
* The new [`loop.sock_recv_into()`](../library/asyncio-eventloop.html#asyncio.loop.sock_recv_into "asyncio.loop.sock_recv_into")
method allows reading data from a socket directly into a provided buffer making
it possible to reduce data copies.
(Contributed by Antoine Pitrou in [bpo\-31819](https://bugs.python.org/issue?@action=redirect&bpo=31819).)
* The new [`asyncio.current_task()`](../library/asyncio-task.html#asyncio.current_task "asyncio.current_task") function returns the currently running
[`Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task") instance, and the new [`asyncio.all_tasks()`](../library/asyncio-task.html#asyncio.all_tasks "asyncio.all_tasks")
function returns a set of all existing `Task` instances in a given loop.
The `Task.current_task()` and
`Task.all_tasks()` methods have been deprecated.
(Contributed by Andrew Svetlov in [bpo\-32250](https://bugs.python.org/issue?@action=redirect&bpo=32250).)
* The new *provisional* [`BufferedProtocol`](../library/asyncio-protocol.html#asyncio.BufferedProtocol "asyncio.BufferedProtocol") class allows
implementing streaming protocols with manual control over the receive buffer.
(Contributed by Yury Selivanov in [bpo\-32251](https://bugs.python.org/issue?@action=redirect&bpo=32251).)
* The new [`asyncio.get_running_loop()`](../library/asyncio-eventloop.html#asyncio.get_running_loop "asyncio.get_running_loop") function returns the currently
running loop, and raises a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") if no loop is running.
This is in contrast with [`asyncio.get_event_loop()`](../library/asyncio-eventloop.html#asyncio.get_event_loop "asyncio.get_event_loop"), which will *create*
a new event loop if none is running.
(Contributed by Yury Selivanov in [bpo\-32269](https://bugs.python.org/issue?@action=redirect&bpo=32269).)
* The new [`StreamWriter.wait_closed()`](../library/asyncio-stream.html#asyncio.StreamWriter.wait_closed "asyncio.StreamWriter.wait_closed")
coroutine method allows waiting until the stream writer is closed. The new
[`StreamWriter.is_closing()`](../library/asyncio-stream.html#asyncio.StreamWriter.is_closing "asyncio.StreamWriter.is_closing") method
can be used to determine if the writer is closing.
(Contributed by Andrew Svetlov in [bpo\-32391](https://bugs.python.org/issue?@action=redirect&bpo=32391).)
* The new [`loop.sock_sendfile()`](../library/asyncio-eventloop.html#asyncio.loop.sock_sendfile "asyncio.loop.sock_sendfile")
coroutine method allows sending files using [`os.sendfile`](../library/os.html#os.sendfile "os.sendfile") when possible.
(Contributed by Andrew Svetlov in [bpo\-32410](https://bugs.python.org/issue?@action=redirect&bpo=32410).)
* The new [`Future.get_loop()`](../library/asyncio-future.html#asyncio.Future.get_loop "asyncio.Future.get_loop") and
`Task.get_loop()` methods return the instance of the loop on which a task or
a future were created.
[`Server.get_loop()`](../library/asyncio-eventloop.html#asyncio.Server.get_loop "asyncio.Server.get_loop") allows doing the same for
[`asyncio.Server`](../library/asyncio-eventloop.html#asyncio.Server "asyncio.Server") objects.
(Contributed by Yury Selivanov in [bpo\-32415](https://bugs.python.org/issue?@action=redirect&bpo=32415) and
Srinivas Reddy Thatiparthy in [bpo\-32418](https://bugs.python.org/issue?@action=redirect&bpo=32418).)
* It is now possible to control how instances of [`asyncio.Server`](../library/asyncio-eventloop.html#asyncio.Server "asyncio.Server") begin
serving. Previously, the server would start serving immediately when created.
The new *start\_serving* keyword argument to
[`loop.create_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_server "asyncio.loop.create_server") and
[`loop.create_unix_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_unix_server "asyncio.loop.create_unix_server"),
as well as [`Server.start_serving()`](../library/asyncio-eventloop.html#asyncio.Server.start_serving "asyncio.Server.start_serving"), and
[`Server.serve_forever()`](../library/asyncio-eventloop.html#asyncio.Server.serve_forever "asyncio.Server.serve_forever")
can be used to decouple server instantiation and serving. The new
[`Server.is_serving()`](../library/asyncio-eventloop.html#asyncio.Server.is_serving "asyncio.Server.is_serving") method returns `True`
if the server is serving. [`Server`](../library/asyncio-eventloop.html#asyncio.Server "asyncio.Server") objects are now
asynchronous context managers:

\`\`\`
srv = await loop.create\_server(...)

async with srv:
 \# some code

\# At this point, srv is closed and no longer accepts new connections.

\`\`\`

(Contributed by Yury Selivanov in [bpo\-32662](https://bugs.python.org/issue?@action=redirect&bpo=32662).)
* Callback objects returned by
[`loop.call_later()`](../library/asyncio-eventloop.html#asyncio.loop.call_later "asyncio.loop.call_later")
gained the new [`when()`](../library/asyncio-eventloop.html#asyncio.TimerHandle.when "asyncio.TimerHandle.when") method which
returns an absolute scheduled callback timestamp.
(Contributed by Andrew Svetlov in [bpo\-32741](https://bugs.python.org/issue?@action=redirect&bpo=32741).)
* The [`loop.create_datagram_endpoint()`](../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint")  method
gained support for Unix sockets.
(Contributed by Quentin Dawans in [bpo\-31245](https://bugs.python.org/issue?@action=redirect&bpo=31245).)
* The [`asyncio.open_connection()`](../library/asyncio-stream.html#asyncio.open_connection "asyncio.open_connection"), [`asyncio.start_server()`](../library/asyncio-stream.html#asyncio.start_server "asyncio.start_server") functions,
[`loop.create_connection()`](../library/asyncio-eventloop.html#asyncio.loop.create_connection "asyncio.loop.create_connection"),
[`loop.create_server()`](../library/asyncio-eventloop.html#asyncio.loop.create_server "asyncio.loop.create_server"),
[`loop.create_accepted_socket()`](../library/asyncio-eventloop.html#asyncio.loop.connect_accepted_socket "asyncio.loop.connect_accepted_socket")
methods and their corresponding UNIX socket variants now accept the
*ssl\_handshake\_timeout* keyword argument.
(Contributed by Neil Aspinall in [bpo\-29970](https://bugs.python.org/issue?@action=redirect&bpo=29970).)
* The new [`Handle.cancelled()`](../library/asyncio-eventloop.html#asyncio.Handle.cancelled "asyncio.Handle.cancelled") method returns
`True` if the callback was cancelled.
(Contributed by Marat Sharafutdinov in [bpo\-31943](https://bugs.python.org/issue?@action=redirect&bpo=31943).)
* The asyncio source has been converted to use the
[`async`](../reference/compound_stmts.html#async)/[`await`](../reference/expressions.html#await) syntax.
(Contributed by Andrew Svetlov in [bpo\-32193](https://bugs.python.org/issue?@action=redirect&bpo=32193).)
* The new [`ReadTransport.is_reading()`](../library/asyncio-protocol.html#asyncio.ReadTransport.is_reading "asyncio.ReadTransport.is_reading")
method can be used to determine the reading state of the transport.
Additionally, calls to
[`ReadTransport.resume_reading()`](../library/asyncio-protocol.html#asyncio.ReadTransport.resume_reading "asyncio.ReadTransport.resume_reading")
and [`ReadTransport.pause_reading()`](../library/asyncio-protocol.html#asyncio.ReadTransport.pause_reading "asyncio.ReadTransport.pause_reading")
are now idempotent.
(Contributed by Yury Selivanov in [bpo\-32356](https://bugs.python.org/issue?@action=redirect&bpo=32356).)
* Loop methods which accept socket paths now support passing
[path\-like objects](../glossary.html#term-path-like-object).
(Contributed by Yury Selivanov in [bpo\-32066](https://bugs.python.org/issue?@action=redirect&bpo=32066).)
* In [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") TCP sockets on Linux are now created with `TCP_NODELAY`
flag set by default.
(Contributed by Yury Selivanov and Victor Stinner in [bpo\-27456](https://bugs.python.org/issue?@action=redirect&bpo=27456).)
* Exceptions occurring in cancelled tasks are no longer logged.
(Contributed by Yury Selivanov in [bpo\-30508](https://bugs.python.org/issue?@action=redirect&bpo=30508).)
* New `WindowsSelectorEventLoopPolicy` and
`WindowsProactorEventLoopPolicy` classes.
(Contributed by Yury Selivanov in [bpo\-33792](https://bugs.python.org/issue?@action=redirect&bpo=33792).)

Several `asyncio` APIs have been
[deprecated](#whatsnew37-asyncio-deprecated).

### binascii[¶](#binascii "Link to this heading")

The [`b2a_uu()`](../library/binascii.html#binascii.b2a_uu "binascii.b2a_uu") function now accepts an optional *backtick*
keyword argument. When it’s true, zeros are represented by `'`'`
instead of spaces. (Contributed by Xiang Zhang in [bpo\-30103](https://bugs.python.org/issue?@action=redirect&bpo=30103).)

### calendar[¶](#calendar "Link to this heading")

The [`HTMLCalendar`](../library/calendar.html#calendar.HTMLCalendar "calendar.HTMLCalendar") class has new class attributes which ease
the customization of CSS classes in the produced HTML calendar.
(Contributed by Oz Tiram in [bpo\-30095](https://bugs.python.org/issue?@action=redirect&bpo=30095).)

### collections[¶](#collections "Link to this heading")

`collections.namedtuple()` now supports default values.
(Contributed by Raymond Hettinger in [bpo\-32320](https://bugs.python.org/issue?@action=redirect&bpo=32320).)

### compileall[¶](#compileall "Link to this heading")

[`compileall.compile_dir()`](../library/compileall.html#compileall.compile_dir "compileall.compile_dir") learned the new *invalidation\_mode* parameter,
which can be used to enable
[hash\-based .pyc invalidation](#whatsnew37-pep552). The invalidation
mode can also be specified on the command line using the new
`--invalidation-mode` argument.
(Contributed by Benjamin Peterson in [bpo\-31650](https://bugs.python.org/issue?@action=redirect&bpo=31650).)

### concurrent.futures[¶](#concurrent-futures "Link to this heading")

[`ProcessPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor "concurrent.futures.ProcessPoolExecutor") and
[`ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor") now
support the new *initializer* and *initargs* constructor arguments.
(Contributed by Antoine Pitrou in [bpo\-21423](https://bugs.python.org/issue?@action=redirect&bpo=21423).)

The [`ProcessPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor "concurrent.futures.ProcessPoolExecutor")
can now take the multiprocessing context via the new *mp\_context* argument.
(Contributed by Thomas Moreau in [bpo\-31540](https://bugs.python.org/issue?@action=redirect&bpo=31540).)

### contextlib[¶](#contextlib "Link to this heading")

The new [`nullcontext()`](../library/contextlib.html#contextlib.nullcontext "contextlib.nullcontext") is a simpler and faster no\-op
context manager than [`ExitStack`](../library/contextlib.html#contextlib.ExitStack "contextlib.ExitStack").
(Contributed by Jesse\-Bakker in [bpo\-10049](https://bugs.python.org/issue?@action=redirect&bpo=10049).)

The new [`asynccontextmanager()`](../library/contextlib.html#contextlib.asynccontextmanager "contextlib.asynccontextmanager"),
[`AbstractAsyncContextManager`](../library/contextlib.html#contextlib.AbstractAsyncContextManager "contextlib.AbstractAsyncContextManager"), and
[`AsyncExitStack`](../library/contextlib.html#contextlib.AsyncExitStack "contextlib.AsyncExitStack") have been added to
complement their synchronous counterparts. (Contributed
by Jelle Zijlstra in [bpo\-29679](https://bugs.python.org/issue?@action=redirect&bpo=29679) and [bpo\-30241](https://bugs.python.org/issue?@action=redirect&bpo=30241),
and by Alexander Mohr and Ilya Kulakov in [bpo\-29302](https://bugs.python.org/issue?@action=redirect&bpo=29302).)

### cProfile[¶](#cprofile "Link to this heading")

The [`cProfile`](../library/profile.html#module-cProfile "cProfile") command line now accepts `-m module_name` as an
alternative to script path. (Contributed by Sanyam Khurana in [bpo\-21862](https://bugs.python.org/issue?@action=redirect&bpo=21862).)

### crypt[¶](#crypt "Link to this heading")

The `crypt` module now supports the Blowfish hashing method.
(Contributed by Serhiy Storchaka in [bpo\-31664](https://bugs.python.org/issue?@action=redirect&bpo=31664).)

The `mksalt()` function now allows specifying the number of rounds
for hashing. (Contributed by Serhiy Storchaka in [bpo\-31702](https://bugs.python.org/issue?@action=redirect&bpo=31702).)

### datetime[¶](#datetime "Link to this heading")

The new [`datetime.fromisoformat()`](../library/datetime.html#datetime.datetime.fromisoformat "datetime.datetime.fromisoformat")
method constructs a [`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") object from a string
in one of the formats output by
[`datetime.isoformat()`](../library/datetime.html#datetime.datetime.isoformat "datetime.datetime.isoformat").
(Contributed by Paul Ganssle in [bpo\-15873](https://bugs.python.org/issue?@action=redirect&bpo=15873).)

The [`tzinfo`](../library/datetime.html#datetime.tzinfo "datetime.tzinfo") class now supports sub\-minute offsets.
(Contributed by Alexander Belopolsky in [bpo\-5288](https://bugs.python.org/issue?@action=redirect&bpo=5288).)

### dbm[¶](#dbm "Link to this heading")

[`dbm.dumb`](../library/dbm.html#module-dbm.dumb "dbm.dumb: Portable implementation of the simple DBM interface.") now supports reading read\-only files and no longer writes the
index file when it is not changed.

### decimal[¶](#decimal "Link to this heading")

The [`decimal`](../library/decimal.html#module-decimal "decimal: Implementation of the General Decimal Arithmetic  Specification.") module now uses [context variables](#whatsnew37-pep567)
to store the decimal context.
(Contributed by Yury Selivanov in [bpo\-32630](https://bugs.python.org/issue?@action=redirect&bpo=32630).)

### dis[¶](#dis "Link to this heading")

The [`dis()`](../library/dis.html#dis.dis "dis.dis") function is now able to
disassemble nested code objects (the code of comprehensions, generator
expressions and nested functions, and the code used for building nested
classes). The maximum depth of disassembly recursion is controlled by
the new *depth* parameter.
(Contributed by Serhiy Storchaka in [bpo\-11822](https://bugs.python.org/issue?@action=redirect&bpo=11822).)

### distutils[¶](#distutils "Link to this heading")

`README.rst` is now included in the list of distutils standard READMEs and
therefore included in source distributions.
(Contributed by Ryan Gonzalez in [bpo\-11913](https://bugs.python.org/issue?@action=redirect&bpo=11913).)

### enum[¶](#enum "Link to this heading")

The [`Enum`](../library/enum.html#enum.Enum "enum.Enum") learned the new `_ignore_` class property,
which allows listing the names of properties which should not become
enum members.
(Contributed by Ethan Furman in [bpo\-31801](https://bugs.python.org/issue?@action=redirect&bpo=31801).)

In Python 3\.8, attempting to check for non\-Enum objects in `Enum`
classes will raise a [`TypeError`](../library/exceptions.html#TypeError "TypeError") (e.g. `1 in Color`); similarly,
attempting to check for non\-Flag objects in a `Flag` member will
raise [`TypeError`](../library/exceptions.html#TypeError "TypeError") (e.g. `1 in Perm.RW`); currently, both operations
return [`False`](../library/constants.html#False "False") instead and are deprecated.
(Contributed by Ethan Furman in [bpo\-33217](https://bugs.python.org/issue?@action=redirect&bpo=33217).)

### functools[¶](#functools "Link to this heading")

[`functools.singledispatch()`](../library/functools.html#functools.singledispatch "functools.singledispatch") now supports registering implementations
using type annotations.
(Contributed by Łukasz Langa in [bpo\-32227](https://bugs.python.org/issue?@action=redirect&bpo=32227).)

### gc[¶](#gc "Link to this heading")

The new [`gc.freeze()`](../library/gc.html#gc.freeze "gc.freeze") function allows freezing all objects tracked
by the garbage collector and excluding them from future collections.
This can be used before a POSIX `fork()` call to make the GC copy\-on\-write
friendly or to speed up collection. The new [`gc.unfreeze()`](../library/gc.html#gc.unfreeze "gc.unfreeze") functions
reverses this operation. Additionally, [`gc.get_freeze_count()`](../library/gc.html#gc.get_freeze_count "gc.get_freeze_count") can
be used to obtain the number of frozen objects.
(Contributed by Li Zekun in [bpo\-31558](https://bugs.python.org/issue?@action=redirect&bpo=31558).)

### hmac[¶](#hmac "Link to this heading")

The [`hmac`](../library/hmac.html#module-hmac "hmac: Keyed-Hashing for Message Authentication (HMAC) implementation") module now has an optimized one\-shot [`digest()`](../library/hmac.html#hmac.digest "hmac.digest")
function, which is up to three times faster than `HMAC()`.
(Contributed by Christian Heimes in [bpo\-32433](https://bugs.python.org/issue?@action=redirect&bpo=32433).)

### http.client[¶](#http-client "Link to this heading")

[`HTTPConnection`](../library/http.client.html#http.client.HTTPConnection "http.client.HTTPConnection") and [`HTTPSConnection`](../library/http.client.html#http.client.HTTPSConnection "http.client.HTTPSConnection")
now support the new *blocksize* argument for improved upload throughput.
(Contributed by Nir Soffer in [bpo\-31945](https://bugs.python.org/issue?@action=redirect&bpo=31945).)

### http.server[¶](#http-server "Link to this heading")

[`SimpleHTTPRequestHandler`](../library/http.server.html#http.server.SimpleHTTPRequestHandler "http.server.SimpleHTTPRequestHandler") now supports the HTTP
`If-Modified-Since` header. The server returns the 304 response status if
the target file was not modified after the time specified in the header.
(Contributed by Pierre Quentel in [bpo\-29654](https://bugs.python.org/issue?@action=redirect&bpo=29654).)

[`SimpleHTTPRequestHandler`](../library/http.server.html#http.server.SimpleHTTPRequestHandler "http.server.SimpleHTTPRequestHandler") accepts the new *directory*
argument, in addition to the new `--directory` command line argument.
With this parameter, the server serves the specified directory, by default it
uses the current working directory.
(Contributed by Stéphane Wirtel and Julien Palard in [bpo\-28707](https://bugs.python.org/issue?@action=redirect&bpo=28707).)

The new [`ThreadingHTTPServer`](../library/http.server.html#http.server.ThreadingHTTPServer "http.server.ThreadingHTTPServer") class
uses threads to handle requests using `ThreadingMixin`.
It is used when `http.server` is run with `-m`.
(Contributed by Julien Palard in [bpo\-31639](https://bugs.python.org/issue?@action=redirect&bpo=31639).)

### idlelib and IDLE[¶](#idlelib-and-idle "Link to this heading")

Multiple fixes for autocompletion. (Contributed by Louie Lu in [bpo\-15786](https://bugs.python.org/issue?@action=redirect&bpo=15786).)

Module Browser (on the File menu, formerly called Class Browser),
now displays nested functions and classes in addition to top\-level
functions and classes.
(Contributed by Guilherme Polo, Cheryl Sabella, and Terry Jan Reedy
in [bpo\-1612262](https://bugs.python.org/issue?@action=redirect&bpo=1612262).)

The Settings dialog (Options, Configure IDLE) has been partly rewritten
to improve both appearance and function.
(Contributed by Cheryl Sabella and Terry Jan Reedy in multiple issues.)

The font sample now includes a selection of non\-Latin characters so that
users can better see the effect of selecting a particular font.
(Contributed by Terry Jan Reedy in [bpo\-13802](https://bugs.python.org/issue?@action=redirect&bpo=13802).)
The sample can be edited to include other characters.
(Contributed by Serhiy Storchaka in [bpo\-31860](https://bugs.python.org/issue?@action=redirect&bpo=31860).)

The IDLE features formerly implemented as extensions have been reimplemented
as normal features. Their settings have been moved from the Extensions tab
to other dialog tabs.
(Contributed by Charles Wohlganger and Terry Jan Reedy in [bpo\-27099](https://bugs.python.org/issue?@action=redirect&bpo=27099).)

Editor code context option revised. Box displays all context lines up to
maxlines. Clicking on a context line jumps the editor to that line. Context
colors for custom themes is added to Highlights tab of Settings dialog.
(Contributed by Cheryl Sabella and Terry Jan Reedy in [bpo\-33642](https://bugs.python.org/issue?@action=redirect&bpo=33642),
[bpo\-33768](https://bugs.python.org/issue?@action=redirect&bpo=33768), and [bpo\-33679](https://bugs.python.org/issue?@action=redirect&bpo=33679).)

On Windows, a new API call tells Windows that tk scales for DPI. On Windows
8\.1\+ or 10, with DPI compatibility properties of the Python binary
unchanged, and a monitor resolution greater than 96 DPI, this should
make text and lines sharper. It should otherwise have no effect.
(Contributed by Terry Jan Reedy in [bpo\-33656](https://bugs.python.org/issue?@action=redirect&bpo=33656).)

New in 3\.7\.1:

Output over N lines (50 by default) is squeezed down to a button.
N can be changed in the PyShell section of the General page of the
Settings dialog. Fewer, but possibly extra long, lines can be squeezed by
right clicking on the output. Squeezed output can be expanded in place
by double\-clicking the button or into the clipboard or a separate window
by right\-clicking the button. (Contributed by Tal Einat in [bpo\-1529353](https://bugs.python.org/issue?@action=redirect&bpo=1529353).)

The changes above have been backported to 3\.6 maintenance releases.

NEW in 3\.7\.4:

Add “Run Customized” to the Run menu to run a module with customized
settings. Any command line arguments entered are added to sys.argv.
They re\-appear in the box for the next customized run. One can also
suppress the normal Shell main module restart. (Contributed by Cheryl
Sabella, Terry Jan Reedy, and others in [bpo\-5680](https://bugs.python.org/issue?@action=redirect&bpo=5680) and [bpo\-37627](https://bugs.python.org/issue?@action=redirect&bpo=37627).)

New in 3\.7\.5:

Add optional line numbers for IDLE editor windows. Windows
open without line numbers unless set otherwise in the General
tab of the configuration dialog. Line numbers for an existing
window are shown and hidden in the Options menu.
(Contributed by Tal Einat and Saimadhav Heblikar in [bpo\-17535](https://bugs.python.org/issue?@action=redirect&bpo=17535).)

### importlib[¶](#importlib "Link to this heading")

The [`importlib.abc.ResourceReader`](../library/importlib.html#importlib.abc.ResourceReader "importlib.abc.ResourceReader") ABC was introduced to
support the loading of resources from packages. See also
[importlib.resources](#whatsnew37-importlib-resources).
(Contributed by Barry Warsaw, Brett Cannon in [bpo\-32248](https://bugs.python.org/issue?@action=redirect&bpo=32248).)

[`importlib.reload()`](../library/importlib.html#importlib.reload "importlib.reload") now raises [`ModuleNotFoundError`](../library/exceptions.html#ModuleNotFoundError "ModuleNotFoundError") if the module
lacks a spec.
(Contributed by Garvit Khatri in [bpo\-29851](https://bugs.python.org/issue?@action=redirect&bpo=29851).)

`importlib.find_spec()` now raises [`ModuleNotFoundError`](../library/exceptions.html#ModuleNotFoundError "ModuleNotFoundError") instead of
[`AttributeError`](../library/exceptions.html#AttributeError "AttributeError") if the specified parent module is not a package (i.e.
lacks a `__path__` attribute).
(Contributed by Milan Oberkirch in [bpo\-30436](https://bugs.python.org/issue?@action=redirect&bpo=30436).)

The new `importlib.source_hash()` can be used to compute the hash of
the passed source. A [hash\-based .pyc file](#whatsnew37-pep552)
embeds the value returned by this function.

### io[¶](#io "Link to this heading")

The new [`TextIOWrapper.reconfigure()`](../library/io.html#io.TextIOWrapper.reconfigure "io.TextIOWrapper.reconfigure")
method can be used to reconfigure the text stream with the new settings.
(Contributed by Antoine Pitrou in [bpo\-30526](https://bugs.python.org/issue?@action=redirect&bpo=30526) and
INADA Naoki in [bpo\-15216](https://bugs.python.org/issue?@action=redirect&bpo=15216).)

### ipaddress[¶](#ipaddress "Link to this heading")

The new `subnet_of()` and `supernet_of()` methods of
[`ipaddress.IPv6Network`](../library/ipaddress.html#ipaddress.IPv6Network "ipaddress.IPv6Network") and [`ipaddress.IPv4Network`](../library/ipaddress.html#ipaddress.IPv4Network "ipaddress.IPv4Network") can
be used for network containment tests.
(Contributed by Michel Albert and Cheryl Sabella in [bpo\-20825](https://bugs.python.org/issue?@action=redirect&bpo=20825).)

### itertools[¶](#itertools "Link to this heading")

[`itertools.islice()`](../library/itertools.html#itertools.islice "itertools.islice") now accepts
[`integer-like objects`](../reference/datamodel.html#object.__index__ "object.__index__") as start, stop,
and slice arguments.
(Contributed by Will Roberts in [bpo\-30537](https://bugs.python.org/issue?@action=redirect&bpo=30537).)

### locale[¶](#locale "Link to this heading")

The new *monetary* argument to [`locale.format_string()`](../library/locale.html#locale.format_string "locale.format_string") can be used
to make the conversion use monetary thousands separators and
grouping strings. (Contributed by Garvit in [bpo\-10379](https://bugs.python.org/issue?@action=redirect&bpo=10379).)

The [`locale.getpreferredencoding()`](../library/locale.html#locale.getpreferredencoding "locale.getpreferredencoding") function now always returns `'UTF-8'`
on Android or when in the [forced UTF\-8 mode](#whatsnew37-pep540).

### logging[¶](#logging "Link to this heading")

[`Logger`](../library/logging.html#logging.Logger "logging.Logger") instances can now be pickled.
(Contributed by Vinay Sajip in [bpo\-30520](https://bugs.python.org/issue?@action=redirect&bpo=30520).)

The new [`StreamHandler.setStream()`](../library/logging.handlers.html#logging.StreamHandler.setStream "logging.StreamHandler.setStream")
method can be used to replace the logger stream after handler creation.
(Contributed by Vinay Sajip in [bpo\-30522](https://bugs.python.org/issue?@action=redirect&bpo=30522).)

It is now possible to specify keyword arguments to handler constructors in
configuration passed to [`logging.config.fileConfig()`](../library/logging.config.html#logging.config.fileConfig "logging.config.fileConfig").
(Contributed by Preston Landers in [bpo\-31080](https://bugs.python.org/issue?@action=redirect&bpo=31080).)

### math[¶](#math "Link to this heading")

The new [`math.remainder()`](../library/math.html#math.remainder "math.remainder") function implements the IEEE 754\-style remainder
operation. (Contributed by Mark Dickinson in [bpo\-29962](https://bugs.python.org/issue?@action=redirect&bpo=29962).)

### mimetypes[¶](#mimetypes "Link to this heading")

The MIME type of .bmp has been changed from `'image/x-ms-bmp'` to
`'image/bmp'`.
(Contributed by Nitish Chandra in [bpo\-22589](https://bugs.python.org/issue?@action=redirect&bpo=22589).)

### msilib[¶](#msilib "Link to this heading")

The new `Database.Close()` method can be used
to close the MSI database.
(Contributed by Berker Peksag in [bpo\-20486](https://bugs.python.org/issue?@action=redirect&bpo=20486).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

The new [`Process.close()`](../library/multiprocessing.html#multiprocessing.Process.close "multiprocessing.Process.close") method
explicitly closes the process object and releases all resources associated
with it. [`ValueError`](../library/exceptions.html#ValueError "ValueError") is raised if the underlying process is still
running.
(Contributed by Antoine Pitrou in [bpo\-30596](https://bugs.python.org/issue?@action=redirect&bpo=30596).)

The new [`Process.kill()`](../library/multiprocessing.html#multiprocessing.Process.kill "multiprocessing.Process.kill") method can
be used to terminate the process using the `SIGKILL` signal on Unix.
(Contributed by Vitor Pereira in [bpo\-30794](https://bugs.python.org/issue?@action=redirect&bpo=30794).)

Non\-daemonic threads created by [`Process`](../library/multiprocessing.html#multiprocessing.Process "multiprocessing.Process") are now
joined on process exit.
(Contributed by Antoine Pitrou in [bpo\-18966](https://bugs.python.org/issue?@action=redirect&bpo=18966).)

### os[¶](#os "Link to this heading")

[`os.fwalk()`](../library/os.html#os.fwalk "os.fwalk") now accepts the *path* argument as [`bytes`](../library/stdtypes.html#bytes "bytes").
(Contributed by Serhiy Storchaka in [bpo\-28682](https://bugs.python.org/issue?@action=redirect&bpo=28682).)

[`os.scandir()`](../library/os.html#os.scandir "os.scandir") gained support for [file descriptors](../library/os.html#path-fd).
(Contributed by Serhiy Storchaka in [bpo\-25996](https://bugs.python.org/issue?@action=redirect&bpo=25996).)

The new [`register_at_fork()`](../library/os.html#os.register_at_fork "os.register_at_fork") function allows registering Python
callbacks to be executed at process fork.
(Contributed by Antoine Pitrou in [bpo\-16500](https://bugs.python.org/issue?@action=redirect&bpo=16500).)

Added [`os.preadv()`](../library/os.html#os.preadv "os.preadv") (combine the functionality of [`os.readv()`](../library/os.html#os.readv "os.readv") and
[`os.pread()`](../library/os.html#os.pread "os.pread")) and [`os.pwritev()`](../library/os.html#os.pwritev "os.pwritev") functions (combine the functionality
of [`os.writev()`](../library/os.html#os.writev "os.writev") and [`os.pwrite()`](../library/os.html#os.pwrite "os.pwrite")). (Contributed by Pablo Galindo in
[bpo\-31368](https://bugs.python.org/issue?@action=redirect&bpo=31368).)

The mode argument of [`os.makedirs()`](../library/os.html#os.makedirs "os.makedirs") no longer affects the file
permission bits of newly created intermediate\-level directories.
(Contributed by Serhiy Storchaka in [bpo\-19930](https://bugs.python.org/issue?@action=redirect&bpo=19930).)

[`os.dup2()`](../library/os.html#os.dup2 "os.dup2") now returns the new file descriptor. Previously, `None`
was always returned.
(Contributed by Benjamin Peterson in [bpo\-32441](https://bugs.python.org/issue?@action=redirect&bpo=32441).)

The structure returned by [`os.stat()`](../library/os.html#os.stat "os.stat") now contains the
[`st_fstype`](../library/os.html#os.stat_result.st_fstype "os.stat_result.st_fstype") attribute on Solaris and its derivatives.
(Contributed by Jesús Cea Avión in [bpo\-32659](https://bugs.python.org/issue?@action=redirect&bpo=32659).)

### pathlib[¶](#pathlib "Link to this heading")

The new [`Path.is_mount()`](../library/pathlib.html#pathlib.Path.is_mount "pathlib.Path.is_mount") method is now available
on POSIX systems and can be used to determine whether a path is a mount point.
(Contributed by Cooper Ry Lees in [bpo\-30897](https://bugs.python.org/issue?@action=redirect&bpo=30897).)

### pdb[¶](#pdb "Link to this heading")

[`pdb.set_trace()`](../library/pdb.html#pdb.set_trace "pdb.set_trace") now takes an optional *header* keyword\-only
argument. If given, it is printed to the console just before debugging
begins. (Contributed by Barry Warsaw in [bpo\-31389](https://bugs.python.org/issue?@action=redirect&bpo=31389).)

[`pdb`](../library/pdb.html#module-pdb "pdb: The Python debugger for interactive interpreters.") command line now accepts `-m module_name` as an alternative to
script file. (Contributed by Mario Corchero in [bpo\-32206](https://bugs.python.org/issue?@action=redirect&bpo=32206).)

### py\_compile[¶](#py-compile "Link to this heading")

[`py_compile.compile()`](../library/py_compile.html#py_compile.compile "py_compile.compile") – and by extension, [`compileall`](../library/compileall.html#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.") – now
respects the `SOURCE_DATE_EPOCH` environment variable by
unconditionally creating `.pyc` files for hash\-based validation.
This allows for guaranteeing
[reproducible builds](https://reproducible-builds.org/) of `.pyc`
files when they are created eagerly. (Contributed by Bernhard M. Wiedemann
in [bpo\-29708](https://bugs.python.org/issue?@action=redirect&bpo=29708).)

### pydoc[¶](#pydoc "Link to this heading")

The pydoc server can now bind to an arbitrary hostname specified by the
new `-n` command\-line argument.
(Contributed by Feanil Patel in [bpo\-31128](https://bugs.python.org/issue?@action=redirect&bpo=31128).)

### queue[¶](#queue "Link to this heading")

The new [`SimpleQueue`](../library/queue.html#queue.SimpleQueue "queue.SimpleQueue") class is an unbounded FIFO queue.
(Contributed by Antoine Pitrou in [bpo\-14976](https://bugs.python.org/issue?@action=redirect&bpo=14976).)

### re[¶](#re "Link to this heading")

The flags [`re.ASCII`](../library/re.html#re.ASCII "re.ASCII"), [`re.LOCALE`](../library/re.html#re.LOCALE "re.LOCALE") and [`re.UNICODE`](../library/re.html#re.UNICODE "re.UNICODE")
can be set within the scope of a group.
(Contributed by Serhiy Storchaka in [bpo\-31690](https://bugs.python.org/issue?@action=redirect&bpo=31690).)

[`re.split()`](../library/re.html#re.split "re.split") now supports splitting on a pattern like `r'\b'`,
`'^$'` or `(?=-)` that matches an empty string.
(Contributed by Serhiy Storchaka in [bpo\-25054](https://bugs.python.org/issue?@action=redirect&bpo=25054).)

Regular expressions compiled with the [`re.LOCALE`](../library/re.html#re.LOCALE "re.LOCALE") flag no longer
depend on the locale at compile time. Locale settings are applied only
when the compiled regular expression is used.
(Contributed by Serhiy Storchaka in [bpo\-30215](https://bugs.python.org/issue?@action=redirect&bpo=30215).)

[`FutureWarning`](../library/exceptions.html#FutureWarning "FutureWarning") is now emitted if a regular expression contains
character set constructs that will change semantically in the future,
such as nested sets and set operations.
(Contributed by Serhiy Storchaka in [bpo\-30349](https://bugs.python.org/issue?@action=redirect&bpo=30349).)

Compiled regular expression and match objects can now be copied
using [`copy.copy()`](../library/copy.html#copy.copy "copy.copy") and [`copy.deepcopy()`](../library/copy.html#copy.deepcopy "copy.deepcopy").
(Contributed by Serhiy Storchaka in [bpo\-10076](https://bugs.python.org/issue?@action=redirect&bpo=10076).)

### signal[¶](#signal "Link to this heading")

The new *warn\_on\_full\_buffer* argument to the [`signal.set_wakeup_fd()`](../library/signal.html#signal.set_wakeup_fd "signal.set_wakeup_fd")
function makes it possible to specify whether Python prints a warning on
stderr when the wakeup buffer overflows.
(Contributed by Nathaniel J. Smith in [bpo\-30050](https://bugs.python.org/issue?@action=redirect&bpo=30050).)

### socket[¶](#socket "Link to this heading")

The new [`socket.getblocking()`](../library/socket.html#socket.socket.getblocking "socket.socket.getblocking") method
returns `True` if the socket is in blocking mode and `False` otherwise.
(Contributed by Yury Selivanov in [bpo\-32373](https://bugs.python.org/issue?@action=redirect&bpo=32373).)

The new [`socket.close()`](../library/socket.html#socket.close "socket.close") function closes the passed socket file descriptor.
This function should be used instead of [`os.close()`](../library/os.html#os.close "os.close") for better
compatibility across platforms.
(Contributed by Christian Heimes in [bpo\-32454](https://bugs.python.org/issue?@action=redirect&bpo=32454).)

The [`socket`](../library/socket.html#module-socket "socket: Low-level networking interface.") module now exposes the `socket.TCP_CONGESTION`
(Linux 2\.6\.13\), `socket.TCP_USER_TIMEOUT` (Linux 2\.6\.37\), and
`socket.TCP_NOTSENT_LOWAT` (Linux 3\.12\) constants.
(Contributed by Omar Sandoval in [bpo\-26273](https://bugs.python.org/issue?@action=redirect&bpo=26273) and
Nathaniel J. Smith in [bpo\-29728](https://bugs.python.org/issue?@action=redirect&bpo=29728).)

Support for [`socket.AF_VSOCK`](../library/socket.html#socket.AF_VSOCK "socket.AF_VSOCK") sockets has been added to allow
communication between virtual machines and their hosts.
(Contributed by Cathy Avery in [bpo\-27584](https://bugs.python.org/issue?@action=redirect&bpo=27584).)

Sockets now auto\-detect family, type and protocol from file descriptor
by default.
(Contributed by Christian Heimes in [bpo\-28134](https://bugs.python.org/issue?@action=redirect&bpo=28134).)

### socketserver[¶](#socketserver "Link to this heading")

`socketserver.ThreadingMixIn.server_close()` now waits until all non\-daemon
threads complete. `socketserver.ForkingMixIn.server_close()` now waits
until all child processes complete.

Add a new `socketserver.ForkingMixIn.block_on_close` class attribute to
[`socketserver.ForkingMixIn`](../library/socketserver.html#socketserver.ForkingMixIn "socketserver.ForkingMixIn") and [`socketserver.ThreadingMixIn`](../library/socketserver.html#socketserver.ThreadingMixIn "socketserver.ThreadingMixIn")
classes. Set the class attribute to `False` to get the pre\-3\.7 behaviour.

### sqlite3[¶](#sqlite3 "Link to this heading")

[`sqlite3.Connection`](../library/sqlite3.html#sqlite3.Connection "sqlite3.Connection") now exposes the [`backup()`](../library/sqlite3.html#sqlite3.Connection.backup "sqlite3.Connection.backup")
method when the underlying SQLite library is at version 3\.6\.11 or higher.
(Contributed by Lele Gaifax in [bpo\-27645](https://bugs.python.org/issue?@action=redirect&bpo=27645).)

The *database* argument of [`sqlite3.connect()`](../library/sqlite3.html#sqlite3.connect "sqlite3.connect") now accepts any
[path\-like object](../glossary.html#term-path-like-object), instead of just a string.
(Contributed by Anders Lorentsen in [bpo\-31843](https://bugs.python.org/issue?@action=redirect&bpo=31843).)

### ssl[¶](#ssl "Link to this heading")

The [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module now uses OpenSSL’s builtin API instead of
`match_hostname()` to check a host name or an IP address. Values
are validated during TLS handshake. Any certificate validation error
including failing the host name check now raises
[`SSLCertVerificationError`](../library/ssl.html#ssl.SSLCertVerificationError "ssl.SSLCertVerificationError") and aborts the handshake with a proper
TLS Alert message. The new exception contains additional information.
Host name validation can be customized with
[`SSLContext.hostname_checks_common_name`](../library/ssl.html#ssl.SSLContext.hostname_checks_common_name "ssl.SSLContext.hostname_checks_common_name").
(Contributed by Christian Heimes in [bpo\-31399](https://bugs.python.org/issue?@action=redirect&bpo=31399).)

Note

The improved host name check requires a *libssl* implementation compatible
with OpenSSL 1\.0\.2 or 1\.1\. Consequently, OpenSSL 0\.9\.8 and 1\.0\.1 are no
longer supported (see [Platform Support Removals](#platform-support-removals) for more details).
The ssl module is mostly compatible with LibreSSL 2\.7\.2 and newer.

The `ssl` module no longer sends IP addresses in SNI TLS extension.
(Contributed by Christian Heimes in [bpo\-32185](https://bugs.python.org/issue?@action=redirect&bpo=32185).)

`match_hostname()` no longer supports partial wildcards like
`www*.example.org`.
(Contributed by Mandeep Singh in [bpo\-23033](https://bugs.python.org/issue?@action=redirect&bpo=23033) and Christian Heimes in
[bpo\-31399](https://bugs.python.org/issue?@action=redirect&bpo=31399).)

The default cipher suite selection of the `ssl` module now uses a blacklist
approach rather than a hard\-coded whitelist. Python no longer re\-enables
ciphers that have been blocked by OpenSSL security updates. Default cipher
suite selection can be configured at compile time.
(Contributed by Christian Heimes in [bpo\-31429](https://bugs.python.org/issue?@action=redirect&bpo=31429).)

Validation of server certificates containing internationalized domain names
(IDNs) is now supported. As part of this change, the
[`SSLSocket.server_hostname`](../library/ssl.html#ssl.SSLSocket.server_hostname "ssl.SSLSocket.server_hostname") attribute
now stores the expected hostname in A\-label form (`"xn--pythn-mua.org"`),
rather than the U\-label form (`"pythön.org"`). (Contributed by
Nathaniel J. Smith and Christian Heimes in [bpo\-28414](https://bugs.python.org/issue?@action=redirect&bpo=28414).)

The `ssl` module has preliminary and experimental support for TLS 1\.3 and
OpenSSL 1\.1\.1\. At the time of Python 3\.7\.0 release, OpenSSL 1\.1\.1 is still
under development and TLS 1\.3 hasn’t been finalized yet. The TLS 1\.3
handshake and protocol behaves slightly differently than TLS 1\.2 and earlier,
see [TLS 1\.3](../library/ssl.html#ssl-tlsv1-3).
(Contributed by Christian Heimes in [bpo\-32947](https://bugs.python.org/issue?@action=redirect&bpo=32947), [bpo\-20995](https://bugs.python.org/issue?@action=redirect&bpo=20995),
[bpo\-29136](https://bugs.python.org/issue?@action=redirect&bpo=29136), [bpo\-30622](https://bugs.python.org/issue?@action=redirect&bpo=30622) and [bpo\-33618](https://bugs.python.org/issue?@action=redirect&bpo=33618))

[`SSLSocket`](../library/ssl.html#ssl.SSLSocket "ssl.SSLSocket") and [`SSLObject`](../library/ssl.html#ssl.SSLObject "ssl.SSLObject") no longer have a public
constructor. Direct instantiation was never a documented and supported
feature. Instances must be created with [`SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext") methods
[`wrap_socket()`](../library/ssl.html#ssl.SSLContext.wrap_socket "ssl.SSLContext.wrap_socket") and [`wrap_bio()`](../library/ssl.html#ssl.SSLContext.wrap_bio "ssl.SSLContext.wrap_bio").
(Contributed by Christian Heimes in [bpo\-32951](https://bugs.python.org/issue?@action=redirect&bpo=32951))

OpenSSL 1\.1 APIs for setting the minimum and maximum TLS protocol version are
available as [`SSLContext.minimum_version`](../library/ssl.html#ssl.SSLContext.minimum_version "ssl.SSLContext.minimum_version")
and [`SSLContext.maximum_version`](../library/ssl.html#ssl.SSLContext.maximum_version "ssl.SSLContext.maximum_version").
Supported protocols are indicated by several new flags, such as
[`HAS_TLSv1_1`](../library/ssl.html#ssl.HAS_TLSv1_1 "ssl.HAS_TLSv1_1").
(Contributed by Christian Heimes in [bpo\-32609](https://bugs.python.org/issue?@action=redirect&bpo=32609).)

Added [`ssl.SSLContext.post_handshake_auth`](../library/ssl.html#ssl.SSLContext.post_handshake_auth "ssl.SSLContext.post_handshake_auth") to enable and
[`ssl.SSLSocket.verify_client_post_handshake()`](../library/ssl.html#ssl.SSLSocket.verify_client_post_handshake "ssl.SSLSocket.verify_client_post_handshake") to initiate TLS 1\.3
post\-handshake authentication.
(Contributed by Christian Heimes in [gh\-78851](https://github.com/python/cpython/issues/78851).)

### string[¶](#string "Link to this heading")

[`string.Template`](../library/string.html#string.Template "string.Template") now lets you to optionally modify the regular
expression pattern for braced placeholders and non\-braced placeholders
separately. (Contributed by Barry Warsaw in [bpo\-1198569](https://bugs.python.org/issue?@action=redirect&bpo=1198569).)

### subprocess[¶](#subprocess "Link to this heading")

The [`subprocess.run()`](../library/subprocess.html#subprocess.run "subprocess.run") function accepts the new *capture\_output*
keyword argument. When true, stdout and stderr will be captured.
This is equivalent to passing [`subprocess.PIPE`](../library/subprocess.html#subprocess.PIPE "subprocess.PIPE") as *stdout* and
*stderr* arguments.
(Contributed by Bo Bayles in [bpo\-32102](https://bugs.python.org/issue?@action=redirect&bpo=32102).)

The `subprocess.run` function and the [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") constructor
now accept the *text* keyword argument as an alias
to *universal\_newlines*.
(Contributed by Andrew Clegg in [bpo\-31756](https://bugs.python.org/issue?@action=redirect&bpo=31756).)

On Windows the default for *close\_fds* was changed from `False` to
`True` when redirecting the standard handles. It’s now possible to set
*close\_fds* to true when redirecting the standard handles. See
[`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen"). This means that *close\_fds* now defaults to
`True` on all supported platforms.
(Contributed by Segev Finer in [bpo\-19764](https://bugs.python.org/issue?@action=redirect&bpo=19764).)

The subprocess module is now more graceful when handling
[`KeyboardInterrupt`](../library/exceptions.html#KeyboardInterrupt "KeyboardInterrupt") during [`subprocess.call()`](../library/subprocess.html#subprocess.call "subprocess.call"),
[`subprocess.run()`](../library/subprocess.html#subprocess.run "subprocess.run"), or in a [`Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen")
context manager. It now waits a short amount of time for the child
to exit, before continuing the handling of the `KeyboardInterrupt`
exception.
(Contributed by Gregory P. Smith in [bpo\-25942](https://bugs.python.org/issue?@action=redirect&bpo=25942).)

### sys[¶](#sys "Link to this heading")

The new [`sys.breakpointhook()`](../library/sys.html#sys.breakpointhook "sys.breakpointhook") hook function is called by the
built\-in [`breakpoint()`](../library/functions.html#breakpoint "breakpoint").
(Contributed by Barry Warsaw in [bpo\-31353](https://bugs.python.org/issue?@action=redirect&bpo=31353).)

On Android, the new [`sys.getandroidapilevel()`](../library/sys.html#sys.getandroidapilevel "sys.getandroidapilevel") returns the build\-time
Android API version.
(Contributed by Victor Stinner in [bpo\-28740](https://bugs.python.org/issue?@action=redirect&bpo=28740).)

The new [`sys.get_coroutine_origin_tracking_depth()`](../library/sys.html#sys.get_coroutine_origin_tracking_depth "sys.get_coroutine_origin_tracking_depth") function returns
the current coroutine origin tracking depth, as set by
the new [`sys.set_coroutine_origin_tracking_depth()`](../library/sys.html#sys.set_coroutine_origin_tracking_depth "sys.set_coroutine_origin_tracking_depth"). [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.")
has been converted to use this new API instead of
the deprecated `sys.set_coroutine_wrapper()`.
(Contributed by Nathaniel J. Smith in [bpo\-32591](https://bugs.python.org/issue?@action=redirect&bpo=32591).)

### time[¶](#time "Link to this heading")

[**PEP 564**](https://peps.python.org/pep-0564/) adds six new functions with nanosecond resolution to the
[`time`](../library/time.html#module-time "time: Time access and conversions.") module:

* [`time.clock_gettime_ns()`](../library/time.html#time.clock_gettime_ns "time.clock_gettime_ns")
* [`time.clock_settime_ns()`](../library/time.html#time.clock_settime_ns "time.clock_settime_ns")
* [`time.monotonic_ns()`](../library/time.html#time.monotonic_ns "time.monotonic_ns")
* [`time.perf_counter_ns()`](../library/time.html#time.perf_counter_ns "time.perf_counter_ns")
* [`time.process_time_ns()`](../library/time.html#time.process_time_ns "time.process_time_ns")
* [`time.time_ns()`](../library/time.html#time.time_ns "time.time_ns")

New clock identifiers have been added:

* [`time.CLOCK_BOOTTIME`](../library/time.html#time.CLOCK_BOOTTIME "time.CLOCK_BOOTTIME") (Linux): Identical to
[`time.CLOCK_MONOTONIC`](../library/time.html#time.CLOCK_MONOTONIC "time.CLOCK_MONOTONIC"), except it also includes any time that the
system is suspended.
* [`time.CLOCK_PROF`](../library/time.html#time.CLOCK_PROF "time.CLOCK_PROF") (FreeBSD, NetBSD and OpenBSD): High\-resolution
per\-process CPU timer.
* [`time.CLOCK_UPTIME`](../library/time.html#time.CLOCK_UPTIME "time.CLOCK_UPTIME") (FreeBSD, OpenBSD): Time whose absolute value is
the time the system has been running and not suspended, providing accurate
uptime measurement.

The new [`time.thread_time()`](../library/time.html#time.thread_time "time.thread_time") and [`time.thread_time_ns()`](../library/time.html#time.thread_time_ns "time.thread_time_ns") functions
can be used to get per\-thread CPU time measurements.
(Contributed by Antoine Pitrou in [bpo\-32025](https://bugs.python.org/issue?@action=redirect&bpo=32025).)

The new [`time.pthread_getcpuclockid()`](../library/time.html#time.pthread_getcpuclockid "time.pthread_getcpuclockid") function returns the clock ID
of the thread\-specific CPU\-time clock.

### tkinter[¶](#tkinter "Link to this heading")

The new [`tkinter.ttk.Spinbox`](../library/tkinter.ttk.html#tkinter.ttk.Spinbox "tkinter.ttk.Spinbox") class is now available.
(Contributed by Alan Moore in [bpo\-32585](https://bugs.python.org/issue?@action=redirect&bpo=32585).)

### tracemalloc[¶](#tracemalloc "Link to this heading")

[`tracemalloc.Traceback`](../library/tracemalloc.html#tracemalloc.Traceback "tracemalloc.Traceback") behaves more like regular tracebacks,
sorting the frames from oldest to most recent.
[`Traceback.format()`](../library/tracemalloc.html#tracemalloc.Traceback.format "tracemalloc.Traceback.format")
now accepts negative *limit*, truncating the result to the
`abs(limit)` oldest frames. To get the old behaviour, use
the new *most\_recent\_first* argument to `Traceback.format()`.
(Contributed by Jesse Bakker in [bpo\-32121](https://bugs.python.org/issue?@action=redirect&bpo=32121).)

### types[¶](#types "Link to this heading")

The new [`WrapperDescriptorType`](../library/types.html#types.WrapperDescriptorType "types.WrapperDescriptorType"),
[`MethodWrapperType`](../library/types.html#types.MethodWrapperType "types.MethodWrapperType"), [`MethodDescriptorType`](../library/types.html#types.MethodDescriptorType "types.MethodDescriptorType"),
and [`ClassMethodDescriptorType`](../library/types.html#types.ClassMethodDescriptorType "types.ClassMethodDescriptorType") classes are now available.
(Contributed by Manuel Krebber and Guido van Rossum in [bpo\-29377](https://bugs.python.org/issue?@action=redirect&bpo=29377),
and Serhiy Storchaka in [bpo\-32265](https://bugs.python.org/issue?@action=redirect&bpo=32265).)

The new [`types.resolve_bases()`](../library/types.html#types.resolve_bases "types.resolve_bases") function resolves MRO entries
dynamically as specified by [**PEP 560**](https://peps.python.org/pep-0560/).
(Contributed by Ivan Levkivskyi in [bpo\-32717](https://bugs.python.org/issue?@action=redirect&bpo=32717).)

### unicodedata[¶](#unicodedata "Link to this heading")

The internal [`unicodedata`](../library/unicodedata.html#module-unicodedata "unicodedata: Access the Unicode Database.") database has been upgraded to use [Unicode 11](https://www.unicode.org/versions/Unicode11.0.0/). (Contributed by Benjamin
Peterson.)

### unittest[¶](#unittest "Link to this heading")

The new `-k` command\-line option allows filtering tests by a name
substring or a Unix shell\-like pattern.
For example, `python -m unittest -k foo` runs
`foo_tests.SomeTest.test_something`, `bar_tests.SomeTest.test_foo`,
but not `bar_tests.FooTest.test_something`.
(Contributed by Jonas Haag in [bpo\-32071](https://bugs.python.org/issue?@action=redirect&bpo=32071).)

### unittest.mock[¶](#unittest-mock "Link to this heading")

The [`sentinel`](../library/unittest.mock.html#unittest.mock.sentinel "unittest.mock.sentinel") attributes now preserve their identity
when they are [`copied`](../library/copy.html#module-copy "copy: Shallow and deep copy operations.") or [`pickled`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back."). (Contributed by
Serhiy Storchaka in [bpo\-20804](https://bugs.python.org/issue?@action=redirect&bpo=20804).)

The new [`seal()`](../library/unittest.mock.html#unittest.mock.seal "unittest.mock.seal") function allows sealing
[`Mock`](../library/unittest.mock.html#unittest.mock.Mock "unittest.mock.Mock") instances, which will disallow further creation
of attribute mocks. The seal is applied recursively to all attributes that
are themselves mocks.
(Contributed by Mario Corchero in [bpo\-30541](https://bugs.python.org/issue?@action=redirect&bpo=30541).)

### urllib.parse[¶](#urllib-parse "Link to this heading")

[`urllib.parse.quote()`](../library/urllib.parse.html#urllib.parse.quote "urllib.parse.quote") has been updated from [**RFC 2396**](https://datatracker.ietf.org/doc/html/rfc2396.html) to [**RFC 3986**](https://datatracker.ietf.org/doc/html/rfc3986.html),
adding `~` to the set of characters that are never quoted by default.
(Contributed by Christian Theune and Ratnadeep Debnath in [bpo\-16285](https://bugs.python.org/issue?@action=redirect&bpo=16285).)

### uu[¶](#uu "Link to this heading")

The `uu.encode()` function now accepts an optional *backtick*
keyword argument. When it’s true, zeros are represented by `'`'`
instead of spaces. (Contributed by Xiang Zhang in [bpo\-30103](https://bugs.python.org/issue?@action=redirect&bpo=30103).)

### uuid[¶](#uuid "Link to this heading")

The new [`UUID.is_safe`](../library/uuid.html#uuid.UUID.is_safe "uuid.UUID.is_safe") attribute relays information
from the platform about whether generated UUIDs are generated with a
multiprocessing\-safe method.
(Contributed by Barry Warsaw in [bpo\-22807](https://bugs.python.org/issue?@action=redirect&bpo=22807).)

[`uuid.getnode()`](../library/uuid.html#uuid.getnode "uuid.getnode") now prefers universally administered
MAC addresses over locally administered MAC addresses.
This makes a better guarantee for global uniqueness of UUIDs returned
from [`uuid.uuid1()`](../library/uuid.html#uuid.uuid1 "uuid.uuid1"). If only locally administered MAC addresses are
available, the first such one found is returned.
(Contributed by Barry Warsaw in [bpo\-32107](https://bugs.python.org/issue?@action=redirect&bpo=32107).)

### warnings[¶](#warnings "Link to this heading")

The initialization of the default warnings filters has changed as follows:

* warnings enabled via command line options (including those for [`-b`](../using/cmdline.html#cmdoption-b)
and the new CPython\-specific [`-X`](../using/cmdline.html#cmdoption-X) `dev` option) are always passed
to the warnings machinery via the [`sys.warnoptions`](../library/sys.html#sys.warnoptions "sys.warnoptions") attribute.
* warnings filters enabled via the command line or the environment now have the
following order of precedence:

	+ the `BytesWarning` filter for [`-b`](../using/cmdline.html#cmdoption-b) (or `-bb`)
	+ any filters specified with the [`-W`](../using/cmdline.html#cmdoption-W) option
	+ any filters specified with the [`PYTHONWARNINGS`](../using/cmdline.html#envvar-PYTHONWARNINGS) environment
	variable
	+ any other CPython specific filters (e.g. the `default` filter added
	for the new `-X dev` mode)
	+ any implicit filters defined directly by the warnings machinery
* in [CPython debug builds](../using/configure.html#debug-build), all warnings are now displayed
by default (the implicit filter list is empty)

(Contributed by Nick Coghlan and Victor Stinner in [bpo\-20361](https://bugs.python.org/issue?@action=redirect&bpo=20361),
[bpo\-32043](https://bugs.python.org/issue?@action=redirect&bpo=32043), and [bpo\-32230](https://bugs.python.org/issue?@action=redirect&bpo=32230).)

Deprecation warnings are once again shown by default in single\-file scripts and
at the interactive prompt. See [PEP 565: Show DeprecationWarning in \_\_main\_\_](#whatsnew37-pep565) for details.
(Contributed by Nick Coghlan in [bpo\-31975](https://bugs.python.org/issue?@action=redirect&bpo=31975).)

### xml[¶](#xml "Link to this heading")

As mitigation against DTD and external entity retrieval, the
[`xml.dom.minidom`](../library/xml.dom.minidom.html#module-xml.dom.minidom "xml.dom.minidom: Minimal Document Object Model (DOM) implementation.") and [`xml.sax`](../library/xml.sax.html#module-xml.sax "xml.sax: Package containing SAX2 base classes and convenience functions.") modules no longer process
external entities by default.
(Contributed by Christian Heimes in [gh\-61441](https://github.com/python/cpython/issues/61441).)

### xml.etree[¶](#xml-etree "Link to this heading")

[ElementPath](../library/xml.etree.elementtree.html#elementtree-xpath) predicates in the `find()`
methods can now compare text of the current node with `[. = "text"]`,
not only text in children. Predicates also allow adding spaces for
better readability. (Contributed by Stefan Behnel in [bpo\-31648](https://bugs.python.org/issue?@action=redirect&bpo=31648).)

### xmlrpc.server[¶](#xmlrpc-server "Link to this heading")

`SimpleXMLRPCDispatcher.register_function`
can now be used as a decorator. (Contributed by Xiang Zhang in
[bpo\-7769](https://bugs.python.org/issue?@action=redirect&bpo=7769).)

### zipapp[¶](#zipapp "Link to this heading")

Function [`create_archive()`](../library/zipapp.html#zipapp.create_archive "zipapp.create_archive") now accepts an optional *filter*
argument to allow the user to select which files should be included in the
archive. (Contributed by Irmen de Jong in [bpo\-31072](https://bugs.python.org/issue?@action=redirect&bpo=31072).)

Function [`create_archive()`](../library/zipapp.html#zipapp.create_archive "zipapp.create_archive") now accepts an optional *compressed*
argument to generate a compressed archive. A command line option
`--compress` has also been added to support compression.
(Contributed by Zhiming Wang in [bpo\-31638](https://bugs.python.org/issue?@action=redirect&bpo=31638).)

### zipfile[¶](#zipfile "Link to this heading")

[`ZipFile`](../library/zipfile.html#zipfile.ZipFile "zipfile.ZipFile") now accepts the new *compresslevel* parameter to
control the compression level.
(Contributed by Bo Bayles in [bpo\-21417](https://bugs.python.org/issue?@action=redirect&bpo=21417).)

Subdirectories in archives created by `ZipFile` are now stored in
alphabetical order.
(Contributed by Bernhard M. Wiedemann in [bpo\-30693](https://bugs.python.org/issue?@action=redirect&bpo=30693).)

## C API Changes[¶](#c-api-changes "Link to this heading")

A new API for thread\-local storage has been implemented. See
[PEP 539: New C API for Thread\-Local Storage](#whatsnew37-pep539) for an overview and
[Thread Specific Storage (TSS) API](../c-api/init.html#thread-specific-storage-api) for a complete reference.
(Contributed by Masayuki Yamamoto in [bpo\-25658](https://bugs.python.org/issue?@action=redirect&bpo=25658).)

The new [context variables](#whatsnew37-pep567) functionality
exposes a number of [new C APIs](../c-api/contextvars.html#contextvarsobjects).

The new [`PyImport_GetModule()`](../c-api/import.html#c.PyImport_GetModule "PyImport_GetModule") function returns the previously
imported module with the given name.
(Contributed by Eric Snow in [bpo\-28411](https://bugs.python.org/issue?@action=redirect&bpo=28411).)

The new [`Py_RETURN_RICHCOMPARE`](../c-api/typeobj.html#c.Py_RETURN_RICHCOMPARE "Py_RETURN_RICHCOMPARE") macro eases writing rich
comparison functions.
(Contributed by Petr Victorin in [bpo\-23699](https://bugs.python.org/issue?@action=redirect&bpo=23699).)

The new [`Py_UNREACHABLE`](../c-api/intro.html#c.Py_UNREACHABLE "Py_UNREACHABLE") macro can be used to mark unreachable
code paths.
(Contributed by Barry Warsaw in [bpo\-31338](https://bugs.python.org/issue?@action=redirect&bpo=31338).)

The [`tracemalloc`](../library/tracemalloc.html#module-tracemalloc "tracemalloc: Trace memory allocations.") now exposes a C API through the new
[`PyTraceMalloc_Track()`](../c-api/memory.html#c.PyTraceMalloc_Track "PyTraceMalloc_Track") and [`PyTraceMalloc_Untrack()`](../c-api/memory.html#c.PyTraceMalloc_Untrack "PyTraceMalloc_Untrack")
functions.
(Contributed by Victor Stinner in [bpo\-30054](https://bugs.python.org/issue?@action=redirect&bpo=30054).)

The new `import__find__load__start()` and
`import__find__load__done()` static markers can be used to trace
module imports.
(Contributed by Christian Heimes in [bpo\-31574](https://bugs.python.org/issue?@action=redirect&bpo=31574).)

The fields `name` and `doc` of structures
[`PyMemberDef`](../c-api/structures.html#c.PyMemberDef "PyMemberDef"), [`PyGetSetDef`](../c-api/structures.html#c.PyGetSetDef "PyGetSetDef"),
[`PyStructSequence_Field`](../c-api/tuple.html#c.PyStructSequence_Field "PyStructSequence_Field"), [`PyStructSequence_Desc`](../c-api/tuple.html#c.PyStructSequence_Desc "PyStructSequence_Desc"),
and `wrapperbase` are now of type `const char *` rather of
`char *`. (Contributed by Serhiy Storchaka in [bpo\-28761](https://bugs.python.org/issue?@action=redirect&bpo=28761).)

The result of [`PyUnicode_AsUTF8AndSize()`](../c-api/unicode.html#c.PyUnicode_AsUTF8AndSize "PyUnicode_AsUTF8AndSize") and [`PyUnicode_AsUTF8()`](../c-api/unicode.html#c.PyUnicode_AsUTF8 "PyUnicode_AsUTF8")
is now of type `const char *` rather of `char *`. (Contributed by Serhiy
Storchaka in [bpo\-28769](https://bugs.python.org/issue?@action=redirect&bpo=28769).)

The result of [`PyMapping_Keys()`](../c-api/mapping.html#c.PyMapping_Keys "PyMapping_Keys"), [`PyMapping_Values()`](../c-api/mapping.html#c.PyMapping_Values "PyMapping_Values") and
[`PyMapping_Items()`](../c-api/mapping.html#c.PyMapping_Items "PyMapping_Items") is now always a list, rather than a list or a
tuple. (Contributed by Oren Milman in [bpo\-28280](https://bugs.python.org/issue?@action=redirect&bpo=28280).)

Added functions [`PySlice_Unpack()`](../c-api/slice.html#c.PySlice_Unpack "PySlice_Unpack") and [`PySlice_AdjustIndices()`](../c-api/slice.html#c.PySlice_AdjustIndices "PySlice_AdjustIndices").
(Contributed by Serhiy Storchaka in [bpo\-27867](https://bugs.python.org/issue?@action=redirect&bpo=27867).)

[`PyOS_AfterFork()`](../c-api/sys.html#c.PyOS_AfterFork "PyOS_AfterFork") is deprecated in favour of the new functions
[`PyOS_BeforeFork()`](../c-api/sys.html#c.PyOS_BeforeFork "PyOS_BeforeFork"), [`PyOS_AfterFork_Parent()`](../c-api/sys.html#c.PyOS_AfterFork_Parent "PyOS_AfterFork_Parent") and
[`PyOS_AfterFork_Child()`](../c-api/sys.html#c.PyOS_AfterFork_Child "PyOS_AfterFork_Child"). (Contributed by Antoine Pitrou in
[bpo\-16500](https://bugs.python.org/issue?@action=redirect&bpo=16500).)

The `PyExc_RecursionErrorInst` singleton that was part of the public API
has been removed as its members being never cleared may cause a segfault
during finalization of the interpreter. Contributed by Xavier de Gaye in
[bpo\-22898](https://bugs.python.org/issue?@action=redirect&bpo=22898) and [bpo\-30697](https://bugs.python.org/issue?@action=redirect&bpo=30697).

Added C API support for timezones with timezone constructors
[`PyTimeZone_FromOffset()`](../c-api/datetime.html#c.PyTimeZone_FromOffset "PyTimeZone_FromOffset") and [`PyTimeZone_FromOffsetAndName()`](../c-api/datetime.html#c.PyTimeZone_FromOffsetAndName "PyTimeZone_FromOffsetAndName"),
and access to the UTC singleton with [`PyDateTime_TimeZone_UTC`](../c-api/datetime.html#c.PyDateTime_TimeZone_UTC "PyDateTime_TimeZone_UTC").
Contributed by Paul Ganssle in [bpo\-10381](https://bugs.python.org/issue?@action=redirect&bpo=10381).

The type of results of `PyThread_start_new_thread()` and
`PyThread_get_thread_ident()`, and the *id* parameter of
[`PyThreadState_SetAsyncExc()`](../c-api/init.html#c.PyThreadState_SetAsyncExc "PyThreadState_SetAsyncExc") changed from long to
unsigned long.
(Contributed by Serhiy Storchaka in [bpo\-6532](https://bugs.python.org/issue?@action=redirect&bpo=6532).)

[`PyUnicode_AsWideCharString()`](../c-api/unicode.html#c.PyUnicode_AsWideCharString "PyUnicode_AsWideCharString") now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the
second argument is `NULL` and the wchar\_t\* string contains null
characters. (Contributed by Serhiy Storchaka in [bpo\-30708](https://bugs.python.org/issue?@action=redirect&bpo=30708).)

Changes to the startup sequence and the management of dynamic memory
allocators mean that the long documented requirement to call
[`Py_Initialize()`](../c-api/init.html#c.Py_Initialize "Py_Initialize") before calling most C API functions is now
relied on more heavily, and failing to abide by it may lead to segfaults in
embedding applications. See the [Porting to Python 3\.7](#porting-to-python-37) section in this
document and the [Before Python Initialization](../c-api/init.html#pre-init-safe) section in the C API documentation
for more details.

The new [`PyInterpreterState_GetID()`](../c-api/init.html#c.PyInterpreterState_GetID "PyInterpreterState_GetID") returns the unique ID for a
given interpreter.
(Contributed by Eric Snow in [bpo\-29102](https://bugs.python.org/issue?@action=redirect&bpo=29102).)

[`Py_DecodeLocale()`](../c-api/sys.html#c.Py_DecodeLocale "Py_DecodeLocale"), [`Py_EncodeLocale()`](../c-api/sys.html#c.Py_EncodeLocale "Py_EncodeLocale") now use the UTF\-8
encoding when the [UTF\-8 mode](#whatsnew37-pep540) is enabled.
(Contributed by Victor Stinner in [bpo\-29240](https://bugs.python.org/issue?@action=redirect&bpo=29240).)

[`PyUnicode_DecodeLocaleAndSize()`](../c-api/unicode.html#c.PyUnicode_DecodeLocaleAndSize "PyUnicode_DecodeLocaleAndSize") and [`PyUnicode_EncodeLocale()`](../c-api/unicode.html#c.PyUnicode_EncodeLocale "PyUnicode_EncodeLocale")
now use the current locale encoding for `surrogateescape` error handler.
(Contributed by Victor Stinner in [bpo\-29240](https://bugs.python.org/issue?@action=redirect&bpo=29240).)

The *start* and *end* parameters of [`PyUnicode_FindChar()`](../c-api/unicode.html#c.PyUnicode_FindChar "PyUnicode_FindChar") are
now adjusted to behave like string slices.
(Contributed by Xiang Zhang in [bpo\-28822](https://bugs.python.org/issue?@action=redirect&bpo=28822).)

## Build Changes[¶](#build-changes "Link to this heading")

Support for building `--without-threads` has been removed. The
[`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") module is now always available.
(Contributed by Antoine Pitrou in [bpo\-31370](https://bugs.python.org/issue?@action=redirect&bpo=31370).).

A full copy of libffi is no longer bundled for use when building the
[`_ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python.") module on non\-OSX UNIX platforms. An installed copy
of libffi is now required when building `_ctypes` on such platforms.
(Contributed by Zachary Ware in [bpo\-27979](https://bugs.python.org/issue?@action=redirect&bpo=27979).)

The Windows build process no longer depends on Subversion to pull in external
sources, a Python script is used to download zipfiles from GitHub instead.
If Python 3\.6 is not found on the system (via `py -3.6`), NuGet is used to
download a copy of 32\-bit Python for this purpose. (Contributed by Zachary
Ware in [bpo\-30450](https://bugs.python.org/issue?@action=redirect&bpo=30450).)

The [`ssl`](../library/ssl.html#module-ssl "ssl: TLS/SSL wrapper for socket objects") module requires OpenSSL 1\.0\.2 or 1\.1 compatible libssl.
OpenSSL 1\.0\.1 has reached end of lifetime on 2016\-12\-31 and is no longer
supported. LibreSSL is temporarily not supported as well. LibreSSL releases
up to version 2\.6\.4 are missing required OpenSSL 1\.0\.2 APIs.

## Optimizations[¶](#optimizations "Link to this heading")

The overhead of calling many methods of various standard library classes
implemented in C has been significantly reduced by porting more code
to use the `METH_FASTCALL` convention.
(Contributed by Victor Stinner in [bpo\-29300](https://bugs.python.org/issue?@action=redirect&bpo=29300), [bpo\-29507](https://bugs.python.org/issue?@action=redirect&bpo=29507),
[bpo\-29452](https://bugs.python.org/issue?@action=redirect&bpo=29452), and [bpo\-29286](https://bugs.python.org/issue?@action=redirect&bpo=29286).)

Various optimizations have reduced Python startup time by 10% on Linux and
up to 30% on macOS.
(Contributed by Victor Stinner, INADA Naoki in [bpo\-29585](https://bugs.python.org/issue?@action=redirect&bpo=29585), and
Ivan Levkivskyi in [bpo\-31333](https://bugs.python.org/issue?@action=redirect&bpo=31333).)

Method calls are now up to 20% faster due to the bytecode changes which
avoid creating bound method instances.
(Contributed by Yury Selivanov and INADA Naoki in [bpo\-26110](https://bugs.python.org/issue?@action=redirect&bpo=26110).)

The [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") module received a number of notable optimizations for
commonly used functions:

* The [`asyncio.get_event_loop()`](../library/asyncio-eventloop.html#asyncio.get_event_loop "asyncio.get_event_loop") function has been reimplemented in C to
make it up to 15 times faster.
(Contributed by Yury Selivanov in [bpo\-32296](https://bugs.python.org/issue?@action=redirect&bpo=32296).)
* [`asyncio.Future`](../library/asyncio-future.html#asyncio.Future "asyncio.Future") callback management has been optimized.
(Contributed by Yury Selivanov in [bpo\-32348](https://bugs.python.org/issue?@action=redirect&bpo=32348).)
* [`asyncio.gather()`](../library/asyncio-task.html#asyncio.gather "asyncio.gather") is now up to 15% faster.
(Contributed by Yury Selivanov in [bpo\-32355](https://bugs.python.org/issue?@action=redirect&bpo=32355).)
* [`asyncio.sleep()`](../library/asyncio-task.html#asyncio.sleep "asyncio.sleep") is now up to 2 times faster when the *delay*
argument is zero or negative.
(Contributed by Andrew Svetlov in [bpo\-32351](https://bugs.python.org/issue?@action=redirect&bpo=32351).)
* The performance overhead of asyncio debug mode has been reduced.
(Contributed by Antoine Pitrou in [bpo\-31970](https://bugs.python.org/issue?@action=redirect&bpo=31970).)

As a result of [PEP 560 work](#whatsnew37-pep560), the import time
of [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") has been reduced by a factor of 7, and many typing operations
are now faster.
(Contributed by Ivan Levkivskyi in [bpo\-32226](https://bugs.python.org/issue?@action=redirect&bpo=32226).)

[`sorted()`](../library/functions.html#sorted "sorted") and [`list.sort()`](../library/stdtypes.html#list.sort "list.sort") have been optimized for common cases
to be up to 40\-75% faster.
(Contributed by Elliot Gorokhovsky in [bpo\-28685](https://bugs.python.org/issue?@action=redirect&bpo=28685).)

[`dict.copy()`](../library/stdtypes.html#dict.copy "dict.copy") is now up to 5\.5 times faster.
(Contributed by Yury Selivanov in [bpo\-31179](https://bugs.python.org/issue?@action=redirect&bpo=31179).)

[`hasattr()`](../library/functions.html#hasattr "hasattr") and [`getattr()`](../library/functions.html#getattr "getattr") are now about 4 times faster when
*name* is not found and *obj* does not override [`object.__getattr__()`](../reference/datamodel.html#object.__getattr__ "object.__getattr__")
or [`object.__getattribute__()`](../reference/datamodel.html#object.__getattribute__ "object.__getattribute__").
(Contributed by INADA Naoki in [bpo\-32544](https://bugs.python.org/issue?@action=redirect&bpo=32544).)

Searching for certain Unicode characters (like Ukrainian capital “Є”)
in a string was up to 25 times slower than searching for other characters.
It is now only 3 times slower in the worst case.
(Contributed by Serhiy Storchaka in [bpo\-24821](https://bugs.python.org/issue?@action=redirect&bpo=24821).)

The [`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") factory has been reimplemented to
make the creation of named tuples 4 to 6 times faster.
(Contributed by Jelle Zijlstra with further improvements by INADA Naoki,
Serhiy Storchaka, and Raymond Hettinger in [bpo\-28638](https://bugs.python.org/issue?@action=redirect&bpo=28638).)

`date.fromordinal()` and `date.fromtimestamp()` are now up to
30% faster in the common case.
(Contributed by Paul Ganssle in [bpo\-32403](https://bugs.python.org/issue?@action=redirect&bpo=32403).)

The [`os.fwalk()`](../library/os.html#os.fwalk "os.fwalk") function is now up to 2 times faster thanks to
the use of [`os.scandir()`](../library/os.html#os.scandir "os.scandir").
(Contributed by Serhiy Storchaka in [bpo\-25996](https://bugs.python.org/issue?@action=redirect&bpo=25996).)

The speed of the [`shutil.rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree") function has been improved by
20–40% thanks to the use of the [`os.scandir()`](../library/os.html#os.scandir "os.scandir") function.
(Contributed by Serhiy Storchaka in [bpo\-28564](https://bugs.python.org/issue?@action=redirect&bpo=28564).)

Optimized case\-insensitive matching and searching of [`regular
expressions`](../library/re.html#module-re "re: Regular expression operations."). Searching some patterns can now be up to 20 times faster.
(Contributed by Serhiy Storchaka in [bpo\-30285](https://bugs.python.org/issue?@action=redirect&bpo=30285).)

[`re.compile()`](../library/re.html#re.compile "re.compile") now converts `flags` parameter to int object if
it is `RegexFlag`. It is now as fast as Python 3\.5, and faster than
Python 3\.6 by about 10% depending on the pattern.
(Contributed by INADA Naoki in [bpo\-31671](https://bugs.python.org/issue?@action=redirect&bpo=31671).)

The [`modify()`](../library/selectors.html#selectors.BaseSelector.modify "selectors.BaseSelector.modify") methods of classes
[`selectors.EpollSelector`](../library/selectors.html#selectors.EpollSelector "selectors.EpollSelector"), [`selectors.PollSelector`](../library/selectors.html#selectors.PollSelector "selectors.PollSelector")
and [`selectors.DevpollSelector`](../library/selectors.html#selectors.DevpollSelector "selectors.DevpollSelector") may be around 10% faster under
heavy loads. (Contributed by Giampaolo Rodola’ in [bpo\-30014](https://bugs.python.org/issue?@action=redirect&bpo=30014))

Constant folding has been moved from the peephole optimizer to the new AST
optimizer, which is able perform optimizations more consistently.
(Contributed by Eugene Toder and INADA Naoki in [bpo\-29469](https://bugs.python.org/issue?@action=redirect&bpo=29469) and
[bpo\-11549](https://bugs.python.org/issue?@action=redirect&bpo=11549).)

Most functions and methods in [`abc`](../library/abc.html#module-abc "abc: Abstract base classes according to :pep:`3119`.") have been rewritten in C.
This makes creation of abstract base classes, and calling [`isinstance()`](../library/functions.html#isinstance "isinstance")
and [`issubclass()`](../library/functions.html#issubclass "issubclass") on them 1\.5x faster. This also reduces Python
start\-up time by up to 10%. (Contributed by Ivan Levkivskyi and INADA Naoki
in [bpo\-31333](https://bugs.python.org/issue?@action=redirect&bpo=31333))

Significant speed improvements to alternate constructors for
[`datetime.date`](../library/datetime.html#datetime.date "datetime.date") and [`datetime.datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") by using fast\-path
constructors when not constructing subclasses. (Contributed by Paul Ganssle
in [bpo\-32403](https://bugs.python.org/issue?@action=redirect&bpo=32403))

The speed of comparison of [`array.array`](../library/array.html#array.array "array.array") instances has been
improved considerably in certain cases. It is now from 10x to 70x faster
when comparing arrays holding values of the same integer type.
(Contributed by Adrian Wielgosik in [bpo\-24700](https://bugs.python.org/issue?@action=redirect&bpo=24700).)

The [`math.erf()`](../library/math.html#math.erf "math.erf") and [`math.erfc()`](../library/math.html#math.erfc "math.erfc") functions now use the (faster)
C library implementation on most platforms.
(Contributed by Serhiy Storchaka in [bpo\-26121](https://bugs.python.org/issue?@action=redirect&bpo=26121).)

## Other CPython Implementation Changes[¶](#other-cpython-implementation-changes "Link to this heading")

* Trace hooks may now opt out of receiving the `line` and opt into receiving
the `opcode` events from the interpreter by setting the corresponding new
[`f_trace_lines`](../reference/datamodel.html#frame.f_trace_lines "frame.f_trace_lines") and [`f_trace_opcodes`](../reference/datamodel.html#frame.f_trace_opcodes "frame.f_trace_opcodes") attributes on the
frame being traced. (Contributed by Nick Coghlan in [bpo\-31344](https://bugs.python.org/issue?@action=redirect&bpo=31344).)
* Fixed some consistency problems with namespace package module attributes.
Namespace module objects now have an `__file__` that is set to `None`
(previously unset), and their `__spec__.origin` is also set to `None`
(previously the string `"namespace"`). See [bpo\-32305](https://bugs.python.org/issue?@action=redirect&bpo=32305). Also, the
namespace module object’s `__spec__.loader` is set to the same value as
`__loader__` (previously, the former was set to `None`). See
[bpo\-32303](https://bugs.python.org/issue?@action=redirect&bpo=32303).
* The [`locals()`](../library/functions.html#locals "locals") dictionary now displays in the lexical order that
variables were defined. Previously, the order was undefined.
(Contributed by Raymond Hettinger in [bpo\-32690](https://bugs.python.org/issue?@action=redirect&bpo=32690).)
* The `distutils` `upload` command no longer tries to change CR
end\-of\-line characters to CRLF. This fixes a corruption issue with sdists
that ended with a byte equivalent to CR.
(Contributed by Bo Bayles in [bpo\-32304](https://bugs.python.org/issue?@action=redirect&bpo=32304).)

## Deprecated Python Behavior[¶](#deprecated-python-behavior "Link to this heading")

Yield expressions (both `yield` and `yield from` clauses) are now deprecated
in comprehensions and generator expressions (aside from the iterable expression
in the leftmost `for` clause). This ensures that comprehensions
always immediately return a container of the appropriate type (rather than
potentially returning a [generator iterator](../glossary.html#term-generator-iterator) object), while generator
expressions won’t attempt to interleave their implicit output with the output
from any explicit yield expressions. In Python 3\.7, such expressions emit
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") when compiled, in Python 3\.8 this will be a
[`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError").
(Contributed by Serhiy Storchaka in [bpo\-10544](https://bugs.python.org/issue?@action=redirect&bpo=10544).)

Returning a subclass of [`complex`](../library/functions.html#complex "complex") from [`object.__complex__()`](../reference/datamodel.html#object.__complex__ "object.__complex__") is
deprecated and will be an error in future Python versions. This makes
`__complex__()` consistent with [`object.__int__()`](../reference/datamodel.html#object.__int__ "object.__int__") and
[`object.__float__()`](../reference/datamodel.html#object.__float__ "object.__float__").
(Contributed by Serhiy Storchaka in [bpo\-28894](https://bugs.python.org/issue?@action=redirect&bpo=28894).)

## Deprecated Python modules, functions and methods[¶](#deprecated-python-modules-functions-and-methods "Link to this heading")

### aifc[¶](#aifc "Link to this heading")

`aifc.openfp()` has been deprecated and will be removed in Python 3\.9\.
Use `aifc.open()` instead.
(Contributed by Brian Curtin in [bpo\-31985](https://bugs.python.org/issue?@action=redirect&bpo=31985).)

### asyncio[¶](#whatsnew37-asyncio-deprecated "Link to this heading")

Support for directly `await`\-ing instances of [`asyncio.Lock`](../library/asyncio-sync.html#asyncio.Lock "asyncio.Lock") and
other asyncio synchronization primitives has been deprecated. An
asynchronous context manager must be used in order to acquire and release
the synchronization resource.
(Contributed by Andrew Svetlov in [bpo\-32253](https://bugs.python.org/issue?@action=redirect&bpo=32253).)

The `asyncio.Task.current_task()` and `asyncio.Task.all_tasks()`
methods have been deprecated.
(Contributed by Andrew Svetlov in [bpo\-32250](https://bugs.python.org/issue?@action=redirect&bpo=32250).)

### collections[¶](#id3 "Link to this heading")

In Python 3\.8, the abstract base classes in [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers") will no
longer be exposed in the regular [`collections`](../library/collections.html#module-collections "collections: Container datatypes") module. This will help
create a clearer distinction between the concrete classes and the abstract
base classes.
(Contributed by Serhiy Storchaka in [bpo\-25988](https://bugs.python.org/issue?@action=redirect&bpo=25988).)

### dbm[¶](#id4 "Link to this heading")

[`dbm.dumb`](../library/dbm.html#module-dbm.dumb "dbm.dumb: Portable implementation of the simple DBM interface.") now supports reading read\-only files and no longer writes the
index file when it is not changed. A deprecation warning is now emitted
if the index file is missing and recreated in the `'r'` and `'w'`
modes (this will be an error in future Python releases).
(Contributed by Serhiy Storchaka in [bpo\-28847](https://bugs.python.org/issue?@action=redirect&bpo=28847).)

### enum[¶](#id5 "Link to this heading")

In Python 3\.8, attempting to check for non\-Enum objects in `Enum`
classes will raise a [`TypeError`](../library/exceptions.html#TypeError "TypeError") (e.g. `1 in Color`); similarly,
attempting to check for non\-Flag objects in a `Flag` member will
raise [`TypeError`](../library/exceptions.html#TypeError "TypeError") (e.g. `1 in Perm.RW`); currently, both operations
return [`False`](../library/constants.html#False "False") instead.
(Contributed by Ethan Furman in [bpo\-33217](https://bugs.python.org/issue?@action=redirect&bpo=33217).)

### gettext[¶](#gettext "Link to this heading")

Using non\-integer value for selecting a plural form in [`gettext`](../library/gettext.html#module-gettext "gettext: Multilingual internationalization services.") is
now deprecated. It never correctly worked. (Contributed by Serhiy Storchaka
in [bpo\-28692](https://bugs.python.org/issue?@action=redirect&bpo=28692).)

### importlib[¶](#id6 "Link to this heading")

Methods
`MetaPathFinder.find_module()`
(replaced by
[`MetaPathFinder.find_spec()`](../library/importlib.html#importlib.abc.MetaPathFinder.find_spec "importlib.abc.MetaPathFinder.find_spec"))
and
`PathEntryFinder.find_loader()`
(replaced by
[`PathEntryFinder.find_spec()`](../library/importlib.html#importlib.abc.PathEntryFinder.find_spec "importlib.abc.PathEntryFinder.find_spec"))
both deprecated in Python 3\.4 now emit [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
(Contributed by Matthias Bussonnier in [bpo\-29576](https://bugs.python.org/issue?@action=redirect&bpo=29576).)

The [`importlib.abc.ResourceLoader`](../library/importlib.html#importlib.abc.ResourceLoader "importlib.abc.ResourceLoader") ABC has been deprecated in
favour of [`importlib.abc.ResourceReader`](../library/importlib.html#importlib.abc.ResourceReader "importlib.abc.ResourceReader").

### locale[¶](#id7 "Link to this heading")

`locale.format()` has been deprecated, use [`locale.format_string()`](../library/locale.html#locale.format_string "locale.format_string")
instead. (Contributed by Garvit in [bpo\-10379](https://bugs.python.org/issue?@action=redirect&bpo=10379).)

### macpath[¶](#macpath "Link to this heading")

The `macpath` is now deprecated and will be removed in Python 3\.8\.
(Contributed by Chi Hsuan Yen in [bpo\-9850](https://bugs.python.org/issue?@action=redirect&bpo=9850).)

### threading[¶](#threading "Link to this heading")

`dummy_threading` and `_dummy_thread` have been deprecated. It is
no longer possible to build Python with threading disabled.
Use [`threading`](../library/threading.html#module-threading "threading: Thread-based parallelism.") instead.
(Contributed by Antoine Pitrou in [bpo\-31370](https://bugs.python.org/issue?@action=redirect&bpo=31370).)

### socket[¶](#id8 "Link to this heading")

The silent argument value truncation in [`socket.htons()`](../library/socket.html#socket.htons "socket.htons") and
[`socket.ntohs()`](../library/socket.html#socket.ntohs "socket.ntohs") has been deprecated. In future versions of Python,
if the passed argument is larger than 16 bits, an exception will be raised.
(Contributed by Oren Milman in [bpo\-28332](https://bugs.python.org/issue?@action=redirect&bpo=28332).)

### ssl[¶](#id9 "Link to this heading")

`ssl.wrap_socket()` is deprecated. Use
[`ssl.SSLContext.wrap_socket()`](../library/ssl.html#ssl.SSLContext.wrap_socket "ssl.SSLContext.wrap_socket") instead.
(Contributed by Christian Heimes in [bpo\-28124](https://bugs.python.org/issue?@action=redirect&bpo=28124).)

### sunau[¶](#sunau "Link to this heading")

`sunau.openfp()` has been deprecated and will be removed in Python 3\.9\.
Use `sunau.open()` instead.
(Contributed by Brian Curtin in [bpo\-31985](https://bugs.python.org/issue?@action=redirect&bpo=31985).)

### sys[¶](#id10 "Link to this heading")

Deprecated `sys.set_coroutine_wrapper()` and
`sys.get_coroutine_wrapper()`.

The undocumented `sys.callstats()` function has been deprecated and
will be removed in a future Python version.
(Contributed by Victor Stinner in [bpo\-28799](https://bugs.python.org/issue?@action=redirect&bpo=28799).)

### wave[¶](#wave "Link to this heading")

`wave.openfp()` has been deprecated and will be removed in Python 3\.9\.
Use [`wave.open()`](../library/wave.html#wave.open "wave.open") instead.
(Contributed by Brian Curtin in [bpo\-31985](https://bugs.python.org/issue?@action=redirect&bpo=31985).)

## Deprecated functions and types of the C API[¶](#deprecated-functions-and-types-of-the-c-api "Link to this heading")

Function [`PySlice_GetIndicesEx()`](../c-api/slice.html#c.PySlice_GetIndicesEx "PySlice_GetIndicesEx") is deprecated and replaced with
a macro if `Py_LIMITED_API` is not set or set to a value in the range
between `0x03050400` and `0x03060000` (not inclusive), or is `0x03060100`
or higher. (Contributed by Serhiy Storchaka in [bpo\-27867](https://bugs.python.org/issue?@action=redirect&bpo=27867).)

[`PyOS_AfterFork()`](../c-api/sys.html#c.PyOS_AfterFork "PyOS_AfterFork") has been deprecated. Use [`PyOS_BeforeFork()`](../c-api/sys.html#c.PyOS_BeforeFork "PyOS_BeforeFork"),
[`PyOS_AfterFork_Parent()`](../c-api/sys.html#c.PyOS_AfterFork_Parent "PyOS_AfterFork_Parent") or [`PyOS_AfterFork_Child()`](../c-api/sys.html#c.PyOS_AfterFork_Child "PyOS_AfterFork_Child") instead.
(Contributed by Antoine Pitrou in [bpo\-16500](https://bugs.python.org/issue?@action=redirect&bpo=16500).)

## Platform Support Removals[¶](#platform-support-removals "Link to this heading")

* FreeBSD 9 and older are no longer officially supported.
* For full Unicode support, including within extension modules, \*nix platforms
are now expected to provide at least one of `C.UTF-8` (full locale),
`C.utf8` (full locale) or `UTF-8` (`LC_CTYPE`\-only locale) as an
alternative to the legacy `ASCII`\-based `C` locale.
* OpenSSL 0\.9\.8 and 1\.0\.1 are no longer supported, which means building CPython
3\.7 with SSL/TLS support on older platforms still using these versions
requires custom build options that link to a more recent version of OpenSSL.

Notably, this issue affects the Debian 8 (aka “jessie”) and Ubuntu 14\.04
(aka “Trusty”) LTS Linux distributions, as they still use OpenSSL 1\.0\.1 by
default.

Debian 9 (“stretch”) and Ubuntu 16\.04 (“xenial”), as well as recent releases
of other LTS Linux releases (e.g. RHEL/CentOS 7\.5, SLES 12\-SP3\), use OpenSSL
1\.0\.2 or later, and remain supported in the default build configuration.

CPython’s own [CI configuration file](https://github.com/python/cpython/blob/v3.7.13/.travis.yml) provides an
example of using the SSL
[compatibility testing infrastructure](https://github.com/python/cpython/tree/3.13/Tools/ssl/multissltests.py) in
CPython’s test suite to build and link against OpenSSL 1\.1\.0 rather than an
outdated system provided OpenSSL.

## API and Feature Removals[¶](#api-and-feature-removals "Link to this heading")

The following features and APIs have been removed from Python 3\.7:

* The `os.stat_float_times()` function has been removed. It was introduced in
Python 2\.3 for backward compatibility with Python 2\.2, and was deprecated
since Python 3\.1\.
* Unknown escapes consisting of `'\'` and an ASCII letter in replacement
templates for [`re.sub()`](../library/re.html#re.sub "re.sub") were deprecated in Python 3\.5, and will now
cause an error.
* Removed support of the *exclude* argument in [`tarfile.TarFile.add()`](../library/tarfile.html#tarfile.TarFile.add "tarfile.TarFile.add").
It was deprecated in Python 2\.7 and 3\.2\. Use the *filter* argument instead.
* The `ntpath.splitunc()` function was deprecated in
Python 3\.1, and has now been removed. Use [`splitdrive()`](../library/os.path.html#os.path.splitdrive "os.path.splitdrive")
instead.
* [`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") no longer supports the *verbose* parameter
or `_source` attribute which showed the generated source code for the
named tuple class. This was part of an optimization designed to speed\-up
class creation. (Contributed by Jelle Zijlstra with further improvements
by INADA Naoki, Serhiy Storchaka, and Raymond Hettinger in [bpo\-28638](https://bugs.python.org/issue?@action=redirect&bpo=28638).)
* Functions [`bool()`](../library/functions.html#bool "bool"), [`float()`](../library/functions.html#float "float"), [`list()`](../library/stdtypes.html#list "list") and [`tuple()`](../library/stdtypes.html#tuple "tuple") no
longer take keyword arguments. The first argument of [`int()`](../library/functions.html#int "int") can now
be passed only as positional argument.
* Removed previously deprecated in Python 2\.4 classes `Plist`, `Dict` and
`_InternalDict` in the [`plistlib`](../library/plistlib.html#module-plistlib "plistlib: Generate and parse Apple plist files.") module. Dict values in the result
of functions `readPlist()` and
`readPlistFromBytes()` are now normal dicts. You no longer
can use attribute access to access items of these dictionaries.
* The `asyncio.windows_utils.socketpair()` function has been
removed. Use the [`socket.socketpair()`](../library/socket.html#socket.socketpair "socket.socketpair") function instead,
it is available on all platforms since Python 3\.5\.
`asyncio.windows_utils.socketpair` was just an alias to
`socket.socketpair` on Python 3\.5 and newer.
* [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O.") no longer exports the [`selectors`](../library/selectors.html#module-selectors "selectors: High-level I/O multiplexing.") and
`_overlapped` modules as `asyncio.selectors` and
`asyncio._overlapped`. Replace `from asyncio import selectors` with
`import selectors`.
* Direct instantiation of [`ssl.SSLSocket`](../library/ssl.html#ssl.SSLSocket "ssl.SSLSocket") and [`ssl.SSLObject`](../library/ssl.html#ssl.SSLObject "ssl.SSLObject")
objects is now prohibited. The constructors were never documented, tested,
or designed as public constructors. Users were supposed to use
`ssl.wrap_socket()` or [`ssl.SSLContext`](../library/ssl.html#ssl.SSLContext "ssl.SSLContext").
(Contributed by Christian Heimes in [bpo\-32951](https://bugs.python.org/issue?@action=redirect&bpo=32951).)
* The unused `distutils` `install_misc` command has been removed.
(Contributed by Eric N. Vander Weele in [bpo\-29218](https://bugs.python.org/issue?@action=redirect&bpo=29218).)

## Module Removals[¶](#module-removals "Link to this heading")

The `fpectl` module has been removed. It was never enabled by
default, never worked correctly on x86\-64, and it changed the Python
ABI in ways that caused unexpected breakage of C extensions.
(Contributed by Nathaniel J. Smith in [bpo\-29137](https://bugs.python.org/issue?@action=redirect&bpo=29137).)

## Windows\-only Changes[¶](#windows-only-changes "Link to this heading")

The python launcher, (py.exe), can accept 32 \& 64 bit specifiers **without**
having to specify a minor version as well. So `py -3-32` and `py -3-64`
become valid as well as `py -3.7-32`, also the \-*m*\-64 and \-*m.n*\-64 forms
are now accepted to force 64 bit python even if 32 bit would have otherwise
been used. If the specified version is not available py.exe will error exit.
(Contributed by Steve Barnes in [bpo\-30291](https://bugs.python.org/issue?@action=redirect&bpo=30291).)

The launcher can be run as `py -0` to produce a list of the installed pythons,
*with default marked with an asterisk*. Running `py -0p` will include the paths.
If py is run with a version specifier that cannot be matched it will also print
the *short form* list of available specifiers.
(Contributed by Steve Barnes in [bpo\-30362](https://bugs.python.org/issue?@action=redirect&bpo=30362).)

## Porting to Python 3\.7[¶](#porting-to-python-3-7 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in Python Behavior[¶](#changes-in-python-behavior "Link to this heading")

* [`async`](../reference/compound_stmts.html#async) and [`await`](../reference/expressions.html#await) names are now reserved keywords.
Code using these names as identifiers will now raise a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError").
(Contributed by Jelle Zijlstra in [bpo\-30406](https://bugs.python.org/issue?@action=redirect&bpo=30406).)
* [**PEP 479**](https://peps.python.org/pep-0479/) is enabled for all code in Python 3\.7, meaning that
[`StopIteration`](../library/exceptions.html#StopIteration "StopIteration") exceptions raised directly or indirectly in
coroutines and generators are transformed into [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError")
exceptions.
(Contributed by Yury Selivanov in [bpo\-32670](https://bugs.python.org/issue?@action=redirect&bpo=32670).)
* [`object.__aiter__()`](../reference/datamodel.html#object.__aiter__ "object.__aiter__") methods can no longer be declared as
asynchronous. (Contributed by Yury Selivanov in [bpo\-31709](https://bugs.python.org/issue?@action=redirect&bpo=31709).)
* Due to an oversight, earlier Python versions erroneously accepted the
following syntax:

\`\`\`
f(1 for x in \[1],)

class C(1 for x in \[1]):
 pass

\`\`\`

Python 3\.7 now correctly raises a [`SyntaxError`](../library/exceptions.html#SyntaxError "SyntaxError"), as a generator
expression always needs to be directly inside a set of parentheses
and cannot have a comma on either side, and the duplication of the
parentheses can be omitted only on calls.
(Contributed by Serhiy Storchaka in [bpo\-32012](https://bugs.python.org/issue?@action=redirect&bpo=32012) and [bpo\-32023](https://bugs.python.org/issue?@action=redirect&bpo=32023).)
* When using the [`-m`](../using/cmdline.html#cmdoption-m) switch, the initial working directory is now added
to [`sys.path`](../library/sys.html#sys.path "sys.path"), rather than an empty string (which dynamically denoted
the current working directory at the time of each import). Any programs that
are checking for the empty string, or otherwise relying on the previous
behaviour, will need to be updated accordingly (e.g. by also checking for
`os.getcwd()` or `os.path.dirname(__main__.__file__)`, depending on why
the code was checking for the empty string in the first place).

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* `socketserver.ThreadingMixIn.server_close()` now waits until all
non\-daemon threads complete. Set the new
[`socketserver.ThreadingMixIn.block_on_close`](../library/socketserver.html#socketserver.ThreadingMixIn.block_on_close "socketserver.ThreadingMixIn.block_on_close") class attribute to
`False` to get the pre\-3\.7 behaviour.
(Contributed by Victor Stinner in [bpo\-31233](https://bugs.python.org/issue?@action=redirect&bpo=31233) and [bpo\-33540](https://bugs.python.org/issue?@action=redirect&bpo=33540).)
* `socketserver.ForkingMixIn.server_close()` now waits until all
child processes complete. Set the new
`socketserver.ForkingMixIn.block_on_close` class attribute to `False`
to get the pre\-3\.7 behaviour.
(Contributed by Victor Stinner in [bpo\-31151](https://bugs.python.org/issue?@action=redirect&bpo=31151) and [bpo\-33540](https://bugs.python.org/issue?@action=redirect&bpo=33540).)
* The [`locale.localeconv()`](../library/locale.html#locale.localeconv "locale.localeconv") function now temporarily sets the `LC_CTYPE`
locale to the value of `LC_NUMERIC` in some cases.
(Contributed by Victor Stinner in [bpo\-31900](https://bugs.python.org/issue?@action=redirect&bpo=31900).)
* [`pkgutil.walk_packages()`](../library/pkgutil.html#pkgutil.walk_packages "pkgutil.walk_packages") now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if *path* is
a string. Previously an empty list was returned.
(Contributed by Sanyam Khurana in [bpo\-24744](https://bugs.python.org/issue?@action=redirect&bpo=24744).)
* A format string argument for [`string.Formatter.format()`](../library/string.html#string.Formatter.format "string.Formatter.format")
is now [positional\-only](../glossary.html#positional-only-parameter).
Passing it as a keyword argument was deprecated in Python 3\.5\. (Contributed
by Serhiy Storchaka in [bpo\-29193](https://bugs.python.org/issue?@action=redirect&bpo=29193).)
* Attributes [`key`](../library/http.cookies.html#http.cookies.Morsel.key "http.cookies.Morsel.key"),
[`value`](../library/http.cookies.html#http.cookies.Morsel.value "http.cookies.Morsel.value") and
[`coded_value`](../library/http.cookies.html#http.cookies.Morsel.coded_value "http.cookies.Morsel.coded_value") of class
[`http.cookies.Morsel`](../library/http.cookies.html#http.cookies.Morsel "http.cookies.Morsel") are now read\-only.
Assigning to them was deprecated in Python 3\.5\.
Use the [`set()`](../library/http.cookies.html#http.cookies.Morsel.set "http.cookies.Morsel.set") method for setting them.
(Contributed by Serhiy Storchaka in [bpo\-29192](https://bugs.python.org/issue?@action=redirect&bpo=29192).)
* The *mode* argument of [`os.makedirs()`](../library/os.html#os.makedirs "os.makedirs") no longer affects the file
permission bits of newly created intermediate\-level directories.
To set their file permission bits you can set the umask before invoking
`makedirs()`.
(Contributed by Serhiy Storchaka in [bpo\-19930](https://bugs.python.org/issue?@action=redirect&bpo=19930).)
* The [`struct.Struct.format`](../library/struct.html#struct.Struct.format "struct.Struct.format") type is now [`str`](../library/stdtypes.html#str "str") instead of
[`bytes`](../library/stdtypes.html#bytes "bytes"). (Contributed by Victor Stinner in [bpo\-21071](https://bugs.python.org/issue?@action=redirect&bpo=21071).)
* `cgi.parse_multipart()` now accepts the *encoding* and *errors*
arguments and returns the same results as
`FieldStorage`: for non\-file fields, the value associated to a key
is a list of strings, not bytes.
(Contributed by Pierre Quentel in [bpo\-29979](https://bugs.python.org/issue?@action=redirect&bpo=29979).)
* Due to internal changes in [`socket`](../library/socket.html#module-socket "socket: Low-level networking interface."), calling [`socket.fromshare()`](../library/socket.html#socket.fromshare "socket.fromshare")
on a socket created by [`socket.share`](../library/socket.html#socket.socket.share "socket.socket.share") in older
Python versions is not supported.
* `repr` for [`BaseException`](../library/exceptions.html#BaseException "BaseException") has changed to not include the trailing
comma. Most exceptions are affected by this change.
(Contributed by Serhiy Storchaka in [bpo\-30399](https://bugs.python.org/issue?@action=redirect&bpo=30399).)
* `repr` for [`datetime.timedelta`](../library/datetime.html#datetime.timedelta "datetime.timedelta") has changed to include the keyword
arguments in the output. (Contributed by Utkarsh Upadhyay in [bpo\-30302](https://bugs.python.org/issue?@action=redirect&bpo=30302).)
* Because [`shutil.rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree") is now implemented using the [`os.scandir()`](../library/os.html#os.scandir "os.scandir")
function, the user specified handler *onerror* is now called with the first
argument `os.scandir` instead of `os.listdir` when listing the directory
is failed.
* Support for nested sets and set operations in regular expressions as in
[Unicode Technical Standard \#18](https://unicode.org/reports/tr18/) might be added in the future. This would
change the syntax. To facilitate this future change a [`FutureWarning`](../library/exceptions.html#FutureWarning "FutureWarning")
will be raised in ambiguous cases for the time being.
That include sets starting with a literal `'['` or containing literal
character sequences `'--'`, `'&&'`, `'~~'`, and `'||'`. To
avoid a warning, escape them with a backslash.
(Contributed by Serhiy Storchaka in [bpo\-30349](https://bugs.python.org/issue?@action=redirect&bpo=30349).)
* The result of splitting a string on a [`regular expression`](../library/re.html#module-re "re: Regular expression operations.")
that could match an empty string has been changed. For example
splitting on `r'\s*'` will now split not only on whitespaces as it
did previously, but also on empty strings before all non\-whitespace
characters and just before the end of the string.
The previous behavior can be restored by changing the pattern
to `r'\s+'`. A [`FutureWarning`](../library/exceptions.html#FutureWarning "FutureWarning") was emitted for such patterns since
Python 3\.5\.

For patterns that match both empty and non\-empty strings, the result of
searching for all matches may also be changed in other cases. For example
in the string `'a\n\n'`, the pattern `r'(?m)^\s*?$'` will not only
match empty strings at positions 2 and 3, but also the string `'\n'` at
positions 2–3\. To match only blank lines, the pattern should be rewritten
as `r'(?m)^[^\S\n]*$'`.

[`re.sub()`](../library/re.html#re.sub "re.sub") now replaces empty matches adjacent to a previous
non\-empty match. For example `re.sub('x*', '-', 'abxd')` returns now
`'-a-b--d-'` instead of `'-a-b-d-'` (the first minus between ‘b’ and
‘d’ replaces ‘x’, and the second minus replaces an empty string between
‘x’ and ‘d’).

(Contributed by Serhiy Storchaka in [bpo\-25054](https://bugs.python.org/issue?@action=redirect&bpo=25054) and [bpo\-32308](https://bugs.python.org/issue?@action=redirect&bpo=32308).)
* Change [`re.escape()`](../library/re.html#re.escape "re.escape") to only escape regex special characters instead
of escaping all characters other than ASCII letters, numbers, and `'_'`.
(Contributed by Serhiy Storchaka in [bpo\-29995](https://bugs.python.org/issue?@action=redirect&bpo=29995).)
* [`tracemalloc.Traceback`](../library/tracemalloc.html#tracemalloc.Traceback "tracemalloc.Traceback") frames are now sorted from oldest to most
recent to be more consistent with [`traceback`](../library/traceback.html#module-traceback "traceback: Print or retrieve a stack traceback.").
(Contributed by Jesse Bakker in [bpo\-32121](https://bugs.python.org/issue?@action=redirect&bpo=32121).)
* On OSes that support [`socket.SOCK_NONBLOCK`](../library/socket.html#socket.SOCK_NONBLOCK "socket.SOCK_NONBLOCK") or
[`socket.SOCK_CLOEXEC`](../library/socket.html#socket.SOCK_CLOEXEC "socket.SOCK_CLOEXEC") bit flags, the
[`socket.type`](../library/socket.html#socket.socket.type "socket.socket.type") no longer has them applied.
Therefore, checks like `if sock.type == socket.SOCK_STREAM`
work as expected on all platforms.
(Contributed by Yury Selivanov in [bpo\-32331](https://bugs.python.org/issue?@action=redirect&bpo=32331).)
* On Windows the default for the *close\_fds* argument of
[`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") was changed from [`False`](../library/constants.html#False "False") to [`True`](../library/constants.html#True "True")
when redirecting the standard handles. If you previously depended on handles
being inherited when using [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") with standard io
redirection, you will have to pass `close_fds=False` to preserve the
previous behaviour, or use
[`STARTUPINFO.lpAttributeList`](../library/subprocess.html#subprocess.STARTUPINFO.lpAttributeList "subprocess.STARTUPINFO.lpAttributeList").
* [`importlib.machinery.PathFinder.invalidate_caches()`](../library/importlib.html#importlib.machinery.PathFinder.invalidate_caches "importlib.machinery.PathFinder.invalidate_caches") – which implicitly
affects [`importlib.invalidate_caches()`](../library/importlib.html#importlib.invalidate_caches "importlib.invalidate_caches") – now deletes entries
in [`sys.path_importer_cache`](../library/sys.html#sys.path_importer_cache "sys.path_importer_cache") which are set to `None`.
(Contributed by Brett Cannon in [bpo\-33169](https://bugs.python.org/issue?@action=redirect&bpo=33169).)
* In [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."),
[`loop.sock_recv()`](../library/asyncio-eventloop.html#asyncio.loop.sock_recv "asyncio.loop.sock_recv"),
[`loop.sock_sendall()`](../library/asyncio-eventloop.html#asyncio.loop.sock_sendall "asyncio.loop.sock_sendall"),
[`loop.sock_accept()`](../library/asyncio-eventloop.html#asyncio.loop.sock_accept "asyncio.loop.sock_accept"),
[`loop.getaddrinfo()`](../library/asyncio-eventloop.html#asyncio.loop.getaddrinfo "asyncio.loop.getaddrinfo"),
[`loop.getnameinfo()`](../library/asyncio-eventloop.html#asyncio.loop.getnameinfo "asyncio.loop.getnameinfo")
have been changed to be proper coroutine methods to match their
documentation. Previously, these methods returned [`asyncio.Future`](../library/asyncio-future.html#asyncio.Future "asyncio.Future")
instances.
(Contributed by Yury Selivanov in [bpo\-32327](https://bugs.python.org/issue?@action=redirect&bpo=32327).)
* [`asyncio.Server.sockets`](../library/asyncio-eventloop.html#asyncio.Server.sockets "asyncio.Server.sockets") now returns a copy of the internal list
of server sockets, instead of returning it directly.
(Contributed by Yury Selivanov in [bpo\-32662](https://bugs.python.org/issue?@action=redirect&bpo=32662).)
* [`Struct.format`](../library/struct.html#struct.Struct.format "struct.Struct.format") is now a [`str`](../library/stdtypes.html#str "str") instance
instead of a [`bytes`](../library/stdtypes.html#bytes "bytes") instance.
(Contributed by Victor Stinner in [bpo\-21071](https://bugs.python.org/issue?@action=redirect&bpo=21071).)
* [`argparse`](../library/argparse.html#module-argparse "argparse: Command-line option and argument parsing library.") subparsers can now be made mandatory by passing `required=True`
to [`ArgumentParser.add_subparsers()`](../library/argparse.html#argparse.ArgumentParser.add_subparsers "argparse.ArgumentParser.add_subparsers").
(Contributed by Anthony Sottile in [bpo\-26510](https://bugs.python.org/issue?@action=redirect&bpo=26510).)
* [`ast.literal_eval()`](../library/ast.html#ast.literal_eval "ast.literal_eval") is now stricter. Addition and subtraction of
arbitrary numbers are no longer allowed.
(Contributed by Serhiy Storchaka in [bpo\-31778](https://bugs.python.org/issue?@action=redirect&bpo=31778).)
* [`Calendar.itermonthdates`](../library/calendar.html#calendar.Calendar.itermonthdates "calendar.Calendar.itermonthdates")
will now consistently raise an exception when a date falls outside of the
`0001-01-01` through `9999-12-31` range. To support applications that
cannot tolerate such exceptions, the new
[`Calendar.itermonthdays3`](../library/calendar.html#calendar.Calendar.itermonthdays3 "calendar.Calendar.itermonthdays3") and
[`Calendar.itermonthdays4`](../library/calendar.html#calendar.Calendar.itermonthdays4 "calendar.Calendar.itermonthdays4") can be used.
The new methods return tuples and are not restricted by the range supported by
[`datetime.date`](../library/datetime.html#datetime.date "datetime.date").
(Contributed by Alexander Belopolsky in [bpo\-28292](https://bugs.python.org/issue?@action=redirect&bpo=28292).)
* [`collections.ChainMap`](../library/collections.html#collections.ChainMap "collections.ChainMap") now preserves the order of the underlying
mappings. (Contributed by Raymond Hettinger in [bpo\-32792](https://bugs.python.org/issue?@action=redirect&bpo=32792).)
* The `submit()` method of [`concurrent.futures.ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor")
and [`concurrent.futures.ProcessPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor "concurrent.futures.ProcessPoolExecutor") now raises
a [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") if called during interpreter shutdown.
(Contributed by Mark Nemec in [bpo\-33097](https://bugs.python.org/issue?@action=redirect&bpo=33097).)
* The [`configparser.ConfigParser`](../library/configparser.html#configparser.ConfigParser "configparser.ConfigParser") constructor now uses `read_dict()`
to process the default values, making its behavior consistent with the
rest of the parser. Non\-string keys and values in the defaults
dictionary are now being implicitly converted to strings.
(Contributed by James Tocknell in [bpo\-23835](https://bugs.python.org/issue?@action=redirect&bpo=23835).)
* Several undocumented internal imports were removed.
One example is that `os.errno` is no longer available; use `import errno`
directly instead.
Note that such undocumented internal imports may be removed any time without
notice, even in micro version releases.

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

The function [`PySlice_GetIndicesEx()`](../c-api/slice.html#c.PySlice_GetIndicesEx "PySlice_GetIndicesEx") is considered unsafe for
resizable sequences. If the slice indices are not instances of [`int`](../library/functions.html#int "int"),
but objects that implement the `__index__()` method, the sequence can be
resized after passing its length to `PySlice_GetIndicesEx()`. This
can lead to returning indices out of the length of the sequence. For
avoiding possible problems use new functions [`PySlice_Unpack()`](../c-api/slice.html#c.PySlice_Unpack "PySlice_Unpack") and
[`PySlice_AdjustIndices()`](../c-api/slice.html#c.PySlice_AdjustIndices "PySlice_AdjustIndices").
(Contributed by Serhiy Storchaka in [bpo\-27867](https://bugs.python.org/issue?@action=redirect&bpo=27867).)

### CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

There are two new opcodes: [`LOAD_METHOD`](../library/dis.html#opcode-LOAD_METHOD) and `CALL_METHOD`.
(Contributed by Yury Selivanov and INADA Naoki in [bpo\-26110](https://bugs.python.org/issue?@action=redirect&bpo=26110).)

The `STORE_ANNOTATION` opcode has been removed.
(Contributed by Mark Shannon in [bpo\-32550](https://bugs.python.org/issue?@action=redirect&bpo=32550).)

### Windows\-only Changes[¶](#id12 "Link to this heading")

The file used to override [`sys.path`](../library/sys.html#sys.path "sys.path") is now called
`._pth` instead of `'sys.path'`.
See [Finding modules](../using/windows.html#windows-finding-modules) for more information.
(Contributed by Steve Dower in [bpo\-28137](https://bugs.python.org/issue?@action=redirect&bpo=28137).)

### Other CPython implementation changes[¶](#id13 "Link to this heading")

In preparation for potential future changes to the public CPython runtime
initialization API (see [**PEP 432**](https://peps.python.org/pep-0432/) for an initial, but somewhat outdated,
draft), CPython’s internal startup
and configuration management logic has been significantly refactored. While
these updates are intended to be entirely transparent to both embedding
applications and users of the regular CPython CLI, they’re being mentioned
here as the refactoring changes the internal order of various operations
during interpreter startup, and hence may uncover previously latent defects,
either in embedding applications, or in CPython itself.
(Initially contributed by Nick Coghlan and Eric Snow as part of
[bpo\-22257](https://bugs.python.org/issue?@action=redirect&bpo=22257), and further updated by Nick, Eric, and Victor Stinner in a
number of other issues). Some known details affected:

* `PySys_AddWarnOptionUnicode()` is not currently usable by embedding
applications due to the requirement to create a Unicode object prior to
calling `Py_Initialize`. Use `PySys_AddWarnOption()` instead.
* warnings filters added by an embedding application with
`PySys_AddWarnOption()` should now more consistently take precedence
over the default filters set by the interpreter

Due to changes in the way the default warnings filters are configured,
setting [`Py_BytesWarningFlag`](../c-api/init.html#c.Py_BytesWarningFlag "Py_BytesWarningFlag") to a value greater than one is no longer
sufficient to both emit [`BytesWarning`](../library/exceptions.html#BytesWarning "BytesWarning") messages and have them converted
to exceptions. Instead, the flag must be set (to cause the warnings to be
emitted in the first place), and an explicit `error::BytesWarning`
warnings filter added to convert them to exceptions.

Due to a change in the way docstrings are handled by the compiler, the
implicit `return None` in a function body consisting solely of a docstring
is now marked as occurring on the same line as the docstring, not on the
function’s header line.

The current exception state has been moved from the frame object to the co\-routine.
This simplified the interpreter and fixed a couple of obscure bugs caused by
having swap exception state when entering or exiting a generator.
(Contributed by Mark Shannon in [bpo\-25612](https://bugs.python.org/issue?@action=redirect&bpo=25612).)

## Notable changes in Python 3\.7\.1[¶](#notable-changes-in-python-3-7-1 "Link to this heading")

Starting in 3\.7\.1, [`Py_Initialize()`](../c-api/init.html#c.Py_Initialize "Py_Initialize") now consistently reads and respects
all of the same environment settings as [`Py_Main()`](../c-api/init.html#c.Py_Main "Py_Main") (in earlier Python
versions, it respected an ill\-defined subset of those environment variables,
while in Python 3\.7\.0 it didn’t read any of them due to [bpo\-34247](https://bugs.python.org/issue?@action=redirect&bpo=34247)). If
this behavior is unwanted, set [`Py_IgnoreEnvironmentFlag`](../c-api/init.html#c.Py_IgnoreEnvironmentFlag "Py_IgnoreEnvironmentFlag") to 1 before
calling [`Py_Initialize()`](../c-api/init.html#c.Py_Initialize "Py_Initialize").

In 3\.7\.1 the C API for Context Variables
[was updated](../c-api/contextvars.html#contextvarsobjects-pointertype-change) to use
[`PyObject`](../c-api/structures.html#c.PyObject "PyObject") pointers. See also [bpo\-34762](https://bugs.python.org/issue?@action=redirect&bpo=34762).

In 3\.7\.1 the [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module now implicitly emits a `NEWLINE` token
when provided with input that does not have a trailing new line. This behavior
now matches what the C tokenizer does internally.
(Contributed by Ammar Askar in [bpo\-33899](https://bugs.python.org/issue?@action=redirect&bpo=33899).)

## Notable changes in Python 3\.7\.2[¶](#notable-changes-in-python-3-7-2 "Link to this heading")

In 3\.7\.2, [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") on Windows no longer copies the original binaries, but
creates redirector scripts named `python.exe` and `pythonw.exe` instead.
This resolves a long standing issue where all virtual environments would have
to be upgraded or recreated with each Python update. However, note that this
release will still require recreation of virtual environments in order to get
the new scripts.

## Notable changes in Python 3\.7\.6[¶](#notable-changes-in-python-3-7-6 "Link to this heading")

Due to significant security concerns, the *reuse\_address* parameter of
[`asyncio.loop.create_datagram_endpoint()`](../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint") is no longer supported. This is
because of the behavior of the socket option `SO_REUSEADDR` in UDP. For more
details, see the documentation for `loop.create_datagram_endpoint()`.
(Contributed by Kyle Stanley, Antoine Pitrou, and Yury Selivanov in
[bpo\-37228](https://bugs.python.org/issue?@action=redirect&bpo=37228).)

## Notable changes in Python 3\.7\.10[¶](#notable-changes-in-python-3-7-10 "Link to this heading")

Earlier Python versions allowed using both `;` and `&` as
query parameter separators in [`urllib.parse.parse_qs()`](../library/urllib.parse.html#urllib.parse.parse_qs "urllib.parse.parse_qs") and
[`urllib.parse.parse_qsl()`](../library/urllib.parse.html#urllib.parse.parse_qsl "urllib.parse.parse_qsl"). Due to security concerns, and to conform with
newer W3C recommendations, this has been changed to allow only a single
separator key, with `&` as the default. This change also affects
`cgi.parse()` and `cgi.parse_multipart()` as they use the affected
functions internally. For more details, please see their respective
documentation.
(Contributed by Adam Goldschmidt, Senthil Kumaran and Ken Jin in [bpo\-42967](https://bugs.python.org/issue?@action=redirect&bpo=42967).)

## Notable changes in Python 3\.7\.11[¶](#notable-changes-in-python-3-7-11 "Link to this heading")

A security fix alters the [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") behavior to not trust the
IPv4 address sent from the remote server when setting up a passive data
channel. We reuse the ftp server IP address instead. For unusual code
requiring the old behavior, set a `trust_server_pasv_ipv4_address`
attribute on your FTP instance to `True`. (See [gh\-87451](https://github.com/python/cpython/issues/87451))

The presence of newline or tab characters in parts of a URL allows for some
forms of attacks. Following the WHATWG specification that updates RFC 3986,
ASCII newline `\n`, `\r` and tab `\t` characters are stripped from the
URL by the parser [`urllib.parse()`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") preventing such attacks. The removal
characters are controlled by a new module level variable
`urllib.parse._UNSAFE_URL_BYTES_TO_REMOVE`. (See [gh\-88048](https://github.com/python/cpython/issues/88048))

## Notable security feature in 3\.7\.14[¶](#notable-security-feature-in-3-7-14 "Link to this heading")

Converting between [`int`](../library/functions.html#int "int") and [`str`](../library/stdtypes.html#str "str") in bases other than 2
(binary), 4, 8 (octal), 16 (hexadecimal), or 32 such as base 10 (decimal)
now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the number of digits in string form is
above a limit to avoid potential denial of service attacks due to the
algorithmic complexity. This is a mitigation for [**CVE 2020\-10735**](https://www.cve.org/CVERecord?id=CVE-2020-10735).
This limit can be configured or disabled by environment variable, command
line flag, or [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") APIs. See the [integer string conversion
length limitation](../library/stdtypes.html#int-max-str-digits) documentation. The default limit
is 4300 digits in string form.

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.7](#)
	+ [Summary – Release Highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [PEP 563: Postponed Evaluation of Annotations](#pep-563-postponed-evaluation-of-annotations)
		- [PEP 538: Legacy C Locale Coercion](#pep-538-legacy-c-locale-coercion)
		- [PEP 540: Forced UTF\-8 Runtime Mode](#pep-540-forced-utf-8-runtime-mode)
		- [PEP 553: Built\-in `breakpoint()`](#pep-553-built-in-breakpoint)
		- [PEP 539: New C API for Thread\-Local Storage](#pep-539-new-c-api-for-thread-local-storage)
		- [PEP 562: Customization of Access to Module Attributes](#pep-562-customization-of-access-to-module-attributes)
		- [PEP 564: New Time Functions With Nanosecond Resolution](#pep-564-new-time-functions-with-nanosecond-resolution)
		- [PEP 565: Show DeprecationWarning in `__main__`](#pep-565-show-deprecationwarning-in-main)
		- [PEP 560: Core Support for `typing` module and Generic Types](#pep-560-core-support-for-typing-module-and-generic-types)
		- [PEP 552: Hash\-based .pyc Files](#pep-552-hash-based-pyc-files)
		- [PEP 545: Python Documentation Translations](#pep-545-python-documentation-translations)
		- [Python Development Mode (\-X dev)](#python-development-mode-x-dev)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
		- [contextvars](#contextvars)
		- [dataclasses](#dataclasses)
		- [importlib.resources](#importlib-resources)
	+ [Improved Modules](#improved-modules)
		- [argparse](#argparse)
		- [asyncio](#asyncio)
		- [binascii](#binascii)
		- [calendar](#calendar)
		- [collections](#collections)
		- [compileall](#compileall)
		- [concurrent.futures](#concurrent-futures)
		- [contextlib](#contextlib)
		- [cProfile](#cprofile)
		- [crypt](#crypt)
		- [datetime](#datetime)
		- [dbm](#dbm)
		- [decimal](#decimal)
		- [dis](#dis)
		- [distutils](#distutils)
		- [enum](#enum)
		- [functools](#functools)
		- [gc](#gc)
		- [hmac](#hmac)
		- [http.client](#http-client)
		- [http.server](#http-server)
		- [idlelib and IDLE](#idlelib-and-idle)
		- [importlib](#importlib)
		- [io](#io)
		- [ipaddress](#ipaddress)
		- [itertools](#itertools)
		- [locale](#locale)
		- [logging](#logging)
		- [math](#math)
		- [mimetypes](#mimetypes)
		- [msilib](#msilib)
		- [multiprocessing](#multiprocessing)
		- [os](#os)
		- [pathlib](#pathlib)
		- [pdb](#pdb)
		- [py\_compile](#py-compile)
		- [pydoc](#pydoc)
		- [queue](#queue)
		- [re](#re)
		- [signal](#signal)
		- [socket](#socket)
		- [socketserver](#socketserver)
		- [sqlite3](#sqlite3)
		- [ssl](#ssl)
		- [string](#string)
		- [subprocess](#subprocess)
		- [sys](#sys)
		- [time](#time)
		- [tkinter](#tkinter)
		- [tracemalloc](#tracemalloc)
		- [types](#types)
		- [unicodedata](#unicodedata)
		- [unittest](#unittest)
		- [unittest.mock](#unittest-mock)
		- [urllib.parse](#urllib-parse)
		- [uu](#uu)
		- [uuid](#uuid)
		- [warnings](#warnings)
		- [xml](#xml)
		- [xml.etree](#xml-etree)
		- [xmlrpc.server](#xmlrpc-server)
		- [zipapp](#zipapp)
		- [zipfile](#zipfile)
	+ [C API Changes](#c-api-changes)
	+ [Build Changes](#build-changes)
	+ [Optimizations](#optimizations)
	+ [Other CPython Implementation Changes](#other-cpython-implementation-changes)
	+ [Deprecated Python Behavior](#deprecated-python-behavior)
	+ [Deprecated Python modules, functions and methods](#deprecated-python-modules-functions-and-methods)
		- [aifc](#aifc)
		- [asyncio](#whatsnew37-asyncio-deprecated)
		- [collections](#id3)
		- [dbm](#id4)
		- [enum](#id5)
		- [gettext](#gettext)
		- [importlib](#id6)
		- [locale](#id7)
		- [macpath](#macpath)
		- [threading](#threading)
		- [socket](#id8)
		- [ssl](#id9)
		- [sunau](#sunau)
		- [sys](#id10)
		- [wave](#wave)
	+ [Deprecated functions and types of the C API](#deprecated-functions-and-types-of-the-c-api)
	+ [Platform Support Removals](#platform-support-removals)
	+ [API and Feature Removals](#api-and-feature-removals)
	+ [Module Removals](#module-removals)
	+ [Windows\-only Changes](#windows-only-changes)
	+ [Porting to Python 3\.7](#porting-to-python-3-7)
		- [Changes in Python Behavior](#changes-in-python-behavior)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
		- [CPython bytecode changes](#cpython-bytecode-changes)
		- [Windows\-only Changes](#id12)
		- [Other CPython implementation changes](#id13)
	+ [Notable changes in Python 3\.7\.1](#notable-changes-in-python-3-7-1)
	+ [Notable changes in Python 3\.7\.2](#notable-changes-in-python-3-7-2)
	+ [Notable changes in Python 3\.7\.6](#notable-changes-in-python-3-7-6)
	+ [Notable changes in Python 3\.7\.10](#notable-changes-in-python-3-7-10)
	+ [Notable changes in Python 3\.7\.11](#notable-changes-in-python-3-7-11)
	+ [Notable security feature in 3\.7\.14](#notable-security-feature-in-3-7-14)

#### Previous topic

[What’s New In Python 3\.8](3.8.html "previous chapter")

#### Next topic

[What’s New In Python 3\.6](3.6.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.7.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.6.html "What’s New In Python 3.6") \|
* [previous](3.8.html "What’s New In Python 3.8") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.7
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.8 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.8.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.7.html "What’s New In Python 3.7") \|
* [previous](3.9.html "What’s New In Python 3.9") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.8
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.8[¶](#what-s-new-in-python-3-8 "Link to this heading")

Editor:
Raymond Hettinger

This article explains the new features in Python 3\.8, compared to 3\.7\.
Python 3\.8 was released on October 14, 2019\.
For full details, see the [changelog](changelog.html#changelog).

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

## New Features[¶](#new-features "Link to this heading")

### Assignment expressions[¶](#assignment-expressions "Link to this heading")

There is new syntax `:=` that assigns values to variables as part of a larger
expression. It is affectionately known as “the walrus operator” due to
its resemblance to [the eyes and tusks of a walrus](https://en.wikipedia.org/wiki/Walrus#/media/File:Pacific_Walrus_-_Bull_(8247646168).jpg).

In this example, the assignment expression helps avoid calling
[`len()`](../library/functions.html#len "len") twice:

\`\`\`
if (n := len(a)) \> 10:
 print(f"List is too long ({n} elements, expected \\>\> def f(a, b, /, \*\*kwargs):
... print(a, b, kwargs)
...
\>\>\> f(10, 20, a=1, b=2, c=3\) \# a and b are used in two ways
10 20 {'a': 1, 'b': 2, 'c': 3}

\`\`\`

This greatly simplifies the implementation of functions and methods
that need to accept arbitrary keyword arguments. For example, here
is an excerpt from code in the [`collections`](../library/collections.html#module-collections "collections: Container datatypes") module:

\`\`\`
class Counter(dict):

 def \_\_init\_\_(self, iterable=None, /, \*\*kwds):
 \# Note "iterable" is a possible keyword argument

\`\`\`

See [**PEP 570**](https://peps.python.org/pep-0570/) for a full description.

(Contributed by Pablo Galindo in [bpo\-36540](https://bugs.python.org/issue?@action=redirect&bpo=36540).)

### Parallel filesystem cache for compiled bytecode files[¶](#parallel-filesystem-cache-for-compiled-bytecode-files "Link to this heading")

The new [`PYTHONPYCACHEPREFIX`](../using/cmdline.html#envvar-PYTHONPYCACHEPREFIX) setting (also available as
[`-X`](../using/cmdline.html#cmdoption-X) `pycache_prefix`) configures the implicit bytecode
cache to use a separate parallel filesystem tree, rather than
the default `__pycache__` subdirectories within each source
directory.

The location of the cache is reported in [`sys.pycache_prefix`](../library/sys.html#sys.pycache_prefix "sys.pycache_prefix")
([`None`](../library/constants.html#None "None") indicates the default location in `__pycache__`
subdirectories).

(Contributed by Carl Meyer in [bpo\-33499](https://bugs.python.org/issue?@action=redirect&bpo=33499).)

### Debug build uses the same ABI as release build[¶](#debug-build-uses-the-same-abi-as-release-build "Link to this heading")

Python now uses the same ABI whether it’s built in release or debug mode. On
Unix, when Python is built in debug mode, it is now possible to load C
extensions built in release mode and C extensions built using the stable ABI.

Release builds and [debug builds](../using/configure.html#debug-build) are now ABI compatible: defining the
`Py_DEBUG` macro no longer implies the `Py_TRACE_REFS` macro, which
introduces the only ABI incompatibility. The `Py_TRACE_REFS` macro, which
adds the [`sys.getobjects()`](../library/sys.html#sys.getobjects "sys.getobjects") function and the [`PYTHONDUMPREFS`](../using/cmdline.html#envvar-PYTHONDUMPREFS)
environment variable, can be set using the new [`./configure
--with-trace-refs`](../using/configure.html#cmdoption-with-trace-refs) build option.
(Contributed by Victor Stinner in [bpo\-36465](https://bugs.python.org/issue?@action=redirect&bpo=36465).)

On Unix, C extensions are no longer linked to libpython except on Android
and Cygwin.
It is now possible
for a statically linked Python to load a C extension built using a shared
library Python.
(Contributed by Victor Stinner in [bpo\-21536](https://bugs.python.org/issue?@action=redirect&bpo=21536).)

On Unix, when Python is built in debug mode, import now also looks for C
extensions compiled in release mode and for C extensions compiled with the
stable ABI.
(Contributed by Victor Stinner in [bpo\-36722](https://bugs.python.org/issue?@action=redirect&bpo=36722).)

To embed Python into an application, a new `--embed` option must be passed to
`python3-config --libs --embed` to get `-lpython3.8` (link the application
to libpython). To support both 3\.8 and older, try `python3-config --libs
--embed` first and fallback to `python3-config --libs` (without `--embed`)
if the previous command fails.

Add a pkg\-config `python-3.8-embed` module to embed Python into an
application: `pkg-config python-3.8-embed --libs` includes `-lpython3.8`.
To support both 3\.8 and older, try `pkg-config python-X.Y-embed --libs` first
and fallback to `pkg-config python-X.Y --libs` (without `--embed`) if the
previous command fails (replace `X.Y` with the Python version).

On the other hand, `pkg-config python3.8 --libs` no longer contains
`-lpython3.8`. C extensions must not be linked to libpython (except on
Android and Cygwin, whose cases are handled by the script);
this change is backward incompatible on purpose.
(Contributed by Victor Stinner in [bpo\-36721](https://bugs.python.org/issue?@action=redirect&bpo=36721).)

### f\-strings support `=` for self\-documenting expressions and debugging[¶](#f-strings-support-for-self-documenting-expressions-and-debugging "Link to this heading")

Added an `=` specifier to [f\-string](../glossary.html#term-f-string)s. An f\-string such as
`f'{expr=}'` will expand to the text of the expression, an equal sign,
then the representation of the evaluated expression. For example:

\`\`\`
\>\>\> user = 'eric\_idle'
\>\>\> member\_since = date(1975, 7, 31\)
\>\>\> f'{user=} {member\_since=}'
"user='eric\_idle' member\_since=datetime.date(1975, 7, 31\)"

\`\`\`

The usual [f\-string format specifiers](../reference/lexical_analysis.html#f-strings) allow more
control over how the result of the expression is displayed:

\`\`\`
\>\>\> delta = date.today() \- member\_since
\>\>\> f'{user=!s} {delta.days=:,d}'
'user=eric\_idle delta.days=16,075'

\`\`\`

The `=` specifier will display the whole expression so that
calculations can be shown:

\`\`\`
\>\>\> print(f'{theta=} {cos(radians(theta))=:.3f}')
theta=30 cos(radians(theta))=0\.866

\`\`\`

(Contributed by Eric V. Smith and Larry Hastings in [bpo\-36817](https://bugs.python.org/issue?@action=redirect&bpo=36817).)

### PEP 578: Python Runtime Audit Hooks[¶](#pep-578-python-runtime-audit-hooks "Link to this heading")

The PEP adds an Audit Hook and Verified Open Hook. Both are available from
Python and native code, allowing applications and frameworks written in pure
Python code to take advantage of extra notifications, while also allowing
embedders or system administrators to deploy builds of Python where auditing is
always enabled.

See [**PEP 578**](https://peps.python.org/pep-0578/) for full details.

### PEP 587: Python Initialization Configuration[¶](#pep-587-python-initialization-configuration "Link to this heading")

The [**PEP 587**](https://peps.python.org/pep-0587/) adds a new C API to configure the Python Initialization
providing finer control on the whole configuration and better error reporting.

New structures:

* [`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig")
* [`PyPreConfig`](../c-api/init_config.html#c.PyPreConfig "PyPreConfig")
* [`PyStatus`](../c-api/init_config.html#c.PyStatus "PyStatus")
* [`PyWideStringList`](../c-api/init_config.html#c.PyWideStringList "PyWideStringList")

New functions:

* [`PyConfig_Clear()`](../c-api/init_config.html#c.PyConfig_Clear "PyConfig_Clear")
* [`PyConfig_InitIsolatedConfig()`](../c-api/init_config.html#c.PyConfig_InitIsolatedConfig "PyConfig_InitIsolatedConfig")
* [`PyConfig_InitPythonConfig()`](../c-api/init_config.html#c.PyConfig_InitPythonConfig "PyConfig_InitPythonConfig")
* [`PyConfig_Read()`](../c-api/init_config.html#c.PyConfig_Read "PyConfig_Read")
* [`PyConfig_SetArgv()`](../c-api/init_config.html#c.PyConfig_SetArgv "PyConfig_SetArgv")
* [`PyConfig_SetBytesArgv()`](../c-api/init_config.html#c.PyConfig_SetBytesArgv "PyConfig_SetBytesArgv")
* [`PyConfig_SetBytesString()`](../c-api/init_config.html#c.PyConfig_SetBytesString "PyConfig_SetBytesString")
* [`PyConfig_SetString()`](../c-api/init_config.html#c.PyConfig_SetString "PyConfig_SetString")
* [`PyPreConfig_InitIsolatedConfig()`](../c-api/init_config.html#c.PyPreConfig_InitIsolatedConfig "PyPreConfig_InitIsolatedConfig")
* [`PyPreConfig_InitPythonConfig()`](../c-api/init_config.html#c.PyPreConfig_InitPythonConfig "PyPreConfig_InitPythonConfig")
* [`PyStatus_Error()`](../c-api/init_config.html#c.PyStatus_Error "PyStatus_Error")
* [`PyStatus_Exception()`](../c-api/init_config.html#c.PyStatus_Exception "PyStatus_Exception")
* [`PyStatus_Exit()`](../c-api/init_config.html#c.PyStatus_Exit "PyStatus_Exit")
* [`PyStatus_IsError()`](../c-api/init_config.html#c.PyStatus_IsError "PyStatus_IsError")
* [`PyStatus_IsExit()`](../c-api/init_config.html#c.PyStatus_IsExit "PyStatus_IsExit")
* [`PyStatus_NoMemory()`](../c-api/init_config.html#c.PyStatus_NoMemory "PyStatus_NoMemory")
* [`PyStatus_Ok()`](../c-api/init_config.html#c.PyStatus_Ok "PyStatus_Ok")
* [`PyWideStringList_Append()`](../c-api/init_config.html#c.PyWideStringList_Append "PyWideStringList_Append")
* [`PyWideStringList_Insert()`](../c-api/init_config.html#c.PyWideStringList_Insert "PyWideStringList_Insert")
* [`Py_BytesMain()`](../c-api/init.html#c.Py_BytesMain "Py_BytesMain")
* [`Py_ExitStatusException()`](../c-api/init_config.html#c.Py_ExitStatusException "Py_ExitStatusException")
* [`Py_InitializeFromConfig()`](../c-api/init.html#c.Py_InitializeFromConfig "Py_InitializeFromConfig")
* [`Py_PreInitialize()`](../c-api/init_config.html#c.Py_PreInitialize "Py_PreInitialize")
* [`Py_PreInitializeFromArgs()`](../c-api/init_config.html#c.Py_PreInitializeFromArgs "Py_PreInitializeFromArgs")
* [`Py_PreInitializeFromBytesArgs()`](../c-api/init_config.html#c.Py_PreInitializeFromBytesArgs "Py_PreInitializeFromBytesArgs")
* [`Py_RunMain()`](../c-api/init.html#c.Py_RunMain "Py_RunMain")

This PEP also adds `_PyRuntimeState.preconfig` ([`PyPreConfig`](../c-api/init_config.html#c.PyPreConfig "PyPreConfig") type)
and `PyInterpreterState.config` ([`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig") type) fields to these
internal structures. `PyInterpreterState.config` becomes the new
reference configuration, replacing global configuration variables and
other private variables.

See [Python Initialization Configuration](../c-api/init_config.html#init-config) for the
documentation.

See [**PEP 587**](https://peps.python.org/pep-0587/) for a full description.

(Contributed by Victor Stinner in [bpo\-36763](https://bugs.python.org/issue?@action=redirect&bpo=36763).)

### PEP 590: Vectorcall: a fast calling protocol for CPython[¶](#pep-590-vectorcall-a-fast-calling-protocol-for-cpython "Link to this heading")

[The Vectorcall Protocol](../c-api/call.html#vectorcall) is added to the Python/C API.
It is meant to formalize existing optimizations which were already done
for various classes.
Any [static type](../c-api/typeobj.html#static-types) implementing a callable can use this
protocol.

This is currently provisional.
The aim is to make it fully public in Python 3\.9\.

See [**PEP 590**](https://peps.python.org/pep-0590/) for a full description.

(Contributed by Jeroen Demeyer, Mark Shannon and Petr Viktorin in [bpo\-36974](https://bugs.python.org/issue?@action=redirect&bpo=36974).)

### Pickle protocol 5 with out\-of\-band data buffers[¶](#pickle-protocol-5-with-out-of-band-data-buffers "Link to this heading")

When [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") is used to transfer large data between Python processes
in order to take advantage of multi\-core or multi\-machine processing,
it is important to optimize the transfer by reducing memory copies, and
possibly by applying custom techniques such as data\-dependent compression.

The [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") protocol 5 introduces support for out\-of\-band buffers
where [**PEP 3118**](https://peps.python.org/pep-3118/)\-compatible data can be transmitted separately from the
main pickle stream, at the discretion of the communication layer.

See [**PEP 574**](https://peps.python.org/pep-0574/) for a full description.

(Contributed by Antoine Pitrou in [bpo\-36785](https://bugs.python.org/issue?@action=redirect&bpo=36785).)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* A [`continue`](../reference/simple_stmts.html#continue) statement was illegal in the [`finally`](../reference/compound_stmts.html#finally) clause
due to a problem with the implementation. In Python 3\.8 this restriction
was lifted.
(Contributed by Serhiy Storchaka in [bpo\-32489](https://bugs.python.org/issue?@action=redirect&bpo=32489).)
* The [`bool`](../library/functions.html#bool "bool"), [`int`](../library/functions.html#int "int"), and [`fractions.Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction") types
now have an [`as_integer_ratio()`](../library/stdtypes.html#int.as_integer_ratio "int.as_integer_ratio") method like that found in
[`float`](../library/functions.html#float "float") and [`decimal.Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal"). This minor API extension
makes it possible to write `numerator, denominator =
x.as_integer_ratio()` and have it work across multiple numeric types.
(Contributed by Lisa Roach in [bpo\-33073](https://bugs.python.org/issue?@action=redirect&bpo=33073) and Raymond Hettinger in
[bpo\-37819](https://bugs.python.org/issue?@action=redirect&bpo=37819).)
* Constructors of [`int`](../library/functions.html#int "int"), [`float`](../library/functions.html#float "float") and [`complex`](../library/functions.html#complex "complex") will now
use the [`__index__()`](../reference/datamodel.html#object.__index__ "object.__index__") special method, if available and the
corresponding method [`__int__()`](../reference/datamodel.html#object.__int__ "object.__int__"), [`__float__()`](../reference/datamodel.html#object.__float__ "object.__float__")
or [`__complex__()`](../reference/datamodel.html#object.__complex__ "object.__complex__") is not available.
(Contributed by Serhiy Storchaka in [bpo\-20092](https://bugs.python.org/issue?@action=redirect&bpo=20092).)
* Added support of `\N{name}` escapes in [`regular expressions`](../library/re.html#module-re "re: Regular expression operations."):

\`\`\`
\>\>\> notice = 'Copyright © 2019'
\>\>\> copyright\_year\_pattern = re.compile(r'\\N{copyright sign}\\s\*(\\d{4})')
\>\>\> int(copyright\_year\_pattern.search(notice).group(1\))
2019

\`\`\`

(Contributed by Jonathan Eunice and Serhiy Storchaka in [bpo\-30688](https://bugs.python.org/issue?@action=redirect&bpo=30688).)
* Dict and dictviews are now iterable in reversed insertion order using
[`reversed()`](../library/functions.html#reversed "reversed"). (Contributed by Rémi Lapeyre in [bpo\-33462](https://bugs.python.org/issue?@action=redirect&bpo=33462).)
* The syntax allowed for keyword names in function calls was further
restricted. In particular, `f((keyword)=arg)` is no longer allowed. It was
never intended to permit more than a bare name on the left\-hand side of a
keyword argument assignment term.
(Contributed by Benjamin Peterson in [bpo\-34641](https://bugs.python.org/issue?@action=redirect&bpo=34641).)
* Generalized iterable unpacking in [`yield`](../reference/simple_stmts.html#yield) and
[`return`](../reference/simple_stmts.html#return) statements no longer requires enclosing parentheses.
This brings the *yield* and *return* syntax into better agreement with
normal assignment syntax:

\`\`\`
\>\>\> def parse(family):
 lastname, \*members = family.split()
 return lastname.upper(), \*members

\>\>\> parse('simpsons homer marge bart lisa maggie')
('SIMPSONS', 'homer', 'marge', 'bart', 'lisa', 'maggie')

\`\`\`

(Contributed by David Cuthbert and Jordan Chapman in [bpo\-32117](https://bugs.python.org/issue?@action=redirect&bpo=32117).)
* When a comma is missed in code such as `[(10, 20) (30, 40)]`, the
compiler displays a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning") with a helpful suggestion.
This improves on just having a [`TypeError`](../library/exceptions.html#TypeError "TypeError") indicating that the
first tuple was not callable. (Contributed by Serhiy Storchaka in
[bpo\-15248](https://bugs.python.org/issue?@action=redirect&bpo=15248).)
* Arithmetic operations between subclasses of [`datetime.date`](../library/datetime.html#datetime.date "datetime.date") or
[`datetime.datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") and [`datetime.timedelta`](../library/datetime.html#datetime.timedelta "datetime.timedelta") objects now return
an instance of the subclass, rather than the base class. This also affects
the return type of operations whose implementation (directly or indirectly)
uses [`datetime.timedelta`](../library/datetime.html#datetime.timedelta "datetime.timedelta") arithmetic, such as
[`astimezone()`](../library/datetime.html#datetime.datetime.astimezone "datetime.datetime.astimezone").
(Contributed by Paul Ganssle in [bpo\-32417](https://bugs.python.org/issue?@action=redirect&bpo=32417).)
* When the Python interpreter is interrupted by Ctrl\-C (SIGINT) and the
resulting [`KeyboardInterrupt`](../library/exceptions.html#KeyboardInterrupt "KeyboardInterrupt") exception is not caught, the Python process
now exits via a SIGINT signal or with the correct exit code such that the
calling process can detect that it died due to a Ctrl\-C. Shells on POSIX
and Windows use this to properly terminate scripts in interactive sessions.
(Contributed by Google via Gregory P. Smith in [bpo\-1054041](https://bugs.python.org/issue?@action=redirect&bpo=1054041).)
* Some advanced styles of programming require updating the
[`types.CodeType`](../library/types.html#types.CodeType "types.CodeType") object for an existing function. Since code
objects are immutable, a new code object needs to be created, one
that is modeled on the existing code object. With 19 parameters,
this was somewhat tedious. Now, the new `replace()` method makes
it possible to create a clone with a few altered parameters.

Here’s an example that alters the [`statistics.mean()`](../library/statistics.html#statistics.mean "statistics.mean") function to
prevent the *data* parameter from being used as a keyword argument:

\`\`\`
\>\>\> from statistics import mean
\>\>\> mean(data=\[10, 20, 90])
40
\>\>\> mean.\_\_code\_\_ = mean.\_\_code\_\_.replace(co\_posonlyargcount=1\)
\>\>\> mean(data=\[10, 20, 90])
Traceback (most recent call last):
 ...
TypeError: mean() got some positional\-only arguments passed as keyword arguments: 'data'

\`\`\`

(Contributed by Victor Stinner in [bpo\-37032](https://bugs.python.org/issue?@action=redirect&bpo=37032).)
* For integers, the three\-argument form of the [`pow()`](../library/functions.html#pow "pow") function now
permits the exponent to be negative in the case where the base is
relatively prime to the modulus. It then computes a modular inverse to
the base when the exponent is `-1`, and a suitable power of that
inverse for other negative exponents. For example, to compute the
[modular multiplicative inverse](https://en.wikipedia.org/wiki/Modular_multiplicative_inverse) of 38
modulo 137, write:

\`\`\`
\>\>\> pow(38, \-1, 137\)
119
\>\>\> 119 \* 38 % 137
1

\`\`\`

Modular inverses arise in the solution of [linear Diophantine
equations](https://en.wikipedia.org/wiki/Diophantine_equation).
For example, to find integer solutions for `4258𝑥 + 147𝑦 = 369`,
first rewrite as `4258𝑥 ≡ 369 (mod 147)` then solve:

\`\`\`
\>\>\> x = 369 \* pow(4258, \-1, 147\) % 147
\>\>\> y = (4258 \* x \- 369\) // \-147
\>\>\> 4258 \* x \+ 147 \* y
369

\`\`\`

(Contributed by Mark Dickinson in [bpo\-36027](https://bugs.python.org/issue?@action=redirect&bpo=36027).)
* Dict comprehensions have been synced\-up with dict literals so that the
key is computed first and the value second:

\`\`\`
\>\>\> \# Dict comprehension
\>\>\> cast = {input('role? '): input('actor? ') for i in range(2\)}
role? King Arthur
actor? Chapman
role? Black Knight
actor? Cleese

\>\>\> \# Dict literal
\>\>\> cast = {input('role? '): input('actor? ')}
role? Sir Robin
actor? Eric Idle

\`\`\`

The guaranteed execution order is helpful with assignment expressions
because variables assigned in the key expression will be available in
the value expression:

\`\`\`
\>\>\> names = \['Martin von Löwis', 'Łukasz Langa', 'Walter Dörwald']
\>\>\> {(n := normalize('NFC', name)).casefold() : n for name in names}
{'martin von löwis': 'Martin von Löwis',
 'łukasz langa': 'Łukasz Langa',
 'walter dörwald': 'Walter Dörwald'}

\`\`\`

(Contributed by Jörn Heissler in [bpo\-35224](https://bugs.python.org/issue?@action=redirect&bpo=35224).)
* The [`object.__reduce__()`](../library/pickle.html#object.__reduce__ "object.__reduce__") method can now return a tuple from two to
six elements long. Formerly, five was the limit. The new, optional sixth
element is a callable with a `(obj, state)` signature. This allows the
direct control over the state\-updating behavior of a specific object. If
not *None*, this callable will have priority over the object’s
`__setstate__()` method.
(Contributed by Pierre Glaser and Olivier Grisel in [bpo\-35900](https://bugs.python.org/issue?@action=redirect&bpo=35900).)

## New Modules[¶](#new-modules "Link to this heading")

* The new [`importlib.metadata`](../library/importlib.metadata.html#module-importlib.metadata "importlib.metadata: Accessing package metadata") module provides (provisional) support for
reading metadata from third\-party packages. For example, it can extract an
installed package’s version number, list of entry points, and more:

\`\`\`
\>\>\> \# Note following example requires that the popular "requests"
\>\>\> \# package has been installed.
\>\>\>
\>\>\> from importlib.metadata import version, requires, files
\>\>\> version('requests')
'2\.22\.0'
\>\>\> list(requires('requests'))
\['chardet (\=3\.0\.2\)']
\>\>\> list(files('requests'))\[:5]
\[PackagePath('requests\-2\.22\.0\.dist\-info/INSTALLER'),
 PackagePath('requests\-2\.22\.0\.dist\-info/LICENSE'),
 PackagePath('requests\-2\.22\.0\.dist\-info/METADATA'),
 PackagePath('requests\-2\.22\.0\.dist\-info/RECORD'),
 PackagePath('requests\-2\.22\.0\.dist\-info/WHEEL')]

\`\`\`

(Contributed by Barry Warsaw and Jason R. Coombs in [bpo\-34632](https://bugs.python.org/issue?@action=redirect&bpo=34632).)

## Improved Modules[¶](#improved-modules "Link to this heading")

### ast[¶](#ast "Link to this heading")

AST nodes now have `end_lineno` and `end_col_offset` attributes,
which give the precise location of the end of the node. (This only
applies to nodes that have `lineno` and `col_offset` attributes.)

New function [`ast.get_source_segment()`](../library/ast.html#ast.get_source_segment "ast.get_source_segment") returns the source code
for a specific AST node.

(Contributed by Ivan Levkivskyi in [bpo\-33416](https://bugs.python.org/issue?@action=redirect&bpo=33416).)

The [`ast.parse()`](../library/ast.html#ast.parse "ast.parse") function has some new flags:

* `type_comments=True` causes it to return the text of [**PEP 484**](https://peps.python.org/pep-0484/) and
[**PEP 526**](https://peps.python.org/pep-0526/) type comments associated with certain AST nodes;
* `mode='func_type'` can be used to parse [**PEP 484**](https://peps.python.org/pep-0484/) “signature type
comments” (returned for function definition AST nodes);
* `feature_version=(3, N)` allows specifying an earlier Python 3
version. For example, `feature_version=(3, 4)` will treat
[`async`](../reference/compound_stmts.html#async) and [`await`](../reference/expressions.html#await) as non\-reserved words.

(Contributed by Guido van Rossum in [bpo\-35766](https://bugs.python.org/issue?@action=redirect&bpo=35766).)

### asyncio[¶](#asyncio "Link to this heading")

[`asyncio.run()`](../library/asyncio-runner.html#asyncio.run "asyncio.run") has graduated from the provisional to stable API. This
function can be used to execute a [coroutine](../glossary.html#term-coroutine) and return the result while
automatically managing the event loop. For example:

\`\`\`
import asyncio

async def main():
 await asyncio.sleep(0\)
 return 42

asyncio.run(main())

\`\`\`

This is *roughly* equivalent to:

\`\`\`
import asyncio

async def main():
 await asyncio.sleep(0\)
 return 42

loop = asyncio.new\_event\_loop()
asyncio.set\_event\_loop(loop)
try:
 loop.run\_until\_complete(main())
finally:
 asyncio.set\_event\_loop(None)
 loop.close()

\`\`\`

The actual implementation is significantly more complex. Thus,
[`asyncio.run()`](../library/asyncio-runner.html#asyncio.run "asyncio.run") should be the preferred way of running asyncio programs.

(Contributed by Yury Selivanov in [bpo\-32314](https://bugs.python.org/issue?@action=redirect&bpo=32314).)

Running `python -m asyncio` launches a natively async REPL. This allows rapid
experimentation with code that has a top\-level [`await`](../reference/expressions.html#await). There is no
longer a need to directly call `asyncio.run()` which would spawn a new event
loop on every invocation:

\`\`\`
$ python \-m asyncio
asyncio REPL 3\.8\.0
Use "await" directly instead of "asyncio.run()".
Type "help", "copyright", "credits" or "license" for more information.
\>\>\> import asyncio
\>\>\> await asyncio.sleep(10, result='hello')
hello

\`\`\`

(Contributed by Yury Selivanov in [bpo\-37028](https://bugs.python.org/issue?@action=redirect&bpo=37028).)

The exception [`asyncio.CancelledError`](../library/asyncio-exceptions.html#asyncio.CancelledError "asyncio.CancelledError") now inherits from
[`BaseException`](../library/exceptions.html#BaseException "BaseException") rather than [`Exception`](../library/exceptions.html#Exception "Exception") and no longer inherits
from [`concurrent.futures.CancelledError`](../library/concurrent.futures.html#concurrent.futures.CancelledError "concurrent.futures.CancelledError").
(Contributed by Yury Selivanov in [bpo\-32528](https://bugs.python.org/issue?@action=redirect&bpo=32528).)

On Windows, the default event loop is now [`ProactorEventLoop`](../library/asyncio-eventloop.html#asyncio.ProactorEventLoop "asyncio.ProactorEventLoop").
(Contributed by Victor Stinner in [bpo\-34687](https://bugs.python.org/issue?@action=redirect&bpo=34687).)

[`ProactorEventLoop`](../library/asyncio-eventloop.html#asyncio.ProactorEventLoop "asyncio.ProactorEventLoop") now also supports UDP.
(Contributed by Adam Meily and Andrew Svetlov in [bpo\-29883](https://bugs.python.org/issue?@action=redirect&bpo=29883).)

[`ProactorEventLoop`](../library/asyncio-eventloop.html#asyncio.ProactorEventLoop "asyncio.ProactorEventLoop") can now be interrupted by
[`KeyboardInterrupt`](../library/exceptions.html#KeyboardInterrupt "KeyboardInterrupt") (“CTRL\+C”).
(Contributed by Vladimir Matveev in [bpo\-23057](https://bugs.python.org/issue?@action=redirect&bpo=23057).)

Added [`asyncio.Task.get_coro()`](../library/asyncio-task.html#asyncio.Task.get_coro "asyncio.Task.get_coro") for getting the wrapped coroutine
within an [`asyncio.Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task").
(Contributed by Alex Grönholm in [bpo\-36999](https://bugs.python.org/issue?@action=redirect&bpo=36999).)

Asyncio tasks can now be named, either by passing the `name` keyword
argument to [`asyncio.create_task()`](../library/asyncio-task.html#asyncio.create_task "asyncio.create_task") or
the [`create_task()`](../library/asyncio-eventloop.html#asyncio.loop.create_task "asyncio.loop.create_task") event loop method, or by
calling the [`set_name()`](../library/asyncio-task.html#asyncio.Task.set_name "asyncio.Task.set_name") method on the task object. The
task name is visible in the `repr()` output of [`asyncio.Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task") and
can also be retrieved using the [`get_name()`](../library/asyncio-task.html#asyncio.Task.get_name "asyncio.Task.get_name") method.
(Contributed by Alex Grönholm in [bpo\-34270](https://bugs.python.org/issue?@action=redirect&bpo=34270).)

Added support for
[Happy Eyeballs](https://en.wikipedia.org/wiki/Happy_Eyeballs) to
[`asyncio.loop.create_connection()`](../library/asyncio-eventloop.html#asyncio.loop.create_connection "asyncio.loop.create_connection"). To specify the behavior, two new
parameters have been added: *happy\_eyeballs\_delay* and *interleave*. The Happy
Eyeballs algorithm improves responsiveness in applications that support IPv4
and IPv6 by attempting to simultaneously connect using both.
(Contributed by twisteroid ambassador in [bpo\-33530](https://bugs.python.org/issue?@action=redirect&bpo=33530).)

### builtins[¶](#builtins "Link to this heading")

The [`compile()`](../library/functions.html#compile "compile") built\-in has been improved to accept the
`ast.PyCF_ALLOW_TOP_LEVEL_AWAIT` flag. With this new flag passed,
[`compile()`](../library/functions.html#compile "compile") will allow top\-level `await`, `async for` and `async with`
constructs that are usually considered invalid syntax. Asynchronous code object
marked with the `CO_COROUTINE` flag may then be returned.
(Contributed by Matthias Bussonnier in [bpo\-34616](https://bugs.python.org/issue?@action=redirect&bpo=34616))

### collections[¶](#collections "Link to this heading")

The [`_asdict()`](../library/collections.html#collections.somenamedtuple._asdict "collections.somenamedtuple._asdict") method for
[`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple") now returns a [`dict`](../library/stdtypes.html#dict "dict") instead of a
[`collections.OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict"). This works because regular dicts have
guaranteed ordering since Python 3\.7\. If the extra features of
`OrderedDict` are required, the suggested remediation is to cast the
result to the desired type: `OrderedDict(nt._asdict())`.
(Contributed by Raymond Hettinger in [bpo\-35864](https://bugs.python.org/issue?@action=redirect&bpo=35864).)

### cProfile[¶](#cprofile "Link to this heading")

The [`cProfile.Profile`](../library/profile.html#profile.Profile "profile.Profile") class can now be used as a context manager.
Profile a block of code by running:

\`\`\`
import cProfile

with cProfile.Profile() as profiler:
 \# code to be profiled
 ...

\`\`\`

(Contributed by Scott Sanderson in [bpo\-29235](https://bugs.python.org/issue?@action=redirect&bpo=29235).)

### csv[¶](#csv "Link to this heading")

The [`csv.DictReader`](../library/csv.html#csv.DictReader "csv.DictReader") now returns instances of [`dict`](../library/stdtypes.html#dict "dict") instead of
a [`collections.OrderedDict`](../library/collections.html#collections.OrderedDict "collections.OrderedDict"). The tool is now faster and uses less
memory while still preserving the field order.
(Contributed by Michael Selik in [bpo\-34003](https://bugs.python.org/issue?@action=redirect&bpo=34003).)

### curses[¶](#curses "Link to this heading")

Added a new variable holding structured version information for the
underlying ncurses library: [`ncurses_version`](../library/curses.html#curses.ncurses_version "curses.ncurses_version").
(Contributed by Serhiy Storchaka in [bpo\-31680](https://bugs.python.org/issue?@action=redirect&bpo=31680).)

### ctypes[¶](#ctypes "Link to this heading")

On Windows, [`CDLL`](../library/ctypes.html#ctypes.CDLL "ctypes.CDLL") and subclasses now accept a *winmode* parameter
to specify flags for the underlying `LoadLibraryEx` call. The default flags are
set to only load DLL dependencies from trusted locations, including the path
where the DLL is stored (if a full or partial path is used to load the initial
DLL) and paths added by [`add_dll_directory()`](../library/os.html#os.add_dll_directory "os.add_dll_directory").
(Contributed by Steve Dower in [bpo\-36085](https://bugs.python.org/issue?@action=redirect&bpo=36085).)

### datetime[¶](#datetime "Link to this heading")

Added new alternate constructors [`datetime.date.fromisocalendar()`](../library/datetime.html#datetime.date.fromisocalendar "datetime.date.fromisocalendar") and
[`datetime.datetime.fromisocalendar()`](../library/datetime.html#datetime.datetime.fromisocalendar "datetime.datetime.fromisocalendar"), which construct [`date`](../library/datetime.html#datetime.date "datetime.date") and
[`datetime`](../library/datetime.html#datetime.datetime "datetime.datetime") objects respectively from ISO year, week number, and weekday;
these are the inverse of each class’s `isocalendar` method.
(Contributed by Paul Ganssle in [bpo\-36004](https://bugs.python.org/issue?@action=redirect&bpo=36004).)

### functools[¶](#functools "Link to this heading")

[`functools.lru_cache()`](../library/functools.html#functools.lru_cache "functools.lru_cache") can now be used as a straight decorator rather
than as a function returning a decorator. So both of these are now supported:

\`\`\`
@lru\_cache
def f(x):
 ...

@lru\_cache(maxsize=256\)
def f(x):
 ...

\`\`\`

(Contributed by Raymond Hettinger in [bpo\-36772](https://bugs.python.org/issue?@action=redirect&bpo=36772).)

Added a new [`functools.cached_property()`](../library/functools.html#functools.cached_property "functools.cached_property") decorator, for computed properties
cached for the life of the instance.

\`\`\`
import functools
import statistics

class Dataset:
 def \_\_init\_\_(self, sequence\_of\_numbers):
 self.data = sequence\_of\_numbers

 @functools.cached\_property
 def variance(self):
 return statistics.variance(self.data)

\`\`\`

(Contributed by Carl Meyer in [bpo\-21145](https://bugs.python.org/issue?@action=redirect&bpo=21145))

Added a new [`functools.singledispatchmethod()`](../library/functools.html#functools.singledispatchmethod "functools.singledispatchmethod") decorator that converts
methods into [generic functions](../glossary.html#term-generic-function) using
[single dispatch](../glossary.html#term-single-dispatch):

\`\`\`
from functools import singledispatchmethod
from contextlib import suppress

class TaskManager:

 def \_\_init\_\_(self, tasks):
 self.tasks = list(tasks)

 @singledispatchmethod
 def discard(self, value):
 with suppress(ValueError):
 self.tasks.remove(value)

 @discard.register(list)
 def \_(self, tasks):
 targets = set(tasks)
 self.tasks = \[x for x in self.tasks if x not in targets]

\`\`\`

(Contributed by Ethan Smith in [bpo\-32380](https://bugs.python.org/issue?@action=redirect&bpo=32380))

### gc[¶](#gc "Link to this heading")

[`get_objects()`](../library/gc.html#gc.get_objects "gc.get_objects") can now receive an optional *generation* parameter
indicating a generation to get objects from.
(Contributed by Pablo Galindo in [bpo\-36016](https://bugs.python.org/issue?@action=redirect&bpo=36016).)

### gettext[¶](#gettext "Link to this heading")

Added [`pgettext()`](../library/gettext.html#gettext.pgettext "gettext.pgettext") and its variants.
(Contributed by Franz Glasner, Éric Araujo, and Cheryl Sabella in [bpo\-2504](https://bugs.python.org/issue?@action=redirect&bpo=2504).)

### gzip[¶](#gzip "Link to this heading")

Added the *mtime* parameter to [`gzip.compress()`](../library/gzip.html#gzip.compress "gzip.compress") for reproducible output.
(Contributed by Guo Ci Teo in [bpo\-34898](https://bugs.python.org/issue?@action=redirect&bpo=34898).)

A [`BadGzipFile`](../library/gzip.html#gzip.BadGzipFile "gzip.BadGzipFile") exception is now raised instead of [`OSError`](../library/exceptions.html#OSError "OSError")
for certain types of invalid or corrupt gzip files.
(Contributed by Filip Gruszczyński, Michele Orrù, and Zackery Spytz in
[bpo\-6584](https://bugs.python.org/issue?@action=redirect&bpo=6584).)

### IDLE and idlelib[¶](#idle-and-idlelib "Link to this heading")

Output over N lines (50 by default) is squeezed down to a button.
N can be changed in the PyShell section of the General page of the
Settings dialog. Fewer, but possibly extra long, lines can be squeezed by
right clicking on the output. Squeezed output can be expanded in place
by double\-clicking the button or into the clipboard or a separate window
by right\-clicking the button. (Contributed by Tal Einat in [bpo\-1529353](https://bugs.python.org/issue?@action=redirect&bpo=1529353).)

Add “Run Customized” to the Run menu to run a module with customized
settings. Any command line arguments entered are added to sys.argv.
They also re\-appear in the box for the next customized run. One can also
suppress the normal Shell main module restart. (Contributed by Cheryl
Sabella, Terry Jan Reedy, and others in [bpo\-5680](https://bugs.python.org/issue?@action=redirect&bpo=5680) and [bpo\-37627](https://bugs.python.org/issue?@action=redirect&bpo=37627).)

Added optional line numbers for IDLE editor windows. Windows
open without line numbers unless set otherwise in the General
tab of the configuration dialog. Line numbers for an existing
window are shown and hidden in the Options menu.
(Contributed by Tal Einat and Saimadhav Heblikar in [bpo\-17535](https://bugs.python.org/issue?@action=redirect&bpo=17535).)

OS native encoding is now used for converting between Python strings and Tcl
objects. This allows IDLE to work with emoji and other non\-BMP characters.
These characters can be displayed or copied and pasted to or from the
clipboard. Converting strings from Tcl to Python and back now never fails.
(Many people worked on this for eight years but the problem was finally
solved by Serhiy Storchaka in [bpo\-13153](https://bugs.python.org/issue?@action=redirect&bpo=13153).)

New in 3\.8\.1:

Add option to toggle cursor blink off. (Contributed by Zackery Spytz
in [bpo\-4603](https://bugs.python.org/issue?@action=redirect&bpo=4603).)

Escape key now closes IDLE completion windows. (Contributed by Johnny
Najera in [bpo\-38944](https://bugs.python.org/issue?@action=redirect&bpo=38944).)

The changes above have been backported to 3\.7 maintenance releases.

Add keywords to module name completion list. (Contributed by Terry J.
Reedy in [bpo\-37765](https://bugs.python.org/issue?@action=redirect&bpo=37765).)

### inspect[¶](#inspect "Link to this heading")

The [`inspect.getdoc()`](../library/inspect.html#inspect.getdoc "inspect.getdoc") function can now find docstrings for `__slots__`
if that attribute is a [`dict`](../library/stdtypes.html#dict "dict") where the values are docstrings.
This provides documentation options similar to what we already have
for [`property()`](../library/functions.html#property "property"), [`classmethod()`](../library/functions.html#classmethod "classmethod"), and [`staticmethod()`](../library/functions.html#staticmethod "staticmethod"):

\`\`\`
class AudioClip:
 \_\_slots\_\_ = {'bit\_rate': 'expressed in kilohertz to one decimal place',
 'duration': 'in seconds, rounded up to an integer'}
 def \_\_init\_\_(self, bit\_rate, duration):
 self.bit\_rate = round(bit\_rate / 1000\.0, 1\)
 self.duration = ceil(duration)

\`\`\`

(Contributed by Raymond Hettinger in [bpo\-36326](https://bugs.python.org/issue?@action=redirect&bpo=36326).)

### io[¶](#io "Link to this heading")

In development mode ([`-X`](../using/cmdline.html#cmdoption-X) `env`) and in [debug build](../using/configure.html#debug-build), the
[`io.IOBase`](../library/io.html#io.IOBase "io.IOBase") finalizer now logs the exception if the `close()` method
fails. The exception is ignored silently by default in release build.
(Contributed by Victor Stinner in [bpo\-18748](https://bugs.python.org/issue?@action=redirect&bpo=18748).)

### itertools[¶](#itertools "Link to this heading")

The [`itertools.accumulate()`](../library/itertools.html#itertools.accumulate "itertools.accumulate") function added an option *initial* keyword
argument to specify an initial value:

\`\`\`
\>\>\> from itertools import accumulate
\>\>\> list(accumulate(\[10, 5, 30, 15], initial=1000\))
\[1000, 1010, 1015, 1045, 1060]

\`\`\`

(Contributed by Lisa Roach in [bpo\-34659](https://bugs.python.org/issue?@action=redirect&bpo=34659).)

### json.tool[¶](#json-tool "Link to this heading")

Add option `--json-lines` to parse every input line as a separate JSON object.
(Contributed by Weipeng Hong in [bpo\-31553](https://bugs.python.org/issue?@action=redirect&bpo=31553).)

### logging[¶](#logging "Link to this heading")

Added a *force* keyword argument to [`logging.basicConfig()`](../library/logging.html#logging.basicConfig "logging.basicConfig").
When set to true, any existing handlers attached
to the root logger are removed and closed before carrying out the
configuration specified by the other arguments.

This solves a long\-standing problem. Once a logger or *basicConfig()* had
been called, subsequent calls to *basicConfig()* were silently ignored.
This made it difficult to update, experiment with, or teach the various
logging configuration options using the interactive prompt or a Jupyter
notebook.

(Suggested by Raymond Hettinger, implemented by Donghee Na, and
reviewed by Vinay Sajip in [bpo\-33897](https://bugs.python.org/issue?@action=redirect&bpo=33897).)

### math[¶](#math "Link to this heading")

Added new function [`math.dist()`](../library/math.html#math.dist "math.dist") for computing Euclidean distance
between two points. (Contributed by Raymond Hettinger in [bpo\-33089](https://bugs.python.org/issue?@action=redirect&bpo=33089).)

Expanded the [`math.hypot()`](../library/math.html#math.hypot "math.hypot") function to handle multiple dimensions.
Formerly, it only supported the 2\-D case.
(Contributed by Raymond Hettinger in [bpo\-33089](https://bugs.python.org/issue?@action=redirect&bpo=33089).)

Added new function, [`math.prod()`](../library/math.html#math.prod "math.prod"), as analogous function to [`sum()`](../library/functions.html#sum "sum")
that returns the product of a ‘start’ value (default: 1\) times an iterable of
numbers:

\`\`\`
\>\>\> prior = 0\.8
\>\>\> likelihoods = \[0\.625, 0\.84, 0\.30]
\>\>\> math.prod(likelihoods, start=prior)
0\.126

\`\`\`

(Contributed by Pablo Galindo in [bpo\-35606](https://bugs.python.org/issue?@action=redirect&bpo=35606).)

Added two new combinatoric functions [`math.perm()`](../library/math.html#math.perm "math.perm") and [`math.comb()`](../library/math.html#math.comb "math.comb"):

\`\`\`
\>\>\> math.perm(10, 3\) \# Permutations of 10 things taken 3 at a time
720
\>\>\> math.comb(10, 3\) \# Combinations of 10 things taken 3 at a time
120

\`\`\`

(Contributed by Yash Aggarwal, Keller Fuchs, Serhiy Storchaka, and Raymond
Hettinger in [bpo\-37128](https://bugs.python.org/issue?@action=redirect&bpo=37128), [bpo\-37178](https://bugs.python.org/issue?@action=redirect&bpo=37178), and [bpo\-35431](https://bugs.python.org/issue?@action=redirect&bpo=35431).)

Added a new function [`math.isqrt()`](../library/math.html#math.isqrt "math.isqrt") for computing accurate integer square
roots without conversion to floating point. The new function supports
arbitrarily large integers. It is faster than `floor(sqrt(n))` but slower
than [`math.sqrt()`](../library/math.html#math.sqrt "math.sqrt"):

\`\`\`
\>\>\> r = 650320427
\>\>\> s = r \*\* 2
\>\>\> isqrt(s \- 1\) \# correct
650320426
\>\>\> floor(sqrt(s \- 1\)) \# incorrect
650320427

\`\`\`

(Contributed by Mark Dickinson in [bpo\-36887](https://bugs.python.org/issue?@action=redirect&bpo=36887).)

The function [`math.factorial()`](../library/math.html#math.factorial "math.factorial") no longer accepts arguments that are not
int\-like. (Contributed by Pablo Galindo in [bpo\-33083](https://bugs.python.org/issue?@action=redirect&bpo=33083).)

### mmap[¶](#mmap "Link to this heading")

The [`mmap.mmap`](../library/mmap.html#mmap.mmap "mmap.mmap") class now has an [`madvise()`](../library/mmap.html#mmap.mmap.madvise "mmap.mmap.madvise") method to
access the `madvise()` system call.
(Contributed by Zackery Spytz in [bpo\-32941](https://bugs.python.org/issue?@action=redirect&bpo=32941).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

Added new [`multiprocessing.shared_memory`](../library/multiprocessing.shared_memory.html#module-multiprocessing.shared_memory "multiprocessing.shared_memory: Provides shared memory for direct access across processes.") module.
(Contributed by Davin Potts in [bpo\-35813](https://bugs.python.org/issue?@action=redirect&bpo=35813).)

On macOS, the *spawn* start method is now used by default.
(Contributed by Victor Stinner in [bpo\-33725](https://bugs.python.org/issue?@action=redirect&bpo=33725).)

### os[¶](#os "Link to this heading")

Added new function [`add_dll_directory()`](../library/os.html#os.add_dll_directory "os.add_dll_directory") on Windows for providing
additional search paths for native dependencies when importing extension
modules or loading DLLs using [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python.").
(Contributed by Steve Dower in [bpo\-36085](https://bugs.python.org/issue?@action=redirect&bpo=36085).)

A new [`os.memfd_create()`](../library/os.html#os.memfd_create "os.memfd_create") function was added to wrap the
`memfd_create()` syscall.
(Contributed by Zackery Spytz and Christian Heimes in [bpo\-26836](https://bugs.python.org/issue?@action=redirect&bpo=26836).)

On Windows, much of the manual logic for handling reparse points (including
symlinks and directory junctions) has been delegated to the operating system.
Specifically, [`os.stat()`](../library/os.html#os.stat "os.stat") will now traverse anything supported by the
operating system, while [`os.lstat()`](../library/os.html#os.lstat "os.lstat") will only open reparse points that
identify as “name surrogates” while others are opened as for [`os.stat()`](../library/os.html#os.stat "os.stat").
In all cases, `stat_result.st_mode` will only have `S_IFLNK` set for
symbolic links and not other kinds of reparse points. To identify other kinds
of reparse point, check the new `stat_result.st_reparse_tag` attribute.

On Windows, [`os.readlink()`](../library/os.html#os.readlink "os.readlink") is now able to read directory junctions. Note
that [`islink()`](../library/os.path.html#os.path.islink "os.path.islink") will return `False` for directory junctions,
and so code that checks `islink` first will continue to treat junctions as
directories, while code that handles errors from [`os.readlink()`](../library/os.html#os.readlink "os.readlink") may now
treat junctions as links.

(Contributed by Steve Dower in [bpo\-37834](https://bugs.python.org/issue?@action=redirect&bpo=37834).)

### os.path[¶](#os-path "Link to this heading")

[`os.path`](../library/os.path.html#module-os.path "os.path: Operations on pathnames.") functions that return a boolean result like
[`exists()`](../library/os.path.html#os.path.exists "os.path.exists"), [`lexists()`](../library/os.path.html#os.path.lexists "os.path.lexists"), [`isdir()`](../library/os.path.html#os.path.isdir "os.path.isdir"),
[`isfile()`](../library/os.path.html#os.path.isfile "os.path.isfile"), [`islink()`](../library/os.path.html#os.path.islink "os.path.islink"), and [`ismount()`](../library/os.path.html#os.path.ismount "os.path.ismount")
now return `False` instead of raising [`ValueError`](../library/exceptions.html#ValueError "ValueError") or its subclasses
[`UnicodeEncodeError`](../library/exceptions.html#UnicodeEncodeError "UnicodeEncodeError") and [`UnicodeDecodeError`](../library/exceptions.html#UnicodeDecodeError "UnicodeDecodeError") for paths that contain
characters or bytes unrepresentable at the OS level.
(Contributed by Serhiy Storchaka in [bpo\-33721](https://bugs.python.org/issue?@action=redirect&bpo=33721).)

[`expanduser()`](../library/os.path.html#os.path.expanduser "os.path.expanduser") on Windows now prefers the `USERPROFILE`
environment variable and does not use `HOME`, which is not normally set
for regular user accounts.
(Contributed by Anthony Sottile in [bpo\-36264](https://bugs.python.org/issue?@action=redirect&bpo=36264).)

[`isdir()`](../library/os.path.html#os.path.isdir "os.path.isdir") on Windows no longer returns `True` for a link to a
non\-existent directory.

[`realpath()`](../library/os.path.html#os.path.realpath "os.path.realpath") on Windows now resolves reparse points, including
symlinks and directory junctions.

(Contributed by Steve Dower in [bpo\-37834](https://bugs.python.org/issue?@action=redirect&bpo=37834).)

### pathlib[¶](#pathlib "Link to this heading")

[`pathlib.Path`](../library/pathlib.html#pathlib.Path "pathlib.Path") methods that return a boolean result like
[`exists()`](../library/pathlib.html#pathlib.Path.exists "pathlib.Path.exists"), [`is_dir()`](../library/pathlib.html#pathlib.Path.is_dir "pathlib.Path.is_dir"),
[`is_file()`](../library/pathlib.html#pathlib.Path.is_file "pathlib.Path.is_file"), [`is_mount()`](../library/pathlib.html#pathlib.Path.is_mount "pathlib.Path.is_mount"),
[`is_symlink()`](../library/pathlib.html#pathlib.Path.is_symlink "pathlib.Path.is_symlink"), [`is_block_device()`](../library/pathlib.html#pathlib.Path.is_block_device "pathlib.Path.is_block_device"),
[`is_char_device()`](../library/pathlib.html#pathlib.Path.is_char_device "pathlib.Path.is_char_device"), [`is_fifo()`](../library/pathlib.html#pathlib.Path.is_fifo "pathlib.Path.is_fifo"),
[`is_socket()`](../library/pathlib.html#pathlib.Path.is_socket "pathlib.Path.is_socket") now return `False` instead of raising
[`ValueError`](../library/exceptions.html#ValueError "ValueError") or its subclass [`UnicodeEncodeError`](../library/exceptions.html#UnicodeEncodeError "UnicodeEncodeError") for paths that
contain characters unrepresentable at the OS level.
(Contributed by Serhiy Storchaka in [bpo\-33721](https://bugs.python.org/issue?@action=redirect&bpo=33721).)

Added `pathlib.Path.link_to()` which creates a hard link pointing
to a path.
(Contributed by Joannah Nanjekye in [bpo\-26978](https://bugs.python.org/issue?@action=redirect&bpo=26978))
Note that `link_to` was deprecated in 3\.10 and removed in 3\.12 in
favor of a `hardlink_to` method added in 3\.10 which matches the
semantics of the existing `symlink_to` method.

### pickle[¶](#pickle "Link to this heading")

[`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") extensions subclassing the C\-optimized [`Pickler`](../library/pickle.html#pickle.Pickler "pickle.Pickler")
can now override the pickling logic of functions and classes by defining the
special [`reducer_override()`](../library/pickle.html#pickle.Pickler.reducer_override "pickle.Pickler.reducer_override") method.
(Contributed by Pierre Glaser and Olivier Grisel in [bpo\-35900](https://bugs.python.org/issue?@action=redirect&bpo=35900).)

### plistlib[¶](#plistlib "Link to this heading")

Added new [`plistlib.UID`](../library/plistlib.html#plistlib.UID "plistlib.UID") and enabled support for reading and writing
NSKeyedArchiver\-encoded binary plists.
(Contributed by Jon Janzen in [bpo\-26707](https://bugs.python.org/issue?@action=redirect&bpo=26707).)

### pprint[¶](#pprint "Link to this heading")

The [`pprint`](../library/pprint.html#module-pprint "pprint: Data pretty printer.") module added a *sort\_dicts* parameter to several functions.
By default, those functions continue to sort dictionaries before rendering or
printing. However, if *sort\_dicts* is set to false, the dictionaries retain
the order that keys were inserted. This can be useful for comparison to JSON
inputs during debugging.

In addition, there is a convenience new function, [`pprint.pp()`](../library/pprint.html#pprint.pp "pprint.pp") that is
like [`pprint.pprint()`](../library/pprint.html#pprint.pprint "pprint.pprint") but with *sort\_dicts* defaulting to `False`:

\`\`\`
\>\>\> from pprint import pprint, pp
\>\>\> d = dict(source='input.txt', operation='filter', destination='output.txt')
\>\>\> pp(d, width=40\) \# Original order
{'source': 'input.txt',
 'operation': 'filter',
 'destination': 'output.txt'}
\>\>\> pprint(d, width=40\) \# Keys sorted alphabetically
{'destination': 'output.txt',
 'operation': 'filter',
 'source': 'input.txt'}

\`\`\`

(Contributed by Rémi Lapeyre in [bpo\-30670](https://bugs.python.org/issue?@action=redirect&bpo=30670).)

### py\_compile[¶](#py-compile "Link to this heading")

[`py_compile.compile()`](../library/py_compile.html#py_compile.compile "py_compile.compile") now supports silent mode.
(Contributed by Joannah Nanjekye in [bpo\-22640](https://bugs.python.org/issue?@action=redirect&bpo=22640).)

### shlex[¶](#shlex "Link to this heading")

The new [`shlex.join()`](../library/shlex.html#shlex.join "shlex.join") function acts as the inverse of [`shlex.split()`](../library/shlex.html#shlex.split "shlex.split").
(Contributed by Bo Bayles in [bpo\-32102](https://bugs.python.org/issue?@action=redirect&bpo=32102).)

### shutil[¶](#shutil "Link to this heading")

[`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree") now accepts a new `dirs_exist_ok` keyword argument.
(Contributed by Josh Bronson in [bpo\-20849](https://bugs.python.org/issue?@action=redirect&bpo=20849).)

[`shutil.make_archive()`](../library/shutil.html#shutil.make_archive "shutil.make_archive") now defaults to the modern pax (POSIX.1\-2001\)
format for new archives to improve portability and standards conformance,
inherited from the corresponding change to the [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") module.
(Contributed by C.A.M. Gerlach in [bpo\-30661](https://bugs.python.org/issue?@action=redirect&bpo=30661).)

[`shutil.rmtree()`](../library/shutil.html#shutil.rmtree "shutil.rmtree") on Windows now removes directory junctions without
recursively removing their contents first.
(Contributed by Steve Dower in [bpo\-37834](https://bugs.python.org/issue?@action=redirect&bpo=37834).)

### socket[¶](#socket "Link to this heading")

Added [`create_server()`](../library/socket.html#socket.create_server "socket.create_server") and [`has_dualstack_ipv6()`](../library/socket.html#socket.has_dualstack_ipv6 "socket.has_dualstack_ipv6")
convenience functions to automate the necessary tasks usually involved when
creating a server socket, including accepting both IPv4 and IPv6 connections
on the same socket. (Contributed by Giampaolo Rodolà in [bpo\-17561](https://bugs.python.org/issue?@action=redirect&bpo=17561).)

The [`socket.if_nameindex()`](../library/socket.html#socket.if_nameindex "socket.if_nameindex"), [`socket.if_nametoindex()`](../library/socket.html#socket.if_nametoindex "socket.if_nametoindex"), and
[`socket.if_indextoname()`](../library/socket.html#socket.if_indextoname "socket.if_indextoname") functions have been implemented on Windows.
(Contributed by Zackery Spytz in [bpo\-37007](https://bugs.python.org/issue?@action=redirect&bpo=37007).)

### ssl[¶](#ssl "Link to this heading")

Added [`post_handshake_auth`](../library/ssl.html#ssl.SSLContext.post_handshake_auth "ssl.SSLContext.post_handshake_auth") to enable and
[`verify_client_post_handshake()`](../library/ssl.html#ssl.SSLSocket.verify_client_post_handshake "ssl.SSLSocket.verify_client_post_handshake") to initiate TLS 1\.3
post\-handshake authentication.
(Contributed by Christian Heimes in [bpo\-34670](https://bugs.python.org/issue?@action=redirect&bpo=34670).)

### statistics[¶](#statistics "Link to this heading")

Added [`statistics.fmean()`](../library/statistics.html#statistics.fmean "statistics.fmean") as a faster, floating\-point variant of
[`statistics.mean()`](../library/statistics.html#statistics.mean "statistics.mean"). (Contributed by Raymond Hettinger and
Steven D’Aprano in [bpo\-35904](https://bugs.python.org/issue?@action=redirect&bpo=35904).)

Added [`statistics.geometric_mean()`](../library/statistics.html#statistics.geometric_mean "statistics.geometric_mean")
(Contributed by Raymond Hettinger in [bpo\-27181](https://bugs.python.org/issue?@action=redirect&bpo=27181).)

Added [`statistics.multimode()`](../library/statistics.html#statistics.multimode "statistics.multimode") that returns a list of the most
common values. (Contributed by Raymond Hettinger in [bpo\-35892](https://bugs.python.org/issue?@action=redirect&bpo=35892).)

Added [`statistics.quantiles()`](../library/statistics.html#statistics.quantiles "statistics.quantiles") that divides data or a distribution
in to equiprobable intervals (e.g. quartiles, deciles, or percentiles).
(Contributed by Raymond Hettinger in [bpo\-36546](https://bugs.python.org/issue?@action=redirect&bpo=36546).)

Added [`statistics.NormalDist`](../library/statistics.html#statistics.NormalDist "statistics.NormalDist"), a tool for creating
and manipulating normal distributions of a random variable.
(Contributed by Raymond Hettinger in [bpo\-36018](https://bugs.python.org/issue?@action=redirect&bpo=36018).)

\`\`\`
\>\>\> temperature\_feb = NormalDist.from\_samples(\[4, 12, \-3, 2, 7, 14])
\>\>\> temperature\_feb.mean
6\.0
\>\>\> temperature\_feb.stdev
6\.356099432828281

\>\>\> temperature\_feb.cdf(3\) \# Chance of being under 3 degrees
0\.3184678262814532
\>\>\> \# Relative chance of being 7 degrees versus 10 degrees
\>\>\> temperature\_feb.pdf(7\) / temperature\_feb.pdf(10\)
1\.2039930378537762

\>\>\> el\_niño = NormalDist(4, 2\.5\)
\>\>\> temperature\_feb \+= el\_niño \# Add in a climate effect
\>\>\> temperature\_feb
NormalDist(mu=10\.0, sigma=6\.830080526611674\)

\>\>\> temperature\_feb \* (9/5\) \+ 32 \# Convert to Fahrenheit
NormalDist(mu=50\.0, sigma=12\.294144947901014\)
\>\>\> temperature\_feb.samples(3\) \# Generate random samples
\[7\.672102882379219, 12\.000027119750287, 4\.647488369766392]

\`\`\`

### sys[¶](#sys "Link to this heading")

Add new [`sys.unraisablehook()`](../library/sys.html#sys.unraisablehook "sys.unraisablehook") function which can be overridden to control
how “unraisable exceptions” are handled. It is called when an exception has
occurred but there is no way for Python to handle it. For example, when a
destructor raises an exception or during garbage collection
([`gc.collect()`](../library/gc.html#gc.collect "gc.collect")).
(Contributed by Victor Stinner in [bpo\-36829](https://bugs.python.org/issue?@action=redirect&bpo=36829).)

### tarfile[¶](#tarfile "Link to this heading")

The [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") module now defaults to the modern pax (POSIX.1\-2001\)
format for new archives, instead of the previous GNU\-specific one.
This improves cross\-platform portability with a consistent encoding (UTF\-8\)
in a standardized and extensible format, and offers several other benefits.
(Contributed by C.A.M. Gerlach in [bpo\-36268](https://bugs.python.org/issue?@action=redirect&bpo=36268).)

### threading[¶](#threading "Link to this heading")

Add a new [`threading.excepthook()`](../library/threading.html#threading.excepthook "threading.excepthook") function which handles uncaught
[`threading.Thread.run()`](../library/threading.html#threading.Thread.run "threading.Thread.run") exception. It can be overridden to control how
uncaught [`threading.Thread.run()`](../library/threading.html#threading.Thread.run "threading.Thread.run") exceptions are handled.
(Contributed by Victor Stinner in [bpo\-1230540](https://bugs.python.org/issue?@action=redirect&bpo=1230540).)

Add a new [`threading.get_native_id()`](../library/threading.html#threading.get_native_id "threading.get_native_id") function and
a [`native_id`](../library/threading.html#threading.Thread.native_id "threading.Thread.native_id")
attribute to the [`threading.Thread`](../library/threading.html#threading.Thread "threading.Thread") class. These return the native
integral Thread ID of the current thread assigned by the kernel.
This feature is only available on certain platforms, see
[`get_native_id`](../library/threading.html#threading.get_native_id "threading.get_native_id") for more information.
(Contributed by Jake Tesler in [bpo\-36084](https://bugs.python.org/issue?@action=redirect&bpo=36084).)

### tokenize[¶](#tokenize "Link to this heading")

The [`tokenize`](../library/tokenize.html#module-tokenize "tokenize: Lexical scanner for Python source code.") module now implicitly emits a `NEWLINE` token when
provided with input that does not have a trailing new line. This behavior
now matches what the C tokenizer does internally.
(Contributed by Ammar Askar in [bpo\-33899](https://bugs.python.org/issue?@action=redirect&bpo=33899).)

### tkinter[¶](#tkinter "Link to this heading")

Added methods `selection_from()`,
`selection_present()`,
`selection_range()` and
`selection_to()`
in the `tkinter.Spinbox` class.
(Contributed by Juliette Monsel in [bpo\-34829](https://bugs.python.org/issue?@action=redirect&bpo=34829).)

Added method `moveto()`
in the `tkinter.Canvas` class.
(Contributed by Juliette Monsel in [bpo\-23831](https://bugs.python.org/issue?@action=redirect&bpo=23831).)

The `tkinter.PhotoImage` class now has
`transparency_get()` and
`transparency_set()` methods. (Contributed by
Zackery Spytz in [bpo\-25451](https://bugs.python.org/issue?@action=redirect&bpo=25451).)

### time[¶](#time "Link to this heading")

Added new clock [`CLOCK_UPTIME_RAW`](../library/time.html#time.CLOCK_UPTIME_RAW "time.CLOCK_UPTIME_RAW") for macOS 10\.12\.
(Contributed by Joannah Nanjekye in [bpo\-35702](https://bugs.python.org/issue?@action=redirect&bpo=35702).)

### typing[¶](#typing "Link to this heading")

The [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module incorporates several new features:

* A dictionary type with per\-key types. See [**PEP 589**](https://peps.python.org/pep-0589/) and
[`typing.TypedDict`](../library/typing.html#typing.TypedDict "typing.TypedDict").
TypedDict uses only string keys. By default, every key is required
to be present. Specify “total=False” to allow keys to be optional:

\`\`\`
class Location(TypedDict, total=False):
 lat\_long: tuple
 grid\_square: str
 xy\_coordinate: tuple

\`\`\`
* Literal types. See [**PEP 586**](https://peps.python.org/pep-0586/) and [`typing.Literal`](../library/typing.html#typing.Literal "typing.Literal").
Literal types indicate that a parameter or return value
is constrained to one or more specific literal values:

\`\`\`
def get\_status(port: int) \-\> Literal\['connected', 'disconnected']:
 ...

\`\`\`
* “Final” variables, functions, methods and classes. See [**PEP 591**](https://peps.python.org/pep-0591/),
[`typing.Final`](../library/typing.html#typing.Final "typing.Final") and [`typing.final()`](../library/typing.html#typing.final "typing.final").
The final qualifier instructs a static type checker to restrict
subclassing, overriding, or reassignment:

\`\`\`
pi: Final\[float] = 3\.1415926536

\`\`\`
* Protocol definitions. See [**PEP 544**](https://peps.python.org/pep-0544/), [`typing.Protocol`](../library/typing.html#typing.Protocol "typing.Protocol") and
[`typing.runtime_checkable()`](../library/typing.html#typing.runtime_checkable "typing.runtime_checkable"). Simple ABCs like
[`typing.SupportsInt`](../library/typing.html#typing.SupportsInt "typing.SupportsInt") are now `Protocol` subclasses.
* New protocol class [`typing.SupportsIndex`](../library/typing.html#typing.SupportsIndex "typing.SupportsIndex").
* New functions [`typing.get_origin()`](../library/typing.html#typing.get_origin "typing.get_origin") and [`typing.get_args()`](../library/typing.html#typing.get_args "typing.get_args").

### unicodedata[¶](#unicodedata "Link to this heading")

The [`unicodedata`](../library/unicodedata.html#module-unicodedata "unicodedata: Access the Unicode Database.") module has been upgraded to use the [Unicode 12\.1\.0](https://blog.unicode.org/2019/05/unicode-12-1-en.html) release.

New function [`is_normalized()`](../library/unicodedata.html#unicodedata.is_normalized "unicodedata.is_normalized") can be used to verify a string
is in a specific normal form, often much faster than by actually normalizing
the string. (Contributed by Max Belanger, David Euresti, and Greg Price in
[bpo\-32285](https://bugs.python.org/issue?@action=redirect&bpo=32285) and [bpo\-37966](https://bugs.python.org/issue?@action=redirect&bpo=37966)).

### unittest[¶](#unittest "Link to this heading")

Added [`AsyncMock`](../library/unittest.mock.html#unittest.mock.AsyncMock "unittest.mock.AsyncMock") to support an asynchronous version of
[`Mock`](../library/unittest.mock.html#unittest.mock.Mock "unittest.mock.Mock"). Appropriate new assert functions for testing
have been added as well.
(Contributed by Lisa Roach in [bpo\-26467](https://bugs.python.org/issue?@action=redirect&bpo=26467)).

Added [`addModuleCleanup()`](../library/unittest.html#unittest.addModuleCleanup "unittest.addModuleCleanup") and
[`addClassCleanup()`](../library/unittest.html#unittest.TestCase.addClassCleanup "unittest.TestCase.addClassCleanup") to unittest to support
cleanups for `setUpModule()` and
[`setUpClass()`](../library/unittest.html#unittest.TestCase.setUpClass "unittest.TestCase.setUpClass").
(Contributed by Lisa Roach in [bpo\-24412](https://bugs.python.org/issue?@action=redirect&bpo=24412).)

Several mock assert functions now also print a list of actual calls upon
failure. (Contributed by Petter Strandmark in [bpo\-35047](https://bugs.python.org/issue?@action=redirect&bpo=35047).)

[`unittest`](../library/unittest.html#module-unittest "unittest: Unit testing framework for Python.") module gained support for coroutines to be used as test cases
with [`unittest.IsolatedAsyncioTestCase`](../library/unittest.html#unittest.IsolatedAsyncioTestCase "unittest.IsolatedAsyncioTestCase").
(Contributed by Andrew Svetlov in [bpo\-32972](https://bugs.python.org/issue?@action=redirect&bpo=32972).)

Example:

\`\`\`
import unittest

class TestRequest(unittest.IsolatedAsyncioTestCase):

 async def asyncSetUp(self):
 self.connection = await AsyncConnection()

 async def test\_get(self):
 response = await self.connection.get("https://example.com")
 self.assertEqual(response.status\_code, 200\)

 async def asyncTearDown(self):
 await self.connection.close()

if \_\_name\_\_ == "\_\_main\_\_":
 unittest.main()

\`\`\`

### venv[¶](#venv "Link to this heading")

[`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") now includes an `Activate.ps1` script on all platforms for
activating virtual environments under PowerShell Core 6\.1\.
(Contributed by Brett Cannon in [bpo\-32718](https://bugs.python.org/issue?@action=redirect&bpo=32718).)

### weakref[¶](#weakref "Link to this heading")

The proxy objects returned by [`weakref.proxy()`](../library/weakref.html#weakref.proxy "weakref.proxy") now support the matrix
multiplication operators `@` and `@=` in addition to the other
numeric operators. (Contributed by Mark Dickinson in [bpo\-36669](https://bugs.python.org/issue?@action=redirect&bpo=36669).)

### xml[¶](#xml "Link to this heading")

As mitigation against DTD and external entity retrieval, the
[`xml.dom.minidom`](../library/xml.dom.minidom.html#module-xml.dom.minidom "xml.dom.minidom: Minimal Document Object Model (DOM) implementation.") and [`xml.sax`](../library/xml.sax.html#module-xml.sax "xml.sax: Package containing SAX2 base classes and convenience functions.") modules no longer process
external entities by default.
(Contributed by Christian Heimes in [bpo\-17239](https://bugs.python.org/issue?@action=redirect&bpo=17239).)

The `.find*()` methods in the [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") module
support wildcard searches like `{*}tag` which ignores the namespace
and `{namespace}*` which returns all tags in the given namespace.
(Contributed by Stefan Behnel in [bpo\-28238](https://bugs.python.org/issue?@action=redirect&bpo=28238).)

The [`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") module provides a new function
`–xml.etree.ElementTree.canonicalize()` that implements C14N 2\.0\.
(Contributed by Stefan Behnel in [bpo\-13611](https://bugs.python.org/issue?@action=redirect&bpo=13611).)

The target object of [`xml.etree.ElementTree.XMLParser`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser "xml.etree.ElementTree.XMLParser") can
receive namespace declaration events through the new callback methods
`start_ns()` and `end_ns()`. Additionally, the
[`xml.etree.ElementTree.TreeBuilder`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder "xml.etree.ElementTree.TreeBuilder") target can be configured
to process events about comments and processing instructions to include
them in the generated tree.
(Contributed by Stefan Behnel in [bpo\-36676](https://bugs.python.org/issue?@action=redirect&bpo=36676) and [bpo\-36673](https://bugs.python.org/issue?@action=redirect&bpo=36673).)

### xmlrpc[¶](#xmlrpc "Link to this heading")

[`xmlrpc.client.ServerProxy`](../library/xmlrpc.client.html#xmlrpc.client.ServerProxy "xmlrpc.client.ServerProxy") now supports an optional *headers* keyword
argument for a sequence of HTTP headers to be sent with each request. Among
other things, this makes it possible to upgrade from default basic
authentication to faster session authentication.
(Contributed by Cédric Krier in [bpo\-35153](https://bugs.python.org/issue?@action=redirect&bpo=35153).)

## Optimizations[¶](#optimizations "Link to this heading")

* The [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") module can now use the [`os.posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") function
in some cases for better performance. Currently, it is only used on macOS
and Linux (using glibc 2\.24 or newer) if all these conditions are met:

	+ *close\_fds* is false;
	+ *preexec\_fn*, *pass\_fds*, *cwd* and *start\_new\_session* parameters
	are not set;
	+ the *executable* path contains a directory.(Contributed by Joannah Nanjekye and Victor Stinner in [bpo\-35537](https://bugs.python.org/issue?@action=redirect&bpo=35537).)
* [`shutil.copyfile()`](../library/shutil.html#shutil.copyfile "shutil.copyfile"), [`shutil.copy()`](../library/shutil.html#shutil.copy "shutil.copy"), [`shutil.copy2()`](../library/shutil.html#shutil.copy2 "shutil.copy2"),
[`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree") and [`shutil.move()`](../library/shutil.html#shutil.move "shutil.move") use platform\-specific
“fast\-copy” syscalls on Linux and macOS in order to copy the file
more efficiently.
“fast\-copy” means that the copying operation occurs within the kernel,
avoiding the use of userspace buffers in Python as in
“`outfd.write(infd.read())`”.
On Windows [`shutil.copyfile()`](../library/shutil.html#shutil.copyfile "shutil.copyfile") uses a bigger default buffer size (1 MiB
instead of 16 KiB) and a [`memoryview()`](../library/stdtypes.html#memoryview "memoryview")\-based variant of
[`shutil.copyfileobj()`](../library/shutil.html#shutil.copyfileobj "shutil.copyfileobj") is used.
The speedup for copying a 512 MiB file within the same partition is about
\+26% on Linux, \+50% on macOS and \+40% on Windows. Also, much less CPU cycles
are consumed.
See [Platform\-dependent efficient copy operations](../library/shutil.html#shutil-platform-dependent-efficient-copy-operations) section.
(Contributed by Giampaolo Rodolà in [bpo\-33671](https://bugs.python.org/issue?@action=redirect&bpo=33671).)
* [`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree") uses [`os.scandir()`](../library/os.html#os.scandir "os.scandir") function and all copy
functions depending from it use cached [`os.stat()`](../library/os.html#os.stat "os.stat") values. The speedup
for copying a directory with 8000 files is around \+9% on Linux, \+20% on
Windows and \+30% on a Windows SMB share. Also the number of [`os.stat()`](../library/os.html#os.stat "os.stat")
syscalls is reduced by 38% making [`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree") especially faster
on network filesystems. (Contributed by Giampaolo Rodolà in [bpo\-33695](https://bugs.python.org/issue?@action=redirect&bpo=33695).)
* The default protocol in the [`pickle`](../library/pickle.html#module-pickle "pickle: Convert Python objects to streams of bytes and back.") module is now Protocol 4,
first introduced in Python 3\.4\. It offers better performance and smaller
size compared to Protocol 3 available since Python 3\.0\.
* Removed one [`Py_ssize_t`](../c-api/intro.html#c.Py_ssize_t "Py_ssize_t") member from `PyGC_Head`. All GC tracked
objects (e.g. tuple, list, dict) size is reduced 4 or 8 bytes.
(Contributed by Inada Naoki in [bpo\-33597](https://bugs.python.org/issue?@action=redirect&bpo=33597).)
* [`uuid.UUID`](../library/uuid.html#uuid.UUID "uuid.UUID") now uses `__slots__` to reduce its memory footprint.
(Contributed by Wouter Bolsterlee and Tal Einat in [bpo\-30977](https://bugs.python.org/issue?@action=redirect&bpo=30977))
* Improved performance of [`operator.itemgetter()`](../library/operator.html#operator.itemgetter "operator.itemgetter") by 33%. Optimized
argument handling and added a fast path for the common case of a single
non\-negative integer index into a tuple (which is the typical use case in
the standard library). (Contributed by Raymond Hettinger in
[bpo\-35664](https://bugs.python.org/issue?@action=redirect&bpo=35664).)
* Sped\-up field lookups in [`collections.namedtuple()`](../library/collections.html#collections.namedtuple "collections.namedtuple"). They are now more
than two times faster, making them the fastest form of instance variable
lookup in Python. (Contributed by Raymond Hettinger, Pablo Galindo, and
Joe Jevnik, Serhiy Storchaka in [bpo\-32492](https://bugs.python.org/issue?@action=redirect&bpo=32492).)
* The [`list`](../library/stdtypes.html#list "list") constructor does not overallocate the internal item buffer
if the input iterable has a known length (the input implements `__len__`).
This makes the created list 12% smaller on average. (Contributed by
Raymond Hettinger and Pablo Galindo in [bpo\-33234](https://bugs.python.org/issue?@action=redirect&bpo=33234).)
* Doubled the speed of class variable writes. When a non\-dunder attribute
was updated, there was an unnecessary call to update slots.
(Contributed by Stefan Behnel, Pablo Galindo Salgado, Raymond Hettinger,
Neil Schemenauer, and Serhiy Storchaka in [bpo\-36012](https://bugs.python.org/issue?@action=redirect&bpo=36012).)
* Reduced an overhead of converting arguments passed to many builtin functions
and methods. This sped up calling some simple builtin functions and
methods up to 20–50%. (Contributed by Serhiy Storchaka in [bpo\-23867](https://bugs.python.org/issue?@action=redirect&bpo=23867),
[bpo\-35582](https://bugs.python.org/issue?@action=redirect&bpo=35582) and [bpo\-36127](https://bugs.python.org/issue?@action=redirect&bpo=36127).)
* `LOAD_GLOBAL` instruction now uses new “per opcode cache” mechanism.
It is about 40% faster now. (Contributed by Yury Selivanov and Inada Naoki in
[bpo\-26219](https://bugs.python.org/issue?@action=redirect&bpo=26219).)

## Build and C API Changes[¶](#build-and-c-api-changes "Link to this heading")

* Default [`sys.abiflags`](../library/sys.html#sys.abiflags "sys.abiflags") became an empty string: the `m` flag for
pymalloc became useless (builds with and without pymalloc are ABI compatible)
and so has been removed. (Contributed by Victor Stinner in [bpo\-36707](https://bugs.python.org/issue?@action=redirect&bpo=36707).)

Example of changes:

	+ Only `python3.8` program is installed, `python3.8m` program is gone.
	+ Only `python3.8-config` script is installed, `python3.8m-config` script
	is gone.
	+ The `m` flag has been removed from the suffix of dynamic library
	filenames: extension modules in the standard library as well as those
	produced and installed by third\-party packages, like those downloaded from
	PyPI. On Linux, for example, the Python 3\.7 suffix
	`.cpython-37m-x86_64-linux-gnu.so` became
	`.cpython-38-x86_64-linux-gnu.so` in Python 3\.8\.
* The header files have been reorganized to better separate the different kinds
of APIs:

	+ `Include/*.h` should be the portable public stable C API.
	+ `Include/cpython/*.h` should be the unstable C API specific to CPython;
	public API, with some private API prefixed by `_Py` or `_PY`.
	+ `Include/internal/*.h` is the private internal C API very specific to
	CPython. This API comes with no backward compatibility warranty and should
	not be used outside CPython. It is only exposed for very specific needs
	like debuggers and profiles which has to access to CPython internals
	without calling functions. This API is now installed by `make install`.(Contributed by Victor Stinner in [bpo\-35134](https://bugs.python.org/issue?@action=redirect&bpo=35134) and [bpo\-35081](https://bugs.python.org/issue?@action=redirect&bpo=35081),
work initiated by Eric Snow in Python 3\.7\.)
* Some macros have been converted to static inline functions: parameter types
and return type are well defined, they don’t have issues specific to macros,
variables have a local scopes. Examples:

	+ [`Py_INCREF()`](../c-api/refcounting.html#c.Py_INCREF "Py_INCREF"), [`Py_DECREF()`](../c-api/refcounting.html#c.Py_DECREF "Py_DECREF")
	+ [`Py_XINCREF()`](../c-api/refcounting.html#c.Py_XINCREF "Py_XINCREF"), [`Py_XDECREF()`](../c-api/refcounting.html#c.Py_XDECREF "Py_XDECREF")
	+ `PyObject_INIT()`, `PyObject_INIT_VAR()`
	+ Private functions: `_PyObject_GC_TRACK()`,
	`_PyObject_GC_UNTRACK()`, `_Py_Dealloc()`(Contributed by Victor Stinner in [bpo\-35059](https://bugs.python.org/issue?@action=redirect&bpo=35059).)
* The `PyByteArray_Init()` and `PyByteArray_Fini()` functions have
been removed. They did nothing since Python 2\.7\.4 and Python 3\.2\.0, were
excluded from the limited API (stable ABI), and were not documented.
(Contributed by Victor Stinner in [bpo\-35713](https://bugs.python.org/issue?@action=redirect&bpo=35713).)
* The result of `PyExceptionClass_Name()` is now of type
`const char *` rather of `char *`.
(Contributed by Serhiy Storchaka in [bpo\-33818](https://bugs.python.org/issue?@action=redirect&bpo=33818).)
* The duality of `Modules/Setup.dist` and `Modules/Setup` has been
removed. Previously, when updating the CPython source tree, one had
to manually copy `Modules/Setup.dist` (inside the source tree) to
`Modules/Setup` (inside the build tree) in order to reflect any changes
upstream. This was of a small benefit to packagers at the expense of
a frequent annoyance to developers following CPython development, as
forgetting to copy the file could produce build failures.

Now the build system always reads from `Modules/Setup` inside the source
tree. People who want to customize that file are encouraged to maintain
their changes in a git fork of CPython or as patch files, as they would do
for any other change to the source tree.

(Contributed by Antoine Pitrou in [bpo\-32430](https://bugs.python.org/issue?@action=redirect&bpo=32430).)
* Functions that convert Python number to C integer like
[`PyLong_AsLong()`](../c-api/long.html#c.PyLong_AsLong "PyLong_AsLong") and argument parsing functions like
[`PyArg_ParseTuple()`](../c-api/arg.html#c.PyArg_ParseTuple "PyArg_ParseTuple") with integer converting format units like `'i'`
will now use the [`__index__()`](../reference/datamodel.html#object.__index__ "object.__index__") special method instead of
[`__int__()`](../reference/datamodel.html#object.__int__ "object.__int__"), if available. The deprecation warning will be
emitted for objects with the `__int__()` method but without the
`__index__()` method (like [`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal") and
[`Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction")). [`PyNumber_Check()`](../c-api/number.html#c.PyNumber_Check "PyNumber_Check") will now return
`1` for objects implementing `__index__()`.
[`PyNumber_Long()`](../c-api/number.html#c.PyNumber_Long "PyNumber_Long"), [`PyNumber_Float()`](../c-api/number.html#c.PyNumber_Float "PyNumber_Float") and
[`PyFloat_AsDouble()`](../c-api/float.html#c.PyFloat_AsDouble "PyFloat_AsDouble") also now use the `__index__()` method if
available.
(Contributed by Serhiy Storchaka in [bpo\-36048](https://bugs.python.org/issue?@action=redirect&bpo=36048) and [bpo\-20092](https://bugs.python.org/issue?@action=redirect&bpo=20092).)
* Heap\-allocated type objects will now increase their reference count
in [`PyObject_Init()`](../c-api/allocation.html#c.PyObject_Init "PyObject_Init") (and its parallel macro `PyObject_INIT`)
instead of in [`PyType_GenericAlloc()`](../c-api/type.html#c.PyType_GenericAlloc "PyType_GenericAlloc"). Types that modify instance
allocation or deallocation may need to be adjusted.
(Contributed by Eddie Elizondo in [bpo\-35810](https://bugs.python.org/issue?@action=redirect&bpo=35810).)
* The new function `PyCode_NewWithPosOnlyArgs()` allows to create
code objects like `PyCode_New()`, but with an extra *posonlyargcount*
parameter for indicating the number of positional\-only arguments.
(Contributed by Pablo Galindo in [bpo\-37221](https://bugs.python.org/issue?@action=redirect&bpo=37221).)
* `Py_SetPath()` now sets [`sys.executable`](../library/sys.html#sys.executable "sys.executable") to the program full
path ([`Py_GetProgramFullPath()`](../c-api/init.html#c.Py_GetProgramFullPath "Py_GetProgramFullPath")) rather than to the program name
([`Py_GetProgramName()`](../c-api/init.html#c.Py_GetProgramName "Py_GetProgramName")).
(Contributed by Victor Stinner in [bpo\-38234](https://bugs.python.org/issue?@action=redirect&bpo=38234).)

## Deprecated[¶](#deprecated "Link to this heading")

* The distutils `bdist_wininst` command is now deprecated, use
`bdist_wheel` (wheel packages) instead.
(Contributed by Victor Stinner in [bpo\-37481](https://bugs.python.org/issue?@action=redirect&bpo=37481).)
* Deprecated methods `getchildren()` and `getiterator()` in
the [`ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") module now emit a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") instead of [`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning").
They will be removed in Python 3\.9\.
(Contributed by Serhiy Storchaka in [bpo\-29209](https://bugs.python.org/issue?@action=redirect&bpo=29209).)
* Passing an object that is not an instance of
[`concurrent.futures.ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor") to
[`loop.set_default_executor()`](../library/asyncio-eventloop.html#asyncio.loop.set_default_executor "asyncio.loop.set_default_executor") is
deprecated and will be prohibited in Python 3\.9\.
(Contributed by Elvis Pranskevichus in [bpo\-34075](https://bugs.python.org/issue?@action=redirect&bpo=34075).)
* The [`__getitem__()`](../reference/datamodel.html#object.__getitem__ "object.__getitem__") methods of [`xml.dom.pulldom.DOMEventStream`](../library/xml.dom.pulldom.html#xml.dom.pulldom.DOMEventStream "xml.dom.pulldom.DOMEventStream"),
[`wsgiref.util.FileWrapper`](../library/wsgiref.html#wsgiref.util.FileWrapper "wsgiref.util.FileWrapper") and [`fileinput.FileInput`](../library/fileinput.html#fileinput.FileInput "fileinput.FileInput") have been
deprecated.

Implementations of these methods have been ignoring their *index* parameter,
and returning the next item instead.
(Contributed by Berker Peksag in [bpo\-9372](https://bugs.python.org/issue?@action=redirect&bpo=9372).)
* The [`typing.NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") class has deprecated the `_field_types`
attribute in favor of the `__annotations__` attribute which has the same
information. (Contributed by Raymond Hettinger in [bpo\-36320](https://bugs.python.org/issue?@action=redirect&bpo=36320).)
* [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") classes `Num`, `Str`, `Bytes`, `NameConstant` and
`Ellipsis` are considered deprecated and will be removed in future Python
versions. [`Constant`](../library/ast.html#ast.Constant "ast.Constant") should be used instead.
(Contributed by Serhiy Storchaka in [bpo\-32892](https://bugs.python.org/issue?@action=redirect&bpo=32892).)
* [`ast.NodeVisitor`](../library/ast.html#ast.NodeVisitor "ast.NodeVisitor") methods `visit_Num()`, `visit_Str()`,
`visit_Bytes()`, `visit_NameConstant()` and `visit_Ellipsis()` are
deprecated now and will not be called in future Python versions.
Add the [`visit_Constant()`](../library/ast.html#ast.NodeVisitor.visit_Constant "ast.NodeVisitor.visit_Constant") method to handle all
constant nodes.
(Contributed by Serhiy Storchaka in [bpo\-36917](https://bugs.python.org/issue?@action=redirect&bpo=36917).)
* The `asyncio.coroutine()` [decorator](../glossary.html#term-decorator) is deprecated and will be
removed in version 3\.10\. Instead of `@asyncio.coroutine`, use
[`async def`](../reference/compound_stmts.html#async-def) instead.
(Contributed by Andrew Svetlov in [bpo\-36921](https://bugs.python.org/issue?@action=redirect&bpo=36921).)
* In [`asyncio`](../library/asyncio.html#module-asyncio "asyncio: Asynchronous I/O."), the explicit passing of a *loop* argument has been
deprecated and will be removed in version 3\.10 for the following:
[`asyncio.sleep()`](../library/asyncio-task.html#asyncio.sleep "asyncio.sleep"), [`asyncio.gather()`](../library/asyncio-task.html#asyncio.gather "asyncio.gather"), [`asyncio.shield()`](../library/asyncio-task.html#asyncio.shield "asyncio.shield"),
[`asyncio.wait_for()`](../library/asyncio-task.html#asyncio.wait_for "asyncio.wait_for"), [`asyncio.wait()`](../library/asyncio-task.html#asyncio.wait "asyncio.wait"), [`asyncio.as_completed()`](../library/asyncio-task.html#asyncio.as_completed "asyncio.as_completed"),
[`asyncio.Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task"), [`asyncio.Lock`](../library/asyncio-sync.html#asyncio.Lock "asyncio.Lock"), [`asyncio.Event`](../library/asyncio-sync.html#asyncio.Event "asyncio.Event"),
[`asyncio.Condition`](../library/asyncio-sync.html#asyncio.Condition "asyncio.Condition"), [`asyncio.Semaphore`](../library/asyncio-sync.html#asyncio.Semaphore "asyncio.Semaphore"),
[`asyncio.BoundedSemaphore`](../library/asyncio-sync.html#asyncio.BoundedSemaphore "asyncio.BoundedSemaphore"), [`asyncio.Queue`](../library/asyncio-queue.html#asyncio.Queue "asyncio.Queue"),
[`asyncio.create_subprocess_exec()`](../library/asyncio-subprocess.html#asyncio.create_subprocess_exec "asyncio.create_subprocess_exec"), and
[`asyncio.create_subprocess_shell()`](../library/asyncio-subprocess.html#asyncio.create_subprocess_shell "asyncio.create_subprocess_shell").
* The explicit passing of coroutine objects to [`asyncio.wait()`](../library/asyncio-task.html#asyncio.wait "asyncio.wait") has been
deprecated and will be removed in version 3\.11\.
(Contributed by Yury Selivanov in [bpo\-34790](https://bugs.python.org/issue?@action=redirect&bpo=34790).)
* The following functions and methods are deprecated in the [`gettext`](../library/gettext.html#module-gettext "gettext: Multilingual internationalization services.")
module: `lgettext()`, `ldgettext()`,
`lngettext()` and `ldngettext()`.
They return encoded bytes, and it’s possible that you will get unexpected
Unicode\-related exceptions if there are encoding problems with the
translated strings. It’s much better to use alternatives which return
Unicode strings in Python 3\. These functions have been broken for a long time.

Function `bind_textdomain_codeset()`, methods
`output_charset()` and
`set_output_charset()`, and the *codeset*
parameter of functions [`translation()`](../library/gettext.html#gettext.translation "gettext.translation") and
[`install()`](../library/gettext.html#gettext.install "gettext.install") are also deprecated, since they are only used for
the `l*gettext()` functions.
(Contributed by Serhiy Storchaka in [bpo\-33710](https://bugs.python.org/issue?@action=redirect&bpo=33710).)
* The `isAlive()` method of [`threading.Thread`](../library/threading.html#threading.Thread "threading.Thread")
has been deprecated.
(Contributed by Donghee Na in [bpo\-35283](https://bugs.python.org/issue?@action=redirect&bpo=35283).)
* Many builtin and extension functions that take integer arguments will
now emit a deprecation warning for [`Decimal`](../library/decimal.html#decimal.Decimal "decimal.Decimal")s,
[`Fraction`](../library/fractions.html#fractions.Fraction "fractions.Fraction")s and any other objects that can be converted
to integers only with a loss (e.g. that have the [`__int__()`](../reference/datamodel.html#object.__int__ "object.__int__")
method but do not have the [`__index__()`](../reference/datamodel.html#object.__index__ "object.__index__") method). In future
version they will be errors.
(Contributed by Serhiy Storchaka in [bpo\-36048](https://bugs.python.org/issue?@action=redirect&bpo=36048).)
* Deprecated passing the following arguments as keyword arguments:

	+ *func* in [`functools.partialmethod()`](../library/functools.html#functools.partialmethod "functools.partialmethod"), [`weakref.finalize()`](../library/weakref.html#weakref.finalize "weakref.finalize"),
	[`profile.Profile.runcall()`](../library/profile.html#profile.Profile.runcall "profile.Profile.runcall"), `cProfile.Profile.runcall()`,
	[`bdb.Bdb.runcall()`](../library/bdb.html#bdb.Bdb.runcall "bdb.Bdb.runcall"), [`trace.Trace.runfunc()`](../library/trace.html#trace.Trace.runfunc "trace.Trace.runfunc") and
	[`curses.wrapper()`](../library/curses.html#curses.wrapper "curses.wrapper").
	+ *function* in [`unittest.TestCase.addCleanup()`](../library/unittest.html#unittest.TestCase.addCleanup "unittest.TestCase.addCleanup").
	+ *fn* in the [`submit()`](../library/concurrent.futures.html#concurrent.futures.Executor.submit "concurrent.futures.Executor.submit") method of
	[`concurrent.futures.ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor") and
	[`concurrent.futures.ProcessPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor "concurrent.futures.ProcessPoolExecutor").
	+ *callback* in [`contextlib.ExitStack.callback()`](../library/contextlib.html#contextlib.ExitStack.callback "contextlib.ExitStack.callback"),
	`contextlib.AsyncExitStack.callback()` and
	[`contextlib.AsyncExitStack.push_async_callback()`](../library/contextlib.html#contextlib.AsyncExitStack.push_async_callback "contextlib.AsyncExitStack.push_async_callback").
	+ *c* and *typeid* in the `create()`
	method of `multiprocessing.managers.Server` and
	`multiprocessing.managers.SharedMemoryServer`.
	+ *obj* in [`weakref.finalize()`](../library/weakref.html#weakref.finalize "weakref.finalize").In future releases of Python, they will be [positional\-only](../glossary.html#positional-only-parameter).
(Contributed by Serhiy Storchaka in [bpo\-36492](https://bugs.python.org/issue?@action=redirect&bpo=36492).)

## API and Feature Removals[¶](#api-and-feature-removals "Link to this heading")

The following features and APIs have been removed from Python 3\.8:

* Starting with Python 3\.3, importing ABCs from [`collections`](../library/collections.html#module-collections "collections: Container datatypes") was
deprecated, and importing should be done from [`collections.abc`](../library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers"). Being
able to import from collections was marked for removal in 3\.8, but has been
delayed to 3\.9\. (See [gh\-81134](https://github.com/python/cpython/issues/81134).)
* The `macpath` module, deprecated in Python 3\.7, has been removed.
(Contributed by Victor Stinner in [bpo\-35471](https://bugs.python.org/issue?@action=redirect&bpo=35471).)
* The function `platform.popen()` has been removed, after having been
deprecated since Python 3\.3: use [`os.popen()`](../library/os.html#os.popen "os.popen") instead.
(Contributed by Victor Stinner in [bpo\-35345](https://bugs.python.org/issue?@action=redirect&bpo=35345).)
* The function `time.clock()` has been removed, after having been
deprecated since Python 3\.3: use [`time.perf_counter()`](../library/time.html#time.perf_counter "time.perf_counter") or
[`time.process_time()`](../library/time.html#time.process_time "time.process_time") instead, depending
on your requirements, to have well\-defined behavior.
(Contributed by Matthias Bussonnier in [bpo\-36895](https://bugs.python.org/issue?@action=redirect&bpo=36895).)
* The `pyvenv` script has been removed in favor of `python3.8 -m venv`
to help eliminate confusion as to what Python interpreter the `pyvenv`
script is tied to. (Contributed by Brett Cannon in [bpo\-25427](https://bugs.python.org/issue?@action=redirect&bpo=25427).)
* `parse_qs`, `parse_qsl`, and `escape` are removed from the `cgi`
module. They are deprecated in Python 3\.2 or older. They should be imported
from the `urllib.parse` and `html` modules instead.
* `filemode` function is removed from the [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files.") module.
It is not documented and deprecated since Python 3\.3\.
* The [`XMLParser`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser "xml.etree.ElementTree.XMLParser") constructor no longer accepts
the *html* argument. It never had an effect and was deprecated in Python 3\.4\.
All other parameters are now [keyword\-only](../glossary.html#keyword-only-parameter).
(Contributed by Serhiy Storchaka in [bpo\-29209](https://bugs.python.org/issue?@action=redirect&bpo=29209).)
* Removed the `doctype()` method of [`XMLParser`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser "xml.etree.ElementTree.XMLParser").
(Contributed by Serhiy Storchaka in [bpo\-29209](https://bugs.python.org/issue?@action=redirect&bpo=29209).)
* “unicode\_internal” codec is removed.
(Contributed by Inada Naoki in [bpo\-36297](https://bugs.python.org/issue?@action=redirect&bpo=36297).)
* The `Cache` and `Statement` objects of the [`sqlite3`](../library/sqlite3.html#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") module are not
exposed to the user.
(Contributed by Aviv Palivoda in [bpo\-30262](https://bugs.python.org/issue?@action=redirect&bpo=30262).)
* The `bufsize` keyword argument of [`fileinput.input()`](../library/fileinput.html#fileinput.input "fileinput.input") and
[`fileinput.FileInput()`](../library/fileinput.html#fileinput.FileInput "fileinput.FileInput") which was ignored and deprecated since Python 3\.6
has been removed. [bpo\-36952](https://bugs.python.org/issue?@action=redirect&bpo=36952) (Contributed by Matthias Bussonnier.)
* The functions `sys.set_coroutine_wrapper()` and
`sys.get_coroutine_wrapper()` deprecated in Python 3\.7 have been removed;
[bpo\-36933](https://bugs.python.org/issue?@action=redirect&bpo=36933) (Contributed by Matthias Bussonnier.)

## Porting to Python 3\.8[¶](#porting-to-python-3-8 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in Python behavior[¶](#changes-in-python-behavior "Link to this heading")

* Yield expressions (both `yield` and `yield from` clauses) are now disallowed
in comprehensions and generator expressions (aside from the iterable expression
in the leftmost `for` clause).
(Contributed by Serhiy Storchaka in [bpo\-10544](https://bugs.python.org/issue?@action=redirect&bpo=10544).)
* The compiler now produces a [`SyntaxWarning`](../library/exceptions.html#SyntaxWarning "SyntaxWarning") when identity checks
(`is` and `is not`) are used with certain types of literals
(e.g. strings, numbers). These can often work by accident in CPython,
but are not guaranteed by the language spec. The warning advises users
to use equality tests (`==` and `!=`) instead.
(Contributed by Serhiy Storchaka in [bpo\-34850](https://bugs.python.org/issue?@action=redirect&bpo=34850).)
* The CPython interpreter can swallow exceptions in some circumstances.
In Python 3\.8 this happens in fewer cases. In particular, exceptions
raised when getting the attribute from the type dictionary are no longer
ignored. (Contributed by Serhiy Storchaka in [bpo\-35459](https://bugs.python.org/issue?@action=redirect&bpo=35459).)
* Removed `__str__` implementations from builtin types [`bool`](../library/functions.html#bool "bool"),
[`int`](../library/functions.html#int "int"), [`float`](../library/functions.html#float "float"), [`complex`](../library/functions.html#complex "complex") and few classes from
the standard library. They now inherit `__str__()` from [`object`](../library/functions.html#object "object").
As result, defining the `__repr__()` method in the subclass of these
classes will affect their string representation.
(Contributed by Serhiy Storchaka in [bpo\-36793](https://bugs.python.org/issue?@action=redirect&bpo=36793).)
* On AIX, [`sys.platform`](../library/sys.html#sys.platform "sys.platform") doesn’t contain the major version anymore.
It is always `'aix'`, instead of `'aix3'` .. `'aix7'`. Since
older Python versions include the version number, so it is recommended to
always use `sys.platform.startswith('aix')`.
(Contributed by M. Felt in [bpo\-36588](https://bugs.python.org/issue?@action=redirect&bpo=36588).)
* `PyEval_AcquireLock()` and `PyEval_AcquireThread()` now
terminate the current thread if called while the interpreter is
finalizing, making them consistent with [`PyEval_RestoreThread()`](../c-api/init.html#c.PyEval_RestoreThread "PyEval_RestoreThread"),
[`Py_END_ALLOW_THREADS()`](../c-api/init.html#c.Py_END_ALLOW_THREADS "Py_END_ALLOW_THREADS"), and [`PyGILState_Ensure()`](../c-api/init.html#c.PyGILState_Ensure "PyGILState_Ensure"). If this
behavior is not desired, guard the call by checking `_Py_IsFinalizing()`
or [`sys.is_finalizing()`](../library/sys.html#sys.is_finalizing "sys.is_finalizing").
(Contributed by Joannah Nanjekye in [bpo\-36475](https://bugs.python.org/issue?@action=redirect&bpo=36475).)

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* The [`os.getcwdb()`](../library/os.html#os.getcwdb "os.getcwdb") function now uses the UTF\-8 encoding on Windows,
rather than the ANSI code page: see [**PEP 529**](https://peps.python.org/pep-0529/) for the rationale. The
function is no longer deprecated on Windows.
(Contributed by Victor Stinner in [bpo\-37412](https://bugs.python.org/issue?@action=redirect&bpo=37412).)
* [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") can now use [`os.posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") in some cases
for better performance. On Windows Subsystem for Linux and QEMU User
Emulation, the `Popen` constructor using [`os.posix_spawn()`](../library/os.html#os.posix_spawn "os.posix_spawn") no longer raises an
exception on errors like “missing program”. Instead the child process fails with a
non\-zero `returncode`.
(Contributed by Joannah Nanjekye and Victor Stinner in [bpo\-35537](https://bugs.python.org/issue?@action=redirect&bpo=35537).)
* The *preexec\_fn* argument of \* [`subprocess.Popen`](../library/subprocess.html#subprocess.Popen "subprocess.Popen") is no longer
compatible with subinterpreters. The use of the parameter in a
subinterpreter now raises [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError").
(Contributed by Eric Snow in [bpo\-34651](https://bugs.python.org/issue?@action=redirect&bpo=34651), modified by Christian Heimes
in [bpo\-37951](https://bugs.python.org/issue?@action=redirect&bpo=37951).)
* The `imap.IMAP4.logout()` method no longer silently ignores arbitrary
exceptions.
(Contributed by Victor Stinner in [bpo\-36348](https://bugs.python.org/issue?@action=redirect&bpo=36348).)
* The function `platform.popen()` has been removed, after having been deprecated since
Python 3\.3: use [`os.popen()`](../library/os.html#os.popen "os.popen") instead.
(Contributed by Victor Stinner in [bpo\-35345](https://bugs.python.org/issue?@action=redirect&bpo=35345).)
* The [`statistics.mode()`](../library/statistics.html#statistics.mode "statistics.mode") function no longer raises an exception
when given multimodal data. Instead, it returns the first mode
encountered in the input data. (Contributed by Raymond Hettinger
in [bpo\-35892](https://bugs.python.org/issue?@action=redirect&bpo=35892).)
* The [`selection()`](../library/tkinter.ttk.html#tkinter.ttk.Treeview.selection "tkinter.ttk.Treeview.selection") method of the
[`tkinter.ttk.Treeview`](../library/tkinter.ttk.html#tkinter.ttk.Treeview "tkinter.ttk.Treeview") class no longer takes arguments. Using it with
arguments for changing the selection was deprecated in Python 3\.6\. Use
specialized methods like [`selection_set()`](../library/tkinter.ttk.html#tkinter.ttk.Treeview.selection_set "tkinter.ttk.Treeview.selection_set") for
changing the selection. (Contributed by Serhiy Storchaka in [bpo\-31508](https://bugs.python.org/issue?@action=redirect&bpo=31508).)
* The `writexml()`, `toxml()` and `toprettyxml()` methods of
[`xml.dom.minidom`](../library/xml.dom.minidom.html#module-xml.dom.minidom "xml.dom.minidom: Minimal Document Object Model (DOM) implementation."), and the `write()` method of `xml.etree`,
now preserve the attribute order specified by the user.
(Contributed by Diego Rojas and Raymond Hettinger in [bpo\-34160](https://bugs.python.org/issue?@action=redirect&bpo=34160).)
* A [`dbm.dumb`](../library/dbm.html#module-dbm.dumb "dbm.dumb: Portable implementation of the simple DBM interface.") database opened with flags `'r'` is now read\-only.
[`dbm.dumb.open()`](../library/dbm.html#dbm.dumb.open "dbm.dumb.open") with flags `'r'` and `'w'` no longer creates
a database if it does not exist.
(Contributed by Serhiy Storchaka in [bpo\-32749](https://bugs.python.org/issue?@action=redirect&bpo=32749).)
* The `doctype()` method defined in a subclass of
[`XMLParser`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.XMLParser "xml.etree.ElementTree.XMLParser") will no longer be called and will
emit a [`RuntimeWarning`](../library/exceptions.html#RuntimeWarning "RuntimeWarning") instead of a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
Define the [`doctype()`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.TreeBuilder.doctype "xml.etree.ElementTree.TreeBuilder.doctype")
method on a target for handling an XML doctype declaration.
(Contributed by Serhiy Storchaka in [bpo\-29209](https://bugs.python.org/issue?@action=redirect&bpo=29209).)
* A [`RuntimeError`](../library/exceptions.html#RuntimeError "RuntimeError") is now raised when the custom metaclass doesn’t
provide the `__classcell__` entry in the namespace passed to
`type.__new__`. A [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") was emitted in Python
3\.6–3\.7\. (Contributed by Serhiy Storchaka in [bpo\-23722](https://bugs.python.org/issue?@action=redirect&bpo=23722).)
* The `cProfile.Profile` class can now be used as a context
manager. (Contributed by Scott Sanderson in [bpo\-29235](https://bugs.python.org/issue?@action=redirect&bpo=29235).)
* [`shutil.copyfile()`](../library/shutil.html#shutil.copyfile "shutil.copyfile"), [`shutil.copy()`](../library/shutil.html#shutil.copy "shutil.copy"), [`shutil.copy2()`](../library/shutil.html#shutil.copy2 "shutil.copy2"),
[`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree") and [`shutil.move()`](../library/shutil.html#shutil.move "shutil.move") use platform\-specific
“fast\-copy” syscalls (see
[Platform\-dependent efficient copy operations](../library/shutil.html#shutil-platform-dependent-efficient-copy-operations) section).
* [`shutil.copyfile()`](../library/shutil.html#shutil.copyfile "shutil.copyfile") default buffer size on Windows was changed from
16 KiB to 1 MiB.
* The `PyGC_Head` struct has changed completely. All code that touched the
struct member should be rewritten. (See [bpo\-33597](https://bugs.python.org/issue?@action=redirect&bpo=33597).)
* The [`PyInterpreterState`](../c-api/init.html#c.PyInterpreterState "PyInterpreterState") struct has been moved into the “internal”
header files (specifically Include/internal/pycore\_pystate.h). An
opaque `PyInterpreterState` is still available as part of the public
API (and stable ABI). The docs indicate that none of the struct’s
fields are public, so we hope no one has been using them. However,
if you do rely on one or more of those private fields and have no
alternative then please open a BPO issue. We’ll work on helping
you adjust (possibly including adding accessor functions to the
public API). (See [bpo\-35886](https://bugs.python.org/issue?@action=redirect&bpo=35886).)
* The [`mmap.flush()`](../library/mmap.html#mmap.mmap.flush "mmap.mmap.flush") method now returns `None` on
success and raises an exception on error under all platforms. Previously,
its behavior was platform\-dependent: a nonzero value was returned on success;
zero was returned on error under Windows. A zero value was returned on
success; an exception was raised on error under Unix.
(Contributed by Berker Peksag in [bpo\-2122](https://bugs.python.org/issue?@action=redirect&bpo=2122).)
* [`xml.dom.minidom`](../library/xml.dom.minidom.html#module-xml.dom.minidom "xml.dom.minidom: Minimal Document Object Model (DOM) implementation.") and [`xml.sax`](../library/xml.sax.html#module-xml.sax "xml.sax: Package containing SAX2 base classes and convenience functions.") modules no longer process
external entities by default.
(Contributed by Christian Heimes in [bpo\-17239](https://bugs.python.org/issue?@action=redirect&bpo=17239).)
* Deleting a key from a read\-only [`dbm`](../library/dbm.html#module-dbm "dbm: Interfaces to various Unix \"database\" formats.") database ([`dbm.dumb`](../library/dbm.html#module-dbm.dumb "dbm.dumb: Portable implementation of the simple DBM interface."),
[`dbm.gnu`](../library/dbm.html#module-dbm.gnu "dbm.gnu: GNU database manager (Unix)") or [`dbm.ndbm`](../library/dbm.html#module-dbm.ndbm "dbm.ndbm: The New Database Manager (Unix)")) raises `error` ([`dbm.dumb.error`](../library/dbm.html#dbm.dumb.error "dbm.dumb.error"),
[`dbm.gnu.error`](../library/dbm.html#dbm.gnu.error "dbm.gnu.error") or [`dbm.ndbm.error`](../library/dbm.html#dbm.ndbm.error "dbm.ndbm.error")) instead of [`KeyError`](../library/exceptions.html#KeyError "KeyError").
(Contributed by Xiang Zhang in [bpo\-33106](https://bugs.python.org/issue?@action=redirect&bpo=33106).)
* Simplified AST for literals. All constants will be represented as
[`ast.Constant`](../library/ast.html#ast.Constant "ast.Constant") instances. Instantiating old classes `Num`,
`Str`, `Bytes`, `NameConstant` and `Ellipsis` will return
an instance of `Constant`.
(Contributed by Serhiy Storchaka in [bpo\-32892](https://bugs.python.org/issue?@action=redirect&bpo=32892).)
* [`expanduser()`](../library/os.path.html#os.path.expanduser "os.path.expanduser") on Windows now prefers the `USERPROFILE`
environment variable and does not use `HOME`, which is not normally
set for regular user accounts.
(Contributed by Anthony Sottile in [bpo\-36264](https://bugs.python.org/issue?@action=redirect&bpo=36264).)
* The exception [`asyncio.CancelledError`](../library/asyncio-exceptions.html#asyncio.CancelledError "asyncio.CancelledError") now inherits from
[`BaseException`](../library/exceptions.html#BaseException "BaseException") rather than [`Exception`](../library/exceptions.html#Exception "Exception") and no longer inherits
from [`concurrent.futures.CancelledError`](../library/concurrent.futures.html#concurrent.futures.CancelledError "concurrent.futures.CancelledError").
(Contributed by Yury Selivanov in [bpo\-32528](https://bugs.python.org/issue?@action=redirect&bpo=32528).)
* The function [`asyncio.wait_for()`](../library/asyncio-task.html#asyncio.wait_for "asyncio.wait_for") now correctly waits for cancellation
when using an instance of [`asyncio.Task`](../library/asyncio-task.html#asyncio.Task "asyncio.Task"). Previously, upon reaching
*timeout*, it was cancelled and immediately returned.
(Contributed by Elvis Pranskevichus in [bpo\-32751](https://bugs.python.org/issue?@action=redirect&bpo=32751).)
* The function [`asyncio.BaseTransport.get_extra_info()`](../library/asyncio-protocol.html#asyncio.BaseTransport.get_extra_info "asyncio.BaseTransport.get_extra_info") now returns a safe
to use socket object when ‘socket’ is passed to the *name* parameter.
(Contributed by Yury Selivanov in [bpo\-37027](https://bugs.python.org/issue?@action=redirect&bpo=37027).)
* [`asyncio.BufferedProtocol`](../library/asyncio-protocol.html#asyncio.BufferedProtocol "asyncio.BufferedProtocol") has graduated to the stable API.

* DLL dependencies for extension modules and DLLs loaded with [`ctypes`](../library/ctypes.html#module-ctypes "ctypes: A foreign function library for Python.") on
Windows are now resolved more securely. Only the system paths, the directory
containing the DLL or PYD file, and directories added with
[`add_dll_directory()`](../library/os.html#os.add_dll_directory "os.add_dll_directory") are searched for load\-time dependencies.
Specifically, `PATH` and the current working directory are no longer
used, and modifications to these will no longer have any effect on normal DLL
resolution. If your application relies on these mechanisms, you should check
for [`add_dll_directory()`](../library/os.html#os.add_dll_directory "os.add_dll_directory") and if it exists, use it to add your DLLs
directory while loading your library. Note that Windows 7 users will need to
ensure that Windows Update KB2533623 has been installed (this is also verified
by the installer).
(Contributed by Steve Dower in [bpo\-36085](https://bugs.python.org/issue?@action=redirect&bpo=36085).)
* The header files and functions related to pgen have been removed after its
replacement by a pure Python implementation. (Contributed by Pablo Galindo
in [bpo\-36623](https://bugs.python.org/issue?@action=redirect&bpo=36623).)
* [`types.CodeType`](../library/types.html#types.CodeType "types.CodeType") has a new parameter in the second position of the
constructor (*posonlyargcount*) to support positional\-only arguments defined
in [**PEP 570**](https://peps.python.org/pep-0570/). The first argument (*argcount*) now represents the total
number of positional arguments (including positional\-only arguments). The new
`replace()` method of [`types.CodeType`](../library/types.html#types.CodeType "types.CodeType") can be used to make the code
future\-proof.
* The parameter `digestmod` for [`hmac.new()`](../library/hmac.html#hmac.new "hmac.new") no longer uses the MD5 digest
by default.

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

* The [`PyCompilerFlags`](../c-api/veryhigh.html#c.PyCompilerFlags "PyCompilerFlags") structure got a new *cf\_feature\_version*
field. It should be initialized to `PY_MINOR_VERSION`. The field is ignored
by default, and is used if and only if `PyCF_ONLY_AST` flag is set in
*cf\_flags*.
(Contributed by Guido van Rossum in [bpo\-35766](https://bugs.python.org/issue?@action=redirect&bpo=35766).)
* The `PyEval_ReInitThreads()` function has been removed from the C API.
It should not be called explicitly: use [`PyOS_AfterFork_Child()`](../c-api/sys.html#c.PyOS_AfterFork_Child "PyOS_AfterFork_Child")
instead.
(Contributed by Victor Stinner in [bpo\-36728](https://bugs.python.org/issue?@action=redirect&bpo=36728).)
* On Unix, C extensions are no longer linked to libpython except on Android
and Cygwin. When Python is embedded, `libpython` must not be loaded with
`RTLD_LOCAL`, but `RTLD_GLOBAL` instead. Previously, using
`RTLD_LOCAL`, it was already not possible to load C extensions which
were not linked to `libpython`, like C extensions of the standard
library built by the `*shared*` section of `Modules/Setup`.
(Contributed by Victor Stinner in [bpo\-21536](https://bugs.python.org/issue?@action=redirect&bpo=21536).)
* Use of `#` variants of formats in parsing or building value (e.g.
[`PyArg_ParseTuple()`](../c-api/arg.html#c.PyArg_ParseTuple "PyArg_ParseTuple"), [`Py_BuildValue()`](../c-api/arg.html#c.Py_BuildValue "Py_BuildValue"), [`PyObject_CallFunction()`](../c-api/call.html#c.PyObject_CallFunction "PyObject_CallFunction"),
etc.) without `PY_SSIZE_T_CLEAN` defined raises `DeprecationWarning` now.
It will be removed in 3\.10 or 4\.0\. Read [Parsing arguments and building values](../c-api/arg.html#arg-parsing) for detail.
(Contributed by Inada Naoki in [bpo\-36381](https://bugs.python.org/issue?@action=redirect&bpo=36381).)
* Instances of heap\-allocated types (such as those created with
[`PyType_FromSpec()`](../c-api/type.html#c.PyType_FromSpec "PyType_FromSpec")) hold a reference to their type object.
Increasing the reference count of these type objects has been moved from
[`PyType_GenericAlloc()`](../c-api/type.html#c.PyType_GenericAlloc "PyType_GenericAlloc") to the more low\-level functions,
[`PyObject_Init()`](../c-api/allocation.html#c.PyObject_Init "PyObject_Init") and `PyObject_INIT()`.
This makes types created through [`PyType_FromSpec()`](../c-api/type.html#c.PyType_FromSpec "PyType_FromSpec") behave like
other classes in managed code.

[Statically allocated types](../c-api/typeobj.html#static-types) are not affected.

For the vast majority of cases, there should be no side effect.
However, types that manually increase the reference count after allocating
an instance (perhaps to work around the bug) may now become immortal.
To avoid this, these classes need to call Py\_DECREF on the type object
during instance deallocation.

To correctly port these types into 3\.8, please apply the following
changes:

	+ Remove [`Py_INCREF`](../c-api/refcounting.html#c.Py_INCREF "Py_INCREF") on the type object after allocating an
	instance \- if any.
	This may happen after calling [`PyObject_New`](../c-api/allocation.html#c.PyObject_New "PyObject_New"),
	[`PyObject_NewVar`](../c-api/allocation.html#c.PyObject_NewVar "PyObject_NewVar"), [`PyObject_GC_New()`](../c-api/gcsupport.html#c.PyObject_GC_New "PyObject_GC_New"),
	[`PyObject_GC_NewVar()`](../c-api/gcsupport.html#c.PyObject_GC_NewVar "PyObject_GC_NewVar"), or any other custom allocator that uses
	[`PyObject_Init()`](../c-api/allocation.html#c.PyObject_Init "PyObject_Init") or `PyObject_INIT()`.

	Example:

	\`\`\`
	static foo\_struct \*
	foo\_new(PyObject \*type) {
	 foo\_struct \*foo = PyObject\_GC\_New(foo\_struct, (PyTypeObject \*) type);
	 if (foo == NULL)
	 return NULL;
	\#if PY\_VERSION\_HEX \= 0x03080000
	 // This was not needed before Python 3\.8 (Python issue 35810\)
	 Py\_DECREF(type);
	\#endif
	}

	\`\`\`(Contributed by Eddie Elizondo in [bpo\-35810](https://bugs.python.org/issue?@action=redirect&bpo=35810).)
* The [`Py_DEPRECATED()`](../c-api/intro.html#c.Py_DEPRECATED "Py_DEPRECATED") macro has been implemented for MSVC.
The macro now must be placed before the symbol name.

Example:

\`\`\`
Py\_DEPRECATED(3\.8\) PyAPI\_FUNC(int) Py\_OldFunction(void);

\`\`\`

(Contributed by Zackery Spytz in [bpo\-33407](https://bugs.python.org/issue?@action=redirect&bpo=33407).)
* The interpreter does not pretend to support binary compatibility of
extension types across feature releases, anymore. A [`PyTypeObject`](../c-api/type.html#c.PyTypeObject "PyTypeObject")
exported by a third\-party extension module is supposed to have all the
slots expected in the current Python version, including
[`tp_finalize`](../c-api/typeobj.html#c.PyTypeObject.tp_finalize "PyTypeObject.tp_finalize") ([`Py_TPFLAGS_HAVE_FINALIZE`](../c-api/typeobj.html#c.Py_TPFLAGS_HAVE_FINALIZE "Py_TPFLAGS_HAVE_FINALIZE")
is not checked anymore before reading [`tp_finalize`](../c-api/typeobj.html#c.PyTypeObject.tp_finalize "PyTypeObject.tp_finalize")).

(Contributed by Antoine Pitrou in [bpo\-32388](https://bugs.python.org/issue?@action=redirect&bpo=32388).)
* The functions `PyNode_AddChild()` and `PyParser_AddToken()` now accept
two additional `int` arguments *end\_lineno* and *end\_col\_offset*.
* The `libpython38.a` file to allow MinGW tools to link directly against
`python38.dll` is no longer included in the regular Windows distribution.
If you require this file, it may be generated with the `gendef` and
`dlltool` tools, which are part of the MinGW binutils package:

\`\`\`
gendef \- python38\.dll \> tmp.def
dlltool \-\-dllname python38\.dll \-\-def tmp.def \-\-output\-lib libpython38\.a

\`\`\`

The location of an installed `pythonXY.dll` will depend on the
installation options and the version and language of Windows. See
[Using Python on Windows](../using/windows.html#using-on-windows) for more information. The resulting library should be
placed in the same directory as `pythonXY.lib`, which is generally the
`libs` directory under your Python installation.

(Contributed by Steve Dower in [bpo\-37351](https://bugs.python.org/issue?@action=redirect&bpo=37351).)

### CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

* The interpreter loop has been simplified by moving the logic of unrolling
the stack of blocks into the compiler. The compiler emits now explicit
instructions for adjusting the stack of values and calling the
cleaning\-up code for [`break`](../reference/simple_stmts.html#break), [`continue`](../reference/simple_stmts.html#continue) and
[`return`](../reference/simple_stmts.html#return).

Removed opcodes `BREAK_LOOP`, `CONTINUE_LOOP`,
`SETUP_LOOP` and `SETUP_EXCEPT`. Added new opcodes
`ROT_FOUR`, `BEGIN_FINALLY`, `CALL_FINALLY` and
`POP_FINALLY`. Changed the behavior of `END_FINALLY`
and `WITH_CLEANUP_START`.

(Contributed by Mark Shannon, Antoine Pitrou and Serhiy Storchaka in
[bpo\-17611](https://bugs.python.org/issue?@action=redirect&bpo=17611).)
* Added new opcode [`END_ASYNC_FOR`](../library/dis.html#opcode-END_ASYNC_FOR) for handling exceptions raised
when awaiting a next item in an [`async for`](../reference/compound_stmts.html#async-for) loop.
(Contributed by Serhiy Storchaka in [bpo\-33041](https://bugs.python.org/issue?@action=redirect&bpo=33041).)
* The [`MAP_ADD`](../library/dis.html#opcode-MAP_ADD) now expects the value as the first element in the
stack and the key as the second element. This change was made so the key
is always evaluated before the value in dictionary comprehensions, as
proposed by [**PEP 572**](https://peps.python.org/pep-0572/). (Contributed by Jörn Heissler in [bpo\-35224](https://bugs.python.org/issue?@action=redirect&bpo=35224).)

### Demos and Tools[¶](#demos-and-tools "Link to this heading")

Added a benchmark script for timing various ways to access variables:
`Tools/scripts/var_access_benchmark.py`.
(Contributed by Raymond Hettinger in [bpo\-35884](https://bugs.python.org/issue?@action=redirect&bpo=35884).)

Here’s a summary of performance improvements since Python 3\.3:

\`\`\`
Python version 3\.3 3\.4 3\.5 3\.6 3\.7 3\.8
\-\-\-\-\-\-\-\-\-\-\-\-\-\- \-\-\- \-\-\- \-\-\- \-\-\- \-\-\- \-\-\-

Variable and attribute read access:
 read\_local 4\.0 7\.1 7\.1 5\.4 5\.1 3\.9
 read\_nonlocal 5\.3 7\.1 8\.1 5\.8 5\.4 4\.4
 read\_global 13\.3 15\.5 19\.0 14\.3 13\.6 7\.6
 read\_builtin 20\.0 21\.1 21\.6 18\.5 19\.0 7\.5
 read\_classvar\_from\_class 20\.5 25\.6 26\.5 20\.7 19\.5 18\.4
 read\_classvar\_from\_instance 18\.5 22\.8 23\.5 18\.8 17\.1 16\.4
 read\_instancevar 26\.8 32\.4 33\.1 28\.0 26\.3 25\.4
 read\_instancevar\_slots 23\.7 27\.8 31\.3 20\.8 20\.8 20\.2
 read\_namedtuple 68\.5 73\.8 57\.5 45\.0 46\.8 18\.4
 read\_boundmethod 29\.8 37\.6 37\.9 29\.6 26\.9 27\.7

Variable and attribute write access:
 write\_local 4\.6 8\.7 9\.3 5\.5 5\.3 4\.3
 write\_nonlocal 7\.3 10\.5 11\.1 5\.6 5\.5 4\.7
 write\_global 15\.9 19\.7 21\.2 18\.0 18\.0 15\.8
 write\_classvar 81\.9 92\.9 96\.0 104\.6 102\.1 39\.2
 write\_instancevar 36\.4 44\.6 45\.8 40\.0 38\.9 35\.5
 write\_instancevar\_slots 28\.7 35\.6 36\.1 27\.3 26\.6 25\.7

Data structure read access:
 read\_list 19\.2 24\.2 24\.5 20\.8 20\.8 19\.0
 read\_deque 19\.9 24\.7 25\.5 20\.2 20\.6 19\.8
 read\_dict 19\.7 24\.3 25\.7 22\.3 23\.0 21\.0
 read\_strdict 17\.9 22\.6 24\.3 19\.5 21\.2 18\.9

Data structure write access:
 write\_list 21\.2 27\.1 28\.5 22\.5 21\.6 20\.0
 write\_deque 23\.8 28\.7 30\.1 22\.7 21\.8 23\.5
 write\_dict 25\.9 31\.4 33\.3 29\.3 29\.2 24\.7
 write\_strdict 22\.9 28\.4 29\.9 27\.5 25\.2 23\.1

Stack (or queue) operations:
 list\_append\_pop 144\.2 93\.4 112\.7 75\.4 74\.2 50\.8
 deque\_append\_pop 30\.4 43\.5 57\.0 49\.4 49\.2 42\.5
 deque\_append\_popleft 30\.8 43\.7 57\.3 49\.7 49\.7 42\.8

Timing loop:
 loop\_overhead 0\.3 0\.5 0\.6 0\.4 0\.3 0\.3

\`\`\`

The benchmarks were measured on an
[Intel® Core™ i7\-4960HQ processor](https://ark.intel.com/content/www/us/en/ark/products/76088/intel-core-i7-4960hq-processor-6m-cache-up-to-3-80-ghz.html)
running the macOS 64\-bit builds found at
[python.org](https://www.python.org/downloads/macos/).
The benchmark script displays timings in nanoseconds.

## Notable changes in Python 3\.8\.1[¶](#notable-changes-in-python-3-8-1 "Link to this heading")

Due to significant security concerns, the *reuse\_address* parameter of
[`asyncio.loop.create_datagram_endpoint()`](../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint") is no longer supported. This is
because of the behavior of the socket option `SO_REUSEADDR` in UDP. For more
details, see the documentation for `loop.create_datagram_endpoint()`.
(Contributed by Kyle Stanley, Antoine Pitrou, and Yury Selivanov in
[bpo\-37228](https://bugs.python.org/issue?@action=redirect&bpo=37228).)

## Notable changes in Python 3\.8\.2[¶](#notable-changes-in-python-3-8-2 "Link to this heading")

Fixed a regression with the `ignore` callback of [`shutil.copytree()`](../library/shutil.html#shutil.copytree "shutil.copytree").
The argument types are now str and List\[str] again.
(Contributed by Manuel Barkhau and Giampaolo Rodola in [gh\-83571](https://github.com/python/cpython/issues/83571).)

## Notable changes in Python 3\.8\.3[¶](#notable-changes-in-python-3-8-3 "Link to this heading")

The constant values of future flags in the [`__future__`](../library/__future__.html#module-__future__ "__future__: Future statement definitions") module
are updated in order to prevent collision with compiler flags. Previously
`PyCF_ALLOW_TOP_LEVEL_AWAIT` was clashing with `CO_FUTURE_DIVISION`.
(Contributed by Batuhan Taskaya in [gh\-83743](https://github.com/python/cpython/issues/83743))

## Notable changes in Python 3\.8\.8[¶](#notable-changes-in-python-3-8-8 "Link to this heading")

Earlier Python versions allowed using both `;` and `&` as
query parameter separators in [`urllib.parse.parse_qs()`](../library/urllib.parse.html#urllib.parse.parse_qs "urllib.parse.parse_qs") and
[`urllib.parse.parse_qsl()`](../library/urllib.parse.html#urllib.parse.parse_qsl "urllib.parse.parse_qsl"). Due to security concerns, and to conform with
newer W3C recommendations, this has been changed to allow only a single
separator key, with `&` as the default. This change also affects
`cgi.parse()` and `cgi.parse_multipart()` as they use the affected
functions internally. For more details, please see their respective
documentation.
(Contributed by Adam Goldschmidt, Senthil Kumaran and Ken Jin in [bpo\-42967](https://bugs.python.org/issue?@action=redirect&bpo=42967).)

## Notable changes in Python 3\.8\.9[¶](#notable-changes-in-python-3-8-9 "Link to this heading")

A security fix alters the [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") behavior to not trust the
IPv4 address sent from the remote server when setting up a passive data
channel. We reuse the ftp server IP address instead. For unusual code
requiring the old behavior, set a `trust_server_pasv_ipv4_address`
attribute on your FTP instance to `True`. (See [gh\-87451](https://github.com/python/cpython/issues/87451))

## Notable changes in Python 3\.8\.10[¶](#notable-changes-in-python-3-8-10 "Link to this heading")

### macOS 11\.0 (Big Sur) and Apple Silicon Mac support[¶](#macos-11-0-big-sur-and-apple-silicon-mac-support "Link to this heading")

As of 3\.8\.10, Python now supports building and running on macOS 11
(Big Sur) and on Apple Silicon Macs (based on the `ARM64` architecture).
A new universal build variant, `universal2`, is now available to natively
support both `ARM64` and `Intel 64` in one set of executables.
Note that support for “weaklinking”, building binaries targeted for newer
versions of macOS that will also run correctly on older versions by
testing at runtime for missing features, is not included in this backport
from Python 3\.9; to support a range of macOS versions, continue to target
for and build on the oldest version in the range.

(Originally contributed by Ronald Oussoren and Lawrence D’Anna in [gh\-85272](https://github.com/python/cpython/issues/85272),
with fixes by FX Coudert and Eli Rykoff, and backported to 3\.8 by Maxime Bélanger
and Ned Deily)

## Notable changes in Python 3\.8\.10[¶](#id1 "Link to this heading")

### urllib.parse[¶](#urllib-parse "Link to this heading")

The presence of newline or tab characters in parts of a URL allows for some
forms of attacks. Following the WHATWG specification that updates [**RFC 3986**](https://datatracker.ietf.org/doc/html/rfc3986.html),
ASCII newline `\n`, `\r` and tab `\t` characters are stripped from the
URL by the parser in [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") preventing such attacks. The removal
characters are controlled by a new module level variable
`urllib.parse._UNSAFE_URL_BYTES_TO_REMOVE`. (See [bpo\-43882](https://bugs.python.org/issue?@action=redirect&bpo=43882))

## Notable changes in Python 3\.8\.12[¶](#notable-changes-in-python-3-8-12 "Link to this heading")

### Changes in the Python API[¶](#id2 "Link to this heading")

Starting with Python 3\.8\.12 the [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") module no longer accepts
any leading zeros in IPv4 address strings. Leading zeros are ambiguous and
interpreted as octal notation by some libraries. For example the legacy
function [`socket.inet_aton()`](../library/socket.html#socket.inet_aton "socket.inet_aton") treats leading zeros as octal notation.
glibc implementation of modern [`inet_pton()`](../library/socket.html#socket.inet_pton "socket.inet_pton") does not accept
any leading zeros.

(Originally contributed by Christian Heimes in [bpo\-36384](https://bugs.python.org/issue?@action=redirect&bpo=36384), and backported
to 3\.8 by Achraf Merzouki.)

## Notable security feature in 3\.8\.14[¶](#notable-security-feature-in-3-8-14 "Link to this heading")

Converting between [`int`](../library/functions.html#int "int") and [`str`](../library/stdtypes.html#str "str") in bases other than 2
(binary), 4, 8 (octal), 16 (hexadecimal), or 32 such as base 10 (decimal)
now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the number of digits in string form is
above a limit to avoid potential denial of service attacks due to the
algorithmic complexity. This is a mitigation for [**CVE 2020\-10735**](https://www.cve.org/CVERecord?id=CVE-2020-10735).
This limit can be configured or disabled by environment variable, command
line flag, or [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") APIs. See the [integer string conversion
length limitation](../library/stdtypes.html#int-max-str-digits) documentation. The default limit
is 4300 digits in string form.

## Notable changes in 3\.8\.17[¶](#notable-changes-in-3-8-17 "Link to this heading")

### tarfile[¶](#id3 "Link to this heading")

* The extraction methods in [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), and [`shutil.unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"),
have a new a *filter* argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See [Extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
In Python 3\.12, use without the *filter* argument will show a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
In Python 3\.14, the default will switch to `'data'`.
(Contributed by Petr Viktorin in [**PEP 706**](https://peps.python.org/pep-0706/).)

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.8](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [New Features](#new-features)
		- [Assignment expressions](#assignment-expressions)
		- [Positional\-only parameters](#positional-only-parameters)
		- [Parallel filesystem cache for compiled bytecode files](#parallel-filesystem-cache-for-compiled-bytecode-files)
		- [Debug build uses the same ABI as release build](#debug-build-uses-the-same-abi-as-release-build)
		- [f\-strings support `=` for self\-documenting expressions and debugging](#f-strings-support-for-self-documenting-expressions-and-debugging)
		- [PEP 578: Python Runtime Audit Hooks](#pep-578-python-runtime-audit-hooks)
		- [PEP 587: Python Initialization Configuration](#pep-587-python-initialization-configuration)
		- [PEP 590: Vectorcall: a fast calling protocol for CPython](#pep-590-vectorcall-a-fast-calling-protocol-for-cpython)
		- [Pickle protocol 5 with out\-of\-band data buffers](#pickle-protocol-5-with-out-of-band-data-buffers)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
	+ [Improved Modules](#improved-modules)
		- [ast](#ast)
		- [asyncio](#asyncio)
		- [builtins](#builtins)
		- [collections](#collections)
		- [cProfile](#cprofile)
		- [csv](#csv)
		- [curses](#curses)
		- [ctypes](#ctypes)
		- [datetime](#datetime)
		- [functools](#functools)
		- [gc](#gc)
		- [gettext](#gettext)
		- [gzip](#gzip)
		- [IDLE and idlelib](#idle-and-idlelib)
		- [inspect](#inspect)
		- [io](#io)
		- [itertools](#itertools)
		- [json.tool](#json-tool)
		- [logging](#logging)
		- [math](#math)
		- [mmap](#mmap)
		- [multiprocessing](#multiprocessing)
		- [os](#os)
		- [os.path](#os-path)
		- [pathlib](#pathlib)
		- [pickle](#pickle)
		- [plistlib](#plistlib)
		- [pprint](#pprint)
		- [py\_compile](#py-compile)
		- [shlex](#shlex)
		- [shutil](#shutil)
		- [socket](#socket)
		- [ssl](#ssl)
		- [statistics](#statistics)
		- [sys](#sys)
		- [tarfile](#tarfile)
		- [threading](#threading)
		- [tokenize](#tokenize)
		- [tkinter](#tkinter)
		- [time](#time)
		- [typing](#typing)
		- [unicodedata](#unicodedata)
		- [unittest](#unittest)
		- [venv](#venv)
		- [weakref](#weakref)
		- [xml](#xml)
		- [xmlrpc](#xmlrpc)
	+ [Optimizations](#optimizations)
	+ [Build and C API Changes](#build-and-c-api-changes)
	+ [Deprecated](#deprecated)
	+ [API and Feature Removals](#api-and-feature-removals)
	+ [Porting to Python 3\.8](#porting-to-python-3-8)
		- [Changes in Python behavior](#changes-in-python-behavior)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
		- [CPython bytecode changes](#cpython-bytecode-changes)
		- [Demos and Tools](#demos-and-tools)
	+ [Notable changes in Python 3\.8\.1](#notable-changes-in-python-3-8-1)
	+ [Notable changes in Python 3\.8\.2](#notable-changes-in-python-3-8-2)
	+ [Notable changes in Python 3\.8\.3](#notable-changes-in-python-3-8-3)
	+ [Notable changes in Python 3\.8\.8](#notable-changes-in-python-3-8-8)
	+ [Notable changes in Python 3\.8\.9](#notable-changes-in-python-3-8-9)
	+ [Notable changes in Python 3\.8\.10](#notable-changes-in-python-3-8-10)
		- [macOS 11\.0 (Big Sur) and Apple Silicon Mac support](#macos-11-0-big-sur-and-apple-silicon-mac-support)
	+ [Notable changes in Python 3\.8\.10](#id1)
		- [urllib.parse](#urllib-parse)
	+ [Notable changes in Python 3\.8\.12](#notable-changes-in-python-3-8-12)
		- [Changes in the Python API](#id2)
	+ [Notable security feature in 3\.8\.14](#notable-security-feature-in-3-8-14)
	+ [Notable changes in 3\.8\.17](#notable-changes-in-3-8-17)
		- [tarfile](#id3)

#### Previous topic

[What’s New In Python 3\.9](3.9.html "previous chapter")

#### Next topic

[What’s New In Python 3\.7](3.7.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.8.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.7.html "What’s New In Python 3.7") \|
* [previous](3.9.html "What’s New In Python 3.9") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.8
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



## What’s New In Python 3.9 — Python 3.13.1 documentation

[Read the full article](https://docs.python.org/3/whatsnew/3.9.html)



### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.8.html "What’s New In Python 3.8") \|
* [previous](3.10.html "What’s New In Python 3.10") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.9
* \|
* Theme

Auto
Light
Dark

 \|

# What’s New In Python 3\.9[¶](#what-s-new-in-python-3-9 "Link to this heading")

Editor:
Łukasz Langa

This article explains the new features in Python 3\.9, compared to 3\.8\.
Python 3\.9 was released on October 5, 2020\.
For full details, see the [changelog](changelog.html#changelog).

See also

[**PEP 596**](https://peps.python.org/pep-0596/) \- Python 3\.9 Release Schedule

## Summary – Release highlights[¶](#summary-release-highlights "Link to this heading")

New syntax features:

* [**PEP 584**](https://peps.python.org/pep-0584/), union operators added to `dict`;
* [**PEP 585**](https://peps.python.org/pep-0585/), type hinting generics in standard collections;
* [**PEP 614**](https://peps.python.org/pep-0614/), relaxed grammar restrictions on decorators.

New built\-in features:

* [**PEP 616**](https://peps.python.org/pep-0616/), string methods to remove prefixes and suffixes.

New features in the standard library:

* [**PEP 593**](https://peps.python.org/pep-0593/), flexible function and variable annotations;
* [`os.pidfd_open()`](../library/os.html#os.pidfd_open "os.pidfd_open") added that allows process management without races
and signals.

Interpreter improvements:

* [**PEP 573**](https://peps.python.org/pep-0573/), fast access to module state from methods of C extension
types;
* [**PEP 617**](https://peps.python.org/pep-0617/), CPython now uses a new parser based on PEG;
* a number of Python builtins (range, tuple, set, frozenset, list, dict) are
now sped up using [**PEP 590**](https://peps.python.org/pep-0590/) vectorcall;
* garbage collection does not block on resurrected objects;
* a number of Python modules (`_abc`, `audioop`, `_bz2`,
`_codecs`, `_contextvars`, `_crypt`, `_functools`,
`_json`, `_locale`, [`math`](../library/math.html#module-math "math: Mathematical functions (sin() etc.)."), [`operator`](../library/operator.html#module-operator "operator: Functions corresponding to the standard operators."), [`resource`](../library/resource.html#module-resource "resource: An interface to provide resource usage information on the current process. (Unix)"),
[`time`](../library/time.html#module-time "time: Time access and conversions."), `_weakref`) now use multiphase initialization as defined
by PEP 489;
* a number of standard library modules (`audioop`, [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation."), [`grp`](../library/grp.html#module-grp "grp: The group database (getgrnam() and friends). (Unix)"),
`_hashlib`, [`pwd`](../library/pwd.html#module-pwd "pwd: The password database (getpwnam() and friends). (Unix)"), `_posixsubprocess`, [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions."),
[`select`](../library/select.html#module-select "select: Wait for I/O completion on multiple streams."), [`struct`](../library/struct.html#module-struct "struct: Interpret bytes as packed binary data."), [`termios`](../library/termios.html#module-termios "termios: POSIX style tty control. (Unix)"), [`zlib`](../library/zlib.html#module-zlib "zlib: Low-level interface to compression and decompression routines compatible with gzip.")) are now using
the stable ABI defined by PEP 384\.

New library modules:

* [**PEP 615**](https://peps.python.org/pep-0615/), the IANA Time Zone Database is now present in the standard
library in the [`zoneinfo`](../library/zoneinfo.html#module-zoneinfo "zoneinfo: IANA time zone support") module;
* an implementation of a topological sort of a graph is now provided in
the new [`graphlib`](../library/graphlib.html#module-graphlib "graphlib: Functionality to operate with graph-like structures") module.

Release process changes:

* [**PEP 602**](https://peps.python.org/pep-0602/), CPython adopts an annual release cycle.

## You should check for DeprecationWarning in your code[¶](#you-should-check-for-deprecationwarning-in-your-code "Link to this heading")

When Python 2\.7 was still supported, a lot of functionality in Python 3
was kept for backward compatibility with Python 2\.7\. With the end of Python
2 support, these backward compatibility layers have been removed, or will
be removed soon. Most of them emitted a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") warning for
several years. For example, using `collections.Mapping` instead of
`collections.abc.Mapping` emits a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") since Python
3\.3, released in 2012\.

Test your application with the [`-W`](../using/cmdline.html#cmdoption-W) `default` command\-line option to see
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") and [`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning"), or even with
[`-W`](../using/cmdline.html#cmdoption-W) `error` to treat them as errors. [Warnings Filter](../library/warnings.html#warning-filter) can be used to ignore warnings from third\-party code.

Python 3\.9 is the last version providing those Python 2 backward compatibility
layers, to give more time to Python projects maintainers to organize the
removal of the Python 2 support and add support for Python 3\.9\.

Aliases to [Abstract Base Classes](../library/collections.abc.html#collections-abstract-base-classes) in
the [`collections`](../library/collections.html#module-collections "collections: Container datatypes") module, like `collections.Mapping` alias to
[`collections.abc.Mapping`](../library/collections.abc.html#collections.abc.Mapping "collections.abc.Mapping"), are kept for one last release for backward
compatibility. They will be removed from Python 3\.10\.

More generally, try to run your tests in the [Python Development Mode](../library/devmode.html#devmode) which helps to prepare your code to make it compatible with the
next Python version.

Note: a number of pre\-existing deprecations were removed in this version of
Python as well. Consult the [Removed](#removed-in-python-39) section.

## New Features[¶](#new-features "Link to this heading")

### Dictionary Merge \& Update Operators[¶](#dictionary-merge-update-operators "Link to this heading")

Merge (`|`) and update (`|=`) operators have been added to the built\-in
[`dict`](../library/stdtypes.html#dict "dict") class. Those complement the existing `dict.update` and
`{**d1, **d2}` methods of merging dictionaries.

Example:

\`\`\`
\>\>\> x = {"key1": "value1 from x", "key2": "value2 from x"}
\>\>\> y = {"key2": "value2 from y", "key3": "value3 from y"}
\>\>\> x \| y
{'key1': 'value1 from x', 'key2': 'value2 from y', 'key3': 'value3 from y'}
\>\>\> y \| x
{'key2': 'value2 from x', 'key3': 'value3 from y', 'key1': 'value1 from x'}

\`\`\`

See [**PEP 584**](https://peps.python.org/pep-0584/) for a full description.
(Contributed by Brandt Bucher in [bpo\-36144](https://bugs.python.org/issue?@action=redirect&bpo=36144).)

### New String Methods to Remove Prefixes and Suffixes[¶](#new-string-methods-to-remove-prefixes-and-suffixes "Link to this heading")

[`str.removeprefix(prefix)`](../library/stdtypes.html#str.removeprefix "str.removeprefix") and
[`str.removesuffix(suffix)`](../library/stdtypes.html#str.removesuffix "str.removesuffix") have been added
to easily remove an unneeded prefix or a suffix from a string. Corresponding
`bytes`, `bytearray`, and `collections.UserString` methods have also been
added. See [**PEP 616**](https://peps.python.org/pep-0616/) for a full description. (Contributed by Dennis Sweeney in
[bpo\-39939](https://bugs.python.org/issue?@action=redirect&bpo=39939).)

### Type Hinting Generics in Standard Collections[¶](#type-hinting-generics-in-standard-collections "Link to this heading")

In type annotations you can now use built\-in collection types such as
`list` and `dict` as generic types instead of importing the
corresponding capitalized types (e.g. `List` or `Dict`) from
`typing`. Some other types in the standard library are also now generic,
for example `queue.Queue`.

Example:

\`\`\`
def greet\_all(names: list\[str]) \-\> None:
 for name in names:
 print("Hello", name)

\`\`\`

See [**PEP 585**](https://peps.python.org/pep-0585/) for more details. (Contributed by Guido van Rossum,
Ethan Smith, and Batuhan Taşkaya in [bpo\-39481](https://bugs.python.org/issue?@action=redirect&bpo=39481).)

### New Parser[¶](#new-parser "Link to this heading")

Python 3\.9 uses a new parser, based on [PEG](https://en.wikipedia.org/wiki/Parsing_expression_grammar) instead
of [LL(1\)](https://en.wikipedia.org/wiki/LL_parser). The new
parser’s performance is roughly comparable to that of the old parser,
but the PEG formalism is more flexible than LL(1\) when it comes to
designing new language features. We’ll start using this flexibility
in Python 3\.10 and later.

The [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") module uses the new parser and produces the same AST as
the old parser.

In Python 3\.10, the old parser will be deleted and so will all
functionality that depends on it (primarily the `parser` module,
which has long been deprecated). In Python 3\.9 *only*, you can switch
back to the LL(1\) parser using a command line switch (`-X
oldparser`) or an environment variable (`PYTHONOLDPARSER=1`).

See [**PEP 617**](https://peps.python.org/pep-0617/) for more details. (Contributed by Guido van Rossum,
Pablo Galindo and Lysandros Nikolaou in [bpo\-40334](https://bugs.python.org/issue?@action=redirect&bpo=40334).)

## Other Language Changes[¶](#other-language-changes "Link to this heading")

* [`__import__()`](../library/functions.html#import__ "__import__") now raises [`ImportError`](../library/exceptions.html#ImportError "ImportError") instead of
[`ValueError`](../library/exceptions.html#ValueError "ValueError"), which used to occur when a relative import went past
its top\-level package.
(Contributed by Ngalim Siregar in [bpo\-37444](https://bugs.python.org/issue?@action=redirect&bpo=37444).)
* Python now gets the absolute path of the script filename specified on
the command line (ex: `python3 script.py`): the `__file__` attribute of
the [`__main__`](../library/__main__.html#module-__main__ "__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``.") module became an absolute path, rather than a relative
path. These paths now remain valid after the current directory is changed
by [`os.chdir()`](../library/os.html#os.chdir "os.chdir"). As a side effect, the traceback also displays the
absolute path for [`__main__`](../library/__main__.html#module-__main__ "__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``.") module frames in this case.
(Contributed by Victor Stinner in [bpo\-20443](https://bugs.python.org/issue?@action=redirect&bpo=20443).)
* In the [Python Development Mode](../library/devmode.html#devmode) and in [debug build](../using/configure.html#debug-build), the
*encoding* and *errors* arguments are now checked for string encoding and
decoding operations. Examples: [`open()`](../library/functions.html#open "open"), [`str.encode()`](../library/stdtypes.html#str.encode "str.encode") and
[`bytes.decode()`](../library/stdtypes.html#bytes.decode "bytes.decode").

By default, for best performance, the *errors* argument is only checked at
the first encoding/decoding error and the *encoding* argument is sometimes
ignored for empty strings.
(Contributed by Victor Stinner in [bpo\-37388](https://bugs.python.org/issue?@action=redirect&bpo=37388).)
* `"".replace("", s, n)` now returns `s` instead of an empty string for
all non\-zero `n`. It is now consistent with `"".replace("", s)`.
There are similar changes for [`bytes`](../library/stdtypes.html#bytes "bytes") and [`bytearray`](../library/stdtypes.html#bytearray "bytearray") objects.
(Contributed by Serhiy Storchaka in [bpo\-28029](https://bugs.python.org/issue?@action=redirect&bpo=28029).)
* Any valid expression can now be used as a [decorator](../glossary.html#term-decorator). Previously, the
grammar was much more restrictive. See [**PEP 614**](https://peps.python.org/pep-0614/) for details.
(Contributed by Brandt Bucher in [bpo\-39702](https://bugs.python.org/issue?@action=redirect&bpo=39702).)
* Improved help for the [`typing`](../library/typing.html#module-typing "typing: Support for type hints (see :pep:`484`).") module. Docstrings are now shown for
all special forms and special generic aliases (like `Union` and `List`).
Using [`help()`](../library/functions.html#help "help") with generic alias like `List[int]` will show the help
for the correspondent concrete type (`list` in this case).
(Contributed by Serhiy Storchaka in [bpo\-40257](https://bugs.python.org/issue?@action=redirect&bpo=40257).)
* Parallel running of [`aclose()`](../reference/expressions.html#agen.aclose "agen.aclose") / [`asend()`](../reference/expressions.html#agen.asend "agen.asend") /
[`athrow()`](../reference/expressions.html#agen.athrow "agen.athrow") is now prohibited, and `ag_running` now reflects
the actual running status of the async generator.
(Contributed by Yury Selivanov in [bpo\-30773](https://bugs.python.org/issue?@action=redirect&bpo=30773).)
* Unexpected errors in calling the `__iter__` method are no longer masked by
`TypeError` in the [`in`](../reference/expressions.html#in) operator and functions
[`contains()`](../library/operator.html#operator.contains "operator.contains"), [`indexOf()`](../library/operator.html#operator.indexOf "operator.indexOf") and
[`countOf()`](../library/operator.html#operator.countOf "operator.countOf") of the [`operator`](../library/operator.html#module-operator "operator: Functions corresponding to the standard operators.") module.
(Contributed by Serhiy Storchaka in [bpo\-40824](https://bugs.python.org/issue?@action=redirect&bpo=40824).)
* Unparenthesized lambda expressions can no longer be the expression part in an
`if` clause in comprehensions and generator expressions. See [bpo\-41848](https://bugs.python.org/issue?@action=redirect&bpo=41848)
and [bpo\-43755](https://bugs.python.org/issue?@action=redirect&bpo=43755) for details.

## New Modules[¶](#new-modules "Link to this heading")

### zoneinfo[¶](#zoneinfo "Link to this heading")

The [`zoneinfo`](../library/zoneinfo.html#module-zoneinfo "zoneinfo: IANA time zone support") module brings support for the IANA time zone database to
the standard library. It adds [`zoneinfo.ZoneInfo`](../library/zoneinfo.html#zoneinfo.ZoneInfo "zoneinfo.ZoneInfo"), a concrete
[`datetime.tzinfo`](../library/datetime.html#datetime.tzinfo "datetime.tzinfo") implementation backed by the system’s time zone data.

Example:

\`\`\`
\>\>\> from zoneinfo import ZoneInfo
\>\>\> from datetime import datetime, timedelta

\>\>\> \# Daylight saving time
\>\>\> dt = datetime(2020, 10, 31, 12, tzinfo=ZoneInfo("America/Los\_Angeles"))
\>\>\> print(dt)
2020\-10\-31 12:00:00\-07:00
\>\>\> dt.tzname()
'PDT'

\>\>\> \# Standard time
\>\>\> dt \+= timedelta(days=7\)
\>\>\> print(dt)
2020\-11\-07 12:00:00\-08:00
\>\>\> print(dt.tzname())
PST

\`\`\`

As a fall\-back source of data for platforms that don’t ship the IANA database,
the [tzdata](https://pypi.org/project/tzdata/) module was released as a first\-party package – distributed via
PyPI and maintained by the CPython core team.

See also

[**PEP 615**](https://peps.python.org/pep-0615/) – Support for the IANA Time Zone Database in the Standard LibraryPEP written and implemented by Paul Ganssle

### graphlib[¶](#graphlib "Link to this heading")

A new module, [`graphlib`](../library/graphlib.html#module-graphlib "graphlib: Functionality to operate with graph-like structures"), was added that contains the
[`graphlib.TopologicalSorter`](../library/graphlib.html#graphlib.TopologicalSorter "graphlib.TopologicalSorter") class to offer functionality to perform
topological sorting of graphs. (Contributed by Pablo Galindo, Tim Peters and
Larry Hastings in [bpo\-17005](https://bugs.python.org/issue?@action=redirect&bpo=17005).)

## Improved Modules[¶](#improved-modules "Link to this heading")

### ast[¶](#ast "Link to this heading")

Added the *indent* option to [`dump()`](../library/ast.html#ast.dump "ast.dump") which allows it to produce a
multiline indented output.
(Contributed by Serhiy Storchaka in [bpo\-37995](https://bugs.python.org/issue?@action=redirect&bpo=37995).)

Added [`ast.unparse()`](../library/ast.html#ast.unparse "ast.unparse") as a function in the [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") module that can
be used to unparse an [`ast.AST`](../library/ast.html#ast.AST "ast.AST") object and produce a string with code
that would produce an equivalent [`ast.AST`](../library/ast.html#ast.AST "ast.AST") object when parsed.
(Contributed by Pablo Galindo and Batuhan Taskaya in [bpo\-38870](https://bugs.python.org/issue?@action=redirect&bpo=38870).)

Added docstrings to AST nodes that contains the ASDL signature used to
construct that node. (Contributed by Batuhan Taskaya in [bpo\-39638](https://bugs.python.org/issue?@action=redirect&bpo=39638).)

### asyncio[¶](#asyncio "Link to this heading")

Due to significant security concerns, the *reuse\_address* parameter of
[`asyncio.loop.create_datagram_endpoint()`](../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint") is no longer supported. This is
because of the behavior of the socket option `SO_REUSEADDR` in UDP. For more
details, see the documentation for `loop.create_datagram_endpoint()`.
(Contributed by Kyle Stanley, Antoine Pitrou, and Yury Selivanov in
[bpo\-37228](https://bugs.python.org/issue?@action=redirect&bpo=37228).)

Added a new [coroutine](../glossary.html#term-coroutine) [`shutdown_default_executor()`](../library/asyncio-eventloop.html#asyncio.loop.shutdown_default_executor "asyncio.loop.shutdown_default_executor")
that schedules a shutdown for the default executor that waits on the
[`ThreadPoolExecutor`](../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor") to finish closing. Also,
[`asyncio.run()`](../library/asyncio-runner.html#asyncio.run "asyncio.run") has been updated to use the new [coroutine](../glossary.html#term-coroutine).
(Contributed by Kyle Stanley in [bpo\-34037](https://bugs.python.org/issue?@action=redirect&bpo=34037).)

Added [`asyncio.PidfdChildWatcher`](../library/asyncio-policy.html#asyncio.PidfdChildWatcher "asyncio.PidfdChildWatcher"), a Linux\-specific child watcher
implementation that polls process file descriptors. ([bpo\-38692](https://bugs.python.org/issue?@action=redirect&bpo=38692))

Added a new [coroutine](../glossary.html#term-coroutine) [`asyncio.to_thread()`](../library/asyncio-task.html#asyncio.to_thread "asyncio.to_thread"). It is mainly used for
running IO\-bound functions in a separate thread to avoid blocking the event
loop, and essentially works as a high\-level version of
[`run_in_executor()`](../library/asyncio-eventloop.html#asyncio.loop.run_in_executor "asyncio.loop.run_in_executor") that can directly take keyword arguments.
(Contributed by Kyle Stanley and Yury Selivanov in [bpo\-32309](https://bugs.python.org/issue?@action=redirect&bpo=32309).)

When cancelling the task due to a timeout, [`asyncio.wait_for()`](../library/asyncio-task.html#asyncio.wait_for "asyncio.wait_for") will now
wait until the cancellation is complete also in the case when *timeout* is
\`).

Scoped IPv6 addresses can be parsed using [`ipaddress.IPv6Address`](../library/ipaddress.html#ipaddress.IPv6Address "ipaddress.IPv6Address").
If present, scope zone ID is available through the [`scope_id`](../library/ipaddress.html#ipaddress.IPv6Address.scope_id "ipaddress.IPv6Address.scope_id") attribute.
(Contributed by Oleksandr Pavliuk in [bpo\-34788](https://bugs.python.org/issue?@action=redirect&bpo=34788).)

Starting with Python 3\.9\.5 the [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") module no longer
accepts any leading zeros in IPv4 address strings.
(Contributed by Christian Heimes in [bpo\-36384](https://bugs.python.org/issue?@action=redirect&bpo=36384)).

### math[¶](#math "Link to this heading")

Expanded the [`math.gcd()`](../library/math.html#math.gcd "math.gcd") function to handle multiple arguments.
Formerly, it only supported two arguments.
(Contributed by Serhiy Storchaka in [bpo\-39648](https://bugs.python.org/issue?@action=redirect&bpo=39648).)

Added [`math.lcm()`](../library/math.html#math.lcm "math.lcm"): return the least common multiple of specified arguments.
(Contributed by Mark Dickinson, Ananthakrishnan and Serhiy Storchaka in
[bpo\-39479](https://bugs.python.org/issue?@action=redirect&bpo=39479) and [bpo\-39648](https://bugs.python.org/issue?@action=redirect&bpo=39648).)

Added [`math.nextafter()`](../library/math.html#math.nextafter "math.nextafter"): return the next floating\-point value after *x*
towards *y*.
(Contributed by Victor Stinner in [bpo\-39288](https://bugs.python.org/issue?@action=redirect&bpo=39288).)

Added [`math.ulp()`](../library/math.html#math.ulp "math.ulp"): return the value of the least significant bit
of a float.
(Contributed by Victor Stinner in [bpo\-39310](https://bugs.python.org/issue?@action=redirect&bpo=39310).)

### multiprocessing[¶](#multiprocessing "Link to this heading")

The [`multiprocessing.SimpleQueue`](../library/multiprocessing.html#multiprocessing.SimpleQueue "multiprocessing.SimpleQueue") class has a new
[`close()`](../library/multiprocessing.html#multiprocessing.SimpleQueue.close "multiprocessing.SimpleQueue.close") method to explicitly close the
queue.
(Contributed by Victor Stinner in [bpo\-30966](https://bugs.python.org/issue?@action=redirect&bpo=30966).)

### nntplib[¶](#nntplib "Link to this heading")

`NNTP` and `NNTP_SSL` now raise a [`ValueError`](../library/exceptions.html#ValueError "ValueError")
if the given timeout for their constructor is zero to prevent the creation of
a non\-blocking socket. (Contributed by Donghee Na in [bpo\-39259](https://bugs.python.org/issue?@action=redirect&bpo=39259).)

### os[¶](#os "Link to this heading")

Added [`CLD_KILLED`](../library/os.html#os.CLD_KILLED "os.CLD_KILLED") and [`CLD_STOPPED`](../library/os.html#os.CLD_STOPPED "os.CLD_STOPPED") for `si_code`.
(Contributed by Donghee Na in [bpo\-38493](https://bugs.python.org/issue?@action=redirect&bpo=38493).)

Exposed the Linux\-specific [`os.pidfd_open()`](../library/os.html#os.pidfd_open "os.pidfd_open") ([bpo\-38692](https://bugs.python.org/issue?@action=redirect&bpo=38692)) and
[`os.P_PIDFD`](../library/os.html#os.P_PIDFD "os.P_PIDFD") ([bpo\-38713](https://bugs.python.org/issue?@action=redirect&bpo=38713)) for process management with file
descriptors.

The [`os.unsetenv()`](../library/os.html#os.unsetenv "os.unsetenv") function is now also available on Windows.
(Contributed by Victor Stinner in [bpo\-39413](https://bugs.python.org/issue?@action=redirect&bpo=39413).)

The [`os.putenv()`](../library/os.html#os.putenv "os.putenv") and [`os.unsetenv()`](../library/os.html#os.unsetenv "os.unsetenv") functions are now always
available.
(Contributed by Victor Stinner in [bpo\-39395](https://bugs.python.org/issue?@action=redirect&bpo=39395).)

Added [`os.waitstatus_to_exitcode()`](../library/os.html#os.waitstatus_to_exitcode "os.waitstatus_to_exitcode") function:
convert a wait status to an exit code.
(Contributed by Victor Stinner in [bpo\-40094](https://bugs.python.org/issue?@action=redirect&bpo=40094).)

### pathlib[¶](#pathlib "Link to this heading")

Added [`pathlib.Path.readlink()`](../library/pathlib.html#pathlib.Path.readlink "pathlib.Path.readlink") which acts similarly to
[`os.readlink()`](../library/os.html#os.readlink "os.readlink").
(Contributed by Girts Folkmanis in [bpo\-30618](https://bugs.python.org/issue?@action=redirect&bpo=30618))

### pdb[¶](#pdb "Link to this heading")

On Windows now [`Pdb`](../library/pdb.html#pdb.Pdb "pdb.Pdb") supports `~/.pdbrc`.
(Contributed by Tim Hopper and Dan Lidral\-Porter in [bpo\-20523](https://bugs.python.org/issue?@action=redirect&bpo=20523).)

### poplib[¶](#poplib "Link to this heading")

[`POP3`](../library/poplib.html#poplib.POP3 "poplib.POP3") and [`POP3_SSL`](../library/poplib.html#poplib.POP3_SSL "poplib.POP3_SSL") now raise a [`ValueError`](../library/exceptions.html#ValueError "ValueError")
if the given timeout for their constructor is zero to prevent the creation of
a non\-blocking socket. (Contributed by Donghee Na in [bpo\-39259](https://bugs.python.org/issue?@action=redirect&bpo=39259).)

### pprint[¶](#pprint "Link to this heading")

[`pprint`](../library/pprint.html#module-pprint "pprint: Data pretty printer.") can now pretty\-print [`types.SimpleNamespace`](../library/types.html#types.SimpleNamespace "types.SimpleNamespace").
(Contributed by Carl Bordum Hansen in [bpo\-37376](https://bugs.python.org/issue?@action=redirect&bpo=37376).)

### pydoc[¶](#pydoc "Link to this heading")

The documentation string is now shown not only for class, function,
method etc, but for any object that has its own [`__doc__`](../library/stdtypes.html#definition.__doc__ "definition.__doc__")
attribute.
(Contributed by Serhiy Storchaka in [bpo\-40257](https://bugs.python.org/issue?@action=redirect&bpo=40257).)

### random[¶](#random "Link to this heading")

Added a new `random.Random.randbytes` method: generate random bytes.
(Contributed by Victor Stinner in [bpo\-40286](https://bugs.python.org/issue?@action=redirect&bpo=40286).)

### signal[¶](#signal "Link to this heading")

Exposed the Linux\-specific [`signal.pidfd_send_signal()`](../library/signal.html#signal.pidfd_send_signal "signal.pidfd_send_signal") for sending to
signals to a process using a file descriptor instead of a pid. ([bpo\-38712](https://bugs.python.org/issue?@action=redirect&bpo=38712))

### smtplib[¶](#smtplib "Link to this heading")

[`SMTP`](../library/smtplib.html#smtplib.SMTP "smtplib.SMTP") and [`SMTP_SSL`](../library/smtplib.html#smtplib.SMTP_SSL "smtplib.SMTP_SSL") now raise a [`ValueError`](../library/exceptions.html#ValueError "ValueError")
if the given timeout for their constructor is zero to prevent the creation of
a non\-blocking socket. (Contributed by Donghee Na in [bpo\-39259](https://bugs.python.org/issue?@action=redirect&bpo=39259).)

[`LMTP`](../library/smtplib.html#smtplib.LMTP "smtplib.LMTP") constructor now has an optional *timeout* parameter.
(Contributed by Donghee Na in [bpo\-39329](https://bugs.python.org/issue?@action=redirect&bpo=39329).)

### socket[¶](#socket "Link to this heading")

The [`socket`](../library/socket.html#module-socket "socket: Low-level networking interface.") module now exports the [`CAN_RAW_JOIN_FILTERS`](../library/socket.html#socket.CAN_RAW_JOIN_FILTERS "socket.CAN_RAW_JOIN_FILTERS")
constant on Linux 4\.1 and greater.
(Contributed by Stefan Tatschner and Zackery Spytz in [bpo\-25780](https://bugs.python.org/issue?@action=redirect&bpo=25780).)

The socket module now supports the [`CAN_J1939`](../library/socket.html#socket.CAN_J1939 "socket.CAN_J1939") protocol on
platforms that support it. (Contributed by Karl Ding in [bpo\-40291](https://bugs.python.org/issue?@action=redirect&bpo=40291).)

The socket module now has the [`socket.send_fds()`](../library/socket.html#socket.send_fds "socket.send_fds") and
[`socket.recv_fds()`](../library/socket.html#socket.recv_fds "socket.recv_fds") functions. (Contributed by Joannah Nanjekye, Shinya
Okano and Victor Stinner in [bpo\-28724](https://bugs.python.org/issue?@action=redirect&bpo=28724).)

### time[¶](#time "Link to this heading")

On AIX, [`thread_time()`](../library/time.html#time.thread_time "time.thread_time") is now implemented with `thread_cputime()`
which has nanosecond resolution, rather than
`clock_gettime(CLOCK_THREAD_CPUTIME_ID)` which has a resolution of 10 milliseconds.
(Contributed by Batuhan Taskaya in [bpo\-40192](https://bugs.python.org/issue?@action=redirect&bpo=40192))

### sys[¶](#sys "Link to this heading")

Added a new [`sys.platlibdir`](../library/sys.html#sys.platlibdir "sys.platlibdir") attribute: name of the platform\-specific
library directory. It is used to build the path of standard library and the
paths of installed extension modules. It is equal to `"lib"` on most
platforms. On Fedora and SuSE, it is equal to `"lib64"` on 64\-bit platforms.
(Contributed by Jan Matějek, Matěj Cepl, Charalampos Stratakis and Victor Stinner in [bpo\-1294959](https://bugs.python.org/issue?@action=redirect&bpo=1294959).)

Previously, [`sys.stderr`](../library/sys.html#sys.stderr "sys.stderr") was block\-buffered when non\-interactive. Now
`stderr` defaults to always being line\-buffered.
(Contributed by Jendrik Seipp in [bpo\-13601](https://bugs.python.org/issue?@action=redirect&bpo=13601).)

### tracemalloc[¶](#tracemalloc "Link to this heading")

Added [`tracemalloc.reset_peak()`](../library/tracemalloc.html#tracemalloc.reset_peak "tracemalloc.reset_peak") to set the peak size of traced memory
blocks to the current size, to measure the peak of specific pieces of code.
(Contributed by Huon Wilson in [bpo\-40630](https://bugs.python.org/issue?@action=redirect&bpo=40630).)

### typing[¶](#typing "Link to this heading")

[**PEP 593**](https://peps.python.org/pep-0593/) introduced an [`typing.Annotated`](../library/typing.html#typing.Annotated "typing.Annotated") type to decorate existing
types with context\-specific metadata and new `include_extras` parameter to
[`typing.get_type_hints()`](../library/typing.html#typing.get_type_hints "typing.get_type_hints") to access the metadata at runtime. (Contributed
by Till Varoquaux and Konstantin Kashin.)

### unicodedata[¶](#unicodedata "Link to this heading")

The Unicode database has been updated to version 13\.0\.0\. ([bpo\-39926](https://bugs.python.org/issue?@action=redirect&bpo=39926)).

### venv[¶](#venv "Link to this heading")

The activation scripts provided by [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") now all specify their prompt
customization consistently by always using the value specified by
`__VENV_PROMPT__`. Previously some scripts unconditionally used
`__VENV_PROMPT__`, others only if it happened to be set (which was the default
case), and one used `__VENV_NAME__` instead.
(Contributed by Brett Cannon in [bpo\-37663](https://bugs.python.org/issue?@action=redirect&bpo=37663).)

### xml[¶](#xml "Link to this heading")

White space characters within attributes are now preserved when serializing
[`xml.etree.ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") to XML file. EOLNs are no longer normalized
to “n”. This is the result of discussion about how to interpret
section 2\.11 of XML spec.
(Contributed by Mefistotelis in [bpo\-39011](https://bugs.python.org/issue?@action=redirect&bpo=39011).)

## Optimizations[¶](#optimizations "Link to this heading")

* Optimized the idiom for assignment a temporary variable in comprehensions.
Now `for y in [expr]` in comprehensions is as fast as a simple assignment
`y = expr`. For example:

> sums = \[s for s in \[0] for x in data for s in \[s \+ x]]

Unlike the `:=` operator this idiom does not leak a variable to the
outer scope.

(Contributed by Serhiy Storchaka in [bpo\-32856](https://bugs.python.org/issue?@action=redirect&bpo=32856).)
* Optimized signal handling in multithreaded applications. If a thread different
than the main thread gets a signal, the bytecode evaluation loop is no longer
interrupted at each bytecode instruction to check for pending signals which
cannot be handled. Only the main thread of the main interpreter can handle
signals.

Previously, the bytecode evaluation loop was interrupted at each instruction
until the main thread handles signals.
(Contributed by Victor Stinner in [bpo\-40010](https://bugs.python.org/issue?@action=redirect&bpo=40010).)
* Optimized the [`subprocess`](../library/subprocess.html#module-subprocess "subprocess: Subprocess management.") module on FreeBSD using `closefrom()`.
(Contributed by Ed Maste, Conrad Meyer, Kyle Evans, Kubilay Kocak and Victor
Stinner in [bpo\-38061](https://bugs.python.org/issue?@action=redirect&bpo=38061).)
* [`PyLong_FromDouble()`](../c-api/long.html#c.PyLong_FromDouble "PyLong_FromDouble") is now up to 1\.87x faster for values that
fit into long.
(Contributed by Sergey Fedoseev in [bpo\-37986](https://bugs.python.org/issue?@action=redirect&bpo=37986).)
* A number of Python builtins ([`range`](../library/stdtypes.html#range "range"), [`tuple`](../library/stdtypes.html#tuple "tuple"), [`set`](../library/stdtypes.html#set "set"),
[`frozenset`](../library/stdtypes.html#frozenset "frozenset"), [`list`](../library/stdtypes.html#list "list"), [`dict`](../library/stdtypes.html#dict "dict")) are now sped up by using
[**PEP 590**](https://peps.python.org/pep-0590/) vectorcall protocol.
(Contributed by Donghee Na, Mark Shannon, Jeroen Demeyer and Petr Viktorin in [bpo\-37207](https://bugs.python.org/issue?@action=redirect&bpo=37207).)
* Optimized `difference_update()` for the case when the other set
is much larger than the base set.
(Suggested by Evgeny Kapun with code contributed by Michele Orrù in [bpo\-8425](https://bugs.python.org/issue?@action=redirect&bpo=8425).)
* Python’s small object allocator (`obmalloc.c`) now allows (no more than)
one empty arena to remain available for immediate reuse, without returning
it to the OS. This prevents thrashing in simple loops where an arena could
be created and destroyed anew on each iteration.
(Contributed by Tim Peters in [bpo\-37257](https://bugs.python.org/issue?@action=redirect&bpo=37257).)
* [floor division](../glossary.html#term-floor-division) of float operation now has a better performance. Also
the message of [`ZeroDivisionError`](../library/exceptions.html#ZeroDivisionError "ZeroDivisionError") for this operation is updated.
(Contributed by Donghee Na in [bpo\-39434](https://bugs.python.org/issue?@action=redirect&bpo=39434).)
* Decoding short ASCII strings with UTF\-8 and ascii codecs is now about
15% faster. (Contributed by Inada Naoki in [bpo\-37348](https://bugs.python.org/issue?@action=redirect&bpo=37348).)

Here’s a summary of performance improvements from Python 3\.4 through Python 3\.9:

\`\`\`
Python version 3\.4 3\.5 3\.6 3\.7 3\.8 3\.9
\-\-\-\-\-\-\-\-\-\-\-\-\-\- \-\-\- \-\-\- \-\-\- \-\-\- \-\-\- \-\-\-

Variable and attribute read access:
 read\_local 7\.1 7\.1 5\.4 5\.1 3\.9 3\.9
 read\_nonlocal 7\.1 8\.1 5\.8 5\.4 4\.4 4\.5
 read\_global 15\.5 19\.0 14\.3 13\.6 7\.6 7\.8
 read\_builtin 21\.1 21\.6 18\.5 19\.0 7\.5 7\.8
 read\_classvar\_from\_class 25\.6 26\.5 20\.7 19\.5 18\.4 17\.9
 read\_classvar\_from\_instance 22\.8 23\.5 18\.8 17\.1 16\.4 16\.9
 read\_instancevar 32\.4 33\.1 28\.0 26\.3 25\.4 25\.3
 read\_instancevar\_slots 27\.8 31\.3 20\.8 20\.8 20\.2 20\.5
 read\_namedtuple 73\.8 57\.5 45\.0 46\.8 18\.4 18\.7
 read\_boundmethod 37\.6 37\.9 29\.6 26\.9 27\.7 41\.1

Variable and attribute write access:
 write\_local 8\.7 9\.3 5\.5 5\.3 4\.3 4\.3
 write\_nonlocal 10\.5 11\.1 5\.6 5\.5 4\.7 4\.8
 write\_global 19\.7 21\.2 18\.0 18\.0 15\.8 16\.7
 write\_classvar 92\.9 96\.0 104\.6 102\.1 39\.2 39\.8
 write\_instancevar 44\.6 45\.8 40\.0 38\.9 35\.5 37\.4
 write\_instancevar\_slots 35\.6 36\.1 27\.3 26\.6 25\.7 25\.8

Data structure read access:
 read\_list 24\.2 24\.5 20\.8 20\.8 19\.0 19\.5
 read\_deque 24\.7 25\.5 20\.2 20\.6 19\.8 20\.2
 read\_dict 24\.3 25\.7 22\.3 23\.0 21\.0 22\.4
 read\_strdict 22\.6 24\.3 19\.5 21\.2 18\.9 21\.5

Data structure write access:
 write\_list 27\.1 28\.5 22\.5 21\.6 20\.0 20\.0
 write\_deque 28\.7 30\.1 22\.7 21\.8 23\.5 21\.7
 write\_dict 31\.4 33\.3 29\.3 29\.2 24\.7 25\.4
 write\_strdict 28\.4 29\.9 27\.5 25\.2 23\.1 24\.5

Stack (or queue) operations:
 list\_append\_pop 93\.4 112\.7 75\.4 74\.2 50\.8 50\.6
 deque\_append\_pop 43\.5 57\.0 49\.4 49\.2 42\.5 44\.2
 deque\_append\_popleft 43\.7 57\.3 49\.7 49\.7 42\.8 46\.4

Timing loop:
 loop\_overhead 0\.5 0\.6 0\.4 0\.3 0\.3 0\.3

\`\`\`

These results were generated from the variable access benchmark script at:
`Tools/scripts/var_access_benchmark.py`. The benchmark script displays timings
in nanoseconds. The benchmarks were measured on an
[Intel® Core™ i7\-4960HQ processor](https://ark.intel.com/content/www/us/en/ark/products/76088/intel-core-i7-4960hq-processor-6m-cache-up-to-3-80-ghz.html)
running the macOS 64\-bit builds found at
[python.org](https://www.python.org/downloads/macos/).

## Deprecated[¶](#deprecated "Link to this heading")

* The distutils `bdist_msi` command is now deprecated, use
`bdist_wheel` (wheel packages) instead.
(Contributed by Hugo van Kemenade in [bpo\-39586](https://bugs.python.org/issue?@action=redirect&bpo=39586).)
* Currently [`math.factorial()`](../library/math.html#math.factorial "math.factorial") accepts [`float`](../library/functions.html#float "float") instances with
non\-negative integer values (like `5.0`). It raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError")
for non\-integral and negative floats. It is now deprecated. In future
Python versions it will raise a [`TypeError`](../library/exceptions.html#TypeError "TypeError") for all floats.
(Contributed by Serhiy Storchaka in [bpo\-37315](https://bugs.python.org/issue?@action=redirect&bpo=37315).)
* The `parser` and `symbol` modules are deprecated and will be
removed in future versions of Python. For the majority of use cases,
users can leverage the Abstract Syntax Tree (AST) generation and compilation
stage, using the [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") module.
* The Public C API functions `PyParser_SimpleParseStringFlags()`,
`PyParser_SimpleParseStringFlagsFilename()`,
`PyParser_SimpleParseFileFlags()` and `PyNode_Compile()`
are deprecated and will be removed in Python 3\.10 together with the old parser.
* Using [`NotImplemented`](../library/constants.html#NotImplemented "NotImplemented") in a boolean context has been deprecated,
as it is almost exclusively the result of incorrect rich comparator
implementations. It will be made a [`TypeError`](../library/exceptions.html#TypeError "TypeError") in a future version
of Python.
(Contributed by Josh Rosenberg in [bpo\-35712](https://bugs.python.org/issue?@action=redirect&bpo=35712).)
* The [`random`](../library/random.html#module-random "random: Generate pseudo-random numbers with various common distributions.") module currently accepts any hashable type as a
possible seed value. Unfortunately, some of those types are not
guaranteed to have a deterministic hash value. After Python 3\.9,
the module will restrict its seeds to [`None`](../library/constants.html#None "None"), [`int`](../library/functions.html#int "int"),
[`float`](../library/functions.html#float "float"), [`str`](../library/stdtypes.html#str "str"), [`bytes`](../library/stdtypes.html#bytes "bytes"), and [`bytearray`](../library/stdtypes.html#bytearray "bytearray").
* Opening the [`GzipFile`](../library/gzip.html#gzip.GzipFile "gzip.GzipFile") file for writing without specifying
the *mode* argument is deprecated. In future Python versions it will always
be opened for reading by default. Specify the *mode* argument for opening
it for writing and silencing a warning.
(Contributed by Serhiy Storchaka in [bpo\-28286](https://bugs.python.org/issue?@action=redirect&bpo=28286).)
* Deprecated the `split()` method of `_tkinter.TkappType` in
favour of the `splitlist()` method which has more consistent and
predictable behavior.
(Contributed by Serhiy Storchaka in [bpo\-38371](https://bugs.python.org/issue?@action=redirect&bpo=38371).)
* The explicit passing of coroutine objects to [`asyncio.wait()`](../library/asyncio-task.html#asyncio.wait "asyncio.wait") has been
deprecated and will be removed in version 3\.11\.
(Contributed by Yury Selivanov and Kyle Stanley in [bpo\-34790](https://bugs.python.org/issue?@action=redirect&bpo=34790).)
* binhex4 and hexbin4 standards are now deprecated. The `binhex` module
and the following [`binascii`](../library/binascii.html#module-binascii "binascii: Tools for converting between binary and various ASCII-encoded binary representations.") functions are now deprecated:

	+ `b2a_hqx()`, `a2b_hqx()`
	+ `rlecode_hqx()`, `rledecode_hqx()`(Contributed by Victor Stinner in [bpo\-39353](https://bugs.python.org/issue?@action=redirect&bpo=39353).)
* [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") classes `slice`, `Index` and `ExtSlice` are considered deprecated
and will be removed in future Python versions. `value` itself should be
used instead of `Index(value)`. `Tuple(slices, Load())` should be
used instead of `ExtSlice(slices)`.
(Contributed by Serhiy Storchaka in [bpo\-34822](https://bugs.python.org/issue?@action=redirect&bpo=34822).)
* [`ast`](../library/ast.html#module-ast "ast: Abstract Syntax Tree classes and manipulation.") classes `Suite`, `Param`, `AugLoad` and `AugStore`
are considered deprecated and will be removed in future Python versions.
They were not generated by the parser and not accepted by the code
generator in Python 3\.
(Contributed by Batuhan Taskaya in [bpo\-39639](https://bugs.python.org/issue?@action=redirect&bpo=39639) and [bpo\-39969](https://bugs.python.org/issue?@action=redirect&bpo=39969)
and Serhiy Storchaka in [bpo\-39988](https://bugs.python.org/issue?@action=redirect&bpo=39988).)
* The `PyEval_InitThreads()` and `PyEval_ThreadsInitialized()`
functions are now deprecated and will be removed in Python 3\.11\. Calling
`PyEval_InitThreads()` now does nothing. The [GIL](../glossary.html#term-GIL) is initialized
by [`Py_Initialize()`](../c-api/init.html#c.Py_Initialize "Py_Initialize") since Python 3\.7\.
(Contributed by Victor Stinner in [bpo\-39877](https://bugs.python.org/issue?@action=redirect&bpo=39877).)
* Passing `None` as the first argument to the [`shlex.split()`](../library/shlex.html#shlex.split "shlex.split") function
has been deprecated. (Contributed by Zackery Spytz in [bpo\-33262](https://bugs.python.org/issue?@action=redirect&bpo=33262).)
* `smtpd.MailmanProxy()` is now deprecated as it is unusable without
an external module, `mailman`. (Contributed by Samuel Colvin in [bpo\-35800](https://bugs.python.org/issue?@action=redirect&bpo=35800).)
* The `lib2to3` module now emits a [`PendingDeprecationWarning`](../library/exceptions.html#PendingDeprecationWarning "PendingDeprecationWarning").
Python 3\.9 switched to a PEG parser (see [**PEP 617**](https://peps.python.org/pep-0617/)), and Python 3\.10 may
include new language syntax that is not parsable by lib2to3’s LL(1\) parser.
The `lib2to3` module may be removed from the standard library in a future
Python version. Consider third\-party alternatives such as [LibCST](https://libcst.readthedocs.io/) or
[parso](https://parso.readthedocs.io/).
(Contributed by Carl Meyer in [bpo\-40360](https://bugs.python.org/issue?@action=redirect&bpo=40360).)
* The *random* parameter of [`random.shuffle()`](../library/random.html#random.shuffle "random.shuffle") has been deprecated.
(Contributed by Raymond Hettinger in [bpo\-40465](https://bugs.python.org/issue?@action=redirect&bpo=40465))

## Removed[¶](#removed "Link to this heading")

* The erroneous version at `unittest.mock.__version__` has been removed.
* `nntplib.NNTP`: `xpath()` and `xgtitle()` methods have been removed.
These methods are deprecated since Python 3\.3\. Generally, these extensions
are not supported or not enabled by NNTP server administrators.
For `xgtitle()`, please use `nntplib.NNTP.descriptions()` or
`nntplib.NNTP.description()` instead.
(Contributed by Donghee Na in [bpo\-39366](https://bugs.python.org/issue?@action=redirect&bpo=39366).)
* [`array.array`](../library/array.html#array.array "array.array"): `tostring()` and `fromstring()` methods have been
removed. They were aliases to `tobytes()` and `frombytes()`, deprecated
since Python 3\.2\.
(Contributed by Victor Stinner in [bpo\-38916](https://bugs.python.org/issue?@action=redirect&bpo=38916).)
* The undocumented `sys.callstats()` function has been removed. Since Python
3\.7, it was deprecated and always returned [`None`](../library/constants.html#None "None"). It required a special
build option `CALL_PROFILE` which was already removed in Python 3\.7\.
(Contributed by Victor Stinner in [bpo\-37414](https://bugs.python.org/issue?@action=redirect&bpo=37414).)
* The `sys.getcheckinterval()` and `sys.setcheckinterval()` functions have
been removed. They were deprecated since Python 3\.2\. Use
[`sys.getswitchinterval()`](../library/sys.html#sys.getswitchinterval "sys.getswitchinterval") and [`sys.setswitchinterval()`](../library/sys.html#sys.setswitchinterval "sys.setswitchinterval") instead.
(Contributed by Victor Stinner in [bpo\-37392](https://bugs.python.org/issue?@action=redirect&bpo=37392).)
* The C function `PyImport_Cleanup()` has been removed. It was documented as:
“Empty the module table. For internal use only.”
(Contributed by Victor Stinner in [bpo\-36710](https://bugs.python.org/issue?@action=redirect&bpo=36710).)
* `_dummy_thread` and `dummy_threading` modules have been removed. These
modules were deprecated since Python 3\.7 which requires threading support.
(Contributed by Victor Stinner in [bpo\-37312](https://bugs.python.org/issue?@action=redirect&bpo=37312).)
* `aifc.openfp()` alias to `aifc.open()`, `sunau.openfp()` alias to
`sunau.open()`, and `wave.openfp()` alias to [`wave.open()`](../library/wave.html#wave.open "wave.open") have been
removed. They were deprecated since Python 3\.7\.
(Contributed by Victor Stinner in [bpo\-37320](https://bugs.python.org/issue?@action=redirect&bpo=37320).)
* The `isAlive()` method of [`threading.Thread`](../library/threading.html#threading.Thread "threading.Thread")
has been removed. It was deprecated since Python 3\.8\.
Use [`is_alive()`](../library/threading.html#threading.Thread.is_alive "threading.Thread.is_alive") instead.
(Contributed by Donghee Na in [bpo\-37804](https://bugs.python.org/issue?@action=redirect&bpo=37804).)
* Methods `getchildren()` and `getiterator()` of classes
[`ElementTree`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.ElementTree "xml.etree.ElementTree.ElementTree") and
[`Element`](../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element "xml.etree.ElementTree.Element") in the [`ElementTree`](../library/xml.etree.elementtree.html#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.")
module have been removed. They were deprecated in Python 3\.2\.
Use `iter(x)` or `list(x)` instead of `x.getchildren()` and
`x.iter()` or `list(x.iter())` instead of `x.getiterator()`.
(Contributed by Serhiy Storchaka in [bpo\-36543](https://bugs.python.org/issue?@action=redirect&bpo=36543).)
* The old [`plistlib`](../library/plistlib.html#module-plistlib "plistlib: Generate and parse Apple plist files.") API has been removed, it was deprecated since Python
3\.4\. Use the [`load()`](../library/plistlib.html#plistlib.load "plistlib.load"), [`loads()`](../library/plistlib.html#plistlib.loads "plistlib.loads"), [`dump()`](../library/plistlib.html#plistlib.dump "plistlib.dump"), and
[`dumps()`](../library/plistlib.html#plistlib.dumps "plistlib.dumps") functions. Additionally, the *use\_builtin\_types* parameter was
removed, standard [`bytes`](../library/stdtypes.html#bytes "bytes") objects are always used instead.
(Contributed by Jon Janzen in [bpo\-36409](https://bugs.python.org/issue?@action=redirect&bpo=36409).)
* The C function `PyGen_NeedsFinalizing` has been removed. It was not
documented, tested, or used anywhere within CPython after the implementation
of [**PEP 442**](https://peps.python.org/pep-0442/). Patch by Joannah Nanjekye.
(Contributed by Joannah Nanjekye in [bpo\-15088](https://bugs.python.org/issue?@action=redirect&bpo=15088))
* `base64.encodestring()` and `base64.decodestring()`, aliases deprecated
since Python 3\.1, have been removed: use [`base64.encodebytes()`](../library/base64.html#base64.encodebytes "base64.encodebytes") and
[`base64.decodebytes()`](../library/base64.html#base64.decodebytes "base64.decodebytes") instead.
(Contributed by Victor Stinner in [bpo\-39351](https://bugs.python.org/issue?@action=redirect&bpo=39351).)
* `fractions.gcd()` function has been removed, it was deprecated since Python
3\.5 ([bpo\-22486](https://bugs.python.org/issue?@action=redirect&bpo=22486)): use [`math.gcd()`](../library/math.html#math.gcd "math.gcd") instead.
(Contributed by Victor Stinner in [bpo\-39350](https://bugs.python.org/issue?@action=redirect&bpo=39350).)
* The *buffering* parameter of [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") has been removed. Since
Python 3\.0, it was ignored and using it emitted a [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
Pass an open file object to control how the file is opened.
(Contributed by Victor Stinner in [bpo\-39357](https://bugs.python.org/issue?@action=redirect&bpo=39357).)
* The *encoding* parameter of [`json.loads()`](../library/json.html#json.loads "json.loads") has been removed.
As of Python 3\.1, it was deprecated and ignored; using it has emitted a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") since Python 3\.8\.
(Contributed by Inada Naoki in [bpo\-39377](https://bugs.python.org/issue?@action=redirect&bpo=39377))
* `with (await asyncio.lock):` and `with (yield from asyncio.lock):` statements are
not longer supported, use `async with lock` instead. The same is correct for
`asyncio.Condition` and `asyncio.Semaphore`.
(Contributed by Andrew Svetlov in [bpo\-34793](https://bugs.python.org/issue?@action=redirect&bpo=34793).)
* The `sys.getcounts()` function, the `-X showalloccount` command line
option and the `show_alloc_count` field of the C structure
[`PyConfig`](../c-api/init_config.html#c.PyConfig "PyConfig") have been removed. They required a special Python build by
defining `COUNT_ALLOCS` macro.
(Contributed by Victor Stinner in [bpo\-39489](https://bugs.python.org/issue?@action=redirect&bpo=39489).)
* The `_field_types` attribute of the [`typing.NamedTuple`](../library/typing.html#typing.NamedTuple "typing.NamedTuple") class
has been removed. It was deprecated since Python 3\.8\. Use
the `__annotations__` attribute instead.
(Contributed by Serhiy Storchaka in [bpo\-40182](https://bugs.python.org/issue?@action=redirect&bpo=40182).)
* The `symtable.SymbolTable.has_exec()` method has been removed. It was
deprecated since 2006, and only returning `False` when it’s called.
(Contributed by Batuhan Taskaya in [bpo\-40208](https://bugs.python.org/issue?@action=redirect&bpo=40208))
* The `asyncio.Task.current_task()` and `asyncio.Task.all_tasks()`
have been removed. They were deprecated since Python 3\.7 and you can use
[`asyncio.current_task()`](../library/asyncio-task.html#asyncio.current_task "asyncio.current_task") and [`asyncio.all_tasks()`](../library/asyncio-task.html#asyncio.all_tasks "asyncio.all_tasks") instead.
(Contributed by Rémi Lapeyre in [bpo\-40967](https://bugs.python.org/issue?@action=redirect&bpo=40967))
* The `unescape()` method in the [`html.parser.HTMLParser`](../library/html.parser.html#html.parser.HTMLParser "html.parser.HTMLParser") class
has been removed (it was deprecated since Python 3\.4\). [`html.unescape()`](../library/html.html#html.unescape "html.unescape")
should be used for converting character references to the corresponding
unicode characters.

## Porting to Python 3\.9[¶](#porting-to-python-3-9 "Link to this heading")

This section lists previously described changes and other bugfixes
that may require changes to your code.

### Changes in the Python API[¶](#changes-in-the-python-api "Link to this heading")

* [`__import__()`](../library/functions.html#import__ "__import__") and [`importlib.util.resolve_name()`](../library/importlib.html#importlib.util.resolve_name "importlib.util.resolve_name") now raise
[`ImportError`](../library/exceptions.html#ImportError "ImportError") where it previously raised [`ValueError`](../library/exceptions.html#ValueError "ValueError"). Callers
catching the specific exception type and supporting both Python 3\.9 and
earlier versions will need to catch both using `except (ImportError, ValueError):`.
* The [`venv`](../library/venv.html#module-venv "venv: Creation of virtual environments.") activation scripts no longer special\-case when
`__VENV_PROMPT__` is set to `""`.
* The [`select.epoll.unregister()`](../library/select.html#select.epoll.unregister "select.epoll.unregister") method no longer ignores the
[`EBADF`](../library/errno.html#errno.EBADF "errno.EBADF") error.
(Contributed by Victor Stinner in [bpo\-39239](https://bugs.python.org/issue?@action=redirect&bpo=39239).)
* The *compresslevel* parameter of [`bz2.BZ2File`](../library/bz2.html#bz2.BZ2File "bz2.BZ2File") became keyword\-only,
since the *buffering* parameter has been removed.
(Contributed by Victor Stinner in [bpo\-39357](https://bugs.python.org/issue?@action=redirect&bpo=39357).)
* Simplified AST for subscription. Simple indices will be represented by
their value, extended slices will be represented as tuples.
`Index(value)` will return a `value` itself, `ExtSlice(slices)`
will return `Tuple(slices, Load())`.
(Contributed by Serhiy Storchaka in [bpo\-34822](https://bugs.python.org/issue?@action=redirect&bpo=34822).)
* The [`importlib`](../library/importlib.html#module-importlib "importlib: The implementation of the import machinery.") module now ignores the [`PYTHONCASEOK`](../using/cmdline.html#envvar-PYTHONCASEOK)
environment variable when the [`-E`](../using/cmdline.html#cmdoption-E) or [`-I`](../using/cmdline.html#cmdoption-I) command line
options are being used.
* The *encoding* parameter has been added to the classes [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") and
[`ftplib.FTP_TLS`](../library/ftplib.html#ftplib.FTP_TLS "ftplib.FTP_TLS") as a keyword\-only parameter, and the default encoding
is changed from Latin\-1 to UTF\-8 to follow [**RFC 2640**](https://datatracker.ietf.org/doc/html/rfc2640.html).
* [`asyncio.loop.shutdown_default_executor()`](../library/asyncio-eventloop.html#asyncio.loop.shutdown_default_executor "asyncio.loop.shutdown_default_executor") has been added to
[`AbstractEventLoop`](../library/asyncio-eventloop.html#asyncio.AbstractEventLoop "asyncio.AbstractEventLoop"), meaning alternative event loops that
inherit from it should have this method defined.
(Contributed by Kyle Stanley in [bpo\-34037](https://bugs.python.org/issue?@action=redirect&bpo=34037).)
* The constant values of future flags in the [`__future__`](../library/__future__.html#module-__future__ "__future__: Future statement definitions") module
is updated in order to prevent collision with compiler flags. Previously
`PyCF_ALLOW_TOP_LEVEL_AWAIT` was clashing with `CO_FUTURE_DIVISION`.
(Contributed by Batuhan Taskaya in [bpo\-39562](https://bugs.python.org/issue?@action=redirect&bpo=39562))
* `array('u')` now uses `wchar_t` as C type instead of `Py_UNICODE`.
This change doesn’t affect to its behavior because `Py_UNICODE` is alias
of `wchar_t` since Python 3\.3\.
(Contributed by Inada Naoki in [bpo\-34538](https://bugs.python.org/issue?@action=redirect&bpo=34538).)
* The [`logging.getLogger()`](../library/logging.html#logging.getLogger "logging.getLogger") API now returns the root logger when passed
the name `'root'`, whereas previously it returned a non\-root logger named
`'root'`. This could affect cases where user code explicitly wants a
non\-root logger named `'root'`, or instantiates a logger using
`logging.getLogger(__name__)` in some top\-level module called `'root.py'`.
(Contributed by Vinay Sajip in [bpo\-37742](https://bugs.python.org/issue?@action=redirect&bpo=37742).)
* Division handling of [`PurePath`](../library/pathlib.html#pathlib.PurePath "pathlib.PurePath") now returns [`NotImplemented`](../library/constants.html#NotImplemented "NotImplemented")
instead of raising a [`TypeError`](../library/exceptions.html#TypeError "TypeError") when passed something other than an
instance of `str` or [`PurePath`](../library/pathlib.html#pathlib.PurePath "pathlib.PurePath"). This allows creating
compatible classes that don’t inherit from those mentioned types.
(Contributed by Roger Aiudi in [bpo\-34775](https://bugs.python.org/issue?@action=redirect&bpo=34775)).
* Starting with Python 3\.9\.5 the [`ipaddress`](../library/ipaddress.html#module-ipaddress "ipaddress: IPv4/IPv6 manipulation library.") module no longer
accepts any leading zeros in IPv4 address strings. Leading zeros are
ambiguous and interpreted as octal notation by some libraries. For example
the legacy function [`socket.inet_aton()`](../library/socket.html#socket.inet_aton "socket.inet_aton") treats leading zeros as octal
notatation. glibc implementation of modern [`inet_pton()`](../library/socket.html#socket.inet_pton "socket.inet_pton") does
not accept any leading zeros.
(Contributed by Christian Heimes in [bpo\-36384](https://bugs.python.org/issue?@action=redirect&bpo=36384)).
* [`codecs.lookup()`](../library/codecs.html#codecs.lookup "codecs.lookup") now normalizes the encoding name the same way as
`encodings.normalize_encoding()`, except that [`codecs.lookup()`](../library/codecs.html#codecs.lookup "codecs.lookup") also
converts the name to lower case. For example, `"latex+latin1"` encoding
name is now normalized to `"latex_latin1"`.
(Contributed by Jordon Xu in [bpo\-37751](https://bugs.python.org/issue?@action=redirect&bpo=37751).)

### Changes in the C API[¶](#changes-in-the-c-api "Link to this heading")

* Instances of [heap\-allocated types](../c-api/typeobj.html#heap-types) (such as those created with
[`PyType_FromSpec()`](../c-api/type.html#c.PyType_FromSpec "PyType_FromSpec") and similar APIs) hold a reference to their type
object since Python 3\.8\. As indicated in the “Changes in the C API” of Python
3\.8, for the vast majority of cases, there should be no side effect but for
types that have a custom [`tp_traverse`](../c-api/typeobj.html#c.PyTypeObject.tp_traverse "PyTypeObject.tp_traverse") function,
ensure that all custom `tp_traverse` functions of heap\-allocated types
visit the object’s type.

> Example:
> 
> 
> \`\`\`
> int
> foo\_traverse(foo\_struct \*self, visitproc visit, void \*arg) {
> // Rest of the traverse function
> \#if PY\_VERSION\_HEX \>= 0x03090000
>  // This was not needed before Python 3\.9 (Python issue 35810 and 40217\)
>  Py\_VISIT(Py\_TYPE(self));
> \#endif
> }
> 
> \`\`\`

If your traverse function delegates to `tp_traverse` of its base class
(or another type), ensure that `Py_TYPE(self)` is visited only once.
Note that only [heap type](../c-api/typeobj.html#heap-types) are expected to visit the type
in `tp_traverse`.

> For example, if your `tp_traverse` function includes:
> 
> 
> \`\`\`
> base\-\>tp\_traverse(self, visit, arg)
> 
> \`\`\`
> 
> then add:
> 
> 
> \`\`\`
> \#if PY\_VERSION\_HEX \>= 0x03090000
>  // This was not needed before Python 3\.9 (bpo\-35810 and bpo\-40217\)
>  if (base\-\>tp\_flags \& Py\_TPFLAGS\_HEAPTYPE) {
>  // a heap type's tp\_traverse already visited Py\_TYPE(self)
>  } else {
>  Py\_VISIT(Py\_TYPE(self));
>  }
> \#else
> 
> \`\`\`

(See [bpo\-35810](https://bugs.python.org/issue?@action=redirect&bpo=35810) and [bpo\-40217](https://bugs.python.org/issue?@action=redirect&bpo=40217) for more information.)
* The functions `PyEval_CallObject`, `PyEval_CallFunction`,
`PyEval_CallMethod` and `PyEval_CallObjectWithKeywords` are deprecated.
Use [`PyObject_Call()`](../c-api/call.html#c.PyObject_Call "PyObject_Call") and its variants instead.
(See more details in [bpo\-29548](https://bugs.python.org/issue?@action=redirect&bpo=29548).)

### CPython bytecode changes[¶](#cpython-bytecode-changes "Link to this heading")

* The [`LOAD_ASSERTION_ERROR`](../library/dis.html#opcode-LOAD_ASSERTION_ERROR) opcode was added for handling the
[`assert`](../reference/simple_stmts.html#assert) statement. Previously, the assert statement would not work
correctly if the [`AssertionError`](../library/exceptions.html#AssertionError "AssertionError") exception was being shadowed.
(Contributed by Zackery Spytz in [bpo\-34880](https://bugs.python.org/issue?@action=redirect&bpo=34880).)
* The [`COMPARE_OP`](../library/dis.html#opcode-COMPARE_OP) opcode was split into four distinct instructions:

	+ `COMPARE_OP` for rich comparisons
	+ `IS_OP` for ‘is’ and ‘is not’ tests
	+ `CONTAINS_OP` for ‘in’ and ‘not in’ tests
	+ `JUMP_IF_NOT_EXC_MATCH` for checking exceptions in ‘try\-except’
	statements.(Contributed by Mark Shannon in [bpo\-39156](https://bugs.python.org/issue?@action=redirect&bpo=39156).)

## Build Changes[¶](#build-changes "Link to this heading")

* Added `--with-platlibdir` option to the `configure` script: name of the
platform\-specific library directory, stored in the new [`sys.platlibdir`](../library/sys.html#sys.platlibdir "sys.platlibdir")
attribute. See [`sys.platlibdir`](../library/sys.html#sys.platlibdir "sys.platlibdir") attribute for more information.
(Contributed by Jan Matějek, Matěj Cepl, Charalampos Stratakis
and Victor Stinner in [bpo\-1294959](https://bugs.python.org/issue?@action=redirect&bpo=1294959).)
* The `COUNT_ALLOCS` special build macro has been removed.
(Contributed by Victor Stinner in [bpo\-39489](https://bugs.python.org/issue?@action=redirect&bpo=39489).)
* On non\-Windows platforms, the `setenv()` and `unsetenv()`
functions are now required to build Python.
(Contributed by Victor Stinner in [bpo\-39395](https://bugs.python.org/issue?@action=redirect&bpo=39395).)
* On non\-Windows platforms, creating `bdist_wininst` installers is now
officially unsupported. (See [bpo\-10945](https://bugs.python.org/issue?@action=redirect&bpo=10945) for more details.)
* When building Python on macOS from source, `_tkinter` now links with
non\-system Tcl and Tk frameworks if they are installed in
`/Library/Frameworks`, as had been the case on older releases
of macOS. If a macOS SDK is explicitly configured, by using
[`--enable-universalsdk`](../using/configure.html#cmdoption-enable-universalsdk) or `-isysroot`, only the SDK itself is
searched. The default behavior can still be overridden with
`--with-tcltk-includes` and `--with-tcltk-libs`.
(Contributed by Ned Deily in [bpo\-34956](https://bugs.python.org/issue?@action=redirect&bpo=34956).)
* Python can now be built for Windows 10 ARM64\.
(Contributed by Steve Dower in [bpo\-33125](https://bugs.python.org/issue?@action=redirect&bpo=33125).)
* Some individual tests are now skipped when `--pgo` is used. The tests
in question increased the PGO task time significantly and likely
didn’t help improve optimization of the final executable. This
speeds up the task by a factor of about 15x. Running the full unit test
suite is slow. This change may result in a slightly less optimized build
since not as many code branches will be executed. If you are willing to
wait for the much slower build, the old behavior can be restored using
`./configure [..] PROFILE_TASK="-m test --pgo-extended"`. We make no
guarantees as to which PGO task set produces a faster build. Users who care
should run their own relevant benchmarks as results can depend on the
environment, workload, and compiler tool chain.
(See [bpo\-36044](https://bugs.python.org/issue?@action=redirect&bpo=36044) and [bpo\-37707](https://bugs.python.org/issue?@action=redirect&bpo=37707) for more details.)

## C API Changes[¶](#c-api-changes "Link to this heading")

### New Features[¶](#id1 "Link to this heading")

* [**PEP 573**](https://peps.python.org/pep-0573/): Added [`PyType_FromModuleAndSpec()`](../c-api/type.html#c.PyType_FromModuleAndSpec "PyType_FromModuleAndSpec") to associate
a module with a class; [`PyType_GetModule()`](../c-api/type.html#c.PyType_GetModule "PyType_GetModule") and
[`PyType_GetModuleState()`](../c-api/type.html#c.PyType_GetModuleState "PyType_GetModuleState") to retrieve the module and its state; and
[`PyCMethod`](../c-api/structures.html#c.PyCMethod "PyCMethod") and [`METH_METHOD`](../c-api/structures.html#c.METH_METHOD "METH_METHOD") to allow a method to
access the class it was defined in.
(Contributed by Marcel Plch and Petr Viktorin in [bpo\-38787](https://bugs.python.org/issue?@action=redirect&bpo=38787).)
* Added [`PyFrame_GetCode()`](../c-api/frame.html#c.PyFrame_GetCode "PyFrame_GetCode") function: get a frame code.
Added [`PyFrame_GetBack()`](../c-api/frame.html#c.PyFrame_GetBack "PyFrame_GetBack") function: get the frame next outer frame.
(Contributed by Victor Stinner in [bpo\-40421](https://bugs.python.org/issue?@action=redirect&bpo=40421).)
* Added [`PyFrame_GetLineNumber()`](../c-api/frame.html#c.PyFrame_GetLineNumber "PyFrame_GetLineNumber") to the limited C API.
(Contributed by Victor Stinner in [bpo\-40421](https://bugs.python.org/issue?@action=redirect&bpo=40421).)
* Added [`PyThreadState_GetInterpreter()`](../c-api/init.html#c.PyThreadState_GetInterpreter "PyThreadState_GetInterpreter") and
[`PyInterpreterState_Get()`](../c-api/init.html#c.PyInterpreterState_Get "PyInterpreterState_Get") functions to get the interpreter.
Added [`PyThreadState_GetFrame()`](../c-api/init.html#c.PyThreadState_GetFrame "PyThreadState_GetFrame") function to get the current frame of a
Python thread state.
Added [`PyThreadState_GetID()`](../c-api/init.html#c.PyThreadState_GetID "PyThreadState_GetID") function: get the unique identifier of a
Python thread state.
(Contributed by Victor Stinner in [bpo\-39947](https://bugs.python.org/issue?@action=redirect&bpo=39947).)
* Added a new public [`PyObject_CallNoArgs()`](../c-api/call.html#c.PyObject_CallNoArgs "PyObject_CallNoArgs") function to the C API, which
calls a callable Python object without any arguments. It is the most efficient
way to call a callable Python object without any argument.
(Contributed by Victor Stinner in [bpo\-37194](https://bugs.python.org/issue?@action=redirect&bpo=37194).)
* Changes in the limited C API (if `Py_LIMITED_API` macro is defined):

	+ Provide [`Py_EnterRecursiveCall()`](../c-api/exceptions.html#c.Py_EnterRecursiveCall "Py_EnterRecursiveCall") and [`Py_LeaveRecursiveCall()`](../c-api/exceptions.html#c.Py_LeaveRecursiveCall "Py_LeaveRecursiveCall")
	as regular functions for the limited API. Previously, there were defined as
	macros, but these macros didn’t compile with the limited C API which cannot
	access `PyThreadState.recursion_depth` field (the structure is opaque in
	the limited C API).
	+ `PyObject_INIT()` and `PyObject_INIT_VAR()` become regular “opaque”
	function to hide implementation details.(Contributed by Victor Stinner in [bpo\-38644](https://bugs.python.org/issue?@action=redirect&bpo=38644) and [bpo\-39542](https://bugs.python.org/issue?@action=redirect&bpo=39542).)
* The [`PyModule_AddType()`](../c-api/module.html#c.PyModule_AddType "PyModule_AddType") function is added to help adding a type
to a module.
(Contributed by Donghee Na in [bpo\-40024](https://bugs.python.org/issue?@action=redirect&bpo=40024).)
* Added the functions [`PyObject_GC_IsTracked()`](../c-api/gcsupport.html#c.PyObject_GC_IsTracked "PyObject_GC_IsTracked") and
[`PyObject_GC_IsFinalized()`](../c-api/gcsupport.html#c.PyObject_GC_IsFinalized "PyObject_GC_IsFinalized") to the public API to allow to query if
Python objects are being currently tracked or have been already finalized by
the garbage collector respectively.
(Contributed by Pablo Galindo Salgado in [bpo\-40241](https://bugs.python.org/issue?@action=redirect&bpo=40241).)
* Added `_PyObject_FunctionStr()` to get a user\-friendly string
representation of a function\-like object.
(Patch by Jeroen Demeyer in [bpo\-37645](https://bugs.python.org/issue?@action=redirect&bpo=37645).)
* Added [`PyObject_CallOneArg()`](../c-api/call.html#c.PyObject_CallOneArg "PyObject_CallOneArg") for calling an object with one
positional argument
(Patch by Jeroen Demeyer in [bpo\-37483](https://bugs.python.org/issue?@action=redirect&bpo=37483).)

### Porting to Python 3\.9[¶](#id2 "Link to this heading")

* `PyInterpreterState.eval_frame` ([**PEP 523**](https://peps.python.org/pep-0523/)) now requires a new mandatory
*tstate* parameter (`PyThreadState*`).
(Contributed by Victor Stinner in [bpo\-38500](https://bugs.python.org/issue?@action=redirect&bpo=38500).)
* Extension modules: [`m_traverse`](../c-api/module.html#c.PyModuleDef.m_traverse "PyModuleDef.m_traverse"),
[`m_clear`](../c-api/module.html#c.PyModuleDef.m_clear "PyModuleDef.m_clear") and [`m_free`](../c-api/module.html#c.PyModuleDef.m_free "PyModuleDef.m_free")
functions of [`PyModuleDef`](../c-api/module.html#c.PyModuleDef "PyModuleDef") are no longer called if the module state
was requested but is not allocated yet. This is the case immediately after
the module is created and before the module is executed
([`Py_mod_exec`](../c-api/module.html#c.Py_mod_exec "Py_mod_exec") function). More precisely, these functions are not called
if [`m_size`](../c-api/module.html#c.PyModuleDef.m_size "PyModuleDef.m_size") is greater than 0 and the module state (as
returned by [`PyModule_GetState()`](../c-api/module.html#c.PyModule_GetState "PyModule_GetState")) is `NULL`.

Extension modules without module state (`m_size \>\> from typing import Literal
\>\>\> Literal\[{0}]
\>\>\> Literal\[{0}] == Literal\[{False}]
Traceback (most recent call last):
 File "\", line 1, in \
TypeError: unhashable type: 'set'

\`\`\`

(Contributed by Yurii Karabas in [bpo\-42345](https://bugs.python.org/issue?@action=redirect&bpo=42345).)

### macOS 11\.0 (Big Sur) and Apple Silicon Mac support[¶](#macos-11-0-big-sur-and-apple-silicon-mac-support "Link to this heading")

As of 3\.9\.1, Python now fully supports building and running on macOS 11\.0
(Big Sur) and on Apple Silicon Macs (based on the `ARM64` architecture).
A new universal build variant, `universal2`, is now available to natively
support both `ARM64` and `Intel 64` in one set of executables. Binaries
can also now be built on current versions of macOS to be deployed on a range
of older macOS versions (tested to 10\.9\) while making some newer OS
functions and options conditionally available based on the operating system
version in use at runtime (“weaklinking”).

(Contributed by Ronald Oussoren and Lawrence D’Anna in [bpo\-41100](https://bugs.python.org/issue?@action=redirect&bpo=41100).)

## Notable changes in Python 3\.9\.2[¶](#notable-changes-in-python-3-9-2 "Link to this heading")

### collections.abc[¶](#collections-abc "Link to this heading")

[`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") generic now flattens type parameters, similar
to what [`typing.Callable`](../library/typing.html#typing.Callable "typing.Callable") currently does. This means that
`collections.abc.Callable[[int, str], str]` will have `__args__` of
`(int, str, str)`; previously this was `([int, str], str)`. To allow this
change, [`types.GenericAlias`](../library/types.html#types.GenericAlias "types.GenericAlias") can now be subclassed, and a subclass will
be returned when subscripting the [`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") type.
Code which accesses the arguments via [`typing.get_args()`](../library/typing.html#typing.get_args "typing.get_args") or `__args__`
need to account for this change. A [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") may be emitted for
invalid forms of parameterizing [`collections.abc.Callable`](../library/collections.abc.html#collections.abc.Callable "collections.abc.Callable") which may have
passed silently in Python 3\.9\.1\. This [`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning") will
become a [`TypeError`](../library/exceptions.html#TypeError "TypeError") in Python 3\.10\.
(Contributed by Ken Jin in [bpo\-42195](https://bugs.python.org/issue?@action=redirect&bpo=42195).)

### urllib.parse[¶](#urllib-parse "Link to this heading")

Earlier Python versions allowed using both `;` and `&` as
query parameter separators in [`urllib.parse.parse_qs()`](../library/urllib.parse.html#urllib.parse.parse_qs "urllib.parse.parse_qs") and
[`urllib.parse.parse_qsl()`](../library/urllib.parse.html#urllib.parse.parse_qsl "urllib.parse.parse_qsl"). Due to security concerns, and to conform with
newer W3C recommendations, this has been changed to allow only a single
separator key, with `&` as the default. This change also affects
`cgi.parse()` and `cgi.parse_multipart()` as they use the affected
functions internally. For more details, please see their respective
documentation.
(Contributed by Adam Goldschmidt, Senthil Kumaran and Ken Jin in [bpo\-42967](https://bugs.python.org/issue?@action=redirect&bpo=42967).)

## Notable changes in Python 3\.9\.3[¶](#notable-changes-in-python-3-9-3 "Link to this heading")

A security fix alters the [`ftplib.FTP`](../library/ftplib.html#ftplib.FTP "ftplib.FTP") behavior to not trust the
IPv4 address sent from the remote server when setting up a passive data
channel. We reuse the ftp server IP address instead. For unusual code
requiring the old behavior, set a `trust_server_pasv_ipv4_address`
attribute on your FTP instance to `True`. (See [gh\-87451](https://github.com/python/cpython/issues/87451))

## Notable changes in Python 3\.9\.5[¶](#notable-changes-in-python-3-9-5 "Link to this heading")

### urllib.parse[¶](#id5 "Link to this heading")

The presence of newline or tab characters in parts of a URL allows for some
forms of attacks. Following the WHATWG specification that updates [**RFC 3986**](https://datatracker.ietf.org/doc/html/rfc3986.html),
ASCII newline `\n`, `\r` and tab `\t` characters are stripped from the
URL by the parser in [`urllib.parse`](../library/urllib.parse.html#module-urllib.parse "urllib.parse: Parse URLs into or assemble them from components.") preventing such attacks. The removal
characters are controlled by a new module level variable
`urllib.parse._UNSAFE_URL_BYTES_TO_REMOVE`. (See [gh\-88048](https://github.com/python/cpython/issues/88048))

## Notable security feature in 3\.9\.14[¶](#notable-security-feature-in-3-9-14 "Link to this heading")

Converting between [`int`](../library/functions.html#int "int") and [`str`](../library/stdtypes.html#str "str") in bases other than 2
(binary), 4, 8 (octal), 16 (hexadecimal), or 32 such as base 10 (decimal)
now raises a [`ValueError`](../library/exceptions.html#ValueError "ValueError") if the number of digits in string form is
above a limit to avoid potential denial of service attacks due to the
algorithmic complexity. This is a mitigation for [**CVE 2020\-10735**](https://www.cve.org/CVERecord?id=CVE-2020-10735).
This limit can be configured or disabled by environment variable, command
line flag, or [`sys`](../library/sys.html#module-sys "sys: Access system-specific parameters and functions.") APIs. See the [integer string conversion
length limitation](../library/stdtypes.html#int-max-str-digits) documentation. The default limit
is 4300 digits in string form.

## Notable changes in 3\.9\.17[¶](#notable-changes-in-3-9-17 "Link to this heading")

### tarfile[¶](#tarfile "Link to this heading")

* The extraction methods in [`tarfile`](../library/tarfile.html#module-tarfile "tarfile: Read and write tar-format archive files."), and [`shutil.unpack_archive()`](../library/shutil.html#shutil.unpack_archive "shutil.unpack_archive"),
have a new a *filter* argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See [Extraction filters](../library/tarfile.html#tarfile-extraction-filter) for details.
In Python 3\.12, use without the *filter* argument will show a
[`DeprecationWarning`](../library/exceptions.html#DeprecationWarning "DeprecationWarning").
In Python 3\.14, the default will switch to `'data'`.
(Contributed by Petr Viktorin in [**PEP 706**](https://peps.python.org/pep-0706/).)

### [Table of Contents](../contents.html)

* [What’s New In Python 3\.9](#)
	+ [Summary – Release highlights](#summary-release-highlights)
	+ [You should check for DeprecationWarning in your code](#you-should-check-for-deprecationwarning-in-your-code)
	+ [New Features](#new-features)
		- [Dictionary Merge \& Update Operators](#dictionary-merge-update-operators)
		- [New String Methods to Remove Prefixes and Suffixes](#new-string-methods-to-remove-prefixes-and-suffixes)
		- [Type Hinting Generics in Standard Collections](#type-hinting-generics-in-standard-collections)
		- [New Parser](#new-parser)
	+ [Other Language Changes](#other-language-changes)
	+ [New Modules](#new-modules)
		- [zoneinfo](#zoneinfo)
		- [graphlib](#graphlib)
	+ [Improved Modules](#improved-modules)
		- [ast](#ast)
		- [asyncio](#asyncio)
		- [compileall](#compileall)
		- [concurrent.futures](#concurrent-futures)
		- [curses](#curses)
		- [datetime](#datetime)
		- [distutils](#distutils)
		- [fcntl](#fcntl)
		- [ftplib](#ftplib)
		- [gc](#gc)
		- [hashlib](#hashlib)
		- [http](#http)
		- [IDLE and idlelib](#idle-and-idlelib)
		- [imaplib](#imaplib)
		- [importlib](#importlib)
		- [inspect](#inspect)
		- [ipaddress](#ipaddress)
		- [math](#math)
		- [multiprocessing](#multiprocessing)
		- [nntplib](#nntplib)
		- [os](#os)
		- [pathlib](#pathlib)
		- [pdb](#pdb)
		- [poplib](#poplib)
		- [pprint](#pprint)
		- [pydoc](#pydoc)
		- [random](#random)
		- [signal](#signal)
		- [smtplib](#smtplib)
		- [socket](#socket)
		- [time](#time)
		- [sys](#sys)
		- [tracemalloc](#tracemalloc)
		- [typing](#typing)
		- [unicodedata](#unicodedata)
		- [venv](#venv)
		- [xml](#xml)
	+ [Optimizations](#optimizations)
	+ [Deprecated](#deprecated)
	+ [Removed](#removed)
	+ [Porting to Python 3\.9](#porting-to-python-3-9)
		- [Changes in the Python API](#changes-in-the-python-api)
		- [Changes in the C API](#changes-in-the-c-api)
		- [CPython bytecode changes](#cpython-bytecode-changes)
	+ [Build Changes](#build-changes)
	+ [C API Changes](#c-api-changes)
		- [New Features](#id1)
		- [Porting to Python 3\.9](#id2)
		- [Removed](#id3)
	+ [Notable changes in Python 3\.9\.1](#notable-changes-in-python-3-9-1)
		- [typing](#id4)
		- [macOS 11\.0 (Big Sur) and Apple Silicon Mac support](#macos-11-0-big-sur-and-apple-silicon-mac-support)
	+ [Notable changes in Python 3\.9\.2](#notable-changes-in-python-3-9-2)
		- [collections.abc](#collections-abc)
		- [urllib.parse](#urllib-parse)
	+ [Notable changes in Python 3\.9\.3](#notable-changes-in-python-3-9-3)
	+ [Notable changes in Python 3\.9\.5](#notable-changes-in-python-3-9-5)
		- [urllib.parse](#id5)
	+ [Notable security feature in 3\.9\.14](#notable-security-feature-in-3-9-14)
	+ [Notable changes in 3\.9\.17](#notable-changes-in-3-9-17)
		- [tarfile](#tarfile)

#### Previous topic

[What’s New In Python 3\.10](3.10.html "previous chapter")

#### Next topic

[What’s New In Python 3\.8](3.8.html "next chapter")

### This Page

* [Report a Bug](../bugs.html)
* [Show Source](https://github.com/python/cpython/blob/main/Doc/whatsnew/3.9.rst)

«

### Navigation

* [index](../genindex.html "General Index")
* [modules](../py-modindex.html "Python Module Index") \|
* [next](3.8.html "What’s New In Python 3.8") \|
* [previous](3.10.html "What’s New In Python 3.10") \|
* 
* [Python](https://www.python.org/) »
* 
* 
* [3\.13\.1 Documentation](../index.html) »
* [What’s New in Python](index.html) »
* What’s New In Python 3\.9
* \|
* Theme

Auto
Light
Dark

 \|

 © 
 [Copyright](../copyright.html) 
 2001\-2025, Python Software Foundation.

 This page is licensed under the Python Software Foundation License Version 2\.

 Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.

 See [History and License](/license.html) for more information.  

 The Python Software Foundation is a non\-profit corporation.
[Please donate.](https://www.python.org/psf/donations/)

 Last updated on Jan 03, 2025 (10:19 UTC).

 [Found a bug](/bugs.html)?

 Created using [Sphinx](https://www.sphinx-doc.org/) 8\.1\.3\.



